/*!
 * @maptalks/gl-layers v0.12.1
 * LICENSE : MIT
 * (c) 2016-2022 maptalks.com
 */
!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self).maptalks=global.maptalks||{},global.maptalks)}(this,(function(exports,t$2){"use strict";function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach((function(k){if("default"!==k){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:!0,get:function(){return e[k]}})}})),n.default=e,Object.freeze(n)}var t__namespace=_interopNamespace(t$2),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},regl_min={exports:{}};!function(module,exports){module.exports=function(){function W(a,b){this.id=Db++,this.type=a,this.data=b}function Z(a){if(0===a.length)return[];var b=a.charAt(0),c=a.charAt(a.length-1);if(1<a.length&&b===c&&('"'===b||"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return Z(a.substr(0,b.index)).concat(Z(b[1])).concat(Z(a.substr(b.index+b[0].length)));if(1===(b=a.split(".")).length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(a=[],c=0;c<b.length;++c)a=a.concat(Z(b[c]));return a}function cb(a){return"["+Z(a).join("][")+"]"}function db(a,b){return"function"==typeof a?new W(0,a):"number"==typeof a||"boolean"==typeof a?new W(5,a):Array.isArray(a)?new W(6,a.map((function(a,d){return db(a)}))):a instanceof W?a:void 0}function Eb(){var a={"":0},b=[""];return{id:function(c){var d=a[c];return d||(d=a[c]=b.length,b.push(c),d)},str:function(a){return b[a]}}}function Fb(a,b,c){function d(){var b=window.innerWidth,d=window.innerHeight;a!==document.body&&(b=(d=a.getBoundingClientRect()).right-d.left,d=d.bottom-d.top),f.width=c*b,f.height=c*d,K(f.style,{width:b+"px",height:d+"px"})}var e,f=document.createElement("canvas");return K(f.style,{border:0,margin:0,padding:0,top:0,left:0}),a.appendChild(f),a===document.body&&(f.style.position="absolute",K(a.style,{margin:0,padding:0})),a!==document.body&&"function"==typeof ResizeObserver?(e=new ResizeObserver((function(){setTimeout(d)}))).observe(a):window.addEventListener("resize",d,!1),d(),{canvas:f,onDestroy:function(){e?e.disconnect():window.removeEventListener("resize",d),a.removeChild(f)}}}function Gb(a,b){function c(c){try{return a.getContext(c,b)}catch(f){return null}}return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}function eb(a){return"string"==typeof a?a.split():a}function fb(a){return"string"==typeof a?document.querySelector(a):a}function Hb(a){var c,d,f,e,b=a||{};a={};var k=[],p=[],u="undefined"==typeof window?1:window.devicePixelRatio,l=!1,v=function(a){},r=function(){};if("string"==typeof b?c=document.querySelector(b):"object"==typeof b&&("string"==typeof b.nodeName&&"function"==typeof b.appendChild&&"function"==typeof b.getBoundingClientRect?c=b:"function"==typeof b.drawArrays||"function"==typeof b.drawElements?f=(e=b).canvas:("gl"in b?e=b.gl:"canvas"in b?f=fb(b.canvas):"container"in b&&(d=fb(b.container)),"attributes"in b&&(a=b.attributes),"extensions"in b&&(k=eb(b.extensions)),"optionalExtensions"in b&&(p=eb(b.optionalExtensions)),"onDone"in b&&(v=b.onDone),"profile"in b&&(l=!!b.profile),"pixelRatio"in b&&(u=+b.pixelRatio))),c&&("canvas"===c.nodeName.toLowerCase()?f=c:d=c),!e){if(!f){if(!(c=Fb(d||document.body,v,u)))return null;f=c.canvas,r=c.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),e=Gb(f,a)}return e?{gl:e,canvas:f,container:d,extensions:k,optionalExtensions:p,pixelRatio:u,profile:l,onDone:v,onDestroy:r}:(r(),v("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ib(a,b){function c(b){var c;b=b.toLowerCase();try{c=d[b]=a.getExtension(b)}catch(f){}return!!c}for(var d={},f=0;f<b.extensions.length;++f){var e=b.extensions[f];if(!c(e))return b.onDestroy(),b.onDone('"'+e+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return b.optionalExtensions.forEach(c),{extensions:d,restore:function(){Object.keys(d).forEach((function(a){if(d[a]&&!c(a))throw Error("(regl): error restoring extension "+a)}))}}}function S(a,b){for(var c=Array(a),d=0;d<a;++d)c[d]=b(d);return c}function gb(a){var b,c;return b=(65535<a)<<4,b|=c=(255<(a>>>=b))<<3,(b|=c=(15<(a>>>=c))<<2)|(c=(3<(a>>>=c))<<1)|a>>>c>>1}function hb(){function a(a){a:{for(var b=16;268435456>=b;b*=16)if(a<=b){a=b;break a}a=0}return 0<(b=c[gb(a)>>2]).length?b.pop():new ArrayBuffer(a)}function b(a){c[gb(a.byteLength)>>2].push(a)}var c=S(8,(function(){return[]}));return{alloc:a,free:b,allocType:function(b,c){var e=null;switch(b){case 5120:e=new Int8Array(a(c),0,c);break;case 5121:e=new Uint8Array(a(c),0,c);break;case 5122:e=new Int16Array(a(2*c),0,c);break;case 5123:e=new Uint16Array(a(2*c),0,c);break;case 5124:e=new Int32Array(a(4*c),0,c);break;case 5125:e=new Uint32Array(a(4*c),0,c);break;case 5126:e=new Float32Array(a(4*c),0,c);break;default:return null}return e.length!==c?e.subarray(0,c):e},freeType:function(a){b(a.buffer)}}}function ja(a){return!!a&&"object"==typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"==typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||P(a.data))}function ib(a,b,c,d,f,e){for(var k=0;k<b;++k)for(var p=a[k],u=0;u<c;++u)for(var l=p[u],v=0;v<d;++v)f[e++]=l[v]}function jb(a,b,c,d,f){for(var e=1,k=c+1;k<b.length;++k)e*=b[k];var p=b[c];if(4==b.length-c){var u=b[c+1],l=b[c+2];for(b=b[c+3],k=0;k<p;++k)ib(a[k],u,l,b,d,f),f+=e}else for(k=0;k<p;++k)jb(a[k],b,c+1,d,f),f+=e}function Ha(a){return 0|Ia[Object.prototype.toString.call(a)]}function kb(a,b){for(var c=0;c<b.length;++c)a[c]=b[c]}function lb(a,b,c,d,f,e,k){for(var p=0,u=0;u<c;++u)for(var l=0;l<d;++l)a[p++]=b[f*u+e*l+k]}function Jb(a,b,c,d){function f(b){this.id=u++,this.buffer=a.createBuffer(),this.type=b,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,c.profile&&(this.stats={size:0})}function e(b,c,m){b.byteLength=c.byteLength,a.bufferData(b.type,c,m)}function k(a,b,c,h,g,d){if(a.usage=c,Array.isArray(b)){if(a.dtype=h||5126,0<b.length)if(Array.isArray(b[0])){g=mb(b);for(var n=h=1;n<g.length;++n)h*=g[n];a.dimension=h,e(a,b=Ua(b,g,a.dtype),c),d?a.persistentData=b:D.freeType(b)}else"number"==typeof b[0]?(a.dimension=g,kb(g=D.allocType(a.dtype,b.length),b),e(a,g,c),d?a.persistentData=g:D.freeType(g)):P(b[0])&&(a.dimension=b[0].length,a.dtype=h||Ha(b[0])||5126,e(a,b=Ua(b,[b.length,b[0].length],a.dtype),c),d?a.persistentData=b:D.freeType(b))}else if(P(b))a.dtype=h||Ha(b),a.dimension=g,e(a,b,c),d&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(ja(b)){var f=b.stride,q=(n=b.offset,0),na=0,l=0,p=0;1===(g=b.shape).length?(q=g[0],na=1,l=f[0],p=0):2===g.length&&(q=g[0],na=g[1],l=f[0],p=f[1]),a.dtype=h||Ha(b.data)||5126,a.dimension=na,lb(g=D.allocType(a.dtype,q*na),b.data,q,na,l,p,n),e(a,g,c),d?a.persistentData=g:D.freeType(g)}else b instanceof ArrayBuffer&&(a.dtype=5121,a.dimension=g,e(a,b,c),d&&(a.persistentData=new Uint8Array(new Uint8Array(b))))}function p(c){b.bufferCount--,d(c),a.deleteBuffer(c.buffer),c.buffer=null,delete l[c.id]}var u=0,l={};f.prototype.bind=function(){a.bindBuffer(this.type,this.buffer)},f.prototype.destroy=function(){p(this)};var v=[];return c.profile&&(b.getTotalBufferSize=function(){var a=0;return Object.keys(l).forEach((function(b){a+=l[b].stats.size})),a}),{create:function(r,d,e,h){function g(b){var r=35044,q=null,d=0,e=0,f=1;return Array.isArray(b)||P(b)||ja(b)||b instanceof ArrayBuffer?q=b:"number"==typeof b?d=0|b:b&&("data"in b&&(q=b.data),"usage"in b&&(r=nb[b.usage]),"type"in b&&(e=Ja[b.type]),"dimension"in b&&(f=0|b.dimension),"length"in b&&(d=0|b.length)),t.bind(),q?k(t,q,r,e,f,h):(d&&a.bufferData(t.type,d,r),t.dtype=e||5121,t.usage=r,t.dimension=f,t.byteLength=d),c.profile&&(t.stats.size=t.byteLength*ka[t.dtype]),g}b.bufferCount++;var t=new f(d);return l[t.id]=t,e||g(r),g._reglType="buffer",g._buffer=t,g.subdata=function(b,c){var d,q=0|(c||0);if(t.bind(),P(b)||b instanceof ArrayBuffer)a.bufferSubData(t.type,q,b);else if(Array.isArray(b)){if(0<b.length)if("number"==typeof b[0]){var r=D.allocType(t.dtype,b.length);kb(r,b),a.bufferSubData(t.type,q,r),D.freeType(r)}else(Array.isArray(b[0])||P(b[0]))&&(d=mb(b),r=Ua(b,d,t.dtype),a.bufferSubData(t.type,q,r),D.freeType(r))}else if(ja(b)){var e=b.stride,h=r=0,f=0,E=0;1===(d=b.shape).length?(r=d[0],h=1,f=e[0],E=0):2===d.length&&(r=d[0],h=d[1],f=e[0],E=e[1]),d=Array.isArray(b.data)?t.dtype:Ha(b.data),lb(d=D.allocType(d,r*h),b.data,r,h,f,E,b.offset),a.bufferSubData(t.type,q,d),D.freeType(d)}return g},c.profile&&(g.stats=t.stats),g.destroy=function(){p(t)},g},createStream:function(a,b){var c=v.pop();return c||(c=new f(a)),c.bind(),k(c,b,35040,0,1,!1),c},destroyStream:function(a){v.push(a)},clear:function(){J(l).forEach(p),v.forEach(p)},getBuffer:function(a){return a&&a._buffer instanceof f?a._buffer:null},restore:function(){J(l).forEach((function(b){b.buffer=a.createBuffer(),a.bindBuffer(b.type,b.buffer),a.bufferData(b.type,b.persistentData||b.byteLength,b.usage)}))},_initBuffer:k}}function Kb(a,b,c,d){function f(a){this.id=u++,p[this.id]=this,this.buffer=a,this.primType=4,this.type=this.vertCount=0}function e(d,e,f,h,g,t,n){var l;if(d.buffer.bind(),e?((l=n)||P(e)&&(!ja(e)||P(e.data))||(l=b.oes_element_index_uint?5125:5123),c._initBuffer(d.buffer,e,f,l,3)):(a.bufferData(34963,t,f),d.buffer.dtype=l||5121,d.buffer.usage=f,d.buffer.dimension=3,d.buffer.byteLength=t),l=n,!n){switch(d.buffer.dtype){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;break;case 5125:case 5124:l=5125}d.buffer.dtype=l}d.type=l,0>(e=g)&&(e=d.buffer.byteLength,5123===l?e>>=1:5125===l&&(e>>=2)),d.vertCount=e,e=h,0>h&&(e=4,1===(h=d.buffer.dimension)&&(e=0),2===h&&(e=1),3===h&&(e=4)),d.primType=e}function k(a){d.elementsCount--,delete p[a.id],a.buffer.destroy(),a.buffer=null}var p={},u=0,l={uint8:5121,uint16:5123};b.oes_element_index_uint&&(l.uint32=5125),f.prototype.bind=function(){this.buffer.bind()};var v=[];return{create:function(a,b){function m(a){if(a)if("number"==typeof a)h(a),g.primType=4,g.vertCount=0|a,g.type=5121;else{var b=null,c=35044,d=-1,f=-1,r=0,p=0;Array.isArray(a)||P(a)||ja(a)?b=a:("data"in a&&(b=a.data),"usage"in a&&(c=nb[a.usage]),"primitive"in a&&(d=Ka[a.primitive]),"count"in a&&(f=0|a.count),"type"in a&&(p=l[a.type]),"length"in a?r=0|a.length:(r=f,5123===p||5122===p?r*=2:5125!==p&&5124!==p||(r*=4))),e(g,b,c,d,f,r,p)}else h(),g.primType=4,g.vertCount=0,g.type=5121;return m}var h=c.create(null,34963,!0),g=new f(h._buffer);return d.elementsCount++,m(a),m._reglType="elements",m._elements=g,m.subdata=function(a,b){return h.subdata(a,b),m},m.destroy=function(){k(g)},m},createStream:function(a){var b=v.pop();return b||(b=new f(c.create(null,34963,!0,!1)._buffer)),e(b,a,35040,-1,-1,0,0),b},destroyStream:function(a){v.push(a)},getElements:function(a){return"function"==typeof a&&a._elements instanceof f?a._elements:null},clear:function(){J(p).forEach(k)}}}function ob(a){for(var b=D.allocType(5123,a.length),c=0;c<a.length;++c)if(isNaN(a[c]))b[c]=65535;else if(1/0===a[c])b[c]=31744;else if(-1/0===a[c])b[c]=64512;else{pb[0]=a[c];var f=(d=Lb[0])>>>31<<15,e=(d<<1>>>24)-127,d=d>>13&1023;b[c]=-24>e?f:-14>e?f+(d+1024>>-14-e):15<e?f+31744:f+(e+15<<10)+d}return b}function ra(a){return Array.isArray(a)||P(a)}function sa(a){return"[object "+a+"]"}function qb(a){return Array.isArray(a)&&(0===a.length||"number"==typeof a[0])}function rb(a){return!(!Array.isArray(a)||0===a.length||!ra(a[0]))}function la(a){return Object.prototype.toString.call(a)}function Va(a){if(!a)return!1;var b=la(a);return 0<=Mb.indexOf(b)||qb(a)||rb(a)||ja(a)}function sb(a,b){36193===a.type?(a.data=ob(b),D.freeType(b)):a.data=b}function La(a,b,c,d,f,e){if(a=void 0!==G[a]?G[a]:T[a]*ta[b],e&&(a*=6),f){for(d=0;1<=c;)d+=a*c*c,c/=2;return d}return a*c*d}function Nb(a,b,c,d,f,e,k){function p(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function u(a,b){a.internalformat=b.internalformat,a.format=b.format,a.type=b.type,a.compressed=b.compressed,a.premultiplyAlpha=b.premultiplyAlpha,a.flipY=b.flipY,a.unpackAlignment=b.unpackAlignment,a.colorSpace=b.colorSpace,a.width=b.width,a.height=b.height,a.channels=b.channels}function l(a,b){if("object"==typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha),"flipY"in b&&(a.flipY=b.flipY),"alignment"in b&&(a.unpackAlignment=b.alignment),"colorSpace"in b&&(a.colorSpace=Ob[b.colorSpace]),"type"in b&&(a.type=N[b.type]);var c=a.width,d=a.height,e=a.channels,g=!1;"shape"in b?(c=b.shape[0],d=b.shape[1],3===b.shape.length&&(e=b.shape[2],g=!0)):("radius"in b&&(c=d=b.radius),"width"in b&&(c=b.width),"height"in b&&(d=b.height),"channels"in b&&(e=b.channels,g=!0)),a.width=0|c,a.height=0|d,a.channels=0|e,c=!1,"format"in b&&(d=a.internalformat=F[c=b.format],a.format=U[d],c in N&&!("type"in b)&&(a.type=N[c]),c in ga&&(a.compressed=!0),c=!0),!g&&c?a.channels=T[a.format]:g&&!c&&a.channels!==Oa[a.format]&&(a.format=a.internalformat=Oa[a.channels])}}function v(b){a.pixelStorei(37440,b.flipY),a.pixelStorei(37441,b.premultiplyAlpha),a.pixelStorei(37443,b.colorSpace),a.pixelStorei(3317,b.unpackAlignment)}function r(){p.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function w(a,b){var c=null;if(Va(b)?c=b:b&&(l(a,b),"x"in b&&(a.xOffset=0|b.x),"y"in b&&(a.yOffset=0|b.y),Va(b.data)&&(c=b.data)),b.copy){var d=f.viewportWidth,e=f.viewportHeight;a.width=a.width||d-a.xOffset,a.height=a.height||e-a.yOffset,a.needsCopy=!0}else if(c){if(P(c))a.channels=a.channels||4,a.data=c,"type"in b||5121!==a.type||(a.type=0|Ia[Object.prototype.toString.call(c)]);else if(qb(c)){switch(a.channels=a.channels||4,e=(d=c).length,a.type){case 5121:case 5123:case 5125:case 5126:(e=D.allocType(a.type,e)).set(d),a.data=e;break;case 36193:a.data=ob(d)}a.alignment=1,a.needsFree=!0}else if(ja(c)){d=c.data,Array.isArray(d)||5121!==a.type||(a.type=0|Ia[Object.prototype.toString.call(d)]);var q,E,h,n,g=c.stride;3===(e=c.shape).length?(h=e[2],n=g[2]):n=h=1,q=e[0],E=e[1],e=g[0],g=g[1],a.alignment=1,a.width=q,a.height=E,a.channels=h,a.format=a.internalformat=Oa[h],a.needsFree=!0,q=n,c=c.offset;for(var x=D.allocType(36193===a.type?5126:a.type,(h=a.width)*(n=a.height)*(E=a.channels)),O=0,ha=0;ha<n;++ha)for(var oa=0;oa<h;++oa)for(var Wa=0;Wa<E;++Wa)x[O++]=d[e*oa+g*ha+q*Wa+c];sb(a,x)}else if(la(c)===Xa||la(c)===Ya||la(c)===ub)a.element=la(c)===Xa||la(c)===Ya?c:c.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if(la(c)===vb)a.element=c,a.width=c.width,a.height=c.height,a.channels=4;else if(la(c)===wb)a.element=c,a.width=c.naturalWidth,a.height=c.naturalHeight,a.channels=4;else if(la(c)===xb)a.element=c,a.width=c.videoWidth,a.height=c.videoHeight,a.channels=4;else if(rb(c)){for(d=a.width||c[0].length,e=a.height||c.length,g=a.channels,g=ra(c[0][0])?g||c[0][0].length:g||1,q=Qa.shape(c),h=1,n=0;n<q.length;++n)h*=q[n];h=D.allocType(36193===a.type?5126:a.type,h),Qa.flatten(c,q,"",h),sb(a,h),a.alignment=1,a.width=d,a.height=e,a.channels=g,a.format=a.internalformat=Oa[g],a.needsFree=!0}}else a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4}function m(b,c,e,g,h){var q=b.element,n=b.data,E=b.internalformat,f=b.format,l=b.type,x=b.width,O=b.height;v(b),q?a.texSubImage2D(c,h,e,g,f,l,q):b.compressed?a.compressedTexSubImage2D(c,h,e,g,E,x,O,n):b.needsCopy?(d(),a.copyTexSubImage2D(c,h,e,g,b.xOffset,b.yOffset,x,O)):a.texSubImage2D(c,h,e,g,x,O,f,l,n)}function h(){return S.pop()||new r}function g(a){a.needsFree&&D.freeType(a.data),r.call(a),S.push(a)}function t(){p.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function n(a,b,c){var d=a.images[0]=h();a.mipmask=1,d.width=a.width=b,d.height=a.height=c,d.channels=a.channels=4}function C(a,b){var c=null;if(Va(b))u(c=a.images[0]=h(),a),w(c,b),a.mipmask=1;else if(l(a,b),Array.isArray(b.mipmap))for(var d=b.mipmap,e=0;e<d.length;++e)u(c=a.images[e]=h(),a),c.width>>=e,c.height>>=e,w(c,d[e]),a.mipmask|=1<<e;else u(c=a.images[0]=h(),a),w(c,b),a.mipmask=1;u(a,a.images[0])}function q(b,c){for(var e=b.images,g=0;g<e.length&&e[g];++g){var h=e[g],q=c,n=g,E=h.element,f=h.data,l=h.internalformat,x=h.format,O=h.type,ha=h.width,oa=h.height;v(h),E?a.texImage2D(q,n,x,x,O,E):h.compressed?a.compressedTexImage2D(q,n,l,ha,oa,0,f):h.needsCopy?(d(),a.copyTexImage2D(q,n,x,h.xOffset,h.yOffset,ha,oa,0)):a.texImage2D(q,n,x,ha,oa,0,x,O,f||null)}}function na(){var a=Y.pop()||new t;p.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function za(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&g(b[c]),b[c]=null;Y.push(a)}function B(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function I(a,b){"min"in b&&(a.minFilter=Aa[b.min],0<=Pb.indexOf(a.minFilter)&&!("faces"in b)&&(a.genMipmaps=!0)),"mag"in b&&(a.magFilter=Q[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in b){var e=b.wrap;"string"==typeof e?c=d=ia[e]:Array.isArray(e)&&(c=ia[e[0]],d=ia[e[1]])}else"wrapS"in b&&(c=ia[b.wrapS]),"wrapT"in b&&(d=ia[b.wrapT]);if(a.wrapS=c,a.wrapT=d,"anisotropic"in b&&(a.anisotropic=b.anisotropic),"mipmap"in b){switch(c=!1,typeof b.mipmap){case"string":a.mipmapHint=A[b.mipmap],c=a.genMipmaps=!0;break;case"boolean":c=a.genMipmaps=b.mipmap;break;case"object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function M(c,d){a.texParameteri(d,10241,c.minFilter),a.texParameteri(d,10240,c.magFilter),a.texParameteri(d,10242,c.wrapS),a.texParameteri(d,10243,c.wrapT),b.ext_texture_filter_anisotropic&&a.texParameteri(d,34046,c.anisotropic),c.genMipmaps&&(a.hint(33170,c.mipmapHint),a.generateMipmap(d))}function E(b){p.call(this),this.mipmask=0,this.internalformat=6408,this.id=R++,this.refCount=1,this.target=b,this.texture=a.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new B,k.profile&&(this.stats={size:0})}function ba(b){a.activeTexture(33984),a.bindTexture(b.target,b.texture)}function Ba(){var b=V[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function z(b){var c=b.texture,d=b.unit,g=b.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(g,null),V[d]=null),a.deleteTexture(c),b.texture=null,b.params=null,b.pixels=null,b.refCount=0,delete ea[b.id],e.textureCount--}var A={"don't care":4352,"dont care":4352,nice:4354,fast:4353},ia={repeat:10497,clamp:33071,mirror:33648},Q={nearest:9728,linear:9729},Aa=K({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},Q),Ob={none:0,browser:37444},N={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},F={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ga={};b.ext_srgb&&(F.srgb=35904,F.srgba=35906),b.oes_texture_float&&(N.float32=N.float=5126),b.oes_texture_half_float&&(N.float16=N["half float"]=36193),b.webgl_depth_texture&&(K(F,{depth:6402,"depth stencil":34041}),K(N,{uint16:5123,uint32:5125,"depth stencil":34042})),b.webgl_compressed_texture_s3tc&&K(ga,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),b.webgl_compressed_texture_atc&&K(ga,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),b.webgl_compressed_texture_pvrtc&&K(ga,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),b.webgl_compressed_texture_etc1&&(ga["rgb etc1"]=36196);var H=Array.prototype.slice.call(a.getParameter(34467));Object.keys(ga).forEach((function(a){var b=ga[a];0<=H.indexOf(b)&&(F[a]=b)}));var G=Object.keys(F);c.textureFormats=G;var ca=[];Object.keys(F).forEach((function(a){ca[F[a]]=a}));var L=[];Object.keys(N).forEach((function(a){L[N[a]]=a}));var ma=[];Object.keys(Q).forEach((function(a){ma[Q[a]]=a}));var pa=[];Object.keys(Aa).forEach((function(a){pa[Aa[a]]=a}));var qa=[];Object.keys(ia).forEach((function(a){qa[ia[a]]=a}));var U=G.reduce((function(a,c){var d=F[c];return a[d]=6409===d||6406===d||6409===d||6410===d||6402===d||34041===d||b.ext_srgb&&(35904===d||35906===d)?d:32855===d||0<=c.indexOf("rgba")?6408:6407,a}),{}),S=[],Y=[],R=0,ea={},fa=c.maxTextureUnits,V=Array(fa).map((function(){return null}));return K(E.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<fa;++c){var d=V[c];if(d){if(0<d.bindCount)continue;d.unit=-1}V[c]=this,b=c;break}k.profile&&e.maxTextureUnits<b+1&&(e.maxTextureUnits=b+1),this.unit=b,a.activeTexture(33984+b),a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&z(this)}}),k.profile&&(e.getTotalTextureSize=function(){var a=0;return Object.keys(ea).forEach((function(b){a+=ea[b].stats.size})),a}),{create2D:function(b,c){function d(a,b){var c=f.texInfo;B.call(c);var e=na();return"number"==typeof a?n(e,0|a,"number"==typeof b?0|b:0|a):a?(I(c,a),C(e,a)):n(e,1,1),c.genMipmaps&&(e.mipmask=(e.width<<1)-1),f.mipmask=e.mipmask,u(f,e),f.internalformat=e.internalformat,d.width=e.width,d.height=e.height,ba(f),q(e,3553),M(c,3553),Ba(),za(e),k.profile&&(f.stats.size=La(f.internalformat,f.type,e.width,e.height,c.genMipmaps,!1)),d.format=ca[f.internalformat],d.type=L[f.type],d.mag=ma[c.magFilter],d.min=pa[c.minFilter],d.wrapS=qa[c.wrapS],d.wrapT=qa[c.wrapT],d}var f=new E(3553);return ea[f.id]=f,e.textureCount++,d(b,c),d.subimage=function(a,b,c,e){b|=0,c|=0,e|=0;var q=h();return u(q,f),q.width=0,q.height=0,w(q,a),q.width=q.width||(f.width>>e)-b,q.height=q.height||(f.height>>e)-c,ba(f),m(q,3553,b,c,e),Ba(),g(q),d},d.resize=function(b,c){var e=0|b,g=0|c||e;if(e===f.width&&g===f.height)return d;d.width=f.width=e,d.height=f.height=g,ba(f);for(var h=0;f.mipmask>>h;++h){var q=e>>h,x=g>>h;if(!q||!x)break;a.texImage2D(3553,h,f.format,q,x,0,f.format,f.type,null)}return Ba(),k.profile&&(f.stats.size=La(f.internalformat,f.type,e,g,!1,!1)),d},d._reglType="texture2d",d._texture=f,k.profile&&(d.stats=f.stats),d.destroy=function(){f.decRef()},d},createCube:function(b,c,d,f,r,p){function A(a,b,c,d,e,f){var g,da=z.texInfo;for(B.call(da),g=0;6>g;++g)t[g]=na();if("number"!=typeof a&&a){if("object"==typeof a)if(b)C(t[0],a),C(t[1],b),C(t[2],c),C(t[3],d),C(t[4],e),C(t[5],f);else if(I(da,a),l(z,a),"faces"in a)for(a=a.faces,g=0;6>g;++g)u(t[g],z),C(t[g],a[g]);else for(g=0;6>g;++g)C(t[g],a)}else for(a=0|a||1,g=0;6>g;++g)n(t[g],a,a);for(u(z,t[0]),z.mipmask=da.genMipmaps?(t[0].width<<1)-1:t[0].mipmask,z.internalformat=t[0].internalformat,A.width=t[0].width,A.height=t[0].height,ba(z),g=0;6>g;++g)q(t[g],34069+g);for(M(da,34067),Ba(),k.profile&&(z.stats.size=La(z.internalformat,z.type,A.width,A.height,da.genMipmaps,!0)),A.format=ca[z.internalformat],A.type=L[z.type],A.mag=ma[da.magFilter],A.min=pa[da.minFilter],A.wrapS=qa[da.wrapS],A.wrapT=qa[da.wrapT],g=0;6>g;++g)za(t[g]);return A}var z=new E(34067);ea[z.id]=z,e.cubeCount++;var t=Array(6);return A(b,c,d,f,r,p),A.subimage=function(a,b,c,d,e){c|=0,d|=0,e|=0;var f=h();return u(f,z),f.width=0,f.height=0,w(f,b),f.width=f.width||(z.width>>e)-c,f.height=f.height||(z.height>>e)-d,ba(z),m(f,34069+a,c,d,e),Ba(),g(f),A},A.resize=function(b){if((b|=0)!==z.width){A.width=z.width=b,A.height=z.height=b,ba(z);for(var c=0;6>c;++c)for(var d=0;z.mipmask>>d;++d)a.texImage2D(34069+c,d,z.format,b>>d,b>>d,0,z.format,z.type,null);return Ba(),k.profile&&(z.stats.size=La(z.internalformat,z.type,A.width,A.height,!1,!0)),A}},A._reglType="textureCube",A._texture=z,k.profile&&(A.stats=z.stats),A.destroy=function(){z.decRef()},A},clear:function(){for(var b=0;b<fa;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),V[b]=null;J(ea).forEach(z),e.cubeCount=0,e.textureCount=0},getTexture:function(a){return null},restore:function(){for(var b=0;b<fa;++b){var c=V[b];c&&(c.bindCount=0,c.unit=-1,V[b]=null)}J(ea).forEach((function(b){b.texture=a.createTexture(),a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!=(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var d=0;6>d;++d)a.texImage2D(34069+d,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);M(b.texInfo,b.target)}))},refresh:function(){for(var b=0;b<fa;++b){var c=V[b];c&&(c.bindCount=0,c.unit=-1,V[b]=null),a.activeTexture(33984+b),a.bindTexture(3553,null),a.bindTexture(34067,null)}}}}function Qb(a,b,c,d,f,e){function k(a,b,c){this.target=a,this.texture=b,this.renderbuffer=c;var d=a=0;b?(a=b.width,d=b.height):c&&(a=c.width,d=c.height),this.width=a,this.height=d}function p(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function u(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function l(b,c){c&&(c.texture?a.framebufferTexture2D(36160,b,c.target,c.texture._texture.texture,0):a.framebufferRenderbuffer(36160,b,36161,c.renderbuffer._renderbuffer.renderbuffer))}function v(a){var b=3553,c=null,d=null,e=a;return"object"==typeof a&&(e=a.data,"target"in a&&(b=0|a.target)),"texture2d"===(a=e._reglType)||"textureCube"===a?c=e:"renderbuffer"===a&&(d=e,b=36161),new k(b,c,d)}function r(a,b,c,e,g){return c?((a=d.create2D({width:a,height:b,format:e,type:g}))._texture.refCount=0,new k(3553,a,null)):((a=f.create({width:a,height:b,format:e}))._renderbuffer.refCount=0,new k(36161,null,a))}function w(a){return a&&(a.texture||a.renderbuffer)}function m(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c),a.width=b,a.height=c)}function h(){this.id=I++,M[this.id]=this,this.framebuffer=a.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function g(a){a.colorAttachments.forEach(p),p(a.depthAttachment),p(a.stencilAttachment),p(a.depthStencilAttachment)}function t(b){a.deleteFramebuffer(b.framebuffer),b.framebuffer=null,e.framebufferCount--,delete M[b.id]}function n(b){var d;a.bindFramebuffer(36160,b.framebuffer);var e=b.colorAttachments;for(d=0;d<e.length;++d)l(36064+d,e[d]);for(d=e.length;d<c.maxColorAttachments;++d)a.framebufferTexture2D(36160,36064+d,3553,null,0);a.framebufferTexture2D(36160,33306,3553,null,0),a.framebufferTexture2D(36160,36096,3553,null,0),a.framebufferTexture2D(36160,36128,3553,null,0),l(36096,b.depthAttachment),l(36128,b.stencilAttachment),l(33306,b.depthStencilAttachment),a.checkFramebufferStatus(36160),a.isContextLost(),a.bindFramebuffer(36160,q.next?q.next.framebuffer:null),q.cur=q.next,a.getError()}function C(b,c){function d(a,b){var c,e=0,h=0,q=!0,l=!0;c=null;var t=!0,m="rgba",p="uint8",k=1,C=null,E=null,pa=null,M=!1;"number"==typeof a?(e=0|a,h=0|b||e):a?("shape"in a?(e=(h=a.shape)[0],h=h[1]):("radius"in a&&(e=h=a.radius),"width"in a&&(e=a.width),"height"in a&&(h=a.height)),("color"in a||"colors"in a)&&(c=a.color||a.colors),c||("colorCount"in a&&(k=0|a.colorCount),"colorTexture"in a&&(t=!!a.colorTexture,m="rgba4"),"colorType"in a&&(p=a.colorType,!t)&&("half float"===p||"float16"===p?m="rgba16f":"float"!==p&&"float32"!==p||(m="rgba32f")),"colorFormat"in a&&(0<=na.indexOf(m=a.colorFormat)?t=!0:0<=za.indexOf(m)&&(t=!1))),("depthTexture"in a||"depthStencilTexture"in a)&&(M=!(!a.depthTexture&&!a.depthStencilTexture)),"depth"in a&&("boolean"==typeof a.depth?q=a.depth:(C=a.depth,l=!1)),"stencil"in a&&("boolean"==typeof a.stencil?l=a.stencil:(E=a.stencil,q=!1)),"depthStencil"in a&&("boolean"==typeof a.depthStencil?q=l=a.depthStencil:(pa=a.depthStencil,l=q=!1))):e=h=1;var U=null,I=null,ba=null,B=null;if(Array.isArray(c))U=c.map(v);else if(c)U=[v(c)];else for(U=Array(k),c=0;c<k;++c)U[c]=r(e,h,t,m,p);for(e=e||U[0].width,h=h||U[0].height,C?I=v(C):q&&!l&&(I=r(e,h,M,"depth","uint32")),E?ba=v(E):l&&!q&&(ba=r(e,h,!1,"stencil","uint8")),pa?B=v(pa):!C&&!E&&l&&q&&(B=r(e,h,M,"depth stencil","depth stencil")),q=null,c=0;c<U.length;++c)u(U[c]),U[c]&&U[c].texture&&(l=Za[U[c].texture._texture.format]*Ra[U[c].texture._texture.type],null===q&&(q=l));return u(I),u(ba),u(B),g(f),f.width=e,f.height=h,f.colorAttachments=U,f.depthAttachment=I,f.stencilAttachment=ba,f.depthStencilAttachment=B,d.color=U.map(w),d.depth=w(I),d.stencil=w(ba),d.depthStencil=w(B),d.width=f.width,d.height=f.height,n(f),d}var f=new h;return e.framebufferCount++,d(b,c),K(d,{resize:function(a,b){var c=Math.max(0|a,1),e=Math.max(0|b||c,1);if(c===f.width&&e===f.height)return d;for(var g=f.colorAttachments,h=0;h<g.length;++h)m(g[h],c,e);return m(f.depthAttachment,c,e),m(f.stencilAttachment,c,e),m(f.depthStencilAttachment,c,e),f.width=d.width=c,f.height=d.height=e,n(f),d},blit:function(b,c,d){a.bindFramebuffer(36008,b._framebuffer.framebuffer),a.bindFramebuffer(36009,f.framebuffer),c||(c=16384),a.blitFramebuffer(0,0,b.width,b.height,0,0,f.width,f.height,c,"linear"===d?9729:9728),a.bindFramebuffer(36008,null),a.bindFramebuffer(36009,null)},_reglType:"framebuffer",_framebuffer:f,destroy:function(){t(f),g(f)},use:function(a){q.setFBO({framebuffer:d},a)}})}var q={cur:null,next:null,dirty:!1,setFBO:null},na=["rgba"],za=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&za.push("srgba"),b.ext_color_buffer_half_float&&za.push("rgba16f","rgb16f"),b.webgl_color_buffer_float&&za.push("rgba32f");var B=["uint8"];b.oes_texture_half_float&&B.push("half float","float16"),b.oes_texture_float&&B.push("float","float32");var I=0,M={};return K(q,{getFramebuffer:function(a){return"function"==typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer)instanceof h?a:null},create:C,createCube:function(a){function b(a){var e,f={color:null},g=0,h=null;e="rgba";var q="uint8",n=1;if("number"==typeof a?g=0|a:a?("shape"in a?g=a.shape[0]:("radius"in a&&(g=0|a.radius),"width"in a?g=0|a.width:"height"in a&&(g=0|a.height)),("color"in a||"colors"in a)&&(h=a.color||a.colors),h||("colorCount"in a&&(n=0|a.colorCount),"colorType"in a&&(q=a.colorType),"colorFormat"in a&&(e=a.colorFormat)),"depth"in a&&(f.depth=a.depth),"stencil"in a&&(f.stencil=a.stencil),"depthStencil"in a&&(f.depthStencil=a.depthStencil)):g=1,h)if(Array.isArray(h))for(a=[],e=0;e<h.length;++e)a[e]=h[e];else a=[h];else for(a=Array(n),h={radius:g,format:e,type:q},e=0;e<n;++e)a[e]=d.createCube(h);for(f.color=Array(a.length),e=0;e<a.length;++e)n=a[e],g=g||n.width,f.color[e]={target:34069,data:a[e]};for(e=0;6>e;++e){for(n=0;n<a.length;++n)f.color[n].target=34069+e;0<e&&(f.depth=c[0].depth,f.stencil=c[0].stencil,f.depthStencil=c[0].depthStencil),c[e]?c[e](f):c[e]=C(f)}return K(b,{width:g,height:g,color:a})}var c=Array(6);return b(a),K(b,{faces:c,resize:function(a){var d=0|a;if(d===b.width)return b;var e=b.color;for(a=0;a<e.length;++a)e[a].resize(d);for(a=0;6>a;++a)c[a].resize(d);return b.width=b.height=d,b},_reglType:"framebufferCube",destroy:function(){c.forEach((function(a){a.destroy()}))}})},clear:function(){J(M).forEach(t)},restore:function(){q.cur=null,q.next=null,q.dirty=!0,J(M).forEach((function(b){b.framebuffer=a.createFramebuffer(),n(b)}))}})}function $a(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function Rb(a,b,c,d,f,e,k){function p(a){if(a!==t.currentVAO){var c=b.oes_vertex_array_object;c.bindVertexArrayOES(a?a.vao:null),t.currentVAO=a}}function u(c){if(c!==t.currentVAO){if(c)c.bindAttrs();else{for(var d=b.angle_instanced_arrays,e=0;e<m.length;++e){var f=m[e];f.buffer?(a.enableVertexAttribArray(e),f.buffer.bind(),a.vertexAttribPointer(e,f.size,f.type,f.normalized,f.stride,f.offfset),d&&f.divisor&&d.vertexAttribDivisorANGLE(e,f.divisor)):(a.disableVertexAttribArray(e),a.vertexAttrib4f(e,f.x,f.y,f.z,f.w))}a.bindBuffer(34963,k.elements?k.elements.buffer.buffer:null)}t.currentVAO=c}}function l(){J(g).forEach((function(a){a.destroy()}))}function v(){this.id=++h,this.attributes=[],this.elements=null,this.ownsElements=!1,this.offset=this.count=0,this.instances=-1,this.primitive=4;var a=b.oes_vertex_array_object;this.vao=a?a.createVertexArrayOES():null,g[this.id]=this,this.buffers=[]}function r(){b.oes_vertex_array_object&&J(g).forEach((function(a){a.refresh()}))}var w=c.maxAttributes,m=Array(w);for(c=0;c<w;++c)m[c]=new $a;var h=0,g={},t={Record:$a,scope:{},state:m,currentVAO:null,targetVAO:null,restore:b.oes_vertex_array_object?r:function(){},createVAO:function(a){function b(a){var d;Array.isArray(a)?(d=a,c.elements&&c.ownsElements&&c.elements.destroy(),c.elements=null,c.ownsElements=!1,c.offset=0,c.count=0,c.instances=-1,c.primitive=4):(a.elements?(d=a.elements,c.ownsElements?("function"==typeof d&&"elements"===d._reglType?c.elements.destroy():c.elements(d),c.ownsElements=!1):e.getElements(a.elements)?(c.elements=a.elements,c.ownsElements=!1):(c.elements=e.create(a.elements),c.ownsElements=!0)):(c.elements=null,c.ownsElements=!1),d=a.attributes,c.offset=0,c.count=-1,c.instances=-1,c.primitive=4,c.elements&&(c.count=c.elements._elements.vertCount,c.primitive=c.elements._elements.primType),"offset"in a&&(c.offset=0|a.offset),"count"in a&&(c.count=0|a.count),"instances"in a&&(c.instances=0|a.instances),"primitive"in a&&(c.primitive=Ka[a.primitive])),a={};var g=c.attributes;g.length=d.length;for(var h=0;h<d.length;++h){var m,n=d[h],l=g[h]=new $a,t=n.data||n;Array.isArray(t)||P(t)||ja(t)?(c.buffers[h]&&(m=c.buffers[h],P(t)&&m._buffer.byteLength>=t.byteLength?m.subdata(t):(m.destroy(),c.buffers[h]=null)),c.buffers[h]||(m=c.buffers[h]=f.create(n,34962,!1,!0)),l.buffer=f.getBuffer(m),l.size=0|l.buffer.dimension,l.normalized=!1,l.type=l.buffer.dtype,l.offset=0,l.stride=0,l.divisor=0,l.state=1,a[h]=1):f.getBuffer(n)?(l.buffer=f.getBuffer(n),l.size=0|l.buffer.dimension,l.normalized=!1,l.type=l.buffer.dtype,l.offset=0,l.stride=0,l.divisor=0,l.state=1):f.getBuffer(n.buffer)?(l.buffer=f.getBuffer(n.buffer),l.size=0|(+n.size||l.buffer.dimension),l.normalized=!!n.normalized||!1,l.type="type"in n?Ja[n.type]:l.buffer.dtype,l.offset=0|(n.offset||0),l.stride=0|(n.stride||0),l.divisor=0|(n.divisor||0),l.state=1):"x"in n&&(l.x=+n.x||0,l.y=+n.y||0,l.z=+n.z||0,l.w=+n.w||0,l.state=2)}for(m=0;m<c.buffers.length;++m)!a[m]&&c.buffers[m]&&(c.buffers[m].destroy(),c.buffers[m]=null);return c.refresh(),b}var c=new v;return d.vaoCount+=1,b.destroy=function(){for(var a=0;a<c.buffers.length;++a)c.buffers[a]&&c.buffers[a].destroy();c.buffers.length=0,c.ownsElements&&(c.elements.destroy(),c.elements=null,c.ownsElements=!1),c.destroy()},b._vao=c,b._reglType="vao",b(a)},getVAO:function(a){return"function"==typeof a&&a._vao?a._vao:null},destroyBuffer:function(b){for(var c=0;c<m.length;++c){var d=m[c];d.buffer===b&&(a.disableVertexAttribArray(c),d.buffer=null)}},setVAO:b.oes_vertex_array_object?p:u,clear:b.oes_vertex_array_object?l:function(){}};return v.prototype.bindAttrs=function(){for(var c=b.angle_instanced_arrays,d=this.attributes,f=0;f<d.length;++f){var g=d[f];g.buffer?(a.enableVertexAttribArray(f),a.bindBuffer(34962,g.buffer.buffer),a.vertexAttribPointer(f,g.size,g.type,g.normalized,g.stride,g.offset),c&&g.divisor&&c.vertexAttribDivisorANGLE(f,g.divisor)):(a.disableVertexAttribArray(f),a.vertexAttrib4f(f,g.x,g.y,g.z,g.w))}for(c=d.length;c<w;++c)a.disableVertexAttribArray(c);(c=e.getElements(this.elements))?a.bindBuffer(34963,c.buffer.buffer):a.bindBuffer(34963,null)},v.prototype.refresh=function(){var a=b.oes_vertex_array_object;a&&(a.bindVertexArrayOES(this.vao),this.bindAttrs(),t.currentVAO=null,a.bindVertexArrayOES(null))},v.prototype.destroy=function(){if(this.vao){var a=b.oes_vertex_array_object;this===t.currentVAO&&(t.currentVAO=null,a.bindVertexArrayOES(null)),a.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),g[this.id]&&(delete g[this.id],--d.vaoCount)},t}function Sb(a,b,c,d){function f(a,b,c,d){this.name=a,this.id=b,this.location=c,this.info=d}function e(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id)return void(a[c].location=b.location);a.push(b)}function k(c,d,e){if(!(f=(e=35632===c?l:v)[d])){var m=b.str(d),f=a.createShader(c);a.shaderSource(f,m),a.compileShader(f),e[d]=f}return f}function p(a,b){this.id=m++,this.fragId=a,this.vertId=b,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,d.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function u(c,g,l){var m;m=k(35632,c.fragId);var p=k(35633,c.vertId);if(g=c.program=a.createProgram(),a.attachShader(g,m),a.attachShader(g,p),l)for(m=0;m<l.length;++m)a.bindAttribLocation(g,(p=l[m])[0],p[1]);a.linkProgram(g),p=a.getProgramParameter(g,35718),d.profile&&(c.stats.uniformsCount=p);var r=c.uniforms;for(m=0;m<p;++m)if(l=a.getActiveUniform(g,m)){if(1<l.size)for(var u=0;u<l.size;++u){var v=l.name.replace("[0]","["+u+"]");e(r,new f(v,b.id(v),a.getUniformLocation(g,v),l))}u=l.name,1<l.size&&(u=u.replace("[0]","")),e(r,new f(u,b.id(u),a.getUniformLocation(g,u),l))}for(p=a.getProgramParameter(g,35721),d.profile&&(c.stats.attributesCount=p),c=c.attributes,m=0;m<p;++m)(l=a.getActiveAttrib(g,m))&&e(c,new f(l.name,b.id(l.name),a.getAttribLocation(g,l.name),l))}var l={},v={},r={},w=[],m=0;return d.profile&&(c.getMaxUniformsCount=function(){var a=0;return w.forEach((function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)})),a},c.getMaxAttributesCount=function(){var a=0;return w.forEach((function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)})),a}),{clear:function(){var b=a.deleteShader.bind(a);J(l).forEach(b),l={},J(v).forEach(b),v={},w.forEach((function(b){a.deleteProgram(b.program)})),w.length=0,r={},c.shaderCount=0},program:function(b,d,e,f){var m=r[d];m||(m=r[d]={});var q=m[b];if(q&&(q.refCount++,!f))return q;var k=new p(d,b);return c.shaderCount++,u(k,e,f),q||(m[b]=k),w.push(k),K(k,{destroy:function(){if(k.refCount--,0>=k.refCount){a.deleteProgram(k.program);var b=w.indexOf(k);w.splice(b,1),c.shaderCount--}0>=m[k.vertId].refCount&&(a.deleteShader(v[k.vertId]),delete v[k.vertId],delete r[k.fragId][k.vertId]),Object.keys(r[k.fragId]).length||(a.deleteShader(l[k.fragId]),delete l[k.fragId],delete r[k.fragId])}})},restore:function(){l={},v={};for(var a=0;a<w.length;++a)u(w[a],null,w[a].attributes.map((function(a){return[a.location,a.name]})))},shader:k,frag:-1,vert:-1}}function Tb(a,b,c,d,f,e,k){function p(e){var f;f=null===b.next?5121:b.next.colorAttachments[0].texture._texture.type;var p=0,k=0,m=d.framebufferWidth,h=d.framebufferHeight,g=null;return P(e)?g=e:e&&(p=0|e.x,k=0|e.y,m=0|(e.width||d.framebufferWidth-p),h=0|(e.height||d.framebufferHeight-k),g=e.data||null),c(),e=m*h*4,g||(5121===f?g=new Uint8Array(e):5126===f&&(g=g||new Float32Array(e))),a.pixelStorei(3333,4),a.readPixels(p,k,m,h,6408,f,g),g}function u(a){var c;return b.setFBO({framebuffer:a.framebuffer},(function(){c=p(a)})),c}return function(a){return a&&"framebuffer"in a?u(a):p(a)}}function Ca(a){return Array.prototype.slice.call(a)}function Da(a){return Ca(a).join("")}function Ub(){function a(){var a=[],b=[];return K((function(){a.push.apply(a,Ca(arguments))}),{def:function(){var d="v"+c++;return b.push(d),0<arguments.length&&(a.push(d,"="),a.push.apply(a,Ca(arguments)),a.push(";")),d},toString:function(){return Da([0<b.length?"var "+b.join(",")+";":"",Da(a)])}})}function b(){function b(a,e){d(a,e,"=",c.def(a,e),";")}var c=a(),d=a(),e=c.toString,f=d.toString;return K((function(){c.apply(c,Ca(arguments))}),{def:c.def,entry:c,exit:d,save:b,set:function(a,d,e){b(a,d),c(a,d,"=",e,";")},toString:function(){return e()+f()}})}var c=0,d=[],f=[],e=a(),k={};return{global:e,link:function(a){for(var b=0;b<f.length;++b)if(f[b]===a)return d[b];return b="g"+c++,d.push(b),f.push(a),b},block:a,proc:function(a,c){function d(){var a="a"+e.length;return e.push(a),a}var e=[];c=c||0;for(var f=0;f<c;++f)d();var w=(f=b()).toString;return k[a]=K(f,{arg:d,toString:function(){return Da(["function(",e.join(),"){",w(),"}"])}})},scope:b,cond:function(){var a=Da(arguments),c=b(),d=b(),e=c.toString,f=d.toString;return K(c,{then:function(){return c.apply(c,Ca(arguments)),this},else:function(){return d.apply(d,Ca(arguments)),this},toString:function(){var b=f();return b&&(b="else{"+b+"}"),Da(["if(",a,"){",e(),"}",b])}})},compile:function(){var a=['"use strict";',e,"return {"];Object.keys(k).forEach((function(b){a.push('"',b,'":',k[b].toString(),",")})),a.push("}");var b=Da(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,d.concat(b)).apply(null,f)}}}function Sa(a){return Array.isArray(a)||P(a)||ja(a)}function yb(a){return a.sort((function(a,c){return"viewport"===a?-1:"viewport"===c?1:a<c?-1:1}))}function H(a,b,c,d){this.thisDep=a,this.contextDep=b,this.propDep=c,this.append=d}function xa(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function B(a){return new H(!1,!1,!1,a)}function L(a,b){var c=a.type;if(0===c)return new H(!0,1<=(c=a.data.length),2<=c,b);if(4===c)return new H((c=a.data).thisDep,c.contextDep,c.propDep,b);if(5===c)return new H(!1,!1,!1,b);if(6===c){for(var d=c=!1,f=!1,e=0;e<a.data.length;++e){var k=a.data[e];1===k.type?f=!0:2===k.type?d=!0:3===k.type?c=!0:0===k.type?(c=!0,1<=(k=k.data)&&(d=!0),2<=k&&(f=!0)):4===k.type&&(c=c||k.data.thisDep,d=d||k.data.contextDep,f=f||k.data.propDep)}return new H(c,d,f,b)}return new H(3===c,2===c,1===c,b)}function Vb(a,b,c,d,f,e,k,p,u,l,v,r,w,m,h){function g(a){return a.replace(".","_")}function t(a,b,c){var d=g(a);Na.push(a),Fa[d]=ua[d]=!!c,va[d]=b}function n(a,b,c){var d=g(a);Na.push(a),Array.isArray(c)?(ua[d]=c.slice(),Fa[d]=c.slice()):ua[d]=Fa[d]=c,wa[d]=b}function C(){var a=Ub(),c=a.link,d=a.global;a.id=ta++,a.batchId="0";var e=c(tb),f=a.shared={props:"a0"};Object.keys(tb).forEach((function(a){f[a]=d.def(e,".",a)}));var g=a.next={},da=a.current={};Object.keys(wa).forEach((function(a){Array.isArray(ua[a])&&(g[a]=d.def(f.next,".",a),da[a]=d.def(f.current,".",a))}));var y=a.constants={};Object.keys(Pa).forEach((function(a){y[a]=d.def(JSON.stringify(Pa[a]))})),a.invoke=function(b,d){switch(d.type){case 0:var e=["this",f.context,f.props,a.batchId];return b.def(c(d.data),".call(",e.slice(0,Math.max(d.data.length+1,4)),")");case 1:return b.def(f.props,d.data);case 2:return b.def(f.context,d.data);case 3:return b.def("this",d.data);case 4:return d.data.append(a,b),d.data.ref;case 5:return d.data.toString();case 6:return d.data.map((function(c){return a.invoke(b,c)}))}},a.attribCache={};var aa={};return a.scopeAttrib=function(a){if((a=b.id(a))in aa)return aa[a];var d=l.scope[a];return d||(d=l.scope[a]=new ea),aa[a]=c(d)},a}function q(a){var c,b=a.static;if(a=a.dynamic,"profile"in b){var d=!!b.profile;(c=B((function(a,b){return d}))).enable=d}else if("profile"in a){var e=a.profile;c=L(e,(function(a,b){return a.invoke(b,e)}))}return c}function D(a,b){var c=a.static,d=a.dynamic;if("framebuffer"in c){var e=c.framebuffer;return e?(e=p.getFramebuffer(e),B((function(a,b){var c=a.link(e),d=a.shared;return b.set(d.framebuffer,".next",c),b.set(d=d.context,".framebufferWidth",c+".width"),b.set(d,".framebufferHeight",c+".height"),c}))):B((function(a,b){var c=a.shared;return b.set(c.framebuffer,".next","null"),b.set(c=c.context,".framebufferWidth",c+".drawingBufferWidth"),b.set(c,".framebufferHeight",c+".drawingBufferHeight"),"null"}))}if("framebuffer"in d){var f=d.framebuffer;return L(f,(function(a,b){var c=a.invoke(b,f),d=a.shared,e=d.framebuffer;return c=b.def(e,".getFramebuffer(",c,")"),b.set(e,".next",c),b.set(d=d.context,".framebufferWidth",c+"?"+c+".width:"+d+".drawingBufferWidth"),b.set(d,".framebufferHeight",c+"?"+c+".height:"+d+".drawingBufferHeight"),c}))}return null}function G(a,b,c){function d(a){if(a in e){var c=e[a];a=!0;var h,da,x=0|c.x,g=0|c.y;return"width"in c?h=0|c.width:a=!1,"height"in c?da=0|c.height:a=!1,new H(!a&&b&&b.thisDep,!a&&b&&b.contextDep,!a&&b&&b.propDep,(function(a,b){var d=a.shared.context,e=h;"width"in c||(e=b.def(d,".","framebufferWidth","-",x));var f=da;return"height"in c||(f=b.def(d,".","framebufferHeight","-",g)),[x,g,e,f]}))}if(a in f){var ha=f[a];return a=L(ha,(function(a,b){var c=a.invoke(b,ha),d=a.shared.context,e=b.def(c,".x|0"),f=b.def(c,".y|0");return[e,f,b.def('"width" in ',c,"?",c,".width|0:","(",d,".","framebufferWidth","-",e,")"),c=b.def('"height" in ',c,"?",c,".height|0:","(",d,".","framebufferHeight","-",f,")")]})),b&&(a.thisDep=a.thisDep||b.thisDep,a.contextDep=a.contextDep||b.contextDep,a.propDep=a.propDep||b.propDep),a}return b?new H(b.thisDep,b.contextDep,b.propDep,(function(a,b){var c=a.shared.context;return[0,0,b.def(c,".","framebufferWidth"),b.def(c,".","framebufferHeight")]})):null}var e=a.static,f=a.dynamic;if(a=d("viewport")){var g=a;a=new H(a.thisDep,a.contextDep,a.propDep,(function(a,b){var c=g.append(a,b),d=a.shared.context;return b.set(d,".viewportWidth",c[2]),b.set(d,".viewportHeight",c[3]),c}))}return{viewport:a,scissor_box:d("scissor.box")}}function P(a,b){if("string"==typeof(c=a.static).frag&&"string"==typeof c.vert){if(0<Object.keys(b.dynamic).length)return null;var c=b.static,d=Object.keys(c);if(0<d.length&&"number"==typeof c[d[0]]){for(var e=[],f=0;f<d.length;++f)e.push([0|c[d[f]],d[f]]);return e}}return null}function I(a,c,d){function e(a){if(a in f){var c=b.id(f[a]);return(a=B((function(){return c}))).id=c,a}if(a in g){var d=g[a];return L(d,(function(a,b){var c=a.invoke(b,d);return b.def(a.shared.strings,".id(",c,")")}))}return null}var f=a.static,g=a.dynamic,h=e("frag"),y=e("vert"),aa=null;return xa(h)&&xa(y)?(aa=v.program(y.id,h.id,null,d),a=B((function(a,b){return a.link(aa)}))):a=new H(h&&h.thisDep||y&&y.thisDep,h&&h.contextDep||y&&y.contextDep,h&&h.propDep||y&&y.propDep,(function(a,b){var d,e,c=a.shared.shader;return d=h?h.append(a,b):b.def(c,".","frag"),e=y?y.append(a,b):b.def(c,".","vert"),b.def(c+".program("+e+","+d+")")})),{frag:h,vert:y,progVar:a,program:aa}}function M(a,b){function c(a,b){if(a in d){var e=0|d[a];return b?g.offset=e:g.instances=e,B((function(a,c){return b&&(a.OFFSET=e),e}))}if(a in f){var x=f[a];return L(x,(function(a,c){var d=a.invoke(c,x);return b&&(a.OFFSET=d),d}))}if(b){if(aa)return B((function(a,b){return a.OFFSET=0}));if(h)return new H(y.thisDep,y.contextDep,y.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.vao+".currentVAO.offset:0")}))}else if(h)return new H(y.thisDep,y.contextDep,y.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.vao+".currentVAO.instances:-1")}));return null}var d=a.static,f=a.dynamic,g={},h=!1,y=function(){if("vao"in d){var a=d.vao;return null!==a&&null===l.getVAO(a)&&(a=l.createVAO(a)),h=!0,g.vao=a,B((function(b){var c=l.getVAO(a);return c?b.link(c):"null"}))}if("vao"in f){h=!0;var b=f.vao;return L(b,(function(a,c){var d=a.invoke(c,b);return c.def(a.shared.vao+".getVAO("+d+")")}))}return null}(),aa=!1,X=function(){if("elements"in d){if(g.elements=a=d.elements,Sa(a)){var b=g.elements=e.create(a,!0),a=e.getElements(b);aa=!0}else a&&(a=e.getElements(a),aa=!0);return b=B((function(b,c){if(a){var d=b.link(a);return b.ELEMENTS=d}return b.ELEMENTS=null})),b.value=a,b}if("elements"in f){aa=!0;var c=f.elements;return L(c,(function(a,b){var e=(d=a.shared).isBufferArgs,d=d.elements,f=a.invoke(b,c),x=b.def("null");return e=b.def(e,"(",f,")"),f=a.cond(e).then(x,"=",d,".createStream(",f,");").else(x,"=",d,".getElements(",f,");"),b.entry(f),b.exit(a.cond(e).then(d,".destroyStream(",x,");")),a.ELEMENTS=x}))}return h?new H(y.thisDep,y.contextDep,y.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.elements+".getElements("+a.shared.vao+".currentVAO.elements):null")})):null}(),ya=c("offset",!0),m=function(){if("primitive"in d){var a=d.primitive;return g.primitive=a,B((function(b,c){return Ka[a]}))}if("primitive"in f){var b=f.primitive;return L(b,(function(a,c){var d=a.constants.primTypes,e=a.invoke(c,b);return c.def(d,"[",e,"]")}))}return aa?xa(X)?B(X.value?function(a,b){return b.def(a.ELEMENTS,".primType")}:function(){return 4}):new H(X.thisDep,X.contextDep,X.propDep,(function(a,b){var c=a.ELEMENTS;return b.def(c,"?",c,".primType:",4)})):h?new H(y.thisDep,y.contextDep,y.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.vao+".currentVAO.primitive:4")})):null}(),n=function(){if("count"in d){var a=0|d.count;return g.count=a,B((function(){return a}))}if("count"in f){var b=f.count;return L(b,(function(a,c){return a.invoke(c,b)}))}return aa?xa(X)?X?ya?new H(ya.thisDep,ya.contextDep,ya.propDep,(function(a,b){return b.def(a.ELEMENTS,".vertCount-",a.OFFSET)})):B((function(a,b){return b.def(a.ELEMENTS,".vertCount")})):B((function(){return-1})):new H(X.thisDep||ya.thisDep,X.contextDep||ya.contextDep,X.propDep||ya.propDep,(function(a,b){var c=a.ELEMENTS;return a.OFFSET?b.def(c,"?",c,".vertCount-",a.OFFSET,":-1"):b.def(c,"?",c,".vertCount:-1")})):h?new H(y.thisDep,y.contextDep,y.propDep,(function(a,b){return b.def(a.shared.vao,".currentVAO?",a.shared.vao,".currentVAO.count:-1")})):null}(),k=c("instances",!1);return{elements:X,primitive:m,count:n,instances:k,offset:ya,vao:y,vaoActive:h,elementsActive:aa,static:g}}function E(a,b){var c=a.static,d=a.dynamic,e={};return Na.forEach((function(a){function b(x,g){if(a in c){var O=x(c[a]);e[f]=B((function(){return O}))}else if(a in d){var h=d[a];e[f]=L(h,(function(a,b){return g(a,b,a.invoke(b,h))}))}}var f=g(a);switch(a){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":case"lineWidth":return b((function(a){return a}),(function(a,b,c){return c}));case"depth.func":return b((function(a){return ab[a]}),(function(a,b,c){return b.def(a.constants.compareFuncs,"[",c,"]")}));case"depth.range":return b((function(a){return a}),(function(a,b,c){return[b.def("+",c,"[0]"),b=b.def("+",c,"[1]")]}));case"blend.func":return b((function(a){return[Ga["srcRGB"in a?a.srcRGB:a.src],Ga["dstRGB"in a?a.dstRGB:a.dst],Ga["srcAlpha"in a?a.srcAlpha:a.src],Ga["dstAlpha"in a?a.dstAlpha:a.dst]]}),(function(a,b,c){function d(a,e){return b.def('"',a,e,'" in ',c,"?",c,".",a,e,":",c,".",a)}a=a.constants.blendFuncs;var e=d("src","RGB"),f=d("dst","RGB"),x=(e=b.def(a,"[",e,"]"),b.def(a,"[",d("src","Alpha"),"]"));return[e,f=b.def(a,"[",f,"]"),x,a=b.def(a,"[",d("dst","Alpha"),"]")]}));case"blend.equation":return b((function(a){return"string"==typeof a?[fa[a],fa[a]]:"object"==typeof a?[fa[a.rgb],fa[a.alpha]]:void 0}),(function(a,b,c){var d=a.constants.blendEquations,e=b.def(),f=b.def();return(a=a.cond("typeof ",c,'==="string"')).then(e,"=",f,"=",d,"[",c,"];"),a.else(e,"=",d,"[",c,".rgb];",f,"=",d,"[",c,".alpha];"),b(a),[e,f]}));case"blend.color":return b((function(a){return S(4,(function(b){return+a[b]}))}),(function(a,b,c){return S(4,(function(a){return b.def("+",c,"[",a,"]")}))}));case"stencil.mask":return b((function(a){return 0|a}),(function(a,b,c){return b.def(c,"|0")}));case"stencil.func":return b((function(a){return[ab[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]}),(function(a,b,c){return[a=b.def('"cmp" in ',c,"?",a.constants.compareFuncs,"[",c,".cmp]",":",7680),b.def(c,".ref|0"),b=b.def('"mask" in ',c,"?",c,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return b((function(b){return["stencil.opBack"===a?1029:1028,Ta[b.fail||"keep"],Ta[b.zfail||"keep"],Ta[b.zpass||"keep"]]}),(function(b,c,d){function e(a){return c.def('"',a,'" in ',d,"?",f,"[",d,".",a,"]:",7680)}var f=b.constants.stencilOps;return["stencil.opBack"===a?1029:1028,e("fail"),e("zfail"),e("zpass")]}));case"polygonOffset.offset":return b((function(a){return[0|a.factor,0|a.units]}),(function(a,b,c){return[b.def(c,".factor|0"),b=b.def(c,".units|0")]}));case"cull.face":return b((function(a){var b=0;return"front"===a?b=1028:"back"===a&&(b=1029),b}),(function(a,b,c){return b.def(c,'==="front"?',1028,":",1029)}));case"frontFace":return b((function(a){return zb[a]}),(function(a,b,c){return b.def(c+'==="cw"?2304:2305')}));case"colorMask":return b((function(a){return a.map((function(a){return!!a}))}),(function(a,b,c){return S(4,(function(a){return"!!"+c+"["+a+"]"}))}));case"sample.coverage":return b((function(a){return["value"in a?a.value:1,!!a.invert]}),(function(a,b,c){return[b.def('"value" in ',c,"?+",c,".value:1"),b=b.def("!!",c,".invert")]}))}})),e}function ba(a,b){var c=a.static,d=a.dynamic,e={};return Object.keys(c).forEach((function(a){var d,b=c[a];if("number"==typeof b||"boolean"==typeof b)d=B((function(){return b}));else if("function"==typeof b){var f=b._reglType;"texture2d"===f||"textureCube"===f?d=B((function(a){return a.link(b)})):"framebuffer"!==f&&"framebufferCube"!==f||(d=B((function(a){return a.link(b.color[0])})))}else ra(b)&&(d=B((function(a){return a.global.def("[",S(b.length,(function(a){return b[a]})),"]")})));d.value=b,e[a]=d})),Object.keys(d).forEach((function(a){var b=d[a];e[a]=L(b,(function(a,c){return a.invoke(c,b)}))})),e}function R(a,c){var d=a.static,e=a.dynamic,g={};return Object.keys(d).forEach((function(a){var c=d[a],e=b.id(a),x=new ea;if(Sa(c))x.state=1,x.buffer=f.getBuffer(f.create(c,34962,!1,!0)),x.type=0;else if(h=f.getBuffer(c))x.state=1,x.buffer=h,x.type=0;else if("constant"in c){var O=c.constant;x.buffer="null",x.state=2,"number"==typeof O?x.x=O:Ea.forEach((function(a,b){b<O.length&&(x[a]=O[b])}))}else{var h=Sa(c.buffer)?f.getBuffer(f.create(c.buffer,34962,!1,!0)):f.getBuffer(c.buffer),l=0|c.offset,m=0|c.stride,n=0|c.size,k=!!c.normalized,oa=0;"type"in c&&(oa=Ja[c.type]),c=0|c.divisor,x.buffer=h,x.state=1,x.size=n,x.normalized=k,x.type=oa||h.dtype,x.offset=l,x.stride=m,x.divisor=c}g[a]=B((function(a,b){var c=a.attribCache;if(e in c)return c[e];var d={isStream:!1};return Object.keys(x).forEach((function(a){d[a]=x[a]})),x.buffer&&(d.buffer=a.link(x.buffer),d.type=d.type||d.buffer+".dtype"),c[e]=d}))})),Object.keys(e).forEach((function(a){var b=e[a];g[a]=L(b,(function(a,c){function d(a){c(h[a],"=",e,".",a,"|0;")}var e=a.invoke(c,b),x=a.constants,g=(f=a.shared).isBufferArgs,f=f.buffer,h={isStream:c.def(!1)},O=new ea;O.state=1,Object.keys(O).forEach((function(a){h[a]=c.def(""+O[a])}));var l=h.buffer,m=h.type;return c("if(",g,"(",e,")){",h.isStream,"=true;",l,"=",f,".createStream(",34962,",",e,");",m,"=",l,".dtype;","}else{",l,"=",f,".getBuffer(",e,");","if(",l,"){",m,"=",l,".dtype;",'}else if("constant" in ',e,"){",h.state,"=",2,";","if(typeof "+e+'.constant === "number"){',h[Ea[0]],"=",e,".constant;",Ea.slice(1).map((function(a){return h[a]})).join("="),"=0;","}else{",Ea.map((function(a,b){return h[a]+"="+e+".constant.length>"+b+"?"+e+".constant["+b+"]:0;"})).join(""),"}}else{","if(",g,"(",e,".buffer)){",l,"=",f,".createStream(",34962,",",e,".buffer);","}else{",l,"=",f,".getBuffer(",e,".buffer);","}",m,'="type" in ',e,"?",x.glTypes,"[",e,".type]:",l,".dtype;",h.normalized,"=!!",e,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),c("}}"),c.exit("if(",h.isStream,"){",f,".destroyStream(",l,");","}"),h}))})),g}function z(a){var b=a.static,c=a.dynamic,d={};return Object.keys(b).forEach((function(a){var c=b[a];d[a]=B((function(a,b){return"number"==typeof c||"boolean"==typeof c?""+c:a.link(c)}))})),Object.keys(c).forEach((function(a){var b=c[a];d[a]=L(b,(function(a,c){return a.invoke(c,b)}))})),d}function A(a,b,d,e,f){function h(a){var b=n[a];b&&(k[a]=b)}var m=P(a,b),n=G(a,y=D(a)),X=M(a),k=E(a),p=I(a,f,m);h("viewport"),h(g("scissor.box"));var y,r=0<Object.keys(k).length;if((y={framebuffer:y,draw:X,shader:p,state:k,dirty:r,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}}).profile=q(a),y.uniforms=ba(d),y.drawVAO=y.scopeVAO=X.vao,!y.drawVAO&&p.program&&!m&&c.angle_instanced_arrays&&X.static.elements){var t=!0;if(a=p.program.attributes.map((function(a){return a=b.static[a],t=t&&!!a,a})),t&&0<a.length){var v=l.getVAO(l.createVAO({attributes:a,elements:X.static.elements}));y.drawVAO=new H(null,null,null,(function(a,b){return a.link(v)})),y.useVAO=!0}}return m?y.useVAO=!0:y.attributes=R(b),y.context=z(e),y}function ia(a,b,c){var d=a.shared.context,e=a.scope();Object.keys(c).forEach((function(f){b.save(d,"."+f);var g=c[f].append(a,b);Array.isArray(g)?e(d,".",f,"=[",g.join(),"];"):e(d,".",f,"=",g,";")})),b(e)}function Q(a,b,c,d){var h,f=(e=a.shared).gl,g=e.framebuffer;Ma&&(h=b.def(e.extensions,".webgl_draw_buffers"));var e=(l=a.constants).drawBuffer,l=l.backBuffer;a=c?c.append(a,b):b.def(g,".next"),d||b("if(",a,"!==",g,".cur){"),b("if(",a,"){",f,".bindFramebuffer(",36160,",",a,".framebuffer);"),Ma&&b(h,".drawBuffersWEBGL(",e,"[",a,".colorAttachments.length]);"),b("}else{",f,".bindFramebuffer(",36160,",null);"),Ma&&b(h,".drawBuffersWEBGL(",l,");"),b("}",g,".cur=",a,";"),d||b("}")}function Aa(a,b,c){var d=a.shared,e=d.gl,f=a.current,h=a.next,l=d.current,m=d.next,k=a.cond(l,".dirty");Na.forEach((function(b){var d,O;if(!((b=g(b))in c.state))if(b in h){d=h[b],O=f[b];var n=S(ua[b].length,(function(a){return k.def(d,"[",a,"]")}));k(a.cond(n.map((function(a,b){return a+"!=="+O+"["+b+"]"})).join("||")).then(e,".",wa[b],"(",n,");",n.map((function(a,b){return O+"["+b+"]="+a})).join(";"),";"))}else d=k.def(m,".",b),n=a.cond(d,"!==",l,".",b),k(n),b in va?n(a.cond(d).then(e,".enable(",va[b],");").else(e,".disable(",va[b],");"),l,".",b,"=",d,";"):n(e,".",wa[b],"(",d,");",l,".",b,"=",d,";")})),0===Object.keys(c.state).length&&k(l,".dirty=false;"),b(k)}function J(a,b,c,d){var e=a.shared,f=a.current,g=e.current,h=e.gl;yb(Object.keys(c)).forEach((function(e){var l=c[e];if(!d||d(l)){var m=l.append(a,b);if(va[e]){var k=va[e];xa(l)?b(h,m?".enable(":".disable(",k,");"):b(a.cond(m).then(h,".enable(",k,");").else(h,".disable(",k,");")),b(g,".",e,"=",m,";")}else if(ra(m)){var n=f[e];b(h,".",wa[e],"(",m,");",m.map((function(a,b){return n+"["+b+"]="+a})).join(";"),";")}else b(h,".",wa[e],"(",m,");",g,".",e,"=",m,";")}}))}function N(a,b){V&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function F(a,b,c,d,e){function f(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function g(a){a(q=b.def(),"=",f(),";"),"string"==typeof e?a(n,".count+=",e,";"):a(n,".count++;"),m&&(d?a(t=b.def(),"=",r,".getNumPendingQueries();"):a(r,".beginQuery(",n,");"))}function h(a){a(n,".cpuTime+=",f(),"-",q,";"),m&&(d?a(r,".pushScopeStats(",t,",",r,".getNumPendingQueries(),",n,");"):a(r,".endQuery();"))}function l(a){var c=b.def(p,".profile");b(p,".profile=",a,";"),b.exit(p,".profile=",c,";")}var q,t,k=a.shared,n=a.stats,p=k.current,r=k.timer;if(c=c.profile){if(xa(c))return void(c.enable?(g(b),h(b.exit),l("true")):l("false"));l(c=c.append(a,b))}else c=b.def(p,".profile");g(k=a.block()),b("if(",c,"){",k,"}"),h(a=a.block()),b.exit("if(",c,"){",a,"}")}function ga(a,b,c,d,e){function f(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function g(c,d,e){function f(){b(m,".enableVertexAttribArray(",k,");");var g,c=e.type;g=e.size?b.def(e.size,"||",d):d,b(m,".bindBuffer(",34962,",",p,".buffer);",m,".vertexAttribPointer(",[k,g,c,e.normalized,e.stride,e.offset],");",n,".type=",c,";",n,".size=",g,";",ha.map((function(a){return n+"."+a+"="+e[a]+";"})).join("")),V&&b("if(",n,".divisor!==",c=e.divisor,"){",a.instancing,".vertexAttribDivisorANGLE(",[k,c],");",n,".divisor=",c,";}")}function l(){b("if(",n,".buffer){",m,".disableVertexAttribArray(",k,");",n,".buffer=null;","}if(",Ea.map((function(a,b){return n+"."+a+"!=="+r[b]})).join("||"),"){",m,".vertexAttrib4f(",k,",",r,");",Ea.map((function(a,b){return n+"."+a+"="+r[b]+";"})).join(""),"}")}var m=h.gl,k=b.def(c,".location"),n=b.def(h.attributes,"[",k,"]"),p=e.buffer,r=[e.x,e.y,e.z,e.w],ha=["buffer","normalized","offset","stride"];1===(c=e.state)?f():2===c?l():(b("if(",c,"===",1,"){"),f(),b("}else{"),l(),b("}"))}var h=a.shared;d.forEach((function(d){var m,h=d.name,l=c.attributes[h];if(l){if(!e(l))return;m=l.append(a,b)}else{if(!e(Ab))return;var k=a.scopeAttrib(h);m={},Object.keys(new ea).forEach((function(a){m[a]=b.def(k,".",a)}))}g(a.link(d),f(d.info.type),m)}))}function T(a,c,d,e,f,g){for(var k,h=a.shared,l=h.gl,m={},n=0;n<e.length;++n){var r=(p=e[n]).name,q=p.info.type,v=d.uniforms[r];if(1<(t=p.info.size)){if(!v)continue;var u=r.replace("[0]","");if(m[u])continue;m[u]=1}var w,p=a.link(p)+".location";if(v){if(!f(v))continue;if(xa(v)){if(r=v.value,35678===q||35680===q)c(l,".uniform1i(",p,",",(q=a.link(r._texture||r.color[0]._texture))+".bind());"),c.exit(q,".unbind();");else if(35674===q||35675===q||35676===q)t=a.global.def("new Float32Array(["+Array.prototype.slice.call(r)+"])"),r=2,35675===q?r=3:35676===q&&(r=4),c(l,".uniformMatrix",r,"fv(",p,",false,",t,");");else{switch(q){case 5126:k="1f";break;case 35664:k="2f";break;case 35665:k="3f";break;case 35666:k="4f";break;case 35670:case 5124:k="1i";break;case 35671:case 35667:k="2i";break;case 35672:case 35668:k="3i";break;case 35673:case 35669:k="4i"}1<t?(k+="v",r=a.global.def("["+Array.prototype.slice.call(r)+"]")):r=ra(r)?Array.prototype.slice.call(r):r,c(l,".uniform",k,"(",p,",",r,");")}continue}w=v.append(a,c)}else{if(!f(Ab))continue;w=c.def(h.uniforms,"[",b.id(r),"]")}switch(35678===q?c("if(",w,"&&",w,'._reglType==="framebuffer"){',w,"=",w,".color[0];","}"):35680===q&&c("if(",w,"&&",w,'._reglType==="framebufferCube"){',w,"=",w,".color[0];","}"),r=1,q){case 35678:case 35680:q=c.def(w,"._texture"),c(l,".uniform1i(",p,",",q,".bind());"),c.exit(q,".unbind();");continue;case 5124:case 35670:k="1i";break;case 35667:case 35671:k="2i",r=2;break;case 35668:case 35672:k="3i",r=3;break;case 35669:case 35673:k="4i",r=4;break;case 5126:k="1f";break;case 35664:k="2f",r=2;break;case 35665:k="3f",r=3;break;case 35666:k="4f",r=4;break;case 35674:k="Matrix2fv";break;case 35675:k="Matrix3fv";break;case 35676:k="Matrix4fv"}if(-1===k.indexOf("Matrix")&&1<t&&(k+="v",r=1),"M"===k.charAt(0)){c(l,".uniform",k,"(",p,","),p=Math.pow(q-35674+2,2);var C=a.global.def("new Float32Array(",p,")");Array.isArray(w)?c("false,(",S(p,(function(a){return C+"["+a+"]="+w[a]})),",",C,")"):c("false,(Array.isArray(",w,")||",w," instanceof Float32Array)?",w,":(",S(p,(function(a){return C+"["+a+"]="+w+"["+a+"]"})),",",C,")"),c(");")}else{if(1<r){q=[];for(var ma=[],t=0;t<r;++t)Array.isArray(w)?ma.push(w[t]):ma.push(c.def(w+"["+t+"]")),g&&q.push(c.def());g&&c("if(!",a.batchId,"||",q.map((function(a,b){return a+"!=="+ma[b]})).join("||"),"){",q.map((function(a,b){return a+"="+ma[b]+";"})).join("")),c(l,".uniform",k,"(",p,",",ma.join(","),");")}else g&&(q=c.def(),c("if(!",a.batchId,"||",q,"!==",w,"){",q,"=",w,";")),c(l,".uniform",k,"(",p,",",w,");");g&&c("}")}}}function W(a,b,c,d){function e(f){var g=m[f];return g?g.append(a,g.contextDep&&d.contextDynamic||g.propDep?c:b):b.def(k,".",f)}function f(){function a(){c(v,".drawElementsInstancedANGLE(",[r,q,w,p+"<<(("+w+"-5121)>>1)",t],");")}function b(){c(v,".drawArraysInstancedANGLE(",[r,p,q,t],");")}n&&"null"!==n?u?a():(c("if(",n,"){"),a(),c("}else{"),b(),c("}")):b()}function g(){function a(){c(l+".drawElements("+[r,q,w,p+"<<(("+w+"-5121)>>1)"]+");")}function b(){c(l+".drawArrays("+[r,p,q]+");")}n&&"null"!==n?u?a():(c("if(",n,"){"),a(),c("}else{"),b(),c("}")):b()}var t,v,h=a.shared,l=h.gl,k=h.draw,m=d.draw,n=function(){var e=m.elements,f=b;return e?((e.contextDep&&d.contextDynamic||e.propDep)&&(f=c),e=e.append(a,f),m.elementsActive&&f("if("+e+")"+l+".bindBuffer(34963,"+e+".buffer.buffer);")):(e=f.def(),f(e,"=",k,".","elements",";","if(",e,"){",l,".bindBuffer(",34963,",",e,".buffer.buffer);}","else if(",h.vao,".currentVAO){",e,"=",a.shared.elements+".getElements("+h.vao,".currentVAO.elements);",sa?"":"if("+e+")"+l+".bindBuffer(34963,"+e+".buffer.buffer);","}")),e}(),r=e("primitive"),p=e("offset"),q=function(){var e=m.count,f=b;return e?((e.contextDep&&d.contextDynamic||e.propDep)&&(f=c),e=e.append(a,f)):e=f.def(k,".","count"),e}();if("number"==typeof q){if(0===q)return}else c("if(",q,"){"),c.exit("}");V&&(t=e("instances"),v=a.instancing);var w=n+".type",u=m.elements&&xa(m.elements)&&!m.vaoActive;V&&("number"!=typeof t||0<=t)?"string"==typeof t?(c("if(",t,">0){"),f(),c("}else if(",t,"<0){"),g(),c("}")):f():g()}function ca(a,b,c,d,e){return e=(b=C()).proc("body",e),V&&(b.instancing=e.def(b.shared.extensions,".angle_instanced_arrays")),a(b,e,c,d),b.compile().body}function Z(a,b,c,d){N(a,b),c.useVAO?c.drawVAO?b(a.shared.vao,".setVAO(",c.drawVAO.append(a,b),");"):b(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(b(a.shared.vao,".setVAO(null);"),ga(a,b,c,d.attributes,(function(){return!0}))),T(a,b,c,d.uniforms,(function(){return!0}),!1),W(a,b,b,c)}function ma(a,b){var c=a.proc("draw",1);N(a,c),ia(a,c,b.context),Q(a,c,b.framebuffer),Aa(a,c,b),J(a,c,b.state),F(a,c,b,!1,!0);var d=b.shader.progVar.append(a,c);if(c(a.shared.gl,".useProgram(",d,".program);"),b.shader.program)Z(a,c,b,b.shader.program);else{c(a.shared.vao,".setVAO(null);");var e=a.global.def("{}"),f=c.def(d,".id"),g=c.def(e,"[",f,"]");c(a.cond(g).then(g,".call(this,a0);").else(g,"=",e,"[",f,"]=",a.link((function(c){return ca(Z,a,b,c,1)})),"(",d,");",g,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;"),a.shared.vao&&c(a.shared.vao,".setVAO(null);")}function pa(a,b,c,d){function e(){return!0}a.batchId="a1",N(a,b),ga(a,b,c,d.attributes,e),T(a,b,c,d.uniforms,e,!1),W(a,b,b,c)}function qa(a,b,c,d){function e(a){return a.contextDep&&g||a.propDep}function f(a){return!e(a)}N(a,b);var g=c.contextDep,h=b.def(),l=b.def();a.shared.props=l,a.batchId=h;var m=a.scope(),k=a.scope();b(m.entry,"for(",h,"=0;",h,"<","a1",";++",h,"){",l,"=","a0","[",h,"];",k,"}",m.exit),c.needsContext&&ia(a,k,c.context),c.needsFramebuffer&&Q(a,k,c.framebuffer),J(a,k,c.state,e),c.profile&&e(c.profile)&&F(a,k,c,!1,!0),d?(c.useVAO?c.drawVAO?e(c.drawVAO)?k(a.shared.vao,".setVAO(",c.drawVAO.append(a,k),");"):m(a.shared.vao,".setVAO(",c.drawVAO.append(a,m),");"):m(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(m(a.shared.vao,".setVAO(null);"),ga(a,m,c,d.attributes,f),ga(a,k,c,d.attributes,e)),T(a,m,c,d.uniforms,f,!1),T(a,k,c,d.uniforms,e,!0),W(a,m,k,c)):(b=a.global.def("{}"),d=c.shader.progVar.append(a,k),l=k.def(d,".id"),m=k.def(b,"[",l,"]"),k(a.shared.gl,".useProgram(",d,".program);","if(!",m,"){",m,"=",b,"[",l,"]=",a.link((function(b){return ca(pa,a,c,b,2)})),"(",d,");}",m,".call(this,a0[",h,"],",h,");"))}function U(a,b){function c(a){return a.contextDep&&e||a.propDep}var d=a.proc("batch",2);a.batchId="0",N(a,d);var e=!1,f=!0;Object.keys(b.context).forEach((function(a){e=e||b.context[a].propDep})),e||(ia(a,d,b.context),f=!1);var h=!1;if((g=b.framebuffer)?(g.propDep?e=h=!0:g.contextDep&&e&&(h=!0),h||Q(a,d,g)):Q(a,d,null),b.state.viewport&&b.state.viewport.propDep&&(e=!0),Aa(a,d,b),J(a,d,b.state,(function(a){return!c(a)})),b.profile&&c(b.profile)||F(a,d,b,!1,"a1"),b.contextDep=e,b.needsContext=f,b.needsFramebuffer=h,(f=b.shader.progVar).contextDep&&e||f.propDep)qa(a,d,b,null);else if(f=f.append(a,d),d(a.shared.gl,".useProgram(",f,".program);"),b.shader.program)qa(a,d,b,b.shader.program);else{d(a.shared.vao,".setVAO(null);");var g=a.global.def("{}"),l=(h=d.def(f,".id"),d.def(g,"[",h,"]"));d(a.cond(l).then(l,".call(this,a0,a1);").else(l,"=",g,"[",h,"]=",a.link((function(c){return ca(qa,a,b,c,2)})),"(",f,");",l,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;"),a.shared.vao&&d(a.shared.vao,".setVAO(null);")}function ja(a,c){function d(b){var g=c.shader[b];g&&e.set(f.shader,"."+b,g.append(a,e))}var e=a.proc("scope",3);a.batchId="a2";var f=a.shared,g=f.current;ia(a,e,c.context),c.framebuffer&&c.framebuffer.append(a,e),yb(Object.keys(c.state)).forEach((function(b){var d=c.state[b].append(a,e);ra(d)?d.forEach((function(c,d){e.set(a.next[b],"["+d+"]",c)})):e.set(f.next,"."+b,d)})),F(a,e,c,!0,!0),["elements","offset","count","instances","primitive"].forEach((function(b){var d=c.draw[b];d&&e.set(f.draw,"."+b,""+d.append(a,e))})),Object.keys(c.uniforms).forEach((function(d){var g=c.uniforms[d].append(a,e);Array.isArray(g)&&(g="["+g.join()+"]"),e.set(f.uniforms,"["+b.id(d)+"]",g)})),Object.keys(c.attributes).forEach((function(b){var d=c.attributes[b].append(a,e),f=a.scopeAttrib(b);Object.keys(new ea).forEach((function(a){e.set(f,"."+a,d[a])}))})),c.scopeVAO&&e.set(f.vao,".targetVAO",c.scopeVAO.append(a,e)),d("vert"),d("frag"),0<Object.keys(c.state).length&&(e(g,".dirty=true;"),e.exit(g,".dirty=true;")),e("a1(",a.shared.context,",a0,",a.batchId,");")}function la(a){if("object"==typeof a&&!ra(a)){for(var b=Object.keys(a),c=0;c<b.length;++c)if(Y.isDynamic(a[b[c]]))return!0;return!1}}function ka(a,b,c){function d(a,b){g.forEach((function(c){var d=e[c];Y.isDynamic(d)&&(d=a.invoke(b,d),b(k,".",c,"=",d,";"))}))}var e=b.static[c];if(e&&la(e)){var f=a.global,g=Object.keys(e),h=!1,l=!1,m=!1,k=a.global.def("{}");g.forEach((function(b){var c=e[b];if(Y.isDynamic(c))"function"==typeof c&&(c=e[b]=Y.unbox(c)),b=L(c,null),h=h||b.thisDep,m=m||b.propDep,l=l||b.contextDep;else{switch(f(k,".",b,"="),typeof c){case"number":f(c);break;case"string":f('"',c,'"');break;case"object":Array.isArray(c)&&f("[",c.join(),"]");break;default:f(a.link(c))}f(";")}})),b.dynamic[c]=new Y.DynamicVariable(4,{thisDep:h,contextDep:l,propDep:m,ref:k,append:d}),delete b.static[c]}}var ea=l.Record,fa={add:32774,subtract:32778,"reverse subtract":32779};c.ext_blend_minmax&&(fa.min=32775,fa.max=32776);var V=c.angle_instanced_arrays,Ma=c.webgl_draw_buffers,sa=c.oes_vertex_array_object,ua={dirty:!0,profile:h.profile},Fa={},Na=[],va={},wa={};t("dither",3024),t("blend.enable",3042),n("blend.color","blendColor",[0,0,0,0]),n("blend.equation","blendEquationSeparate",[32774,32774]),n("blend.func","blendFuncSeparate",[1,0,1,0]),t("depth.enable",2929,!0),n("depth.func","depthFunc",513),n("depth.range","depthRange",[0,1]),n("depth.mask","depthMask",!0),n("colorMask","colorMask",[!0,!0,!0,!0]),t("cull.enable",2884),n("cull.face","cullFace",1029),n("frontFace","frontFace",2305),n("lineWidth","lineWidth",1),t("polygonOffset.enable",32823),n("polygonOffset.offset","polygonOffset",[0,0]),t("sample.alpha",32926),t("sample.enable",32928),n("sample.coverage","sampleCoverage",[1,!1]),t("stencil.enable",2960),n("stencil.mask","stencilMask",-1),n("stencil.func","stencilFunc",[519,0,-1]),n("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),n("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),t("scissor.enable",3089),n("scissor.box","scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]),n("viewport","viewport",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var tb={gl:a,context:w,strings:b,next:Fa,current:ua,draw:r,elements:e,buffer:f,shader:v,attributes:l.state,vao:l,uniforms:u,framebuffer:p,extensions:c,timer:m,isBufferArgs:Sa},Pa={primTypes:Ka,compareFuncs:ab,blendFuncs:Ga,blendEquations:fa,stencilOps:Ta,glTypes:Ja,orientationType:zb};Ma&&(Pa.backBuffer=[1029],Pa.drawBuffer=S(d.maxDrawbuffers,(function(a){return 0===a?[0]:S(a,(function(a){return 36064+a}))})));var ta=0;return{next:Fa,current:ua,procs:function(){var a=C(),b=a.proc("poll"),e=a.proc("refresh"),f=a.block();b(f),e(f);var k,g=a.shared,h=g.gl,l=g.next,m=g.current;f(m,".dirty=false;"),Q(a,b),Q(a,e,null,!0),V&&(k=a.link(V)),c.oes_vertex_array_object&&e(a.link(c.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var n=0;n<d.maxAttributes;++n){var r=e.def(g.attributes,"[",n,"]"),q=a.cond(r,".buffer");q.then(h,".enableVertexAttribArray(",n,");",h,".bindBuffer(",34962,",",r,".buffer.buffer);",h,".vertexAttribPointer(",n,",",r,".size,",r,".type,",r,".normalized,",r,".stride,",r,".offset);").else(h,".disableVertexAttribArray(",n,");",h,".vertexAttrib4f(",n,",",r,".x,",r,".y,",r,".z,",r,".w);",r,".buffer=null;"),e(q),V&&e(k,".vertexAttribDivisorANGLE(",n,",",r,".divisor);")}return e(a.shared.vao,".currentVAO=null;",a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"),Object.keys(va).forEach((function(c){var d=va[c],g=f.def(l,".",c),k=a.block();k("if(",g,"){",h,".enable(",d,")}else{",h,".disable(",d,")}",m,".",c,"=",g,";"),e(k),b("if(",g,"!==",m,".",c,"){",k,"}")})),Object.keys(wa).forEach((function(c){var k,n,d=wa[c],g=ua[c],r=a.block();r(h,".",d,"("),ra(g)?(d=g.length,k=a.global.def(l,".",c),n=a.global.def(m,".",c),r(S(d,(function(a){return k+"["+a+"]"})),");",S(d,(function(a){return n+"["+a+"]="+k+"["+a+"];"})).join("")),b("if(",S(d,(function(a){return k+"["+a+"]!=="+n+"["+a+"]"})).join("||"),"){",r,"}")):(k=f.def(l,".",c),n=f.def(m,".",c),r(k,");",m,".",c,"=",k,";"),b("if(",k,"!==",n,"){",r,"}")),e(r)})),a.compile()}(),compile:function(a,b,c,d,e){var f=C();f.stats=f.link(e),Object.keys(b.static).forEach((function(a){ka(f,b,a)})),Wb.forEach((function(b){ka(f,a,b)}));var g=A(a,b,c,d,f);return ma(f,g),ja(f,g),U(f,g),K(f.compile(),{destroy:function(){g.shader.program.destroy()}})}}}function Bb(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var K=function(a,b){for(var c=Object.keys(b),d=0;d<c.length;++d)a[c[d]]=b[c[d]];return a},Db=0,Y={DynamicVariable:W,define:function(a,b){return new W(a,cb(b+""))},isDynamic:function(a){return"function"==typeof a&&!a._reglType||a instanceof W},unbox:db,accessor:cb},bb={next:"function"==typeof requestAnimationFrame?function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"==typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout},Cb="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},D=hb();D.zero=hb();var Xb=function(a,b){var c=1;b.ext_texture_filter_anisotropic&&(c=a.getParameter(34047));var d=1,f=1;b.webgl_draw_buffers&&(d=a.getParameter(34852),f=a.getParameter(36063));var e=!!b.oes_texture_float;if(e){e=a.createTexture(),a.bindTexture(3553,e),a.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var k=a.createFramebuffer();if(a.bindFramebuffer(36160,k),a.framebufferTexture2D(36160,36064,3553,e,0),a.bindTexture(3553,null),36053!==a.checkFramebufferStatus(36160))e=!1;else{a.viewport(0,0,1,1),a.clearColor(1,0,0,1),a.clear(16384);var p=D.allocType(5126,4);a.readPixels(0,0,1,1,6408,5126,p),a.getError()?e=!1:(a.deleteFramebuffer(k),a.deleteTexture(e),e=1===p[0]),D.freeType(p)}}return p=!0,"undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(p=a.createTexture(),k=D.allocType(5121,36),a.activeTexture(33984),a.bindTexture(34067,p),a.texImage2D(34069,0,6408,3,3,0,6408,5121,k),D.freeType(k),a.bindTexture(34067,null),a.deleteTexture(p),p=!a.getError()),{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter((function(a){return!!b[a]})),maxAnisotropic:c,maxDrawbuffers:d,maxColorAttachments:f,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938),readFloat:e,npotTextureCube:p}},P=function(a){return a instanceof Uint8Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Uint8ClampedArray},J=function(a){return Object.keys(a).map((function(b){return a[b]}))},Qa={shape:function(a){for(var b=[];a.length;a=a[0])b.push(a.length);return b},flatten:function(a,b,c,d){var f=1;if(b.length)for(var e=0;e<b.length;++e)f*=b[e];else f=0;switch(c=d||D.allocType(c,f),b.length){case 0:break;case 1:for(d=b[0],b=0;b<d;++b)c[b]=a[b];break;case 2:for(d=b[0],b=b[1],e=f=0;e<d;++e)for(var k=a[e],p=0;p<b;++p)c[f++]=k[p];break;case 3:ib(a,b[0],b[1],b[2],c,0);break;default:jb(a,b,0,c,0)}return c}},Ia={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ja={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},nb={dynamic:35048,stream:35040,static:35044},Ua=Qa.flatten,mb=Qa.shape,ka=[];ka[5120]=1,ka[5122]=2,ka[5124]=4,ka[5121]=1,ka[5123]=2,ka[5125]=4,ka[5126]=4;var Ka={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},pb=new Float32Array(1),Lb=new Uint32Array(pb.buffer),Pb=[9984,9986,9985,9987],Oa=[0,6409,6410,6407,6408],T={};T[6409]=T[6406]=T[6402]=1,T[34041]=T[6410]=2,T[6407]=T[35904]=3,T[6408]=T[35906]=4;var Xa=sa("HTMLCanvasElement"),Ya=sa("OffscreenCanvas"),ub=sa("CanvasRenderingContext2D"),vb=sa("ImageBitmap"),wb=sa("HTMLImageElement"),xb=sa("HTMLVideoElement"),Mb=Object.keys(Ia).concat([Xa,Ya,ub,vb,wb,xb]),ta=[];ta[5121]=1,ta[5126]=4,ta[36193]=2,ta[5123]=2,ta[5125]=4;var G=[];G[32854]=2,G[32855]=2,G[36194]=2,G[34041]=4,G[33776]=.5,G[33777]=.5,G[33778]=1,G[33779]=1,G[35986]=.5,G[35987]=1,G[34798]=1,G[35840]=.5,G[35841]=.25,G[35842]=.5,G[35843]=.25,G[36196]=.5;var R=[];R[32854]=2,R[32855]=2,R[36194]=2,R[33189]=2,R[36168]=1,R[34041]=4,R[35056]=4,R[35907]=4,R[34836]=16,R[34842]=8,R[34843]=6;var Yb=function(a,b,c,d,f){function e(a){this.id=l++,this.refCount=1,this.renderbuffer=a,this.format=32854,this.height=this.width=0,f.profile&&(this.stats={size:0})}function k(b){var c=b.renderbuffer;a.bindRenderbuffer(36161,null),a.deleteRenderbuffer(c),b.renderbuffer=null,b.refCount=0,delete v[b.id],d.renderbufferCount--}var p={rgba4:32854,rgba8:32856,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041,"depth24 stencil8":35056};b.ext_srgb&&(p.srgba=35907),b.ext_color_buffer_half_float&&(p.rgba16f=34842,p.rgb16f=34843),b.webgl_color_buffer_float&&(p.rgba32f=34836);var u=[];Object.keys(p).forEach((function(a){u[p[a]]=a}));var l=0,v={};return e.prototype.decRef=function(){0>=--this.refCount&&k(this)},f.profile&&(d.getTotalRenderbufferSize=function(){var a=0;return Object.keys(v).forEach((function(b){a+=v[b].stats.size})),a}),{create:function(b,c){function k(b,c){var d=0,e=0,l=32854,r=0;if("object"==typeof b&&b?("shape"in b?(d=0|(e=b.shape)[0],e=0|e[1]):("radius"in b&&(d=e=0|b.radius),"width"in b&&(d=0|b.width),"height"in b&&(e=0|b.height)),"format"in b&&(l=p[b.format]),"samples"in b&&(r=b.samples)):"number"==typeof b?(d=0|b,e="number"==typeof c?0|c:d):b||(d=e=1),d!==h.width||e!==h.height||l!==h.format)return k.width=h.width=d,k.height=h.height=e,k.samples=r,h.format=l,h.samples=r,a.bindRenderbuffer(36161,h.renderbuffer),r&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(36161,r,l,d,e):a.renderbufferStorage(36161,l,d,e),f.profile&&(h.stats.size=R[h.format]*h.width*h.height),k.format=u[h.format],k}var h=new e(a.createRenderbuffer());return v[h.id]=h,d.renderbufferCount++,k(b,c),k.resize=function(b,c){var d=0|b,e=0|c||d;if(d===h.width&&e===h.height)return k;k.width=h.width=d,k.height=h.height=e;var l=k.samples;return a.bindRenderbuffer(36161,h.renderbuffer),l&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(36161,l,h.format,d,e):a.renderbufferStorage(36161,h.format,d,e),f.profile&&(h.stats.size=R[h.format]*h.width*h.height),k},k._reglType="renderbuffer",k._renderbuffer=h,f.profile&&(k.stats=h.stats),k.destroy=function(){h.decRef()},k},clear:function(){J(v).forEach(k)},restore:function(){J(v).forEach((function(b){b.renderbuffer=a.createRenderbuffer(),a.bindRenderbuffer(36161,b.renderbuffer),b.samples&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(36161,b.samples,b.format,b.width,b.height):a.renderbufferStorage(36161,b.format,b.width,b.height)})),a.bindRenderbuffer(36161,null)}}},Za=[];Za[6408]=4,Za[6407]=3;var Ra=[];Ra[5121]=1,Ra[5126]=4,Ra[36193]=2;var Ea=["x","y","z","w"],Wb="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),Ga={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},ab={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ta={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},zb={cw:2304,ccw:2305},Ab=new H(!1,!1,!1,(function(){})),Zb=function(a,b){function c(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function d(a,b,d){var e=k.pop()||new c;e.startQueryIndex=a,e.endQueryIndex=b,e.sum=0,e.stats=d,p.push(e)}if(!b.ext_disjoint_timer_query)return null;var f=[],e=[],k=[],p=[],u=[],l=[];return{beginQuery:function(a){var c=f.pop()||b.ext_disjoint_timer_query.createQueryEXT();b.ext_disjoint_timer_query.beginQueryEXT(35007,c),e.push(c),d(e.length-1,e.length,a)},endQuery:function(){b.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:d,update:function(){var a,c;if(0!==(a=e.length)){l.length=Math.max(l.length,a+1),u.length=Math.max(u.length,a+1),u[0]=0;var d=l[0]=0;for(c=a=0;c<e.length;++c)b.ext_disjoint_timer_query.getQueryObjectEXT(m=e[c],34919)?(d+=b.ext_disjoint_timer_query.getQueryObjectEXT(m,34918),f.push(m)):e[a++]=m,u[c+1]=d,l[c+1]=a;for(e.length=a,c=a=0;c<p.length;++c){var m,h=(d=p[c]).startQueryIndex;d.sum+=u[m=d.endQueryIndex]-u[h],(m=l[m])===(h=l[h])?(d.stats.gpuTime+=d.sum/1e6,k.push(d)):(d.startQueryIndex=h,d.endQueryIndex=m,p[a++]=d)}p.length=a}},getNumPendingQueries:function(){return e.length},clear:function(){f.push.apply(f,e);for(var a=0;a<f.length;a++)b.ext_disjoint_timer_query.deleteQueryEXT(f[a]);e.length=0,f.length=0},restore:function(){e.length=0,f.length=0}}};return function(a){function b(){if(0===F.length)q&&q.update(),ca=null;else{ca=bb.next(b),v();for(var a=F.length-1;0<=a;--a){var c=F[a];c&&c(I,null,0)}m.flush(),q&&q.update()}}function c(){!ca&&0<F.length&&(ca=bb.next(b))}function d(){ca&&(bb.cancel(b),ca=null)}function f(a){a.preventDefault(),d(),S.forEach((function(a){a()}))}function e(a){m.getError(),g.restore(),z.restore(),E.restore(),A.restore(),P.restore(),Q.restore(),L.restore(),q&&q.restore(),J.procs.refresh(),c(),T.forEach((function(a){a()}))}function k(a){function b(a,c){var d={},e={};return Object.keys(a).forEach((function(b){var f=a[b];if(Y.isDynamic(f))e[b]=Y.unbox(f,b);else{if(c&&Array.isArray(f))for(var g=0;g<f.length;++g)if(Y.isDynamic(f[g]))return void(e[b]=Y.unbox(f,b));d[b]=f}})),{dynamic:e,static:d}}function c(a){for(;n.length<a;)n.push(null);return n}var d=b(a.context||{},!0),e=b(a.uniforms||{},!0),f=b(a.attributes||{},!1);a=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a],Object.keys(d).forEach((function(b){c[a+"."+b]=d[b]}))}}var c=K({},a);return delete c.uniforms,delete c.attributes,delete c.context,delete c.vao,"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op),b("blend"),b("depth"),b("cull"),b("stencil"),b("polygonOffset"),b("scissor"),b("sample"),"vao"in a&&(c.vao=a.vao),c}(a),!1);var g={gpuTime:0,cpuTime:0,count:0},h=J.compile(a,f,e,d,g),k=h.draw,l=h.batch,m=h.scope,n=[];return K((function(a,b){var d;if("function"==typeof a)return m.call(this,null,a,0);if("function"==typeof b)if("number"==typeof a)for(d=0;d<a;++d)m.call(this,null,b,d);else{if(!Array.isArray(a))return m.call(this,a,b,0);for(d=0;d<a.length;++d)m.call(this,a[d],b,d)}else if("number"==typeof a){if(0<a)return l.call(this,c(0|a),0|a)}else{if(!Array.isArray(a))return k.call(this,a);if(a.length)return l.call(this,a,a.length)}}),{stats:g,destroy:function(){h.destroy()}})}function p(a,b){var c=0;J.procs.poll();var d=b.color;d&&(m.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384),"depth"in b&&(m.clearDepth(+b.depth),c|=256),"stencil"in b&&(m.clearStencil(0|b.stencil),c|=1024),m.clear(c)}function u(a){return F.push(a),c(),{cancel:function(){function b(){var a=Bb(F,b);F[a]=F[F.length-1],--F.length,0>=F.length&&d()}var c=Bb(F,a);F[c]=b}}}function l(){var a=R.viewport,b=R.scissor_box;a[0]=a[1]=b[0]=b[1]=0,I.viewportWidth=I.framebufferWidth=I.drawingBufferWidth=a[2]=b[2]=m.drawingBufferWidth,I.viewportHeight=I.framebufferHeight=I.drawingBufferHeight=a[3]=b[3]=m.drawingBufferHeight}function v(){I.tick+=1,I.time=w(),l(),J.procs.poll()}function r(){A.refresh(),l(),J.procs.refresh(),q&&q.update()}function w(){return(Cb()-B)/1e3}if(!(a=Hb(a)))return null;var m=a.gl,h=m.getContextAttributes();m.isContextLost();var g=Ib(m,a);if(!g)return null;var t=Eb(),n={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},C=g.extensions,q=Zb(m,C),B=Cb(),G=m.drawingBufferHeight,I={tick:0,time:0,viewportWidth:D=m.drawingBufferWidth,viewportHeight:G,framebufferWidth:D,framebufferHeight:G,drawingBufferWidth:D,drawingBufferHeight:G,pixelRatio:a.pixelRatio},D={elements:null,primitive:4,count:-1,offset:0,instances:-1},M=Xb(m,C),E=Jb(m,n,a,(function(a){return L.destroyBuffer(a)})),H=Kb(m,C,E,n),L=Rb(m,C,M,n,E,H,D),z=Sb(m,t,n,a),A=Nb(m,C,M,(function(){J.procs.poll()}),I,n,a),P=Yb(m,C,M,n,a),Q=Qb(m,C,M,A,P,n),J=Vb(m,t,C,M,E,H,A,Q,{},L,z,D,I,q,a),R=(t=Tb(m,Q,J.procs.poll,I),J.next),N=m.canvas,F=[],S=[],T=[],W=[a.onDestroy],ca=null;N&&(N.addEventListener("webglcontextlost",f,!1),N.addEventListener("webglcontextrestored",e,!1));var Z=Q.setFBO=k({framebuffer:Y.define.call(null,1,"framebuffer")});return r(),h=K(k,{clear:function(a){if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)Z(K({framebuffer:a.framebuffer.faces[b]},a),p);else Z(a,p);else p(null,a)},prop:Y.define.bind(null,1),context:Y.define.bind(null,2),this:Y.define.bind(null,3),draw:k({}),buffer:function(a){return E.create(a,34962,!1,!1)},elements:function(a){return H.create(a,!1)},texture:A.create2D,cube:A.createCube,renderbuffer:P.create,framebuffer:Q.create,framebufferCube:Q.createCube,vao:L.createVAO,attributes:h,frame:u,on:function(a,b){var c;switch(a){case"frame":return u(b);case"lost":c=S;break;case"restore":c=T;break;case"destroy":c=W}return c.push(b),{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1],c.pop();break}}}},limits:M,hasExtension:function(a){return 0<=M.extensions.indexOf(a.toLowerCase())},read:t,destroy:function(){F.length=0,d(),N&&(N.removeEventListener("webglcontextlost",f),N.removeEventListener("webglcontextrestored",e)),z.clear(),Q.clear(),P.clear(),L.clear(),A.clear(),H.clear(),E.clear(),q&&q.clear(),W.forEach((function(a){a()}))},_gl:m,_refresh:r,poll:function(){v(),q&&q.update()},now:w,stats:n,blit:Q.blit}),a.onDone(null,h),h}}()}(regl_min);var u$5=regl_min.exports,EPSILON=1e-6,ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,RANDOM=Math.random;var degree=Math.PI/180;var common=Object.freeze({__proto__:null,EPSILON,get ARRAY_TYPE(){return ARRAY_TYPE},RANDOM,setMatrixArrayType:function(type){ARRAY_TYPE=type},toRadian:function(a){return a*degree},equals:function(a,b){return Math.abs(a-b)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(b))}});function set$8(out,m00,m01,m10,m11){return out[0]=m00,out[1]=m01,out[2]=m10,out[3]=m11,out}function multiply$8(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=a0*b0+a2*b1,out[1]=a1*b0+a3*b1,out[2]=a0*b2+a2*b3,out[3]=a1*b2+a3*b3,out}function fromRotation$4(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=-s,out[3]=c,out}function subtract$6(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out}var mat2=Object.freeze({__proto__:null,create:function(){var out=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0),out[0]=1,out[3]=1,out},clone:function(a){var out=new ARRAY_TYPE(4);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out},copy:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out},identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out},fromValues:function(m00,m01,m10,m11){var out=new ARRAY_TYPE(4);return out[0]=m00,out[1]=m01,out[2]=m10,out[3]=m11,out},set:set$8,transpose:function(out,a){if(out===a){var a1=a[1];out[1]=a[2],out[2]=a1}else out[0]=a[0],out[1]=a[2],out[2]=a[1],out[3]=a[3];return out},invert:function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],det=a0*a3-a2*a1;return det?(out[0]=a3*(det=1/det),out[1]=-a1*det,out[2]=-a2*det,out[3]=a0*det,out):null},adjoint:function(out,a){var a0=a[0];return out[0]=a[3],out[1]=-a[1],out[2]=-a[2],out[3]=a0,out},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},multiply:multiply$8,rotate:function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);return out[0]=a0*c+a2*s,out[1]=a1*c+a3*s,out[2]=a0*-s+a2*c,out[3]=a1*-s+a3*c,out},scale:function(out,a,v){var a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];return out[0]=a[0]*v0,out[1]=a1*v0,out[2]=a2*v1,out[3]=a3*v1,out},fromRotation:fromRotation$4,fromScaling:function(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=v[1],out},str:function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))},LDU:function(L,D,U,a){return L[2]=a[2]/a[0],U[0]=a[0],U[1]=a[1],U[3]=a[3]-L[2]*U[1],[L,D,U]},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out},subtract:subtract$6,exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))},multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out},mul:multiply$8,sub:subtract$6});function multiply$7(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return out[0]=a0*b0+a2*b1,out[1]=a1*b0+a3*b1,out[2]=a0*b2+a2*b3,out[3]=a1*b2+a3*b3,out[4]=a0*b4+a2*b5+a4,out[5]=a1*b4+a3*b5+a5,out}function subtract$5(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out[4]=a[4]-b[4],out[5]=a[5]-b[5],out}var mat2d=Object.freeze({__proto__:null,create:function(){var out=new ARRAY_TYPE(6);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[4]=0,out[5]=0),out[0]=1,out[3]=1,out},clone:function(a){var out=new ARRAY_TYPE(6);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out},copy:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out},identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out[4]=0,out[5]=0,out},fromValues:function(a,b,c,d,tx,ty){var out=new ARRAY_TYPE(6);return out[0]=a,out[1]=b,out[2]=c,out[3]=d,out[4]=tx,out[5]=ty,out},set:function(out,a,b,c,d,tx,ty){return out[0]=a,out[1]=b,out[2]=c,out[3]=d,out[4]=tx,out[5]=ty,out},invert:function(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5],det=aa*ad-ab*ac;return det?(out[0]=ad*(det=1/det),out[1]=-ab*det,out[2]=-ac*det,out[3]=aa*det,out[4]=(ac*aty-ad*atx)*det,out[5]=(ab*atx-aa*aty)*det,out):null},determinant:function(a){return a[0]*a[3]-a[1]*a[2]},multiply:multiply$7,rotate:function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],s=Math.sin(rad),c=Math.cos(rad);return out[0]=a0*c+a2*s,out[1]=a1*c+a3*s,out[2]=a0*-s+a2*c,out[3]=a1*-s+a3*c,out[4]=a4,out[5]=a5,out},scale:function(out,a,v){var a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];return out[0]=a[0]*v0,out[1]=a1*v0,out[2]=a2*v1,out[3]=a3*v1,out[4]=a4,out[5]=a5,out},translate:function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];return out[0]=a0,out[1]=a1,out[2]=a2,out[3]=a3,out[4]=a0*v0+a2*v1+a4,out[5]=a1*v0+a3*v1+a5,out},fromRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=-s,out[3]=c,out[4]=0,out[5]=0,out},fromScaling:function(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=v[1],out[4]=0,out[5]=0,out},fromTranslation:function(out,v){return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out[4]=v[0],out[5]=v[1],out},str:function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out},subtract:subtract$5,multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out[4]=a[4]+b[4]*scale,out[5]=a[5]+b[5]*scale,out},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))},mul:multiply$7,sub:subtract$5});function create$6(){var out=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[3]=0,out[5]=0,out[6]=0,out[7]=0),out[0]=1,out[4]=1,out[8]=1,out}function fromMat4$1(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[4],out[4]=a[5],out[5]=a[6],out[6]=a[8],out[7]=a[9],out[8]=a[10],out}function set$6(out,m00,m01,m02,m10,m11,m12,m20,m21,m22){return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m10,out[4]=m11,out[5]=m12,out[6]=m20,out[7]=m21,out[8]=m22,out}function transpose$1(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3],out[2]=a[6],out[3]=a01,out[5]=a[7],out[6]=a02,out[7]=a12}else out[0]=a[0],out[1]=a[3],out[2]=a[6],out[3]=a[1],out[4]=a[4],out[5]=a[7],out[6]=a[2],out[7]=a[5],out[8]=a[8];return out}function invert$3(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;return det?(out[0]=b01*(det=1/det),out[1]=(-a22*a01+a02*a21)*det,out[2]=(a12*a01-a02*a11)*det,out[3]=b11*det,out[4]=(a22*a00-a02*a20)*det,out[5]=(-a12*a00+a02*a10)*det,out[6]=b21*det,out[7]=(-a21*a00+a01*a20)*det,out[8]=(a11*a00-a01*a10)*det,out):null}function multiply$6(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];return out[0]=b00*a00+b01*a10+b02*a20,out[1]=b00*a01+b01*a11+b02*a21,out[2]=b00*a02+b01*a12+b02*a22,out[3]=b10*a00+b11*a10+b12*a20,out[4]=b10*a01+b11*a11+b12*a21,out[5]=b10*a02+b11*a12+b12*a22,out[6]=b20*a00+b21*a10+b22*a20,out[7]=b20*a01+b21*a11+b22*a21,out[8]=b20*a02+b21*a12+b22*a22,out}function fromRotation$2(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=0,out[3]=-s,out[4]=c,out[5]=0,out[6]=0,out[7]=0,out[8]=1,out}function fromQuat$1(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-yy-zz,out[3]=yx-wz,out[6]=zx+wy,out[1]=yx+wz,out[4]=1-xx-zz,out[7]=zy-wx,out[2]=zx-wy,out[5]=zy+wx,out[8]=1-xx-yy,out}function subtract$4(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out[4]=a[4]-b[4],out[5]=a[5]-b[5],out[6]=a[6]-b[6],out[7]=a[7]-b[7],out[8]=a[8]-b[8],out}var mat3=Object.freeze({__proto__:null,create:create$6,fromMat4:fromMat4$1,clone:function(a){var out=new ARRAY_TYPE(9);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},copy:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},fromValues:function(m00,m01,m02,m10,m11,m12,m20,m21,m22){var out=new ARRAY_TYPE(9);return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m10,out[4]=m11,out[5]=m12,out[6]=m20,out[7]=m21,out[8]=m22,out},set:set$6,identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=1,out[5]=0,out[6]=0,out[7]=0,out[8]=1,out},transpose:transpose$1,invert:invert$3,adjoint:function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return out[0]=a11*a22-a12*a21,out[1]=a02*a21-a01*a22,out[2]=a01*a12-a02*a11,out[3]=a12*a20-a10*a22,out[4]=a00*a22-a02*a20,out[5]=a02*a10-a00*a12,out[6]=a10*a21-a11*a20,out[7]=a01*a20-a00*a21,out[8]=a00*a11-a01*a10,out},determinant:function(a){var a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a[0]*(a22*a11-a12*a21)+a[1]*(-a22*a10+a12*a20)+a[2]*(a21*a10-a11*a20)},multiply:multiply$6,translate:function(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];return out[0]=a00,out[1]=a01,out[2]=a02,out[3]=a10,out[4]=a11,out[5]=a12,out[6]=x*a00+y*a10+a20,out[7]=x*a01+y*a11+a21,out[8]=x*a02+y*a12+a22,out},rotate:function(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);return out[0]=c*a00+s*a10,out[1]=c*a01+s*a11,out[2]=c*a02+s*a12,out[3]=c*a10-s*a00,out[4]=c*a11-s*a01,out[5]=c*a12-s*a02,out[6]=a20,out[7]=a21,out[8]=a22,out},scale:function(out,a,v){var x=v[0],y=v[1];return out[0]=x*a[0],out[1]=x*a[1],out[2]=x*a[2],out[3]=y*a[3],out[4]=y*a[4],out[5]=y*a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},fromTranslation:function(out,v){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=1,out[5]=0,out[6]=v[0],out[7]=v[1],out[8]=1,out},fromRotation:fromRotation$2,fromScaling:function(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=0,out[4]=v[1],out[5]=0,out[6]=0,out[7]=0,out[8]=1,out},fromMat2d:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=0,out[3]=a[2],out[4]=a[3],out[5]=0,out[6]=a[4],out[7]=a[5],out[8]=1,out},fromQuat:fromQuat$1,normalFromMat4:function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;return det?(out[0]=(a11*b11-a12*b10+a13*b09)*(det=1/det),out[1]=(a12*b08-a10*b11-a13*b07)*det,out[2]=(a10*b10-a11*b08+a13*b06)*det,out[3]=(a02*b10-a01*b11-a03*b09)*det,out[4]=(a00*b11-a02*b08+a03*b07)*det,out[5]=(a01*b08-a00*b10-a03*b06)*det,out[6]=(a31*b05-a32*b04+a33*b03)*det,out[7]=(a32*b02-a30*b05-a33*b01)*det,out[8]=(a30*b04-a31*b02+a33*b00)*det,out):null},projection:function(out,width,height){return out[0]=2/width,out[1]=0,out[2]=0,out[3]=0,out[4]=-2/height,out[5]=0,out[6]=-1,out[7]=1,out[8]=1,out},str:function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out[6]=a[6]+b[6],out[7]=a[7]+b[7],out[8]=a[8]+b[8],out},subtract:subtract$4,multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out[6]=a[6]*b,out[7]=a[7]*b,out[8]=a[8]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out[4]=a[4]+b[4]*scale,out[5]=a[5]+b[5]*scale,out[6]=a[6]+b[6]*scale,out[7]=a[7]+b[7]*scale,out[8]=a[8]+b[8]*scale,out},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))},mul:multiply$6,sub:subtract$4});function create$5(){var out=new ARRAY_TYPE(16);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=0,out[12]=0,out[13]=0,out[14]=0),out[0]=1,out[5]=1,out[10]=1,out[15]=1,out}function copy$5(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out}function identity$2(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function transpose(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a01,out[6]=a[9],out[7]=a[13],out[8]=a02,out[9]=a12,out[11]=a[14],out[12]=a03,out[13]=a13,out[14]=a23}else out[0]=a[0],out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a[1],out[5]=a[5],out[6]=a[9],out[7]=a[13],out[8]=a[2],out[9]=a[6],out[10]=a[10],out[11]=a[14],out[12]=a[3],out[13]=a[7],out[14]=a[11],out[15]=a[15];return out}function invert$2(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;return det?(out[0]=(a11*b11-a12*b10+a13*b09)*(det=1/det),out[1]=(a02*b10-a01*b11-a03*b09)*det,out[2]=(a31*b05-a32*b04+a33*b03)*det,out[3]=(a22*b04-a21*b05-a23*b03)*det,out[4]=(a12*b08-a10*b11-a13*b07)*det,out[5]=(a00*b11-a02*b08+a03*b07)*det,out[6]=(a32*b02-a30*b05-a33*b01)*det,out[7]=(a20*b05-a22*b02+a23*b01)*det,out[8]=(a10*b10-a11*b08+a13*b06)*det,out[9]=(a01*b08-a00*b10-a03*b06)*det,out[10]=(a30*b04-a31*b02+a33*b00)*det,out[11]=(a21*b02-a20*b04-a23*b00)*det,out[12]=(a11*b07-a10*b09-a12*b06)*det,out[13]=(a00*b09-a01*b07+a02*b06)*det,out[14]=(a31*b01-a30*b03-a32*b00)*det,out[15]=(a20*b03-a21*b01+a22*b00)*det,out):null}function multiply$5(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=b0*a00+b1*a10+b2*a20+b3*a30,out[1]=b0*a01+b1*a11+b2*a21+b3*a31,out[2]=b0*a02+b1*a12+b2*a22+b3*a32,out[3]=b0*a03+b1*a13+b2*a23+b3*a33,out[4]=(b0=b[4])*a00+(b1=b[5])*a10+(b2=b[6])*a20+(b3=b[7])*a30,out[5]=b0*a01+b1*a11+b2*a21+b3*a31,out[6]=b0*a02+b1*a12+b2*a22+b3*a32,out[7]=b0*a03+b1*a13+b2*a23+b3*a33,out[8]=(b0=b[8])*a00+(b1=b[9])*a10+(b2=b[10])*a20+(b3=b[11])*a30,out[9]=b0*a01+b1*a11+b2*a21+b3*a31,out[10]=b0*a02+b1*a12+b2*a22+b3*a32,out[11]=b0*a03+b1*a13+b2*a23+b3*a33,out[12]=(b0=b[12])*a00+(b1=b[13])*a10+(b2=b[14])*a20+(b3=b[15])*a30,out[13]=b0*a01+b1*a11+b2*a21+b3*a31,out[14]=b0*a02+b1*a12+b2*a22+b3*a32,out[15]=b0*a03+b1*a13+b2*a23+b3*a33,out}function translate$1(out,a,v){var x=v[0],y=v[1],z=v[2],a00=void 0,a01=void 0,a02=void 0,a03=void 0,a10=void 0,a11=void 0,a12=void 0,a13=void 0,a20=void 0,a21=void 0,a22=void 0,a23=void 0;return a===out?(out[12]=a[0]*x+a[4]*y+a[8]*z+a[12],out[13]=a[1]*x+a[5]*y+a[9]*z+a[13],out[14]=a[2]*x+a[6]*y+a[10]*z+a[14],out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]):(a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],out[0]=a00=a[0],out[1]=a01,out[2]=a02,out[3]=a03,out[4]=a10,out[5]=a11,out[6]=a12,out[7]=a13,out[8]=a20,out[9]=a21,out[10]=a22,out[11]=a23,out[12]=a00*x+a10*y+a20*z+a[12],out[13]=a01*x+a11*y+a21*z+a[13],out[14]=a02*x+a12*y+a22*z+a[14],out[15]=a03*x+a13*y+a23*z+a[15]),out}function scale$5(out,a,v){var x=v[0],y=v[1],z=v[2];return out[0]=a[0]*x,out[1]=a[1]*x,out[2]=a[2]*x,out[3]=a[3]*x,out[4]=a[4]*y,out[5]=a[5]*y,out[6]=a[6]*y,out[7]=a[7]*y,out[8]=a[8]*z,out[9]=a[9]*z,out[10]=a[10]*z,out[11]=a[11]*z,out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out}function fromTranslation$1(out,v){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function fromScaling(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=v[1],out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=v[2],out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function fromRotationTranslation$1(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-(yy+zz),out[1]=xy+wz,out[2]=xz-wy,out[3]=0,out[4]=xy-wz,out[5]=1-(xx+zz),out[6]=yz+wx,out[7]=0,out[8]=xz+wy,out[9]=yz-wx,out[10]=1-(xx+yy),out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function getTranslation$1(out,mat){return out[0]=mat[12],out[1]=mat[13],out[2]=mat[14],out}function getScaling(out,mat){var m11=mat[0],m12=mat[1],m13=mat[2],m21=mat[4],m22=mat[5],m23=mat[6],m31=mat[8],m32=mat[9],m33=mat[10];return out[0]=Math.sqrt(m11*m11+m12*m12+m13*m13),out[1]=Math.sqrt(m21*m21+m22*m22+m23*m23),out[2]=Math.sqrt(m31*m31+m32*m32+m33*m33),out}function getRotation(out,mat){var trace=mat[0]+mat[5]+mat[10],S=0;return trace>0?(S=2*Math.sqrt(trace+1),out[3]=.25*S,out[0]=(mat[6]-mat[9])/S,out[1]=(mat[8]-mat[2])/S,out[2]=(mat[1]-mat[4])/S):mat[0]>mat[5]&&mat[0]>mat[10]?(S=2*Math.sqrt(1+mat[0]-mat[5]-mat[10]),out[3]=(mat[6]-mat[9])/S,out[0]=.25*S,out[1]=(mat[1]+mat[4])/S,out[2]=(mat[8]+mat[2])/S):mat[5]>mat[10]?(S=2*Math.sqrt(1+mat[5]-mat[0]-mat[10]),out[3]=(mat[8]-mat[2])/S,out[0]=(mat[1]+mat[4])/S,out[1]=.25*S,out[2]=(mat[6]+mat[9])/S):(S=2*Math.sqrt(1+mat[10]-mat[0]-mat[5]),out[3]=(mat[1]-mat[4])/S,out[0]=(mat[8]+mat[2])/S,out[1]=(mat[6]+mat[9])/S,out[2]=.25*S),out}function fromRotationTranslationScale(out,q,v,s){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2];return out[0]=(1-(yy+zz))*sx,out[1]=(xy+wz)*sx,out[2]=(xz-wy)*sx,out[3]=0,out[4]=(xy-wz)*sy,out[5]=(1-(xx+zz))*sy,out[6]=(yz+wx)*sy,out[7]=0,out[8]=(xz+wy)*sz,out[9]=(yz-wx)*sz,out[10]=(1-(xx+yy))*sz,out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function fromQuat(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-yy-zz,out[1]=yx+wz,out[2]=zx-wy,out[3]=0,out[4]=yx-wz,out[5]=1-xx-zz,out[6]=zy+wx,out[7]=0,out[8]=zx+wy,out[9]=zy-wx,out[10]=1-xx-yy,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function perspective(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=void 0;return out[0]=f/aspect,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=f,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=-1,out[12]=0,out[13]=0,out[15]=0,null!=far&&far!==1/0?(out[10]=(far+near)*(nf=1/(near-far)),out[14]=2*far*near*nf):(out[10]=-1,out[14]=-2*near),out}function ortho(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);return out[0]=-2*lr,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=-2*bt,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=2*nf,out[11]=0,out[12]=(left+right)*lr,out[13]=(top+bottom)*bt,out[14]=(far+near)*nf,out[15]=1,out}function lookAt(out,eye,center,up){var x0=void 0,x1=void 0,x2=void 0,y0=void 0,y1=void 0,y2=void 0,z0=void 0,z1=void 0,z2=void 0,len=void 0,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];return Math.abs(eyex-centerx)<EPSILON&&Math.abs(eyey-centery)<EPSILON&&Math.abs(eyez-centerz)<EPSILON?identity$2(out):(z0=eyex-centerx,z1=eyey-centery,z2=eyez-centerz,x0=upy*(z2*=len=1/Math.sqrt(z0*z0+z1*z1+z2*z2))-upz*(z1*=len),x1=upz*(z0*=len)-upx*z2,x2=upx*z1-upy*z0,(len=Math.sqrt(x0*x0+x1*x1+x2*x2))?(x0*=len=1/len,x1*=len,x2*=len):(x0=0,x1=0,x2=0),y0=z1*x2-z2*x1,y1=z2*x0-z0*x2,y2=z0*x1-z1*x0,(len=Math.sqrt(y0*y0+y1*y1+y2*y2))?(y0*=len=1/len,y1*=len,y2*=len):(y0=0,y1=0,y2=0),out[0]=x0,out[1]=y0,out[2]=z0,out[3]=0,out[4]=x1,out[5]=y1,out[6]=z1,out[7]=0,out[8]=x2,out[9]=y2,out[10]=z2,out[11]=0,out[12]=-(x0*eyex+x1*eyey+x2*eyez),out[13]=-(y0*eyex+y1*eyey+y2*eyez),out[14]=-(z0*eyex+z1*eyey+z2*eyez),out[15]=1,out)}function subtract$3(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out[4]=a[4]-b[4],out[5]=a[5]-b[5],out[6]=a[6]-b[6],out[7]=a[7]-b[7],out[8]=a[8]-b[8],out[9]=a[9]-b[9],out[10]=a[10]-b[10],out[11]=a[11]-b[11],out[12]=a[12]-b[12],out[13]=a[13]-b[13],out[14]=a[14]-b[14],out[15]=a[15]-b[15],out}function exactEquals$5(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]}var mul$5=multiply$5,mat4=Object.freeze({__proto__:null,create:create$5,clone:function(a){var out=new ARRAY_TYPE(16);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out},copy:copy$5,fromValues:function(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){var out=new ARRAY_TYPE(16);return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m03,out[4]=m10,out[5]=m11,out[6]=m12,out[7]=m13,out[8]=m20,out[9]=m21,out[10]=m22,out[11]=m23,out[12]=m30,out[13]=m31,out[14]=m32,out[15]=m33,out},set:function(out,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m03,out[4]=m10,out[5]=m11,out[6]=m12,out[7]=m13,out[8]=m20,out[9]=m21,out[10]=m22,out[11]=m23,out[12]=m30,out[13]=m31,out[14]=m32,out[15]=m33,out},identity:identity$2,transpose,invert:invert$2,adjoint:function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];return out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22),out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22)),out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12),out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12)),out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22)),out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22),out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12)),out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12),out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21),out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21)),out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11),out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11)),out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21)),out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21),out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11)),out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11),out},determinant:function(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];return(a00*a11-a01*a10)*(a22*a33-a23*a32)-(a00*a12-a02*a10)*(a21*a33-a23*a31)+(a00*a13-a03*a10)*(a21*a32-a22*a31)+(a01*a12-a02*a11)*(a20*a33-a23*a30)-(a01*a13-a03*a11)*(a20*a32-a22*a30)+(a02*a13-a03*a12)*(a20*a31-a21*a30)},multiply:multiply$5,translate:translate$1,scale:scale$5,rotate:function(out,a,rad,axis){var s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22,x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z);return len<EPSILON?null:(x*=len=1/len,y*=len,z*=len,s=Math.sin(rad),c=Math.cos(rad),a01=a[1],a02=a[2],a03=a[3],a11=a[5],a12=a[6],a13=a[7],a21=a[9],a22=a[10],a23=a[11],b10=x*y*(t=1-c)-z*s,b11=y*y*t+c,b12=z*y*t+x*s,b20=x*z*t+y*s,b21=y*z*t-x*s,b22=z*z*t+c,out[0]=(a00=a[0])*(b00=x*x*t+c)+(a10=a[4])*(b01=y*x*t+z*s)+(a20=a[8])*(b02=z*x*t-y*s),out[1]=a01*b00+a11*b01+a21*b02,out[2]=a02*b00+a12*b01+a22*b02,out[3]=a03*b00+a13*b01+a23*b02,out[4]=a00*b10+a10*b11+a20*b12,out[5]=a01*b10+a11*b11+a21*b12,out[6]=a02*b10+a12*b11+a22*b12,out[7]=a03*b10+a13*b11+a23*b12,out[8]=a00*b20+a10*b21+a20*b22,out[9]=a01*b20+a11*b21+a21*b22,out[10]=a02*b20+a12*b21+a22*b22,out[11]=a03*b20+a13*b21+a23*b22,a!==out&&(out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out)},rotateX:function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];return a!==out&&(out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[4]=a10*c+a20*s,out[5]=a11*c+a21*s,out[6]=a12*c+a22*s,out[7]=a13*c+a23*s,out[8]=a20*c-a10*s,out[9]=a21*c-a11*s,out[10]=a22*c-a12*s,out[11]=a23*c-a13*s,out},rotateY:function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];return a!==out&&(out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[0]=a00*c-a20*s,out[1]=a01*c-a21*s,out[2]=a02*c-a22*s,out[3]=a03*c-a23*s,out[8]=a00*s+a20*c,out[9]=a01*s+a21*c,out[10]=a02*s+a22*c,out[11]=a03*s+a23*c,out},rotateZ:function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];return a!==out&&(out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[0]=a00*c+a10*s,out[1]=a01*c+a11*s,out[2]=a02*c+a12*s,out[3]=a03*c+a13*s,out[4]=a10*c-a00*s,out[5]=a11*c-a01*s,out[6]=a12*c-a02*s,out[7]=a13*c-a03*s,out},fromTranslation:fromTranslation$1,fromScaling,fromRotation:function(out,rad,axis){var s,c,t,x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z);return len<EPSILON?null:(x*=len=1/len,y*=len,z*=len,s=Math.sin(rad),c=Math.cos(rad),out[0]=x*x*(t=1-c)+c,out[1]=y*x*t+z*s,out[2]=z*x*t-y*s,out[3]=0,out[4]=x*y*t-z*s,out[5]=y*y*t+c,out[6]=z*y*t+x*s,out[7]=0,out[8]=x*z*t+y*s,out[9]=y*z*t-x*s,out[10]=z*z*t+c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out)},fromXRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=c,out[6]=s,out[7]=0,out[8]=0,out[9]=-s,out[10]=c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},fromYRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=0,out[2]=-s,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=s,out[9]=0,out[10]=c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},fromZRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=0,out[3]=0,out[4]=-s,out[5]=c,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},fromRotationTranslation:fromRotationTranslation$1,fromQuat2:function(out,a){var translation=new ARRAY_TYPE(3),bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],magnitude=bx*bx+by*by+bz*bz+bw*bw;return magnitude>0?(translation[0]=2*(ax*bw+aw*bx+ay*bz-az*by)/magnitude,translation[1]=2*(ay*bw+aw*by+az*bx-ax*bz)/magnitude,translation[2]=2*(az*bw+aw*bz+ax*by-ay*bx)/magnitude):(translation[0]=2*(ax*bw+aw*bx+ay*bz-az*by),translation[1]=2*(ay*bw+aw*by+az*bx-ax*bz),translation[2]=2*(az*bw+aw*bz+ax*by-ay*bx)),fromRotationTranslation$1(out,a,translation),out},getTranslation:getTranslation$1,getScaling,getRotation,fromRotationTranslationScale,fromRotationTranslationScaleOrigin:function(out,q,v,s,o){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2],ox=o[0],oy=o[1],oz=o[2],out0=(1-(yy+zz))*sx,out1=(xy+wz)*sx,out2=(xz-wy)*sx,out4=(xy-wz)*sy,out5=(1-(xx+zz))*sy,out6=(yz+wx)*sy,out8=(xz+wy)*sz,out9=(yz-wx)*sz,out10=(1-(xx+yy))*sz;return out[0]=out0,out[1]=out1,out[2]=out2,out[3]=0,out[4]=out4,out[5]=out5,out[6]=out6,out[7]=0,out[8]=out8,out[9]=out9,out[10]=out10,out[11]=0,out[12]=v[0]+ox-(out0*ox+out4*oy+out8*oz),out[13]=v[1]+oy-(out1*ox+out5*oy+out9*oz),out[14]=v[2]+oz-(out2*ox+out6*oy+out10*oz),out[15]=1,out},fromQuat,frustum:function(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);return out[0]=2*near*rl,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=2*near*tb,out[6]=0,out[7]=0,out[8]=(right+left)*rl,out[9]=(top+bottom)*tb,out[10]=(far+near)*nf,out[11]=-1,out[12]=0,out[13]=0,out[14]=far*near*2*nf,out[15]=0,out},perspective,perspectiveFromFieldOfView:function(out,fov,near,far){var upTan=Math.tan(fov.upDegrees*Math.PI/180),downTan=Math.tan(fov.downDegrees*Math.PI/180),leftTan=Math.tan(fov.leftDegrees*Math.PI/180),rightTan=Math.tan(fov.rightDegrees*Math.PI/180),xScale=2/(leftTan+rightTan),yScale=2/(upTan+downTan);return out[0]=xScale,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=yScale,out[6]=0,out[7]=0,out[8]=-(leftTan-rightTan)*xScale*.5,out[9]=(upTan-downTan)*yScale*.5,out[10]=far/(near-far),out[11]=-1,out[12]=0,out[13]=0,out[14]=far*near/(near-far),out[15]=0,out},ortho,lookAt,targetTo:function(out,eye,target,up){var eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],z0=eyex-target[0],z1=eyey-target[1],z2=eyez-target[2],len=z0*z0+z1*z1+z2*z2;len>0&&(z0*=len=1/Math.sqrt(len),z1*=len,z2*=len);var x0=upy*z2-upz*z1,x1=upz*z0-upx*z2,x2=upx*z1-upy*z0;return(len=x0*x0+x1*x1+x2*x2)>0&&(x0*=len=1/Math.sqrt(len),x1*=len,x2*=len),out[0]=x0,out[1]=x1,out[2]=x2,out[3]=0,out[4]=z1*x2-z2*x1,out[5]=z2*x0-z0*x2,out[6]=z0*x1-z1*x0,out[7]=0,out[8]=z0,out[9]=z1,out[10]=z2,out[11]=0,out[12]=eyex,out[13]=eyey,out[14]=eyez,out[15]=1,out},str:function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out[6]=a[6]+b[6],out[7]=a[7]+b[7],out[8]=a[8]+b[8],out[9]=a[9]+b[9],out[10]=a[10]+b[10],out[11]=a[11]+b[11],out[12]=a[12]+b[12],out[13]=a[13]+b[13],out[14]=a[14]+b[14],out[15]=a[15]+b[15],out},subtract:subtract$3,multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out[6]=a[6]*b,out[7]=a[7]*b,out[8]=a[8]*b,out[9]=a[9]*b,out[10]=a[10]*b,out[11]=a[11]*b,out[12]=a[12]*b,out[13]=a[13]*b,out[14]=a[14]*b,out[15]=a[15]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out[4]=a[4]+b[4]*scale,out[5]=a[5]+b[5]*scale,out[6]=a[6]+b[6]*scale,out[7]=a[7]+b[7]*scale,out[8]=a[8]+b[8]*scale,out[9]=a[9]+b[9]*scale,out[10]=a[10]+b[10]*scale,out[11]=a[11]+b[11]*scale,out[12]=a[12]+b[12]*scale,out[13]=a[13]+b[13]*scale,out[14]=a[14]+b[14]*scale,out[15]=a[15]+b[15]*scale,out},exactEquals:exactEquals$5,equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8],a9=a[9],a10=a[10],a11=a[11],a12=a[12],a13=a[13],a14=a[14],a15=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8],b9=b[9],b10=b[10],b11=b[11],b12=b[12],b13=b[13],b14=b[14],b15=b[15];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))&&Math.abs(a9-b9)<=EPSILON*Math.max(1,Math.abs(a9),Math.abs(b9))&&Math.abs(a10-b10)<=EPSILON*Math.max(1,Math.abs(a10),Math.abs(b10))&&Math.abs(a11-b11)<=EPSILON*Math.max(1,Math.abs(a11),Math.abs(b11))&&Math.abs(a12-b12)<=EPSILON*Math.max(1,Math.abs(a12),Math.abs(b12))&&Math.abs(a13-b13)<=EPSILON*Math.max(1,Math.abs(a13),Math.abs(b13))&&Math.abs(a14-b14)<=EPSILON*Math.max(1,Math.abs(a14),Math.abs(b14))&&Math.abs(a15-b15)<=EPSILON*Math.max(1,Math.abs(a15),Math.abs(b15))},mul:mul$5,sub:subtract$3});function create$4(){var out=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0),out}function length$4(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)}function fromValues$4(x,y,z){var out=new ARRAY_TYPE(3);return out[0]=x,out[1]=y,out[2]=z,out}function copy$4(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out}function set$4(out,x,y,z){return out[0]=x,out[1]=y,out[2]=z,out}function add$4(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out}function subtract$2(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out}function multiply$4(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out}function divide$2(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out[2]=a[2]/b[2],out}function scale$4(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out}function scaleAndAdd$2(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out}function distance$2(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)}function squaredDistance$2(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z}function squaredLength$4(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z}function normalize$4(out,a){var x=a[0],y=a[1],z=a[2],len=x*x+y*y+z*z;return len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len,out[2]=a[2]*len),out}function dot$4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function cross$1(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];return out[0]=ay*bz-az*by,out[1]=az*bx-ax*bz,out[2]=ax*by-ay*bx,out}function transformMat4$2(out,a,m){var x=a[0],y=a[1],z=a[2],w=m[3]*x+m[7]*y+m[11]*z+m[15];return out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/(w=w||1),out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w,out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w,out}function angle$1(a,b){var tempA=fromValues$4(a[0],a[1],a[2]),tempB=fromValues$4(b[0],b[1],b[2]);normalize$4(tempA,tempA),normalize$4(tempB,tempB);var cosine=dot$4(tempA,tempB);return cosine>1?0:cosine<-1?Math.PI:Math.acos(cosine)}function equals$5(a,b){var a0=a[0],a1=a[1],a2=a[2],b0=b[0],b1=b[1],b2=b[2];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))}var vec,sub$2=subtract$2,mul$4=multiply$4,div$2=divide$2,dist$2=distance$2,sqrDist$2=squaredDistance$2,len$4=length$4,sqrLen$4=squaredLength$4,forEach$2=(vec=create$4(),function(a,stride,offset,count,fn,arg){var i=void 0,l=void 0;for(stride||(stride=3),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;i<l;i+=stride)vec[0]=a[i],vec[1]=a[i+1],vec[2]=a[i+2],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1],a[i+2]=vec[2];return a}),vec3=Object.freeze({__proto__:null,create:create$4,clone:function(a){var out=new ARRAY_TYPE(3);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out},length:length$4,fromValues:fromValues$4,copy:copy$4,set:set$4,add:add$4,subtract:subtract$2,multiply:multiply$4,divide:divide$2,ceil:function(out,a){return out[0]=Math.ceil(a[0]),out[1]=Math.ceil(a[1]),out[2]=Math.ceil(a[2]),out},floor:function(out,a){return out[0]=Math.floor(a[0]),out[1]=Math.floor(a[1]),out[2]=Math.floor(a[2]),out},min:function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2]),out},max:function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2]),out},round:function(out,a){return out[0]=Math.round(a[0]),out[1]=Math.round(a[1]),out[2]=Math.round(a[2]),out},scale:scale$4,scaleAndAdd:scaleAndAdd$2,distance:distance$2,squaredDistance:squaredDistance$2,squaredLength:squaredLength$4,negate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out},inverse:function(out,a){return out[0]=1/a[0],out[1]=1/a[1],out[2]=1/a[2],out},normalize:normalize$4,dot:dot$4,cross:cross$1,lerp:function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out},hermite:function(out,a,b,c,d,t){var factorTimes2=t*t,factor1=factorTimes2*(2*t-3)+1,factor2=factorTimes2*(t-2)+t,factor3=factorTimes2*(t-1),factor4=factorTimes2*(3-2*t);return out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4,out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4,out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4,out},bezier:function(out,a,b,c,d,t){var inverseFactor=1-t,inverseFactorTimesTwo=inverseFactor*inverseFactor,factorTimes2=t*t,factor1=inverseFactorTimesTwo*inverseFactor,factor2=3*t*inverseFactorTimesTwo,factor3=3*factorTimes2*inverseFactor,factor4=factorTimes2*t;return out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4,out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4,out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4,out},random:function(out,scale){scale=scale||1;var r=2*RANDOM()*Math.PI,z=2*RANDOM()-1,zScale=Math.sqrt(1-z*z)*scale;return out[0]=Math.cos(r)*zScale,out[1]=Math.sin(r)*zScale,out[2]=z*scale,out},transformMat4:transformMat4$2,transformMat3:function(out,a,m){var x=a[0],y=a[1],z=a[2];return out[0]=x*m[0]+y*m[3]+z*m[6],out[1]=x*m[1]+y*m[4]+z*m[7],out[2]=x*m[2]+y*m[5]+z*m[8],out},transformQuat:function(out,a,q){var qx=q[0],qy=q[1],qz=q[2],x=a[0],y=a[1],z=a[2],uvx=qy*z-qz*y,uvy=qz*x-qx*z,uvz=qx*y-qy*x,uuvx=qy*uvz-qz*uvy,uuvy=qz*uvx-qx*uvz,uuvz=qx*uvy-qy*uvx,w2=2*q[3];return uvy*=w2,uvz*=w2,uuvy*=2,uuvz*=2,out[0]=x+(uvx*=w2)+(uuvx*=2),out[1]=y+uvy+uuvy,out[2]=z+uvz+uuvz,out},rotateX:function(out,a,b,c){var p=[],r=[];return p[0]=a[0]-b[0],p[1]=a[1]-b[1],p[2]=a[2]-b[2],r[0]=p[0],r[1]=p[1]*Math.cos(c)-p[2]*Math.sin(c),r[2]=p[1]*Math.sin(c)+p[2]*Math.cos(c),out[0]=r[0]+b[0],out[1]=r[1]+b[1],out[2]=r[2]+b[2],out},rotateY:function(out,a,b,c){var p=[],r=[];return p[0]=a[0]-b[0],p[1]=a[1]-b[1],p[2]=a[2]-b[2],r[0]=p[2]*Math.sin(c)+p[0]*Math.cos(c),r[1]=p[1],r[2]=p[2]*Math.cos(c)-p[0]*Math.sin(c),out[0]=r[0]+b[0],out[1]=r[1]+b[1],out[2]=r[2]+b[2],out},rotateZ:function(out,a,b,c){var p=[],r=[];return p[0]=a[0]-b[0],p[1]=a[1]-b[1],p[2]=a[2]-b[2],r[0]=p[0]*Math.cos(c)-p[1]*Math.sin(c),r[1]=p[0]*Math.sin(c)+p[1]*Math.cos(c),r[2]=p[2],out[0]=r[0]+b[0],out[1]=r[1]+b[1],out[2]=r[2]+b[2],out},angle:angle$1,str:function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]},equals:equals$5,sub:sub$2,mul:mul$4,div:div$2,dist:dist$2,sqrDist:sqrDist$2,len:len$4,sqrLen:sqrLen$4,forEach:forEach$2});function create$3(){var out=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0,out[3]=0),out}function clone$3(a){var out=new ARRAY_TYPE(4);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out}function fromValues$3(x,y,z,w){var out=new ARRAY_TYPE(4);return out[0]=x,out[1]=y,out[2]=z,out[3]=w,out}function copy$3(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out}function set$3(out,x,y,z,w){return out[0]=x,out[1]=y,out[2]=z,out[3]=w,out}function add$3(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out}function subtract$1(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out}function multiply$3(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out[3]=a[3]*b[3],out}function divide$1(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out[2]=a[2]/b[2],out[3]=a[3]/b[3],out}function scale$3(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out}function distance$1(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)}function squaredDistance$1(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w}function length$3(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)}function squaredLength$3(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w}function normalize$3(out,a){var x=a[0],y=a[1],z=a[2],w=a[3],len=x*x+y*y+z*z+w*w;return len>0&&(len=1/Math.sqrt(len),out[0]=x*len,out[1]=y*len,out[2]=z*len,out[3]=w*len),out}function dot$3(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function lerp$3(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out[3]=aw+t*(b[3]-aw),out}function transformMat4$1(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];return out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w,out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w,out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w,out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w,out}function exactEquals$3(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}function equals$4(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))}var sub$1=subtract$1,mul$3=multiply$3,div$1=divide$1,dist$1=distance$1,sqrDist$1=squaredDistance$1,len$3=length$3,sqrLen$3=squaredLength$3,forEach$1=function(){var vec=create$3();return function(a,stride,offset,count,fn,arg){var i=void 0,l=void 0;for(stride||(stride=4),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;i<l;i+=stride)vec[0]=a[i],vec[1]=a[i+1],vec[2]=a[i+2],vec[3]=a[i+3],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1],a[i+2]=vec[2],a[i+3]=vec[3];return a}}(),vec4=Object.freeze({__proto__:null,create:create$3,clone:clone$3,fromValues:fromValues$3,copy:copy$3,set:set$3,add:add$3,subtract:subtract$1,multiply:multiply$3,divide:divide$1,ceil:function(out,a){return out[0]=Math.ceil(a[0]),out[1]=Math.ceil(a[1]),out[2]=Math.ceil(a[2]),out[3]=Math.ceil(a[3]),out},floor:function(out,a){return out[0]=Math.floor(a[0]),out[1]=Math.floor(a[1]),out[2]=Math.floor(a[2]),out[3]=Math.floor(a[3]),out},min:function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2]),out[3]=Math.min(a[3],b[3]),out},max:function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2]),out[3]=Math.max(a[3],b[3]),out},round:function(out,a){return out[0]=Math.round(a[0]),out[1]=Math.round(a[1]),out[2]=Math.round(a[2]),out[3]=Math.round(a[3]),out},scale:scale$3,scaleAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out},distance:distance$1,squaredDistance:squaredDistance$1,length:length$3,squaredLength:squaredLength$3,negate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=-a[3],out},inverse:function(out,a){return out[0]=1/a[0],out[1]=1/a[1],out[2]=1/a[2],out[3]=1/a[3],out},normalize:normalize$3,dot:dot$3,lerp:lerp$3,random:function(out,scale){var v1,v2,v3,v4,s1,s2;scale=scale||1;do{s1=(v1=2*RANDOM()-1)*v1+(v2=2*RANDOM()-1)*v2}while(s1>=1);do{s2=(v3=2*RANDOM()-1)*v3+(v4=2*RANDOM()-1)*v4}while(s2>=1);var d=Math.sqrt((1-s1)/s2);return out[0]=scale*v1,out[1]=scale*v2,out[2]=scale*v3*d,out[3]=scale*v4*d,out},transformMat4:transformMat4$1,transformQuat:function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy,out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz,out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx,out[3]=a[3],out},str:function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},exactEquals:exactEquals$3,equals:equals$4,sub:sub$1,mul:mul$3,div:div$1,dist:dist$1,sqrDist:sqrDist$1,len:len$3,sqrLen:sqrLen$3,forEach:forEach$1});function create$2(){var out=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0),out[3]=1,out}function identity$1(out){return out[0]=0,out[1]=0,out[2]=0,out[3]=1,out}function setAxisAngle(out,axis,rad){rad*=.5;var s=Math.sin(rad);return out[0]=s*axis[0],out[1]=s*axis[1],out[2]=s*axis[2],out[3]=Math.cos(rad),out}function multiply$2(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];return out[0]=ax*bw+aw*bx+ay*bz-az*by,out[1]=ay*bw+aw*by+az*bx-ax*bz,out[2]=az*bw+aw*bz+ax*by-ay*bx,out[3]=aw*bw-ax*bx-ay*by-az*bz,out}function rotateX$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw+aw*bx,out[1]=ay*bw+az*bx,out[2]=az*bw-ay*bx,out[3]=aw*bw-ax*bx,out}function rotateY$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],by=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw-az*by,out[1]=ay*bw+aw*by,out[2]=az*bw+ax*by,out[3]=aw*bw-ay*by,out}function rotateZ$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bz=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw+ay*bz,out[1]=ay*bw-ax*bz,out[2]=az*bw+aw*bz,out[3]=aw*bw-az*bz,out}function slerp(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3],omega=void 0,cosom=void 0,sinom=void 0,scale0=void 0,scale1=void 0;return(cosom=ax*bx+ay*by+az*bz+aw*bw)<0&&(cosom=-cosom,bx=-bx,by=-by,bz=-bz,bw=-bw),1-cosom>EPSILON?(omega=Math.acos(cosom),sinom=Math.sin(omega),scale0=Math.sin((1-t)*omega)/sinom,scale1=Math.sin(t*omega)/sinom):(scale0=1-t,scale1=t),out[0]=scale0*ax+scale1*bx,out[1]=scale0*ay+scale1*by,out[2]=scale0*az+scale1*bz,out[3]=scale0*aw+scale1*bw,out}function fromMat3(out,m){var fTrace=m[0]+m[4]+m[8],fRoot=void 0;if(fTrace>0)fRoot=Math.sqrt(fTrace+1),out[3]=.5*fRoot,out[0]=(m[5]-m[7])*(fRoot=.5/fRoot),out[1]=(m[6]-m[2])*fRoot,out[2]=(m[1]-m[3])*fRoot;else{var i=0;m[4]>m[0]&&(i=1),m[8]>m[3*i+i]&&(i=2);var j=(i+1)%3,k=(i+2)%3;fRoot=Math.sqrt(m[3*i+i]-m[3*j+j]-m[3*k+k]+1),out[i]=.5*fRoot,out[3]=(m[3*j+k]-m[3*k+j])*(fRoot=.5/fRoot),out[j]=(m[3*j+i]+m[3*i+j])*fRoot,out[k]=(m[3*k+i]+m[3*i+k])*fRoot}return out}function fromEuler(out,x,y,z){var halfToRad=.5*Math.PI/180;x*=halfToRad,y*=halfToRad,z*=halfToRad;var sx=Math.sin(x),cx=Math.cos(x),sy=Math.sin(y),cy=Math.cos(y),sz=Math.sin(z),cz=Math.cos(z);return out[0]=sx*cy*cz-cx*sy*sz,out[1]=cx*sy*cz+sx*cy*sz,out[2]=cx*cy*sz-sx*sy*cz,out[3]=cx*cy*cz+sx*sy*sz,out}var tmpvec3,xUnitVec3,yUnitVec3,temp1,temp2,matr,clone$2=clone$3,fromValues$2=fromValues$3,copy$2=copy$3,set$2=set$3,add$2=add$3,mul$2=multiply$2,scale$2=scale$3,dot$2=dot$3,lerp$2=lerp$3,length$2=length$3,len$2=length$2,squaredLength$2=squaredLength$3,sqrLen$2=squaredLength$2,normalize$2=normalize$3,exactEquals$2=exactEquals$3,equals$3=equals$4,rotationTo=(tmpvec3=create$4(),xUnitVec3=fromValues$4(1,0,0),yUnitVec3=fromValues$4(0,1,0),function(out,a,b){var dot=dot$4(a,b);return dot<-.999999?(cross$1(tmpvec3,xUnitVec3,a),len$4(tmpvec3)<1e-6&&cross$1(tmpvec3,yUnitVec3,a),normalize$4(tmpvec3,tmpvec3),setAxisAngle(out,tmpvec3,Math.PI),out):dot>.999999?(out[0]=0,out[1]=0,out[2]=0,out[3]=1,out):(cross$1(tmpvec3,a,b),out[0]=tmpvec3[0],out[1]=tmpvec3[1],out[2]=tmpvec3[2],out[3]=1+dot,normalize$2(out,out))}),sqlerp=(temp1=create$2(),temp2=create$2(),function(out,a,b,c,d,t){return slerp(temp1,a,d,t),slerp(temp2,b,c,t),slerp(out,temp1,temp2,2*t*(1-t)),out}),setAxes=(matr=create$6(),function(out,view,right,up){return matr[0]=right[0],matr[3]=right[1],matr[6]=right[2],matr[1]=up[0],matr[4]=up[1],matr[7]=up[2],matr[2]=-view[0],matr[5]=-view[1],matr[8]=-view[2],normalize$2(out,fromMat3(out,matr))}),quat=Object.freeze({__proto__:null,create:create$2,identity:identity$1,setAxisAngle,getAxisAngle:function(out_axis,q){var rad=2*Math.acos(q[3]),s=Math.sin(rad/2);return s>EPSILON?(out_axis[0]=q[0]/s,out_axis[1]=q[1]/s,out_axis[2]=q[2]/s):(out_axis[0]=1,out_axis[1]=0,out_axis[2]=0),rad},multiply:multiply$2,rotateX:rotateX$1,rotateY:rotateY$1,rotateZ:rotateZ$1,calculateW:function(out,a){var x=a[0],y=a[1],z=a[2];return out[0]=x,out[1]=y,out[2]=z,out[3]=Math.sqrt(Math.abs(1-x*x-y*y-z*z)),out},slerp,random:function(out){var u1=RANDOM(),u2=RANDOM(),u3=RANDOM(),sqrt1MinusU1=Math.sqrt(1-u1),sqrtU1=Math.sqrt(u1);return out[0]=sqrt1MinusU1*Math.sin(2*Math.PI*u2),out[1]=sqrt1MinusU1*Math.cos(2*Math.PI*u2),out[2]=sqrtU1*Math.sin(2*Math.PI*u3),out[3]=sqrtU1*Math.cos(2*Math.PI*u3),out},invert:function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;return out[0]=-a0*invDot,out[1]=-a1*invDot,out[2]=-a2*invDot,out[3]=a3*invDot,out},conjugate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=a[3],out},fromMat3,fromEuler,str:function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},clone:clone$2,fromValues:fromValues$2,copy:copy$2,set:set$2,add:add$2,mul:mul$2,scale:scale$2,dot:dot$2,lerp:lerp$2,length:length$2,len:len$2,squaredLength:squaredLength$2,sqrLen:sqrLen$2,normalize:normalize$2,exactEquals:exactEquals$2,equals:equals$3,rotationTo,sqlerp,setAxes});function fromRotationTranslation(out,q,t){var ax=.5*t[0],ay=.5*t[1],az=.5*t[2],bx=q[0],by=q[1],bz=q[2],bw=q[3];return out[0]=bx,out[1]=by,out[2]=bz,out[3]=bw,out[4]=ax*bw+ay*bz-az*by,out[5]=ay*bw+az*bx-ax*bz,out[6]=az*bw+ax*by-ay*bx,out[7]=-ax*bx-ay*by-az*bz,out}function copy$1(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out}function multiply$1(out,a,b){var ax0=a[0],ay0=a[1],az0=a[2],aw0=a[3],bx1=b[4],by1=b[5],bz1=b[6],bw1=b[7],ax1=a[4],ay1=a[5],az1=a[6],aw1=a[7],bx0=b[0],by0=b[1],bz0=b[2],bw0=b[3];return out[0]=ax0*bw0+aw0*bx0+ay0*bz0-az0*by0,out[1]=ay0*bw0+aw0*by0+az0*bx0-ax0*bz0,out[2]=az0*bw0+aw0*bz0+ax0*by0-ay0*bx0,out[3]=aw0*bw0-ax0*bx0-ay0*by0-az0*bz0,out[4]=ax0*bw1+aw0*bx1+ay0*bz1-az0*by1+ax1*bw0+aw1*bx0+ay1*bz0-az1*by0,out[5]=ay0*bw1+aw0*by1+az0*bx1-ax0*bz1+ay1*bw0+aw1*by0+az1*bx0-ax1*bz0,out[6]=az0*bw1+aw0*bz1+ax0*by1-ay0*bx1+az1*bw0+aw1*bz0+ax1*by0-ay1*bx0,out[7]=aw0*bw1-ax0*bx1-ay0*by1-az0*bz1+aw1*bw0-ax1*bx0-ay1*by0-az1*bz0,out}var dot$1=dot$2;var squaredLength$1=squaredLength$2;var quat2=Object.freeze({__proto__:null,create:function(){var dq=new ARRAY_TYPE(8);return ARRAY_TYPE!=Float32Array&&(dq[0]=0,dq[1]=0,dq[2]=0,dq[4]=0,dq[5]=0,dq[6]=0,dq[7]=0),dq[3]=1,dq},clone:function(a){var dq=new ARRAY_TYPE(8);return dq[0]=a[0],dq[1]=a[1],dq[2]=a[2],dq[3]=a[3],dq[4]=a[4],dq[5]=a[5],dq[6]=a[6],dq[7]=a[7],dq},fromValues:function(x1,y1,z1,w1,x2,y2,z2,w2){var dq=new ARRAY_TYPE(8);return dq[0]=x1,dq[1]=y1,dq[2]=z1,dq[3]=w1,dq[4]=x2,dq[5]=y2,dq[6]=z2,dq[7]=w2,dq},fromRotationTranslationValues:function(x1,y1,z1,w1,x2,y2,z2){var dq=new ARRAY_TYPE(8);dq[0]=x1,dq[1]=y1,dq[2]=z1,dq[3]=w1;var ax=.5*x2,ay=.5*y2,az=.5*z2;return dq[4]=ax*w1+ay*z1-az*y1,dq[5]=ay*w1+az*x1-ax*z1,dq[6]=az*w1+ax*y1-ay*x1,dq[7]=-ax*x1-ay*y1-az*z1,dq},fromRotationTranslation,fromTranslation:function(out,t){return out[0]=0,out[1]=0,out[2]=0,out[3]=1,out[4]=.5*t[0],out[5]=.5*t[1],out[6]=.5*t[2],out[7]=0,out},fromRotation:function(out,q){return out[0]=q[0],out[1]=q[1],out[2]=q[2],out[3]=q[3],out[4]=0,out[5]=0,out[6]=0,out[7]=0,out},fromMat4:function(out,a){var outer=create$2();getRotation(outer,a);var t=new ARRAY_TYPE(3);return getTranslation$1(t,a),fromRotationTranslation(out,outer,t),out},copy:copy$1,identity:function(out){return out[0]=0,out[1]=0,out[2]=0,out[3]=1,out[4]=0,out[5]=0,out[6]=0,out[7]=0,out},set:function(out,x1,y1,z1,w1,x2,y2,z2,w2){return out[0]=x1,out[1]=y1,out[2]=z1,out[3]=w1,out[4]=x2,out[5]=y2,out[6]=z2,out[7]=w2,out},getReal:copy$2,getDual:function(out,a){return out[0]=a[4],out[1]=a[5],out[2]=a[6],out[3]=a[7],out},setReal:copy$2,setDual:function(out,q){return out[4]=q[0],out[5]=q[1],out[6]=q[2],out[7]=q[3],out},getTranslation:function(out,a){var ax=a[4],ay=a[5],az=a[6],aw=a[7],bx=-a[0],by=-a[1],bz=-a[2],bw=a[3];return out[0]=2*(ax*bw+aw*bx+ay*bz-az*by),out[1]=2*(ay*bw+aw*by+az*bx-ax*bz),out[2]=2*(az*bw+aw*bz+ax*by-ay*bx),out},translate:function(out,a,v){var ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3],bx1=.5*v[0],by1=.5*v[1],bz1=.5*v[2],ax2=a[4],ay2=a[5],az2=a[6],aw2=a[7];return out[0]=ax1,out[1]=ay1,out[2]=az1,out[3]=aw1,out[4]=aw1*bx1+ay1*bz1-az1*by1+ax2,out[5]=aw1*by1+az1*bx1-ax1*bz1+ay2,out[6]=aw1*bz1+ax1*by1-ay1*bx1+az2,out[7]=-ax1*bx1-ay1*by1-az1*bz1+aw2,out},rotateX:function(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;return rotateX$1(out,a,rad),out[4]=ax1*(bw=out[3])+aw1*(bx=out[0])+ay1*(bz=out[2])-az1*(by=out[1]),out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz,out},rotateY:function(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;return rotateY$1(out,a,rad),out[4]=ax1*(bw=out[3])+aw1*(bx=out[0])+ay1*(bz=out[2])-az1*(by=out[1]),out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz,out},rotateZ:function(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;return rotateZ$1(out,a,rad),out[4]=ax1*(bw=out[3])+aw1*(bx=out[0])+ay1*(bz=out[2])-az1*(by=out[1]),out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz,out},rotateByQuatAppend:function(out,a,q){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],ax=a[0],ay=a[1],az=a[2],aw=a[3];return out[0]=ax*qw+aw*qx+ay*qz-az*qy,out[1]=ay*qw+aw*qy+az*qx-ax*qz,out[2]=az*qw+aw*qz+ax*qy-ay*qx,out[3]=aw*qw-ax*qx-ay*qy-az*qz,out[4]=(ax=a[4])*qw+(aw=a[7])*qx+(ay=a[5])*qz-(az=a[6])*qy,out[5]=ay*qw+aw*qy+az*qx-ax*qz,out[6]=az*qw+aw*qz+ax*qy-ay*qx,out[7]=aw*qw-ax*qx-ay*qy-az*qz,out},rotateByQuatPrepend:function(out,q,a){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],bx=a[0],by=a[1],bz=a[2],bw=a[3];return out[0]=qx*bw+qw*bx+qy*bz-qz*by,out[1]=qy*bw+qw*by+qz*bx-qx*bz,out[2]=qz*bw+qw*bz+qx*by-qy*bx,out[3]=qw*bw-qx*bx-qy*by-qz*bz,out[4]=qx*(bw=a[7])+qw*(bx=a[4])+qy*(bz=a[6])-qz*(by=a[5]),out[5]=qy*bw+qw*by+qz*bx-qx*bz,out[6]=qz*bw+qw*bz+qx*by-qy*bx,out[7]=qw*bw-qx*bx-qy*by-qz*bz,out},rotateAroundAxis:function(out,a,axis,rad){if(Math.abs(rad)<EPSILON)return copy$1(out,a);var axisLength=Math.sqrt(axis[0]*axis[0]+axis[1]*axis[1]+axis[2]*axis[2]);rad*=.5;var s=Math.sin(rad),bx=s*axis[0]/axisLength,by=s*axis[1]/axisLength,bz=s*axis[2]/axisLength,bw=Math.cos(rad),ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3];out[0]=ax1*bw+aw1*bx+ay1*bz-az1*by,out[1]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[2]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[3]=aw1*bw-ax1*bx-ay1*by-az1*bz;var ax=a[4],ay=a[5],az=a[6],aw=a[7];return out[4]=ax*bw+aw*bx+ay*bz-az*by,out[5]=ay*bw+aw*by+az*bx-ax*bz,out[6]=az*bw+aw*bz+ax*by-ay*bx,out[7]=aw*bw-ax*bx-ay*by-az*bz,out},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out[6]=a[6]+b[6],out[7]=a[7]+b[7],out},multiply:multiply$1,mul:multiply$1,scale:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out[6]=a[6]*b,out[7]=a[7]*b,out},dot:dot$1,lerp:function(out,a,b,t){var mt=1-t;return dot$1(a,b)<0&&(t=-t),out[0]=a[0]*mt+b[0]*t,out[1]=a[1]*mt+b[1]*t,out[2]=a[2]*mt+b[2]*t,out[3]=a[3]*mt+b[3]*t,out[4]=a[4]*mt+b[4]*t,out[5]=a[5]*mt+b[5]*t,out[6]=a[6]*mt+b[6]*t,out[7]=a[7]*mt+b[7]*t,out},invert:function(out,a){var sqlen=squaredLength$1(a);return out[0]=-a[0]/sqlen,out[1]=-a[1]/sqlen,out[2]=-a[2]/sqlen,out[3]=a[3]/sqlen,out[4]=-a[4]/sqlen,out[5]=-a[5]/sqlen,out[6]=-a[6]/sqlen,out[7]=a[7]/sqlen,out},conjugate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=a[3],out[4]=-a[4],out[5]=-a[5],out[6]=-a[6],out[7]=a[7],out},length:length$2,len:length$2,squaredLength:squaredLength$1,sqrLen:squaredLength$1,normalize:function(out,a){var magnitude=squaredLength$1(a);if(magnitude>0){magnitude=Math.sqrt(magnitude);var a0=a[0]/magnitude,a1=a[1]/magnitude,a2=a[2]/magnitude,a3=a[3]/magnitude,b0=a[4],b1=a[5],b2=a[6],b3=a[7],a_dot_b=a0*b0+a1*b1+a2*b2+a3*b3;out[0]=a0,out[1]=a1,out[2]=a2,out[3]=a3,out[4]=(b0-a0*a_dot_b)/magnitude,out[5]=(b1-a1*a_dot_b)/magnitude,out[6]=(b2-a2*a_dot_b)/magnitude,out[7]=(b3-a3*a_dot_b)/magnitude}return out},str:function(a){return"quat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+")"},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))}});function create(){var out=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0),out}function set(out,x,y){return out[0]=x,out[1]=y,out}function add(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out}function subtract(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out}function multiply(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out}function divide(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out}function scale(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out}function distance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)}function squaredDistance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y}function length(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)}function squaredLength(a){var x=a[0],y=a[1];return x*x+y*y}function transformMat2(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[2]*y,out[1]=m[1]*x+m[3]*y,out}var len=length,sub=subtract,mul=multiply,div=divide,dist=distance,sqrDist=squaredDistance,sqrLen=squaredLength,forEach=function(){var vec=create();return function(a,stride,offset,count,fn,arg){var i=void 0,l=void 0;for(stride||(stride=2),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;i<l;i+=stride)vec[0]=a[i],vec[1]=a[i+1],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1];return a}}(),vec2=Object.freeze({__proto__:null,create,clone:function(a){var out=new ARRAY_TYPE(2);return out[0]=a[0],out[1]=a[1],out},fromValues:function(x,y){var out=new ARRAY_TYPE(2);return out[0]=x,out[1]=y,out},copy:function(out,a){return out[0]=a[0],out[1]=a[1],out},set,add,subtract,multiply,divide,ceil:function(out,a){return out[0]=Math.ceil(a[0]),out[1]=Math.ceil(a[1]),out},floor:function(out,a){return out[0]=Math.floor(a[0]),out[1]=Math.floor(a[1]),out},min:function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out},max:function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out},round:function(out,a){return out[0]=Math.round(a[0]),out[1]=Math.round(a[1]),out},scale,scaleAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out},distance,squaredDistance,length,squaredLength,negate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out},inverse:function(out,a){return out[0]=1/a[0],out[1]=1/a[1],out},normalize:function(out,a){var x=a[0],y=a[1],len=x*x+y*y;return len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len),out},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},cross:function(out,a,b){var z=a[0]*b[1]-a[1]*b[0];return out[0]=out[1]=0,out[2]=z,out},lerp:function(out,a,b,t){var ax=a[0],ay=a[1];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out},random:function(out,scale){scale=scale||1;var r=2*RANDOM()*Math.PI;return out[0]=Math.cos(r)*scale,out[1]=Math.sin(r)*scale,out},transformMat2,transformMat2d:function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[2]*y+m[4],out[1]=m[1]*x+m[3]*y+m[5],out},transformMat3:function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[3]*y+m[6],out[1]=m[1]*x+m[4]*y+m[7],out},transformMat4:function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[4]*y+m[12],out[1]=m[1]*x+m[5]*y+m[13],out},rotate:function(out,a,b,c){var p0=a[0]-b[0],p1=a[1]-b[1],sinC=Math.sin(c),cosC=Math.cos(c);return out[0]=p0*cosC-p1*sinC+b[0],out[1]=p0*sinC+p1*cosC+b[1],out},angle:function(a,b){var x1=a[0],y1=a[1],x2=b[0],y2=b[1],len1=x1*x1+y1*y1;len1>0&&(len1=1/Math.sqrt(len1));var len2=x2*x2+y2*y2;len2>0&&(len2=1/Math.sqrt(len2));var cosine=(x1*x2+y1*y2)*len1*len2;return cosine>1?0:cosine<-1?Math.PI:Math.acos(cosine)},str:function(a){return"vec2("+a[0]+", "+a[1]+")"},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]},equals:function(a,b){var a0=a[0],a1=a[1],b0=b[0],b1=b[1];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))},len,sub,mul,div,dist,sqrDist,sqrLen,forEach});
/*!
	 * @maptalks/gltf-loader v0.27.1
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.org
	 */
let n=0;function i$4(e){return null==e}function a$2(e){return!i$4(e)}function o$1(e){for(let t=1;t<arguments.length;t++){const s=arguments[t];for(const t in s)e[t]=s[t]}return e}function f$6(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+e)}function u$4(e){return 0===e.indexOf("data:")&&e.indexOf("base64,")>0}function h$4(e){const t=function(e){return"undefined"!=typeof self?self.atob(e):window.atob(e)}(e.substring(e.indexOf(",")+1)),s=t.length,r=new Uint8Array(s);for(let e=0;e<s;e++)r[e]=t.charCodeAt(e);return r.buffer}const c$2=[],l$4=[],m$7=[],d$5=[0,0,0],g$7=identity$1([]),p$9=[1,1,1];function b$9(e,t,s,r,n,i,a){const o=f$6(a);if((0===n||n===r*o.BYTES_PER_ELEMENT)&&i%o.BYTES_PER_ELEMENT==0){const n=new o(t,i,s*r);return e.set(n),e}0===n&&(n=r*o.BYTES_PER_ELEMENT);const u=new Uint8Array(r*o.BYTES_PER_ELEMENT);for(let a=0;a<s;a++){let s=null;const f=new Uint8Array(t,n*a+i,r*o.BYTES_PER_ELEMENT);u.set(f),s=new o(u.buffer,0,r);for(let t=0;t<r;t++)e[a*r+t]=s[t]}return e}const y$7="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function _$9(e,t,s){const r=new Uint8Array(e,t,s);return y$7.decode(r)}const w$9={get:function(e,t={}){t||(t={});const s=new AbortController,r=s.signal,n=o$1({},t);n.signal=r,n.method||(n.method="GET");const i=fetch(e,n).then((e=>{const s=this._parseResponse(e,t.responseType);return s.message?s:s.then((s=>"arraybuffer"===t.responseType?{data:s,cacheControl:e.headers.get("Cache-Control"),expires:e.headers.get("Expires"),contentType:e.headers.get("Content-Type")}:s)).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}))})).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}));return i.xhr=s,i},_parseResponse:(e,t)=>200!==e.status?{status:e.status,statusText:e.statusText,message:`incorrect http request with status code(${e.status}): ${e.statusText}`}:"arraybuffer"===t?e.arrayBuffer():"json"===t?e.json():e.text(),getArrayBuffer:(e,t={})=>(t||(t={}),t.responseType="arraybuffer",w$9.get(e,t)),getJSON:function(e,t={}){return t&&t.jsonp?w$9.jsonp(e):((t=t||{}).responseType="json",w$9.get(e,t))},jsonp:function(e){const t="_maptalks_jsonp_"+n++;e.match(/\?/)?e+="&callback="+t:e+="?callback="+t;let s=document.createElement("script");return s.type="text/javascript",s.src=e,new Promise((e=>{window[t]=function(r){document.getElementsByTagName("head")[0].removeChild(s),s=null,delete window[t],e(r)},document.getElementsByTagName("head")[0].appendChild(s)}))}};class x$9{constructor(e,t,s){this._requestImage=e,this.decoders=t,this._supportedFormats=s,this.images={},this._imgRequests={}}requestImageFromBufferURI(e,t,s){if(this.buffers[e.id]){const n=this._createDataView(t,this.buffers[e.id]);return this.getImageByBuffer(n,s)}if(this._imgRequests[e.id])return this._imgRequests[e.id].then((()=>{const n=this._createDataView(t,this.buffers[e.id]);return this.getImageByBuffer(n,s)}));if(u$4(e.uri)){const r=this.buffers[e.id]=h$4(e.uri),n=this._createDataView(t,r);return this.getImageByBuffer(n,s)}return this._imgRequests[e.id]=w$9.getArrayBuffer(e.uri,null).then((r=>{const n=this.buffers[e.id]=r.data,i=this._createDataView(t,n);return this.getImageByBuffer(i,s)}))}getImageByBuffer(e,t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const s=this.decoders;if(s[t.mimeType])return s[t.mimeType](e,{supportedFormats:this._supportedFormats});if("image/crn"===t.mimeType||"image/ktx2"===t.mimeType||"image/cttf"===t.mimeType)return console.warn("missing transcoder for "+t.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null);{const s=new Blob([e],{type:t.mimeType}),r=URL.createObjectURL(s);return this._getImageInfo(t.id,r)}}requestExternalImage(e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const t=0===e.uri.indexOf("data:image/")?e.uri:this.rootPath+"/"+e.uri;return this._imgRequests[e.id]?this._imgRequests[e.id].then((()=>this.images[e.id])):this._imgRequests[e.id]=this._getImageInfo(e.id,t)}_getImageInfo(e,t){return new Promise(((s,r)=>{this._requestImage(t,((n,i)=>{n?r(n):(URL.revokeObjectURL(t),this.images[e]=i,s(this.images[e]))}))}))}}const T$9=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16];class E$8{constructor(e,t,s){this.rootPath=e,this.gltf=t,this._enableInterleave=!1,this.glbBuffer=s,this.buffers={},this.requests={},this.accessors={},this._compareAccessor()}_requestData(e,t){const s=this.gltf,r=s.accessors[t];if(void 0===r.bufferView)return this.accessors[r.id]=this._toBufferData(e,t,null,0),Promise.resolve(this.accessors[r.id]);if(r&&this.accessors[r.id])return Promise.resolve(this.accessors[r.id]);return this._requestBufferOfBufferView(s.bufferViews[r.bufferView]).then((s=>{const{buffer:n,byteOffset:i}=s;return this.accessors[r.id]=this._toBufferData(e,t,n,i)}))}_requestBufferOfBufferView(e){const t=this.gltf.buffers[e.buffer];if(this.buffers[t.id]){return Promise.resolve({buffer:this.buffers[t.id],byteOffset:0})}if(this.requests[t.id])return this.requests[t.id].then((()=>Promise.resolve({buffer:this.buffers[t.id],byteOffset:0})));if("binary_glTF"!==e.buffer&&"KHR_binary_glTF"!==e.buffer&&t.uri){if(u$4(t.uri)){const e=this.buffers[t.id]=h$4(t.uri);return Promise.resolve({buffer:e,byteOffset:0})}let e;const s=t.uri.indexOf("blob:")>=0;return e=t.uri.indexOf("://")>0||s?t.uri:this.rootPath+"/"+t.uri,this.requests[t.id]=w$9.getArrayBuffer(e,null).then((r=>(s&&URL.revokeObjectURL(e),{buffer:this.buffers[t.id]=r.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}_toBufferData(e,t,s,r=0){const n=this.gltf,i=n.accessors[t],a=void 0!==i.bufferView?n.bufferViews[i.bufferView]:{},o=(a.byteOffset||0)+r,u=this._getTypeItemSize(i.type),h=f$6(i.componentType),c=a.byteStride||0,l={array:void 0,name:e,accessorName:t,byteLength:i.count*u*h.BYTES_PER_ELEMENT,componentType:i.componentType,count:i.count,type:i.type,itemSize:u};if(i.min&&(l.min=i.min),i.max&&(l.max=i.max),s)if(this._enableInterleave)l.byteStride=c,l.byteOffset=o+(i.byteOffset||0),!c||c===u*h.BYTES_PER_ELEMENT||"indices"===e||"input"===e||"output"===e||e.indexOf("morph")>=0?(l.array=this._typedArray(s,i.count,u,o+(i.byteOffset||0),h),l.array.buffer.byteLength===l.byteLength&&(l.byteOffset=0)):l.array=new Uint8Array(s,o,a.byteLength);else if(i.interleaved){l.byteStride=0,l.byteOffset=0;const e=new h(i.count*u);l.array=b$9(e,s,i.count,u,c,o+(i.byteOffset||0),i.componentType)}else l.byteStride=0,l.array=this._typedArray(s,i.count,u,o+(i.byteOffset||0),h),l.byteOffset=l.array.byteOffset;else{l.array=new h(i.count);const e=l.min||l.max;e&&(l.array[0]=e[0],l.array[1]=e[1],l.array[2]=e[2])}return l}_compareAccessor(){const e=this.gltf.accessors;if(Array.isArray(e))for(let t=0;t<e.length;t++)for(let s=0;s<e.length;s++)t!==s&&e[t].bufferView===e[s].bufferView&&(e[t].interleaved=e[s].interleaved=!0);else for(const t in e)for(const s in e)t!==s&&e[t].bufferView===e[s].bufferView&&(e[t].interleaved=e[s].interleaved=!0)}_typedArray(e,t,s,r,n){return r%n.BYTES_PER_ELEMENT!=0&&(e=e.slice(r,r+t*s*n.BYTES_PER_ELEMENT),r=0),new n(e,r,s*t)}_getTypeItemSize(e){const t=T$9.indexOf(e);return T$9[t+1]}requestKHRTechniquesWebgl(e){const{shaders:t}=e,s=t.map((e=>{if(void 0!==e.bufferView){const t=this.gltf.bufferViews[e.bufferView],{byteLength:s}=t;return this._requestBufferOfBufferView(t).then((r=>{const{buffer:n,byteOffset:i}=r,a=_$9(n,i+(t.byteOffset||0),s);return e.content=a,e}))}if(e.uri){if(u$4(e.uri)){const t=h$4(e.uri),s=_$9(t,0,t.byteLength);return e.content=s,Promise.resolve(e)}return w$9.get(this.rootPath+"/"+e.uri).then((t=>(e.content=t,e)))}return Promise.resolve(e)}));return Promise.all(s).then((()=>e))}}class I$8 extends x$9{constructor(e,t,s,r,n,i){super(r,n,i),this.rootPath=e,this.gltf=t,this.requests={},this.buffers={},this.glbBuffer=s,this.accessor=new E$8(e,t,s)}iterate(e,t){const s=this.gltf[t];if(!s)return;let r=0;for(const t in s)e(t,s[t],r++)}createNode(e){const s={};if(a$2(e.name)&&(s.name=e.name),a$2(e.children)&&(s.children=e.children),a$2(e.jointName)&&(s.jointName=e.jointName),a$2(e.matrix)&&(s.matrix=e.matrix),a$2(e.rotation)&&(s.rotation=e.rotation),a$2(e.scale)&&(s.scale=e.scale),a$2(e.translation)&&(s.translation=e.translation),a$2(e.extras)&&(s.extras=e.extras),a$2(e.meshes)&&(s.mesh=e.meshes[0]),s.translation||s.rotation||s.scale){const e=function(e,s){if(s.matrix)return s.matrix;if(s.translation||s.scale||s.rotation){const r=fromTranslation$1(c$2,s.translation||d$5),n=fromQuat(l$4,s.rotation||g$7),i=fromScaling(m$7,s.scale||p$9);return multiply$5(i,n,i),multiply$5(e,r,i)}return identity$2(e)}([],s);delete s.translation,delete s.rotation,delete s.scale,s.matrix=e}return s}_loadMaterials(e){const t={};for(const s in e){const r=e[s];let n,i;r.instanceTechnique&&r.instanceTechnique.values?(n=r.instanceTechnique,i=n.values.diffuse):(n=r,i=n.values.tex||n.values.diffuseTex||n.values.diffuse);const a={baseColorTexture:{index:i}};r.name&&(a.name=r.name),r.extensions&&(a.extensions=r.extensions),r.extras&&(a.extras=r.extras),t[s]=a}return t}_loadImage(e){if(e.bufferView||e.extensions&&(e.extensions.KHR_binary_glTF||e.extensions.binary_glTF)){const t=e.bufferView?e:e.extensions.KHR_binary_glTF||e.extensions.binary_glTF;e.extensions&&(e.mimeType=t.mimeType,e.width=t.width,e.height=t.height);const s=this.gltf.bufferViews[t.bufferView],i=this.buffers[t.bufferView]=new Uint8Array(this.glbBuffer.buffer,(s.byteOffset||0)+this.glbBuffer.byteOffset,s.byteLength);return this.getImageByBuffer(i,e)}return this.requestExternalImage(e)}_getTexture(e){const t=this.gltf.textures[e];if(!t)return null;const s=this.gltf.images[t.source];return this._loadImage(s).then((e=>({image:{array:e.data,width:e.width,height:e.height,index:t.source,mimeType:s.mimeType,name:s.name,extras:s.extras},sampler:this.gltf.samplers[t.sampler]})))}getBaseColorTexture(e){const t=this.gltf.materials[e];let s,r;if(t.instanceTechnique&&t.instanceTechnique.values?(s=t.instanceTechnique,r=s.values.diffuse):(s=t,r=s.values.tex||s.values.diffuseTex||s.values.diffuse),void 0===r||void 0===this.gltf.textures)return null;const n=this.gltf.textures[r];if(!n)return null;return{format:n.format||6408,internalFormat:n.internalFormat||6408,type:n.type||5121,sampler:this.gltf.samplers[n.sampler],source:this.gltf.images[n.source]}}getMaterial(){return null}getAnimations(){return null}}class O$9 extends x$9{constructor(e,t,s,r,n,i){super(r,n,i),this.rootPath=e,this.gltf=t,this.glbBuffer=s,this.buffers={},this.requests={},this.accessor=new E$8(e,t,s)}iterate(e,t){const s=this.gltf[t];if(s)for(let t=0;t<s.length;t++)e(t,s[t],t)}createNode(e){const t={};return o$1(t,e),!a$2(e.weights)&&this.gltf.meshes&&a$2(t.mesh)?t.weights=this.gltf.meshes[t.mesh].weights:e.weights&&(t.weights=e.weights),t}_getTexture(e){const t=this.gltf.textures[e];if(!t)return null;const s=this.gltf.images[t.source];return this._loadImage(s).then((e=>{if(!e)return null;const r={image:{array:e.data,mipmap:e.mipmap,width:e.width,height:e.height,index:t.source,mimeType:s.mimeType,name:s.name,extensions:s.extensions,extras:s.extras}};o$1(r,t);const n=a$2(t.sampler)?this.gltf.samplers[t.sampler]:void 0;return n&&(r.sampler=n),e.format&&(r.format=e.format),r}))}_loadImage(e){if(!a$2(e.bufferView))return this.requestExternalImage(e);{const t=this.gltf.bufferViews[e.bufferView],s=this.gltf.buffers[t.buffer];if(s.uri)return this.requestImageFromBufferURI(s,t,e);if(this.glbBuffer)return this._requestFromGlbBuffer(t,e)}return null}_requestFromGlbBuffer(e,t){const s=this._createDataView(e,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(s,t)}_createDataView(e,t,s){s=s||0;return new Uint8Array(t,e.byteOffset+s,e.byteLength)}_transformArrayBufferToBase64(e,t){const s=new Array(e.byteLength);for(let t=0;t<e.byteLength;t++)s[t]=String.fromCharCode(e[t]);return s.join(""),"data:"+(t=t||"image/png")+";base64,"+function(e){return"undefined"!=typeof self?self.btoa(e):window.btoa(e)}(unescape(encodeURIComponent(s)))}getAnimations(e){const t=[];return e.forEach((e=>{t.push(this.getSamplers(e.samplers))})),Promise.all(t).then((t=>{for(let s=0;s<t.length;s++)e[s].samplers=t[s];return e}))}getSamplers(e){const t=[];for(let s=0;s<e.length;s++)(a$2(e[s].input)||a$2(e[s].output))&&(t.push(this.accessor._requestData("input",e[s].input)),t.push(this.accessor._requestData("output",e[s].output)));return Promise.all(t).then((t=>{for(let s=0;s<t.length/2;s++)e[s].input=t[2*s],e[s].output=t[2*s+1],e[s].interpolation||(e[s].interpolation="LINEAR");return e}))}}const R$b="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class A$8{static read(e,t=0,s=0){s||(s=e.byteLength);const r=new DataView(e,t,s),n=r.getUint32(4,!0);if(1===n)return A$8.readV1(r,t);if(2===n)return A$8.readV2(e,t);throw new Error("Unsupported glb version : "+n)}static readV1(e,t){const s=e.getUint32(8,!0),r=e.getUint32(12,!0);if(s!==e.byteLength)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const n=P$9(e.buffer,20+t,r);return{json:JSON.parse(n),glbBuffer:{byteOffset:20+t+r,buffer:e.buffer,byteLength:s}}}static readV2(e,t){let s,r,n;const i=new DataView(e,t+12);let a=0;for(;a<i.byteLength;){const o=i.getUint32(a,!0);a+=4;const f=i.getUint32(a,!0);if(a+=4,1313821514===f)s=P$9(e,t+12+a,o);else if(5130562===f){n=t+12+a,r=o;break}a+=o}return{json:JSON.parse(s),glbBuffer:{byteOffset:n,buffer:e,byteLength:r}}}}function P$9(e,t,s){if(R$b){const r=new Uint8Array(e,t,s);return R$b.decode(r)}return function(e){const t=e.length;let s="";for(let r=0;r<t;){let n=e[r++];if(128&n){let s=S$9[n>>3&7];if(!(64&n)||!s||r+s>t)return null;for(n&=63>>s;s>0;s-=1){const t=e[r++];if(128!=(192&t))return null;n=n<<6|63&t}}s+=String.fromCharCode(n)}return s}(new Uint8Array(e,t,s))}const S$9=[1,1,1,1,2,2,3,0],v$8=[0,0,0],q$8=[0,0,0,1],V$9=[1,1,1],M$8={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},L$9={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},U$8={_getTRSW(t,r,n,i,o,f,u,h){const c=a$2(t)?r.animations:[r.animations[0]],l={};for(let r=0;r<c.length;r++){const m=c[r],d=m.name||r;if(a$2(t)&&d!==t)continue;const g=m.channelsMap[n];if(g)for(let t=0;t<g.length;t++){const r=g[t];"translation"===r.target.path?(this._getAnimateData(o,m.samplers[r.sampler],i,1),l.translation=copy$4(v$8,o)):"rotation"===r.target.path?(this._getQuaternion(f,m.samplers[r.sampler],i,1),l.rotation=copy$2(q$8,f)):"scale"===r.target.path?(this._getAnimateData(u,m.samplers[r.sampler],i,1),l.scale=copy$4(V$9,u)):"weights"===r.target.path&&h&&(this._getAnimateData(h,m.samplers[r.sampler],i,h.length),l.weights=h)}}return l},_getAnimateData(e,t,s,r){switch(t.interpolation){case"LINEAR":{const n=this._getPreNext(L$9,t,s,1*r);n&&(e=function(e,t,s,r){for(let n=0;n<e.length;n++)e[n]=t[n]+r*(s[n]-t[n]);return e}(e,n.PREVIOUS,n.NEXT,n.INTERPOLATION));break}case"STEP":{const n=this._getPreNext(L$9,t,s,1*r);n&&(e=function(e,t){for(let s=0;s<e.length;s++)e[s]=t[s];return e}(e,...n.PREVIOUS));break}case"CUBICSPLINE":{const n=this._getPreNext(L$9,t,s,3*r);n&&(e=this._getCubicSpline(e,n,t.input.array,3*r));break}}return e},_getQuaternion(t,s,n){switch(s.interpolation){case"LINEAR":{const r=this._getPreNext(L$9,s,n,1);r&&slerp(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION);break}case"STEP":{const e=this._getPreNext(L$9,s,n,1);e&&(t=set$3(t,...e.PREVIOUS));break}case"CUBICSPLINE":{const e=this._getPreNext(L$9,s,n,3);if(e){for(let t=0;t<e.PREVIOUS.length;t++)e.PREVIOUS[t]=Math.acos(e.PREVIOUS[t]),e.NEXT[t]=Math.acos(e.NEXT[t]);t=this._getCubicSpline(t,e,s.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},_search(e,t){const s=e.length;let r,n,i,a=0,o=s-1,f=Math.floor((a+o)/2);for(;a<=s-1&&o>=0;){if(a===o)return null;if(e[f]<=t&&t<=e[f+1]){const s=e[f];return r=f,n=f+1,i=(t-s)/(e[f+1]-s),{preIndx:r,nextIndex:n,interpolation:i}}t<e[f]?(o=f,f=Math.floor((a+o)/2)):e[f+1]<t&&(a=f,f=Math.floor((a+o)/2))}return null},_getPreNext(e,t,s,r){const n=t.input.array,i=t.output.array,a=t.output.itemSize;(s<n[0]||s>n[n.length-1])&&(s=Math.max(n[0],Math.min(n[n.length-1],s))),s===n[n.length-1]&&(s=n[0]);const o=this._search(n,s);if(!o||!o.nextIndex)return null;const{preIndx:f,nextIndex:u,interpolation:h}=o;e.PREINDEX=f,e.NEXTINDEX=u,e.INTERPOLATION=h;const c=a*r;return e.PREVIOUS=i.subarray(e.PREINDEX*c,(e.PREINDEX+1)*c),e.NEXT=i.subarray(e.NEXTINDEX*c,(e.NEXTINDEX+1)*c),e},_getCubicSpline(e,t,s,r){const n=t.INTERPOLATION,i=s[t.PREINDEX],a=s[t.NEXTINDEX];for(let s=0;s<3;s++){const o=t.PREVIOUS[r+s],f=(a-i)*t.PREVIOUS[2*r+s],u=t.NEXT[3+s],h=(a-i)*t.NEXT[s],c=(2*Math.pow(n,3)-3*Math.pow(n,2)+1)*o+(Math.pow(n,3)-2*Math.pow(n,2)+n)*f+(2*-Math.pow(n,3)+3*Math.pow(n,2))*u+(Math.pow(n,3)-Math.pow(n,2))*h;e[s]=c}return e},getAnimationClip(e,t,n,i){const a=e.nodes[t]&&e.nodes[t].weights;return set$4(v$8,...M$8.TRANSLATION),set$3(q$8,...M$8.ROTATION),set$4(V$9,...M$8.SCALE),this._getTRSW(i,e,t,n,v$8,q$8,V$9,a)},getTimeSpan(e){if(!e.animations)return null;if(e.timeSpan)return e.timeSpan;const t=e.animations;return e.timeSpan={},t.forEach(((t,s)=>{let r=-1/0,n=1/0;const i=t.channels;for(let e=0;e<i.length;e++){const a=t.samplers[i[e].sampler].input.array;a[a.length-1]>r&&(r=a[a.length-1]),a[0]<n&&(n=a[0])}e.timeSpan[t.name||s]={max:r,min:n}})),e.timeSpan},getTimeSpanByName(e,t){const s=this.getTimeSpan(e);return s?a$2(t)?s[t]:s[Object.keys(s)[0]]:null}};let D$9=!1;if("undefined"!=typeof OffscreenCanvas){let e;try{e=new OffscreenCanvas(2,2).getContext("2d")}catch(e){}e&&"undefined"!=typeof createImageBitmap&&(D$9=!0)}const C$8="undefined"==typeof document?null:document.createElement("canvas");class k$8{constructor(e,t,s){if(this.options=s||{},this.options.decoders||(this.options.decoders={}),t.buffer instanceof ArrayBuffer){const{json:s,glbBuffer:r}=A$8.read(t.buffer,t.byteOffset,t.byteLength);this._init(e,s,r)}else this._init(e,t);this._accessor=new E$8(this.rootPath,this.gltf,this.glbBuffer),this._checkExtensions()}_checkExtensions(){const e=this.gltf.extensionsRequired;if(e){if(e.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(e.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders.ktx2)throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded")}}_loadExtensions(){const e=this.gltf.extensions;return e&&e.KHR_techniques_webgl?this._accessor.requestKHRTechniquesWebgl(e.KHR_techniques_webgl).then((t=>(e.KHR_techniques_webgl=t,e))):Promise.resolve(e)}load(e){const t=this._loadScene(e=e||{}),s=this._loadAnimations(),r=this._loadTextures(),n=this._loadExtensions();return Promise.all([t,s,r,n]).then((e=>(e[0].animations=e[1],e[0].textures=e[2],e[0].extensions=e[3],e[0].transferables=this.transferables||[],this.createChannelsMap(e[0]),e[0])))}createChannelsMap(e){const t=e.animations;if(t)for(let e=0;e<t.length;e++){const s=t[e];s.channelsMap={};for(let e=0;e<s.channels.length;e++){const t=s.channels[e];s.channelsMap[t.target.node]||(s.channelsMap[t.target.node]=[]),s.channelsMap[t.target.node].push(t)}}}getExternalResources(){const e=[];if(this.gltf){const{buffers:t,images:s}=this.gltf;for(let s=0;s<t.length;s++)t[s].uri&&t[s].uri.indexOf("data:application/octet-stream;base64")<0&&e.push({type:"buffer",uri:t[s].uri});for(let t=0;t<s.length;t++)s[t].uri&&s[t].uri.indexOf("data:image/")<0&&e.push({type:"image",uri:s[t].uri})}return e}static getAnimationClip(e,t,s,r){return U$8.getAnimationClip(e,t,s,r)}static getAnimationTimeSpan(e,t){return U$8.getTimeSpanByName(e,t)}static getTypedArrayCtor(e){return f$6(e)}static readInterleavedArray(e,t,s,r,n,i,a){return b$9(e,t,s,r,n,i,a)}_init(e,t,s){this.gltf=t,this.glbBuffer=s,this.version=t.asset?+t.asset.version:1,this.rootPath=e,this.buffers={},this.requests={},this.options.requestImage=D$9?H$9.bind(this):this.options.requestImage||X$8,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new O$9(e,t,s,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate(((e,t,s)=>{t.id="buffer_"+s}),"buffers"),this.adapter.iterate(((e,t,s)=>{t.id="image_"+s}),"images"),this.adapter.iterate(((e,t,s)=>{t.id="accessor_"+s}),"accessors")):(this.adapter=new I$8(e,t,s,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate(((e,t,s)=>{t.id="accessor_"+s}),"accessors"),this.adapter.iterate(((e,t,s)=>{t.id="image_"+s}),"images"))}_parseNodes(e,t){if(e.children&&e.children.length>0){if(!("number"==typeof(s=e.children[0])&&isFinite(s)||function(e){return!i$4(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}(e.children[0])))return e;const r=e.children.map((e=>{const s=t[e];return s.nodeIndex=e,this._parseNodes(s,t)}));e.children=r}var s;return e}_loadScene(e){return this._loadNodes(e).then((e=>{const t=this.scenes=[];let s;for(const t in e)e[t]=this._parseNodes(e[t],e),e[t].nodeIndex=Number(t)?Number(t):t;this.adapter.iterate(((r,n,i)=>{const a={};n.name&&(a.name=n.name),n.nodes&&(a.nodes=n.nodes.map((t=>e[t]))),this.gltf.scene===r&&(s=i),t.push(a)}),"scenes");const r={asset:this.gltf.asset,scene:s,scenes:t,nodes:e,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const e=this.adapter._loadMaterials(this.gltf.materials);r.materials=e}return r}))}_loadNodes(e){return this._loadMeshes(e).then((()=>{const e=this.nodes={};return this.adapter.iterate(((t,s)=>{const r=this.adapter.createNode(s,this.meshes,this.skins);e[t]=r}),"nodes"),e}))}_loadSkins(){this.skins=[];const e=[];return this.adapter.iterate(((t,s,r)=>{e.push(this._loadSkin(s).then((e=>{e.index=r,this.skins.push(e)})))}),"skins"),e}_loadSkin(e){return this.adapter.accessor._requestData("inverseBindMatrices",e.inverseBindMatrices).then((t=>(e.inverseBindMatrices=t,t&&t.buffer&&this.transferables&&this.transferables.indexOf(t.buffer)<0&&this.transferables.push(t.buffer),e)))}_loadAnimations(){const e=this.gltf.animations;return a$2(e)?this.adapter.getAnimations(e):null}_loadMeshes(e){this.meshes={};let t=[];return this.adapter.iterate(((s,r,n)=>{t.push(this._loadMesh(r,e).then((e=>{e.index=n,this.meshes[s]=e})))}),"meshes"),t=t.concat(this._loadSkins()),Promise.all(t)}_loadMesh(e,t){const s=e.primitives.map((e=>this._loadPrimitive(e,t))).filter((e=>!!e));return Promise.all(s).then((t=>{const s={};return o$1(s,e),s.primitives=t,s}))}_loadTextures(){const e=this.gltf.textures;if(!e)return null;const t=[];for(const s in e)t.push(this.adapter._getTexture(s));return Promise.all(t).then((t=>{if(this.transferables)for(let e=0;e<t.length;e++){const s=t[e].image.array;if(t[e]&&s){let e;e=s instanceof ImageBitmap?s:s.buffer,e&&this.transferables.indexOf(e)<0&&this.transferables.push(e)}}if(!Array.isArray(e)){const s={},r=Object.keys(e);for(let e=0;e<t.length;e++)t[e]&&(s[r[e]]=t[e]);return s}return t}))}_loadPrimitive(e,t){let r;const n=[],i=e.extensions;if(a$2(e.targets))for(let t=0;t<e.targets.length;t++){const s=e.targets[t];for(const e in s){const r=this.adapter.accessor._requestData(`morphTargets_${e}_${t}`,s[e]);r&&n.push(r)}}if(i&&i.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const e=this.options.decoders.draco,{bufferView:s,attributes:a}=i.KHR_draco_mesh_compression,o=this.gltf.bufferViews[s],f=this._accessor._requestBufferOfBufferView(o).then((s=>{const{buffer:r,byteOffset:n}=s;let{byteOffset:i,byteLength:f}=o;i||(i=0);const u=new DataView(r,n+i,f);return e(u,{attributes:a,useUniqueIDs:!1,skipAttributeTransform:t.skipAttributeTransform}).then((e=>{const t=Object.values(e.attributes);return e.indices&&t.push(e.indices),t}))}));n.push(f),r=Promise.all(n)}else{const t=e.attributes;for(const e in t){const s=this.adapter.accessor._requestData(e,t[e]);s&&n.push(s)}if(a$2(e.indices)){const t=this.adapter.accessor._requestData("indices",e.indices);t&&n.push(t)}r=Promise.all(n)}return r.then((t=>{if(i&&i.KHR_draco_mesh_compression){const s=e.targets?e.targets.length:0;t[s]=t[s].concat(t.slice(0,s)),t=t[s]}let r,n;const o={attributes:t.reduce(((e,t)=>{if("indices"===t.name)r=t;else if(t.name.indexOf("morphTargets_")>-1)n=n||{},n[t.name.slice(13)]=t;else{if(!("POSITION"!==t.name||t.min&&t.max)){const e=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0],{itemSize:n,array:i}=t,a=i.length/n;for(let t=0;t<a;t++)for(let s=0;s<n;s++){const a=t*n+s;i[a]<e[s]&&(e[s]=i[a]),i[a]>r[s]&&(r[s]=i[a])}if(t.quantization){const n=t.quantization,i=n.range/(1<<n.quantizationBits),a=n.minValues;scale$4(e,e,i),add$4(e,e,a),scale$4(r,r,i),add$4(r,r,a)}t.min=e,t.max=r}e[t.name]=t}return this.transferables&&t.array.buffer&&this.transferables.indexOf(t.array.buffer)<0&&this.transferables.push(t.array.buffer),e}),{}),material:e.material};return r&&(o.indices=r),n&&(o.morphTargets=n),o.mode=a$2(e.mode)?e.mode:4,a$2(e.extras)&&(o.extras=e.extras),o}))}}function X$8(e,t){const s=new Image;s.crossOrigin="",s.onload=()=>{if(!C$8)return void t(new Error("There is no canvas to draw image!"));C$8.width=s.width,C$8.height=s.height;const e=C$8.getContext("2d");e.drawImage(s,0,0,s.width,s.height);const r=e.getImageData(0,0,s.width,s.height),n={width:s.width,height:s.height,data:new Uint8Array(r.data)};t(null,n)},s.onerror=function(e){t(e)},s.src=e}let j$7,F$9;function H$9(e,t){j$7||(j$7=new OffscreenCanvas(2,2),F$9=j$7.getContext("2d")),fetch(e).then((e=>e.arrayBuffer())).then((e=>{const t=new Blob([new Uint8Array(e)]);return createImageBitmap(t)})).then((e=>{let{width:s,height:r}=e;K$9(s)||(s=z$7(s)),K$9(r)||(r=z$7(r));const n=this.options.maxTextureSize;n&&(s=Math.min(n,s),r=Math.min(n,r)),j$7.width=s,j$7.height=r,F$9.drawImage(e,0,0,s,r),e.close();const i=F$9.getImageData(0,0,s,r);t(null,{width:s,height:r,data:new Uint8Array(i.data)})})).catch((e=>{console.warn(e),t(e)}))}function K$9(e){return 0==(e&e-1)&&0!==e}function z$7(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}class Vertex{constructor(vertices,index){this.position=vertices,this.index=index,this.faces=[],this.neighbors=[]}addUniqueNeighbor(vertex){-1===this.neighbors.indexOf(vertex)&&this.neighbors.push(vertex)}}class Triangle{constructor(v1,v2,v3,face){this.a=face.a,this.b=face.b,this.c=face.c,this.v1=v1,this.v2=v2,this.v3=v3,this.normal=[],this.computeNormal(),v1.faces.push(this),v1.addUniqueNeighbor(v2),v1.addUniqueNeighbor(v3),v2.faces.push(this),v2.addUniqueNeighbor(v1),v2.addUniqueNeighbor(v3),v3.faces.push(this),v3.addUniqueNeighbor(v1),v3.addUniqueNeighbor(v2)}computeNormal(){const vA=this.v1.position,vB=this.v2.position,cross=cross$1([],sub$2([],this.v3.position,vB),sub$2([],vA,vB));normalize$4(this.normal,cross)}hasVertex(v){return v===this.v1||v===this.v2||v===this.v3}}
/*!
	 * Contains code from google filament
	 * https://github.com/google/filament/
	 * License Apache-2.0
	 */const MAT0=[],TMP0=[],TMP1=[],TMP2=[];function packTangentFrame(q,n,t){const c=cross$1(TMP0,n,t);q=fromMat3(q,function(out,c00,c01,c02,c10,c11,c12,c20,c21,c22){return out[0]=c00,out[1]=c01,out[2]=c02,out[3]=c10,out[4]=c11,out[5]=c12,out[6]=c20,out[7]=c21,out[8]=c22,out}(MAT0,t[0],t[1],t[2],...c,...n));const bias=1/32767;if((q=function(q){return q[3]<0?scale$2(q,q,-1):q}(q=normalize$2(q,q)))[3]<bias){q[3]=bias;const factor=Math.sqrt(1-bias*bias);q[0]*=factor,q[1]*=factor,q[2]*=factor}const b=t[3]>0?cross$1(TMP1,t,n):cross$1(TMP1,n,t);return dot$4(cross$1(TMP2,t,n),b)<0&&scale$2(q,q,-1),q}function fromArray3(out,array,offset){return out[0]=array[offset],out[1]=array[offset+1],out[2]=array[offset+2],out}function fromArray2(out,array,offset){return out[0]=array[offset],out[1]=array[offset+1],out}
/*!
	 * @maptalks/reshader.gl v0.74.0
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.com
	 */function f$5(e){return!u$3(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function u$3(e){return null==e}function d$4(e){return!u$3(e)}function h$2(e){return!u$3(e)&&("function"==typeof e||null!==e.constructor&&e.constructor===Function)}const m$6="function"==typeof Object.assign;function v$7(e){if(m$6)Object.assign.apply(Object,arguments);else for(let t=1;t<arguments.length;t++){const n=arguments[t];for(const t in n)e[t]=n[t]}return e}function _$8(e){for(let t=1;t<arguments.length;t++){const n=arguments[t];for(const t in n)null!=n[t]&&(e[t]=n[t])}return e}function g$6(e){return"number"==typeof e&&!isNaN(e)}function b$8(e,t,n){return e*(1-n)+t*n}function p$8(e){return Array.isArray(e)||e instanceof Uint8Array||e instanceof Int8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Uint32Array||e instanceof Int32Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e instanceof Float64Array}function x$8(e){return(e=Math.abs(e))<128?Int8Array:e<32768?Int16Array:Float32Array}function y$6(e,t,n){return Math.min(n,Math.max(t,e))}function A$7(e){return e&&e.hasExtension("oes_vertex_array_object")}function T$8(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function S$8(e){if(e.data){if(e.data.BYTES_PER_ELEMENT)return e.data.length*e.data.BYTES_PER_ELEMENT;if(e.data.length)return 4*e.data.length}else{if(e.BYTES_PER_ELEMENT)return e.length*e.BYTES_PER_ELEMENT;if(e.length)return 4*e.length;if(e.buffer&&e.buffer.destroy)return e.buffer._buffer.byteLength}return 0}function M$7(e){return e.width*e.height*O$8(e.format)*E$7(e.type)*("textureCube"===e._reglType?6:1)}function E$7(e){return"uint8"===e?1:"uint16"===e||"float16"===e||"half float"===e?2:"uint32"===e||"float"===e||"float32"===e?4:0}function O$8(e){return"depth"===e||"alpha"===e||"luminance"===e?1:"luminance alpha"===e||"depth stencil"===e?2:"srgba"===e||"rgb5 a1"===e||"rgba"===e.substring(0,4)?4:"srgb"===e||"rgb"===e.substring(0,3)?3:1}function C$7(t){if(!t.componentType)return!1;const n=k$8.getTypedArrayCtor(t.componentType);return t.byteStride>0&&t.byteStride!==t.itemSize*n.BYTES_PER_ELEMENT}function P$8(e){return e&&(e.stride>0||C$7(e))}function w$8(e){let t=0;const n=e&&e.length||0;if(!n)return t;let r;for(let i=0;i<n;i++)r=e.charCodeAt(i),t=(t<<5)-t+r,t&=t;return t}var I$7=Object.freeze({__proto__:null,isString:f$5,isNil:u$3,defined:d$4,isFunction:h$2,extend:v$7,extend1:_$8,extend2:function(e){for(let t=1;t<arguments.length;t++){const n=arguments[t];for(const t in n)void 0===e[t]&&(e[t]=n[t])}return e},isNumber:g$6,log2:function(e){if(Math.log2)return Math.log2(e);const t=Math.log(e)*Math.LOG2E,n=Math.round(t);return Math.abs(n-t)<1e-14?n:t},normalize:function(e,t){let n=0;for(let e=0,r=t.length;e<r;e++)n+=t[e];for(let r=0,i=t.length;r<i;r++)e[r]=t[r]/n;return e},interpolate:b$8,isArray:p$8,lerp:function(e,t,n,r){for(let i=0;i<e.length;i++)e[i]=t[i]+r*(n[i]-t[i]);return e},set:function(e,t){for(let n=0;n<e.length;n++)e[n]=t[n];return e},getPosArrayType:x$8,clamp:y$6,isSupportVAO:A$7,hasOwn:T$8,getBufferSize:S$8,getTexMemorySize:M$7,getTextureByteWidth:E$7,getTextureChannels:O$8,isInStride:C$7,isInterleaved:P$8,getSupportedFormats:function(e){return{etc:!!e.getExtension("WEBGL_compressed_texture_etc"),etc1:!!e.getExtension("WEBGL_compressed_texture_etc1"),s3tc:!!e.getExtension("WEBGL_compressed_texture_s3tc"),pvrtc:!!e.getExtension("WEBGL_compressed_texture_pvrtc"),astc:!!e.getExtension("WEBGL_compressed_texture_astc"),bc7:!!e.getExtension("EXT_texture_compression_bptc")}},hashCode:w$8});const R$a=e=>class extends e{on(e,t){return this._events||(this._events={type:[t]}),this._events[e]=this._events[e]||[],this._events[e].push(t),this}once(e,t){return this.on(e,this._wrapOnce(e,t))}off(e,t){return this._events&&this._events[e]?(this._events[e].splice(this._events[e].indexOf(t),1),this):this}fire(e,t={}){if(!this._events||!this._events[e])return this;t.target||(t.target=this);const n=this._events[e].slice(0);for(const e of n)e(t);return this}_wrapOnce(e,t){const n=this;let r=!1;return function i(o){r||(r=!0,t(o),n.off(e,i))}}},D$8="__reshader_disposed";var N$9=Object.freeze({__proto__:null,KEY_DISPOSED:D$8,WEBGL_EXTENSIONS:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives"],WEBGL_OPTIONAL_EXTENSIONS:["OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","EXT_texture_filter_anisotropic"]}),F$8=R$a(class{constructor(e,t){if(h$2(e)){this._texture=e,e=this.config={};for(const t in this._texture)T$8(this._texture,t)&&(h$2(this._texture[t])||(e[t]=this._texture[t]))}else if(this.config=e||{},this.resLoader=t,!e.url&&!e.promise||e.data)e.data&&this._needPowerOf2()&&(e.data instanceof Image&&(e.data=L$8(e.data),e.width=e.data.width,e.height=e.data.height),e.hdr||!p$8(e.data)||H$8(e.width)&&H$8(e.height)||(e.data=function(e,t,n){let r=t,i=n;H$8(t)||(r=B$9(t)),H$8(n)||(i=B$9(n));const o=new ImageData(new Uint8ClampedArray(e),t,n),a=document.createElement("canvas");a.width=t,a.height=n,a.getContext("2d").putImageData(o,0,0);const s=document.createElement("canvas");return s.width=r,s.height=i,s.getContext("2d").drawImage(a,0,0,r,i),console.warn(`Texture's size is not power of two, resize from (${t}, ${n}) to (${r}, ${i})`),s}(e.data,e.width,e.height),e.width=e.data.width,e.height=e.data.height));else{this._loading=!0;const n=this;let r;if(e.promise)r=e.promise;else{let n;n=e.arrayBuffer?t.getArrayBuffer:t.get,r=n.call(t,e.url)}e.data=t.getDefaultTexture(e.url),this.promise=r,r.then((e=>(delete this.promise,n._loading=!1,n.config?(e.data instanceof Image&&this._needPowerOf2()&&(e.data=L$8(e.data)),n.onLoad(e),Array.isArray(e)||(e=[e]),n.fire("complete",{target:this,resources:e}),e):e))).catch((e=>{console.error("error when loading texture image.",e),n.fire("error",{target:this,error:e})}))}}isReady(){return!this._loading}set(e,t){return this.config[e]=t,this.dirty=!0,this}get(e){return this.config[e]}getREGLTexture(e){return this._texture||(this._texture=this.createREGLTexture(e),this.config.persistent||(this.config.data&&(this.config.data instanceof ImageBitmap&&this.config.data.close(),this.config.data=[]),this.config.faces&&(this.config.faces=[]),this.config.image&&(this.config.image.array=[]),this.config.mipmap&&delete this.config.mipmap)),this.dirty&&this._updateREGL(),this._texture}getMemorySize(){if(!this.config)return 0;const{width:e,height:t,type:n,format:r}=this.config,i=E$7(n||"uint8"),o=O$8(r||"rgba");return this.config.faces?e*t*i*o*6:e*t*i*o}_updateREGL(){this._texture&&!this._texture[D$8]&&this._texture(this.config),this.dirty=!1}dispose(){this.config&&this.config.url&&(URL.revokeObjectURL(this.config.url),this.resLoader.disposeRes(this.config.url)),this._texture&&!this._texture[D$8]&&(this._texture._reshader_refCount&&this._texture._reshader_refCount--,this._texture._reshader_refCount||(this._texture.destroy(),this._texture[D$8]=!0,delete this._texture)),delete this.resLoader;const e=this.config&&this.config.url;delete this.config,e&&this.fire("disposed",{target:this,url:e})}_needPowerOf2(){const e=this.config;return e.wrap&&"clamp"!==e.wrap||e.wrapS&&"clamp"!==e.wrapS||e.wrapT&&"clamp"!==e.wrapT||e.min&&"nearest"!==e.min&&"linear"!==e.min}});function L$8(e){if(H$8(e.width)&&H$8(e.height))return e;let t=e.width,n=e.height;H$8(t)||(t=B$9(t)),H$8(n)||(n=B$9(n));const r=document.createElement("canvas");r.width=t,r.height=n,r.getContext("2d").drawImage(e,0,0,t,n);const i=e.src,o=i.lastIndexOf("/")+1,a=i.substring(o);return console.warn(`Texture(${a})'s size is not power of two, resize from (${e.width}, ${e.height}) to (${t}, ${n})`),r}function H$8(e){return 0==(e&e-1)&&0!==e}function B$9(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}const z$6={};class k$7{constructor(e){this.regl=e}render(e,t,n,r){e.setUniforms(t||z$6),e.setFramebuffer(r);let i=0;if(n){const{opaques:t,transparents:r}=n.getSortedMeshes();i+=e.draw(this.regl,t),i+=e.draw(this.regl,r)}else i+=e.draw(this.regl);return i}clear(e){this.regl.clear(e)}}const U$7=[],j$6=identity$2([]),V$8={min:[],max:[]};class X$7{constructor(e,t){this.min=e||[1/0,1/0,1/0],this.max=t||[-1/0,-1/0,-1/0],this.updateVertex()}static copy(e,t){copy$4(e.min,t.min),copy$4(e.max,t.max);for(let r=0;r<t.vertex.length;r++)copy$4(e.vertex[r],t.vertex[r]);return e}combine(e){return e?(Array.isArray(e)&&(copy$4(V$8.min,e[0]),copy$4(V$8.max,e[1]),e=V$8),e.min[0]<this.min[0]&&(this.min[0]=e.min[0],this._dirty=!0),e.min[1]<this.min[1]&&(this.min[1]=e.min[1],this._dirty=!0),e.min[2]<this.min[2]&&(this.min[2]=e.min[2],this._dirty=!0),e.max[0]>this.max[0]&&(this.max[0]=e.max[0],this._dirty=!0),e.max[1]>this.max[1]&&(this.max[1]=e.max[1],this._dirty=!0),e.max[2]>this.max[2]&&(this.max[2]=e.max[2],this._dirty=!0),this):this}dirty(){return this._dirty=!0,this}getCenter(){return this.center||(this.center=[],this._dirty=!0),this._dirty&&(add$4(this.center,this.min,this.max),scale$4(this.center,this.center,.5)),this._dirty=!1,this.center}containPoint(e){const t=this.min,n=this.max;return t[0]<=e[0]&&t[1]<=e[1]&&t[2]<=e[2]&&n[0]>=e[0]&&n[1]>=e[1]&&n[2]>=e[2]}isFinite(){const e=this.min,t=this.max;return isFinite(e[0])&&isFinite(e[1])&&isFinite(e[2])&&isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2])}updateVertex(){if(!this.vertex){this.vertex=[];for(let e=0;e<8;e++)this.vertex.push([])}return this.vertex[0][0]=this.min[0],this.vertex[0][1]=this.min[1],this.vertex[0][2]=this.min[2],this.vertex[1][0]=this.min[0],this.vertex[1][1]=this.min[1],this.vertex[1][2]=this.max[2],this.vertex[2][0]=this.min[0],this.vertex[2][1]=this.max[1],this.vertex[2][2]=this.max[2],this.vertex[3][0]=this.min[0],this.vertex[3][1]=this.max[1],this.vertex[3][2]=this.min[2],this.vertex[4][0]=this.max[0],this.vertex[4][1]=this.min[1],this.vertex[4][2]=this.min[2],this.vertex[5][0]=this.max[0],this.vertex[5][1]=this.min[1],this.vertex[5][2]=this.max[2],this.vertex[6][0]=this.max[0],this.vertex[6][1]=this.max[1],this.vertex[6][2]=this.max[2],this.vertex[7][0]=this.max[0],this.vertex[7][1]=this.max[1],this.vertex[7][2]=this.min[2],this.vertex}copy(){return new X$7(this.min.slice(),this.max.slice())}equals(e){if(!equals$5(this.min,e.min)||!equals$5(this.max,e.max))return!1;const t=e.vertex;for(let e=0;e<this.vertex.length;e++)if(!equals$5(t[e],this.vertex[e]))return!1;return!0}transform(e,r){if(e=e||j$6,(r=r||j$6)[1]||r[2]||r[4]||r[6]||r[8]||r[9]){const i=this.vertex,o=multiply$5(U$7,r,e);for(let e=0;e<i.length;e++)transformMat4$2(this.vertex[e],this.vertex[e],o);const a=this.vertex.map((e=>e[0])),s=this.vertex.map((e=>e[1])),c=this.vertex.map((e=>e[2])),l=Math.min(...a),f=Math.max(...a),u=Math.min(...s),d=Math.max(...s),h=Math.min(...c),m=Math.max(...c);set$4(this.min,l,u,h),set$4(this.max,f,d,m)}else{const i=multiply$5(U$7,r,e);transformMat4$2(this.min,this.min,i),transformMat4$2(this.max,this.max,i)}return this}}const K$8=[],W$7={5120:"int8",5122:"int16",5124:"int32",5121:"uint8",5123:"uint16",5125:"uint32",5126:"float"},q$7={5120:1,5122:2,5124:4,5121:1,5123:2,5125:4,5126:4},J$7={positionSize:3,primitive:"triangles",positionAttribute:"aPosition",normalAttribute:"aNormal",uv0Attribute:"aTexCoord",uv1Attribute:"aTexCoord1",color0Attribute:"aColor0",tangentAttribute:"aTangent",pickingIdAttribute:"aPickingId"};let Y$6=1;const Q$7="_reshader_refCount";class Z$7{constructor(e,t,n,r){this._version=0,this.data=e,this.elements=t,this.desc=v$7({},J$7,r);const i=e[this.desc.positionAttribute];n||(t?n=$$7(t):i&&i.length?n=i.length/this.desc.positionSize:i&&i.interleavedArray?n=i.interleavedArray.length/this.desc.positionSize:i&&i.array&&(n=i.array.length/this.desc.positionSize)),this.count=n,this.elements||(this.elements=n),this.properties={},this._buffers={},this._vao={},this.getVertexCount(),this._prepareData(),this.updateBoundingBox()}set version(e){throw new Error("Geometry.version is read only.")}get version(){return this._version}_prepareData(){if(!this.data)return;const e=this._buffers||{};for(const t in this.data){const n=this.data[t];if(n)if(n.buffer&&n.buffer.destroy){const e=n.buffer;e[Q$7]||(e[Q$7]=0),e[Q$7]++}else if(n&&n.array)if(C$7(n)){let r=n.array.buffer.__id;r||(r=n.array.buffer.__id=Y$6++),this.data[t]={buffer:r,offset:n.byteOffset,stride:n.byteStride,type:W$7[n.componentType],size:n.itemSize,count:n.count,componentType:n.componentType},e[r]||(e[r]={data:n.array.buffer})}else this.data[t]=n.array}this._buffers=e;const t=this.elements;t&&t.array&&(this.elements=this.elements.array)}getAttrData(e){const t=e.key,n=!this._reglData||!this._reglData[t];if(this._reglData||(this._reglData={}),n){const e=this._reglData[t]={},n=this.data,{positionAttribute:r,normalAttribute:i,uv0Attribute:o,uv1Attribute:a,tangentAttribute:s,color0Attribute:c,pickingIdAttribute:l}=this.desc;v$7(e,this.data),e.aPosition=n[r],n[i]&&(e.aNormal=n[i]),n[o]&&(e.aTexCoord=n[o]),n[a]&&(e.aTexCoord1=n[a]),n[s]&&(e.aTangent=n[s]),n[c]&&(e.aColor0=n[c]),n[l]&&(e.aPickingId=n[l])}return this._reglData[t]}getREGLData(e,t,n){this.getAttrData(t);const r=!this._reglData||!this._reglData[t.key];if(A$7(e)&&!n){const n=t&&t.key||"default";if(!this._vao[n]||r||this._elementsUpdated){const r=this._reglData[t.key],i=this.getVertexCount(),o=[];for(let e=0;e<t.length;e++){const n=t[e].name,a=r[n]&&r[n].buffer;if(a&&a.destroy)o.push(void 0!==r[n].stride?r[n]:a);else{const e=r[n];if(!e){o.push(this.desc.fillEmptyDataInMissingAttribute?new Uint8Array(4*i):K$8);continue}const t=(e.data&&p$8(e.data)?e.data.length:e.length)/i;e.data?(e.dimension=t,o.push(e)):o.push({data:e,dimension:t})}}const a={attributes:o,primitive:this.getPrimitive()};if(this.elements&&!g$6(this.elements)){a.elements={primitive:this.getPrimitive(),data:this.elements};const e=this.getElementsType(this.elements);e&&(a.elements.type=e)}this._vao[n]?this._vao[n].vao(a):this._vao[n]={vao:e.vao(a)},delete this._elementsUpdated}return this._vao[n]}return this._reglData[t.key]}_isAttrChanged(e){if(e===this._activeAttributes)return!1;if(e.length!==this._activeAttributes.length)return!0;for(let t=0;t<e.length;t++)if(e[t]!==this._activeAttributes[t])return!0;return!1}generateBuffers(e,t){const n=this._buffers;for(const t in n)n[t].buffer||(n[t].buffer=e.buffer(n[t].data)),delete n[t].data;const r=this.data,i=this.getVertexCount(),o={};for(const t in r)if(r[t]){if(void 0===r[t].buffer||r[t].buffer instanceof ArrayBuffer){const n=r[t].data?r[t]:{data:r[t]};n.dimension=(r[t].data?r[t].data:r[t]).length/i;const a=e.buffer(n);a[Q$7]=1,o[t]={buffer:a}}else r[t].buffer.destroy?o[t]=r[t]:n[r[t].buffer]&&(o[t]=v$7({},r[t]),o[t].buffer=n[r[t].buffer].buffer);delete r[t].array}this.data=o,delete this._reglData;const a=A$7(e);if((!a||t&&t.excludeElementsInVAO)&&this.elements&&!g$6(this.elements)){const t={primitive:this.getPrimitive(),data:this.elements},n=this.getElementsType(this.elements);n&&(t.type=n),this.elements=this.elements.destroy?this.elements:e.elements(t);const r=this.elements;r[Q$7]||(r[Q$7]=0),r[Q$7]++}else a&&this.elements&&this.elements.buffer&&this.elements.byteOffset>0&&(this.elements=this.elements.slice())}getVertexCount(){const{positionAttribute:e,positionSize:t}=this.desc;let n=this.data[e];return n.data&&(n=n.data),n.array&&(n=n.array),p$8(n)?this._vertexCount=Math.ceil(n.length/t):n&&void 0!==n.count&&(this._vertexCount=n.count),this._vertexCount}addBuffer(e,t){return this._buffers[e]={data:t},delete this._reglData,this._deleteVAO(),this}updateBuffer(e,t){if(!this._buffers[e])throw new Error(`invalid buffer ${e} in geometry`);return this._buffers[e].buffer?this._buffers[e].buffer.subdata(t):this._buffers[e].data=t,delete this._reglData,this._deleteVAO(),this}updateData(e,t){const n=this.data[e];if(!n)return this;let r;this._incrVersion(),this.data[e]=t,n.buffer&&n.buffer.destroy&&(r=n);const i=this.getVertexCount();e===this.desc.positionAttribute&&this.updateBoundingBox();const o=this.getVertexCount();return r&&(o<=i?r.buffer.subdata(t):r.buffer(t),this.data[e]=r),this._prepareData(),this.desc.positionAttribute===e&&(this._posDirty=!0),delete this._reglData,this}updateSubData(e,t,n){const r=this.data[e];if(!r)return this;let i;if(this._incrVersion(),r.buffer&&r.buffer.destroy&&(i=r),e===this.desc.positionAttribute&&this._updateSubBoundingBox(t),i){const e=q$7[i.buffer._buffer.dtype];t.BYTES_PER_ELEMENT!==e&&(t=new(function(e,t){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Uint8ClampedArray?1===t?Uint8Array:2===t?Uint16Array:Uint32Array:e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array?1===t?Int8Array:2===t?Int16Array:Int32Array:e instanceof Float32Array||e instanceof Float64Array?4===t?Float32Array:Float64Array:void 0}(t,e))(t)),i.buffer.subdata(t,n*e)}else{const r=this.data[e].data?this.data[e].data:this.data[e];for(let e=0;e<t.length;e++)r[n+e]=t[e]}return this._prepareData(),this.desc.positionAttribute===e&&(this._posDirty=!0),delete this._reglData,this}getPrimitive(){return this.desc.primitive}getElements(){return this.elements}setElements(e,t){if(!e)throw new Error("elements data is invalid");this._incrVersion();const n=this.elements;return this.count=void 0===t?$$7(e):t,this.elements=n.destroy?n(e):e,this._elementsUpdated=!0,this}setDrawCount(e){return this._incrVersion(),this.count1=e,this}getDrawCount(){return this.count1||this.count}setDrawOffset(e){return this._incrVersion(),this.offset=e,this}getDrawOffset(){return this.offset||0}dispose(){this._deleteVAO(),this._forEachBuffer((e=>{if(!e[D$8]){let t=e[Q$7];t&&t--,t<=0?(e[D$8]=!0,e.destroy()):e[Q$7]=t}})),this.data={},this._buffers={},delete this._reglData,delete this._attributes,this.count=0,this.elements=[],delete this._tempPosArray,this._disposed=!0}isDisposed(){return!!this._disposed}updateBoundingBox(){let e=this.boundingBox;e||(e=this.boundingBox=new X$7);let t,r,i=this.data[this.desc.positionAttribute];if(p$8(i)||(i.data?i=i.data:P$8(i)?i=this._getAttributeData(this.desc.positionAttribute):i.array&&(t=i.min,r=i.max,i=i.array)),i&&i.length){const o=e.min,a=e.max;if(t&&r)set$4(o,...t),set$4(a,...r);else{set$4(o,i[0],i[1],i[2]),set$4(a,i[0],i[1],i[2]);for(let e=3;e<i.length;){const t=i[e++],n=i[e++],r=i[e++];t<o[0]&&(o[0]=t),n<o[1]&&(o[1]=n),r<o[2]&&(o[2]=r),t>a[0]&&(a[0]=t),n>a[1]&&(a[1]=n),r>a[2]&&(a[2]=r)}}e.updateVertex(),e.dirty()}}_updateSubBoundingBox(e){const t=this.boundingBox,n=t.min,r=t.max;for(let t=0;t<e.length;){const i=e[t++],o=e[t++],a=e[t++];i<n[0]&&(n[0]=i),o<n[1]&&(n[1]=o),a<n[2]&&(n[2]=a),i>r[0]&&(r[0]=i),o>r[1]&&(r[1]=o),a>r[2]&&(r[2]=a)}t.updateVertex(),t.dirty()}_getAttributeData(t){const n=this.data[t],r=n.buffer;if(P$8(n)){const i=this._buffers[r]?this._buffers[r].data:n.array,{count:o,size:a,stride:s,offset:c,componentType:l}=n,f=k$8.getTypedArrayCtor(l);if((0===s||s===a*f.BYTES_PER_ELEMENT)&&c%f.BYTES_PER_ELEMENT==0)return new f(i,c,o*a);if(t===this.desc.positionAttribute)return!this._tempPosArray||this._tempPosArray&&this._tempPosArray.length<a*o?(this._tempPosArray=new f(a*o),k$8.readInterleavedArray(this._tempPosArray,i,o,a,s,c,l)):this._posDirty?(this._posDirty=!1,k$8.readInterleavedArray(this._tempPosArray,i,o,a,s,c,l)):this._tempPosArray;{const t=new f(a*o);return k$8.readInterleavedArray(t,i,o,a,s,c,l)}}return n}createTangent(e="aTangent"){this._incrVersion();const{normalAttribute:t,positionAttribute:i,uv0Attribute:o}=this.desc,a=this._getAttributeData(t),f=
/*!
	 * Contains code from THREE.JS
	 * https://github.com/mrdoob/three.js/
	 * License MIT
	 * 
	 * Generate tangents per vertex.
	 */
function(positions,normals,uvs,indices){const nVertices=positions.length/3,tangents=new Array(4*nVertices),tan1=[],tan2=[];for(let i=0;i<nVertices;i++)tan1[i]=[0,0,0],tan2[i]=[0,0,0];const vA=[0,0,0],vB=[0,0,0],vC=[0,0,0],uvA=[0,0],uvB=[0,0],uvC=[0,0],sdir=[0,0,0],tdir=[0,0,0];function handleTriangle(a,b,c){fromArray3(vA,positions,3*a),fromArray3(vB,positions,3*b),fromArray3(vC,positions,3*c),fromArray2(uvA,uvs,2*a),fromArray2(uvB,uvs,2*b),fromArray2(uvC,uvs,2*c);const x1=vB[0]-vA[0],x2=vC[0]-vA[0],y1=vB[1]-vA[1],y2=vC[1]-vA[1],z1=vB[2]-vA[2],z2=vC[2]-vA[2],s1=uvB[0]-uvA[0],s2=uvC[0]-uvA[0],t1=uvB[1]-uvA[1],t2=uvC[1]-uvA[1],r=1/(s1*t2-s2*t1);set$4(sdir,(t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r),set$4(tdir,(s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r),add$4(tan1[a],tan1[a],sdir),add$4(tan1[b],tan1[b],sdir),add$4(tan1[c],tan1[c],sdir),add$4(tan2[a],tan2[a],tdir),add$4(tan2[b],tan2[b],tdir),add$4(tan2[c],tan2[c],tdir)}for(let j=0,jl=indices.length;j<jl;j+=3)handleTriangle(indices[j+0],indices[j+1],indices[j+2]);const tmp=[],tmp2=[],n=[],n2=[];let w,t,test;function handleVertex(v){fromArray3(n,normals,3*v),copy$4(n2,n),t=tan1[v],copy$4(tmp,t),sub$2(tmp,tmp,scale$4(n,n,dot$4(n,t))),normalize$4(tmp,tmp),cross$1(tmp2,n2,t),test=dot$4(tmp2,tan2[v]),w=test<0?-1:1,tangents[4*v]=tmp[0],tangents[4*v+1]=tmp[1],tangents[4*v+2]=tmp[2],tangents[4*v+3]=w}for(let j=0,jl=indices.length;j<jl;j+=3)handleVertex(indices[j+0]),handleVertex(indices[j+1]),handleVertex(indices[j+2]);return tangents}(this._getAttributeData(i),a,this.data[o],this.elements),u=this.data[e]=new Float32Array(f.length),d=[],h=[],m=[];for(let e=0;e<f.length;e+=4){const t=e/4*3;set$4(h,a[t],a[t+1],a[t+2]),set$3(d,f[e],f[e+1],f[e+2],f[e+3]),packTangentFrame(m,h,d),copy$3(u.subarray(e,e+4),m)}delete this._reglData}createNormal(e="aNormal"){this._incrVersion();const t=this._getAttributeData(this.desc.positionAttribute);this.data[e]=function(positions,indices){const vertexes=[],normals=[];let i=0;for(i=0;i<positions.length;i+=3){const vertex=new Vertex([positions[i],positions[i+1],positions[i+2]],i/3);vertexes.push(vertex)}if(!indices.length){const len=indices;indices=[];for(let i=0;i<len;i++)indices.push(i)}for(i=0;i<indices.length/3;i++){const face={a:indices[3*i],b:indices[3*i+1],c:indices[3*i+2]};new Triangle(vertexes[face.a],vertexes[face.b],vertexes[face.c],face)}const divide=[],normal=[0,0,0];for(i=0;i<vertexes.length;i++){const vertex=vertexes[i],vIndex=vertex.index;set$4(normal,0,0,0);let len=vertex.faces.length;for(let j=0;j<len;j++)add$4(normal,normal,vertex.faces[j].normal);len=len||1,set$4(divide,len,len,len),divide$2(normal,normal,divide),normals[3*vIndex]=normal[0],normals[3*vIndex+1]=normal[1],normals[3*vIndex+2]=normal[2]}return normals}(t.array||t,this.elements),delete this._reglData}createBarycentric(e="aBarycentric"){if("triangles"!==this.desc.primitive)throw new Error("Primitive must be triangles to create bary centric data");this._incrVersion();const t=new Uint8Array(3*this.getVertexCount());for(let e=0,n=this.elements.length;e<n;)for(let n=0;n<3;n++)t[3*this.elements[e++]+n]=1;this.data[e]=t,delete this._reglData}buildUniqueVertex(){this._incrVersion();const e=this.data,t=this.elements;if(!p$8(t))throw new Error("elements must be array to build unique vertex.");const n=Object.keys(e),r={};let i=e[this.desc.positionAttribute];if(i=i.length?i:i.array,!p$8(i))throw new Error(this.desc.positionAttribute+" must be array to build unique vertex.");const o=this.getVertexCount(),a=t.length;for(let t=0;t<n.length;t++){const i=n[t],s=p$8(e[i])?e[i]:e[i].array,c=s.length/o;if(!p$8(s))throw new Error(i+" must be array to build unique vertex.");r[i]=s,r[i].size=c,e[i]=new s.constructor(a*c)}let s=0;for(let i=0;i<a;i++){const o=t[i];for(let t=0;t<n.length;t++){const i=n[t],a=e[i],c=r[i].size;for(let e=0;e<c;e++)a[s*c+e]=r[i][o*c+e]}t[i]=s++}delete this._reglData}getMemorySize(){let e=0;for(const t in this.data)T$8(this.data,t)&&(e+=S$8(this.data[t]));if(this.elements){const t=this.elements;t.destroy?e+=t._elements.buffer.byteLength:t.BYTES_PER_ELEMENT?e+=t.length*t.BYTES_PER_ELEMENT:t.length&&(e+=4*t.length)}return e}_deleteVAO(){for(const e in this._vao)this._vao[e].vao.destroy();this._vao={}}_forEachBuffer(e){this.elements&&this.elements.destroy&&e(this.elements);for(const t in this.data)T$8(this.data,t)&&this.data[t]&&this.data[t].buffer&&this.data[t].buffer.destroy&&e(this.data[t].buffer);for(const t in this._buffers)T$8(this._buffers,t)&&this._buffers[t]&&this._buffers[t].buffer&&this._buffers[t].buffer.destroy&&e(this._buffers[t].buffer)}getElementsType(e){return e instanceof Uint8Array?"uint8":e instanceof Uint16Array?"uint16":e instanceof Uint32Array?"uint32":void 0}_incrVersion(){this._version++}}function $$7(e){if(g$6(e))return e;if(void 0!==e.count)return e.count;if(void 0!==e.length)return e.length;if(e.data)return e.data.length;throw new Error("invalid elements length")}var ee$3=R$a(class{constructor(e={},t){this._version=0,this.uniforms=_$8({},t||{},e);for(const t in e){const n=Object.getOwnPropertyDescriptor(e,t).get;n&&Object.defineProperty(this.uniforms,t,{get:n})}this._reglUniforms={},this.refCount=0,this._bindedOnTextureComplete=this._onTextureComplete.bind(this),this._genUniformKeys(),this._checkTextures()}set version(e){throw new Error("Material.version is read only.")}get version(){return this._version}isReady(){return this._loadingCount<=0}set(e,t){const n=u$3(this.uniforms[e])&&!u$3(t)||!u$3(this.uniforms[e])&&u$3(t);return this.uniforms[e]&&this.isTexture(e)&&this.uniforms[e].dispose(),u$3(t)?u$3(this.uniforms[e])||delete this.uniforms[e]:this.uniforms[e]=t,this._dirtyUniforms=!0,this.isTexture(e)&&this._checkTextures(),n&&(this._genUniformKeys(),this._incrVersion()),this}get(e){return this.uniforms[e]}isDirty(){return this._uniformVer!==this.version}appendDefines(e){const t=this.uniforms;return t.jointTexture&&(e.HAS_SKIN=1),t.morphWeights1&&(e.HAS_MORPH=1),e}hasSkinAnimation(){return this.uniforms.jointTexture&&this.uniforms.skinAnimation}getUniforms(e){if(this._reglUniforms&&!this.isDirty())return this._reglUniforms;const t=this.uniforms,n={};for(const r in t)this.isTexture(r)?Object.defineProperty(n,r,{enumerable:!0,configurable:!0,get:function(){return t[r].getREGLTexture(e)}}):Object.defineProperty(n,r,{enumerable:!0,configurable:!0,get:function(){return t[r]}});return this._reglUniforms=n,this._uniformVer=this.version,n}isTexture(e){return this.uniforms[e]instanceof F$8}dispose(){for(const e in this.uniforms){const t=this.uniforms[e];t&&(t.dispose?t.dispose():t.destroy&&!t[D$8]&&(t.destroy(),t[D$8]=!0))}delete this.uniforms,delete this._reglUniforms,this._disposed=!0}isDisposed(){return!!this._disposed}_checkTextures(){this._loadingCount=0;for(const e in this.uniforms)if(this.isTexture(e)){const t=this.uniforms[e];t.isReady()||(this._loadingCount++,t.on("complete",this._bindedOnTextureComplete))}}_onTextureComplete(){this._loadingCount--,this._incrVersion(),this._loadingCount<=0&&(this._disposed||this.fire("complete"))}getUniformKeys(){return this._uniformKeys}_genUniformKeys(){const e=[];for(const t in this.uniforms)T$8(this.uniforms,t)&&!u$3(this.uniforms[t])&&e.push(t);this._uniformKeys=e.join()}_incrVersion(){this._version++}getMemorySize(){const e=this.uniforms;let t=0;for(const n in e)this.isTexture(n)?t+=e[n].getMemorySize():this.uniforms[n].destroy&&(t+=M$7(this.uniforms[n]));return t}});const te$4={time:0,seeThrough:!0,thickness:.03,fill:[1,.5137254902,.98,1],stroke:[.7019607843,.9333333333,.2274509804,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,insideAltColor:!1,squeeze:!1,squeezeMin:.5,squeezeMax:1,dualStroke:!1,secondThickness:.05,opacity:1,noiseEnable:!1};class ne$4 extends ee$3{constructor(e){super(e,te$4)}}const re$4={baseColorFactor:[1,1,1,1],materialShininess:32,ambientStrength:1,specularStrength:32,opacity:1,extrusionOpacity:0,extrusionOpacityRange:[0,1.8],baseColorTexture:null,normalTexture:null,emissiveTexture:null,occlusionTexture:null,uvScale:[1,1],uvOffset:[0,0]};class ie$4 extends ee$3{constructor(e){super(e,re$4)}static convertFrom(e){const t={};for(const n in re$4)t[n]=e.get(n);return new ie$4(t)}appendDefines(e,t){super.appendDefines(e,t);const n=this.uniforms;return n.extrusionOpacity&&(e.HAS_EXTRUSION_OPACITY=1),t.data[t.desc.uv0Attribute]?(n.baseColorTexture&&(e.HAS_BASECOLOR_MAP=1),n.occlusionTexture&&(e.HAS_AO_MAP=1),n.emissiveTexture&&(e.HAS_EMISSIVE_MAP=1),n.normalTexture&&(e.HAS_NORMAL_MAP=1),(e.HAS_BASECOLOR_MAP||e.HAS_AO_MAP||e.HAS_EMISSIVE_MAP||e.HAS_NORMAL_MAP)&&(e.HAS_MAP=1),e):e}}const oe$4={toons:4,specularToons:2};const se$4={diffuseFactor:[1,1,1,1],specularFactor:[1,1,1],glossinessFactor:1,diffuseTexture:null,specularGlossinessTexture:null,normalTexture:null,emissiveTexture:null,occlusionTexture:null},ce$4=e=>class extends e{constructor(e){super(e=v$7({},se$4,e||{}))}appendDefines(e,t){if(super.appendDefines(e,t),e.SHADING_MODEL_SPECULAR_GLOSSINESS=1,!t.data[t.desc.uv0Attribute])return e;const n=this.uniforms;return n.diffuseTexture&&(e.HAS_DIFFUSE_MAP=1),n.specularGlossinessTexture&&(e.HAS_SPECULARGLOSSINESS_MAP=1),(e.HAS_SPECULARGLOSSINESS_MAP||e.HAS_DIFFUSE_MAP)&&(e.HAS_MAP=1),e}};class le$4 extends(ce$4(ie$4)){}const fe$4=[];let ue$4=0;class de$4{constructor(e,n,r={}){this._version=0,this._geometry=e,this._material=n,this.transparent=!!r.transparent,this.bloom=!!r.bloom,this.ssr=!!r.ssr,this.castShadow=u$3(r.castShadow)||r.castShadow,this.picking=!!r.picking,this.disableVAO=!!r.disableVAO,this.uniforms={},this._localTransform=identity$2(new Array(16)),this._positionMatrix=identity$2(new Array(16)),this.properties={},this._dirtyUniforms=!0,this._dirtyGeometry=!0,Object.defineProperty(this,"uuid",{value:ue$4++}),ue$4>Number.MAX_VALUE-10&&(ue$4=0)}set material(e){this._material!==e&&this.setMaterial(e)}get material(){return this._material}set version(e){throw new Error("Mesh.version is read only.")}get version(){return this._version}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._incrVersion(),this._dirtyGeometry=!0),this._geometry=e}set localTransform(e){this._prevTMat||(this._prevTMat=[]),Array.isArray(e)&&!exactEquals$5(this._prevTMat,e)&&(this._incrVersion(),this._prevTMat=copy$5(this._prevTMat,e)),this._localTransform=e}get localTransform(){return this._localTransform}set positionMatrix(e){this._prevPMat||(this._prevPMat=[]),Array.isArray(e)&&!exactEquals$5(this._prevPMat,e)&&(this._incrVersion(),this._prevPMat=copy$5(this._prevPMat,e)),this._positionMatrix=e}get positionMatrix(){return this._positionMatrix}get config(){return this._cfg||(this._cfg={}),this._cfg.transparent=this.transparent,this._cfg.castShadow=this.castShadow,this._cfg.bloom=this.bloom,this._cfg.ssr=this.ssr,this._cfg.picking=this.picking,this._cfg}get defines(){return this._getDefines()}set defines(e){this.setDefines(e)}setMaterial(e){return this._material=e,this._dirtyUniforms=!0,delete this._materialVer,this.dirtyDefines=!0,this}setParent(e){return this.parent=e,this}setLocalTransform(e){return this.localTransform=e,this}setPositionMatrix(e){this.positionMatrix=e}setUniform(e,t){return void 0===this.uniforms[e]&&(this._dirtyUniforms=!0),this.uniforms[e]=t,this}getUniform(e){return this.uniforms[e]}getDefines(){const e={};return v$7(e,this._getDefines()),this._material&&this._geometry&&this._material.appendDefines(e,this._geometry),e}_getDefines(){this._defines||(this._defines={});const e=this._geometry,t=e.data[e.desc.positionAttribute],n=e.data[e.desc.uv0Attribute],r=e.data[e.desc.normalAttribute];return t&&t.quantization&&(this._defines.HAS_DECODE_POSITION=1),n&&n.quantization&&(this._defines.HAS_DECODE_TEXCOORD=1),r&&r.quantization&&(this._defines.HAS_DECODE_NORMAL=1),this._defines}setDefines(e){const t=this._bakDefines;return this._defines=e,this.dirtyDefines=!!t!=!!e||!function(e,t){if(!e&&!t)return!0;const n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!==r.length)return!1;for(let r=0;r<n.length;r++)if(e[n[r]]!==t[n[r]])return!1;return!0}(t,e),this.dirtyDefines&&(this._bakDefines=v$7({},e)),this}hasSkinAnimation(){return this._material&&this._material.hasSkinAnimation()}_getDefinesKey(){return this.dirtyDefines=!1,this._createDefinesKey(this.getDefines())}getCommandKey(){if(!this._commandKey||this.dirtyDefines||this._material&&this._materialKeys!==this._material.getUniformKeys()){let e=this._getDefinesKey();e+="_"+(g$6(this.getElements())?"count":"elements"),e+="_"+ +!!this.disableVAO,this._commandKey=e,this._material&&(this._materialKeys=this._material.getUniformKeys())}return this._commandKey}getUniforms(e){if(this._dirtyUniforms||this._dirtyGeometry||this._material&&this._materialVer!==this._material.version){if(this._realUniforms={},this._getUniformsForDraco(),this._material){const t=this._material.getUniforms(e);for(const e in t)T$8(t,e)&&Object.defineProperty(this._realUniforms,e,{enumerable:!0,configurable:!0,get:function(){return t[e]}})}const t=this.uniforms;for(const e in this.uniforms)T$8(this.uniforms,e)&&Object.defineProperty(this._realUniforms,e,{enumerable:!0,configurable:!0,get:function(){return t[e]}});this._dirtyUniforms=!1,this._dirtyGeometry=!1,this._materialVer=this._material&&this._material.version}return this._realUniforms.modelMatrix=h$2(this._localTransform)?this._localTransform():this._localTransform,this._realUniforms.positionMatrix=h$2(this._positionMatrix)?this._positionMatrix():this._positionMatrix,this._realUniforms}_getUniformsForDraco(){const e=this._geometry,t=e.data[e.desc.positionAttribute],n=e.data[e.desc.uv0Attribute],r=e.data[e.desc.normalAttribute];if(t&&t.quantization){const e=t.quantization,n=e.range/(1<<e.quantizationBits);this._defineUniformsProperty(this._realUniforms,"minValues_pos",e.minValues),this._defineUniformsProperty(this._realUniforms,"gltf_u_dec_position_normConstant",n)}if(n&&n.quantization){const e=n.quantization;this._defineUniformsProperty(this._realUniforms,"minValues_tex",e.minValues),this._defineUniformsProperty(this._realUniforms,"gltf_u_dec_texcoord_0_normConstant",e.range/(1<<e.quantizationBits))}r&&r.quantization&&this._defineUniformsProperty(this._realUniforms,"gltf_u_dec_normal_rangeConstant",(1<<r.quantization.quantizationBits)-1)}_defineUniformsProperty(e,t,n){d$4(e[t])||Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return n}})}getMaterial(){return this._material}getElements(){return this._geometry.getElements()}_getREGLAttrData(e,t){return this._geometry.getREGLData(e,t,this.disableVAO)}getREGLProps(e,t){const n=this.getUniforms(e);return v$7(n,this._getREGLAttrData(e,t)),A$7(e)&&!this.disableVAO||(n.elements=this._geometry.getElements()),n.meshProperties=this.properties,n.meshConfig=this.config,n.count=this._geometry.getDrawCount(),n.offset=this._geometry.getDrawOffset(),n.primitive=this._geometry.getPrimitive(),n}dispose(){return delete this._geometry,delete this._material,this.uniforms={},this}isValid(){return this._geometry&&!this._geometry.isDisposed()&&(!this._material||!this._material.isDisposed())}getBoundingBox(){return this._bbox||this.updateBoundingBox(),multiply$5(fe$4,this._localTransform,this._positionMatrix),exactEquals$5(fe$4,this._currentTransform)&&this._geometry.boundingBox.equals(this._geoBox)||this.updateBoundingBox(),this._bboxArr}updateBoundingBox(){const e=this._geometry.boundingBox;this._bbox||(this._bbox=new X$7),this._bboxArr||(this._bboxArr=[[],[]]),this._geoBox||(this._geoBox=new X$7),X$7.copy(this._bbox,e),this._bbox.updateVertex(),"InstancedMesh"===this.constructor.name?(this._bbox.transform(this._localTransform,this._positionMatrix),this._currentTransform=multiply$5(this._currentTransform||[],this._positionMatrix,this._localTransform)):(this._bbox.transform(this._positionMatrix,this._localTransform),this._currentTransform=multiply$5(this._currentTransform||[],this._localTransform,this._positionMatrix)),X$7.copy(this._geoBox,e),copy$4(this._bboxArr[0],this._bbox.min),copy$4(this._bboxArr[1],this._bbox.max)}_createDefinesKey(e){const t=[];for(const n in e)t.push(n,e[n]);return t.join(",")}_incrVersion(){this._version++}getMemorySize(){return(this.geometry&&this.geometry.getMemorySize()||0)+(this.material&&this.material.getMemorySize()||0)}}de$4.prototype.getWorldTransform=function(){const e=[];return function(){const n=this.parent;return n?multiply$5(e,n.getWorldTransform(),this._localTransform):this._localTransform}}();class he$4 extends de$4{constructor(e,t,n,r,i={}){super(n,r,i),this._instanceCount=t,this.instancedData=e||{},this._checkInstancedProp(),this._vao={}}get instanceCount(){return this._instanceCount}set instanceCount(e){this._incrVersion(),this._instanceCount=e}getMemorySize(){return super.getMemorySize()+this._getInstanceMemorySize()}_getInstanceMemorySize(){let e=0;for(const t in this.instancedData)T$8(this.instancedData,t)&&(e+=S$8(this.instancedData[t]));return e}_checkInstancedProp(){for(const e in this.instancedData)if(this.geometry.data[e])throw new Error(`Duplicate attribute ${e} defined in geometry and instanced data`)}_getREGLAttrData(e,t){const n=this.geometry.getAttrData(t);if(A$7(e)){const r=t.key;if(!this._vao[r]||this._instanceDataUpdated){const i=t.map((e=>e.name)),o=[];for(let e=0;e<i.length;e++){const t=n[i[e]];o.push(t&&t.buffer?t.buffer:this.instancedData[i[e]])}const a={attributes:o,primitive:this.geometry.getPrimitive()};this._vao[r]?this._vao[r].vao(a):this._vao[r]={vao:e.vao(a)},delete this._instanceDataUpdated}return this._vao[r]}return n}getDefines(){const e=super.getDefines();return e.HAS_INSTANCE=1,e}getCommandKey(e){return"i_"+super.getCommandKey(e)}updateInstancedData(e,t){const n=this.instancedData[e];return n?(this._incrVersion(),this.instancedData[e]=t,n.buffer&&n.buffer.destroy&&n.buffer.destroy(),this._instanceDataUpdated=!0,this):this}generateInstancedBuffers(e){const t=this.instancedData,n={};for(const r in t)t[r]&&(void 0!==t[r].buffer&&t[r].buffer.destroy?(n[r]=t[r],n[r].divisor&&(n[r].divisor=1)):n[r]=t[r].destroy?{buffer:t[r],divisor:1}:{buffer:e.buffer({data:t[r],dimension:t[r].length/this._instanceCount}),divisor:1});return this.instancedData=n,this}getREGLProps(e,t){const n=super.getREGLProps(e,t);return A$7(e)||v$7(n,this.instancedData),n.elements=this.geometry.getElements(),n.instances=this._instanceCount,n}disposeInstanceData(){const e=this.instancedData;if(e)for(const t in e)e[t]&&e[t].destroy&&!e[t][D$8]&&(e[t][D$8]=1,e[t].destroy());this.instancedData={};for(const e in this._vao)this._vao[e].vao.destroy();this._vao={}}_getBytesPerElement(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4}throw new Error("unsupported data type: "+e)}}const me$4={getArrayBuffer:(e,t)=>me$4.get(e,{responseType:"arraybuffer"},t),get:function(e,t,n){const r=me$4._getClient(n);if(r.open("GET",e,!0),t){for(const e in t.headers)r.setRequestHeader(e,t.headers[e]);r.withCredentials="include"===t.credentials,t.responseType&&(r.responseType=t.responseType)}return r.send(null),r},_wrapCallback:function(e,t){return function(){4===e.readyState&&(200===e.status?"arraybuffer"===e.responseType?0===e.response.byteLength?t(new Error("http status 200 returned without content.")):t(null,{data:e.response,cacheControl:e.getResponseHeader("Cache-Control"),expires:e.getResponseHeader("Expires"),contentType:e.getResponseHeader("Content-Type")}):t(null,e.responseText):t(new Error(e.statusText+","+e.status)))}},_getClient:function(e){let t;try{t=new XMLHttpRequest}catch(e){try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return t.onreadystatechange=me$4._wrapCallback(t,e),t}};var ve$4=R$a(class{constructor(e){this.defaultTexture=e,this.defaultCubeTexture=new Array(6),this.resources={}}get(e){return Array.isArray(e)?this._loadImages(e):this._loadImage(e)}getArrayBuffer(e){if(Array.isArray(e)){const t=e.map((e=>this.getArrayBuffer(e)));return Promise.all(t)}return new Promise(((t,n)=>{me$4.getArrayBuffer(e,((r,i)=>{r?n(r):t({url:e,data:i})}))}))}disposeRes(e){return Array.isArray(e)?e.forEach((e=>this._disposeOne(e))):this._disposeOne(e),this}isLoading(){return this._count&&this._count>0}getDefaultTexture(e){return Array.isArray(e)?this._getBlankTextures(e.length):this.defaultTexture}_disposeOne(e){const t=this.resources;t[e]&&(t[e].count--,t[e].count<=0&&delete t[e])}_loadImage(e){const t=this.resources;return t[e]?Promise.resolve({url:e,data:t[e].image}):new Promise(((n,r)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=function(){t[e]={image:i,count:1},n({url:e,data:i})},i.onerror=function(e){r(e)},i.onabort=function(){r(`image(${e}) loading aborted.`)},i.src=e}))}_loadImages(e){const t=e.map((e=>this._loadImage(e,!0)));return Promise.all(t)}_getBlankTextures(e){const t=new Array(e);for(let e=0;e<6;e++)t.push(this.defaultTexture);return t}});const _e$4=[],ge$4=[];let be$4=0;class pe$4{constructor(e){this._id=be$4++,this.sortedMeshes={},this.setMeshes(e),this._compareBinded=this._compare.bind(this),this.dirty()}setMeshes(e){if(this.clear(),!e||Array.isArray(e)&&!e.length||e===this.meshes)return this;e=Array.isArray(e)?e:[e],this.meshes=[];for(let t=0;t<e.length;t++){const n=e[t];n&&(n._scenes=n._scenes||{},n._scenes[this._id]=1,this.meshes.push(n))}return this.dirty(),this}addMesh(e){return!e||Array.isArray(e)&&!e.length||(Array.isArray(e)?e.forEach((e=>{e._scenes=e._scenes||{},e._scenes[this._id]||(e._scenes[this._id]=1,this.meshes.push(e),this.dirty())})):(e._scenes=e._scenes||{},e._scenes[this._id]||(e._scenes[this._id]=1,this.meshes.push(e),this.dirty()))),this}removeMesh(e){if(!e||Array.isArray(e)&&!e.length)return this;if(Array.isArray(e)){let t=!1;for(let n=0;n<e.length;n++)e[n]._scenes&&e[n]._scenes[this._id]&&(t=!0,this.dirty(),delete e[n]._scenes[this._id]);t&&(this.meshes=this.meshes.filter((t=>e.indexOf(t)<0)))}else{if(!e._scenes||!e._scenes[this._id])return this;const t=this.meshes.indexOf(e);t>=0&&this.meshes.splice(t,1),delete e._scenes[this._id],this.dirty()}return this}getMeshes(){return this.meshes}clear(){if(this.meshes)for(let e=0;e<this.meshes.length;e++)delete this.meshes[e]._scenes[this._id];return this.meshes=[],this.sortedMeshes.opaques=[],this.sortedMeshes.transparents=[],this}dirty(){return this._dirty=!0,this}sortMeshes(e){const t=this.meshes;this.sortFunction&&t.sort(this.sortFunction);let n=this.sortedMeshes.transparents;if(this._dirty){const e=this.sortedMeshes.opaques=[];n=this.sortedMeshes.transparents=[];for(let r=0,i=t.length;r<i;r++)t[r].transparent?n.push(t[r]):e.push(t[r])}e&&n.length>1&&(this._cameraPosition=e,n.sort(this._compareBinded),delete this._cameraPosition),this._dirty=!1}getSortedMeshes(){return this._dirty&&this.sortMeshes(),this.sortedMeshes}_compare(e,t){return transformMat4$2(_e$4,e.geometry.boundingBox.getCenter(),e.localTransform),transformMat4$2(ge$4,t.geometry.boundingBox.getCenter(),t.localTransform),dist$2(ge$4,this._cameraPosition)-dist$2(_e$4,this._cameraPosition)}}var xe$4=String.fromCharCode;function ye$4(e,t,n,r){if(e[3]>0){var i=Math.pow(2,e[3]-128-8+r);t[n+0]=e[0]*i,t[n+1]=e[1]*i,t[n+2]=e[2]*i}else t[n+0]=0,t[n+1]=0,t[n+2]=0;return t[n+3]=1,t}function Ae$4(e,t,n){let r=e[t]/n,i=e[t+1]/n,o=e[t+2]/n,a=y$6(Math.max(Math.max(r,i),Math.max(o,1e-6)),0,1);a=Math.ceil(255*a)/255,e[t]=Math.min(255,r/a*255),e[t+1]=Math.min(255,i/a*255),e[t+2]=Math.min(255,o/a*255),e[t+3]=Math.min(255,255*a)}function Te$4(e,t,n,r){for(var i,o,a=0,s=0,c=r;c>0;)if(e[s][0]=t[n++],e[s][1]=t[n++],e[s][2]=t[n++],e[s][3]=t[n++],1===e[s][0]&&1===e[s][1]&&1===e[s][2]){for(var l=e[s][3]<<a>>>0;l>0;l--)(o=e[s])[0]=(i=e[s-1])[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],s++,c--;a+=8}else s++,c--,a=0;return n}function Se$4(e,t,n,r){if(r<8|r>32767)return Te$4(e,t,n,r);var i=t[n++];if(2!==i)return Te$4(e,t,n-1,r);if(e[0][1]=t[n++],e[0][2]=t[n++],i=t[n++],(e[0][2]<<8>>>0|i)>>>0!==r)return null;for(let i=0;i<4;i++)for(let s=0;s<r;){var o=t[n++];if(o>128){o=(127&o)>>>0;for(var a=t[n++];o--;)e[s++][i]=a}else for(;o--;)e[s++][i]=t[n++]}return n}function Me$4(e,t=0,n=9){var r=new Uint8Array(e),i=r.length;if("#?"!==function(e,t,n){for(var r="",i=0;i<2;i++)r+=xe$4(e[i]);return r}(r))return null;for(var o=2;o<i&&("\n"!==xe$4(r[o])||"\n"!==xe$4(r[o+1]));o++);if(o>=i)return null;o+=2;for(var a="";o<i;o++){var s=xe$4(r[o]);if("\n"===s)break;a+=s}var c=a.split(" "),l=parseInt(c[1]),f=parseInt(c[3]);if(!f||!l)return null;for(var u=o+1,d=[],h=0;h<f;h++){d[h]=[];for(var m=0;m<4;m++)d[h][m]=0}var v=0,_=new Array(f*l*4),g=0;for(let e=0;e<l;e++){if(!(u=Se$4(d,r,u,f)))return null;for(let e=0;e<f;e++)ye$4(d[e],_,g,t),v=Math.max(v,_[g],_[g+1],_[g+2],_[g+3]),g+=4}v=Math.min(v,n),g=0;for(let e=0;e<l;e++)for(let e=0;e<f;e++)Ae$4(_,g,v),g+=4;return{width:f,height:l,pixels:_,rgbmRange:v}}const Ee$4=["points","lines","line strip","line loop","triangles","triangle strip","triangle fan"];function Oe$4(e){return Ee$4[e]}const Ce$4={5121:"uint8",5123:"uint16",5125:"uint32",5126:"float",36193:"half float"};function Pe$4(e){return Ce$4[e]}const we$4={6406:"alpha",6407:"rgb",6408:"rgba",6409:"luminance",6410:"luminance alpha",33776:"rgb s3tc dxt1",33777:"rgba s3tc dxt1",33778:"rgba s3tc dxt3",33779:"rgba s3tc dxt5",35840:"rgb pvrtc 4bppv1",35841:"rgb pvrtc 2bppv1",35842:"rgba pvrtc 4bppv1",35843:"rgba pvrtc 2bppv1",35986:"rgb atc",35987:"rgba atc explicit alpha",34798:"rgba atc interpolated alpha",36196:"rgb etc1"};function Ie$4(e){return we$4[e]}const Re$4={9729:"linear",9728:"nearest"};function De$4(e){return Re$4[e]}const Ne$4={9729:"linear",9728:"nearest",9984:"nearest mipmap nearest",9985:"linear mipmap nearest",9986:"nearest mipmap linear",9987:"linear mipmap linear"};function Fe$4(e){return Ne$4[e]}const Le$4={10497:"repeat",33071:"clamp",33648:"mirror"};function He$4(e){return Le$4[e]}const Be$4="__reshader_webgl_buffer",ze$4="__reshader_webgl_tex";function ke$4(e,t,n){let r;if(p$8(t)?t.buffer&&void 0!==t.byteOffset&&(r=t):t.array&&t.array.buffer&&void 0!==t.array.byteOffset&&(r=t.array),!r)return null;const i=r.buffer,o=r.byteOffset;i[Be$4]||(i[Be$4]={});let a=i[Be$4][o];if(!a){const t={};n&&v$7(t,n),t.data=r,a=e.buffer(t),i[Be$4][o]=a}return a}function Ge$4(e,t){const n=t.data;if(!n||!n.buffer)return e.texture(t);const r=n.buffer,i=n.byteOffset;r[ze$4]||(r[ze$4]={});let o=r[ze$4][i];return o||(o=e.texture(t),r[ze$4][i]=o),o}var Ue$4=Object.freeze({__proto__:null,getPrimitive:Oe$4,getMaterialType:Pe$4,getMaterialFormat:Ie$4,getTextureMagFilter:De$4,getTextureMinFilter:Fe$4,getTextureWrap:He$4,getUniqueREGLBuffer:ke$4,getUniqueTexture:Ge$4});class je$4 extends F$8{onLoad({data:e}){const t=this.config;t&&(t.hdr?(e=Me$4(e.data,0,t.maxRange),this.rgbmRange=e.rgbmRange,t.data=e.pixels):t.data=e,t.width=t.width||e.width,t.height=t.height||e.height,this._updateREGL())}createREGLTexture(e){if(p$8(this.config.data)||p$8(this.config.mipmap)){const t=Ge$4(e,this.config);return t._reshader_refCount||(t._reshader_refCount=0),t._reshader_refCount++,t}return e.texture(this.config)}}class Xe$4 extends Z$7{constructor(e){super({aPosition:new(x$8(e=e||0))([-1,-1,e,1,-1,e,-1,1,e,1,1,e]),aNormal:new Int8Array([0,0,1,0,0,1,0,0,1,0,0,1])},new Uint16Array([0,1,3,3,2,0]))}}const Ke$4={vsm_shadow_vert:"\nuniform mat4 shadow_lightProjViewModelMatrix;\nvarying vec4 shadow_vLightSpacePos;\nvoid shadow_computeShadowPars(vec4 position) {\n    shadow_vLightSpacePos = shadow_lightProjViewModelMatrix * position;\n}",vsm_shadow_frag:"\nuniform sampler2D shadow_shadowMap;\nuniform float shadow_opacity;\nuniform vec3 shadow_color;\n#if defined(USE_ESM)\n    uniform float esm_shadow_threshold;\n#endif\nvarying vec4 shadow_vLightSpacePos;\n#ifdef PACK_FLOAT\n    #include <common_pack_float>\n#endif\n#if defined(USE_ESM)\nfloat esm(vec3 projCoords, vec4 shadowTexel) {\n    float compare = projCoords.z;\n    float c = 120.0;\n    #ifdef PACK_FLOAT\n        float depth = common_decodeDepth(shadowTexel);\n        if (depth >= 1.0 - 1E-6 || compare <= depth) {\n            return 1.0;\n        }\n    #else\n        float depth = shadowTexel.r;\n    #endif\n    depth = exp(-c * min(compare - depth, 0.05));\n    return clamp(depth, esm_shadow_threshold, 1.0);\n}\n#endif\n#if defined(USE_VSM)\nfloat vsm_shadow_chebyshevUpperBound(vec3 projCoords, vec4 shadowTexel){\n    vec2 moments = shadowTexel.rg;\n    float distance = projCoords.z;\n    if (distance >= 1.0 || distance <= moments.x)\n        return 1.0 ;\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, 0.00002);\n    float d = distance - moments.x;\n    float p_max = variance / (variance + d * d);\n    return p_max;\n}\n#endif\nfloat shadow_computeShadow_coeff(sampler2D shadowMap, vec3 projCoords) {\n    vec2 uv = projCoords.xy;\n    vec4 shadowTexel = texture2D(shadowMap, uv);\n    #if defined(USE_ESM)\n        float esm_coeff = esm(projCoords, shadowTexel);\n        float coeff = esm_coeff * esm_coeff;\n    #endif\n    #if defined(USE_VSM)\n        float vsm_coeff = vsm_shadow_chebyshevUpperBound(projCoords, shadowTexel);\n        float coeff = vsm_coeff;\n    #endif\n    return 1.0 - (1.0 - coeff) * shadow_opacity;\n}\nfloat shadow_computeShadow() {\n    vec3 projCoords = shadow_vLightSpacePos.xyz / shadow_vLightSpacePos.w;\n    projCoords = projCoords * 0.5 + 0.5;\n    if(projCoords.z >= 1.0 || projCoords.x < 0.0 || projCoords.x > 1.0 || projCoords.y < 0.0 || projCoords.y > 1.0) return 1.0;\n    return shadow_computeShadow_coeff(shadow_shadowMap, projCoords);\n}\nvec3 shadow_blend(vec3 color, float coeff) {\n    color = color * coeff + shadow_color * shadow_opacity * (1.0 - coeff);\n    return color;\n}",fbo_picking_vert:"\n#ifdef ENABLE_PICKING\n#if HAS_PICKING_ID == 1\nattribute float aPickingId;\n#elif HAS_PICKING_ID == 2\nuniform float uPickingId;\n#endif\nvarying float vPickingId;\nvarying float vFbo_picking_viewZ;\nvarying float vFbo_picking_visible;\n#endif\nvoid fbo_picking_setData(float viewPosZ, bool visible) {\n    #ifdef ENABLE_PICKING\n    #if HAS_PICKING_ID == 1\n       vPickingId = aPickingId;\n    #elif HAS_PICKING_ID == 2\n        vPickingId = uPickingId;\n    #endif\n        vFbo_picking_viewZ = viewPosZ;\n    #endif\n    vFbo_picking_visible = visible ? 1.0 : 0.0;\n}",common_pack_float:"const float COMMON_FLOAT_MAX =  1.70141184e38;\nconst float COMMON_FLOAT_MIN = 1.17549435e-38;\nfloat common_packFloat(vec4 val){\n    vec4 scl = floor(255.0 * val + 0.5);\n    float sgn = (scl.a < 128.0) ? 1.0 : -1.0;\n    float exn = mod(scl.a * 2.0, 256.0) + floor(scl.b / 128.0) - 127.0;\n    float man = 1.0 +\n        (scl.r / 8388608.0) +\n        (scl.g / 32768.0) +\n        mod(scl.b, 128.0) / 128.0;\n    return sgn * man * pow(2.0, exn);\n}\nvec4 common_unpackFloat(highp float v) {\n    highp float av = abs(v);\n    if(av < COMMON_FLOAT_MIN) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > COMMON_FLOAT_MAX) {\n        return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\n    } else if(v < -COMMON_FLOAT_MAX) {\n        return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\n    }\n    highp vec4 c = vec4(0,0,0,0);\n    highp float e = floor(log2(av));\n    highp float m = av * pow(2.0, -e) - 1.0;\n    c[1] = floor(128.0 * m);\n    m -= c[1] / 128.0;\n    c[2] = floor(32768.0 * m);\n    m -= c[2] / 32768.0;\n    c[3] = floor(8388608.0 * m);\n    highp float ebias = e + 127.0;\n    c[0] = floor(ebias / 2.0);\n    ebias -= c[0] * 2.0;\n    c[1] += floor(ebias) * 128.0;\n    c[0] += 128.0 * step(0.0, -v);\n    return c / 255.0;\n}\nvec4 common_encodeDepth(const in float depth) {\n    float alpha = 1.0;\n    vec4 pack = vec4(0.0);\n    pack.a = alpha;\n    const vec3 code = vec3(1.0, 255.0, 65025.0);\n    pack.rgb = vec3(code * depth);\n    pack.gb = fract(pack.gb);\n    pack.rg -= pack.gb * (1.0 / 256.0);\n    pack.b -= mod(pack.b, 4.0 / 255.0);\n    return pack;\n}\nfloat common_decodeDepth(const in vec4 pack) {\n    return pack.r + pack.g / 255.0;\n}",invert_matrix:"mat4 invert_matrix(mat4 matrix) {\n    #if __VERSION__ == 300\n        return inverse(matrix);\n    #else\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\n        float a00 = vector1.x, a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\n        float a10 = vector2.x, a11 = vector2.y, a12 = vector2.z, a13 = vector2.w;\n        float a20 = vector3.x, a21 = vector3.y, a22 = vector3.z, a23 = vector3.w;\n        float a30 = vector4.x, a31 = vector4.y, a32 = vector4.z, a33 = vector4.w;\n        float b00 = a00 * a11 - a01 * a10;\n        float b01 = a00 * a12 - a02 * a10;\n        float b02 = a00 * a13 - a03 * a10;\n        float b03 = a01 * a12 - a02 * a11;\n        float b04 = a01 * a13 - a03 * a11;\n        float b05 = a02 * a13 - a03 * a12;\n        float b06 = a20 * a31 - a21 * a30;\n        float b07 = a20 * a32 - a22 * a30;\n        float b08 = a20 * a33 - a23 * a30;\n        float b09 = a21 * a32 - a22 * a31;\n        float b10 = a21 * a33 - a23 * a31;\n        float b11 = a22 * a33 - a23 * a32;\n        float det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        det = 1.0 / det;\n        mat4 m = mat4(\n            (a11 * b11 - a12 * b10 + a13 * b09) * det,\n            (a02 * b10 - a01 * b11 - a03 * b09) * det,\n            (a31 * b05 - a32 * b04 + a33 * b03) * det,\n            (a22 * b04 - a21 * b05 - a23 * b03) * det,\n            (a12 * b08 - a10 * b11 - a13 * b07) * det,\n            (a00 * b11 - a02 * b08 + a03 * b07) * det,\n            (a32 * b02 - a30 * b05 - a33 * b01) * det,\n            (a20 * b05 - a22 * b02 + a23 * b01) * det,\n            (a10 * b10 - a11 * b08 + a13 * b06) * det,\n            (a01 * b08 - a00 * b10 - a03 * b06) * det,\n            (a30 * b04 - a31 * b02 + a33 * b00) * det,\n            (a21 * b02 - a20 * b04 - a23 * b00) * det,\n            (a11 * b07 - a10 * b09 - a12 * b06) * det,\n            (a00 * b09 - a01 * b07 + a02 * b06) * det,\n            (a31 * b01 - a30 * b03 - a32 * b00) * det,\n            (a20 * b03 - a21 * b01 + a22 * b00) * det\n        );\n        return m;\n    #endif\n}\nmat4 transpose_matrix(mat4 matrix) {\n    #if __VERSION__ == 300\n        return transpose(matrix);\n    #else\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\n        float a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\n        float a12 = vector2.z, a13 = vector2.w;\n        float a23 = vector3.w;\n        mat4 m = mat4(\n            vector1.x,\n            vector2.x,\n            vector3.x,\n            vector4.x,\n            a01,\n            vector2.y,\n            vector3.y,\n            vector4.y,\n            a02,\n            a12,\n            vector3.z,\n            vector4.z,\n            a03,\n            a13,\n            a23,\n            vector4.w\n        );\n        return m;\n    #endif\n}",get_output:"#include <invert_matrix>\n#include <draco_decode_vert>\n#ifdef HAS_INSTANCE\n    #include <instance_vert>\n    #ifdef HAS_INSTANCE_COLOR\n        varying vec4 vInstanceColor;\n    #endif\n#endif\n#ifdef HAS_SKIN\n    uniform int skinAnimation;\n    #include <skin_vert>\n#endif\n#ifdef HAS_MORPH\n    attribute vec3 POSITION0;\n    attribute vec3 POSITION1;\n    attribute vec3 POSITION2;\n    attribute vec3 POSITION3;\n    attribute vec3 POSITION4;\n    attribute vec3 POSITION5;\n    attribute vec3 POSITION6;\n    attribute vec3 POSITION7;\n    #ifdef HAS_MORPHNORMALS\n        attribute vec3 NORMAL0;\n        attribute vec3 NORMAL1;\n        attribute vec3 NORMAL2;\n        attribute vec3 NORMAL3;\n    #endif\n    uniform vec4 morphWeights1;\n    uniform vec4 morphWeights2;\n#endif\nmat4 getPositionMatrix() {\n    mat4 worldMatrix;\n    #ifdef HAS_INSTANCE\n        #ifdef HAS_INSTANCE_COLOR\n            vInstanceColor = instance_getInstanceColor();\n        #endif\n        mat4 attributeMatrix = instance_getAttributeMatrix();\n        #ifdef HAS_SKIN\n            if (skinAnimation == 1) {\n                worldMatrix = attributeMatrix * positionMatrix * skin_getSkinMatrix();\n            } else {\n                worldMatrix = attributeMatrix * positionMatrix;\n            }\n        #else\n            worldMatrix = attributeMatrix * positionMatrix;\n        #endif\n    #else\n        #ifdef HAS_SKIN\n            if (skinAnimation == 1) {\n                worldMatrix = skin_getSkinMatrix() * positionMatrix;\n            } else {\n                worldMatrix = positionMatrix;\n            }\n        #else\n            worldMatrix = positionMatrix;\n        #endif\n    #endif\n    return worldMatrix;\n}\nvec4 getPosition(vec3 aPosition) {\n    vec3 position = getPositionAsDraco(aPosition);\n    #ifdef HAS_MORPH\n        vec4 POSITION = vec4(position + morphWeights1[0] * POSITION0 + morphWeights1[1] * POSITION1 + morphWeights1[2] * POSITION2 + morphWeights1[3] * POSITION3\n        + morphWeights2[0] * POSITION4 + morphWeights2[1] * POSITION5 + morphWeights2[2] * POSITION6 + morphWeights2[3] * POSITION7\n        , 1.0);\n    #else\n        vec4 POSITION = vec4(position, 1.0);\n    #endif\n    return POSITION;\n}\nvec3 appendMorphNormal(vec3 NORMAL) {\n    #ifdef HAS_MORPHNORMALS\n        vec3 normal = NORMAL + morphWeights1[0] * NORMAL0 + morphWeights1[1] * NORMAL1 + morphWeights1[2] * NORMAL2 + morphWeights1[3] * NORMAL3;\n    #else\n        vec3 normal = NORMAL;\n    #endif\n    return normal;\n}",instance_vert:"attribute vec4 instance_vectorA;\nattribute vec4 instance_vectorB;\nattribute vec4 instance_vectorC;\nmat4 instance_getAttributeMatrix() {\n    mat4 mat =  mat4(\n        instance_vectorA.x, instance_vectorB.x, instance_vectorC.x, 0.0,\n        instance_vectorA.y, instance_vectorB.y, instance_vectorC.y, 0.0,\n        instance_vectorA.z, instance_vectorB.z, instance_vectorC.z, 0.0,\n        instance_vectorA.w, instance_vectorB.w, instance_vectorC.w, 1.0\n    );\n    return mat;\n}\n#ifdef HAS_INSTANCE_COLOR\n    attribute vec4 instance_color;\n    vec4 instance_getInstanceColor() {\n        return instance_color;\n    }\n#endif",skin_vert:"attribute vec4 WEIGHTS_0;\nattribute vec4 JOINTS_0;\nuniform sampler2D jointTexture;\nuniform vec2 jointTextureSize;\nuniform float numJoints;\n#define ROW0_U ((0.5 + 0.0) / 4.)\n#define ROW1_U ((0.5 + 1.0) / 4.)\n#define ROW2_U ((0.5 + 2.0) / 4.)\n#define ROW3_U ((0.5 + 3.0) / 4.)\nmat4 skin_getBoneMatrix(float jointNdx) {\n    float v = (jointNdx + 0.5) / numJoints;\n    return mat4(\n        texture2D(jointTexture, vec2(ROW0_U, v)),\n        texture2D(jointTexture, vec2(ROW1_U, v)),\n        texture2D(jointTexture, vec2(ROW2_U, v)),\n        texture2D(jointTexture, vec2(ROW3_U, v)));\n}\nmat4 skin_getSkinMatrix() {\n        mat4 skinMatrix = skin_getBoneMatrix(JOINTS_0[0]) * WEIGHTS_0[0] +\n                        skin_getBoneMatrix(JOINTS_0[1]) * WEIGHTS_0[1] +\n                        skin_getBoneMatrix(JOINTS_0[2]) * WEIGHTS_0[2] +\n                        skin_getBoneMatrix(JOINTS_0[3]) * WEIGHTS_0[3];\n        return skinMatrix;\n}",heatmap_render_vert:"#ifdef HAS_HEATMAP\nvarying vec2 heatmap_vTexCoord;\nvoid heatmap_compute(mat4 matrix, vec3 position) {\n    vec4 pos = matrix * vec4(position.xy, 0., 1.);\n    heatmap_vTexCoord = (1. + pos.xy / pos.w) / 2.;\n}\n#endif",heatmap_render_frag:"#ifdef HAS_HEATMAP\nuniform sampler2D heatmap_inputTexture;\nuniform sampler2D heatmap_colorRamp;\nuniform float heatmap_heatmapOpacity;\nvarying vec2 heatmap_vTexCoord;\nvec4 heatmap_getColor(vec4 color) {\n    float t = texture2D(heatmap_inputTexture, heatmap_vTexCoord).r;\n    vec4 heatmapColor = texture2D(heatmap_colorRamp, vec2(t, 0.5)) * heatmap_heatmapOpacity;\n    return color * (1.0 - heatmapColor.a) + heatmapColor * heatmapColor.a;\n}\n#endif",line_extrusion_vert:"#ifdef IS_LINE_EXTRUSION\n    #define ALTITUDE_SCALE 32767.0;\n    #define EXTRUDE_SCALE 63.0;\n    attribute vec2 aExtrude;\n    #ifdef HAS_LINE_WIDTH\n        attribute float aLineWidth;\n    #else\n        uniform float lineWidth;\n    #endif\n    #ifdef HAS_LINE_HEIGHT\n        attribute float aLineHeight;\n    #else\n        uniform float lineHeight;\n    #endif\n    uniform float linePixelScale;\n    vec3 getLineExtrudePosition(vec3 position) {\n        #ifdef HAS_LINE_WIDTH\n            float lineWidth = aLineWidth / 2.0;\n        #endif\n        #ifdef HAS_LINE_HEIGHT\n            float lineHeight = aLineHeight / 10.0;\n        #endif\n        float halfwidth = lineWidth / 2.0;\n        float outset = halfwidth;\n        vec2 dist = outset * aExtrude / EXTRUDE_SCALE;\n        position.z *= lineHeight / ALTITUDE_SCALE;\n        return position + vec3(dist, 0.0) * linePixelScale;\n    }\n#endif",gl2_vert:"#if __VERSION__ == 300\n    #define texture2D texture\n    #define varying out\n    #define attribute in\n#endif",gl2_frag:"#if __VERSION__ == 300\n    #define varying in\n    #define gl_FragDepthEXT gl_FragDepth\n    #define texture2D texture\n    #define textureCube texture\n    #define texture2DProj textureProj\n    #define texture2DLodEXT textureLod\n    #define texture2DProjLodEXT textureProjLod\n    #define textureCubeLodEXT textureLod\n    #define texture2DGradEXT textureGrad\n    #define texture2DProjGradEXT textureProjGrad\n    #define textureCubeGradEXT textureGrad\n    #define texture2D texture\n    out vec4 glFragColor;\n#else\n    vec4 glFragColor;\n#endif",hsv_frag:"\nconst mediump vec4 HSV_K0 = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nconst mediump vec4 HSV_K1 = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nconst mediump float HSV_E = 1.0e-10;\nvec3 hsv_rgb2hsv(vec3 c) {\n    vec4 K = HSV_K0;\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n    float d = q.x - min(q.w, q.y);\n    float e = HSV_E;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv_hsv2rgb(vec3 c) {\n    vec4 K = HSV_K1;\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 hsv_apply(vec4 c, vec3 hsvOffset) {\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\n    hsv += hsv * hsvOffset;\n    hsv = clamp(hsv, 0.0, 1.0);\n    return vec4(hsv_hsv2rgb(hsv), c.a);\n}\nvec3 hsv_apply(vec3 c, vec3 hsvOffset) {\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\n    hsv += hsv * hsvOffset;\n    hsv = clamp(hsv, 0.0, 1.0);\n    return hsv_hsv2rgb(hsv);\n}\nmat4 contrastMatrix(float contrast)\n{\n    float t = (1.0 - contrast) / 2.0;\n    return mat4(\n        contrast, 0., 0., 0.,\n        0., contrast, 0., 0.,\n        0., 0., contrast, 0.,\n        t, t, t, 1\n    );\n}",snow_frag:"#ifdef HAS_SNOW\n    float lerp(float a, float b, float w) {\n        return a + w * (b - a);\n    }\n    vec3 snow(vec4 sceneColor, vec3 normalColor, float height) {\n        float snowIntense = normalColor.b;\n        vec3 fixedC = vec3(1.0, 1.0, 1.0);\n        if (height < 1.0) {\n            float r = lerp(0.5, fixedC.x, snowIntense);\n            float g = lerp(0.5, fixedC.y, snowIntense);\n            float b = lerp(0.5, fixedC.z, snowIntense);\n            return vec3(r, g, b);\n        } else {\n            float r = lerp(sceneColor.r, fixedC.x, snowIntense);\n            float g = lerp(sceneColor.g, fixedC.y, snowIntense);\n            float b = lerp(sceneColor.b, fixedC.z, snowIntense);\n            return vec3(r, g, b);\n        }\n    }\n#endif",draco_decode_vert:"#if defined(HAS_TANGENT)\n    attribute vec4 aTangent;\n#elif defined(HAS_NORMAL)\n    #ifdef HAS_DECODE_NORMAL\n        attribute vec2 aNormal;\n        uniform float gltf_u_dec_normal_rangeConstant;\n    #else\n        attribute vec3 aNormal;\n    #endif\n#endif\n#ifdef HAS_DECODE_POSITION\n    uniform float gltf_u_dec_position_normConstant;\n    uniform vec3 minValues_pos;\n    vec3 decodeDracoPosition(vec3 aPosition) {\n        return minValues_pos + aPosition * gltf_u_dec_position_normConstant;\n    }\n#endif\n#ifdef HAS_DECODE_TEXCOORD\n    uniform vec2 minValues_tex;\n    uniform float gltf_u_dec_texcoord_0_normConstant;\n    vec2 decodeDracoTexcoord(vec2 aTexCoord) {\n        return minValues_tex + aTexCoord * gltf_u_dec_texcoord_0_normConstant;\n    }\n#endif\n#ifdef HAS_DECODE_NORMAL\n    float czm_signNotZero(float value) {\n        return value >= 0.0 ? 1.0 : -1.0;\n    }\n    vec2 czm_signNotZero(vec2 value) {\n        return vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n    }\n    vec3 decodeDracoNormal(vec2 encoded, float range)\n    {\n        if (encoded.x == 0.0 && encoded.y == 0.0) {\n            return vec3(0.0, 0.0, 0.0);\n        }\n        encoded = encoded / range * 2.0 - 1.0;\n        vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n        if (v.z < 0.0) {\n            v.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n        }\n        return normalize(v);\n    }\n    vec3 getNormal(vec2 aNormal) {\n        return decodeDracoNormal(aNormal, gltf_u_dec_normal_rangeConstant).zxy;\n    }\n#endif\nvec3 getPositionAsDraco(vec3 aPosition) {\n    #ifdef HAS_DECODE_POSITION\n        return decodeDracoPosition(aPosition);\n    #else\n        return aPosition;\n    #endif\n}\nvec2 getTexcoord(vec2 aTexCoord) {\n    #ifdef HAS_DECODE_TEXCOORD\n        return decodeDracoTexcoord(aTexCoord);\n    #else\n        return aTexCoord;\n    #endif\n}",highlight_vert:"#if defined(HAS_HIGHLIGHT_COLOR)\n    attribute vec4 aHighlightColor;\n    varying vec4 vHighlightColor;\n#endif\n#if defined(HAS_HIGHLIGHT_OPACITY)\n    attribute float aHighlightOpacity;\n    varying float vHighlightOpacity;\n#endif\nvoid highlight_setVarying() {\n    #if defined(HAS_HIGHLIGHT_COLOR)\n        vHighlightColor = aHighlightColor / 255.0;\n    #endif\n    #if defined(HAS_HIGHLIGHT_OPACITY)\n        vHighlightOpacity = aHighlightOpacity / 255.0;\n    #endif\n}",highlight_frag:"#if defined(HAS_HIGHLIGHT_COLOR)\n\tvarying vec4 vHighlightColor;\n#endif\n#if defined(HAS_HIGHLIGHT_OPACITY)\n    varying float vHighlightOpacity;\n#endif\nvec4 highlight_blendColor(vec4 color) {\n\tvec4 outColor;\n\t#if defined(HAS_HIGHLIGHT_COLOR)\n\t\tcolor.rgb = color.rgb * (1.0 - vHighlightColor.a) + vHighlightColor.rgb * vHighlightColor.a;\n        color.a = color.a * (1.0 - vHighlightColor.a) + vHighlightColor.a;\n        outColor = color;\n\t#else\n\t\toutColor = color;\n\t#endif\n\t#if defined(HAS_HIGHLIGHT_OPACITY)\n\t\toutColor *= vHighlightOpacity;\n\t#endif\n\treturn outColor;\n}"};var We$4={register(e,t){if(Ke$4[e])throw new Error(`Key of ${e} is already registered in ShaderLib.`);Ke$4[e]=t},compile:e=>Je$4(e)};const qe$4=/^[ \t]*#include +<([\w\d.]+)>/gm;function Je$4(e){return e.replace(qe$4,Ye$4)}function Ye$4(e,t){const n=Ke$4[t];if(!n)throw new Error("Can not resolve #include <"+t+">");return Je$4(n)}let $e$4=0;const et$6={};class tt$6{constructor({vert:e,frag:t,uniforms:n,defines:r,extraCommandProps:i}){this.vert=e,this.frag=t;const o=$e$4++;Object.defineProperty(this,"uid",{enumerable:!0,configurable:!1,get:()=>o}),this.shaderDefines=r&&v$7({},r)||{},n=this.uniforms=(n||[]).slice(),this.contextDesc={};for(let e=0,t=n.length;e<t;e++){const t=n[e];if(f$5(t))if(t.indexOf("[")>0){const{name:e,len:n}=nt$6(t);this.contextDesc[e]={name:e,type:"array",length:n}}else this.contextDesc[t]=null;else if(t.name.indexOf("[")>0){const{name:e,len:n}=nt$6(t.name);this.contextDesc[e]={name:e,type:"array",length:n,fn:t.fn}}else this.contextDesc[t.name]=t}this.extraCommandProps=i&&v$7({},i)||{},this.commands={},this._compileSource()}set shaderDefines(e){this._shaderDefines=e,this.dkey=Object.keys(this._shaderDefines).join()}get shaderDefines(){return this._shaderDefines||{}}setDefines(e){this.shaderDefines=e}setFramebuffer(e){return this.context.framebuffer=e,this}appendDescUniforms(e){const t=e,n=this.contextDesc;for(const r in n)if(n[r])if("array"===n[r].type){const i=r,o=n[r].length;let a=e[r];if(n[r].fn&&(a=n[r].fn(null,e)),!a)continue;if(a.length!==o)throw new Error(`${i} uniform's length is not ${o}`);t[i]=t[i]||{};for(let e=0;e<o;e++)t[i][""+e]=a[e]}else"function"===n[r].type&&(Object.getOwnPropertyDescriptor(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:function(){return n[r].fn(null,e)}}));return t}setUniforms(e){if(e.modelMatrix||e.positionMatrix)throw new Error("modelMatrix or positionMatrix is reserved uniform name for Mesh, please change to another name");return this.contextKeys=e?Object.keys(e).join():null,this.context=e,this}getVersion(e,t){return"#version"===t.substring(0,8)?"":0===e.limits.version.indexOf("WebGL 2.0")&&300===this.version?"#version 300 es\n":"#version 100\n"}getActiveVars(e,t,n,r){const i=r;if(et$6[i])return et$6[i];const o=e._gl,a=o.createProgram(),s=o.createShader(35633);o.shaderSource(s,t),o.compileShader(s);const c=o.createShader(35632);o.shaderSource(c,n),o.compileShader(c),o.attachShader(a,c),o.attachShader(a,s),o.linkProgram(a);const l=o.getProgramParameter(a,35721),f=[];for(let e=0;e<l;++e){const t=o.getActiveAttrib(a,e);t&&f.push({name:t.name,type:t.type})}const u=o.getProgramParameter(a,35718),d=[];for(let e=0;e<u;++e){const t=o.getActiveUniform(a,e);let n=t.name;t.name.indexOf("[")>0&&(n=n.replace("[0]","")),d.push(n)}return o.deleteProgram(a),o.deleteShader(s),o.deleteShader(c),et$6[i]={activeUniforms:d,activeAttributes:f},et$6[i]}createREGLCommand(e,t,n,r,i){const o=A$7(e)&&!i,a=v$7({},this.shaderDefines||{},t||{}),s=this._insertDefines(this.vert,a),c=this.getVersion(e,s)+s,l=this._insertDefines(this.frag,a),f=this.getVersion(e,l)+l,u=w$8(c)+"_"+w$8(f),d=`${u}_${+g$6(n)}_${+r}_${+i}`;let h=e.__maptalks_shader_cache;if(h||(h=e.__maptalks_shader_cache={}),h[d])return h[d].ref++,h[d].command;const{activeAttributes:m,activeUniforms:_}=this.getActiveVars(e,c,f,u),b={};m.forEach(((t,n)=>{const r=t.name;b[r]=o?n:e.prop(r)}));const p={};_.forEach((t=>{p[t]=e.prop(t)}));const x=this.contextDesc;for(const t in x)if(x[t]&&"function"===x[t].type)p[t]=x[t].fn;else if(x[t]&&"array"===x[t].type){const n=x[t].name,r=x[t].length;for(let t=0;t<r;t++){const r=`${n}[${t}]`;p[r]=e.prop(r)}}else p[t]=e.prop(t);const y={vert:c,frag:f,uniforms:p,attributes:b};o&&(y.vao=e.prop("vao")),o&&!r||!n||g$6(n)||(y.elements=e.prop("elements")),y.count=e.prop("count"),y.offset=e.prop("offset"),y.primitive=e.prop("primitive"),y.framebuffer=e.prop("framebuffer"),r&&(y.instances=e.prop("instances")),v$7(y,this.extraCommandProps);const T=e(y);return m.key=m.map((e=>e.name)).join(),T.activeAttributes=m,h[d]={command:T,ref:1},T.hash=d,T.commandCache=h,T}dispose(){for(const e in this.commands){const t=this.commands[e];if(!t)continue;const n=t.hash,r=t.commandCache;r[n]&&r[n].ref--,(!r[n]||r[n].ref<=0)&&(t.destroy&&!t[D$8]&&(t[D$8]=!0,t.destroy()),r[n]&&delete r[n],delete t.commandCache)}this.commands={},delete this.vert,delete this.frag}_insertDefines(e,t){const n=[];for(const e in t)T$8(t,e)&&!h$2(t[e])&&n.push(`#define ${e} ${t[e]}\n`);return n.join("")+e}_compileSource(){this.vert=We$4.compile(this.vert),this.frag=We$4.compile(this.frag)}}function nt$6(e){const t=e.indexOf("["),n=e.indexOf("]");return{name:e.substring(0,t),len:+e.substring(t+1,n)}}class rt$6 extends tt$6{draw(e,t){if(!t||!t.length)return 0;const n=[];let r,i=0;for(let o=0,a=t.length;o<a;o++){if(!t[o].isValid()){o===a-1&&r&&n.length&&r(n);continue}if(!t[o].geometry.getDrawCount()||!this._runFilter(t[o])){o===a-1&&r&&n.length&&r(n);continue}const s=this.getMeshCommand(e,t[o]);n.length&&r!==s&&(r(n),n.length=0);const c=t[o].getREGLProps(e,s.activeAttributes);this._ensureContextDefines(c),c.shaderContext=this.context,this.appendDescUniforms(c),n.push(c),i++,o<a-1?r=s:o===a-1&&s(n)}return i}_ensureContextDefines(e){if(this.context&&(e.contextKeys||(e.contextKeys={}),e.contextKeys[this.uid]!==this.contextKeys)){for(const t in this.context)Object.getOwnPropertyDescriptor(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:function(){return this.shaderContext&&this.shaderContext[t]}});e.contextKeys[this.uid]=this.contextKeys}}_runFilter(e){const t=this.filter;if(!t)return!0;if(Array.isArray(t)){for(let n=0;n<t.length;n++)if(!t[n](e))return!1;return!0}return t(e)}getMeshCommand(e,t){this._cmdKeys||(this._cmdKeys={});const n=this.dkey||"default";let r=this._cmdKeys[n];r||(r=this._cmdKeys[n]={});const i=t.getCommandKey(e);r[i]||(r[i]=n+"_"+t.getCommandKey(e));const o=r[i];let a=this.commands[o];if(!a){const n=t.getDefines(),r=t.getMaterial();r&&r.doubleSided&&this.extraCommandProps&&this.extraCommandProps.cull&&(this.extraCommandProps.cull.enable=!1),a=this.commands[o]=this.createREGLCommand(e,n,t.getElements(),t instanceof he$4,t.disableVAO)}return a}}var ot$6="precision mediump float;\n#include <gl2_frag>\nuniform vec4 baseColorFactor;\nuniform float materialShininess;\nuniform float opacity;\nuniform float ambientStrength;\nuniform float specularStrength;\nuniform vec3 light0_viewDirection;\nuniform vec3 ambientColor;\nuniform vec4 light0_diffuse;\nuniform vec3 lightSpecular;\nuniform vec3 cameraPosition;\n#ifdef HAS_TOON\nuniform float toons;\nuniform float specularToons;\n#endif\n#ifdef HAS_TANGENT\nvarying vec4 vTangent;\n#endif\n#ifdef HAS_MAP\nvarying vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\nvarying vec4 vUvRegion;\n#endif\nvec2 c() {\n  \n#ifdef HAS_I3S_UVREGION\nvec2 d = vUvRegion.zw - vUvRegion.xy;\n  vec2 e = fract(vTexCoord) * d + vUvRegion.xy;\n  return e;\n#else\nreturn vTexCoord;\n#endif\n}\n#endif\nvarying vec3 vNormal;\nvarying vec3 vFragPos;\n#ifdef HAS_INSTANCE_COLOR\nvarying vec4 vInstanceColor;\n#endif\n#ifdef HAS_BASECOLOR_MAP\nuniform sampler2D baseColorTexture;\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nuniform vec2 extrusionOpacityRange;\nvarying float vExtrusionOpacity;\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvarying vec4 vColor;\n#elif defined(IS_LINE_EXTRUSION)\nuniform vec4 lineColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#ifdef IS_LINE_EXTRUSION\nuniform float lineOpacity;\n#else\nuniform float polygonOpacity;\n#endif\n#ifdef HAS_OCCLUSION_MAP\nuniform sampler2D occlusionTexture;\n#endif\n#ifdef HAS_NORMAL_MAP\nuniform sampler2D normalTexture;\n#endif\n#ifdef HAS_EMISSIVE_MAP\nuniform sampler2D emissiveTexture;\n#endif\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\nuniform vec4 diffuseFactor;\nuniform vec3 specularFactor;\n#ifdef HAS_DIFFUSE_MAP\nuniform sampler2D diffuseTexture;\n#endif\n#ifdef HAS_SPECULARGLOSSINESS_MAP\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\n#include <heatmap_render_frag>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\nvec3 f() {\n  \n#if defined(HAS_NORMAL_MAP)\nvec3 h = normalize(vNormal);\n  vec3 i = texture2D(normalTexture, c()).xyz * 2. - 1.;\n#if defined(HAS_TANGENT)\nvec3 t = normalize(vTangent.xyz);\n  vec3 b = normalize(cross(h, t) * sign(vTangent.w));\n  mat3 j = mat3(t, b, h);\n  return normalize(j * i);\n#else\nreturn normalize(i);\n#endif\n#else\nreturn normalize(vNormal);\n#endif\n}\nvec4 k(const in vec4 l) {\n  return vec4(l.r < .0031308 ? l.r * 12.92 : 1.055 * pow(l.r, 1. / 2.4) - .055, l.g < .0031308 ? l.g * 12.92 : 1.055 * pow(l.g, 1. / 2.4) - .055, l.b < .0031308 ? l.b * 12.92 : 1.055 * pow(l.b, 1. / 2.4) - .055, l.a);\n}\nvec4 m() {\n  \n#if defined(HAS_BASECOLOR_MAP)\nreturn texture2D(baseColorTexture, c());\n#elif defined(HAS_DIFFUSE_MAP)\nreturn texture2D(diffuseTexture, c());\n#elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn diffuseFactor;\n#else\nreturn baseColorFactor;\n#endif\n}\nvec3 o() {\n  \n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nreturn texture2D(specularGlossinessTexture, c()).rgb;\n#elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn specularFactor;\n#else\nreturn vec3(1.);\n#endif\n}\nvoid main() {\n  vec4 u = m();\n  vec3 v = ambientStrength * ambientColor * u.rgb;\n#ifdef HAS_INSTANCE_COLOR\nv *= vInstanceColor.rgb;\n#endif\nvec3 A = f();\n  vec3 B = normalize(-light0_viewDirection);\n  float C = max(dot(A, B), .0);\n#ifdef HAS_TOON\nfloat D = floor(C * toons);\n  C = D / toons;\n#endif\nvec3 E = light0_diffuse.rgb * C * u.rgb;\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvec3 l = vColor.rgb;\n#elif defined(IS_LINE_EXTRUSION)\nvec3 l = lineColor.rgb;\n#else\nvec3 l = polygonFill.rgb;\n#endif\n#ifdef HAS_INSTANCE_COLOR\nl *= vInstanceColor.rgb;\n#endif\nv *= l.rgb;\n  E *= l.rgb;\n  vec3 F = normalize(cameraPosition - vFragPos);\n  vec3 G = normalize(B + F);\n  float H = pow(max(dot(A, G), .0), materialShininess);\n#ifdef HAS_TOON\nfloat I = floor(H * specularToons);\n  H = I / specularToons;\n#endif\nvec3 J = specularStrength * lightSpecular * H * o();\n#ifdef HAS_OCCLUSION_MAP\nfloat K = texture2D(occlusionTexture, c()).r;\n  v *= K;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat L = shadow_computeShadow();\n  E = shadow_blend(E, L).rgb;\n  J = shadow_blend(J, L).rgb;\n#endif\nvec3 M = v + E + J;\n#ifdef HAS_EMISSIVE_MAP\nvec3 N = texture2D(emissiveTexture, c()).rgb;\n  M += N;\n#endif\nglFragColor = vec4(M, opacity);\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nfloat O = vColor.a;\n#elif defined(IS_LINE_EXTRUSION)\nfloat O = lineColor.a;\n#else\nfloat O = polygonFill.a;\n#endif\nglFragColor *= O;\n#ifdef HAS_EXTRUSION_OPACITY\nfloat P = extrusionOpacityRange.x;\n  float Q = extrusionOpacityRange.y;\n  float R = P + vExtrusionOpacity * (Q - P);\n  R = clamp(R, .0, 1.);\n  glFragColor *= R;\n#endif\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",at$6="#include <gl2_vert>\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\n#ifdef HAS_MAP\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\nvarying vec4 vColor;\n#elif defined(HAS_COLOR0)\nattribute vec4 aColor0;\nvarying vec4 vColor;\n#endif\nvarying vec3 vFragPos;\nvarying vec3 vNormal;\nuniform mat4 projMatrix;\nuniform mat4 viewModelMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform vec2 halton;\nuniform vec2 outSize;\nuniform mat4 projViewMatrix;\n#include <get_output>\n#include <heatmap_render_vert>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nattribute float aExtrusionOpacity;\nvarying float vExtrusionOpacity;\n#endif\n#if defined(HAS_TANGENT)\nvarying vec4 vTangent;\n#endif\nvoid c(const highp vec4 q, out highp vec3 d) {\n  d = vec3(.0, .0, 1.) + vec3(2., -2., -2.) * q.x * q.zwx + vec3(2., 2., -2.) * q.y * q.wzy;\n}\nvoid c(const highp vec4 q, out highp vec3 d, out highp vec3 t) {\n  c(q, d);\n  t = vec3(1., .0, .0) + vec3(-2., 2., -2.) * q.y * q.yxw + vec3(-2., 2., 2.) * q.z * q.zwx;\n}\nvoid main() {\n  \n#ifdef IS_LINE_EXTRUSION\nvec4 e = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 e = getPosition(aPosition);\n#endif\nmat4 f = getPositionMatrix();\n  vFragPos = vec3(modelMatrix * f * e);\n#if defined(HAS_NORMAL) || defined(HAS_TANGENT)\nmat3 h = modelNormalMatrix * mat3(f);\n  vec3 i;\n#if defined(HAS_TANGENT)\nvec3 t;\n  c(aTangent, i, t);\n  vTangent = vec4(h * t, aTangent.w);\n#else\n#ifdef HAS_DECODE_NORMAL\ni = getNormal(aNormal);\n#else\ni = aNormal;\n#endif\n#endif\nvec3 j = appendMorphNormal(i);\n  vNormal = normalize(h * j);\n#else\nvNormal = vec3(.0);\n#endif\nmat4 k = projMatrix;\n  k[2].xy += halton.xy / outSize.xy;\n  gl_Position = k * viewModelMatrix * f * e;\n#ifdef HAS_MAP\nvec2 l = getTexcoord(aTexCoord);\n  vTexCoord = l * uvScale + uvOffset;\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nvExtrusionOpacity = aExtrusionOpacity;\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#elif defined(HAS_COLOR0)\nvColor = aColor0 / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(f * e);\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * viewModelMatrix * f, e);\n#endif\n#ifdef HAS_I3S_UVREGION\nvUvRegion = uvRegion / 65535.;\n#endif\n}";class st$6 extends rt$6{constructor(e={}){const n=[],r=[],o=e.uniforms,a=[{name:"modelNormalMatrix",type:"function",fn:function(e,t){return fromMat4$1(n,t.modelMatrix)}},{name:"viewModelMatrix",type:"function",fn:function(e,n){return multiply$5(r,n.viewMatrix,n.modelMatrix)}}];o&&a.push(...o),super({vert:e.vert||at$6,frag:e.frag||ot$6,uniforms:a,defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}}),this.version=300}getGeometryDefines(e){const t={};return e.data[e.desc.tangentAttribute]?t.HAS_TANGENT=1:e.data[e.desc.normalAttribute]&&(t.HAS_NORMAL=1),t}}var ft$6="#if __VERSION__ == 300\n#define attribute in\n#define varying out\n#endif\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_Position = vec4(aPosition, 0., 1.);\n  vTexCoord = aTexCoord;\n}";const ut$6=new Int8Array([-1,1,-1,-1,1,1,1,1,-1,-1,1,-1]),dt$6=new Uint8Array([0,1,0,0,1,1,1,1,0,0,1,0]);class ht$6 extends rt$6{constructor(e){e.vert=e.vert||ft$6,e.extraCommandProps=e.extraCommandProps||{},e.extraCommandProps.depth||(e.extraCommandProps.depth={enable:!1,mask:!1}),e.extraCommandProps.stencil||(e.extraCommandProps.stencil={enable:!1}),super(e)}draw(e){return this._quadMesh||this._createQuadMesh(e),super.draw(e,this._quadMesh)}getMeshCommand(e){const t=this.dkey||"";return this.commands[t+"_quad"]||(this.commands[t+"_quad"]=this.createREGLCommand(e,null,this._quadMesh[0].getElements())),this.commands[t+"_quad"]}_createQuadMesh(e){const t=new Z$7({aPosition:ut$6,aTexCoord:dt$6},null,ut$6.length/2,{positionSize:2,primitive:"triangles"});t.generateBuffers(e),this._quadMesh=[new de$4(t)]}dispose(){if(this._quadMesh){const e=this._quadMesh[0];e.geometry.dispose(),e.dispose()}return delete this._quadMesh,super.dispose()}}class mt$6 extends ht$6{constructor(){super({vert:ft$6,frag:"#define SHADER_NAME FXAA\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#define FXAA_SPAN_MAX     8.0\nprecision mediump float;\nvarying vec2 vTexCoord;\nuniform float enableFXAA;\nuniform float enableToneMapping;\nuniform float enableSharpen;\nuniform vec2 resolution;\nuniform sampler2D textureSource;\n#ifdef HAS_NOAA_TEX\nuniform sampler2D noAaTextureSource;\n#endif\n#ifdef HAS_POINT_TEX\nuniform sampler2D pointTextureSource;\n#endif\n#ifdef HAS_TAA_TEX\nuniform sampler2D taaTextureSource;\n#ifdef HAS_FXAA_TEX\nuniform sampler2D fxaaTextureSource;\n#endif\n#endif\nuniform float pixelRatio;\nuniform float sharpFactor;\n#ifdef HAS_OUTLINE_TEX\nuniform sampler2D textureOutline;\nuniform float enableOutline;\nuniform float highlightFactor;\nuniform float outlineFactor;\nuniform float outlineWidth;\nuniform vec3 outlineColor;\n#endif\nvec2 c;\nvec4 d(vec2 e) {\n  \n#ifdef HAS_TAA_TEX\nvec4 f = texture2D(textureSource, e);\n  vec4 taa = texture2D(taaTextureSource, e);\n#ifdef HAS_FXAA_TEX\nvec4 h = texture2D(fxaaTextureSource, e);\n#else\nvec4 h = vec4(.0);\n#endif\nvec4 i = taa + f * (1. - taa.a);\n  return h + i * (1. - h.a);\n#else\nreturn texture2D(textureSource, e);\n#endif\n}\nvec4 j(vec2 k) {\n  vec4 l;\n  mediump vec2 m = vec2(1. / resolution.x, 1. / resolution.y);\n  vec3 n = d((k + vec2(-1., -1.)) * m).xyz;\n  vec3 o = d((k + vec2(1., -1.)) * m).xyz;\n  vec3 u = d((k + vec2(-1., 1.)) * m).xyz;\n  vec3 v = d((k + vec2(1.)) * m).xyz;\n  vec4 A = d(k * m);\n  vec3 B = A.xyz;\n  vec3 C = vec3(.299, .587, .114);\n  float D = dot(n, C);\n  float E = dot(o, C);\n  float F = dot(u, C);\n  float G = dot(v, C);\n  float H = dot(B, C);\n  float I = min(H, min(min(D, E), min(F, G)));\n  float J = max(H, max(max(D, E), max(F, G)));\n  mediump vec2 K;\n  K.x = -((D + E) - (F + G));\n  K.y = (D + F) - (E + G);\n  float L = max((D + E + F + G) * (.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n  float M = 1. / (min(abs(K.x), abs(K.y)) + L);\n  K = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), K * M)) * m;\n  vec4 N = .5 * (d(k * m + K * (1. / 3. - .5)) + d(k * m + K * (2. / 3. - .5)));\n  vec4 O = N * .5 + .25 * (d(k * m + K * -.5) + d(k * m + K * .5));\n  float P = dot(O.xyz, C);\n  if(P < I || P > J)\n    l = N;\n  else\n    l = O;\n  return l;\n}\nvec3 Q(const in vec3 l, const float R) {\n  vec2 S = pixelRatio / resolution.xy;\n  float T = .0;\n  vec4 n = texture2D(textureSource, c + S * vec2(-1., -1.));\n  n.rgb = mix(vec3(.0), n.rgb, sign(n.a));\n  T += mix(.0, 1., sign(n.a));\n  vec4 v = texture2D(textureSource, c + S * vec2(1.));\n  v.rgb = mix(vec3(.0), v.rgb, sign(v.a));\n  T += mix(.0, 1., sign(v.a));\n  vec4 o = texture2D(textureSource, c + S * vec2(1., -1.));\n  o.rgb = mix(vec3(.0), o.rgb, sign(o.a));\n  T += mix(.0, 1., sign(o.a));\n  vec4 u = texture2D(textureSource, c + S * vec2(-1., 1.));\n  u.rgb = mix(vec3(.0), u.rgb, sign(u.a));\n  T += mix(.0, 1., sign(u.a));\n  return l + R * (T * l - n.rgb - o.rgb - u.rgb - v.rgb);\n}\nvec4 U(const in vec4 l) {\n  return vec4(Q(l.rgb, sharpFactor), l.a);\n}\nvec3 V(const vec3 x) {\n  const float a = 2.51;\n  const float b = .03;\n  const float W = 2.43;\n  const float X = .59;\n  const float Y = .14;\n  return (x * (a * x + b)) / (x * (W * x + X) + Y);\n}\nvec3 Z(vec3 l) {\n  l = l / (l + vec3(1.));\n  return l = pow(l, vec3(1. / 2.2));\n}\n#ifdef HAS_OUTLINE_TEX\nvec4 ba() {\n  float bb = 2.;\n  float bc = 1.;\n  float bd = pixelRatio / resolution[0] * outlineWidth;\n  float be = pixelRatio / resolution[1] * outlineWidth;\n  vec4 bf = (texture2D(textureOutline, c + vec2(bd, be)));\n  vec4 bg = (texture2D(textureOutline, c + vec2(bd, .0)));\n  vec4 bh = (texture2D(textureOutline, c + vec2(bd, -be)));\n  vec4 bi = (texture2D(textureOutline, c + vec2(.0, -be)));\n  vec4 bj = (texture2D(textureOutline, c + vec2(-bd, -be)));\n  vec4 bk = (texture2D(textureOutline, c + vec2(-bd, .0)));\n  vec4 bl = (texture2D(textureOutline, c + vec2(-bd, be)));\n  vec4 bm = (texture2D(textureOutline, c + vec2(.0, be)));\n  vec4 bn = -bb * bk + bb * bg + -bc * bl + bc * bf + -bc * bj + bc * bh;\n  vec4 bo = -bb * bi + bb * bm + -bc * bj + bc * bl + -bc * bh + bc * bf;\n  float bp = sqrt(dot(bo, bo) + dot(bn, bn));\n  bool bq = bp < 1. / 65025.;\n  vec3 br = (texture2D(textureOutline, c)).r * outlineColor;\n  if(br == vec3(.0) || (highlightFactor == .0 && bq)) {\n    return vec4(.0);\n  }\n  float bs = bq ? highlightFactor : min(1., sqrt(bp) * outlineFactor);\n  return bs * vec4(br, 1.);\n}\nvec4 bt(const in vec4 l) {\n  vec4 ba = ba();\n  return ba + vec4(l) * (1. - ba.a);\n}\n#endif\nvoid main() {\n  c = vTexCoord;\n  vec4 l;\n  if(enableFXAA == 1.) {\n    l = j(c * resolution);\n  } else {\n    l = d(vTexCoord);\n  }\n  if(enableSharpen == 1.) {\n    l = U(l);\n  }\n#if defined(HAS_NOAA_TEX) || defined(HAS_POINT_TEX)\nvec4 bu = vec4(.0);\n  vec4 bv = vec4(.0);\n#ifdef HAS_POINT_TEX\nbu = texture2D(pointTextureSource, vTexCoord);\n#endif\n#ifdef HAS_NOAA_TEX\nbv = texture2D(noAaTextureSource, vTexCoord);\n#endif\nvec4 bw = bu + bv * (1. - bu.a);\n  l = bw + l * (1. - bw.a);\n#endif\nif(enableToneMapping == 1.) {\n    l.rgb = Z(l.rgb);\n  }\n#ifdef HAS_OUTLINE_TEX\nl = bt(l);\n#endif\ngl_FragColor = l;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,t)=>t.resolution[0],height:(e,t)=>t.resolution[1]}}})}getMeshCommand(e,t){const n=this.dkey||"";return this.commands[n+"_fxaa"]||(this.commands[n+"_fxaa"]=this.createREGLCommand(e,null,t.getElements())),this.commands[n+"_fxaa"]}}class _t$5 extends ht$6{constructor(){super({vert:ft$6,frag:"precision mediump float;\n#define SHADER_NAME SSAO_BLUR\nstruct MaterialParams {\n  float farPlaneOverEdgeDistance;\n  vec2 axis;\n  vec2 resolution;\n};\nuniform sampler2D materialParams_ssao;\nuniform sampler2D TextureInput;\nuniform MaterialParams materialParams;\nvarying vec2 vTexCoord;\nconst int c = 6;\nfloat d[8];\nvoid e() {\n  d[0] = .099736;\n  d[1] = .096667;\n  d[2] = .088016;\n  d[3] = .075284;\n  d[4] = .060493;\n  d[5] = .045662;\n}\nfloat f(vec2 h) {\n  return (h.x * (256. / 257.) + h.y * (1. / 257.));\n}\nvoid tap(inout float i, inout float j, float k, float h, vec2 l) {\n  vec3 m = texture2D(materialParams_ssao, l).rgb;\n  float n = k;\n  i += m.r * n;\n  j += n;\n}\nvoid main() {\n  e();\n  highp vec2 o = vTexCoord;\n  vec3 m = texture2D(materialParams_ssao, o).rgb;\n  if(m.g * m.b == 1.) {\n    if(materialParams.axis.y > .0) {\n      vec4 u = texture2D(TextureInput, o);\n      gl_FragColor = u;\n    } else {\n      gl_FragColor = vec4(m, 1.);\n    }\n    return;\n  }\n  float h = f(m.gb);\n  float j = d[0];\n  float i = m.r * j;\n  vec2 v = materialParams.axis / materialParams.resolution;\n  vec2 A = v;\n  for(int B = 1; B < c; B++) {\n    float k = d[B];\n    tap(i, j, k, h, o + A);\n    tap(i, j, k, h, o - A);\n    A += v;\n  }\n  float C = i * (1. / j);\n  vec2 gb = m.gb;\n  if(materialParams.axis.y > .0) {\n    vec4 u = texture2D(TextureInput, o);\n    gl_FragColor = vec4(u.rgb * C, u.a);\n  } else {\n    gl_FragColor = vec4(C, gb, 1.);\n  }\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,t)=>t.outputSize[0],height:(e,t)=>t.outputSize[1]}}})}getMeshCommand(e,t){return this.commands.ssao_blur||(this.commands.ssao_blur=this.createREGLCommand(e,null,t.getElements())),this.commands.ssao_blur}}const gt$6=[-2e-6,0,2e-6,-.095089,.004589,-.031253,.01518,-.025586,.003765,.073426,.021802,.002778,.094587,.043218,.089148,-.009509,.051369,.019673,.139973,-.101685,.10857,-.103804,.219853,-.043016,.004841,-.033988,.094187,.028011,.058466,-.25711,-.051031,.074993,.259843,.118822,-.186537,-.134192,.063949,-.094894,-.072683,.108176,.327108,-.254058,-.04718,.21918,.263895,-.407709,.240834,-.200352];class bt$5 extends ht$6{constructor(){super({vert:ft$6,frag:"#if __VERSION__ == 100\n#if defined(GL_OES_standard_derivatives)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision highp float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#define saturate(x)        clamp(x, 0.0, 1.0)\n#define SHADER_NAME SSAO_EXTRACT\n#define PI 3.14159265359\nconst float c = .0625;\nstruct MaterialParams {\n  mat4 projMatrix;\n  mat4 invProjMatrix;\n  vec4 resolution;\n  float radius;\n  float bias;\n  float power;\n  vec2 cameraNearFar;\n};\nuniform MaterialParams materialParams;\nuniform sampler2D materialParams_depth;\n#define NOISE_NONE      0\n#define NOISE_PATTERN   1\n#define NOISE_RANDOM    2\n#define NOISE_TYPE      NOISE_PATTERN\nconst int d = 16;\nuniform vec3 kSphereSamples[16];\nvec3 e(const int x) {\n  if(x == 0) {\n    return vec3(-.078247, -.749924, -.656880);\n  } else if(x == 1) {\n    return vec3(-.572319, -.102379, -.813615);\n  } else if(x == 2) {\n    return vec3(.048653, -.380791, .923380);\n  } else if(x == 3) {\n    return vec3(.281202, -.656664, -.699799);\n  } else if(x == 4) {\n    return vec3(.711911, -.235841, -.661485);\n  } else if(x == 5) {\n    return vec3(-.445893, .611063, .654050);\n  } else if(x == 6) {\n    return vec3(-.703598, .674837, .222587);\n  } else if(x == 7) {\n    return vec3(.768236, .507457, .390257);\n  } else if(x == 8) {\n    return vec3(-.670286, -.470387, .573980);\n  } else if(x == 9) {\n    return vec3(.199235, .849336, -.488808);\n  } else if(x == 10) {\n    return vec3(-.768068, -.583633, -.263520);\n  } else if(x == 11) {\n    return vec3(-.897330, .328853, .294372);\n  } else if(x == 12) {\n    return vec3(-.570930, -.531056, -.626114);\n  } else if(x == 13) {\n    return vec3(.699014, .063283, -.712303);\n  } else if(x == 14) {\n    return vec3(.207495, .976129, -.064172);\n  } else if(x == 15) {\n    return vec3(-.060901, -.869738, -.489742);\n  } else {\n    return vec3(.0);\n  }\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n}\nvec2 f(highp float h) {\n  highp float z = clamp(h * 1. / -materialParams.cameraNearFar.y, .0, 1.);\n  highp float t = floor(256. * z);\n  mediump float i = t * (1. / 256.);\n  mediump float j = 256. * z - t;\n  return vec2(i, j);\n}\nfloat k(highp vec2 l) {\n  l = fract(l * vec2(5.3987, 5.4421));\n  l += dot(l.yx, l.xy + vec2(21.5351, 14.3137));\n  highp float xy = l.x * l.y;\n  return fract(xy * 95.4307) + fract(xy * 75.04961) * .5;\n}\nvec3 m(const vec2 o) {\n  \n#if NOISE_TYPE == NOISE_RANDOM\nreturn normalize(2. * vec3(k(o), k(o * 2.), k(o * 4.)) - vec3(1.));\n#elif NOISE_TYPE == NOISE_PATTERN\nvec2 xy = floor(gl_FragCoord.xy);\n  float u = mod(xy.x, 4.);\n  float v = mod(xy.y, 4.);\n  return e(int(u + v * 4.));\n#else\nreturn vec3(.0);\n#endif\n}\nhighp mat4 A() {\n  return materialParams.projMatrix;\n}\nhighp mat4 B() {\n  return materialParams.invProjMatrix;\n}\nhighp float C(const vec2 o) {\n  return texture2D(materialParams_depth, o).r;\n}\nhighp float D(highp float h) {\n  highp mat4 E = A();\n  highp float z = h * 2. - 1.;\n  return -E[3].z / (z + E[2].z);\n}\nhighp float F(const vec2 o) {\n  return D(texture2D(materialParams_depth, o).r);\n}\nhighp vec3 G(in vec2 p, highp float H) {\n  p = p * 2. - 1.;\n  highp mat4 I = B();\n  p.x *= I[0].x;\n  p.y *= I[1].y;\n  return vec3(p * -H, H);\n}\nhighp vec3 J(const highp vec3 K) {\n  highp vec3 L = dFdx(K);\n  highp vec3 M = dFdy(K);\n  return cross(L, M);\n}\nhighp vec3 J(const highp vec3 K, const vec2 o) {\n  vec2 N = o + vec2(materialParams.resolution.z, .0);\n  vec2 O = o + vec2(.0, materialParams.resolution.w);\n  highp vec3 px = G(N, F(N));\n  highp vec3 py = G(O, F(O));\n  highp vec3 L = px - K;\n  highp vec3 M = py - K;\n  return cross(L, M);\n}\nfloat P(const highp vec3 Q, const highp float R, mat3 S, const vec3 T, const vec3 U) {\n  highp mat4 E = A();\n  float V = materialParams.radius;\n  float W = materialParams.bias;\n  highp vec3 X = S * U;\n  float Y = dot(X, T);\n  X = sign(Y) * X;\n  X = Q + X * V;\n  highp vec4 Z = E * vec4(X, 1.);\n  Z.xy = Z.xy * (.5 / Z.w) + .5;\n  highp float ba = C(Z.xy);\n  ba = D(ba);\n  float t = saturate(V / abs(R - ba));\n  float bb = t * t * (3. - 2. * t);\n  return (ba >= X.z + W ? bb : .0);\n}\nvoid main() {\n  highp vec2 o = vTexCoord;\n  highp float h = C(o);\n  highp float bc = D(h);\n  highp vec3 Q = G(o, bc);\n  highp vec3 T = J(Q, o);\n  T = normalize(T);\n  vec3 bd = m(o);\n  vec3 be = bd.xyz;\n  vec3 bf = normalize(be - T * dot(be, T));\n  vec3 bg = cross(T, bf);\n  mat3 S = mat3(bf, bg, T);\n  float bh = .0;\n  for(int bi = 0; bi < d; bi++) {\n    bh += P(Q, bc, S, T, kSphereSamples[bi]);\n  }\n  float bj = 1. - bh / float(d);\n  bj = mix(bj, bj * bj, materialParams.power);\n  glFragColor = vec4(bj, f(Q.z), 1.);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"kSphereSamples",type:"function",fn:function(){return gt$6}}],extraCommandProps:{viewport:{x:0,y:0,width:(e,t)=>t.outputSize[0],height:(e,t)=>t.outputSize[1]}}}),this.version=300}getMeshCommand(e,t){return this.commands.ssao_extract||(this.commands.ssao_extract=this.createREGLCommand(e,null,t.getElements())),this.commands.ssao_extract}}const pt$6=[];class xt$5{constructor(e){this._renderer=e}render(e,t,n){const{width:r,height:i}=n;return this._initShaders(),this._extractFBO||this._createTextures(n),this._extract(e,r,i,n),this._blurAndCombine(t,e.cameraFar,r,i)}_blurAndCombine(e,t,n,r){const i=Math.floor(n/2),o=Math.floor(r/2);this._blurHTex.width===i&&this._blurHTex.height===o||(this._blurHFBO.resize(i,o),this._blurVFBO.resize(n,r));const a=[n,r],s=[1,0];return this._renderer.render(this._ssaoBlurShader,{TextureInput:e,materialParams_ssao:this._extractTex,materialParams:{axis:s,farPlaneOverEdgeDistance:-t/.0625,resolution:a},outputSize:[i,o]},null,this._blurHFBO),s[0]=0,s[1]=1,this._renderer.render(this._ssaoBlurShader,{TextureInput:e,materialParams_ssao:this._blurHTex,materialParams:{axis:s,farPlaneOverEdgeDistance:-t/.0625,resolution:a},outputSize:[n,r]},null,this._blurVFBO),this._blurVTex}_extract(e,n,r,i){const o=Math.floor(n/2),a=Math.floor(r/2);this._extractFBO.width===o&&this._extractFBO.height===a||this._extractFBO.resize(o,a);const{projMatrix:s}=e,c=invert$2(pt$6,s);this._renderer.render(this._ssaoExtractShader,{materialParams_depth:i,materialParams:{projMatrix:s,invProjMatrix:c,resolution:[o,a,1/o,1/a],radius:e.radius,bias:e.bias,power:e.power||1,cameraNearFar:[e.cameraNear,e.cameraFar]},outputSize:[o,a]},null,this._extractFBO)}_createTextures(e){const t=Math.floor(e.width/2),n=Math.floor(e.height/2);this._extractTex=this._createTex(t,n,"uint8"),this._extractFBO=this._createFBO(this._extractTex),this._blurHTex=this._createTex(t,n,"uint8"),this._blurHFBO=this._createFBO(this._blurHTex),this._blurVTex=this._createTex(e.width,e.height,"uint8"),this._blurVFBO=this._createFBO(this._blurVTex)}_createTex(e,t,n){return this._renderer.regl.texture({min:"linear",mag:"linear",wrap:"clamp",type:n,width:e,height:t})}_createFBO(e){return this._renderer.regl.framebuffer({width:e.width,height:e.height,colors:[e],depth:!1,stencil:!1})}dispose(){this._extractFBO&&(this._extractFBO.destroy(),delete this._extractFBO,this._blurVFBO.destroy(),this._blurHFBO.destroy(),this._ssaoExtractShader.dispose(),this._ssaoBlurShader.dispose(),delete this._ssaoExtractShader)}_initShaders(){this._ssaoExtractShader||(this._ssaoExtractShader=new bt$5,this._ssaoBlurShader=new _t$5)}}class yt$5 extends ht$6{constructor(){super({vert:ft$6,frag:"precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec2 resolution;\nuniform sampler2D textureSource;\nuniform float enableVignette;\nuniform float enableGrain;\nuniform float enableLut;\nuniform float timeGrain;\nuniform float grainFactor;\nuniform vec2 lensRadius;\nuniform float frameMod;\nuniform sampler2D lookupTable;\nfloat c(const in vec2 d) {\n  vec3 e = fract(vec3(d.xyx) * .1031);\n  e += dot(e, e.yzx + 19.19);\n  return fract((e.x + e.y) * e.z);\n}\nfloat f() {\n  float h = c(gl_FragCoord.xy + 1000.0 * fract(timeGrain));\n  float i = h * 2. - 1.;\n  h = i * inversesqrt(abs(i));\n  h = max(-1., h);\n  h = h - sign(i) + .5;\n  return (h + .5) * .5;\n}\nvec4 j(const in vec4 k) {\n  float l = f();\n  return vec4(mix(k.rgb, k.rgb * (k.rgb + (1. - k.rgb) * 2. * l), grainFactor), k.a);\n}\nfloat m(const in float k) {\n  return k < .0031308 ? k * 12.92 : 1.055 * pow(k, 1. / 2.4) - .055;\n}\nvec3 m(const in vec3 k) {\n  return vec3(k.r < .0031308 ? k.r * 12.92 : 1.055 * pow(k.r, 1. / 2.4) - .055, k.g < .0031308 ? k.g * 12.92 : 1.055 * pow(k.g, 1. / 2.4) - .055, k.b < .0031308 ? k.b * 12.92 : 1.055 * pow(k.b, 1. / 2.4) - .055);\n}\nvec4 m(const in vec4 k) {\n  return vec4(k.r < .0031308 ? k.r * 12.92 : 1.055 * pow(k.r, 1. / 2.4) - .055, k.g < .0031308 ? k.g * 12.92 : 1.055 * pow(k.g, 1. / 2.4) - .055, k.b < .0031308 ? k.b * 12.92 : 1.055 * pow(k.b, 1. / 2.4) - .055, k.a);\n}\nfloat n(const in float k) {\n  return k < .04045 ? k * (1. / 12.92) : pow((k + .055) * (1. / 1.055), 2.4);\n}\nvec3 n(const in vec3 k) {\n  return vec3(k.r < .04045 ? k.r * (1. / 12.92) : pow((k.r + .055) * (1. / 1.055), 2.4), k.g < .04045 ? k.g * (1. / 12.92) : pow((k.g + .055) * (1. / 1.055), 2.4), k.b < .04045 ? k.b * (1. / 12.92) : pow((k.b + .055) * (1. / 1.055), 2.4));\n}\nvec4 n(const in vec4 k) {\n  return vec4(k.r < .04045 ? k.r * (1. / 12.92) : pow((k.r + .055) * (1. / 1.055), 2.4), k.g < .04045 ? k.g * (1. / 12.92) : pow((k.g + .055) * (1. / 1.055), 2.4), k.b < .04045 ? k.b * (1. / 12.92) : pow((k.b + .055) * (1. / 1.055), 2.4), k.a);\n}\nfloat o(const in vec2 d, const in float u) {\n  vec3 v = vec3(.06711056, .00583715, 52.9829189);\n  return fract(v.z * fract(dot(d.xy + u * vec2(47., 17.) * .695, v.xy)));\n}\nfloat A() {\n  vec2 B = lensRadius;\n  B.y = min(B.y, B.x - 1e-4);\n  float C = o(gl_FragCoord.xy, frameMod);\n  C = (B.x - B.y) * (B.x + B.y) * .07 * (C - .5);\n  return smoothstep(B.x, B.y, C + distance(vTexCoord, vec2(.5)));\n}\nvec4 D(const in vec4 k) {\n  float l = A();\n  return vec4(m(n(k.rgb) * l), clamp(k.a + (1. - l), .0, 1.));\n}\nvec4 E(in vec4 F, in sampler2D G) {\n  mediump float H = F.b * 63.;\n  mediump vec2 I;\n  I.y = floor(floor(H) / 8.);\n  I.x = floor(H) - I.y * 8.;\n  mediump vec2 J;\n  J.y = floor(ceil(H) / 8.);\n  J.x = ceil(H) - J.y * 8.;\n  highp vec2 K;\n  K.x = I.x * .125 + .5 / 512. + (.125 - 1. / 512.) * F.r;\n  K.y = I.y * .125 + .5 / 512. + (.125 - 1. / 512.) * F.g;\n#ifdef LUT_FLIP_Y\nK.y = 1. - K.y;\n#endif\nhighp vec2 L;\n  L.x = J.x * .125 + .5 / 512. + (.125 - 1. / 512.) * F.r;\n  L.y = J.y * .125 + .5 / 512. + (.125 - 1. / 512.) * F.g;\n#ifdef LUT_FLIP_Y\nL.y = 1. - L.y;\n#endif\nlowp vec4 M = texture2D(G, K);\n  lowp vec4 N = texture2D(G, L);\n  lowp vec4 O = mix(M, N, fract(H));\n  return O;\n}\nvoid main() {\n  vec4 k = texture2D(textureSource, vTexCoord);\n  if(enableLut == 1.) {\n    k = E(k, lookupTable);\n  }\n  if(enableVignette == 1.) {\n    k = D(k);\n  }\n  if(enableGrain == 1.) {\n    k = j(k);\n  }\n  gl_FragColor = k;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,t)=>t.resolution[0],height:(e,t)=>t.resolution[1]}}})}getMeshCommand(e,t){return this.commands.postprocess||(this.commands.postprocess=this.createREGLCommand(e,null,t.getElements())),this.commands.postprocess}}class At$5 extends ht$6{constructor(){super({vert:ft$6,frag:"#define SHADER_NAME TAA\nprecision mediump float;\n#define saturate(x)        clamp(x, 0.0, 1.0)\n#if defined(TARGET_METAL_ENVIRONMENT) || defined(TARGET_VULKAN_ENVIRONMENT)\n#define TEXTURE_SPACE_UP    -1\n#define TEXTURE_SPACE_DN     1\n#else\n#define TEXTURE_SPACE_UP     1\n#define TEXTURE_SPACE_DN    -1\n#endif\n#define BOX_TYPE_AABB           0\n#define BOX_TYPE_VARIANCE       1\n#define BOX_TYPE_AABB_VARIANCE  2\n#define VARIANCE_GAMMA          1.0\n#define BOX_CLIPPING_ACCURATE   0\n#define BOX_CLIPPING_CLAMP      1\n#define BOX_CLIPPING_NONE       2\n#if defined(TARGET_MOBILE)\n#define BOX_CLIPPING            BOX_CLIPPING_ACCURATE\n#define BOX_TYPE                BOX_TYPE_VARIANCE\n#define USE_YCoCg               0\n#define FILTER_INPUT            1\n#define FILTER_HISTORY          0\n#else\n#define BOX_CLIPPING            BOX_CLIPPING_ACCURATE\n#define BOX_TYPE                BOX_TYPE_AABB_VARIANCE\n#define USE_YCoCg               0\n#define FILTER_INPUT            0\n#define FILTER_HISTORY          0\n#endif\n#define HISTORY_REPROJECTION    1\n#define PREVENT_FLICKERING      0\nstruct MaterialParams {\n  float alpha;\n  mat4 reprojection;\n};\nuniform sampler2D materialParams_color;\nuniform sampler2D materialParams_history;\nuniform vec2 materialParams_history_size;\nuniform vec2 textureOutputSize;\nuniform sampler2D materialParams_depth;\nuniform MaterialParams materialParams;\nfloat c(const vec3 d) {\n  return dot(d, vec3(.2126, .7152, .0722));\n}\nfloat e(const vec3 f) {\n  \n#if USE_YCoCg\nreturn f.x;\n#else\nreturn c(f);\n#endif\n}\nvec3 h(const vec3 i) {\n  float j = dot(i.rgb, vec3(1, 2, 1) * .25);\n  float k = dot(i.rgb, vec3(2, 0, -2) * .25);\n  float l = dot(i.rgb, vec3(-1, 2, -1) * .25);\n  return vec3(j, k, l);\n}\nvec3 m(const vec3 i) {\n  float j = i.x;\n  float k = i.y;\n  float l = i.z;\n  float r = j + k - l;\n  float g = j + l;\n  float b = j - k - l;\n  return vec3(r, g, b);\n}\nvec4 n(const int o, const vec3 u, const vec3 v, const vec4 i, const vec4 A) {\n  const float B = .0001;\n  if(o == BOX_CLIPPING_ACCURATE) {\n    vec4 r = i - A;\n    vec3 C = 1. / (B + r.rgb);\n    vec3 D = (v - A.rgb) * C;\n    vec3 E = (u - A.rgb) * C;\n    vec3 F = min(D, E);\n    return A + r * saturate(max(max(F.x, F.y), F.z));\n  } else if(o == BOX_CLIPPING_CLAMP) {\n    return vec4(clamp(A.rgb, u, v), A.a);\n  }\n  return A;\n}\nvec4 G(const sampler2D H, const highp vec2 I, const highp vec2 J) {\n  highp vec2 K = I * J;\n  highp vec2 L = floor(K - .5) + .5;\n  highp vec2 M = K - L;\n  highp vec2 N = M * M;\n  highp vec2 O = N * M;\n  vec2 P = N - .5 * (O + M);\n  vec2 Q = 1.5 * O - 2.5 * N + 1.;\n  vec2 R = .5 * (O - N);\n  vec2 S = 1. - P - Q - R;\n  vec2 T = Q + S;\n  highp vec2 U = L - vec2(1.);\n  highp vec2 V = L + vec2(2.);\n  highp vec2 W = L + S / T;\n  highp vec2 X = 1. / J;\n  U *= X;\n  V *= X;\n  W *= X;\n  float Z = T.x * P.y;\n  float ba = P.x * T.y;\n  float bb = T.x * T.y;\n  float bc = R.x * T.y;\n  float bd = T.x * R.y;\n  vec4 be = texture2D(H, vec2(W.x, U.y)) * Z + texture2D(H, vec2(U.x, W.y)) * ba + texture2D(H, vec2(W.x, W.y)) * bb + texture2D(H, vec2(V.x, W.y)) * bc + texture2D(H, vec2(W.x, V.y)) * bd;\n  be *= 1. / (Z + ba + bb + bc + bd);\n  return be;\n}\nvec4 bf(sampler2D H, vec2 I, float bg, ivec2 bh) {\n  return texture2D(H, I + vec2(bh));\n}\nvoid main() {\n  highp vec4 I = (gl_FragCoord.xy / textureOutputSize.xy).xyxy;\n  float bi = texture2D(materialParams_depth, I.xy).r;\n#if HISTORY_REPROJECTION\n#if defined(TARGET_METAL_ENVIRONMENT) || defined(TARGET_VULKAN_ENVIRONMENT)\nI.w = 1. - I.w;\n#endif\nhighp vec4 q = materialParams.reprojection * vec4(I.zw, bi, 1.);\n  I.zw = (q.xy * (1. / q.w)) * .5 + .5;\n#if defined(TARGET_METAL_ENVIRONMENT) || defined(TARGET_VULKAN_ENVIRONMENT)\nI.w = 1. - I.w;\n#endif\n#endif\nvec4 f = bf(materialParams_color, I.xy, .0, ivec2(0));\n#if FILTER_HISTORY\nvec4 bj = G(materialParams_history, I.zw, materialParams_history_size);\n#else\nvec4 bj = texture2D(materialParams_history, I.zw);\n#endif\n#if USE_YCoCg\nbj.rgb = h(bj.rgb);\n#endif\nvec3 s[9];\n  s[0] = bf(materialParams_color, I.xy, .0, ivec2(-1, TEXTURE_SPACE_DN)).rgb;\n  s[1] = bf(materialParams_color, I.xy, .0, ivec2(0, TEXTURE_SPACE_DN)).rgb;\n  s[2] = bf(materialParams_color, I.xy, .0, ivec2(1, TEXTURE_SPACE_DN)).rgb;\n  s[3] = bf(materialParams_color, I.xy, .0, ivec2(-1, 0)).rgb;\n  s[4] = f.rgb;\n  s[5] = bf(materialParams_color, I.xy, .0, ivec2(1, 0)).rgb;\n  s[6] = bf(materialParams_color, I.xy, .0, ivec2(-1, TEXTURE_SPACE_UP)).rgb;\n  s[7] = bf(materialParams_color, I.xy, .0, ivec2(0, TEXTURE_SPACE_UP)).rgb;\n  s[8] = bf(materialParams_color, I.xy, .0, ivec2(1, TEXTURE_SPACE_UP)).rgb;\n#if USE_YCoCg\nfor(int bk = 0; bk < 9; bk++) {\n    s[bk] = h(s[bk]);\n  }\n  f.rgb = s[4].rgb;\n#endif\n#if FILTER_INPUT\n#else\nvec4 bl = f;\n#endif\n#if BOX_TYPE == BOX_TYPE_AABB || BOX_TYPE == BOX_TYPE_AABB_VARIANCE\nvec3 u = min(s[4], min(min(s[1], s[3]), min(s[5], s[7])));\n  vec3 v = max(s[4], max(max(s[1], s[3]), max(s[5], s[7])));\n  vec3 bm = min(u, min(min(s[0], s[2]), min(s[6], s[8])));\n  vec3 bn = max(v, max(max(s[0], s[2]), max(s[6], s[8])));\n  u = (u + bm) * .5;\n  v = (v + bn) * .5;\n#endif\n#if BOX_TYPE == BOX_TYPE_VARIANCE || BOX_TYPE == BOX_TYPE_AABB_VARIANCE\nvec3 bo = s[4];\n  vec3 bp = s[4] * s[4];\n  for(int bk = 1; bk < 9; bk += 2) {\n    bo += s[bk];\n    bp += s[bk] * s[bk];\n  }\n  vec3 bq = bo * (1. / 5.);\n  vec3 br = bp * (1. / 5.);\n  vec3 bs = sqrt(br - bq * bq);\n#if BOX_TYPE == BOX_TYPE_VARIANCE\nvec3 u = bq - VARIANCE_GAMMA * bs;\n  vec3 v = bq + VARIANCE_GAMMA * bs;\n#else\nu = min(u, bq - VARIANCE_GAMMA * bs);\n  v = max(v, bq + VARIANCE_GAMMA * bs);\n#endif\n#endif\nfloat bt = e(bl.rgb);\n  float bu = e(bj.rgb);\n  float bv = materialParams.alpha;\n#if PREVENT_FLICKERING\nfloat bw = 1. - abs(bt - bu) / (.001 + max(bt, bu));\n  bv *= bw * bw;\n#endif\nbl.rgb *= 1. / (1. + bt);\n  bj.rgb *= 1. / (1. + bu);\n  vec4 be = mix(bj, bl, bv);\n  be.rgb *= 1. / (1. - e(be.rgb));\n#if USE_YCoCg\nbe.rgb = m(be.rgb);\n#endif\nbe = max(vec4(0), be);\n  gl_FragColor = be;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,t)=>t.materialParams_color.width,height:(e,t)=>t.materialParams_color.height},blend:{enable:!1}}})}getMeshCommand(e,t){return this.commands.taa||(this.commands.taa=this.createREGLCommand(e,null,t.getElements())),this.commands.taa}}const Tt$5=[2,0,0,0,0,2,0,0,0,0,-2,0,-1,-1,1,1];class St$5{constructor(e,t){this._jitter=t,this._renderer=e,this._halton=[],this._counter=0}needToRedraw(){return this._counter<this._jitter.getSampleCount()}render(e,n,r,i){const a=this._jitter;this._initShaders(),this._createTextures(e),i&&(this._counter=0),this._counter++;const s=a.getSampleCount();if(this._counter>=s)return this._prevTex;this._fbo.width===e.width&&this._fbo.height===e.height||this._fbo.resize(e.width,e.height);const c=this._outputTex,l=this._prevTex,f=this._uniforms||{materialParams_history_size:[l.width,l.height],textureOutputSize:[],materialParams:{alpha:1,reprojection:[],filterWeights:[]}};f.materialParams.alpha=1/this._counter;const u=f.materialParams.reprojection;multiply$5(u,this._prevProjMatrix||r,invert$2(u,r)),multiply$5(u,u,Tt$5),set(f.materialParams_history_size,l.width,l.height),set(f.textureOutputSize,e.width,e.height),f.materialParams_depth=n,f.materialParams_color=e,f.materialParams_history=l,this._renderer.render(this._shader,f,null,this._fbo);const d=this._outputTex,h=this._fbo;return this._outputTex=this._prevTex,this._fbo=this._prevFbo,this._prevTex=d,this._prevFbo=h,this._prevProjMatrix=copy$5(this._prevProjMatrix||[],r),c}dispose(){this._shader&&(this._shader.dispose(),delete this._shader),this._fbo&&this._fbo.destroy(),this._prevFbo&&this._prevFbo.destroy(),delete this._uniforms}_createTextures(e){if(this._outputTex)return;const t=this._renderer.regl;this._outputTex=this._createColorTex(e),this._fbo=t.framebuffer({width:e.width,height:e.height,colors:[this._outputTex],depth:!1,stencil:!1}),this._prevTex=this._createColorTex(e),this._prevFbo=t.framebuffer({width:e.width,height:e.height,colors:[this._prevTex],depth:!1,stencil:!1})}_createColorTex(e){return this._renderer.regl.texture({min:"linear",mag:"linear",type:"uint8",width:e.width,height:e.height})}_initShaders(){this._shader||(this._shader=new At$5)}}const Mt$5=[[.263385,-.0252475],[-.38545,.054485],[-.139795,-.5379925],[-.2793775,.6875475],[.7139025,.4710925],[.90044,-.16422],[.4481775,-.82799],[-.9253375,-.2910625],[.3468025,1.02292],[-1.13742,.33522],[-.7676225,-.9123175],[-.2005775,-1.1774125],[-.926525,.96876],[1.12909,-.7500325],[.9603,1.14625]],Et$5=Mt$5.length,Ot$5=[0,0];for(let e=0;e<Mt$5.length;e++)Ot$5[0]+=Mt$5[e][0],Ot$5[1]+=Mt$5[e][1];Ot$5[0]/=Et$5,Ot$5[1]/=Et$5;class Ct$5{constructor(e){this._frameNum=0,this._ratio=e||.05,this._avg=[Ot$5[0]*this._ratio,Ot$5[1]*this._ratio]}getRatio(){return this._ratio}setRatio(e){this._ratio!==e&&(this._ratio=e,this.reset()),this._avg=[Ot$5[0]*this._ratio,Ot$5[1]*this._ratio]}getAverage(){return this._avg}reset(){this._frameNum=0}getJitter(e){const t=this._frameNum%Et$5,n=this._ratio;return set(e,Mt$5[t][0]*n,Mt$5[t][1]*n),e}frame(){this._frameNum++,this._frameNum%Et$5==0&&(this._frameNum=0)}getSampleCount(){return Et$5}}class Pt$4{constructor(e,t,n=5){this._regl=e,this._renderer=new k$7(e),this._inputRGBM=t,this._level=n}render(e,t){this._initShaders(),this._createTextures(e),this._blur(e,t||0);const n={blurTex0:this._blur01Tex,blurTex1:this._blur11Tex,blurTex2:this._blur21Tex,blurTex3:this._blur31Tex,blurTex4:this._blur41Tex};return this._level>5&&(n.blurTex5=this._blur51Tex,n.blurTex6=this._blur61Tex),n}_blur(e,t){let n=this._blurUniforms;n||(n=this._blurUniforms={rgbmRange:7,blurDir:[0,0],outSize:[0,0],pixelRatio:[1,1],outputSize:[0,0]}),set(n.outSize,e.width,e.height),this._blurOnce(this._blur0Shader,e,this._blur00FBO,this._blur01FBO,.5,t),this._blurOnce(this._blur1Shader,this._blur01FBO.color[0],this._blur10FBO,this._blur11FBO,.5),this._blurOnce(this._blur2Shader,this._blur11FBO.color[0],this._blur20FBO,this._blur21FBO,.5),this._blurOnce(this._blur3Shader,this._blur21FBO.color[0],this._blur30FBO,this._blur31FBO,.5),this._blurOnce(this._blur4Shader,this._blur31FBO.color[0],this._blur40FBO,this._blur41FBO,.5),this._level>5&&(this._blurOnce(this._blur5Shader,this._blur41FBO.color[0],this._blur50FBO,this._blur51FBO,.5),this._blurOnce(this._blur6Shader,this._blur51FBO.color[0],this._blur60FBO,this._blur51FBO,.5))}_blurOnce(e,t,n,r,i,a){const s=Math.ceil(i*t.width),c=Math.ceil(i*t.height);n.width===s&&n.height===c||n.resize(s,c),r.width===s&&r.height===c||r.resize(s,c);const l=this._blurUniforms;l.luminThreshold=a,l.TextureBlurInput=t,l.inputRGBM=+this._inputRGBM,set(l.blurDir,0,1),set(l.outputSize,n.width,n.height),this._renderer.render(e,l,null,n),l.luminThreshold=0,l.inputRGBM=1,set(l.blurDir,1,0),l.TextureBlurInput=n.color[0],this._renderer.render(e,l,null,r)}dispose(){this._blur0Shader&&(this._blur0Shader.dispose(),delete this._blur0Shader,this._blur1Shader.dispose(),this._blur2Shader.dispose(),this._blur3Shader.dispose(),this._blur4Shader.dispose(),this._blur5Shader&&(this._blur5Shader.dispose(),this._blur6Shader.dispose(),delete this._blur5Shader)),this._blur00Tex&&(delete this._blur00Tex,this._blur00FBO.destroy(),this._blur01FBO.destroy(),this._blur10FBO.destroy(),this._blur11FBO.destroy(),this._blur20FBO.destroy(),this._blur21FBO.destroy(),this._blur30FBO.destroy(),this._blur31FBO.destroy(),this._blur40FBO.destroy(),this._blur41FBO.destroy(),this._blur50FBO&&(this._blur50FBO.destroy(),this._blur51FBO.destroy(),this._blur60FBO.destroy(),this._blur61FBO.destroy()))}_createTextures(e){if(this._blur00Tex)return;let t=e.width,n=e.height;this._blur00Tex=this._createColorTex(e,t,n),this._blur00FBO=this._createBlurFBO(this._blur00Tex),this._blur01Tex=this._createColorTex(e),this._blur01FBO=this._createBlurFBO(this._blur01Tex),t=Math.ceil(t/2),n=Math.ceil(n/2),this._blur10Tex=this._createColorTex(e,t,n),this._blur10FBO=this._createBlurFBO(this._blur10Tex),this._blur11Tex=this._createColorTex(e,t,n),this._blur11FBO=this._createBlurFBO(this._blur11Tex),t=Math.ceil(t/2),n=Math.ceil(n/2),this._blur20Tex=this._createColorTex(e,t,n),this._blur20FBO=this._createBlurFBO(this._blur20Tex),this._blur21Tex=this._createColorTex(e,t,n),this._blur21FBO=this._createBlurFBO(this._blur21Tex),t=Math.ceil(t/2),n=Math.ceil(n/2),this._blur30Tex=this._createColorTex(e,t,n),this._blur30FBO=this._createBlurFBO(this._blur30Tex),this._blur31Tex=this._createColorTex(e,t,n),this._blur31FBO=this._createBlurFBO(this._blur31Tex),t=Math.ceil(t/2),n=Math.ceil(n/2),this._blur40Tex=this._createColorTex(e,t,n),this._blur40FBO=this._createBlurFBO(this._blur40Tex),this._blur41Tex=this._createColorTex(e,t,n),this._blur41FBO=this._createBlurFBO(this._blur41Tex),this._level>5&&(t=Math.ceil(t/2),n=Math.ceil(n/2),this._blur50Tex=this._createColorTex(e,t,n),this._blur50FBO=this._createBlurFBO(this._blur50Tex),this._blur51Tex=this._createColorTex(e,t,n),this._blur51FBO=this._createBlurFBO(this._blur51Tex),t=Math.ceil(t/2),n=Math.ceil(n/2),this._blur60Tex=this._createColorTex(e,t,n),this._blur60FBO=this._createBlurFBO(this._blur60Tex),this._blur61Tex=this._createColorTex(e,t,n),this._blur61FBO=this._createBlurFBO(this._blur61Tex))}_createColorTex(e,t,n){return this._regl.texture({min:"linear",mag:"linear",type:"uint8",width:t||e.width,height:n||e.height})}_createBlurFBO(e){return this._regl.framebuffer({width:e.width,height:e.height,colors:[e],depth:!1,stencil:!1})}_initShaders(){if(!this._blur0Shader){const e={vert:ft$6,extraCommandProps:{viewport:{x:0,y:0,width:(e,t)=>t.outputSize[0],height:(e,t)=>t.outputSize[1]}},frag:"#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\nuniform float inputRGBM;\nuniform float luminThreshold;\n#define SHADER_NAME GAUSSIAN_BLUR0\nconst vec3 c = vec3(.2126, .7152, .0722);\nfloat d(const in vec3 e) {\n  return dot(e, c);\n}\nvec4 f(vec4 e) {\n  float h = max(sign(d(e.rgb) - luminThreshold), .0);\n  return e * h;\n}\nvec2 i;\nvec4 j(const in vec3 e, const in float k) {\n  vec4 l;\n  vec3 m = e / k;\n  l.a = clamp(max(max(m.r, m.g), max(m.b, 1e-6)), .0, 1.);\n  l.a = ceil(l.a * 255.) / 255.;\n  l.rgb = m / l.a;\n  return l;\n}\nvec3 n(const in vec4 e, const in float k) {\n  if(inputRGBM == .0)\n    return e.rgb;\n  return k * e.rgb * e.a;\n}\nvec4 o() {\n  vec3 u = .375 * (f(vec4(n(texture2D(TextureBlurInput, i.xy), rgbmRange), 1.))).rgb;\n  vec2 v;\n  vec2 A = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  v = A * 1.2;\n  u += .3125 * (f(vec4(n(texture2D(TextureBlurInput, i.xy + v.xy), rgbmRange), 1.))).rgb;\n  u += .3125 * (f(vec4(n(texture2D(TextureBlurInput, i.xy - v.xy), rgbmRange), 1.))).rgb;\n  return vec4(u, 1.);\n}\nvoid main(void) {\n  i = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = o();\n  e = j(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}"};this._blur0Shader=new ht$6(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR1\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .3125 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.2857142857142858;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur1Shader=new ht$6(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR2\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .2734375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3333333333333333;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.111111111111111;\n  l += .03515625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .03515625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur2Shader=new ht$6(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR3\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .24609375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3636363636363635;\n  l += .322265625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .322265625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.1818181818181817;\n  l += .0537109375 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .0537109375 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur3Shader=new ht$6(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR4\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .2255859375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3846153846153846;\n  l += .314208984375 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .314208984375 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.230769230769231;\n  l += .06982421875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .06982421875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.076923076923077;\n  l += .003173828125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .003173828125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur4Shader=new ht$6(e),this._level>5&&(e.frag="precision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 outSize;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR5\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .20947265625 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  n *= outSize.y * .00075;\n  m = n * 1.4;\n  l += .30548095703125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .30548095703125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.2666666666666666;\n  l += .08331298828125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .08331298828125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.133333333333334;\n  l += .00640869140625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .00640869140625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur5Shader=new ht$6(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 outSize;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR6\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .196380615234375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  n *= outSize.y * .00075;\n  m = n * 1.411764705882353;\n  l += .2967529296875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .2967529296875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.2941176470588234;\n  l += .09442138671875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .09442138671875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.176470588235294;\n  l += .0103759765625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .0103759765625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur6Shader=new ht$6(e))}}}class wt$5{constructor(e){this._regl=e,this._renderer=new k$7(e)}render(e,t,n,r,i,o,a,s,c){this._initShaders(),this._createTextures(e);const l=this._blurPass.render(t,n);return this._combine(e,l,t,r,i,o,a,s,c)}_combine(e,t,n,r,i,a,s,c,l){l||this._combineTex.width===e.width&&this._combineTex.height===e.height||this._combineFBO.resize(e.width,e.height);let f=this._combineUniforms;const{blurTex0:u,blurTex1:d,blurTex2:h,blurTex3:m,blurTex4:v}=t;f||(f=this._combineUniforms={bloomFactor:0,bloomRadius:0,rgbmRange:7,TextureBloomBlur1:u,TextureBloomBlur2:d,TextureBloomBlur3:h,TextureBloomBlur4:m,TextureBloomBlur5:v,TextureInput:null,TextureSource:null,outputSize:[0,0]}),f.noAaTextureSource=a,f.pointTextureSource=s,f.enableAA=c,f.bloomFactor=r,f.bloomRadius=i,f.TextureInput=n,f.TextureSource=e,set(f.outputSize,e.width,e.height);const _={};return a?_.HAS_NOAA_TEX=1:delete _.HAS_NOAA_TEX,s?_.HAS_POINT_TEX=1:delete _.HAS_POINT_TEX,this._combineShader.setDefines(_),this._renderer.render(this._combineShader,f,null,l?null:this._combineFBO),l?null:this._combineTex}dispose(){this._combineFBO&&(this._combineFBO.destroy(),delete this._combineFBO),this._blurPass&&(this._blurPass.dispose(),delete this._blurPass),delete this._uniforms}_createTextures(e){this._combineTex||(this._combineTex=this._createColorTex(e,e.width,e.height,"uint8"),this._combineFBO=this._createBlurFBO(this._combineTex))}_createColorTex(e,t,n,r){const i=this._renderer.regl,o=r||(i.hasExtension("OES_texture_half_float")?"float16":"float");return i.texture({min:"linear",mag:"linear",type:o,width:t||e.width,height:n||e.height})}_createBlurFBO(e){return this._renderer.regl.framebuffer({width:e.width,height:e.height,colors:[e],depth:!1,stencil:!1})}_initShaders(){if(!this._combineShader){const e={x:0,y:0,width:(e,t)=>t.outputSize[0],height:(e,t)=>t.outputSize[1]};this._blurPass=new Pt$4(this._regl,!1),this._combineShader=new ht$6({vert:ft$6,frag:"#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#define FXAA_SPAN_MAX     8.0\nprecision highp float;\nuniform float bloomFactor;\nuniform float bloomRadius;\nuniform float rgbmRange;\nuniform sampler2D TextureBloomBlur1;\nuniform sampler2D TextureBloomBlur2;\nuniform sampler2D TextureBloomBlur3;\nuniform sampler2D TextureBloomBlur4;\nuniform sampler2D TextureBloomBlur5;\nuniform sampler2D TextureInput;\nuniform sampler2D TextureSource;\n#ifdef HAS_NOAA_TEX\nuniform sampler2D noAaTextureSource;\n#endif\n#ifdef HAS_POINT_TEX\nuniform sampler2D pointTextureSource;\n#endif\nuniform float enableAA;\nuniform vec2 outputSize;\n#define SHADER_NAME bloomCombine\nvec2 c;\nvec3 d(const in vec3 e) {\n  return vec3(e.r < .0031308 ? e.r * 12.92 : 1.055 * pow(e.r, 1. / 2.4) - .055, e.g < .0031308 ? e.g * 12.92 : 1.055 * pow(e.g, 1. / 2.4) - .055, e.b < .0031308 ? e.b * 12.92 : 1.055 * pow(e.b, 1. / 2.4) - .055);\n}\nvec3 f(const in vec4 e, const in float h) {\n  if(h <= .0)\n    return e.rgb;\n  return h * e.rgb * e.a;\n}\nfloat i(const float j, const float k) {\n  return mix(j, k * 2. - j, bloomRadius);\n}\nvec4 l(sampler2D m, vec2 n) {\n  vec4 e;\n  mediump vec2 o = vec2(1. / outputSize.x, 1. / outputSize.y);\n  vec3 u = texture2D(m, (n + vec2(-1., -1.)) * o).xyz;\n  vec3 v = texture2D(m, (n + vec2(1., -1.)) * o).xyz;\n  vec3 A = texture2D(m, (n + vec2(-1., 1.)) * o).xyz;\n  vec3 B = texture2D(m, (n + vec2(1.)) * o).xyz;\n  vec4 C = texture2D(m, n * o);\n  vec3 D = C.xyz;\n  vec3 E = vec3(.299, .587, .114);\n  float F = dot(u, E);\n  float G = dot(v, E);\n  float H = dot(A, E);\n  float I = dot(B, E);\n  float J = dot(D, E);\n  float K = min(J, min(min(F, G), min(H, I)));\n  float L = max(J, max(max(F, G), max(H, I)));\n  mediump vec2 M;\n  M.x = -((F + G) - (H + I));\n  M.y = (F + H) - (G + I);\n  float N = max((F + G + H + I) * (.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n  float O = 1. / (min(abs(M.x), abs(M.y)) + N);\n  M = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), M * O)) * o;\n  vec4 P = .5 * (texture2D(m, n * o + M * (1. / 3. - .5)) + texture2D(m, n * o + M * (2. / 3. - .5)));\n  vec4 Q = P * .5 + .25 * (texture2D(m, n * o + M * -.5) + texture2D(m, n * o + M * .5));\n  float R = dot(Q.xyz, E);\n  if(R < K || R > L)\n    e = P;\n  else\n    e = Q;\n  return e;\n}\nvec4 S() {\n  vec3 T = vec3(.0);\n  const float U = .6;\n  const float V = 1.1;\n  const float W = .9;\n  const float X = .6;\n  const float Y = .3;\n  const float Z = .1;\n  T += (vec4(f(texture2D(TextureBloomBlur1, c), rgbmRange), 1.)).rgb * i(V, U);\n  T += (vec4(f(texture2D(TextureBloomBlur2, c), rgbmRange), 1.)).rgb * i(W, U);\n  T += (vec4(f(texture2D(TextureBloomBlur3, c), rgbmRange), 1.)).rgb * i(X, U);\n  T += (vec4(f(texture2D(TextureBloomBlur4, c), rgbmRange), 1.)).rgb * i(Y, U);\n  T += (vec4(f(texture2D(TextureBloomBlur5, c), rgbmRange), 1.)).rgb * i(Z, U);\n  vec4 ba;\n  if(enableAA == 1.) {\n    ba = l(TextureInput, gl_FragCoord.xy);\n  } else {\n    ba = texture2D(TextureInput, c);\n  }\n  ba.rgb = mix(vec3(.0), ba.rgb, sign(ba.a));\n  vec4 bb = texture2D(TextureSource, c);\n#ifdef HAS_NOAA_TEX\nvec4 bc = texture2D(noAaTextureSource, c);\n  bb = bc + bb * (1. - bc.a);\n#endif\nvec4 bd = vec4(.0);\n#ifdef HAS_POINT_TEX\nbd = texture2D(pointTextureSource, c);\n#endif\nfloat be = sqrt((T.r + T.g + T.b) / 3.);\n  vec4 bf = vec4(d(T * bloomFactor), be);\n  return bd + (ba + bb * (1. - ba.a)) * (1. - bd.a) + bf;\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = S();\n  gl_FragColor = e;\n}",extraCommandProps:{viewport:e}})}}}class It$4 extends ht$6{constructor(){const e=[];super({vert:ft$6,frag:"precision highp float;\n#include <gl2_frag>\n#define SHADER_NAME COPY_DEPTH\nuniform sampler2D TextureDepth;\nuniform vec2 textureSize;\n#include <common_pack_float>\nvoid main(void) {\n  vec2 c = gl_FragCoord.xy / textureSize.xy;\n  float d = texture2D(TextureDepth, c).r;\n  glFragColor = common_encodeDepth(d);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"textureSize",type:"function",fn:(t,n)=>(e[0]=n.TextureDepth.width,e[1]=n.TextureDepth.height,e)}],extraCommandProps:{viewport:{x:0,y:0,width:(e,t)=>t.TextureDepth.width,height:(e,t)=>t.TextureDepth.height}}}),this.version=300}getMeshCommand(e,t){return this.commands.copy_depth||(this.commands.copy_depth=this.createREGLCommand(e,null,t.getElements())),this.commands.copy_depth}}class Rt$4{static getUniformDeclares(){const e=[[0,0,0,0],[0,0,0,0]],n=new Array(16);return[{name:"invProjMatrix",type:"function",fn:(e,r)=>invert$2(n,r.projMatrix)},{name:"outputFovInfo",type:"array",length:2,fn:function(t,n){const i=Math.tan(.5*n.fov),o=n.outSize[0]/n.outSize[1]*i;return set$3(e[0],o,i,o,-i),set$3(e[1],-o,i,-o,-i),e}},{name:"reprojViewProjMatrix",type:"function",fn:(e,n)=>multiply$5([],n.prevProjViewMatrix,n.cameraWorldMatrix)}]}static getDefines(){return{HAS_SSR:1}}constructor(e){this._regl=e,this._renderer=new k$7(e),this._inputRGBM=0}setup(e){this._initShaders(),this._createTextures(e)}getSSRUniforms(e,t,n){if(!this._depthCopy)return null;const r=this._depthCopy;return{TextureDepth:r,TextureReflected:this.getMipmapTexture(),ssrFactor:t||1,ssrQuality:n||2,outSize:[r.width,r.height],fov:e.getFov()*Math.PI/180,prevProjViewMatrix:this._projViewMatrix||e.projViewMatrix,cameraWorldMatrix:e.cameraWorldMatrix}}genMipMap(e,n,r){return this.setup(e),this._mipmap(e),this.copyDepthTex(n),this._projViewMatrix||(this._projViewMatrix=[]),copy$5(this._projViewMatrix,r),delete this._depthCopied,this._outputTex}getPrevProjViewMatrix(){return this._projViewMatrix}copyDepthTex(e){return this._depthCopied?null:(this.setup(e),this._depthCopy?e.width===this._depthCopy.width&&e.height===this._depthCopy.height||this._depthCopyFBO.resize(e.width,e.height):(this._depthCopy=this._regl.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"uint8",width:e.width,height:e.height}),this._depthCopyFBO=this._regl.framebuffer({width:e.width,height:e.height,colors:[this._depthCopy],colorFormat:"rgba"})),this._renderer.render(this._copyDepthShader,{TextureDepth:e},null,this._depthCopyFBO),this._depthCopied=!0,this._depthCopy)}_mipmap(e){const t=this._targetFBO,n=Math.ceil(.5*e.width),r=Math.ceil(.5*e.height);t.width===n&&t.height===r||t.resize(n,r);let i=this._blurUniforms;i||(i=this._blurUniforms={rgbmRange:7,outputSize:[0,0]}),i.TextureInput=e,i.inputRGBM=+this._inputRGBM,set(i.outputSize,t.width,t.height),this._renderer.render(this._ssrQuadShader,i,null,t)}getMipmapTexture(){return this._outputTex||(this._outputTex=this._renderer.regl.texture({type:"uint8",width:2,height:2})),this._outputTex}dispose(){this._copyDepthShader&&(this._ssrQuadShader.dispose(),this._copyDepthShader.dispose(),this._targetFBO.destroy(),delete this._copyDepthShader),this._depthCopy&&(this._depthCopyFBO.destroy(),delete this._depthCopy,delete this._depthCopyFBO)}_initShaders(){this._copyDepthShader||(this._copyDepthShader=new It$4,this._ssrQuadShader=new ht$6({vert:ft$6,frag:"#version 100\nprecision mediump float;\nuniform sampler2D TextureInput;\nuniform vec2 outputSize;\n#define SHADER_NAME QUAD\nvec2 c;\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 d = texture2D(TextureInput, c.xy);\n  gl_FragColor = d;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,t)=>t.outputSize[0],height:(e,t)=>t.outputSize[1]}}}))}_createTextures(e){if(!this._targetFBO){const t=this._regl;this._outputTex&&this._outputTex.destroy(),this._outputTex=t.texture({min:"linear",mag:"linear",type:"uint8",width:e.width,height:e.height}),this._targetFBO=t.framebuffer({width:e.width,height:e.height,colors:[this._outputTex],depth:!1,stencil:!1})}}}class Dt$4 extends rt$6{constructor(e){const n=[];super({vert:"#define SHADER_NAME HEATMAP\nfloat c(const vec2 d, const float t) {\n  return mix(d[0], d[1], t);\n}\nuniform mat4 projViewModelMatrix;\nuniform float extrudeScale;\nuniform float heatmapIntensity;\nattribute vec3 aPosition;\nvarying vec2 vExtrude;\n#ifdef HAS_HEAT_WEIGHT\nuniform lowp float heatmapWeightT;\nattribute highp vec2 aWeight;\nvarying highp float weight;\n#else\nuniform highp float heatmapWeight;\n#endif\nuniform mediump float heatmapRadius;\nconst highp float e = 1. / 255. / 16.;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n  \n#ifdef HAS_HEAT_WEIGHT\nweight = c(aWeight, heatmapWeightT);\n#else\nhighp float f = heatmapWeight;\n#endif\nmediump float h = heatmapRadius;\n  vec2 i = vec2(mod(aPosition.xy, 2.) * 2. - 1.);\n  float j = sqrt(-2. * log(e / f / heatmapIntensity / GAUSS_COEF)) / 3.;\n  vExtrude = j * i;\n  vec2 k = vExtrude * h * extrudeScale;\n  vec4 l = vec4(floor(aPosition.xy * .5) + k, aPosition.z, 1);\n  gl_Position = projViewModelMatrix * l;\n}",frag:"#define SHADER_NAME HEATMAP\nprecision mediump float;\nuniform highp float heatmapIntensity;\nvarying vec2 vExtrude;\n#ifdef HAS_HEAT_WEIGHT\nvarying highp float weight;\n#else\nuniform highp float heatmapWeight;\n#endif\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n  \n#ifndef HAS_HEAT_WEIGHT\nhighp float c = heatmapWeight;\n#endif\nfloat d = -.5 * 3. * 3. * dot(vExtrude, vExtrude);\n  float e = c * heatmapIntensity * GAUSS_COEF * exp(d);\n  gl_FragColor = vec4(e, 1., 1., 1.);\n}",uniforms:[{name:"extrudeScale",type:"function",fn:function(e,t){return t.resolution/t.dataResolution*t.tileRatio}},{name:"projViewModelMatrix",type:"function",fn:function(e,r){return multiply$5(n,r.projViewMatrix,r.modelMatrix)}}],extraCommandProps:v$7({},e&&e.extraCommandProps||{},{blend:{enable:!0,func:{src:"one",dst:"one"},equation:"add"}})})}}var Nt$4=[-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1],Ft$5="#if __VERSION__ == 100\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\nprecision highp float;\n#include <gl2_frag>\n#include <hsv_frag>\nuniform vec3 hsv;\nvarying vec3 vWorldPos;\n#ifdef USE_AMBIENT\nuniform vec3 diffuseSPH[9];\n#else\nuniform samplerCube cubeMap;\nuniform float bias;\nuniform float size;\n#endif\nuniform float environmentExposure;\n#if defined(INPUT_RGBM) || defined(ENC_RGBM)\nuniform float rgbmRange;\n#endif\nvec4 c(const in vec3 d, const in float e) {\n  if(e <= .0)\n    return vec4(d, 1.);\n  vec4 f;\n  vec3 h = d / e;\n  f.a = clamp(max(max(h.r, h.g), max(h.b, 1e-6)), .0, 1.);\n  f.a = ceil(f.a * 255.) / 255.;\n  f.rgb = h / f.a;\n  return f;\n}\nvec3 i(const in vec4 d, const in float e) {\n  if(e <= .0)\n    return d.rgb;\n  return e * d.rgb * d.a;\n}\nvec4 j(const in samplerCube k, const in vec3 l, const in float m, const in float n) {\n  vec3 o = l;\n  return textureCubeLod(k, o, n);\n}\nvec3 u(const in vec3 v, const in vec3 A[9]) {\n  float x = v.x;\n  float y = v.y;\n  float z = v.z;\n  vec3 B = (A[0] + A[1] * x + A[2] * y + A[3] * z + A[4] * z * x + A[5] * y * z + A[6] * y * x + A[7] * (3. * z * z - 1.) + A[8] * (x * x - y * y));\n  return max(B, vec3(.0));\n}\nfloat C(const in vec2 D) {\n  vec3 E = fract(vec3(D.xyx) * .1031);\n  E += dot(E, E.yzx + 19.19);\n  return fract((E.x + E.y) * E.z);\n}\nvoid main() {\n  vec4 F;\n#ifdef USE_AMBIENT\nvec3 v = normalize(vWorldPos + mix(-.5 / 255., .5 / 255., C(gl_FragCoord.xy)) * 2.);\n  F = vec4(u(v, diffuseSPH), 1.);\n  if(length(hsv) > .0) {\n    F.rgb = hsv_apply(F.rgb, hsv);\n  }\n#ifdef ENC_RGBM\nF = c(F.rgb, rgbmRange);\n#endif\n#else\nF = j(cubeMap, normalize(vWorldPos), size, bias);\n#endif\nF.rgb *= environmentExposure;\n#ifdef ENC_RGBM\n#if !defined(USE_AMBIENT) && defined(INPUT_RGBM)\nif(length(hsv) > .0) {\n    F.rgb = hsv_apply(i(F, rgbmRange).rgb, hsv);\n    F = c(F.rgb, rgbmRange);\n  }\n#endif\nglFragColor = vec4(clamp(F.rgb, .0, 1.), 1.);\n#elif !defined(USE_AMBIENT) && defined(INPUT_RGBM)\nglFragColor = vec4(i(F, rgbmRange), 1.);\n  if(length(hsv) > .0) {\n    glFragColor.rgb = hsv_apply(clamp(glFragColor.rgb, .0, 1.), hsv);\n  }\n#else\nif(length(hsv) > .0) {\n    F.rgb = hsv_apply(F.rgb, hsv);\n  }\n  glFragColor = F;\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}";class Lt$5 extends rt$6{constructor(){super({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 transformMatrix;\nvarying vec3 vWorldPos;\nvoid main() {\n  vWorldPos = aPosition;\n  mat4 c = mat4(mat3(viewMatrix) * transformMatrix);\n  vec4 d = projMatrix * c * vec4(vWorldPos, 1.);\n  gl_Position = d.xyww;\n}",frag:Ft$5,extraCommandProps:{depth:{enable:!0,range:[1,1],func:"lequal"},viewport:{x:0,y:0,width:(e,t)=>t.resolution[0],height:(e,t)=>t.resolution[1]}}}),this.version=300}setMode(e,t,n){const r={};return e&&(r.INPUT_RGBM=1),t&&(r.ENC_RGBM=1),0===n&&(r.USE_AMBIENT=1),this._skyboxMesh?this._skyboxMesh[0].setDefines(r):this._meshDefines=r,this}draw(e){return this._skyboxMesh||this._createSkyboxMesh(e),super.draw(e,this._skyboxMesh)}_createSkyboxMesh(e){const t=new Z$7({aPosition:new Int8Array(Nt$4)},null,Nt$4.length/3);t.generateBuffers(e),this._skyboxMesh=[new de$4(t)],this._meshDefines&&(this._skyboxMesh[0].setDefines(this._meshDefines),delete this._meshDefines)}dispose(){if(this._skyboxMesh){const e=this._skyboxMesh[0];e.geometry.dispose(),e.dispose()}return delete this._skyboxMesh,super.dispose()}}class Ht$4 extends rt$6{constructor(e,n){const r={blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},viewport:e};n&&n.extraCommandProps&&v$7(r,n.extraCommandProps);const i=[];super({vert:"#define SHADER_NAME HEATMAP_DISPLAY\nuniform mat4 projViewModelMatrix;\nattribute vec3 aPosition;\nvoid main() {\n  gl_Position = projViewModelMatrix * vec4(aPosition, 1.);\n}",frag:"#define SHADER_NAME HEATMAP_DISPLAY\nprecision mediump float;\nuniform sampler2D inputTexture;\nuniform sampler2D colorRamp;\nuniform vec2 textureOutputSize;\nuniform float heatmapOpacity;\nvoid main() {\n  vec2 c = gl_FragCoord.xy / textureOutputSize.xy;\n  float t = texture2D(inputTexture, c).r;\n  vec4 d = texture2D(colorRamp, vec2(t, .5));\n  gl_FragColor = d * heatmapOpacity;\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return multiply$5(i,n.projViewMatrix,n.modelMatrix)}}],extraCommandProps:r})}}class zt$4 extends ht$6{constructor(){super({vert:ft$6,frag:"precision highp float;\nuniform sampler2D texture;\nuniform vec2 size;\nuniform float enableSharpen;\nuniform float sharpFactor;\nuniform float pixelRatio;\nvec2 c;\nvec3 d(const in vec3 e, const float f) {\n  vec2 h = pixelRatio / size.xy;\n  float i = .0;\n  vec4 j = texture2D(texture, c + h * vec2(-1., -1.));\n  j.rgb = mix(vec3(.0), j.rgb, sign(j.a));\n  i += mix(.0, 1., sign(j.a));\n  vec4 k = texture2D(texture, c + h * vec2(1.));\n  k.rgb = mix(vec3(.0), k.rgb, sign(k.a));\n  i += mix(.0, 1., sign(k.a));\n  vec4 l = texture2D(texture, c + h * vec2(1., -1.));\n  l.rgb = mix(vec3(.0), l.rgb, sign(l.a));\n  i += mix(.0, 1., sign(l.a));\n  vec4 m = texture2D(texture, c + h * vec2(-1., 1.));\n  m.rgb = mix(vec3(.0), m.rgb, sign(m.a));\n  i += mix(.0, 1., sign(m.a));\n  return e + f * (i * e - j.rgb - l.rgb - m.rgb - k.rgb);\n}\nvoid main() {\n  c = gl_FragCoord.xy / size;\n  vec4 e = texture2D(texture, c);\n  if(enableSharpen == 1.) {\n    e.rgb = d(e.rgb, sharpFactor);\n  }\n  gl_FragColor = e;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,t)=>t.size[0],height:(e,t)=>t.size[1]}}})}getMeshCommand(e,t){return this.commands.copy||(this.commands.copy=this.createREGLCommand(e,null,t.getElements())),this.commands.copy}}const kt$4=[];class Gt$4{constructor(e,t){this._regl=e,this._viewport=t,this._init()}_init(){this._shader=new rt$6({vert:"attribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 viewModelMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nvarying vec4 vWorldPosition;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  vec4 e = modelMatrix * d * c;\n  gl_Position = projMatrix * viewModelMatrix * d * c;\n  vWorldPosition = e;\n}",frag:"precision mediump float;\nvarying vec4 vWorldPosition;\nuniform vec2 fogDist;\nuniform vec3 cameraPosition;\nvoid main() {\n  vec3 c = vec3(vWorldPosition[0] - cameraPosition[0], vWorldPosition[1] - cameraPosition[1], vWorldPosition[2] - cameraPosition[2]);\n  float d = length(c);\n  float e = clamp(1. - (d - fogDist.x) / (fogDist.y - fogDist.x), .0, 1.);\n  if(vWorldPosition[2] < .01) {\n    gl_FragColor = vec4(e, .0, .0, 1.);\n  } else {\n    gl_FragColor = vec4(e, 1., .0, 1.);\n  }\n}",uniforms:[{name:"viewModelMatrix",type:"function",fn:function(e,n){return multiply$5(kt$4,n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:this._viewport}}),this._fbo=this._regl.framebuffer({color:this._regl.texture({width:this._viewport.width(),height:this._viewport.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._scene=new pe$4,this.renderer=new k$7(this._regl)}render(e,t){return this._resize(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this._fbo}),this._scene.setMeshes(e),this.renderer.render(this._shader,{projMatrix:t.projMatrix,viewMatrix:t.viewMatrix,cameraPosition:t.cameraPosition,fogDist:t.fogDist},this._scene,this._fbo),this._fbo}dispose(){this._fbo&&this._fbo.destroy(),this._shader&&this._shader.dispose()}_resize(){const e=h$2(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,t=h$2(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===e&&this._fbo.height===t||this._fbo.resize(e,t)}}class Ut$4 extends ht$6{constructor(){super({vert:ft$6,frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#ifdef HAS_RAIN\nuniform sampler2D ripplesMap;\n#endif\n#ifdef HAS_SNOW\nuniform sampler2D normalMap;\n#endif\n#ifdef HAS_FOG\nuniform vec3 fogColor;\n#endif\nuniform sampler2D sceneMap;\nuniform sampler2D mixFactorMap;\nuniform float time;\nuniform vec2 resolution;\nfloat c(float a, float b, float w) {\n  return a + w * (b - a);\n}\n#define HASHSCALE1 .1031\n#define HASHSCALE3 vec3(.1031, .1030, .0973)\n#define HASHSCALE4 vec3(.1031, .1030, .0973, .1099)\nfloat d = .1;\nfloat e = .2;\nfloat f = .5;\nfloat h = 10.;\nfloat i(float p) {\n  vec3 j = fract(vec3(p) * HASHSCALE1);\n  j += dot(j, j.yzx + 19.19);\n  return fract((j.x + j.y) * j.z);\n}\nvec2 k(vec2 p) {\n  vec3 j = fract(vec3(p.xyx) * HASHSCALE3);\n  j += dot(j, j.yzx + 19.19);\n  return fract((j.xx + j.yz) * j.zy);\n}\nvec2 l(vec2 m) {\n  float x = fract(sin(dot(m.xy, vec2(122.9898, 783.233))) * 43758.5453);\n  float y = fract(sin(dot(m.xy, vec2(457.6537, 537.2793))) * 37573.5913);\n  return vec2(x, y);\n}\nvec3 n(vec2 o, float u) {\n  vec3 v = vec3(.0);\n  o = o * (2. + u);\n  float A = o.y * (((i(u) * 2. - 1.) * .5 + 1.) * e);\n  float B = (f * time);\n  o += vec2(A, B);\n  vec2 C = k(floor(o) + 31.1759 * u);\n  o = fract(o);\n  o -= (C * 2. - 1.) * .35;\n  o -= .5;\n  float r = length(o);\n  float D = .05 * (1. + .3 * sin(time * d));\n  float E = smoothstep(D, -D, r);\n  vec3 F = vec3(E) * C.x;\n  return F;\n}\nvec3 G() {\n  vec3 v = vec3(0);\n  vec2 o = gl_FragCoord.xy / resolution.xy;\n  o *= vec2(resolution.x / resolution.y, 1.);\n  for(float H = 0.; H < h; H++) {\n    v += n(o, H);\n  }\n  return v;\n}\nvec3 I(vec4 J, vec4 K, float L) {\n  float M = K.b;\n  vec3 N = vec3(1.);\n  if(L < 1.) {\n    float r = c(.5, N.x, M);\n    float g = c(.5, N.y, M);\n    float b = c(.5, N.z, M);\n    return vec3(r, g, b);\n  } else {\n    float r = c(J.r, N.x, M);\n    float g = c(J.g, N.y, M);\n    float b = c(J.b, N.z, M);\n    return vec3(r, g, b);\n  }\n}\nvoid main() {\n  vec4 J = texture2D(sceneMap, vTexCoord);\n  glFragColor = J;\n  vec4 O = texture2D(mixFactorMap, vTexCoord);\n#ifdef HAS_RAIN\nvec4 P = texture2D(ripplesMap, vTexCoord);\n  if(O.g < 1.) {\n    J = mix(J, P, .4);\n  }\n  glFragColor = J;\n#endif\n#ifdef HAS_SNOW\nvec3 Q = G();\n  glFragColor = vec4(J.rgb + Q, J.a);\n#endif\n#ifdef HAS_FOG\nfloat R = O.r;\n  vec3 S = mix(fogColor, glFragColor.rgb, R);\n  glFragColor = vec4(S, J.a);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,t)=>t.resolution[0],height:(e,t)=>t.resolution[1]}}})}}const jt$4=[],Vt$4=[.03,.03,.03],Xt$4=[],Kt$4=[],Wt$4=[],qt$4=fromRotationTranslation$1([],fromEuler([],90,0,0),[0,0,0]);class Jt$4{constructor(e,t){this._regl=e,this._viewport=t,this._init()}_init(){this._shader=new rt$6({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 viewModelMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nvarying vec2 vTexCoord;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_Position = projMatrix * viewModelMatrix * d * c;\n  vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\nuniform float rippleRadius;\nuniform float time;\nvec3 c(vec2 p) {\n  vec3 q = vec3(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)), dot(p, vec2(419.2, 371.9)));\n  return fract(sin(q) * 43758.5453);\n}\nfloat d(in vec2 x) {\n  vec2 p = floor(x);\n  vec2 e = fract(x);\n  float h = .0;\n  for(int i = -2; i <= 2; i++)\n    for(int k = -2; k <= 2; k++) {\n      vec2 g = vec2(float(k), float(i));\n      vec3 l = c(p + g);\n      vec2 r = g - e + l.xy;\n      float m = sqrt(dot(r, r));\n      float n = max(mix(smoothstep(.99, .999, max(cos(m - time * 2. + (l.x + l.y) * 5.), 0.)), 0., m), 0.);\n      h += n;\n    }\n  return h;\n}\nvoid main() {\n  vec2 u = vTexCoord;\n  float v = 24. / (rippleRadius * .01);\n  float e = d(v * u) * smoothstep(.0, .4, sin(u.x * 3.151592) * sin(u.y * 3.141592));\n  vec3 A = vec3(-dFdx(e), -dFdy(e), -dFdy(e));\n  glFragColor = vec4(A, 1.);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"viewModelMatrix",type:"function",fn:function(e,n){return multiply$5(jt$4,n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:this._viewport}}),this._shader.version=300,this._fbo=this._regl.framebuffer({color:this._regl.texture({width:this._viewport.width(),height:this._viewport.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._scene=new pe$4,this.renderer=new k$7(this._regl)}_transformRipples(e){const r=e.coordinateToPointAtRes(e.getCenter(),e.getGLRes());let i=e.getGLScale()/e.getGLScale(this._fixZoom);const o=set$4(Kt$4,i,i,i),s=multiply$4(o,Vt$4,o),c=identity$2(Wt$4);fromRotationTranslationScale(c,fromEuler(Xt$4,0,0,0),[r.x,r.y,0],s),multiply$5(c,c,qt$4),this._mesh.setLocalTransform(c)}_createRipplesMask(e){this._fixZoom=e.getZoom();const t=800*Math.pow(2,16.685648411389433-this._fixZoom),n={};n.POSITION=[-t,0,-t,t,0,-t,-t,0,t,t,0,t],n.NORMAL=[0,1,0,0,1,0,0,1,0,0,1,0],n.TEXCOORD_0=[0,0,1,0,0,1,1,1];const r=new Z$7(n,[3,1,0,0,2,3],0,{positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});r.generateBuffers(this._regl);const i=new ee$3;return new de$4(r,i)}render(e,t){return this._resize(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this._fbo}),this._mesh=this._mesh||this._createRipplesMask(e),this._scene.setMeshes(this._mesh),this._transformRipples(e),this.renderer.render(this._shader,{projMatrix:t.projMatrix,viewMatrix:t.viewMatrix,time:t.time,rippleRadius:t.rippleRadius},this._scene,this._fbo),this._fbo}dispose(){this._fbo&&this._fbo.destroy(),this._shader&&this._shader.dispose()}_resize(){const e=h$2(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,t=h$2(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===e&&this._fbo.height===t||this._fbo.resize(e,t)}}const Yt$4=[];class Qt$4{constructor(e,t,n){this._regl=e,this.joints=t,this.inverseBindMatrices=[],this.jointMatrices=[],this.jointData=new Float32Array(16*t.length);for(let e=0;e<t.length;++e)this.inverseBindMatrices.push(new Float32Array(n.buffer,n.byteOffset+16*Float32Array.BYTES_PER_ELEMENT*e,16)),this.jointMatrices.push(new Float32Array(this.jointData.buffer,16*Float32Array.BYTES_PER_ELEMENT*e,16));this.jointTexture=e.texture(),this.jointTextureSize=[4,6]}updateJointTexture(e){this.jointTexture||this.jointTexture.texture({width:4,height:e})}setJointTexture(e){this.jointTexture=e}update(e){invert$2(Yt$4,e);for(let e=0;e<this.joints.length;++e){const n=this.jointMatrices[e];multiply$5(n,Yt$4,this.joints[e].nodeMatrix),multiply$5(n,n,this.inverseBindMatrices[e])}this.jointTexture({width:4,type:"float",height:this.joints.length,data:this.jointData})}dispose(){this.jointTexture.destroy()}}const Zt$4=[0,0,0],$t$4=[0,0,0,1],en$3=[1,1,1],tn$3=[];class nn$3{constructor(e=[0,0,0],t=[0,0,0,1],n=[1,1,1]){this.translation=e,this.rotation=t,this.scale=n}getMatrix(){return fromRotationTranslationScale(tn$3,this.rotation,this.translation,this.scale)}decompose(e){getTranslation$1(this.translation,e),getRotation(this.rotation,e),getScaling(this.scale,e)}update(e){e&&(e.translation&&!equals$5(e.translation,Zt$4)&&copy$4(this.translation,e.translation),e.rotation&&!equals$3(e.rotation,$t$4)&&copy$2(this.rotation,e.rotation),e.scale&&!equals$5(e.scale,en$3)&&copy$4(this.scale,e.scale))}}class rn$3{constructor(e){this._init(e)}_init(e){this.geometry=e.geometry,this.nodeMatrix=e.nodeMatrix,this.materialInfo=e.materialInfo,this.extraInfo=e.extraInfo,this.animationMatrix=e.animationMatrix,this.morphWeights=e.morphWeights,this.skin=e.skin}copy(){this.copyGeometry||(this.copyGeometry=this._copyGeometry(this.geometry))}createCopyBarycentric(){this.copyGeometry&&!this.copyGeometry.data.aBarycentric&&(this.copyGeometry.buildUniqueVertex(),this.copyGeometry.createBarycentric("aBarycentric"))}_copyGeometry(e){const t=e.data,n=e.elements,r={};for(const n in t)if(p$8(t[n]))r[n]=t[n].slice();else if(t[n].buffer&&t[n].buffer.destroy)r[n]={buffer:t[n].buffer},p$8(t[n].array)&&(r[n].array=t[n].array.slice());else{const t=e._getAttributeData(n);r[n]=n!==e.desc.positionAttribute?t:t.slice()}const i=void 0!==n.length?n.slice():n,o=e.count,a=JSON.parse(JSON.stringify(e.desc)),s=new Z$7(r,i,o,a);return s.properties=e.properties,s}}let on$3=0;class an$3{constructor(e,t){this.gltf=e,this.regl=t,this.geometries=[],t&&(this._emptyTexture=t.texture({width:2,height:2}))}getMeshesInfo(){return this.gltf?(this.geometries.length||(this._createTextures(this.gltf.textures),this._createSkins(this.gltf.skins),this.gltf.scenes[0].nodes.forEach((e=>{this._parserNode(e,this.geometries)}))),this.geometries):null}_createSkins(e){if(e){this._skinMap={};for(let t=0;t<e.length;t++){const n=e[t];n.joints=n.joints.map((e=>this.gltf.nodes[e])),this._skinMap[t]=new Qt$4(this.regl,n.joints,n.inverseBindMatrices.array),delete n.inverseBindMatrices}}}_createTextures(e){if(e){this._textureMap={};for(let t=0;t<e.length;t++){const n=e[t];this._textureMap[t]||(this._textureMap[t]=this._toTexture(n),delete n.image)}}}dispose(){this._emptyTexture&&this._emptyTexture.destroy();const e=this.getMeshesInfo();if(e){e.forEach((e=>{e.geometry.dispose();for(const t in e.materialInfo){const n=e.materialInfo[t];n.destroy&&!n[D$8]&&n.destroy()}}));for(const e in this._textureMap){const t=this._textureMap[e];t.destroy&&!t[D$8]&&t.destroy()}for(const e in this._skinMap){const t=this._skinMap[e];t.jointTexture&&!t.jointTexture[D$8]&&t.jointTexture.destroy()}for(const e in this.gltf.nodes){const t=this.gltf.nodes[e];t.skin&&t.skin.jointTexture&&!t.skin.jointTexture[D$8]&&t.skin.jointTexture.destroy()}delete this.gltf}}updateAnimation(t,n,r,i){const o=this.gltf;if(!o)return;if(on$3=o.animations?k$8.getAnimationTimeSpan(o,i):null,!on$3)return;const a=n?t*r*.001%(on$3.max-on$3.min)+on$3.min:t*r*.001+on$3.min;this._startTime||(this._startTime=t),o.scenes[0].nodes.forEach((e=>{this._updateNodeMatrix(i,a,e)}));for(const e in this.gltf.nodes){const t=this.gltf.nodes[e];t.skin&&t.skin.update(t.nodeMatrix)}}isFirstLoop(t,n,r){const i=this.gltf;return!this._startTime||!i||(on$3=i.animations?k$8.getAnimationTimeSpan(i,r):null,(t-this._startTime)*n*.001/(on$3.max-on$3.min)<1)}hasSkinAnimation(){return!!this._isAnimation}_updateNodeMatrix(n,r,i,o){if(i.trs){const t=k$8.getAnimationClip(this.gltf,Number(i.nodeIndex),r,n);t.weights&&this._updateMorph(i,t.weights),i.trs.update(t)}o?multiply$5(i.nodeMatrix,o,i.matrix||i.trs.getMatrix()):copy$5(i.nodeMatrix,i.matrix||i.trs.getMatrix());const a=i.nodeMatrix;i.children&&i.children.forEach((e=>{this._updateNodeMatrix(n,r,e,a)})),this._updateSkinTexture(i)}_updateMorph(e,t){const n=t.length;if(!e.influencesList){e.influencesList=[];for(let t=0;t<n;t++)e.influencesList[t]=[t,0]}const r=e.influencesList;for(let e=0;e<r.length;e++){const n=r[e];n[0]=e,n[1]=t[e]}r.sort(cn$3);const i=[];for(let e=0;e<8;e++)i[e]=[e,0];for(let e=0;e<8;e++)e<n&&r[e][1]?(i[e][0]=r[e][0],i[e][1]=r[e][1]):(i[e][0]=Number.MAX_SAFE_INTEGER,i[e][1]=0);i.sort(sn$3),e.geometries.forEach((e=>{const t=e.properties.morphTargets;for(let n=0;n<8;n++){const r=i[n],o=r[0],a=r[1];o!==Number.MAX_SAFE_INTEGER&&a?(e.updateData("POSITION"+n,t["POSITION_"+o].array),e.properties.morphWeights[n]=a):e.properties.morphWeights[n]=0}}))}_updateSkinTexture(e){if(!this.gltf.joints)return;const t=this.gltf.animations;if(!t)return;const n=this.gltf.joints.length;t.forEach((t=>{const r=t.channels;for(let t=0;t<r.length;t++)r[t].target.node===e.nodeIndex&&e.skin.updateJointTexture(n)}))}_parserNode(e,n,r){if(e.isParsed)return;e.nodeMatrix=e.nodeMatrix||identity$2([]),e.localMatrix=e.localMatrix||identity$2([]),e.matrix?(e.trs=new nn$3,e.trs.decompose(e.matrix)):e.trs=new nn$3(e.translation,e.rotation,e.scale),e.localMatrix=e.trs.getMatrix(),r?multiply$5(e.nodeMatrix,r,e.matrix||e.localMatrix):copy$5(e.nodeMatrix,e.matrix||e.localMatrix);const i=e.nodeMatrix;if(e.children)for(let t=0;t<e.children.length;t++)this._parserNode(e.children[t],n,i);if(d$4(e.skin)){this._isAnimation=!0;const t=e.skin;e.trs=new nn$3,e.skin=this._skinMap[t]}d$4(e.mesh)&&(e.mesh=this.gltf.meshes[e.mesh],e.mesh.node=e,e.geometries=e.geometries||[],e.mesh.primitives.forEach((t=>{const r=function(e,t){const n=e.attributes,r=n.COLOR_0;if(r&&r.array instanceof Float32Array){const e=new Uint8Array(r.array.length);for(let t=0;t<e.length;t++)e[t]=Math.round(255*r.array[t]);r.array=e}const i={};for(const e in n)i[e]=v$7({},n[e]),t&&(i[e].buffer=ke$4(t,n[e],{dimension:n[e].itemSize}));if(e.morphTargets){const e=P$8(i.POSITION)?i.POSITION.itemSize*i.POSITION.count:i.POSITION.array.length;for(let t=0;t<8;t++)i["POSITION"+t]||(i["POSITION"+t]=new Float32Array(e).fill(0));for(let e=0;e<4;e++){const t=i.NORMAL.array?i.NORMAL.array.length:i.NORMAL.length;i["NORMAL"+e]||(i["NORMAL"+e]=new Float32Array(t).fill(0))}}let o=e.indices;o&&void 0===o.bufferView&&o.array&&(o=o.array);const a=new Z$7(i,o,0,{primitive:g$6(e.mode)?Oe$4(e.mode):e.mode,positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0",uv1Attribute:"TEXCOORD_1",color0Attribute:"COLOR_0"});return e.morphTargets&&(a.properties.morphWeights=[]),e.mode>3&&!a.data.NORMAL&&a.createNormal("NORMAL"),a}(t,this.regl);r.properties.morphTargets=t.morphTargets,e.geometries.push(r);const o=this._createMaterialInfo(t.material),a={geometry:r,nodeMatrix:i,materialInfo:o,extraInfo:this._createExtralInfo(t.material),animationMatrix:e.trs.getMatrix(),morphWeights:e.weights};e.skin&&(a.skin={jointTextureSize:[4,6],numJoints:e.skin.joints.length,jointTexture:e.skin.jointTexture});const s=new rn$3(a);n.push(s)}))),e.isParsed=!0}_createMaterialInfo(e){const t={};if(this.gltf.materials&&this.gltf.materials[e]){const n=this.gltf.materials[e],r=n.pbrMetallicRoughness;if(r){const e=r.metallicRoughnessTexture,n=r.baseColorTexture;n&&(t.baseColorTexture=this._getTexture(n)),r.baseColorFactor&&(t.baseColorFactor=r.baseColorFactor),e?t.metallicRoughnessTexture=this._getTexture(e):(d$4(r.metallicFactor)&&(t.metallicFactor=r.metallicFactor),d$4(r.roughnessFactor)&&(t.roughnessFactor=r.roughnessFactor))}const i=n.extensions;if(i&&i.KHR_materials_pbrSpecularGlossiness){const e=i.KHR_materials_pbrSpecularGlossiness;t.name="pbrSpecularGlossiness";for(const n in e)t[n]=d$4(e[n].index)?this._getTexture(e[n]):e[n]}n.normalTexture&&(t.normalTexture=this._getTexture(n.normalTexture)),n.occlusionTexture&&(t.occlusionTexture=this._getTexture(n.occlusionTexture)),n.emissiveTexture&&(t.emissiveTexture=this._getTexture(n.emissiveTexture)),n.emissiveFactor&&(t.emissiveFactor=n.emissiveFactor),t.alphaCutoff=n.alphaCutoff||.5}return t}_createExtralInfo(e){const t={};if(this.gltf.materials&&this.gltf.materials[e]){const n=this.gltf.materials[e];t.doubleSided=n.doubleSided,t.alphaMode=n.alphaMode||"OPAQUE"}return t}_getTexture(e){const t=e.extensions,n=e.index;if(!d$4(n))return null;t&&t.KHR_texture_transform&&(e.KHR_texture_transform=t.KHR_texture_transform);const r=this._textureMap[n];return r.texInfo=e,r}_toTexture(e){if(!e)return this._emptyTexture;const t=e.sampler||{};return new je$4({width:e.image.width,height:e.image.height,data:e.image.array,mag:De$4(t.magFilter)||"linear",min:Fe$4(t.minFilter)||"linear",wrapS:He$4(t.wrapS)||"repeat",wrapT:He$4(t.wrapT)||"repeat"})}}function sn$3(e,t){return e[0]-t[0]}function cn$3(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ln$3(t){const n=t.lastIndexOf("/"),r=t.slice(0,n),i=t.slice(t.lastIndexOf(".")).toLowerCase();return".gltf"===i?function(t,n){return w$9.getJSON(t,{})}(t).then((e=>un$3(r,e))):".glb"===i?function(t,n){return w$9.getArrayBuffer(t,{})}(t).then((e=>un$3(r,{buffer:e.data,byteOffset:0}))):null}function fn$3(e,t){return new an$3(e,t)}function un$3(t,n){return new k$8(t,n).load()}var dn$3=Object.freeze({__proto__:null,load:ln$3,exportGLTFPack:fn$3,loadGLTF:un$3});const gn$3={vertices:[-.8111000061035156,2.0102999210357666,-.8111000061035156,0,.010300000198185444,-0,-.8111000061035156,2.0102999210357666,.8111000061035156,-.8111000061035156,2.0102999210357666,.8111000061035156,0,.010300000198185444,-0,.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,.8111000061035156,0,.010300000198185444,-0,.8111000061035156,2.0102999210357666,-.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,0,.010300000198185444,-0,-.8111000061035156,2.0102999210357666,-.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,-.8111000061035156,2.0102999210357666,-.8111000061035156,0,2.9419000148773193,-0,.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,0,2.9419000148773193,-0,-.8111000061035156,2.0102999210357666,-.8111000061035156,-.8111000061035156,2.0102999210357666,.8111000061035156,0,2.9419000148773193,-0,-.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,.8111000061035156,0,2.9419000148773193,-0],normals:[-.9267006516456604,-.3758002817630768,-0,-.9267006516456604,-.3758002817630768,-0,-.9267006516456604,-.3758002817630768,-0,0,-.3758002817630768,.9267006516456604,0,-.3758002817630768,.9267006516456604,0,-.3758002817630768,.9267006516456604,.9267006516456604,-.3758002817630768,-0,.9267006516456604,-.3758002817630768,-0,.9267006516456604,-.3758002817630768,-0,0,-.3758002817630768,-.9267006516456604,0,-.3758002817630768,-.9267006516456604,0,-.3758002817630768,-.9267006516456604,0,.656676173210144,-.7541726231575012,0,.656676173210144,-.7541726231575012,0,.656676173210144,-.7541726231575012,.7541726231575012,.656676173210144,-0,.7541726231575012,.656676173210144,-0,.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,0,.656676173210144,.7541726231575012,0,.656676173210144,.7541726231575012,0,.656676173210144,.7541726231575012],indices:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]},bn$3={cube:{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1])},NORMAL:{array:new Int8Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1])}},indices:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),mode:4}]}],scenes:[{nodes:[{mesh:0}]}]},plane:{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array([-1,0,-1,1,0,-1,-1,0,1,1,0,1])},NORMAL:{array:new Int8Array([0,1,0,0,1,0,0,1,0,0,1,0])},TEXCOORD_0:{array:new Int8Array([0,0,1,0,0,1,1,1])}},indices:new Uint16Array([3,1,0,0,2,3]),mode:4}]}],scenes:[{nodes:[{mesh:0}]}]},pyramid:{meshes:[{primitives:[{attributes:{POSITION:{array:new Float32Array(gn$3.vertices)},NORMAL:{array:new Float32Array(gn$3.normals)},TEXCOORD_0:{array:new Float32Array(gn$3.uv)}},indices:new Uint16Array(gn$3.indices),mode:4}]}],scenes:[{nodes:[{mesh:0}]}]}};class pn$3{constructor(e,t){this.regl=e,this.resourceMap={},this._requestor=t}getGLTF(e){return this.resourceMap[e]}loginGLTF(e){if(this.resourceMap[e])this.resourceMap[e].refCount+=1;else{if(bn$3[e]){const t=function(e){let t=null;return bn$3[e]&&(t={meshes:bn$3[e].meshes},t.scenes=JSON.parse(JSON.stringify(bn$3[e].scenes))),t}(e);this.resourceMap[e]=this._exportGLTFResource(t,e,!1)}else this.resourceMap[e]=this._requestor?this._requestor(e).then((t=>{const n=this._exportGLTFResource(t,e);return this.resourceMap[e]=n,n})):this._loadGLTFModel(e).catch((e=>e));this.resourceMap[e].refCount=1}}logoutGLTF(e){if(this.resourceMap[e]&&(this.resourceMap[e].refCount-=1,this.resourceMap[e].refCount<1)){const t=this.resourceMap[e].resources;if(t)for(let e=0;e<t.length;e++)t[e].geometry.dispose(),t[e].copyGeometry&&t[e].copyGeometry.dispose(),t[e].material&&t[e].material.dispose();this.resourceMap[e].gltfPack&&this.resourceMap[e].gltfPack.dispose(),delete this.resourceMap[e]}}isSimpleModel(e){return bn$3[e]}_exportGLTFResource(e,t,n=!0){const r=fn$3(e,n?this.regl:null),i=r.getMeshesInfo();return{gltfPack:r,resources:i,json:{asset:e.asset,animations:e.animations?e.animations.map((e=>({name:e.name}))):null},refCount:this.resourceMap[t]?this.resourceMap[t].refCount:0}}_loadData(e){return ln$3(e).then((e=>e))}_loadGLTFModel(e){return this._loadData(e).then((t=>(this.resourceMap[e]=this._exportGLTFResource(t,e),this.resourceMap[e])))}}const xn$3=function(){const e=[0,0,0],n=[lookAt([],e,[1,0,0],[0,-1,0]),lookAt([],e,[-1,0,0],[0,-1,0]),lookAt([],e,[0,1,0],[0,0,1]),lookAt([],e,[0,-1,0],[0,0,-1]),lookAt([],e,[0,0,1],[0,-1,0]),lookAt([],e,[0,0,-1],[0,-1,0])],r=90*Math.PI/180,i=[0,0,0,0],o=new Array(16);return function(e,a,s,c,l){const f={context:{viewMatrix:function(e,t,r){return n[r]},projMatrix:perspective(o,r,1,.5,1.1)}};return a&&(f.framebuffer=a.faces?function(e,t,n){return a.faces[n]}:a),e(f)(6,((t,n,r)=>{const o={color:i,depth:1};a&&(o.framebuffer=a.faces?a.faces[r]:a),e.clear(o),s(c),l&&l()})),a}}();var yn$3={vertices:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],textures:[1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},An$3="attribute vec3 aPosition;\nvarying vec3 vWorldPos;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nvoid main() {\n  vWorldPos = aPosition;\n  gl_Position = projMatrix * viewMatrix * vec4(vWorldPos, 1.);\n}",Tn$3="precision highp float;\n#define PI 3.1415926\nvarying vec3 vWorldPos;\nuniform sampler2D equirectangularMap;\nconst vec2 c = vec2(.1591, .3183);\nvec2 d(vec3 e) {\n  vec2 f = vec2(atan(e.y, e.x), asin(e.z));\n  f *= c;\n  f += .5;\n  return f;\n}\nvec3 h(const in vec4 i, const in float j) {\n  return j * i.rgb * i.a;\n}\nvec4 k(const in vec3 i, const in float j) {\n  vec4 l;\n  vec3 m = i / j;\n  l.a = clamp(max(max(m.r, m.g), max(m.b, 1e-6)), .0, 1.);\n  l.a = ceil(l.a * 255.) / 255.;\n  l.rgb = m / l.a;\n  return l;\n}\nvoid main() {\n  vec2 f = d(normalize(vWorldPos));\n  vec4 i = texture2D(equirectangularMap, f);\n#ifdef INPUT_RGBM\ngl_FragColor = i;\n#else\ngl_FragColor = vec4(h(i, 7.), 1.);\n#endif\n}";
/*!
	 * from claygl
	 * https://github.com/pissang/claygl/
	 * License: BSD-2-Clause
	 */function Sn$3(e,t){var n=e[0],r=e[1],i=e[2];return 0===t?1:1===t?n:2===t?r:3===t?i:4===t?n*i:5===t?r*i:6===t?n*r:7===t?3*i*i-1:n*n-r*r}var Mn$3={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]},En$3=["px","nx","py","ny","pz","nz"];const On$3=We$4.compile(Ft$5);function Cn$3(e,t,n){const r=e({frag:On$3,vert:An$3,attributes:{aPosition:yn$3.vertices},uniforms:{projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),cubeMap:t,environmentExposure:1,bias:0,size:n,hsv:[0,0,0]},elements:yn$3.indices}),i=[],o=e.framebuffer(n);return xn$3(e,o,r,{size:n},(function(){const t=e.read();i.push(new t.constructor(t))})),r.destroy(),o.destroy(),i}const Pn$3=new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]),wn$3=new Int8Array([0,1,0,0,1,1,1,0]);function In$3(e,t,n,r){t=t||256;const i=Rn$3(n=n||1024,r=r||256),o=e.texture({data:i,width:r,height:n,min:"nearest",mag:"nearest"}),a=e.buffer(Pn$3),s=e.buffer(wn$3),c=e.framebuffer({radius:t,colorType:"uint8",colorFormat:"rgba",min:"linear",mag:"linear"}),l=e({frag:"precision mediump float;\nvarying vec2 vTexCoords;\nuniform sampler2D distributionMap;\nconst float c = 3.14159265359;\nvec4 d(float a, float b) {\n  a *= 65535.;\n  b *= 65535.;\n  vec4 rgba;\n  rgba[0] = mod(a, 255.);\n  rgba[1] = (a - rgba[0]) / 65280.0;\n  rgba[2] = mod(b, 255.);\n  rgba[3] = (b - rgba[2]) / 65280.0;\n  return rgba;\n}\nvec3 e(float f, vec3 h, float i) {\n  vec4 j = texture2D(distributionMap, vec2(i, f));\n  vec3 k = j.xyz;\n  float l = sign(j.w - .5);\n  float m = sign(j.w - clamp(l, .0, 1.) * 200.0 / 255. - .15);\n  k.x *= l;\n  k.y *= m;\n  vec3 n = abs(h.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 o = normalize(cross(n, h));\n  vec3 u = cross(h, o);\n  vec3 v = o * k.x + u * k.y + h * k.z;\n  return normalize(v);\n}\nfloat A(float B, float i) {\n  float a = i;\n  float C = (a * a) / 2.;\n  float D = B;\n  float E = B * (1. - C) + C;\n  return D / E;\n}\nfloat F(float B, float G, float i) {\n  float I = A(B, i);\n  float J = A(G, i);\n  return J * I;\n}\nvec2 K(float B, float i) {\n  vec3 L;\n  L.x = sqrt(1. - B * B);\n  L.y = .0;\n  L.z = B;\n  float M = .0;\n  float O = .0;\n  vec3 h = vec3(.0, .0, 1.);\n  const int P = 1024;\n  for(int Q = 0; Q < P; ++Q) {\n    vec3 k = e(float(Q) / float(P), h, i);\n    vec3 R = normalize(2. * dot(L, k) * k - L);\n    float G = max(R.z, .0);\n    float S = max(k.z, .0);\n    float T = max(dot(L, k), .0);\n    float B = max(dot(h, L), .0);\n    if(G > .0) {\n      float U = F(B, G, i);\n      float W = (U * T) / (S * B);\n      float X = pow(1. - T, 5.);\n      M += (1. - X) * W;\n      O += X * W;\n    }\n  }\n  M /= float(P);\n  O /= float(P);\n  return vec2(M, O);\n}\nvoid main() {\n  vec2 Y = K(vTexCoords.x, vTexCoords.y);\n  gl_FragColor = d(Y.x, Y.y);\n}",vert:"attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoords;\nvoid main() {\n  vTexCoords = aTexCoord;\n  gl_Position = vec4(aPosition, 1.);\n}",attributes:{aPosition:{buffer:a},aTexCoord:{buffer:s}},uniforms:{distributionMap:o},framebuffer:c,viewport:{x:0,y:0,width:t,height:t},count:Pn$3.length/3,primitive:"triangle strip"});return l(),l.destroy(),a.destroy(),s.destroy(),o.destroy(),c}function Rn$3(e,t){const n=new Array(e*t*4);for(let r=0;r<e;r++){const{x:i,y:o}=Dn$3(r,e);for(let e=0;e<t;e++){const a=e/t,s=a*a,c=2*Math.PI*i,l=Math.sqrt((1-o)/(1+(s*s-1)*o)),f=Math.sqrt(1-l*l),u=4*(r*t+e),d=f*Math.cos(c),h=f*Math.sin(c);n[u]=Math.abs(255*d),n[u+1]=Math.abs(255*h),n[u+2]=255*l,n[u+3]=(d>0?200:0)+(h>0?55:0)}}return n}function Dn$3(e,t){let n=(e<<16|e>>>16)>>>0;return n=((1431655765&n)<<1|(2863311530&n)>>>1)>>>0,n=((858993459&n)<<2|(3435973836&n)>>>2)>>>0,n=((252645135&n)<<4|(4042322160&n)>>>4)>>>0,n=(((16711935&n)<<8|(4278255360&n)>>>8)>>>0)/4294967296,{x:e/t,y:n}}var Nn$3=Object.freeze({__proto__:null,createIBLMaps:function(e,t={}){const r=t.envTexture,i=t.envCubeSize||512,o=t.sampleSize||1024,a=t.roughnessLevels||256,s=t.prefilterCubeSize||256;let c;if(Array.isArray(r)){const t=e.cube(...r);c=function(e,t,n,r){const i=e({frag:"#define ENC_RGBM 1\n"+On$3,vert:An$3,attributes:{aPosition:yn$3.vertices},uniforms:{hsv:[0,0,0],projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),cubeMap:t,bias:0,size:e.prop("size"),environmentExposure:1},elements:yn$3.indices}),o=[],a=e.framebufferCube({radius:n});xn$3(e,a,i,{size:n},(function(){const t=e.read();o.push(t)}));const s=e.cube({radius:n,min:"linear mipmap linear",mag:"linear",faces:o});return a.destroy(),i.destroy(),s}(e,t,i),t.destroy()}else c=function(e,t,n,r){n=n||512;const i=e({frag:"#define INPUT_RGBM 1\n"+Tn$3,vert:An$3,attributes:{aPosition:yn$3.vertices},uniforms:{projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),equirectangularMap:t},elements:yn$3.indices}),o=e.cube({width:n,height:n,min:"linear",mag:"linear",format:"rgba"}),a=e.framebufferCube({radius:n,color:o});return xn$3(e,a,i),i.destroy(),a}(e,r,i);const{prefilterMap:l,prefilterMipmap:f}=function(e,t,n,r,i,o){const a=function(e,t,n,r,i,o){const a=Rn$3(i=i||1024,o=o||256),s=e.texture({data:a,width:o,height:i,min:"nearest",mag:"nearest"}),c=e({frag:"#define SHADER_NAME PBR_prefilter\nprecision highp float;\nvarying vec3 vWorldPos;\nuniform samplerCube environmentMap;\nuniform sampler2D distributionMap;\nuniform float roughness;\nuniform float resolution;\nuniform float rgbmRange;\nconst float c = 3.14159265359;\nfloat d(vec3 e, vec3 f, float h) {\n  float a = h * h;\n  float i = a * a;\n  float j = max(dot(e, f), .0);\n  float k = j * j;\n  float l = i;\n  float m = (k * (i - 1.) + 1.);\n  m = c * m * m;\n  return l / m;\n}\nvec3 n(float o, vec3 e, float h) {\n  vec4 u = texture2D(distributionMap, vec2(h, o));\n  vec3 f = u.xyz;\n  float v = sign(u.w - .5);\n  float A = sign(u.w - 200.0 / 255. * clamp(v, .0, 1.) - .15);\n  f.x *= v;\n  f.y *= A;\n  vec3 B = abs(e.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 C = normalize(cross(B, e));\n  vec3 D = cross(e, C);\n  vec3 E = C * f.x + D * f.y + e * f.z;\n  return normalize(E);\n}\nvec4 F(const in vec3 G, const in float I) {\n  if(I <= .0)\n    return vec4(G, 1.);\n  vec4 J;\n  vec3 K = G / I;\n  J.a = clamp(max(max(K.r, K.g), max(K.b, 1e-6)), .0, 1.);\n  J.a = ceil(J.a * 255.) / 255.;\n  J.rgb = K / J.a;\n  return J;\n}\nvec3 L(const in vec4 G, const in float I) {\n  if(I <= .0)\n    return G.rgb;\n  return I * G.rgb * G.a;\n}\nvoid main() {\n  vec3 e = normalize(vWorldPos);\n  vec3 M = e;\n  vec3 O = M;\n  const int P = 1024;\n  vec3 Q = vec3(.0);\n  float S = .0;\n  for(int T = 0; T < P; ++T) {\n    vec3 f = n(float(T) / float(P), e, roughness);\n    vec3 U = normalize(2. * dot(O, f) * f - O);\n    float W = max(dot(e, U), .0);\n    if(W > .0) {\n      Q += L(textureCube(environmentMap, U), rgbmRange).rgb * W;\n      S += W;\n    }\n  }\n  Q = Q / S;\n  gl_FragColor = F(Q, rgbmRange);\n}",vert:An$3,attributes:{aPosition:yn$3.vertices},uniforms:{projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),environmentMap:t,distributionMap:s,roughness:e.prop("roughness"),resolution:r,rgbmRange:n||7},elements:yn$3.indices,viewport:{x:0,y:0,width:e.prop("size"),height:e.prop("size")}});let l=r;const f=e.texture({radius:r,min:"linear",mag:"linear"}),u=e.framebuffer({radius:r,color:f}),d=Math.log(l)/Math.log(2),h=[];for(let t=0;t<=d;t++){let n=0;xn$3(e,u,c,{roughness:t/(d-1),size:l},(function(){const t=e.read({framebuffer:u});h[n]||(h[n]={mipmap:[]}),h[n].mipmap.push(t),n++})),l/=2,u.resize(l)}return s.destroy(),u.destroy(),c.destroy(),h}(e,t,n,r,i,o);return{prefilterMap:e.cube({radius:r,min:"linear mipmap linear",mag:"linear",faces:a}),prefilterMipmap:a}}(e,c,t.rgbmRange,s,o,a);let u;if(!t.ignoreSH){const t=s;u=function(e,t,r){for(var i=new Array(9),o=[],a=[],s=[],c=0;c<9;c++){for(var l=[0,0,0],f=0;f<En$3.length;f++){for(var u=e[f],d=[0,0,0],h=0,m=0,v=Mn$3[En$3[f]],_=0;_<r;_++)for(var g=0;g<t;g++){o[0]=g/(t-1)*2-1,o[1]=_/(r-1)*2-1,o[2]=-1,normalize$4(o,o),s[0]=o[v[0]]*v[3],s[1]=o[v[1]]*v[4],s[2]=o[v[2]]*v[5],a[0]=u[m++]/255,a[1]=u[m++]/255,a[2]=u[m++]/255;var b=u[m++]/255*7;a[0]*=b,a[1]*=b,a[2]*=b,scaleAndAdd$2(d,d,a,Sn$3(s,c)*-o[2]),h+=-o[2]}scaleAndAdd$2(l,l,d,1/h)}i[c]=scale$4(l,l,1/6)}return i}(Cn$3(e,l,t),t,t);const r=[];for(let e=0;e<u.length;e++)r.push(...u[e]);u=r}const d={rgbmRange:t.rgbmRange,envMap:c,prefilterMap:l};return u&&(d.sh=u),"array"===t.format&&(d.envMap={width:c.width,height:c.height,faces:Cn$3(e,c,i)},d.prefilterMap={width:l.width,height:l.height,faces:f},c.destroy(),l.destroy()),d},generateDFGLUT:In$3});const Fn$3={uvScale:[1,1],uvOffset:[0,0],uvRotation:0,baseColorFactor:[1,1,1,1],emissiveFactor:[0,0,0],baseColorIntensity:1,anisotropyDirection:0,anisotropyFactor:0,clearCoatFactor:0,clearCoatIor:1.4,clearCoatRoughnessFactor:.04,clearCoatThickness:5,emitColorFactor:1,occlusionFactor:1,roughnessFactor:.4,metallicFactor:0,normalMapFactor:1,specularF0:.5,emitMultiplicative:1,normalMapFlipY:0,outputSRGB:1,baseColorTexture:null,normalTexture:null,occlusionTexture:null,metallicRoughnessTexture:null,emissiveTexture:null,uvOrigin:[0,0],noiseTexture:null,clearCoatTint:[.006,.006,.006],specularAAVariance:20,specularAAThreshold:20,hsv:[0,0,0],contrast:1,bumpTexture:null,bumpScale:.05,bumpMinLayers:5,bumpMaxLayers:20};class Ln$3 extends ee$3{constructor(e){const t=v$7({},Fn$3);(e.metallicRoughnessTexture||e.metallicRoughnessTexture)&&(t.roughnessFactor=1,t.metallicFactor=1),super(e,t)}appendDefines(e,t){super.appendDefines(e,t);const n=this.uniforms;n.GAMMA_CORRECT_INPUT&&(e.GAMMA_CORRECT_INPUT=1);const r=t.data[t.desc.color0Attribute];if(r){e.HAS_COLOR0=1;let n=3;r.length?n=r.length/t.getVertexCount():r.buffer&&(n=r.buffer._buffer.dimension),e.COLOR0_SIZE=n}return t.data[t.desc.tangentAttribute]?e.HAS_TANGENT=1:t.data[t.desc.normalAttribute]&&(e.HAS_NORMAL=1),t.data[t.desc.uv0Attribute]?(n.baseColorTexture&&(e.HAS_ALBEDO_MAP=1),n.metallicRoughnessTexture&&(e.HAS_METALLICROUGHNESS_MAP=1),n.occlusionTexture&&(e.HAS_AO_MAP=1),n.emissiveTexture&&(e.HAS_EMISSIVE_MAP=1),n.normalTexture&&(e.HAS_NORMAL_MAP=1),n.bumpTexture&&(e.HAS_BUMP_MAP=1),(e.HAS_ALBEDO_MAP||e.HAS_METALLICROUGHNESS_MAP||e.HAS_AO_MAP||e.HAS_EMISSIVE_MAP||e.HAS_NORMAL_MAP||e.HAS_BUMP_MAP)&&(e.HAS_MAP=1),n.noiseTexture&&(e.HAS_RANDOM_TEX=1),t.data[t.desc.tangentAttribute]?e.HAS_TANGENT=1:t.data[t.desc.normalAttribute]&&(e.HAS_NORMAL=1),e):e}}class Hn$3 extends(ce$4(Ln$3)){}function Bn$3(e,t,n){if(n.ambientUpdate){const{iblTexes:r}=e;if(r){const i=n.target;Gn$3(r),e.iblTexes=kn$3(t,i)}else e.iblTexes=kn$3(t,n.target)}}const zn$3=[0,0];function kn$3(e,t){const n=t.getLightManager().getAmbientResource();return n?{prefilterMap:e.cube({width:n.prefilterMap.width,height:n.prefilterMap.height,faces:n.prefilterMap.faces,min:"linear mipmap linear",mag:"linear",format:"rgba"}),sh:n.sh,rgbmRange:n.rgbmRange}:null}function Gn$3(e){for(const t in e)e[t].destroy&&e[t].destroy(),delete e[t]}var Un$3=Object.freeze({__proto__:null,loginIBLResOnCanvas:function(e,t,n){if(!e.dfgLUT&&(e.dfgLUT=In$3(t),e.dfgLUT.mtkRefCount=0,n)){const r=Bn$3.bind(this,e,t);n.on("updatelights",r),e._iblResListener=r}e.dfgLUT.mtkRefCount++;const r=n.getLightManager();return r&&r.getAmbientResource()?(e.iblTexes||(e.iblTexes=kn$3(t,n)),{dfgLUT:e.dfgLUT,iblTexes:e.iblTexes}):{dfgLUT:e.dfgLUT,iblTexes:null}},getIBLResOnCanvas:function(e){const{dfgLUT:t,iblTexes:n}=e;return{dfgLUT:t,iblTexes:n}},logoutIBLResOnCanvas:function(e,t){let n=!1;e.dfgLUT&&(e.dfgLUT.mtkRefCount--,e.dfgLUT.mtkRefCount<=0)&&(n=!0,t&&t.off("updatelights",e._iblResListener),e.dfgLUT.destroy(),delete e.dfgLUT),e.iblTexes&&n&&(Gn$3(e.iblTexes),delete e.iblTexes)},getPBRUniforms:function(e,t,n,r,i){const o=e.viewMatrix,a=e.projMatrix,s=e.cameraPosition,c=e.getRenderer().canvas,l=function(e,t){const n=e.getLightManager(),r=n&&n.getAmbientResource(),i=n&&n.getAmbientLight()||{},o=n&&n.getDirectionalLight()||{};let a;if(r){const e=t.prefilterMap.width,n=Math.log(e)/Math.log(2);a={prefilterMap:t.prefilterMap,diffuseSPH:t.sh,prefilterMiplevel:[n,n],prefilterSize:[e,e],hdrHSV:i.hsv||[0,0,0]}}else a={ambientColor:i.color||[.2,.2,.2]};return a.rgbmRange=r?t.rgbmRange:7,a.environmentExposure=g$6(i.exposure)?i.exposure:1,a.environmentOrientation=i.orientation||0,a.light0_diffuse=[...o.color||[1,1,1],1],a.light0_viewDirection=o.direction||[1,1,-1],a}(e,t),f=v$7({viewMatrix:o,projMatrix:a,projViewMatrix:e.projViewMatrix,cameraPosition:s,outSize:[c.width,c.height],cameraNearFar:[e.cameraNear,e.cameraFar]},l);return f.brdfLUT=n,r&&r.renderUniforms&&v$7(f,r.renderUniforms),f.halton=i||zn$3,f},createIBLTextures:kn$3,disposeIBLTextures:Gn$3,isSupported:function(e){return e.hasExtension("EXT_shader_texture_lod")}});class jn$3 extends rt$6{constructor(e){super({vert:"attribute vec3 aPosition;\nuniform mat4 lightProjViewModelMatrix;\nuniform mat4 positionMatrix;\n#include <line_extrusion_vert>\n#include <get_output>\nvarying vec4 vPosition;\nvoid main() {\n  mat4 c = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec3 d = getLineExtrudePosition(aPosition);\n  vec4 e = getPosition(d);\n#else\nvec4 e = getPosition(aPosition);\n#endif\ngl_Position = lightProjViewModelMatrix * c * e;\n  vPosition = gl_Position;\n}",frag:"#define SHADER_NAME vsm_mapping\n#ifdef USE_VSM\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\nvarying vec4 vPosition;\n#ifdef PACK_FLOAT\n#include <common_pack_float>\n#endif\nvoid main() {\n  \n#if defined(USE_VSM)\nfloat c = vPosition.z / vPosition.w;\n  c = c * .5 + .5;\n  float d = c;\n  float e = c * c;\n  float f = dFdx(c);\n  float h = dFdy(c);\n  e += .25 * (f * f + h * h);\n  gl_FragColor = vec4(d, e, c, .0);\n#endif\n#if defined(USE_ESM)\n#ifdef PACK_FLOAT\ngl_FragColor = common_encodeDepth(gl_FragCoord.z);\n#else\ngl_FragColor = vec4(gl_FragCoord.z, .0, .0, 1.);\n#endif\n#endif\n}",uniforms:[{name:"lightProjViewModelMatrix",type:"function",fn:function(e,n){return multiply$5([],n.lightProjViewMatrix,n.modelMatrix)}}],extraCommandProps:{},defines:e})}filter(e){return e.castShadow}}class Vn$3 extends ht$6{constructor({blurOffset:e}){super({vert:ft$6,frag:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D textureSource;\nuniform vec2 resolution;\n#include <common_pack_float>\nvoid main() {\n  float c = .0;\n  float d = .0;\n  for(int x = -BOXBLUR_OFFSET; x <= BOXBLUR_OFFSET; ++x)\n    for(int y = -BOXBLUR_OFFSET; y <= BOXBLUR_OFFSET; ++y) {\n      vec2 e = vTexCoord.st + vec2(float(x) / resolution.x, float(y) / resolution.y);\n      e = clamp(e, .0, 1.);\n      float f = common_decodeDepth(texture2D(textureSource, e));\n      float s = max(.0, sign(1. - f));\n      d += sign(f) * s;\n      c += f;\n    }\n  float h = c / max(1., d);\n  gl_FragColor = common_encodeDepth(h);\n}",defines:{BOXBLUR_OFFSET:e||2}}),this._blurOffset=e||2}getMeshCommand(e,t){const n="box_shadow_blur_"+this._blurOffset;return this.commands[n]||(this.commands[n]=this.createREGLCommand(e,null,t.getElements())),this.commands[n]}}let Xn$3,Kn$3;class Wn$3{constructor(e,{width:t,height:n,blurOffset:r,defines:i}){this.renderer=e,this.width=t||512,this.height=n||512,this.blurOffset=u$3(r)?2:r,this._init(i)}render(e,{cameraProjViewMatrix:t,lightDir:n,farPlane:r,cameraLookAt:i}){return{lightProjViewMatrix:this._renderShadow(e,t,n,r,i),shadowMap:this.blurTex||this.depthTex,depthFBO:this.depthFBO,blurFBO:this.blurFBO}}resize(e,t){return this.depthTex&&(this.depthTex.resize(e,t),this.depthFBO.resize(e,t)),this.blurFBO&&(this.blurTex.resize(e,t),this.blurFBO.resize(e,t)),this}_renderShadow(e,t,n,r,i){const o=this.renderer,a=Xn$3(t);if(r)for(let e=4;e<8;e++)a[e]=r[e-4];const s=Kn$3(i,a,n);return o.clear({color:[1,0,0,1],depth:1,framebuffer:this.depthFBO}),o.render(this.shadowMapShader,{lightProjViewMatrix:s},e,this.depthFBO),this.blurFBO&&(this.boxBlurShader||(this.boxBlurShader=new Vn$3({blurOffset:this.blurOffset})),o.clear({color:[1,0,0,1],depth:1,framebuffer:this.blurFBO}),o.render(this.boxBlurShader,{resolution:[this.depthTex.width,this.depthTex.height],textureSource:this.depthTex},null,this.blurFBO)),s}_init(e){const t=this.renderer.regl,n=this.width,r=this.height;this.depthTex=t.texture({width:n,height:r,format:"rgb",type:"uint8",min:"nearest",mag:"nearest"}),this.shadowMapShader=new jn$3(e),this.shadowMapShader.filter=e=>e.castShadow,this.depthFBO=t.framebuffer({color:this.depthTex}),this.blurOffset<=0||(this.blurTex=t.texture({width:n,height:r,format:"rgb",type:"uint8",min:"linear",mag:"linear"}),this.blurFBO=t.framebuffer({color:this.blurTex}))}dispose(){this.depthTex&&(this.depthTex.destroy(),this.depthFBO.destroy(),delete this.depthTex,delete this.depthFBO),this.blurTex&&(this.blurTex.destroy(),this.blurFBO.destroy(),delete this.blurTex,delete this.blurFBO),this.shadowMapShader&&(this.shadowMapShader.dispose(),delete this.shadowMapShader),this.boxBlurShader&&(this.boxBlurShader.dispose(),delete this.boxBlurShader)}}Xn$3=function(){const e=[[-1,-1,-1,1],[1,-1,-1,1],[1,1,-1,1],[-1,1,-1,1],[-1,-1,1,1],[1,-1,1,1],[1,1,1,1],[-1,1,1,1]],n=new Array(16);return function(i){invert$2(n,i);const o=[];for(let t=0;t<e.length;t++){const i=transformMat4$1([],e[t],n);scale$3(i,i,1/i[3]),o.push(i)}return o}}(),Kn$3=function(){let e=new Array(4);const i=new Array(3),o=[0,0,0,0],a=[0,1,0],s=new Array(3);let c=new Array(16),l=new Array(16),f=new Array(16);const u=[1,1,1],d=[0,0,0];return function(h,m,v){set$3(o,...h,1),scale$4(i,v,-1),c=lookAt(c,add$4(s,o,normalize$4(s,i)),o,a),transformMat4$1(e,m[0],c);let _=e[2],g=e[2],b=e[0],p=e[0],x=e[1],y=e[1];for(let t=1;t<8;t++)e=transformMat4$1(e,m[t],c),e[2]>g&&(g=e[2]),e[2]<_&&(_=e[2]),e[0]>p&&(p=e[0]),e[0]<b&&(b=e[0]),e[1]>y&&(y=e[1]),e[1]<x&&(x=e[1]);l=ortho(l,-1,1,-1,1,-g,-_);const A=u[0]=2/(p-b),T=u[1]=-2/(y-x);d[0]=-.5*(b+p)*A,d[1]=-.5*(x+y)*T,identity$2(f),translate$1(f,f,d),scale$5(f,f,u);const S=multiply$5(l,f,l);return multiply$5(new Array(16),S,c)}}();class qn$3 extends rt$6{constructor(e){super({vert:"#define SHADER_NAME SHADOW_DISPLAY\nattribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec2 halton;\nuniform vec2 globalTexSize;\nvarying vec4 vPosition;\n#include <vsm_shadow_vert>\nvoid main() {\n  vec4 c = vec4(aPosition, 1.);\n  vec4 d = modelViewMatrix * c;\n  mat4 e = projMatrix;\n  e[2].xy += halton.xy / globalTexSize.xy;\n  gl_Position = e * d;\n  vPosition = gl_Position;\n  shadow_computeShadowPars(c);\n}",frag:"#define SHADER_NAME SHADOW_DISPLAY\nprecision mediump float;\nuniform vec3 color;\n#include <vsm_shadow_frag>\nvoid main() {\n  float c = shadow_computeShadow();\n  float d = 1. - c;\n  gl_FragColor = vec4(color * d, d);\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(e,n){const r=[];return multiply$5(r,n.viewMatrix,n.modelMatrix),r}}],defines:e||{USE_ESM:1},extraCommandProps:{depth:{enable:!0,mask:!1},viewport:{x:0,y:0,width:(e,t)=>t.globalTexSize[0],height:(e,t)=>t.globalTexSize[1]}}})}getMeshCommand(e,t){return this.commands.shadow_display||(this.commands.shadow_display=this.createREGLCommand(e,null,t.getElements())),this.commands.shadow_display}}function Jn$3(e){return 256*e[2]*256+256*e[1]+e[0]}const Yn$3=new Uint8Array(4),Qn$3=new Float32Array(Yn$3.buffer),Zn$3="\n    vec3 unpack(highp float f) {\n        highp vec3 color;\n        color.b = floor(f / 65536.0);\n        color.g = floor((f - color.b * 65536.0) / 256.0);\n        color.r = f - floor(color.b * 65536.0) - floor(color.g * 256.0);\n        // now we have a vec3 with the 3 components in range [0..255]. Let's normalize it!\n        return color / 255.0;\n    }\n",$n$3=`\n    precision highp float;\n\n    varying float vPickingId;\n    varying float vFbo_picking_visible;\n\n    uniform float fbo_picking_meshId;\n\n    ${Zn$3}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(vPickingId), fbo_picking_meshId / 255.0);\n    }\n`,er$4=`\n    precision highp float;\n\n    uniform int fbo_picking_meshId;\n    varying float vFbo_picking_visible;\n\n    ${Zn$3}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(float(fbo_picking_meshId)), 1.0);\n        // gl_FragColor = vec4(unpack(float(35)), 1.0);\n    }\n`,tr$4=`\n    precision highp float;\n\n    varying float vPickingId;\n    varying float vFbo_picking_visible;\n\n    ${Zn$3}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(vPickingId), 1.0);\n    }\n`;class nr$4{constructor(e,{vert:t,uniforms:n,defines:r,extraCommandProps:i},o){this._renderer=e,this._fbo=o,this._clearFbo(o),this._vert=t,this._uniforms=n,this._defines=r,this._extraCommandProps=v$7({},i),delete this._extraCommandProps.blend,delete this._extraCommandProps.stencil,this._currentMeshes=[],this._init()}_init(){const e=[];this._uniforms&&e.push(...this._uniforms);const t={ENABLE_PICKING:1,HAS_PICKING_ID:1};if(this._defines)for(const e in this._defines)t[e]=this._defines[e];const n=this._vert,r=this._extraCommandProps;this._shader0=new rt$6({vert:n,frag:$n$3,uniforms:e,defines:t,extraCommandProps:r}),this._shader2=new rt$6({vert:n,frag:tr$4,uniforms:e,defines:t,extraCommandProps:r});const i={ENABLE_PICKING:1,HAS_PICKING_ID:1};if(this._defines)for(const e in this._defines)i[e]=this._defines[e];this._shader1=new rt$6({vert:n,frag:er$4,uniforms:e,defines:i,extraCommandProps:r}),this._depthShader=new rt$6({vert:n,frag:"\n    #define SHADER_NAME depth\n\n    precision highp float;\n    varying float vFbo_picking_viewZ;\n\n    #include <common_pack_float>\n\n    void main() {\n        gl_FragColor = common_unpackFloat(vFbo_picking_viewZ);\n        // gl_FragColor = unpack(34678.3456789);\n    }\n",uniforms:e,defines:i,extraCommandProps:r}),this._scene=new pe$4,this._scene1=new pe$4}filter(){return!0}render(e,t,n=!1){if(!e||!e.length)return this;const r=this._fbo;n&&this.clear(),e=e.filter((e=>e&&e.isValid())),this._scene.setMeshes(e);const i=this._getShader(e,n);i.filter=this.filter,this._currentShader&&i!==this._currentShader&&this.clear(),this._currentShader=i,e.forEach(((e,t)=>{e.setUniform("fbo_picking_meshId",t+this._currentMeshes.length)}));for(let t=0;t<e.length;t++)this._currentMeshes.push(e[t]);return this._renderer.render(i,t,this._scene,r),this}pick(e,t,n,r,i={}){const o=this._currentShader,a=this._currentMeshes;if(!o||!a||!a.length)return{pickingId:null,meshId:null,point:null};e=Math.round(e),t=Math.round(t);const s=this._fbo;if(e<=2||e>=s.width-2||t<=2||t>=s.height-2)return{pickingId:null,meshId:null,point:null};const{px:c,py:l,width:f,height:u}=this._getParams(e,t,n,s),d=new Uint8Array(4*f*u),h=this._renderer.regl.read({data:d,x:c,y:l,framebuffer:s,width:f,height:u}),m=[];let v=[];for(let e=0;e<h.length;e+=4){const{pickingId:t,meshId:n}=this._packData(h.subarray(e,e+4),o);m.push(n),v.push(t)}const _={},g=m.filter((e=>null!=e&&!_[e]&&(_[e]=1,!0))).map((e=>a[e]));let b;for(let e=0;e<g.length;e++)if(g[e]&&g[e].geometry){b=g[e];break}if(!b)return{pickingId:null,meshId:null,point:null};const p=b.geometry.desc.pickingIdAttribute;m.length&&o===this._shader1&&(void 0!==b.getUniform("uPickingId")||b.geometry.data[p])&&(v=this._getPickingId(c,l,f,u,d,g,r));const x=[];if(m.length&&i.returnPoint){const{viewMatrix:n,projMatrix:o}=i,a=this._pickDepth(c,l,f,u,d,g,r);for(let r=0;r<a.length;r++)if(a[r]&&null!=m[r]&&null!=v[r]){const i=this._getWorldPos(e,t,a[r],n,o);x.push(i)}else x.push(null)}const y=[];for(let e=0;e<=n;e++)y.push(e),e>0&&y.push(-e);for(let e=0;e<y.length;e++)for(let t=0;t<y.length;t++){const r=(y[t]+n)*f+(y[e]+n);if(null!=m[r]&&null!=v[r])return{meshId:m[r],pickingId:v[r],point:x[r]||null}}return{pickingId:null,meshId:null,point:null}}clear(){return this._fbo&&this._clearFbo(this._fbo),this._currentMeshes=[],delete this._currentShader,this}getMeshAt(e){return this._currentMeshes?this._currentMeshes[e]:null}getRenderedMeshes(){return this._currentMeshes}dispose(){this.clear(),this._shader0&&this._shader0.dispose(),this._shader1&&this._shader1.dispose(),this._shader2&&this._shader2.dispose(),this._scene&&this._scene.clear(),this._scene1&&this._scene1.clear()}_getWorldPos(e,n,r,i,o){const a=this._fbo,s=[],c=a.width/2||1,l=a.height/2||1,f=[(e-c)/c,(l-n)/l,0,1],u=[(e-c)/c,(l-n)/l,1,1],d=invert$2(s,o),h=[],m=[];rr$4(h,f,d),rr$4(m,u,d);const v=-h[2],_=(r-v)/(-m[2]-v),p=invert$2(s,multiply$5(s,o,i)),x=rr$4(f,f,p),y=rr$4(u,u,p);return[b$8(x[0],y[0],_),b$8(x[1],y[1],_),b$8(x[2],y[2],_)]}_getPickingId(e,t,n,r,i,o,a){const s=this._renderer.regl,c=this._getFBO1();this._clearFbo(c),this._scene1.setMeshes(o),this._renderer.render(this._shader2,a,this._scene1,c);const l=s.read({data:i,x:e,y:t,framebuffer:c,width:n,height:r}),f=[];for(let e=0;e<l.length;e+=4)f.push(Jn$3(l.subarray(e,e+4)));return f}_pickDepth(e,t,n,r,i,o,a){const s=this._renderer.regl,c=this._getFBO1();this._scene1.setMeshes(o),this._clearFbo(c),this._renderer.render(this._depthShader,a,this._scene1,c);const l=s.read({data:i,x:e,y:t,framebuffer:c,width:n,height:r}),f=[];for(let e=0;e<l.length;e+=4)f.push((u=l.subarray(e,e+4),Yn$3[0]=u[3],Yn$3[1]=u[2],Yn$3[2]=u[1],Yn$3[3]=u[0],Qn$3[0]));var u;return f}_packData(e,t){if(255===e[0]&&255===e[1]&&255===e[2]&&255===e[3])return{meshId:null,pickingId:null};let n=null,r=null;return t===this._shader1?r=Jn$3(e):t===this._shader0?(r=e[3],n=Jn$3(e)):(r=null,n=Jn$3(e)),{meshId:r,pickingId:n}}_clearFbo(e){this._renderer.regl.clear({color:[1,1,1,1],depth:1,stencil:0,framebuffer:e})}_getShader(e,t){return t&&e.length<256?this._shader0:this._shader1}_getFBO1(){const e=this._renderer.regl,t=this._fbo;return this._fbo1?this._fbo1.width===t.width&&this._fbo1.height===t.height||this._fbo1.resize(t.width,t.height):this._fbo1=e.framebuffer(t.width,t.height),this._fbo1}_getParams(e,t,n,r){t=r.height-t;let i=2*n+1,o=2*n+1;const a=(e-=n)+i,s=(t-=n)+o;return a>r.width&&(i-=a-r.width),s>r.height&&(o-=s-r.height),{px:e=e<0?0:e,py:t=t<0?0:t,width:i,height:o}}getPickingVert(){return this._vert}getUniformDeclares(){return this._uniforms}}function rr$4(e,t,n){const r=t[0],i=t[1],o=t[2],a=1/(n[3]*r+n[7]*i+n[11]*o+n[15]);return e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])*a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])*a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])*a,e}const ir$4=e=>e&&e.geometry&&void 0===e.geometry.properties.shaderHash,or$4=[],ar$4=[],sr$4=[{name:"modelViewMatrix",type:"function",fn:(e,n)=>multiply$5(or$4,n.viewMatrix,n.modelMatrix)},{name:"modelViewProjMatrix",type:"function",fn:(e,n)=>{const r=multiply$5(or$4,n.viewMatrix,n.modelMatrix);return multiply$5(or$4,n.projMatrix,r)}},{name:"modelMatrixInverse",type:"function",fn:(e,n)=>invert$2(or$4,n.modelMatrix)},{name:"projMatrixInverse",type:"function",fn:(e,n)=>invert$2(or$4,n.projMatrix)},{name:"modelViewMatrixInverse",type:"function",fn:(e,n)=>(multiply$5(or$4,n.viewMatrix,n.modelMatrix),invert$2(or$4,or$4))},{name:"modelViewProjMatrixInverse",type:"function",fn:(e,n)=>{const r=multiply$5(or$4,n.viewMatrix,n.modelMatrix);return multiply$5(or$4,n.projMatrix,r),invert$2(or$4,or$4)}},{name:"modelInverseTransposeMatrix",type:"function",fn:(e,t)=>{const n=fromMat4$1(ar$4,t.modelMatrix),r=transpose$1(n,n);return invert$3(r,r)}},{name:"modelViewInverseTransposeMatrix",type:"function",fn:(e,n)=>{const r=multiply$5(or$4,n.viewMatrix,n.modelMatrix),o=fromMat4$1(ar$4,r),a=transpose$1(o,o);return invert$3(a,a)}}],cr$4={LOCAL:"positionMatrix",MODEL:"modelMatrix",VIEW:"viewMatrix",PROJECTION:"projMatrix",MODELVIEW:"modelViewMatrix",MODELVIEWPROJECTION:"modelViewProjMatrix",MODELINVERSE:"modelMatrixInverse",VIEWINVERSE:"viewMatrixInverse",PROJECTIONINVERSE:"projMatrixInverse",MODELVIEWINVERSE:"modelViewMatrixInverse",MODELVIEWPROJECTIONINVERSE:"modelViewProjMatrixInverse",MODELINVERSETRANSPOSE:"modelInverseTransposeMatrix",MODELVIEWINVERSETRANSPOSE:"modelViewInverseTransposeMatrix",VIEWPORT:"viewport",JOINTMATRIX:"jointMatrix",ALPHACUTOFF:"alphaCutoff"};class lr$4{constructor(e,t,n){this._regl=e,this._khrShaders={},this._commandProps=t,this._resLoader=n}getExcludeFilter(){return ir$4}forEachShader(e){for(const t in this._khrShaders){const n=this._khrShaders[t];e(n.shader,n.filter,n.uniformSemantics)}}createMesh(e,t,n,r){const i=t.extensions.KHR_techniques_webgl,o=t.materials[e.material].extensions.KHR_techniques_webgl,{technique:a,values:s}=o,c=i.techniques[a],l=i.programs[c.program],f=i.shaders[l.vertexShader],u=i.shaders[l.fragmentShader];u.content=function(e){return e&&e.indexOf("precision")<0?"precision mediump float;\n"+e:e}(u.content);const d=w$8(f.content)+"-"+w$8(u.content);this._khrShaders[d]||(this._khrShaders[d]=this._createTechniqueShader(d,i,a,this._commandProps,r));const{attributeSemantics:h}=this._khrShaders[d],m=this._createGeometry(e,h,n,d),_=v$7({},s);for(const e in s)c.uniforms[e]&&35678===c.uniforms[e].type&&(_[e]=this._getTexture(t.textures[s[e].index]));return{geometry:m,material:new ee$3(_)}}_createGeometry(e,t,n,r){const i=e.attributes;if(i.COLOR_0){const e=i.COLOR_0.array||i.COLOR_0;if(e instanceof Float32Array){const t=new Uint8Array(e.length);for(let n=0;n<t.length;n++)t[n]=Math.round(255*e[n]);i.COLOR_0.array?(i.COLOR_0.array=t,i.COLOR_0.componentType=5121):i.COLOR_0=t}}const o={};for(const e in i){const n=ke$4(this._regl,i[e],{dimension:i[e].itemSize}),r=t[e]||e;o[r]={buffer:n},i[e].quantization&&(o[r].quantization=i[e].quantization),r===t.POSITION&&(o[r].array=i[e].array)}const a=new Z$7(o,e.indices.array?e.indices.array:e.indices,0,{positionAttribute:t.POSITION,normalAttribute:t.NORMAL,uv0Attribute:t.TEXCOORD_0,uv1Attribute:t.TEXCOORD_1,color0Attribute:t.COLOR_0,tangentAttribute:t.TANGENT,primitive:void 0===e.mode?"triangles":Oe$4(e.mode)});a.generateBuffers(this._regl,{excludeElementsInVAO:n}),a.properties.shaderHash=r;const s=a.data[a.desc.positionAttribute];return s&&s.array&&delete s.array,a}_getTexture(e){const t={type:e.type?Pe$4(e.type):"uint8",format:e.format?Ie$4(e.format):"rgba",flipY:!!e.flipY},n=e.image;n.array?t.data=n.array:n.mipmap&&(t.mipmap=n.mipmap),t.width=n.width,t.height=n.height;const r=e.sampler||e.texture.sampler;return r&&(r.magFilter&&(t.mag=De$4(r.magFilter)),r.minFilter&&(t.min=Fe$4(r.minFilter)),r.wrapS&&(t.wrapS=He$4(r.wrapS)),r.wrapT&&(t.wrapT=He$4(r.wrapT))),new je$4(t,this._resLoader)}_createTechniqueShader(e,t,n,r,i){const{techniques:o,programs:a,shaders:s}=t,c=o[n],l=a[c.program],f=s[l.vertexShader].content,u=s[l.fragmentShader].content,d={};for(const e in c.uniforms){const t=c.uniforms[e];t.semantic&&(d[t.semantic]=e)}const h=sr$4.slice();for(const e in d)h.push({name:d[e],type:"function",fn:(t,n)=>n[cr$4[e]]});const m=new rt$6({vert:f,frag:u,uniforms:h,extraCommandProps:r});i&&(m.version=300);const v={};for(const e in c.attributes)v[c.attributes[e].semantic]=e;return{shader:m,filter:t=>t&&t.geometry&&t.geometry.properties.shaderHash===e,uniformSemantics:d,attributeSemantics:v}}dispose(){for(const e in this._khrShaders){const{shader:t}=this._khrShaders[e];t.dispose()}this._khrShaders={}}}const fr$4={parseHDR:Me$4},ur$4={PBRHelper:Nn$3,StandardMaterial:Ln$3,StandardSpecularGlossinessMaterial:Hn$3,StandardShader:class extends rt$6{constructor(e={}){let n=e.extraCommandProps||{};const r=e.uniforms;n=v$7({},n);const o=e.defines||{},a=[],s=[],c=[],l=[],f=[],u=[{name:"modelNormalMatrix",type:"function",fn:(e,t)=>fromMat4$1(a,t.modelMatrix)},{name:"modelViewNormalMatrix",type:"function",fn:(e,n)=>{const r=multiply$5(s,n.viewMatrix,n.modelMatrix),o=invert$2(r,r),a=transpose(o,o);return fromMat4$1(c,a)}},{name:"modelViewMatrix",type:"function",fn:(e,n)=>multiply$5(l,n.viewMatrix,n.modelMatrix)},{name:"uEnvironmentTransform",type:"function",fn:(e,t)=>fromRotation$2(f,Math.PI*(t.environmentOrientation||0)/180)}];r&&u.push(...r),super({vert:e.vert||"#include <gl2_vert>\n#define SHADER_NAME PBR\nprecision highp float;\nattribute vec3 aPosition;\n#if defined(HAS_MAP)\nattribute vec2 aTexCoord;\nuniform vec2 uvOrigin;\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nuniform float uvRotation;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#endif\nvec3 c;\nvec3 d;\nvec4 e;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projMatrix;\nuniform vec2 outSize;\nuniform vec2 halton;\nuniform mediump vec3 cameraPosition;\nuniform mat3 modelNormalMatrix;\n#ifdef HAS_SSR\nuniform mat3 modelViewNormalMatrix;\nvarying vec3 vViewNormal;\n#ifdef HAS_TANGENT\nvarying vec4 vViewTangent;\n#endif\n#endif\nvarying vec3 vModelNormal;\nvarying vec4 vViewVertex;\n#if defined(HAS_TANGENT)\nvarying vec4 vModelTangent;\nvarying vec3 vModelBiTangent;\n#endif\nvarying vec3 vModelVertex;\n#if defined(HAS_MAP)\nvarying vec2 vTexCoord;\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#include <highlight_vert>\n#if defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\nvarying vec3 vColor0;\n#else\nattribute vec4 aColor0;\nvarying vec4 vColor0;\n#endif\n#endif\n#include <line_extrusion_vert>\n#include <get_output>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <heatmap_render_vert>\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nvarying vec3 vTangentViewPos;\nvarying vec3 vTangentFragPos;\n#if __VERSION__ == 100\nmat3 f(in mat3 h) {\n  vec3 i = h[0];\n  vec3 j = h[1];\n  vec3 k = h[2];\n  return mat3(vec3(i.x, j.x, k.x), vec3(i.y, j.y, k.y), vec3(i.z, j.z, k.z));\n}\n#else\nmat3 f(in mat3 h) {\n  return transpose(h);\n}\n#endif\n#endif\nvoid l(const highp vec4 q, out highp vec3 m) {\n  m = vec3(.0, .0, 1.) + vec3(2., -2., -2.) * q.x * q.zwx + vec3(2., 2., -2.) * q.y * q.wzy;\n}\nvoid l(const highp vec4 q, out highp vec3 m, out highp vec3 t) {\n  l(q, m);\n  t = vec3(1., .0, .0) + vec3(-2., 2., -2.) * q.y * q.yxw + vec3(-2., 2., 2.) * q.z * q.zwx;\n}\nconst float o = .5;\nvec2 u(vec2 v, float A) {\n  return vec2(cos(A) * (v.x - o) + sin(A) * (v.y - o) + o, cos(A) * (v.y - o) - sin(A) * (v.x - o) + o);\n}\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#endif\nvoid main() {\n  mat4 B = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec3 C = getLineExtrudePosition(aPosition);\n  vec4 D = getPosition(C);\n#else\nvec4 D = getPosition(aPosition);\n#endif\nvModelVertex = (modelMatrix * D).xyz;\n  vec4 E = B * D;\n  vec4 F = modelViewMatrix * E;\n  vViewVertex = F;\n  mat4 G = projMatrix;\n  G[2].xy += halton.xy / outSize.xy;\n  gl_Position = G * F;\n#ifdef PICKING_MODE\nfloat H = 1.;\n#if defined(HAS_COLOR)\nH *= aColor.a;\n#endif\n#if defined(HAS_COLOR0)\nH *= aColor0.a;\n#endif\nfbo_picking_setData(gl_Position.w, H != .0);\n#else\n#if defined(HAS_MAP)\nvec2 I = getTexcoord(aTexCoord);\n#ifdef HAS_RANDOM_TEX\nvec2 J = uvOrigin;\n  vec2 K = I * uvScale + uvOffset;\n  if(uvRotation != .0) {\n    J = u(J, uvRotation);\n    K = u(K, uvRotation);\n  }\n  vTexCoord = mod(J, 1.) + K;\n#else\nvec2 J = uvOrigin;\n  vec2 K = I * uvScale;\n  if(uvRotation != .0) {\n    J = u(J, uvRotation);\n    K = u(K, uvRotation);\n  }\n  vTexCoord = mod(J, 1.) + K + uvOffset;\n#endif\n#ifdef HAS_I3S_UVREGION\nvUvRegion = uvRegion / 65535.;\n#endif\n#endif\n#if defined(HAS_TANGENT) || defined(HAS_NORMAL)\nmat3 L = mat3(B);\n  mat3 M = modelNormalMatrix * L;\n#if defined(HAS_TANGENT)\nvec3 t;\n  l(aTangent, d, t);\n  vModelTangent = vec4(M * t, aTangent.w);\n#else\n#ifdef HAS_DECODE_NORMAL\nd = getNormal(aNormal);\n#else\nd = aNormal;\n#endif\n#endif\nvec3 N = d;\n  vModelNormal = M * N;\n#else\nd = vec3(.0);\n  vModelNormal = vec3(.0);\n#endif\n#if defined(HAS_TANGENT)\nvModelBiTangent = cross(vModelNormal, vModelTangent.xyz) * sign(aTangent.w);\n#endif\n#ifdef HAS_SSR\nmat3 O = modelViewNormalMatrix * L;\n  vViewNormal = O * d;\n#if defined(HAS_TANGENT)\nvec4 P = vec4(t, aTangent.w);\n  vViewTangent = vec4(O * P.xyz, P.w);\n#endif\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#endif\nhighlight_setVarying();\n#if defined(HAS_COLOR0)\nvColor0 = aColor0 / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(E);\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * B, D);\n#endif\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nmat3 Q = f(mat3(vModelTangent.xyz, vModelBiTangent, vModelNormal));\n  vTangentViewPos = Q * cameraPosition;\n  vTangentFragPos = Q * vModelVertex;\n#endif\n#endif\n}",frag:e.frag||"#if __VERSION__ == 100\n#if defined(GL_EXT_shader_texture_lod)\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#if defined(GL_OES_standard_derivatives)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\n#define saturate(x)        clamp(x, 0.0, 1.0)\nprecision mediump float;\n#include <gl2_frag>\n#include <hsv_frag>\nuniform vec3 hsv;\nuniform float contrast;\nconst float c = .04;\nstruct MaterialUniforms {\n  vec2 roughnessMetalness;\n  vec3 albedo;\n  float alpha;\n  vec3 normal;\n  vec3 emit;\n  float ao;\n  vec3 specularColor;\n  float glossiness;\n} d;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\nuniform vec3 cameraPosition;\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nuniform vec4 diffuseFactor;\nuniform vec3 specularFactor;\nuniform float glossinessFactor;\n#if defined(HAS_DIFFUSE_MAP)\nuniform sampler2D diffuseTexture;\n#endif\n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\nuniform vec3 emissiveFactor;\nuniform vec4 baseColorFactor;\nuniform float baseColorIntensity;\nuniform float anisotropyDirection;\nuniform float anisotropyFactor;\nuniform float clearCoatFactor;\nuniform float clearCoatIor;\nuniform float clearCoatRoughnessFactor;\nuniform float clearCoatThickness;\nuniform float emitColorFactor;\nuniform float occlusionFactor;\nuniform float environmentExposure;\nuniform float roughnessFactor;\nuniform float metallicFactor;\nuniform float normalMapFactor;\nuniform float rgbmRange;\nuniform float specularF0;\nuniform int emitMultiplicative;\nuniform int normalMapFlipY;\nuniform int outputSRGB;\nuniform mat3 uEnvironmentTransform;\n#if defined(HAS_ALBEDO_MAP)\nuniform sampler2D baseColorTexture;\n#endif\n#if defined(HAS_METALLICROUGHNESS_MAP)\nuniform sampler2D metallicRoughnessTexture;\n#endif\n#if defined(HAS_EMISSIVE_MAP)\nuniform sampler2D emissiveTexture;\n#endif\n#if defined(HAS_AO_MAP)\nuniform sampler2D occlusionTexture;\n#endif\n#if defined(HAS_NORMAL_MAP) && defined(HAS_TANGENT)\nuniform sampler2D normalTexture;\n#endif\n#if defined(HAS_ALPHAMODE)\nuniform float alphaCutoff;\n#endif\n#ifdef HAS_RANDOM_TEX\nuniform highp vec2 uvOrigin;\nuniform highp float uvRotation;\nuniform sampler2D noiseTexture;\n#endif\nuniform sampler2D brdfLUT;\n#if defined(HAS_IBL_LIGHTING)\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform vec3 diffuseSPH[9];\nuniform vec2 prefilterMiplevel;\nuniform vec2 prefilterSize;\n#else\nuniform vec3 ambientColor;\n#endif\nuniform vec2 cameraNearFar;\nuniform vec3 clearCoatTint;\nuniform vec3 light0_viewDirection;\nuniform vec4 light0_diffuse;\n#ifdef HAS_SSR\nvarying vec3 vViewNormal;\n#if defined(HAS_TANGENT)\nvarying vec4 vViewTangent;\n#endif\n#endif\nvarying vec3 vModelVertex;\nvarying vec4 vViewVertex;\n#if defined(HAS_MAP)\nvarying highp vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\nvarying vec4 vUvRegion;\n#endif\nvec2 e() {\n  \n#ifdef HAS_I3S_UVREGION\nvec2 f = vUvRegion.zw - vUvRegion.xy;\n  vec2 h = fract(vTexCoord) * f + vUvRegion.xy;\n  return h;\n#else\nreturn vTexCoord;\n#endif\n}\n#endif\nvarying vec3 vModelNormal;\n#if defined(HAS_TANGENT)\nvarying vec4 vModelTangent;\nvarying vec3 vModelBiTangent;\n#endif\n#if defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvarying vec3 vColor0;\n#else\nvarying vec4 vColor0;\n#endif\n#endif\n#if defined(HAS_COLOR)\nvarying vec4 vColor;\n#elif defined(IS_LINE_EXTRUSION)\nuniform vec4 lineColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#ifdef HAS_INSTANCE_COLOR\nvarying vec4 vInstanceColor;\n#endif\n#ifdef IS_LINE_EXTRUSION\nuniform float lineOpacity;\n#else\nuniform float polygonOpacity;\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D linePatternFile;\nuniform vec2 atlasSize;\nuniform float flipY;\nuniform float currentTime;\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#else\nuniform float linePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#else\nuniform float linePatternGap;\n#endif\nuniform vec4 linePatternGapColor;\nuniform vec2 uvScale;\nvarying float vPatternHeight;\nvarying float vLinesofar;\nvarying vec4 vTexInfo;\nvarying float vNormalY;\nvec2 i(vec2 j) {\n  vec2 k = mod(j, 1.);\n  vec2 l = vTexInfo.xy;\n  vec2 m = vTexInfo.zw;\n  return (l + k * m) / atlasSize;\n}\n#endif\n#include <heatmap_render_frag>\n#include <snow_frag>\n#ifdef HAS_RANDOM_TEX\nconst float n = .5;\nvec2 o(vec2 k, float u) {\n  return vec2(cos(u) * (k.x - n) + sin(u) * (k.y - n) + n, cos(u) * (k.y - n) - sin(u) * (k.x - n) + n);\n}\nfloat v(vec3 A) {\n  return A.x + A.y + A.z;\n}\n#endif\nvec4 B(sampler2D C, in vec2 k) {\n  \n#ifdef HAS_RANDOM_TEX\nhighp vec2 D = uvOrigin;\n  if(uvRotation != .0) {\n    D = o(D, uvRotation);\n  }\n  highp vec2 E = k + D - mod(D, 1.);\n  float F = texture2D(noiseTexture, .005 * E).x;\n  vec2 G = dFdx(E);\n  vec2 H = dFdx(E);\n  float I = F * 8.;\n  float J = fract(I);\n#if 1\nfloat K = floor(I);\n  float L = K + 1.;\n#else\nfloat K = floor(I + .5);\n  float L = floor(I);\n  J = min(J, 1. - J) * 2.;\n#endif\nvec2 M = sin(vec2(3., 7.) * K);\n  vec2 N = sin(vec2(3., 7.) * L);\n  float O = .5;\n  vec4 P = texture2DGradEXT(C, k + O * M, G, H);\n  vec4 Q = texture2DGradEXT(C, k + O * N, G, H);\n  return mix(P, Q, smoothstep(.2, .8, J - .1 * v(P.xyz - Q.xyz)));\n#else\nreturn texture2D(C, k);\n#endif\n}\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nuniform sampler2D bumpTexture;\nuniform float bumpScale;\nuniform float bumpMaxLayers;\nuniform float bumpMinLayers;\nvec2 R(vec2 k, vec3 S) {\n  float T = mix(bumpMaxLayers, bumpMinLayers, abs(dot(vec3(.0, .0, 1.), S)));\n  float U = 1. / T;\n  float V = .0;\n  vec2 W = S.xy * bumpScale / (S.z * T);\n  vec2 X = k;\n  float Y = B(bumpTexture, X).r;\n  for(int Z = 0; Z < 30; Z++) {\n    V += U;\n    X -= W;\n    Y = B(bumpTexture, X).r;\n    if(Y < V) {\n      break;\n    }\n  }\n  vec2 ba = X + W;\n  float bb = Y - V;\n  float bc = B(bumpTexture, ba).r - V + U;\n  return mix(X, ba, bb / (bb - bc));\n}\nvarying vec3 vTangentViewPos;\nvarying vec3 vTangentFragPos;\n#endif\n#define SHADER_NAME PBR\nvec3 bd(const in vec3 be) {\n  return vec3(be.r < .0031308 ? be.r * 12.92 : 1.055 * pow(be.r, 1. / 2.4) - .055, be.g < .0031308 ? be.g * 12.92 : 1.055 * pow(be.g, 1. / 2.4) - .055, be.b < .0031308 ? be.b * 12.92 : 1.055 * pow(be.b, 1. / 2.4) - .055);\n}\nvec3 bf(const in vec3 be) {\n  return vec3(be.r < .04045 ? be.r * (1. / 12.92) : pow((be.r + .055) * (1. / 1.055), 2.4), be.g < .04045 ? be.g * (1. / 12.92) : pow((be.g + .055) * (1. / 1.055), 2.4), be.b < .04045 ? be.b * (1. / 12.92) : pow((be.b + .055) * (1. / 1.055), 2.4));\n}\nvec3 bg(const in vec4 be, const in float bh) {\n  if(bh <= .0)\n    return be.rgb;\n  return bh * be.rgb * be.a;\n}\nvec3 bi() {\n  return d.albedo;\n}\nfloat bj() {\n  \n#if defined(HAS_ALPHAMODE)\nif(d.alpha >= alphaCutoff) {\n    return 1.;\n  } else {\n    return .0;\n  }\n#else\nreturn d.alpha;\n#endif\n}\nfloat bk() {\n  \n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nvec3 be = d.specularColor;\n  return max(max(be.r, be.g), be.b);\n#else\nreturn d.roughnessMetalness.y;\n#endif\n}\nfloat bl() {\n  return specularF0;\n}\nfloat bm() {\n  \n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn 1. - d.glossiness;\n#else\nreturn d.roughnessMetalness.x;\n#endif\n}\nvec3 bn() {\n  return d.emit;\n}\nvec3 bo() {\n  return d.normal;\n}\nfloat bp() {\n  return clearCoatFactor;\n}\nfloat bq() {\n  return clearCoatRoughnessFactor;\n}\nfloat br() {\n  return d.ao;\n}\nfloat bs(const in vec4 bt) {\n  return bt.r + bt.g / 255.;\n}\nfloat bu(const in vec2 bv, const in float bw) {\n  vec3 bx = vec3(.06711056, .00583715, 52.9829189);\n  return fract(bx.z * fract(dot(bv.xy + bw * vec2(47., 17.) * .695, bx.xy))) * .5;\n}\nvec3 by(const in float bz, in vec3 bA, const in vec3 t, const in vec3 b, in vec3 bB) {\n  bA.xy = bz * bA.xy;\n  mat3 bC = mat3(t, b, bB);\n  return normalize(bC * bA);\n}\nvoid bD(const in vec3 bE, const in vec3 bA, const in vec3 bF, out float bG, out vec3 bH, out float bI) {\n  bG = 1.;\n  bH = -bF;\n  bI = dot(bH, bA);\n}\nvec4 bJ(const in vec3 bA, const in vec3 bE, const in float bK) {\n  float bL = clamp(dot(bA, bE), 0., 1.);\n  float bM = bK * bK;\n  return vec4(bM, bM * bM, bL, bL * (1. - bM));\n}\nfloat bN(const vec4 bJ, const float bO) {\n  float bP = bJ.y;\n  float bQ = (bO * bP - bO) * bO + 1.;\n  return bP / (3.141593 * bQ * bQ);\n}\nvec3 bR(const vec3 bS, const float bT, const in float bU) {\n  float bV = pow(1. - bU, 5.);\n  return bT * bV + (1. - bV) * bS;\n}\nfloat bR(const float bS, const float bT, const in float bU) {\n  return bS + (bT - bS) * pow(1. - bU, 5.);\n}\nfloat bW(const vec4 bJ, const float bX) {\n  float a = bJ.x;\n  float bY = bX * (bJ.w + a);\n  float bZ = bJ.z * (bX * (1. - a) + a);\n  return .5 / (bY + bZ);\n}\nvec3 ca(const vec4 bJ, const vec3 bA, const vec3 bE, const vec3 bH, const vec3 cb, const float bX, const float bT) {\n  vec3 cc = normalize(bE + bH);\n  float bO = clamp(dot(bA, cc), 0., 1.);\n  float bU = clamp(dot(bH, cc), 0., 1.);\n  float cd = bN(bJ, bO);\n  float ce = bW(bJ, bX);\n  vec3 cf = bR(cb, bT, bU);\n  return (cd * ce * 3.141593) * cf;\n}\nvoid cg(const in vec3 bA, const in vec3 bE, const in float bX, const in vec4 bJ, const in vec3 ch, const in vec3 cb, const in float bG, const in vec3 ci, const in vec3 bH, const in float bT, out vec3 cj, out vec3 ck, out bool cl) {\n  cl = bX > .0;\n  if(cl == false) {\n    ck = cj = vec3(.0);\n    return;\n  }\n  vec3 cm = bG * bX * ci;\n  ck = cm * ca(bJ, bA, bE, bH, cb, bX, bT);\n  cj = cm * ch;\n}\nfloat cn(float at, float ab, float co, float cp, float cq, float cr, float bL, float bX) {\n  float cs = bX * length(vec3(at * co, ab * cp, bL));\n  float ct = bL * length(vec3(at * cq, ab * cr, bX));\n  return .5 / (cs + ct);\n}\nfloat cu(const float at, const float ab, const float cv, const float cw, const float bO) {\n  float bP = at * ab;\n  vec3 bQ = vec3(ab * cv, at * cw, bP * bO);\n  float x = bP / dot(bQ, bQ);\n  return bP * (x * x) / 3.141593;\n}\nvec3 cx(const vec4 bJ, const vec3 bA, const vec3 bE, const vec3 bH, const vec3 cb, const float bX, const float bT, const in vec3 cy, const in vec3 cz, const in float cA) {\n  vec3 cc = normalize(bE + bH);\n  float bO = clamp(dot(bA, cc), 0., 1.);\n  float bL = clamp(dot(bA, bE), 0., 1.);\n  float bU = clamp(dot(bH, cc), 0., 1.);\n  float co = dot(cy, bE);\n  float cp = dot(cz, bE);\n  float cq = dot(cy, bH);\n  float cr = dot(cz, bH);\n  float cv = dot(cy, cc);\n  float cw = dot(cz, cc);\n  float cB = sqrt(1. - abs(cA) * .9);\n  if(cA > .0)\n    cB = 1. / cB;\n  float at = bJ.x * cB;\n  float ab = bJ.x / cB;\n  float cd = cu(at, ab, cv, cw, bO);\n  float ce = cn(at, ab, co, cp, cq, cr, bL, bX);\n  vec3 cf = bR(cb, bT, bU);\n  return (cd * ce * 3.141593) * cf;\n}\nvoid cC(const in vec3 bA, const in vec3 bE, const in float bX, const in vec4 bJ, const in vec3 ch, const in vec3 cb, const in float bG, const in vec3 ci, const in vec3 bH, const in float bT, const in vec3 cy, const in vec3 cz, const in float cA, out vec3 cj, out vec3 ck, out bool cl) {\n  cl = bX > .0;\n  if(cl == false) {\n    ck = cj = vec3(.0);\n    return;\n  }\n  vec3 cm = bG * bX * ci;\n  ck = cm * cx(bJ, bA, bE, bH, cb, bX, bT, cy, cz, cA);\n  cj = cm * ch;\n}\n#if defined(HAS_IBL_LIGHTING)\nvec3 cD(const in vec3 bA) {\n  vec3 bB = uEnvironmentTransform * bA;\n  float x = bB.x;\n  float y = bB.y;\n  float z = bB.z;\n  vec3 cE = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    cE = hsv_apply(cE, hdrHSV);\n  }\n  return max(cE, vec3(.0));\n}\nfloat cF(const in float cG) {\n  return cG;\n}\nvec3 cH(const in float cI, const in vec3 cJ) {\n  vec3 cK = cJ;\n  float cL = prefilterMiplevel.x;\n  float cM = min(cL, cF(cI) * prefilterMiplevel.y);\n  vec3 cN = bg(textureCubeLod(prefilterMap, cK, cM), rgbmRange);\n  if(length(hdrHSV) > .0) {\n    return hsv_apply(cN, hdrHSV);\n  } else {\n    return cN;\n  }\n}\nvec3 cO(const in vec3 cP, const in vec3 cJ, const in float cQ) {\n  float cR = 1. - cQ;\n  float cS = cR * (sqrt(cR) + cQ);\n  return mix(cP, cJ, cS);\n}\nvec3 cT(const in vec3 bA, const in vec3 bE, const in float bK, const in vec3 cU) {\n  vec3 cJ = reflect(-bE, bA);\n  cJ = cO(bA, cJ, bK);\n  vec3 cV = cH(bK, uEnvironmentTransform * cJ);\n  float bz = clamp(1. + dot(cJ, cU), .0, 1.);\n  cV *= bz * bz;\n  return cV;\n}\n#else\nvec3 cT(const in vec3 bA, const in vec3 bE, const in float bK, const in vec3 cU) {\n  return ambientColor;\n}\n#endif\nvec3 cW(const in vec3 cb, const in float bK, const in float bL, const in float bT) {\n  vec4 rgba = texture2D(brdfLUT, vec2(bL, bK));\n  float b = (rgba[3] * 65280.0 + rgba[2] * 255.);\n  float a = (rgba[1] * 65280.0 + rgba[0] * 255.);\n  const float cX = 1. / 65535.;\n  return (cb * a + b * bT) * cX;\n}\nvec3 cY(const in vec3 bA, const in vec3 bE, const in float bK, const in vec3 cb, const in vec3 cU, const in float bT) {\n  float bL = dot(bA, bE);\n  return cT(bA, bE, bK, cU) * cW(cb, bK, bL, bT);\n}\nvec3 cZ(const float bL, const float bX, const vec3 da, const float bQ) {\n  return exp(da * -bQ * ((bX + bL) / max(bX * bL, 1e-3)));\n}\nvec3 db(const in float bL, const in float bX, const in float dc) {\n  return mix(vec3(1.), cZ(bL, bX, clearCoatTint, clearCoatThickness), dc);\n}\nvoid dd(const in float de, const in vec3 bA, const in vec3 bE, const in float bI, const in vec4 bJ, const in float bG, const in vec3 ci, const in vec3 bH, const in float dc, out vec3 df, out vec3 dg) {\n  if(bI <= .0) {\n    df = vec3(.0);\n    dg = vec3(.0);\n    return;\n  }\n  float dh = clamp(dot(bA, -refract(bH, bA, 1. / clearCoatIor)), 0., 1.);\n  vec3 di = db(de, dh, dc);\n  vec3 cc = normalize(bE + bH);\n  float bO = clamp(dot(bA, cc), 0., 1.);\n  float bU = clamp(dot(bH, cc), 0., 1.);\n  float cd = bN(bJ, bO);\n  float ce = bW(bJ, dh);\n  float cf = bR(c, 1., bU);\n  df = (bG * bI * dc * cd * ce * 3.141593 * cf) * ci;\n  dg = (1. - cf * dc) * di;\n}\nfloat dj(const in int dk, const in float dl, const in vec3 bA, const in vec3 bE) {\n  if(dk == 0)\n    return 1.;\n  float bQ = dot(bA, bE) + dl;\n  return clamp(bQ * bQ - 1. + dl, .0, 1.);\n}\nvec3 dm(const in vec3 bA, const in vec3 bE, const in float bK, const in vec3 cy, const in vec3 cz, const in float cA) {\n  vec3 dn = cA >= .0 ? cz : cy;\n  vec3 dp = cross(dn, bE);\n  vec3 dq = cross(dp, dn);\n  float dr = abs(cA) * clamp(5. * bK, .0, 1.);\n  return normalize(mix(bA, dq, dr));\n}\nvoid ds() {\n  \n#ifdef HAS_MAP\nvec2 k = e();\n#endif\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nk = R(k, normalize(vTangentViewPos - vTangentFragPos));\n#endif\nd.albedo = baseColorIntensity * baseColorFactor.rgb;\n  d.alpha = baseColorFactor.a;\n#if defined(HAS_PATTERN)\nfloat dt = vLinesofar;\n  vec2 m = vTexInfo.zw;\n#ifdef HAS_PATTERN_GAP\nfloat du = vLinePatternGap;\n#else\nfloat du = linePatternGap;\n#endif\n#ifdef HAS_PATTERN_ANIM\nfloat dv = vLinePatternAnimSpeed;\n#else\nfloat dv = linePatternAnimSpeed;\n#endif\nfloat dw = ceil(m.x * vPatternHeight / m.y);\n  float dx = dw * (1. + du);\n  dt += mod(currentTime * -dv * .2, dx);\n  float dy = mod(dt / dx, 1.);\n  float dz = mod(flipY * vNormalY, 1.);\n  vec2 k = i(vec2(dy * (1. + du) * uvScale[0], dz * uvScale[1]));\n  vec4 dA = texture2D(linePatternFile, k);\n  float dB = clamp(sign(1. / (1. + du) - dy) + .000001, .0, 1.);\n  dA = mix(linePatternGapColor, dA, dB);\n#ifdef IS_SQUARE_TUBE\nfloat A = clamp(sign(abs(vNormalY) - .999999), .0, 1.);\n  dA = mix(dA, vec4(1.), A);\n#endif\nd.albedo *= dA.rgb;\n  d.alpha *= dA.a;\n#endif\n#if defined(HAS_ALBEDO_MAP)\nvec4 dC = B(baseColorTexture, k);\n  d.albedo *= bf(dC.rgb);\n  d.alpha *= dC.a;\n#endif\n#if defined(HAS_COLOR0)\nd.albedo *= vColor0.rgb;\n#if COLOR0_SIZE == 4\nd.alpha *= vColor0.a;\n#endif\n#endif\n#if defined(HAS_COLOR)\nd.albedo *= vColor.rgb;\n  d.alpha *= vColor.a;\n#elif defined(IS_LINE_EXTRUSION)\nd.albedo *= lineColor.rgb;\n  d.alpha *= lineColor.a;\n#else\nd.albedo *= polygonFill.rgb;\n  d.alpha *= polygonFill.a;\n#endif\n#if defined(HAS_INSTANCE_COLOR)\nd.albedo *= vInstanceColor.rgb;\n  d.alpha *= vInstanceColor.a;\n#endif\n#if defined(IS_LINE_EXTRUSION)\nd.alpha *= lineOpacity;\n#else\nd.alpha *= polygonOpacity;\n#endif\n#if defined(HAS_METALLICROUGHNESS_MAP)\nd.roughnessMetalness = B(metallicRoughnessTexture, k).gb * vec2(roughnessFactor, metallicFactor);\n#else\nd.roughnessMetalness = vec2(roughnessFactor, metallicFactor);\n#endif\nd.emit = emissiveFactor;\n#if defined(HAS_EMISSIVE_MAP)\nif(emitMultiplicative == 1) {\n    d.emit *= bf(B(emissiveTexture, k).rgb);\n  } else {\n    d.emit += bf(B(emissiveTexture, k).rgb);\n  }\n#endif\nd.emit *= emitColorFactor;\n#if defined(HAS_AO_MAP)\nd.ao = B(occlusionTexture, k).r;\n#else\nd.ao = 1.;\n#endif\nd.ao *= occlusionFactor;\n#if defined(HAS_NORMAL_MAP) && defined(HAS_TANGENT)\nvec3 dD = B(normalTexture, k).xyz * 2. - 1.;\n  dD.y = normalMapFlipY == 1 ? -dD.y : dD.y;\n  d.normal = dD;\n#else\nd.normal = normalize(vModelNormal);\n#endif\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nd.albedo *= diffuseFactor.rgb;\n  d.alpha *= diffuseFactor.a;\n#if defined(HAS_DIFFUSE_MAP)\nvec4 ch = B(diffuseTexture, k);\n  d.albedo *= bf(ch.rgb);\n  d.alpha *= ch.a;\n#endif\nd.specularColor = specularFactor;\n  d.glossiness = glossinessFactor;\n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nvec4 dE = B(specularGlossinessTexture, k);\n  d.specularColor *= bf(dE.rgb);\n  d.glossiness *= dE.a;\n#endif\n#endif\n}\nvec3 dF(const vec3 x) {\n  const float a = 2.51;\n  const float b = .03;\n  const float dG = 2.43;\n  const float bQ = .59;\n  const float dH = .14;\n  return (x * (a * x + b)) / (x * (dG * x + bQ) + dH);\n}\nvec3 dI(vec3 be) {\n  be = dF(be);\n  return be = pow(be, vec3(1. / 2.2));\n}\nuniform float specularAAVariance;\nuniform float specularAAThreshold;\nfloat dJ(float bK, const vec3 dK) {\n  \n#if defined(GL_OES_standard_derivatives) || __VERSION__ == 300\nvec3 dL = dFdx(dK);\n  vec3 dM = dFdy(dK);\n  float dN = specularAAVariance * (dot(dL, dL) + dot(dM, dM));\n  float dO = min(2. * dN, specularAAThreshold);\n  float dP = saturate(bK * bK + dO);\n  return sqrt(dP);\n#else\nreturn bK;\n#endif\n}\n#ifdef HAS_SSR\nuniform sampler2D TextureDepth;\nuniform highp vec2 outSize;\nuniform float ssrFactor;\nuniform float ssrQuality;\nuniform sampler2D TextureReflected;\nuniform highp mat4 projMatrix;\nuniform mat4 invProjMatrix;\nuniform vec4 outputFovInfo[2];\nuniform mat4 reprojViewProjMatrix;\nvec3 dQ(const in mat4 dR, const in vec3 dS) {\n  vec4 dT = dR * vec4(dS, 1.);\n  return vec3(.5 + .5 * dT.xy / dT.w, dT.w);\n}\nvec3 dU(const in float dV, const in vec2 k) {\n  return texture2D(TextureReflected, k).rgb;\n}\nfloat dW(float dX) {\n  highp mat4 dR = projMatrix;\n  highp float z = dX * 2. - 1.;\n  return -dR[3].z / (z + dR[2].z);\n}\nfloat dY(const vec2 k) {\n  float dX = bs(texture2D(TextureDepth, k));\n  return dX;\n}\nvec3 dZ(const in float bw, const in vec3 ea, const in vec3 eb, const in vec3 ec, const in vec3 bE, const in float ed) {\n  vec2 ee;\n  ee.x = bu(gl_FragCoord.yx, bw);\n  ee.y = fract(ee.x * 52.9829189);\n  ee.y = mix(ee.y, 1., .7);\n  float ef = 2. * 3.14159 * ee.x;\n  float eg = pow(max(ee.y, .000001), ed / (2. - ed));\n  float eh = sqrt(1. - eg * eg);\n  vec3 ei = vec3(eh * cos(ef), eh * sin(ef), eg);\n  ei = ei.x * ea + ei.y * eb + ei.z * ec;\n  return normalize((2. * dot(bE, ei)) * ei - bE);\n}\nfloat ej(const in float bw) {\n  return (bu(gl_FragCoord.xy, bw) - .5);\n}\nvec3 ek(const in vec3 el, const in float em, const in vec3 en) {\n  vec3 eo = dQ(projMatrix, vViewVertex.xyz + en * em);\n  eo.z = 1. / eo.z;\n  eo -= el;\n  float ep = min(1., .99 * (1. - el.x) / max(1e-5, eo.x));\n  float eq = min(1., .99 * (1. - el.y) / max(1e-5, eo.y));\n  float er = min(1., .99 * el.x / max(1e-5, -eo.x));\n  float es = min(1., .99 * el.y / max(1e-5, -eo.y));\n  return eo * min(ep, eq) * min(er, es);\n}\nfloat et(const in vec3 el, const in vec3 eo, inout float eu, inout float ev) {\n  float ew = (ev + eu) * .5;\n  vec3 ex = el + eo * ew;\n  float z = dY(ex.xy);\n  float dX = dW(z);\n  float ey = -1. / ex.z;\n  eu = dX > ey ? eu : ew;\n  ev = dX > ey ? ew : ev;\n  return ew;\n}\nvec4 ez(const in vec3 el, const in float em, in float eA, const in vec3 en, const in float bK, const in float bw) {\n  int eB = 20;\n  float eC = 1. / float(eB);\n  eA *= eC;\n  vec3 eo = ek(el, em, en);\n  float eD = eC;\n  vec3 eE = vec3(.0, eD, 1.);\n  vec3 ex;\n  float z, dX, ey, eF, eG, eH;\n  bool eI;\n  float eJ = 1.;\n  float ew;\n  for(int Z = 0; Z < eB; Z++) {\n    ex = el + eo * eE.y;\n    z = dY(ex.xy);\n    dX = dW(z);\n    ey = -1. / ex.z;\n    float eK = clamp(sign(.999 - z), .0, 1.);\n    eF = eK * (ey - dX);\n    eF *= clamp(sign(abs(eF) - em * eC * eC), .0, 1.);\n    eI = abs(eF + eA) < eA;\n    eG = clamp(eE.x / (eE.x - eF), .0, 1.);\n    eH = eI ? eE.y + eG * eC - eC : 1.;\n    eE.z = min(eE.z, eH);\n    eE.x = eF;\n    if(eI) {\n      float eu = eE.y - eC;\n      float ev = eE.y;\n      ew = et(el, eo, eu, ev);\n      ew = et(el, eo, eu, ev);\n      ew = et(el, eo, eu, ev);\n      eJ = ew;\n      break;\n    }\n    eE.y += eC;\n  }\n  return vec4(el + eo * eJ, 1. - eJ);\n}\nvec4 eL(in vec4 eM, const in float eN, const in vec3 eO, const in vec3 eP, const in float bK) {\n  vec4 eQ = mix(outputFovInfo[0], outputFovInfo[1], eM.x);\n  eM.xyz = vec3(mix(eQ.xy, eQ.zw, eM.y), 1.) * -1. / eM.z;\n  eM.xyz = (reprojViewProjMatrix * vec4(eM.xyz, 1.)).xyw;\n  eM.xy /= eM.z;\n  float eR = clamp(6. - 6. * max(abs(eM.x), abs(eM.y)), .0, 1.);\n  eM.xy = .5 + .5 * eM.xy;\n  vec3 eS = eP * dU(bK * (1. - eM.w), eM.xy);\n  return vec4(mix(eO, eS, eN * eR), 1.);\n}\nvec3 ssr(const in vec3 eO, const in vec3 eP, const in float bK, const in vec3 bA, const in vec3 bE) {\n  float eT = .0;\n  vec4 cE = vec4(.0);\n  float ed = bK * bK;\n  ed = ed * ed;\n  vec3 eU = abs(bA.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 ea = normalize(cross(eU, bA));\n  vec3 eb = cross(bA, ea);\n  float eN = ssrFactor * clamp(-4. * dot(bE, bA) + 3.8, .0, 1.);\n  eN *= clamp(4.7 - bK * 5., .0, 1.);\n  vec3 el = dQ(projMatrix, vViewVertex.xyz);\n  el.z = 1. / el.z;\n  vec3 en = dZ(eT, ea, eb, bA, bE, ed);\n  float em = mix(cameraNearFar.y + vViewVertex.z, -vViewVertex.z - cameraNearFar.x, en.z * .5 + .5);\n  float eA = .5 * em;\n  vec4 eM;\n  if(dot(en, bA) > .001 && eN > .0) {\n    eM = ez(el, em, eA, en, bK, eT);\n    if(eM.w > .0)\n      cE += eL(eM, eN, eO, eP, bK);\n    \n  }\n  return cE.w > .0 ? cE.rgb / cE.w : eO;\n}\n#endif\n#include <highlight_frag>\nvoid main() {\n  ds();\n  vec3 bE = normalize(cameraPosition - vModelVertex.xyz);\n#if defined(HAS_DOUBLE_SIDE)\nvec3 cU = gl_FrontFacing ? normalize(vModelNormal) : -normalize(vModelNormal);\n#else\nvec3 cU = normalize(vModelNormal);\n#endif\n#if defined(HAS_TANGENT)\nvec4 eV;\n  eV = vModelTangent;\n#if defined(HAS_DOUBLE_SIDE)\neV.xyz = gl_FrontFacing ? normalize(eV.xyz) : -normalize(eV.xyz);\n#else\neV.xyz = normalize(eV.xyz);\n#endif\nvec3 eW = normalize(vModelBiTangent);\n#endif\nfloat bS = .08 * bl();\n  float eX = bk();\n  vec3 eY = bi();\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nvec3 eZ = d.specularColor;\n#else\nvec3 eZ = mix(vec3(bS), eY, eX);\n#endif\neY *= 1. - eX;\n  float fa = clamp(50.0 * eZ.g, .0, 1.);\n  float fb = bm();\n  if(specularAAVariance > .0) {\n    fb = dJ(fb, cU);\n  }\n  vec3 fc = bn();\n  vec3 fd = bo();\n  vec3 fe = vec3(fd);\n#if defined(HAS_TANGENT) && defined(HAS_NORMAL_MAP)\nfe = by(normalMapFactor, fe, eV.xyz, eW, cU);\n#endif\nfloat ff = bp();\n  float fg = bq();\n  if(specularAAVariance > .0) {\n    fg = dJ(fg, cU);\n  }\n  vec3 fh = cU;\n#if defined(HAS_TANGENT)\nfloat cA;\n  vec3 cy;\n  vec3 cz;\n  if(anisotropyFactor > .0) {\n    cA = anisotropyFactor;\n    eV.xyz = normalize(eV.xyz - fe * dot(eV.xyz, fe));\n    eW = normalize(cross(fe, eV.xyz)) * eV.w;\n    cy = normalize(mix(eV.xyz, eW, anisotropyDirection));\n    cz = normalize(mix(eW, -eV.xyz, anisotropyDirection));\n  }\n#endif\nvec3 ch = vec3(.0);\n  vec3 cb = vec3(.0);\n  vec3 fi;\n#if defined(HAS_TANGENT)\nif(anisotropyFactor > .0) {\n    fi = dm(fe, bE, fb, cy, cz, cA);\n  } else {\n    fi = fe;\n  }\n#else\nfi = fe;\n#endif\n#if defined(HAS_IBL_LIGHTING)\nch = eY * cD(fe) * .5;\n#else\nch = eY * ambientColor;\n#endif\ncb = cY(fi, bE, fb, eZ, cU, fa);\n  float de;\n  if(clearCoatFactor > .0) {\n    de = clamp(dot(fh, -refract(bE, fh, 1. / clearCoatIor)), 0., 1.);\n    float fj = ff * bR(c, 1., de);\n    vec3 fk = db(de, de, ff);\n    cb = mix(cb * fk, cT(fh, bE, fg, cU), fj);\n    ch *= fk * (1. - fj);\n  }\n  float fl = 1.;\n  float fm = br();\n  ch *= environmentExposure * fm;\n#ifdef HAS_IBL_LIGHTING\nfl = dj(1, fm, fe, bE);\n#endif\n#ifdef HAS_SSR\nvec3 fn = normalize(gl_FrontFacing ? vViewNormal : -vViewNormal);\n  vec3 fo = fn;\n#if defined(HAS_TANGENT) && defined(HAS_NORMAL_MAP)\nvec4 fp;\n  fp = vViewTangent;\n  fp = gl_FrontFacing ? fp : -fp;\n  fp.xyz = normalize(fp.xyz);\n  vec3 fq = normalize(cross(fn, fp.xyz)) * fp.w;\n  fo = by(normalMapFactor, fd, fp.xyz, fq, fn);\n#endif\ncb = ssr(cb, eZ * fl, fb, fo, -normalize(vViewVertex.xyz));\n#endif\ncb *= environmentExposure * fl;\n  float bG, bI;\n  vec3 bH;\n  bool cl;\n  vec3 fr;\n  vec3 fs;\n  vec4 ft = bJ(fe, bE, max(.045, fb));\n  vec3 fu = vModelNormal;\n  bD(bE, fe, light0_viewDirection, bG, bH, bI);\n#if defined(HAS_TANGENT)\nif(anisotropyFactor > .0) {\n    cC(fe, bE, bI, ft, eY, eZ, bG, light0_diffuse.rgb, bH, fa, cy, cz, cA, fs, fr, cl);\n  } else {\n    cg(fe, bE, bI, ft, eY, eZ, bG, light0_diffuse.rgb, bH, fa, fs, fr, cl);\n  }\n#else\ncg(fe, bE, bI, ft, eY, eZ, bG, light0_diffuse.rgb, bH, fa, fs, fr, cl);\n#endif\nif(clearCoatFactor > .0) {\n    vec3 fv;\n    vec3 fw;\n    vec4 fx = bJ(fh, bE, fg);\n    dd(de, fh, bE, dot(fh, bH), fx, bG, light0_diffuse.rgb, bH, ff, fv, fw);\n    fs *= fw;\n    fr = fv + fr * fw;\n  }\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat fy = shadow_computeShadow();\n  fs = shadow_blend(fs, fy).rgb;\n  fr = shadow_blend(fr, fy).rgb;\n#endif\nvec3 fz = vec3(cb);\n  vec3 fA = vec3(ch);\n  ch += fs;\n  cb += fr;\n  ch += fc;\n  vec3 fB = cb + ch;\n  if(outputSRGB == 1)\n    fB = bd(fB);\n  glFragColor = vec4(fB, bj());\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\n#ifdef HAS_SNOW\nglFragColor.rgb = snow(glFragColor, bo(), 1.);\n#endif\nif(contrast != 1.) {\n    glFragColor = contrastMatrix(contrast) * glFragColor;\n  }\n  if(length(hsv) > .0) {\n    glFragColor = hsv_apply(glFragColor, hsv);\n  }\n#ifdef OUTPUT_NORMAL\nglFragColor = vec4(cU, 1.);\n#endif\nglFragColor = highlight_blendColor(glFragColor);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:u,extraCommandProps:n,defines:o}),this.version=300}getGeometryDefines(e){const t={};return e.data[e.desc.tangentAttribute]?t.HAS_TANGENT=1:e.data[e.desc.normalAttribute]&&(t.HAS_NORMAL=1),t}},StandardDepthShader:class extends rt$6{constructor(e={}){const n=[];super({vert:"#define SHADER_NAME depth_vert\nprecision highp float;\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projMatrix;\nuniform vec2 outSize;\nuniform vec2 halton;\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec4 d = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 d = getPosition(aPosition);\n#endif\nvec4 e = modelViewMatrix * c * d;\n  mat4 f = projMatrix;\n  f[2].xy += halton.xy / outSize.xy;\n  gl_Position = f * e;\n}",frag:"#define SHADER_NAME depth_frag\nprecision highp float;\nvoid main() {\n  gl_FragColor = vec4(1., .0, .0, 1.);\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:(e,r)=>multiply$5(n,r.viewMatrix,r.modelMatrix)}],extraCommandProps:e.extraCommandProps,defines:e.defines})}},PBRUtils:Un$3};var h$3=Object.freeze({__proto__:null,AbstractTexture:F$8,BloomPass:wt$5,BoundingBox:X$7,BoxBlurShader:class extends ht$6{constructor({blurOffset:e}){super({vert:ft$6,frag:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D textureSource;\nuniform vec2 resolution;\nuniform float ignoreTransparent;\nvoid main() {\n  vec4 c = vec4(.0);\n  float d = .0;\n  for(int x = -BOXBLUR_OFFSET; x <= BOXBLUR_OFFSET; ++x)\n    for(int y = -BOXBLUR_OFFSET; y <= BOXBLUR_OFFSET; ++y) {\n      vec2 e = vTexCoord.st + vec2(float(x) / resolution.x, float(y) / resolution.y);\n      e = clamp(e, .0, 1.);\n      vec4 f = texture2D(textureSource, e);\n      float h;\n      if(ignoreTransparent == 1.) {\n        h = sign(f.a);\n      } else {\n        h = 1.;\n      }\n      d += h;\n      c += h * f;\n    }\n  gl_FragColor = c / max(d, 1.) * clamp(sign(d - 1.), .0, 1.);\n}",defines:{BOXBLUR_OFFSET:e||2},extraCommandProps:{viewport:{x:0,y:0,width:(e,t)=>t.resolution[0],height:(e,t)=>t.resolution[1]}}}),this._blurOffset=e||2}getMeshCommand(e,t){const n="box_blur_"+this._blurOffset;return this.commands[n]||(this.commands[n]=this.createREGLCommand(e,null,t.getElements())),this.commands[n]}},Constants:N$9,CopyShader:zt$4,DeferredRenderer:class extends k$7{},FBORayPicking:nr$4,FogPass:Gt$4,FogShader:Ut$4,FxaaShader:mt$6,GLTFHelper:dn$3,GLTFManager:pn$3,Geometry:Z$7,HDR:fr$4,HeatmapDisplayShader:Ht$4,HeatmapShader:Dt$4,InstancedMesh:he$4,Jitter:Ct$5,KHRTechniquesWebglManager:lr$4,Material:ee$3,Mesh:de$4,MeshShader:rt$6,PhongMaterial:ie$4,PhongShader:st$6,PhongSpecularGlossinessMaterial:le$4,Plane:Xe$4,PointLineShader:class extends rt$6{constructor(e={}){const n=[];super({vert:"attribute vec3 aPosition;\n#ifdef HAS_COLOR0\nattribute vec4 aColor0;\nvarying vec4 vColor;\n#endif\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float pointSize;\n#if defined(HAS_MAP)\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#endif\n#include <get_output>\n#include <heatmap_render_vert>\n#ifdef HAS_FLOODANALYSE\nvarying float vHeight;\n#endif\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_PointSize = pointSize;\n  gl_Position = projViewModelMatrix * d * c;\n#ifdef HAS_COLOR0\nvColor = aColor0 / 255.;\n#endif\n#ifdef HAS_MAP\nvTexCoord = aTexCoord;\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * viewModelMatrix * d, c);\n#endif\n}",frag:"precision mediump float;\n#include <gl2_frag>\n#if defined(HAS_COLOR0)\nvarying vec4 vColor;\n#endif\n#include <heatmap_render_frag>\nuniform vec4 baseColorFactor;\n#if defined(HAS_MAP)\n#if defined(HAS_ALBEDO_MAP)\nuniform sampler2D baseColorTexture;\n#endif\n#if defined(HAS_DIFFUSE_MAP)\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec2 vTexCoord;\n#endif\nvoid main() {\n  \n#ifdef HAS_COLOR0\nglFragColor = vColor * baseColorFactor;\n#else\nglFragColor = vec4(1.) * baseColorFactor;\n#endif\n#ifdef HAS_MAP\n#ifdef HAS_ALBEDO_MAP\nglFragColor *= texture2D(baseColorTexture, vTexCoord);\n#endif\n#ifdef HAS_DIFFUSE_MAP\nglFragColor *= texture2D(diffuseTexture, vTexCoord);\n#endif\n#endif\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,r)=>multiply$5(n,r.projViewMatrix,r.modelMatrix)}],defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}})}},PostProcessShader:yt$5,QuadShader:ht$6,REGLHelper:Ue$4,RainRipplesPass:Jt$4,Renderer:k$7,ResourceLoader:ve$4,Scene:pe$4,Shader:tt$6,ShaderLib:We$4,ShadowDisplayShader:qn$3,ShadowMapShader:jn$3,ShadowPass:Wn$3,SkyboxShader:Lt$5,SsaoPass:xt$5,SsrPass:Rt$4,TaaPass:St$5,Texture2D:je$4,TextureCube:class extends F$8{onLoad(e){const t=this.config;if(!t)return;const n=this._createFaces(e);t.faces=n.map((e=>e.data)),this._updateREGL()}createREGLTexture(e){return e.cube(this.config)}_createFaces(){return[]}},ToonMaterial:class extends ie$4{constructor(e){super(e,oe$4)}},ToonShader:class extends st$6{constructor(e={}){super({vert:at$6,frag:ot$6,defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}})}},Util:I$7,WaterShader:class extends rt$6{constructor(e={}){super({vert:"precision highp float;\nprecision highp sampler2D;\nconst float c = 3.141592653589793;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nvec4 d(mat4 e, mat4 f, vec3 h) {\n  return e * modelMatrix * f * vec4(h, 1.);\n}\nvec3 i(in vec3 h, in vec3 j) {\n  return normalize(h + j);\n}\nmat3 k(in vec3 l) {\n  vec3 t = normalize(cross(vec3(.0, .0, 1.), l));\n  vec3 b = normalize(cross(l, t));\n  return mat3(t, b, l);\n}\nvoid m() {\n  \n}\nvoid main(void) {\n  vuv = aTexCoord;\n  vpos = (modelMatrix * vec4(aPosition, 1.)).xyz;\n  vnormal = aNormal;\n  vtbnMatrix = k(vnormal);\n  gl_Position = d(projMatrix, viewMatrix, vpos);\n  m();\n}",frag:"precision highp float;\nprecision highp sampler2D;\nuniform sampler2D texWaveNormal;\nuniform sampler2D texWavePerturbation;\nuniform vec3 octaveTextureRepeat;\nuniform vec4 waveParams;\nuniform vec2 waveDirection;\nuniform vec4 waterColor;\nuniform vec3 lightingDirection;\nuniform vec3 lightingIntensity;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nconst vec2 c = vec2(6. / 25., 5. / 24.);\nvec2 d(sampler2D e, vec2 f) {\n  return 2. * texture2D(e, f).rg - 1.;\n}\nfloat h(vec2 f) {\n  return texture2D(texWavePerturbation, f).b;\n}\nvec3 i(sampler2D e, vec2 f) {\n  return 2. * texture2D(e, f).rgb - 1.;\n}\nfloat j(vec2 f, float k) {\n  return fract(k);\n}\nfloat l(vec2 f, float k) {\n  float m = j(f, k);\n  return 1. - abs(1. - 2. * m);\n}\nvec3 n(sampler2D o, vec2 f, float k, float u) {\n  float v = waveParams[2];\n  float A = waveParams[3];\n  vec2 B = d(o, f) * v;\n  float m = j(f, k + u);\n  float C = l(f, k + u);\n  vec2 D = f;\n  D -= B * (m + A);\n  D += u;\n  D += (k - m) * c;\n  return vec3(D, C);\n}\nconst float E = .3737;\nconst float F = 7.77;\nvec3 G(sampler2D H, sampler2D I, vec2 f, vec2 J, float k) {\n  float K = waveParams[0];\n  vec2 L = k * -J;\n  float M = h(f * E) * F;\n  vec3 N = n(I, f + L, k + M, .0);\n  vec3 O = n(I, f + L, k + M, .5);\n  vec3 P = i(H, N.xy) * N.z;\n  vec3 Q = i(H, O.xy) * O.z;\n  vec3 R = normalize(P + Q);\n  R.xy *= K;\n  R.z = sqrt(1. - dot(R.xy, R.xy));\n  return R;\n}\nvec3 S(vec2 f, float k) {\n  float T = waveParams[1];\n  return G(texWaveNormal, texWavePerturbation, f * T, waveDirection, k);\n}\nconst float U = 3.141592653589793;\nconst float V = 1. / U;\nconst float W = .3183098861837907;\nconst float X = 1.570796326794897;\nstruct PBRShadingWater {\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float VdotH;\n  float LdotH;\n  float VdotN;\n};\nfloat Y = 2.2;\nvec3 Z(float ba, vec3 bb, float bc) {\n  return bb + (bc - bb) * pow(1. - ba, 5.);\n}\nfloat bd(float be, float bf) {\n  float bg = bf * bf;\n  float bh = be * be;\n  float bi = pow((bh * (bg - 1.) + 1.), Y) * U;\n  return bg / bi;\n}\nfloat bj(float bk) {\n  return .25 / (bk * bk);\n}\nvec3 bl(in PBRShadingWater bm, float bf, vec3 bn, float bo) {\n  vec3 bp = Z(bm.VdotH, bn, bo);\n  float bq = bd(bm.NdotH, bf);\n  float br = bj(bm.LdotH);\n  return (bq * br) * bp;\n}\nvec3 bs(const vec3 x) {\n  return (x * (2.51 * x + .03)) / (x * (2.43 * x + .59) + .14);\n}\nconst float bt = 2.2;\nconst float bu = .4545454545;\nvec4 bv(vec4 bw) {\n  return vec4(pow(bw.rgb, vec3(bu)), bw.w);\n}\nvec3 bx(vec3 bw) {\n  return pow(bw, vec3(bt));\n}\nconst vec3 by = vec3(.02, 1., 5.);\nconst vec2 bz = vec2(.02, .1);\nconst float bf = .06;\nconst vec3 bA = vec3(0, .6, .9);\nconst vec3 bB = vec3(.72, .92, 1.);\nPBRShadingWater bC;\nvec3 bD(in float bE, in vec3 bF, in vec3 bG) {\n  float bH = pow((1. - bE), by[2]);\n  return mix(bG, bF, bH);\n}\nvec3 bI(in vec3 bJ, in vec3 bK, in vec3 bL, vec3 bw, in vec3 bM, in vec3 bN, in float bO) {\n  vec3 bP = bx(bw);\n  vec3 bQ = normalize(bL + bK);\n  bC.NdotL = clamp(dot(bJ, bL), .0, 1.);\n  bC.NdotV = clamp(dot(bJ, bK), .001, 1.);\n  bC.VdotN = clamp(dot(bK, bJ), .001, 1.);\n  bC.NdotH = clamp(dot(bJ, bQ), .0, 1.);\n  bC.VdotH = clamp(dot(bK, bQ), .0, 1.);\n  bC.LdotH = clamp(dot(bL, bQ), .0, 1.);\n  float bR = max(dot(bN, bK), .0);\n  vec3 bS = bx(bB);\n  vec3 bT = bx(bA);\n  vec3 bB = bD(bR, bS, bT);\n  float bU = max(dot(bN, bL), .0);\n  bB *= .1 + bU * .9;\n  float bV = clamp(bO, .8, 1.);\n  vec3 bW = Z(bC.VdotN, vec3(by[0]), by[1]) * bB * bV;\n  vec3 bX = bP * mix(bB, bU * bM * V, 2. / 3.) * bV;\n  vec3 bY = vec3(.0);\n  if(bR > .0 && bU > .0) {\n    vec3 bZ = bl(bC, bf, vec3(bz[0]), bz[1]);\n    vec3 ca = bM * V * bO;\n    bY = bC.NdotL * ca * bZ;\n  }\n  return bs(bW + bX + bY);\n}\nvoid main() {\n  vec3 bN = vnormal;\n  vec3 cb = S(vuv, timeElapsed);\n  vec3 bJ = normalize(vtbnMatrix * cb);\n  vec3 bK = -normalize(vpos - camPos);\n  vec3 bL = normalize(-lightingDirection);\n  float bO = 1.;\n  vec4 cc = vec4(bI(bJ, bK, bL, waterColor.rgb, lightingIntensity, bN, bO), waterColor.w);\n  gl_FragColor = bv(cc);\n}",defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}})}},WireFrameMaterial:ne$4,WireframeShader:class extends rt$6{constructor(e={}){let n=e.extraCommandProps||{};const r=[];n=v$7({},n,{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},sample:{alpha:!0}}),super({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec3 aBarycentric;\nvarying vec3 vBarycentric;\nuniform mat4 modelMatrix;\nuniform mat4 projViewMatrix;\nuniform mat4 projViewModelMatrix;\nuniform mat4 positionMatrix;\nvarying vec3 vPosition;\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n  vec4 d = getPosition(aPosition);\n  gl_Position = projViewModelMatrix * c * d;\n  vBarycentric = aBarycentric;\n  vPosition = aPosition;\n}",frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec3 vBarycentric;\nuniform float time;\nuniform float thickness;\nuniform float secondThickness;\nuniform float dashRepeats;\nuniform float dashLength;\nuniform bool dashOverlap;\nuniform bool dashEnabled;\nuniform bool dashAnimate;\nuniform bool seeThrough;\nuniform bool insideAltColor;\nuniform bool dualStroke;\nuniform bool squeeze;\nuniform float squeezeMin;\nuniform float squeezeMax;\nuniform vec4 stroke;\nuniform vec4 fill;\nuniform float opacity;\nuniform bool noiseEnable;\nvarying vec3 vPosition;\n#ifdef HAS_INSTANCE\nvarying vec4 vInstanceColor;\n#endif\n#define F4 0.309016994374947451\n#define halfDist 0.5\nvec4 c(vec4 x) {\n  return x - floor(x * (1. / 289.)) * 289.;\n}\nfloat c(float x) {\n  return x - floor(x * (1. / 289.)) * 289.;\n}\nvec4 d(vec4 x) {\n  return c((x * 34. + 1.) * x);\n}\nfloat d(float x) {\n  return c((x * 34. + 1.) * x);\n}\nvec4 e(vec4 r) {\n  return 1.79284291400159 - .85373472095314 * r;\n}\nfloat e(float r) {\n  return 1.79284291400159 - .85373472095314 * r;\n}\nvec4 f(float h, vec4 i) {\n  const vec4 k = vec4(1., 1., 1., -1.);\n  vec4 p, s;\n  p.xyz = floor(fract(vec3(h) * i.xyz) * 7.) * i.z - 1.;\n  p.w = 1.5 - dot(abs(p.xyz), k.xyz);\n  s = vec4(lessThan(p, vec4(.0)));\n  p.xyz = p.xyz + (s.xyz * 2. - 1.) * s.www;\n  return p;\n}\nfloat l(vec4 m) {\n  const vec4 n = vec4(.138196601125011, .276393202250021, .414589803375032, -.447213595499958);\n  vec4 o = floor(m + dot(m, vec4(F4)));\n  vec4 u = m - o + dot(o, n.xxxx);\n  vec4 A;\n  vec3 B = step(u.yzw, u.xxx);\n  vec3 D = step(u.zww, u.yyz);\n  A.x = B.x + B.y + B.z;\n  A.yzw = 1. - B;\n  A.y += D.x + D.y;\n  A.zw += 1. - D.xy;\n  A.z += D.z;\n  A.w += 1. - D.z;\n  vec4 E = clamp(A, .0, 1.);\n  vec4 F = clamp(A - 1., .0, 1.);\n  vec4 G = clamp(A - 2., .0, 1.);\n  vec4 H = u - G + n.xxxx;\n  vec4 I = u - F + n.yyyy;\n  vec4 J = u - E + n.zzzz;\n  vec4 K = u + n.wwww;\n  o = c(o);\n  float L = d(d(d(d(o.w) + o.z) + o.y) + o.x);\n  vec4 M = d(d(d(d(o.w + vec4(G.w, F.w, E.w, 1.)) + o.z + vec4(G.z, F.z, E.z, 1.)) + o.y + vec4(G.y, F.y, E.y, 1.)) + o.x + vec4(G.x, F.x, E.x, 1.));\n  vec4 i = vec4(1. / 294., 1. / 49., 1. / 7., .0);\n  vec4 N = f(L, i);\n  vec4 O = f(M.x, i);\n  vec4 P = f(M.y, i);\n  vec4 Q = f(M.z, i);\n  vec4 R = f(M.w, i);\n  vec4 S = e(vec4(dot(N, N), dot(O, O), dot(P, P), dot(Q, Q)));\n  N *= S.x;\n  O *= S.y;\n  P *= S.z;\n  Q *= S.w;\n  R *= e(dot(R, R));\n  vec3 T = max(.6 - vec3(dot(u, u), dot(H, H), dot(I, I)), .0);\n  vec2 U = max(.6 - vec2(dot(J, J), dot(K, K)), .0);\n  T = T * T;\n  U = U * U;\n  return 49. * (dot(T * T, vec3(dot(N, u), dot(O, H), dot(P, I))) + dot(U * U, vec2(dot(Q, J), dot(R, K))));\n}\nconst float V = 3.14159265359;\nfloat W(float X, float Y) {\n  float Z = fwidth(Y) * halfDist;\n  return smoothstep(X - Z, X + Z, Y);\n}\nvec4 ba(vec3 bb) {\n  float bc = min(min(bb.x, bb.y), bb.z);\n  float bd = .0;\n  if(noiseEnable)\n    bd += l(vec4(vPosition.xyz * 80.0, time * halfDist)) * .12;\n  bc += bd;\n  float be = max(bb.x, bb.y);\n  if(bb.y < bb.x && bb.y < bb.z) {\n    be = 1. - be;\n  }\n  float bf = thickness;\n  if(squeeze) {\n    bf *= mix(squeezeMin, squeezeMax, (1. - sin(be * V)));\n  }\n  if(dashEnabled) {\n    float bg = 1. / dashRepeats * dashLength / 2.;\n    if(!dashOverlap) {\n      bg += 1. / dashRepeats / 2.;\n    }\n    if(dashAnimate) {\n      bg += time * .22;\n    }\n    float bh = fract((be + bg) * dashRepeats);\n    bf *= 1. - W(dashLength, bh);\n  }\n  float bi = 1. - W(bf, bc);\n#ifdef HAS_INSTANCE\nvec4 bj = vInstanceColor;\n#else\nvec4 bj = stroke;\n#endif\nvec4 bk = vec4(.0);\n  if(seeThrough) {\n    bk = vec4(bj.xyz, bi);\n    if(insideAltColor && !gl_FrontFacing) {\n      bk.rgb = fill.xyz;\n    }\n  } else {\n    vec3 bl = mix(fill.xyz, bj.xyz, bi);\n    bk.a = fill.a;\n    if(dualStroke) {\n      float bm = 1. - W(secondThickness, bc);\n      vec3 bn = mix(fill.xyz, stroke.xyz, abs(bm - bi));\n      bk.rgb = bn;\n    } else {\n      bk.rgb = bl;\n    }\n  }\n  return bk;\n}\nvoid main() {\n  glFragColor = ba(vBarycentric);\n  glFragColor *= halfDist + opacity;\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,n)=>multiply$5(r,n.projViewMatrix,n.modelMatrix)}],extraCommandProps:n}),this.version=300}},pbr:ur$4}),isArray=Array.isArray,keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,fastDeepEqual=function equal(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){var i,length,key,arrA=isArray(a),arrB=isArray(b);if(arrA&&arrB){if((length=a.length)!=b.length)return!1;for(i=length;0!=i--;)if(!equal(a[i],b[i]))return!1;return!0}if(arrA!=arrB)return!1;var dateA=a instanceof Date,dateB=b instanceof Date;if(dateA!=dateB)return!1;if(dateA&&dateB)return a.getTime()==b.getTime();var regexpA=a instanceof RegExp,regexpB=b instanceof RegExp;if(regexpA!=regexpB)return!1;if(regexpA&&regexpB)return a.toString()==b.toString();var keys=keyList(a);if((length=keys.length)!==keyList(b).length)return!1;for(i=length;0!=i--;)if(!hasProp.call(b,keys[i]))return!1;for(i=length;0!=i--;)if(!equal(a[key=keys[i]],b[key]))return!1;return!0}return a!=a&&b!=b};
/*!
	 * @maptalks/fusiongl v0.5.0
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.com
	 */
function _$7(E){for(let _=1;_<arguments.length;_++){const t=arguments[_];for(const _ in t)E[_]=t[_]}return E}function t$1(E,...t){for(let R=0;R<t.length;R++)_$7(E,t[R])}class R$9{constructor(E){this.context=E,this.COLOR_ATTACHMENT0_WEBGL=36064,this.COLOR_ATTACHMENT1_WEBGL=36065,this.COLOR_ATTACHMENT2_WEBGL=36066,this.COLOR_ATTACHMENT3_WEBGL=36067,this.COLOR_ATTACHMENT4_WEBGL=36068,this.COLOR_ATTACHMENT5_WEBGL=36069,this.COLOR_ATTACHMENT6_WEBGL=36070,this.COLOR_ATTACHMENT7_WEBGL=36071,this.COLOR_ATTACHMENT8_WEBGL=36072,this.COLOR_ATTACHMENT9_WEBGL=36073,this.COLOR_ATTACHMENT10_WEBGL=577040,this.COLOR_ATTACHMENT11_WEBGL=577041,this.COLOR_ATTACHMENT12_WEBGL=577042,this.COLOR_ATTACHMENT13_WEBGL=577043,this.COLOR_ATTACHMENT14_WEBGL=577044,this.COLOR_ATTACHMENT15_WEBGL=577045,this.DRAW_BUFFER0_WEBGL=34853,this.DRAW_BUFFER1_WEBGL=34854,this.DRAW_BUFFER2_WEBGL=34855,this.DRAW_BUFFER3_WEBGL=34856,this.DRAW_BUFFER4_WEBGL=34857,this.DRAW_BUFFER5_WEBGL=34858,this.DRAW_BUFFER6_WEBGL=34859,this.DRAW_BUFFER7_WEBGL=34860,this.DRAW_BUFFER8_WEBGL=34861,this.DRAW_BUFFER9_WEBGL=34862,this.DRAW_BUFFER10_WEBGL=34863,this.DRAW_BUFFER11_WEBGL=34864,this.DRAW_BUFFER12_WEBGL=34865,this.DRAW_BUFFER13_WEBGL=34866,this.DRAW_BUFFER14_WEBGL=34867,this.DRAW_BUFFER15_WEBGL=34868,this.MAX_COLOR_ATTACHMENTS_WEBGL=36063,this.MAX_DRAW_BUFFERS_WEBGL=2178}drawBuffersWEBGL(){return this.context.drawBuffers.apply(this.context,arguments)}}class T$7{constructor(E){this.context=E,this.VERTEX_ARRAY_BINDING_OES=34229}createVertexArrayOES(){return this.context.createVertexArray()}deleteVertexArrayOES(){return this.context.deleteVertexArray.apply(this.context,arguments)}isVertexArrayOES(){return this.context.isVertexArray.apply(this.context,arguments)}bindVertexArrayOES(){return this.context.bindVertexArray.apply(this.context,arguments)}}class A$6{constructor(E){this.context=E,this.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070}drawArraysInstancedANGLE(){return this.context.drawArraysInstanced.apply(this.context,arguments)}drawElementsInstancedANGLE(){return this.context.drawElementsInstanced.apply(this.context,arguments)}vertexAttribDivisorANGLE(){return this.context.vertexAttribDivisor.apply(this.context,arguments)}}const s={webgl_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},oes_element_index_uint:{},oes_texture_float:{},oes_texture_half_float:{HALF_FLOAT_OES:36193},ext_color_buffer_float:{},oes_standard_derivatives:{},ext_frag_depth:{},ext_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},ext_shader_texture_lod:{}},e$2={has(E,_){const t=E._;return!(!t&&!E.t.getExtension(_))&&(_=_.toLowerCase(),t&&s[_]||"webgl_draw_buffers"===_||"oes_vertex_array_object"===_||"angle_instanced_arrays"===_)},mock(E,_){return _=_.toLowerCase(),s[_]?E._?("oes_texture_float"!==_&&"oes_texture_half_float"!==_||E.t.getExtension("EXT_color_buffer_float"),s[_]):this.t.getExtension(_):"webgl_draw_buffers"===_?new R$9(E):"oes_vertex_array_object"===_?new T$7(E):"angle_instanced_arrays"===_?new A$6(E):null},getInternalFormat:(E,_,t)=>6402===_?33190:34041===_?35056:36193===t&&_===E.RGBA?34842:36193===t&&_===E.RGB?34843:t===E.FLOAT&&_===E.RGBA?34836:t===E.FLOAT&&_===E.RGB?34837:_,getTextureType:(E,_)=>36193===_?E.HALF_FLOAT:_};let r$1=1;class i$3{constructor(E){this.uid=r$1++,this.states=function(E){return{scissor:[0,0,E.canvas.width,E.canvas.height],viewport:[0,0,E.canvas.width,E.canvas.height],blendColor:[0,0,0,0],blendEquationSeparate:[E.FUNC_ADD,E.FUNC_ADD],blendFuncSeparate:[E.ONE,E.ZERO,E.ONE,E.ZERO],clearColor:[0,0,0,0],clearDepth:[1],clearStencil:[0],colorMask:[!0,!0,!0,!0],cullFace:[E.BACK],depthFunc:[E.LESS],depthMask:[!0],depthRange:[0,1],capabilities:{3042:!1,2884:!1,2929:!1,3024:!1,32823:!1,32926:!1,32928:!1,3089:!1,2960:!1},frontFace:[E.CCW],hint:{33170:[E.DONT_CARE],35723:[E.DONT_CARE]},lineWidth:[1],pixelStorei:{3333:[4],3317:[4],37440:[!1],37441:[!1],37443:[E.BROWSER_DEFAULT_WEBGL]},polygonOffset:[0,0],sampleCoverage:[1,!1],stencilFuncSeparate:{1028:[E.ALWAYS,0,4294967295],1029:[E.ALWAYS,0,4294967295]},stencilMaskSeparate:{1028:[4294967295],1029:[4294967295]},stencilOpSeparate:{1028:[E.KEEP,E.KEEP,E.KEEP],1029:[E.KEEP,E.KEEP,E.KEEP]},program:null,framebuffer:{36160:null,36008:null,36009:null},renderbuffer:{36161:null},textures:{active:-1,units:function(){const _=[],t=E.getParameter(E.MAX_COMBINED_TEXTURE_IMAGE_UNITS);for(let E=0;E<t;E++)_.push({3553:null,34067:null});return _[-1]={3553:null,34067:null},_}()},attributes:{},arrayBuffer:null,elementArrayBuffer:null}}(E),this.t=E,this.t._fusiongl_drawCalls=0,this._="undefined"!=typeof WebGL2RenderingContext&&this.t instanceof WebGL2RenderingContext,this.R=E.getParameter(E.MAX_VERTEX_ATTRIBS)}get canvas(){return this.t.canvas}get drawingBufferWidth(){return this.t.drawingBufferWidth}get drawingBufferHeight(){return this.t.drawingBufferHeight}get gl(){return this.t}get buffersOES(){return this.T||(this.T=this.t.getExtension("WEBGL_draw_buffers")),this.T}get vaoOES(){return this.A||(this.A=this.t.getExtension("OES_vertex_array_object")),this.A}get angleOES(){return this.s||(this.s=this.t.getExtension("ANGLE_instanced_arrays")),this.s}attachShader(E,_){return this.t.attachShader(E,_)}shaderSource(E,_){return this.t.shaderSource(E,_)}compileShader(E){return this.t.compileShader(E)}createShader(E){return this.t.createShader(E)}createProgram(){return this.t.createProgram()}deleteProgram(E){return this.states.program===E&&(this.states.program=null),this.t.deleteProgram(E)}deleteShader(E){return this.t.deleteShader(E)}detachShader(E,_){return this.t.detachShader(E,_)}getAttachedShaders(E){return this.t.getAttachedShaders(E)}linkProgram(E){return this.t.linkProgram(E)}getShaderParameter(E,_){return this.t.getShaderParameter(E,_)}getShaderPrecisionFormat(E,_){return this.t.getShaderPrecisionFormat(E,_)}getShaderInfoLog(E){return this.t.getShaderInfoLog(E)}getShaderSource(E){return this.t.getShaderSource(E)}getProgramInfoLog(E){return this.t.getProgramInfoLog(E)}getProgramParameter(E,_){return this.t.getProgramParameter(E,_)}getError(){return this.t.getError()}getContextAttributes(){return this.t.getContextAttributes()}getExtension(E){return e$2.has(this,E)?e$2.mock(this,E):this.t.getExtension(E)}getSupportedExtensions(){return this.t.getSupportedExtensions()}getParameter(E){return this.t.getParameter(E)}isEnabled(E){return this.t.isEnabled(E)}isProgram(E){return this.t.isProgram(E)}isShader(E){return this.t.isShader(E)}validateProgram(E){return this.t.validateProgram(E)}clear(E){return this.i(),this.t.clear(E)}drawArrays(E,_,t){return this.i(),this.N(),this.t.drawArrays(E,_,t)}drawElements(E,_,t,R){return this.i(),this.N(),this.t.drawElements(E,_,t,R)}drawBuffers(E){return this.i(),this.N(),this._?this.t.drawBuffers(E):this.buffersOES.drawBuffersWEBGL(E)}N(){this.t._fusiongl_drawCalls++}resetDrawCalls(){this.t._fusiongl_drawCalls=0}getDrawCalls(){return this.t._fusiongl_drawCalls}I(){const E=this.t,_=E.getParameter(E.CURRENT_PROGRAM),t=E.getProgramParameter(_,E.ACTIVE_ATTRIBUTES),R=[];for(let _=0;_<t;_++)R.push(E.getVertexAttrib(_,E.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING));this.h={buffers:R,elements:E.getParameter(E.ELEMENT_ARRAY_BUFFER_BINDING),framebuffer:E.getParameter(E.FRAMEBUFFER_BINDING)},window.DEBUGGING&&(console.log(this.uid,this.h),console.log(this.uid,this.states.attributes),console.log(this.states.attributes[0].buffer===this.h.buffers[0]),console.log(this.states.attributes[1].buffer===this.h.buffers[1]),console.log(this.states.attributes[2].buffer===this.h.buffers[2]))}finish(){return this.t.finish()}flush(){return this.i(),this.t.flush()}commit(){return this.i(),this.t.commit()}isContextLost(){return this.t.isContextLost()}}t$1(i$3.prototype,{DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBSTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}),t$1(i$3.prototype,{bufferData(...E){return this.i(),this.t.bufferData(...E)},bufferSubData(...E){return this.i(),this.t.bufferSubData(...E)},createBuffer(){return this.t.createBuffer()},deleteBuffer(E){const _=this.states;_.arrayBuffer===E?_.arrayBuffer=null:_.elementArrayBuffer===E&&(_.elementArrayBuffer=null);const t=_.attributes;for(const _ in t)t[_].buffer===E&&(t[_].buffer=null);return this.t.deleteBuffer(E)},getBufferParameter(E,_){return this.i(),this.t.getBufferParameter(E,_)},isBuffer(E){return this.t.isBuffer(E)}}),t$1(i$3.prototype,{checkFramebufferStatus(E){return this.t.checkFramebufferStatus(E)},createFramebuffer(){return this.t.createFramebuffer()},deleteFramebuffer(E){const _=this.states.framebuffer;for(const t in _)_[t]===E&&(_[t]=null);return this.t.deleteFramebuffer(E)},framebufferRenderbuffer(E,_,t,R){return this.i(),this.t.framebufferRenderbuffer(E,_,t,R)},framebufferTexture2D(E,_,t,R,T){return this.i(),this.t.framebufferTexture2D(E,_,t,R,T)},getFramebufferAttachmentParameter(E,_,t){return this.i(),this.t.getFramebufferAttachmentParameter(E,_,t)},isFramebuffer(E){return this.t.isFramebuffer(E)},readPixels(E,_,t,R,T,A,s){return this.i(),this.t.readPixels(E,_,t,R,T,A,s)},blitFramebuffer(E,_,t,R,T,A,s,e,r,i){return this.i(),this.t.blitFramebuffer(E,_,t,R,T,A,s,e,r,i)}}),t$1(i$3.prototype,{createRenderbuffer(){return this.t.createRenderbuffer()},deleteRenderbuffer(E){const _=this.states.renderbuffer;for(const t in _)_[t]===E&&(_[t]=null);return this.t.deleteRenderbuffer(E)},getRenderbufferParameter(E,_){return this.i(),this.t.getRenderbufferParameter(E,_)},isRenderbuffer(E){return this.t.isRenderbuffer(E)},renderbufferStorage(E,_,t,R){return this.i(),this.t.renderbufferStorage(E,_,t,R)},renderbufferStorageMultisample(E,_,t,R,T){return this.i(),this.t.renderbufferStorageMultisample(E,_,t,R,T)}}),t$1(i$3.prototype,{scissor(E,_,t,R){this.i();const T=this.states.scissor;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.scissor(E,_,t,R))},viewport(E,_,t,R){this.i();const T=this.states.viewport;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.viewport(E,_,t,R))},blendColor(E,_,t,R){this.i();const T=this.states.blendColor;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.blendColor(E,_,t,R))},blendEquation(E){this.i();const _=this.states.blendEquationSeparate;_[0]===E&&_[1]===E||(_[0]=E,_[1]=E,this.t.blendEquation(E))},blendEquationSeparate(E,_){this.i();const t=this.states.blendEquationSeparate;t[0]===E&&t[1]===_||(t[0]=E,t[1]=_,this.t.blendEquationSeparate(E,_))},blendFunc(E,_){this.i();const t=this.states.blendFuncSeparate;t[0]===E&&t[2]===E&&t[1]===_&&t[3]===_||(t[0]=E,t[1]=_,t[2]=E,t[3]=_,this.t.blendFunc(E,_))},blendFuncSeparate(E,_,t,R){this.i();const T=this.states.blendFuncSeparate;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.blendFuncSeparate(E,_,t,R))},clearColor(E,_,t,R){this.i();const T=this.states.clearColor;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.clearColor(E,_,t,R))},clearDepth(E){this.i();const _=this.states.clearDepth;_[0]!==E&&(_[0]=E,this.t.clearDepth(E))},clearStencil(E){this.i();const _=this.states.clearStencil;_[0]!==E&&(_[0]=E,this.t.clearStencil(E))},colorMask(E,_,t,R){this.i();const T=this.states.colorMask;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.colorMask(E,_,t,R))},cullFace(E){this.i();const _=this.states.cullFace;_[0]!==E&&(_[0]=E,this.t.cullFace(E))},depthFunc(E){this.i();const _=this.states.depthFunc;_[0]!==E&&(_[0]=E,this.t.depthFunc(E))},depthMask(E){this.i();const _=this.states.depthMask;_[0]!==E&&(_[0]=E,this.t.depthMask(E))},depthRange(E,_){this.i();const t=this.states.depthRange;t[0]===E&&t[1]===_||(t[0]=E,t[1]=_,this.t.depthRange(E,_))},disable(E){this.i();const _=this.states.capabilities;_[E]&&(_[E]=!1,this.t.disable(E))},enable(E){this.i();const _=this.states.capabilities;_[E]||(_[E]=!0,this.t.enable(E))},frontFace(E){this.i();const _=this.states.frontFace;_[0]!==E&&(_[0]=E,this.t.frontFace(E))},hint(E,_){this.i();const t=this.states.hint;t[E][0]!==_&&(t[E][0]=_,this.t.hint(E,_))},lineWidth(E){this.i();const _=this.states.lineWidth;_[0]!==E&&(_[0]=E,this.t.lineWidth(E))},pixelStorei(E,_){this.i();const t=this.states.pixelStorei;t[E]!==_&&(t[E]&&(t[E][0]=_),this.t.pixelStorei(E,_))},polygonOffset(E,_){this.i();const t=this.states.polygonOffset;t[0]===E&&t[1]===_||(t[0]=E,t[1]=_,this.t.polygonOffset(E,_))},sampleCoverage(E,_){this.i();const t=this.states.sampleCoverage;t[0]===E&&t[1]===_||(t[0]=E,t[1]=_,this.t.sampleCoverage(E,_))},stencilFunc(E,_,t){this.i();const R=this.states.stencilFuncSeparate,T=this.t;R[T.FRONT][0]===E&&R[T.FRONT][1]===_&&R[T.FRONT][2]===t&&R[T.BACK][0]===E&&R[T.BACK][1]===_&&R[T.BACK][2]===t||(R[T.FRONT][0]=R[T.BACK][0]=E,R[T.FRONT][1]=R[T.BACK][1]=_,R[T.FRONT][2]=R[T.BACK][2]=t,this.t.stencilFunc(E,_,t))},stencilFuncSeparate(E,_,t,R){if(this.i(),E===this.t.FRONT_AND_BACK)return void this.stencilFunc(_,t,R);const T=this.states.stencilFuncSeparate;T[E][0]===_&&T[E][1]===t&&T[E][2]===R||(T[E][0]=_,T[E][1]=t,T[E][2]=R,this.t.stencilFuncSeparate(E,_,t,R))},stencilMask(E){this.i();const _=this.t,t=this.states.stencilMaskSeparate;t[_.FRONT][0]===E&&t[_.BACK][0]===E||(t[_.FRONT][0]=E,t[_.BACK][0]=E,this.t.stencilMask(E))},stencilMaskSeparate(E,_){if(this.i(),E===this.t.FRONT_AND_BACK)return void this.stencilMask(_);const t=this.states.stencilMaskSeparate;t[E][0]!==_&&(t[E][0]=_,this.t.stencilMaskSeparate(E,_))},stencilOp(E,_,t){this.i();const R=this.states.stencilOpSeparate,T=this.t;R[T.FRONT][0]===E&&R[T.FRONT][1]===_&&R[T.FRONT][2]===t&&R[T.BACK][0]===E&&R[T.BACK][1]===_&&R[T.BACK][2]===t||(R[T.FRONT][0]=R[T.BACK][0]=E,R[T.FRONT][1]=R[T.BACK][1]=_,R[T.FRONT][2]=R[T.BACK][2]=t,this.t.stencilOp(E,_,t))},stencilOpSeparate(E,_,t,R){if(this.i(),E===this.t.FRONT_AND_BACK)return void this.stencilOp(_,t,R);const T=this.states.stencilOpSeparate;T[E][0]===_&&T[E][1]===t&&T[E][2]===R||(T[E][0]=_,T[E][1]=t,T[E][2]=R,this.t.stencilOpSeparate(E,_,t,R))},bindFramebuffer(E,_){this.i();const t=this.states.framebuffer;t[E]!==_&&(t[E]=_,this.t.bindFramebuffer(E,_))},bindRenderbuffer(E,_){this.i();const t=this.states.renderbuffer;t[E]!==_&&(t[E]=_,this.t.bindRenderbuffer(E,_))},bindTexture(E,_){this.i();const t=this.states.textures;t.units[-1!==t.active?t.active-33984:-1][E]=_,this.t.bindTexture(E,_)},activeTexture(E){this.i();const _=this.t,t=this.states.textures,R=t.active;t.active=E,this.activeUnit!==E&&(_.activeTexture(E),this.activeUnit=E),-1===R&&(t.units[E-33984][_.TEXTURE_2D]=t.units[-1][_.TEXTURE_2D],t.units[E-33984][_.TEXTURE_CUBE_MAP]=t.units[-1][_.TEXTURE_CUBE_MAP],t.units[-1][_.TEXTURE_2D]=null,t.units[-1][_.TEXTURE_CUBE_MAP]=null)},useProgram(E){this.i();const _=this.states;_.program!==E&&(_.program=E,this.t.useProgram(E))},bindBuffer(E,_){this.i();const t=this.t,R=this.states;E===t.ELEMENT_ARRAY_BUFFER?R.elementArrayBuffer=_:R.arrayBuffer=_,t.bindBuffer(E,_)},bindVertexArray(E){this.i();const _=this.t,t=this.states;t.vao!==E&&(t.vao=E,this._?_.bindVertexArray(E):this.vaoOES.bindVertexArrayOES(E))},vertexAttribPointer(E,_,t,R,T,A){this.i();const s=[E,_,t,R,T,A];this.states.attributes[E]||(this.states.attributes[E]={enable:!0});const e=this.states.attributes[E];return e.buffer=this.states.arrayBuffer,e.args=s,this.t.vertexAttribPointer(E,_,t,R,T,A)},vertexAttribDivisor(E,_){return this.i(),this.states.attributes[E].divisor=_,this._?this.t.vertexAttribDivisor(E,_):this.angleOES.vertexAttribDivisorANGLE(E,_)}},{i(){const E=this.t;if(E.S&&E.S!==this){this.O(E.S.states),E.S=this}E.S=this},O(_){if(!_)return;delete this.activeUnit;const t=this.states,R=this.t;for(const T in t)if("capabilities"!==T&&"textures"!==T&&"attributes"!==T&&"arrayBuffer"!==T&&"elementArrayBuffer"!==T&&"vao"!==T)if("program"===T)t.program!==_.program&&R.useProgram(t.program);else if("framebuffer"===T)for(const E in t[T])t[T][E]!==_[T][E]&&R.bindFramebuffer(+E,t[T][E]);else if("renderbuffer"===T)for(const E in t[T])t[T][E]!==_[T][E]&&R.bindRenderbuffer(+E,t[T][E]);else if(!fastDeepEqual(t[T],_[T]))if(Array.isArray(_[T]))R[T](...t[T]);else if(_[T])for(const A in t[T])fastDeepEqual(t[T][A],_[T][A])||R[T](+A,...t[T][A]);for(const E in t.capabilities)t.capabilities[E]!==_.capabilities[E]&&R[t.capabilities[E]?"enable":"disable"](+E);const T=t.textures,s=T.units,e=_.textures.units,r=T.active-R.TEXTURE0;for(let E=0;E<s.length;E++)E===r||s[E][R.TEXTURE_2D]===e[E][R.TEXTURE_2D]&&s[E][R.TEXTURE_CUBE_MAP]===e[E][R.TEXTURE_CUBE_MAP]||(R.activeTexture(R.TEXTURE0+E),R.bindTexture(R.TEXTURE_2D,s[E][R.TEXTURE_2D]),R.bindTexture(R.TEXTURE_CUBE_MAP,s[E][R.TEXTURE_CUBE_MAP]));if(T.active>-1){const E=s[r];E[R.TEXTURE_2D]===e[r][R.TEXTURE_2D]&&E[R.TEXTURE_CUBE_MAP]===e[r][R.TEXTURE_CUBE_MAP]||(R.activeTexture(T.active),R.bindTexture(R.TEXTURE_2D,E[R.TEXTURE_2D]),R.bindTexture(R.TEXTURE_CUBE_MAP,E[R.TEXTURE_CUBE_MAP]))}this._?R.bindVertexArray(null):this.A&&this.A.bindVertexArrayOES(null);const i=this.R,N=t.attributes;for(let E=0;E<i;E++){const _=N[E];_&&(_.buffer&&(R.bindBuffer(R.ARRAY_BUFFER,_.buffer),R.vertexAttribPointer(..._.args),void 0!==_.divisor&&(this._?R.vertexAttribDivisor(E,_.divisor):this.angleOES.vertexAttribDivisorANGLE(E,_.divisor))),_.enable?R.enableVertexAttribArray(E):R.disableVertexAttribArray(E))}R.bindBuffer(R.ARRAY_BUFFER,t.arrayBuffer),R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,t.elementArrayBuffer);const I=t.vao;I&&(this._?R.bindVertexArray(I||null):this.A&&this.A.bindVertexArrayOES(I||null))}}),t$1(i$3.prototype,{compressedTexImage2D(E,_,t,R,T,A,s){return this.i(),this.t.compressedTexImage2D(E,_,t,R,T,A,s)},copyTexImage2D(E,_,t,R,T,A,s,e){return this.i(),this.t.copyTexImage2D(E,_,t,R,T,A,s,e)},copyTexSubImage2D(E,_,t,R,T,A,s,e){return this.i(),this.t.copyTexSubImage2D(E,_,t,R,T,A,s,e)},createTexture(){return this.t.createTexture()},deleteTexture(E){const _=this.states.textures.units;for(let t=0;t<_.length;t++)for(const R in _[t])_[t][R]===E&&(_[t][R]=null);return this.t.deleteTexture(E)},generateMipmap(E){return this.i(),this.t.generateMipmap(E)},getTexParameter(E,_){return this.i(),this.t.getTexParameter(E,_)},isTexture(E){return this.t.isTexture(E)},texImage2D(...E){if(this.i(),this._){const _=E[E.length-2],t=e$2.getInternalFormat(this.t,E[2],_);t!==E[2]&&(E[2]=t);const R=e$2.getTextureType(this.t,_);R!==_&&(E[E.length-2]=R)}return this.t.texImage2D(...E)},texSubImage2D(E){if(this.i(),this._){const _=E[E.length-2],t=e$2.getTextureType(this.t,_);t!==_&&(E[E.length-2]=t)}return this.t.texSubImage2D(...E)},texParameterf(E,_,t){return this.i(),this.t.texParameterf(E,_,t)},texParameteri(E,_,t){return this.i(),this.t.texParameteri(E,_,t)}}),t$1(i$3.prototype,{bindAttribLocation(E,_,t){return this.t.bindAttribLocation(E,_,t)},enableVertexAttribArray(E){return this.i(),this.states.attributes[E]||(this.states.attributes[E]={}),this.states.attributes[E].enable=!0,this.t.enableVertexAttribArray(E)},disableVertexAttribArray(E){return this.i(),this.states.attributes[E]||(this.states.attributes[E]={}),this.states.attributes[E].enable=!1,this.t.disableVertexAttribArray(E)},getActiveAttrib(E,_){return this.t.getActiveAttrib(E,_)},getActiveUniform(E,_){return this.t.getActiveUniform(E,_)},getAttribLocation(E,_){return this.t.getAttribLocation(E,_)},getUniformLocation(E,_){return this.t.getUniformLocation(E,_)},getVertexAttrib(E,_){return this.i(),this.t.getVertexAttrib(E,_)},getVertexAttribOffset(E,_){return this.i(),this.t.getVertexAttribOffset(E,_)},uniformMatrix2fv(E,_,t){return this.i(),this.t.uniformMatrix2fv(E,_,t)},uniformMatrix3fv(E,_,t){return this.i(),this.t.uniformMatrix3fv(E,_,t)},uniformMatrix4fv(E,_,t){return this.i(),this.t.uniformMatrix4fv(E,_,t)},uniform1f(E,_){return this.i(),this.t.uniform1f(E,_)},uniform1fv(E,_){return this.i(),this.t.uniform1fv(E,_)},uniform1i(E,_){return this.i(),this.t.uniform1i(E,_)},uniform1iv(E,_){return this.i(),this.t.uniform1iv(E,_)},uniform2f(E,_,t){return this.i(),this.t.uniform2f(E,_,t)},uniform2fv(E,_){return this.i(),this.t.uniform2fv(E,_)},uniform2i(E,_,t){return this.i(),this.t.uniform2i(E,_,t)},uniform2iv(E,_){return this.i(),this.t.uniform2iv(E,_)},uniform3f(E,_,t,R){return this.i(),this.t.uniform3f(E,_,t,R)},uniform3fv(E,_){return this.i(),this.t.uniform3fv(E,_)},uniform3i(E,_,t,R){return this.i(),this.t.uniform3i(E,_,t,R)},uniform3iv(E,_){return this.i(),this.t.uniform3iv(E,_)},uniform4f(E,_,t,R,T){return this.i(),this.t.uniform4f(E,_,t,R,T)},uniform4fv(E,_){return this.i(),this.t.uniform4fv(E,_)},uniform4i(E,_,t,R,T){return this.i(),this.t.uniform4i(E,_,t,R,T)},uniform4iv(E,_){return this.i(),this.t.uniform4iv(E,_)},vertexAttrib1f(E,_){return this.i(),this.t.vertexAttrib1f(E,_)},vertexAttrib2f(E,_,t){return this.i(),this.t.vertexAttrib2f(E,_,t)},vertexAttrib3f(E,_,t,R){return this.i(),this.t.vertexAttrib3f(E,_,t,R)},vertexAttrib4f(E,_,t,R,T){return this.i(),this.t.vertexAttrib4f(E,_,t,R,T)},vertexAttrib1fv(E,_){return this.i(),this.t.vertexAttrib1fv(E,_)},vertexAttrib2fv(E,_){return this.i(),this.t.vertexAttrib2fv(E,_)},vertexAttrib3fv(E,_){return this.i(),this.t.vertexAttrib3fv(E,_)},vertexAttrib4fv(E,_){return this.i(),this.t.vertexAttrib4fv(E,_)}}),t$1(i$3.prototype,{createVertexArray(){return this._?this.t.createVertexArray():this.vaoOES.createVertexArrayOES()},deleteVertexArray(E){const _=this.states;return _.vao===E&&(_.vao=null),this._?this.t.deleteVertexArray(E):this.vaoOES.deleteVertexArrayOES(E)},isVertexArray(E){return this._?this.t.isVertexArray(E):this.vaoOES.isVertexArrayOES(E)}}),t$1(i$3.prototype,{drawArraysInstanced(E,_,t,R){return this.i(),this.N(),this._?this.t.drawArraysInstanced(E,_,t,R):this.angleOES.drawArraysInstancedANGLE(E,_,t,R)},drawElementsInstanced(E,_,t,R,T){return this.i(),this.N(),this._?this.t.drawElementsInstanced(E,_,t,R,T):this.angleOES.drawElementsInstancedANGLE(E,_,t,R,T)}});
/*!
	 * @maptalks/gl v0.74.0
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.com
	 */
const u$2="function"==typeof Object.assign;function f$4(t){if(u$2)Object.assign.apply(Object,arguments);else for(let i=1;i<arguments.length;i++){const s=arguments[i];for(const i in s)t[i]=s[i]}return t}const p$7=[];function m$5(t,i){const s=i._get2DExtentAtRes(i.getGLRes()),e=s.getWidth(),r=s.getHeight(),o=t;return identity$2(o),translate$1(o,o,i.cameraLookAt),scale$5(o,o,set$4(p$7,e,r,1)),o}const g$5=[0,0],_$6=[0,0,0];let w$7;class v$6{static getUniformDeclares(){const t=[],i=[];return i.push({name:"shadow_lightProjViewModelMatrix",type:"function",fn:function(i,s){return multiply$5(t,s.shadow_lightProjViewMatrix,s.modelMatrix)}}),i.push("shadow_shadowMap","shadow_opacity","esm_shadow_threshold","shadow_color","shadow_nearFar"),i}constructor(t,i,s){this.renderer=new k$7(t),this.sceneConfig=i,this.t=.3,this.i=s,this.s()}resize(){const t=this.canvas;t.width=this.i.getRenderer().canvas.width,t.height=this.i.getRenderer().canvas.height}s(){const t=this.sceneConfig.shadow||{};let i=512;const s=t.quality;"high"===s?i=2048:"medium"===s&&(i=1024);const e=this.getDefines();this.h=new Wn$3(this.renderer,{width:i,height:i,blurOffset:t.blurOffset,defines:e}),this.o=new qn$3(e),this.l()}getDefines(){return{HAS_SHADOWING:1,PACK_FLOAT:1,USE_ESM:1}}render(t,i,s,e,r,o,a,l,c,d){this.u();const u=this.i.getMap();let f,p;if(d||this.p(u,a,!!t)){this.m=this.m||[],this.g=this.g||[];const e=multiply$5(this.m,i,s),r=normalize$4(this.g,o);w$7||(w$7=u.getContainerExtent());let l=u.height;u.getPitch()>62&&(l=u._getVisualHeight(62));const c=w$7.set(0,u.height-l,u.width,u.height).convertTo((t=>u._containerPointToPointAtRes(t,u.getGLRes()))).toArray();t&&a.addMesh(this._);const d=c.map((t=>[t.x,t.y,0,1])),{lightProjViewMatrix:m,shadowMap:g,blurFBO:_}=this.h.render(a,{cameraProjViewMatrix:e,lightDir:r,farPlane:d,cameraLookAt:u.cameraLookAt});f=this.v=m,p=this.C=g,this.S=_,this.M=a.getMeshes().reduce(((t,i)=>(i.castShadow&&(t[i.uuid]={v0:i.version,v1:i.geometry.version}),t)),{}),this.T={count:a.getMeshes().length-+!!t,displayShadow:!!t},this.O=!0}else f=this.v,p=this.C,this.O=!1;return this.A=i,this.L=s,t&&a.getMeshes().length&&this.displayShadow(e,r,l,c),{shadow_lightProjViewMatrix:f,shadow_shadowMap:p,shadow_opacity:r,shadow_color:e,esm_shadow_threshold:this.t}}displayShadow(t,i,s,e){const n=this.v,r=this._,o=this.F||[],a=this.i.getRenderer().canvas,l=this.P=this.P||[];l[0]=a.width,l[1]=a.height,this.renderer.render(this.o,{halton:s||g$5,globalTexSize:l,projMatrix:this.A,viewMatrix:this.L,shadow_lightProjViewModelMatrix:multiply$5(o,n,r.localTransform),shadow_shadowMap:this.C,esm_shadow_threshold:this.t,shadow_opacity:i,color:t||_$6},this.R,e)}dispose(){this.h.dispose(),this.o.dispose(),this._&&(this._.geometry.dispose(),this._.dispose()),delete this.renderer}isUpdated(){return!1!==this.O}p(t,i,s){if(!this.M)return!0;const e=this.T;if(i.getMeshes().length!==e.count||s!==e.displayShadow)return!0;const h=i.getMeshes();for(let t=0;t<h.length;t++){const i=this.M[h[t].uuid];if(h[t].castShadow&&(h[t].hasSkinAnimation()||!i||i.v0!==h[t].version||i.v1!==h[t].geometry.version))return!0}return!1}l(){const t=new Xe$4;t.generateBuffers(this.renderer.regl),this._=new de$4(t),this.R=new pe$4([this._])}u(){const t=this.i.getMap(),i=m$5(this._.localTransform,t);this._.setLocalTransform(i)}}const{createIBLTextures:x$7,disposeIBLTextures:C$6,getPBRUniforms:b$7}=ur$4.PBRUtils,S$7=[0,0],M$6=[1,1];class y$5{static getGroundTransform(t,i){return m$5(t,i)}constructor(t,i){this.I=t,this.renderer=new k$7(t),this.i=i,this.D=new ve$4,this.G=this.H.bind(this),this.s()}needToRedraw(){const t=this.N();return t&&(t[0]||t[1])}getMap(){return this.i&&this.i.getMap()}getSymbol(){const t=this.i.getGroundConfig();return t&&t.symbol}isEnable(){const t=this.i.getGroundConfig();return t&&t.enable}paint(t){if(!this.isEnable())return!1;const i=this.B();if(this.j(t)&&i===this.V)return!1;const s=this.k(t);s&&this._.setDefines(s),this._.material!==this.material&&this._.setMaterial(this.material);const e=this.i.getGroundConfig();this._.ssr=(e&&e.symbol).ssr?1:0,this.u();const h=this.W(t);h.offsetFactor=t.offsetFactor,h.offsetUnits=t.offsetUnits;const n=t&&t.renderTarget&&t.renderTarget.fbo;return i===this.V?(this.renderer.render(i,h,this.R,n),this.i.getRenderer().setCanvasUpdated(),!0):(i.filter=t.sceneFilter,this.renderer.render(i,h,this.R,n),this.i.getRenderer().setCanvasUpdated(),!0)}j(t){return!!(this.i.getRenderer().isEnableSSR&&this.i.getRenderer().isEnableSSR()&&t&&t.ssr)}update(){const t=this.i.getGroundConfig();if(!t)return;const i=t&&t.symbol;if(i){this.U=this.Y(i.polygonFill||[1,1,1,1]),this.J=void 0===i.polygonOpacity?1:i.polygonOpacity;const t=i.polygonPatternFile;if(t){if(!this.X||this.X._pattern_src!==t){const i=new Image;i.onload=()=>{this.X&&this.X.destroy(),this.X=this.q(i),this.X._pattern_src=t},i.src=t}}else this.X&&(this.X.destroy(),delete this.X)}else this.U=[1,1,1,1],this.J=1,this.X&&(this.X.destroy(),delete this.X);this.$()}setToRedraw(){const t=this.i.getRenderer();t&&t.setToRedraw()}dispose(){this.material&&(this.material.dispose(),delete this.material),this._&&(this._.geometry.dispose(),this._.material&&this._.material.dispose(),this._.dispose(),delete this._),this.X&&(this.X.destroy(),delete this.X),this.V&&(this.V.dispose(),delete this.V),this.K&&(this.K.dispose(),delete this.K),this.Z(),this.tt&&(this.tt.destroy(),delete this.tt);const t=this.getMap();t&&t.off("updatelights",this.it,this)}B(){const t=this.i.getGroundConfig();if(!t||!t.renderPlugin)return this.V;const i=t.renderPlugin.type;if("lit"===i)return this.K;if("fill"===i)return this.V;throw new Error("unsupported render plugin of "+i+" for layer ground")}W(t){const i=this.st(t);return i.polygonFill=this.U,i.polygonOpacity=this.J,this.B()===this.V&&this.X&&(i.polygonPatternFile=this.X),i}st(t){let i;return"lit"===this.i.getGroundConfig().renderPlugin.type?(this.et||(this.et=x$7(this.I,this.getMap())),i=b$7(this.getMap(),this.et,this.tt,t&&t.ssr,t&&t.jitter)):i={projViewMatrix:this.getMap().projViewMatrix},this.ht(i,t),i}ht(t,i){const s=i&&i.includes;if(s)for(const e in s)s[e]&&i[e].renderUniforms&&f$4(t,i[e].renderUniforms)}Z(){this.et&&(C$6(this.et),delete this.et)}s(){this.getMap().on("updatelights",this.it,this);const t=this.nt(),i=v$6.getUniformDeclares(),s=[];i.push({name:"projViewModelMatrix",type:"function",fn:function(t,i){return multiply$5(s,i.projViewMatrix,i.modelMatrix)}}),this.V=new rt$6({vert:"attribute vec3 aPosition;\nuniform mat4 projViewModelMatrix;\nuniform mat4 modelMatrix;\n#ifdef HAS_PATTERN\n    attribute vec2 aTexCoord;\n    uniform vec2 uvScale;\n    uniform vec2 uvOffset;\n    varying vec2 vTexCoord;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_vert>\n#endif\nvoid main () {\n    #ifdef HAS_PATTERN\n        vTexCoord = aTexCoord * uvScale + uvOffset;\n    #endif\n    vec3 position = vec3(aPosition);\n    gl_Position = projViewModelMatrix * vec4(position, 1.0);\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        shadow_computeShadowPars(vec4(position, 1.0));\n    #endif\n}",frag:"precision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_frag>\n#endif\n#ifdef HAS_PATTERN\n    uniform sampler2D polygonPatternFile;\n    varying vec2 vTexCoord;\n#endif\nuniform vec4 polygonFill;\nuniform float polygonOpacity;\nvoid main() {\n    #ifdef HAS_PATTERN\n        vec4 color = texture2D(polygonPatternFile, vTexCoord);\n    #else\n        vec4 color = polygonFill;\n    #endif\n    gl_FragColor = color * polygonOpacity;\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        float shadowCoeff = shadow_computeShadow();\n        gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, shadowCoeff);\n    #endif\n}",uniforms:i,extraCommandProps:t});const e=v$6.getUniformDeclares();e.push(...Rt$4.getUniformDeclares()),this.K=new ur$4.StandardShader({uniforms:e,extraCommandProps:t}),this.l(),this.tt=ur$4.PBRHelper.generateDFGLUT(this.I),this.update()}nt(){const t=[0,1],i=this.i.getRenderer().canvas;return{viewport:{x:0,y:0,width:()=>i.width,height:()=>i.height},depth:{enable:!0,mask:()=>{const t=this.i.getGroundConfig();return t.depth||void 0===t.depth},range:()=>{const i=this.i.getGroundConfig(),s=i&&i.renderPlugin.sceneConfig;return s&&s.depthRange||t},func:"<="},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},polygonOffset:{enable:!0,offset:{factor:(t,i)=>i.offsetFactor,units:(t,i)=>i.offsetUnits}}}}rt(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}l(){const t=new Xe$4;t.data.aTexCoord=new Uint8Array([0,1,1,1,0,0,1,0]),t.createTangent(),t.generateBuffers(this.renderer.regl),this._=new de$4(t,null,{castShadow:!1});const i=this.K.getGeometryDefines(t);this._.setDefines(i),this.R=new pe$4([this._])}u(){const t=this.getMap(),i=y$5.getGroundTransform(this._.localTransform,t);this._.setLocalTransform(i);const s=t._get2DExtentAtRes(t.getGLRes()),e=s.getWidth(),h=s.getHeight(),n=t.cameraLookAt,r=n[0]-e,o=n[1]+h;let a=this.material&&this.material.get("uvOffset")||S$7;a[0]=a[0]||0,a[1]=a[1]||0;const l=this.N(),c=this.material&&this.material.get("noiseTexture"),d=l&&(l[0]||l[1]);if(d){a=[a[0],a[1]];const t=performance.now(),i=c?5e4:1e3,s=c?256:1;l[0]&&(a[0]=t*l[0]%i/i*s),l[1]&&(a[1]=t*l[1]%i/i*s)}const u=this.material&&this.material.get("uvScale")||M$6,f=.5/u[0],p=.5/u[1],m=s.getWidth()/f*2,g=s.getHeight()/p*2;if(this._.setUniform("uvScale",[m,-g]),d&&c){const t=[r-(l[0]?a[0]:0),o+(l[1]?a[1]:0)],i=t[0]/f%1,s=t[1]/p%1,e=[t[0]/f-i,t[1]/p-s];this._.setUniform("uvOffset",[i+(l[0]?0:a[0]),s+(l[1]?0:a[1])]),this._.setUniform("uvOrigin",e)}else{const t=r/f%1,i=o/p%1,s=[r/f-t,o/p-i];this._.setUniform("uvOffset",[t+a[0],i+a[1]]),this._.setUniform("uvOrigin",s)}}k(t){let i=!1;const s=this._.defines,e=this.i.ot&&this.i.ot(),h=this.i.getGroundConfig();function n(t,e){t?s[e]||(s[e]=1,i=!0):s[e]&&(delete s[e],i=!0)}n(this.rt(),"HAS_IBL_LIGHTING"),n(t&&t.ssr&&h&&h.symbol&&h.symbol.ssr,"HAS_SSR");const r=t&&e&&e.shadow&&e.shadow.enable;return n(r,"HAS_SHADOWING"),n(r,"USE_ESM"),n(!!this.X,"HAS_PATTERN"),n(t&&t.ssao,"HAS_SSAO"),i?s:null}$(){const t=this.getSymbol()&&this.getSymbol().material;if(!t)return;const i={};let s=!1;for(const n in t)if(h=n,Object.prototype.hasOwnProperty.call(t,h))if(n.indexOf("Texture")>0){let e=t[n];if(!e)continue;e="string"==typeof e?{url:e,wrap:"repeat"}:e,e.flipY=!0,e.min="linear",e.mag="linear",e.flipY=!0,i[n]=new je$4(e,this.D),s=!0}else i[n]=t[n];var h;this.material?(this.lt=new ur$4.StandardMaterial(i),this.lt.isReady()?this.H():this.lt.once("complete",this.G)):(this.material=new ur$4.StandardMaterial(i),this.material.once("complete",this.G,this)),s||this.H()}H(){this.lt&&(this.material.dispose(),this.material=this.lt,delete this.lt),this.setToRedraw(!0)}q(t){return this.I.texture({width:t.width,height:t.height,data:t,mag:"linear",min:"linear",flipY:!1,wrap:"repeat"})}it(t){if(t.ambientUpdate){this.Z();const t=this.getMap();t&&(this.et=x$7(this.I,t))}this.setToRedraw()}Y(t){return Array.isArray(t)?(3===t.length&&t.push(1),t):t}N(){return this.material&&this.material.get("uvOffsetAnim")}getRenderMeshes(){return this.R.getMeshes()}}const{createIBLTextures:T$6,disposeIBLTextures:O$7}=ur$4.PBRUtils,A$5=[0,0,0],E$6=[],L$7=[];class F$7{constructor(t,i){this.ct=4,this.I=t,this.renderer=new k$7(t),this.i=i,this.s(),this.dt()}paint(t){if(!this.isEnable()||!this.ut)return;const i=this.W(t);this.renderer.render(this.ft,i,null,t&&t.renderTarget&&t.renderTarget.fbo)}update(){const t=this.getMap();if(!t||!this.isEnable())return;const i=t.getLightManager(),s=i&&i.getAmbientResource();s!==this.ut&&this.et&&(O$7(this.et),delete this.et),this.ut=s,this.dt()}dispose(){this.ft.dispose(),O$7(this.et),delete this.ft,delete this.et,delete this.ut}getMap(){return this.i.getMap()}dt(){if(!this.ut)return;const t=this.i.ot();this.ft.setMode(1,0,t.environment&&t.environment.mode?1:0)}isEnable(){const t=this.i.ot();return this.rt()&&t&&t.environment&&t.environment.enable}rt(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}W(){const t=this.getMap(),i=this.getMap().getLightManager().getAmbientLight();let s=this.et;s||(s=this.et=T$6(this.I,t));const e=this.i.getRenderer().canvas,h=this.i.ot().environment||{},o=h.level||0,a=s.prefilterMap.width,l=this.pt=this.pt||[],d=h.brightness||0;return copy$4(E$6,i&&i.hsv||A$5),d&&(E$6[2]+=d),L$7[0]=e.width,L$7[1]=e.height,{rgbmRange:s.rgbmRange,cubeMap:s.prefilterMap,bias:o,size:a/Math.pow(2,Math.max(0,o-1)),environmentExposure:(u=i.exposure,"number"!=typeof u||isNaN(u)?1:i.exposure),diffuseSPH:s.sh,viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,resolution:L$7,hsv:E$6,transformMatrix:fromRotation$2(l,Math.PI/180*-i.orientation||0)};var u}s(){const t=this.getMap();if(t.on("updatelights",this.update,this),this.ft=new Lt$5,t.options.lights){const t=this.getMap().getLightManager().getAmbientResource();this.ut=t}}}const P$7=[],R$8=[.03,.03,.03],I$6=[],D$7=[],G$6=[],H$7=[1,1,1],N$8=[-1200,-1200,0],B$8=[1200,1200,1e3],j$5={min:[],max:[]},V$7=fromRotationTranslation$1([],fromEuler([],90,0,0),[0,0,0]);class k$6{constructor(t,i){this.I=t,this.renderer=new k$7(t),this.i=i,this.gt=new W$6,this.s()}getMap(){return this.i&&this.i.getMap()}s(){const t=this.i.getRenderer().canvas;this.ft=new rt$6({vert:"attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 viewModelMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform vec3 cameraPosition;\nuniform float top;\nuniform float bottom;\nuniform float time;\nvarying vec2 vTexCoord;\n#include <get_output>\nfloat angle(float x, float y){\n    return atan(y, x);\n}\nvec2 getFoot(vec2 camera, vec2 normal, vec2 pos) {\n    vec2 position = vec2(0.0, 0.0);\n    float distanceLen = distance(pos, normal);\n    float a = angle(camera.x - normal.x, camera.y - normal.y);\n    pos.x > normal.x ? a -= 0.785 : a += 0.785;\n    position.x = cos(a) * distanceLen;\n    position.y = sin(a) * distanceLen;\n    return position + normal;\n    return position;\n}\nvoid main()\n{\n    vec4 localPosition = getPosition(aPosition);\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec2 foot = getFoot(vec2(cameraPosition.x, cameraPosition.z), vec2(aNormal.x, aNormal.z), vec2(localPosition.x, localPosition.z));\n    float height = top - bottom;\n    float y = aNormal.y - bottom - height * time;\n    y = y + (y < 0.0 ? height : 0.0);\n    float ratio = (1.0 - y / height) * (1.0 - y / height);\n    y = height * (1.0 - ratio);\n    y += bottom;\n    y += aPosition.y - aNormal.y;\n    localPosition = vec4( foot.x, y, foot.y , 1.0);\n    gl_Position = projMatrix * viewModelMatrix * localPositionMatrix * localPosition;\n    vTexCoord = aTexCoord;\n}",frag:"precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D rainMap;\nvoid main() {\n    vec4 rainColor = texture2D(rainMap, vTexCoord);\n    vec4 diffuseColor = vec4(diffuse, opacity);\n    diffuseColor *= rainColor;\n    gl_FragColor = diffuseColor;\n}",uniforms:[{name:"viewModelMatrix",type:"function",fn:function(t,i){return multiply$5(P$7,i.viewMatrix,i.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height},depth:{enable:!0,mask:!1,func:"less",range:[0,1]},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}),this._t()}_t(){const t=this.I.texture({width:2,height:2});if(this.wt=this.vt(),!this.wt)return;this.xt=new pe$4(this.wt);const i=this.Ct();i.rainTexture?this.bt(i.rainTexture).then((t=>{this.wt.material.set("rainMap",t)})):(this.wt.material.set("rainMap",t),console.warn("should set rain texture."))}vt(){const t=this.getMap(),i=this.Ct();if(!i)return;this.St=t.getZoom();const s=this.Mt(),e=this.yt=i.density,h=this.Tt=i.rainWidth||1,n=this.Ot=i.rainHeight||1,r=[],o=[],a=[],l=[];for(let t=0;t<e;t++){const i={};i.x=Math.random()*(s.max[0]-s.min[0])+s.min[0],i.y=Math.random()*(s.max[2]-s.min[2])+s.min[2],i.z=Math.random()*(s.max[1]-s.min[1])+s.min[1];const e=(s.max[2]-s.min[2])/37.5*n,c=e/3*h;r.push(i.x+c,i.y+e,i.z,i.x-c,i.y+e,i.z,i.x-c,i.y,i.z,i.x+c,i.y,i.z),o.push(i.x,i.y-e/2,i.z,i.x,i.y-e/2,i.z,i.x,i.y-e/2,i.z,i.x,i.y-e/2,i.z),a.push(1,1,0,1,0,0,1,0),l.push(4*t+0,4*t+1,4*t+2,4*t+0,4*t+2,4*t+3)}const d={};d.POSITION=r,d.NORMAL=o,d.TEXCOORD_0=a;const u=new Z$7(d,l,0,{primitive:"triangles",positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});u.generateBuffers(this.renderer.regl);const f=new ee$3({rainMap:this.I.texture({width:2,height:2}),diffuse:i.color||[1,1,1],opacity:i.opacity||1}),p=new de$4(u,f);return p.setUniform("top",s.max[2]),p.setUniform("bottom",s.min[2]),this.At(p),p.transparent=!0,p}bt(t){const i=new Image;return i.src=this.Et=t,new Promise(((t,s)=>{i.onload=()=>{const s=this.I.texture({mag:"linear",min:"linear mipmap nearest",wrapS:"clamp",wrapT:"clamp",data:i});t(s)},i.onerror=t=>{s(t)}}))}paint(t){if(!this.xt)return;const i=this.Ct(),s={},e=this.getMap();s.projMatrix=e.projMatrix,s.viewMatrix=e.viewMatrix,s.cameraPosition=e.cameraPosition;const h=i.speed||1,n=this.gt.getElapsedTime()/(2/h)%1;s.time=n,this.wt.material.set("diffuse",i.color||H$7),this.wt.material.set("opacity",i.opacity||1),this.At(this.wt);this.renderer.render(this.ft,s,this.xt,t&&t.renderTarget&&t.renderTarget.fbo),this.i.getRenderer().setCanvasUpdated()}At(t){const i=this.getMap(),s=i.coordinateToPointAtRes(i.getCenter(),i.getGLRes());let e=i.getGLScale()/i.getGLScale(this.St);const r=set$4(D$7,e,e,e),a=multiply$4(r,R$8,r),l=identity$2(G$6),c=this.Ct(),d=i.getBearing();fromRotationTranslationScale(l,fromEuler(I$6,c.windDirectionX||0,c.windDirectionY||0,90-d),[s.x,s.y,0],a),multiply$5(l,l,V$7),t.setLocalTransform(l)}setToRedraw(){const t=this.i.getRenderer();t&&t.setToRedraw()}update(){const t=this.Ct();if(t){if(this.wt||this._t(),t.density!==this.yt||t.rainWidth!==this.Tt||t.rainHeight!==this.Ot){const t=this.wt.material.get("rainMap");this.wt.geometry.dispose(),this.wt.dispose(),this.xt.clear(),this.wt=this.vt(),this.wt.material.set("rainMap",t),this.xt.setMeshes(this.wt)}t.rainTexture!==this.Et&&this.bt().then((t=>{this.wt.material.set("rainMap",t)}))}}dispose(){this.wt&&(this.wt.geometry.dispose(),this.wt.material&&this.wt.material.dispose(),this.wt.dispose(),delete this.wt),this.ft&&(this.ft.dispose(),delete this.ft)}isEnable(){const t=this.Ct();return t&&t.enable}Ct(){const t=this.i.getWeatherConfig();return t&&t.rain}Mt(){const t=16.685648411389433-this.getMap().getZoom();return scale$4(j$5.min,N$8,Math.pow(2,t)),scale$4(j$5.max,B$8,Math.pow(2,t)),j$5}}class W$6{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let i=("undefined"==typeof performance?Date:performance).now();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}}}const U$6=[],z$5=[.03,.03,.03],Y$5=[],J$6=[],X$6=[],q$6=fromRotationTranslation$1([],fromEuler([],90,0,0),[0,0,0]);class $$6{constructor(t,i){this.I=t,this.i=i,this.s()}s(){const t=this.i.getRenderer().canvas;this.ft=new rt$6({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 viewModelMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\n#include <get_output>\nvoid main()\n{\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec4 localPosition = getPosition(aPosition);\n    gl_Position = projMatrix * viewModelMatrix * localPositionMatrix * localPosition;\n    vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n  #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n  #endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nprecision mediump float;\nuniform sampler2D perlinTexture;\nvarying vec2 vTexCoord;\nfloat lerp(float a, float b, float w) {\n    return a + w * (b - a);\n}\nvoid main() {\n    float snowIntense = texture2D(perlinTexture, vTexCoord).r;\n    vec3 fixedC = vec3(1.0, 1.0, 1.0);\n    float r = lerp(0.5, fixedC.x, snowIntense);\n    float g = lerp(0.5, fixedC.y, snowIntense);\n    float b = lerp(0.5, fixedC.z, snowIntense);\n    glFragColor = vec4(r, g, b, 1.0);\n    #if __VERSION__ == 100\n        gl_FragColor = glFragColor;\n    #endif\n}",uniforms:[{name:"viewModelMatrix",type:"function",fn:function(t,i){return multiply$5(U$6,i.viewMatrix,i.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height}}}),this.ft.version=300,this.xt=new pe$4,this.Lt=this.Ft(),this.xt.setMeshes(this.Lt),this.renderer=new k$7(this.I);const s=this.Pt();s&&(s.snowGroundTexture?this.Rt(s.snowGroundTexture):(this.It=this.I.texture({width:2,height:2}),console.warn("should set snow ground texture.")))}render(t){this.It&&this.Lt.material.set("perlinTexture",this.It);const i=this.i.getMap();this.Dt(i);this.renderer.render(this.ft,{projMatrix:i.projMatrix,viewMatrix:i.viewMatrix,cameraPosition:i.cameraPosition},this.xt,t&&t.renderTarget&&t.renderTarget.fbo),this.i.getRenderer().setCanvasUpdated()}Dt(t){const i=t.coordinateToPointAtRes(t.getCenter(),t.getGLRes());let s=t.getGLScale()/t.getGLScale(this.St);const e=set$4(J$6,s,s,s),r=multiply$4(e,z$5,e),a=identity$2(X$6);fromRotationTranslationScale(a,fromEuler(Y$5,0,0,0),[i.x,i.y,.005],r),multiply$5(a,a,q$6),this.Lt.setLocalTransform(a)}Rt(t){const i=new Image;i.onload=()=>{this.It=this.I.texture({mag:"linear",min:"linear mipmap nearest",wrapS:"repeat",wrapT:"repeat",data:i})},i.onerror=t=>{console.log(t)},i.src=this.Gt=t}Ft(){const t=this.i.getMap();this.St=t.getZoom();const i=16e3*Math.pow(2,16.685648411389433-this.St),e={};e.POSITION=[-i,0,-i,i,0,-i,-i,0,i,i,0,i],e.NORMAL=[0,1,0,0,1,0,0,1,0,0,1,0],e.TEXCOORD_0=[0,0,1,0,0,1,1,1];const h=new Z$7(e,[3,1,0,0,2,3],0,{positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});h.generateBuffers(this.I);const n=new ee$3({perlinTexture:this.I.texture({with:2,height:2})});return new de$4(h,n)}getMeshes(){return this.Lt}dispose(){this.Lt&&(this.Lt.geometry.dispose(),this.Lt.material&&this.Lt.material.dispose(),this.Lt.dispose(),delete this.Lt),this.ft&&(this.ft.dispose(),delete this.ft)}update(){const t=this.Pt();t&&t.snowGroundTexture===!this.Gt&&this.Rt(t.snowGroundTexture)}isEnable(){const t=this.Ct();return t&&t.enable}Pt(){const t=this.i.getWeatherConfig();return t&&t.snow}}const K$7=[];class Z$6{constructor(t,i,s){this.I=t,this.i=i,this.Ht=s,this.s()}s(){this.renderer=new k$7(this.I);const t=this.i.getRenderer(),i=this.Nt={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.Bt=i.width,this.jt=i.height,this.Vt=this.I.framebuffer({color:this.I.texture({width:t.canvas?t.canvas.width:1,height:t.canvas?t.canvas.height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.EMPTY_TEXTURE=this.I.texture({with:2,height:2}),this.kt=new k$6(this.I,this.i),this.Wt=new Jt$4(this.I,i),this.Ut=new $$6(this.I,this.i),this.zt=new Gt$4(this.I,i),this.Yt=new Ut$4,this.Yt.version=300}getMap(){return this.i&&this.i.getMap()}renderScene(t){this.renderSnowMask(t),this.renderRain(t)}renderRain(t){this.isEnableRain()&&this.kt.paint(t)}renderSnowMask(t){if(!this.isEnableSnow())return;const i=this.getMap();this.Ut.render(t,i)}paint(t,i){if(!i||!i.length)return t;this.Jt();const s=this.i.getWeatherConfig(),e={};if(this.isEnableRain()?(e.ripplesMap=this.Xt(),this.Yt.shaderDefines.HAS_RAIN=1):delete this.Yt.shaderDefines.HAS_RAIN,this.isEnableSnow()?(this.Yt.shaderDefines.HAS_SNOW=1,i.forEach((t=>{t.defines.HAS_SNOW=1}))):(delete this.Yt.shaderDefines.HAS_SNOW,i.forEach((t=>{delete t.defines.HAS_SNOW}))),this.isEnableFog()){e.fogColor=s.fog.color||[.9,.9,.9],this.Yt.shaderDefines.HAS_FOG=1}else delete this.Yt.shaderDefines.HAS_FOG;return this.Yt.setDefines(this.Yt.shaderDefines),e.mixFactorMap=this.qt(i)||this.EMPTY_TEXTURE,e.sceneMap=t,e.time=this.$t()/1e3,e.resolution=set(K$7,this.Vt.width,this.Vt.height),this.renderer.render(this.Yt,e,null,this.Vt),this.Vt}qt(t){const i={},s=this.getMap(),e=s.getZoom(),h=Math.pow(2,16.685648411389433-e),n=this.i.getWeatherConfig().fog;if(!n)return;const r=n.start||.1,o=n.end||100;return i.projMatrix=s.projMatrix,i.viewMatrix=s.viewMatrix,i.cameraPosition=s.cameraPosition,i.fogDist=[r*h,o*h],this.zt.render(t,i)}Xt(){const t=this.getMap(),i=this.i.getWeatherConfig().rain.rippleRadius||24,s={};return s.projMatrix=t.projMatrix,s.viewMatrix=t.viewMatrix,s.time=this.$t()/1e3,s.rippleRadius=i,this.Wt.render(t,s)}$t(){return this.i?this.i.getRenderer().getFrameTime():0}isEnable(){const t=this.i.getWeatherConfig();return t&&t.enable}isEnableRain(){const t=this.i.getWeatherConfig();return t&&t.enable&&t.rain&&t.rain.enable}isEnableFog(){const t=this.i.getWeatherConfig();return t&&t.enable&&t.fog&&t.fog.enable}isEnableSnow(){const t=this.i.getWeatherConfig();return t&&t.enable&&t.snow&&t.snow.enable}update(){this.isEnableRain()&&(this.kt=this.kt||new k$6(this.I,this.i),this.kt.update()),this.isEnableSnow()&&(this.Ut=this.Ut||new $$6(this.I,this.i),this.Ut.update())}getShadowMeshes(){return this.Ut.getMeshes()}Jt(){const t=this.Bt(),i=this.jt();!this.Vt||this.Vt.width===t&&this.Vt.height===i||this.Vt.resize(t,i)}dispose(){this.Vt&&this.Vt.destroy(),this.Yt&&(this.Yt.dispose(),delete this.Yt),this.kt&&(this.kt.dispose(),delete this.kt),this.Ut&&(this.Ut.dispose(),delete this.Ut)}}const Q$6=[],tt$5=t=>!!t.bloom,it$5=t=>!!t.ssr;class st$5{constructor(t,i,s){this.I=t,this.i=i,this.Kt=new k$7(t),this.Zt=new mt$6,this.Qt=new St$5(this.Kt,s),this.ti=new zt$4,this.ii=new Rt$4(this.I)}setContextIncludes(){}bloom(t,i,s,e,h,n,r){this.si||(this.si=new wt$5(this.I));const o=this.i.getRenderer().ei(this.hi);return this.si.render(t,o,e,h,n,i,s,r)}drawBloom(t){const i=this.i.getRenderer(),s=this.I,e=this.hi;if(e){const{width:t,height:h}=i.canvas;e.width===t&&e.height===h||e.resize(t,h),s.clear({color:[0,0,0,0],framebuffer:e})}else{const i=this.ni(t);this.hi=s.framebuffer(i)}const h=i.getFrameTime(),n=i.getFrameEvent(),r=i.getFrameContext(),o=r.renderMode,a=r.sceneFilter,l=r.renderTarget;r.renderMode="default",r.sceneFilter=tt$5,r.renderTarget={fbo:this.hi,getFramebuffer:et$5,getDepthTexture:ht$5};const c=i.glCtx;return c.resetDrawCalls(),i.forEachRenderer(n?t=>{i.clearStencil(t,e),t.drawOnInteracting(n,h,r)}:t=>{i.clearStencil(t,e),t.draw(h,r)}),r.renderMode=o,r.sceneFilter=a,r.renderTarget=l,c.getDrawCalls()}genSsrMipmap(t,i){const s=this.i.getMap().projViewMatrix;this.ii.genMipMap(t,i,s)}getPrevSsrProjViewMatrix(){return this.ii&&this.ii.getPrevProjViewMatrix()}drawSSR(t,i,s){s&&this.ii.copyDepthTex(t);const e=this.i.getRenderer(),h=e.getFrameTime(),n=e.getFrameEvent(),r=e.getFrameContext();r.ssr=this.getSSRContext();const o=r.renderMode,a=r.sceneFilter;r.renderMode="default",r.sceneFilter=it$5,r.renderTarget.fbo=i;const l=e.glCtx;let c=!1;e.forEachRenderer(n?t=>{e.clearStencil(t,i),c||(l.resetDrawCalls(),c=!0),t.drawOnInteracting(n,h,r)}:t=>{e.clearStencil(t,i),c||(l.resetDrawCalls(),c=!0),t.draw(h,r)});const d=e.drawGround();return delete r.ssr,r.renderMode=o,r.sceneFilter=a,this.ri=l.getDrawCalls()>0,d}getSSRUniforms(){const t=this.i.ot(),i=t&&t.postProcess,s=this.i.getMap();return this.ii.getSSRUniforms(s,i.ssr.factor,i.ssr.quality)}getSSRContext(){const t=this.i.ot(),i=t&&t.postProcess,s=this.i.getMap(),e=this.ii.getSSRUniforms(s,i.ssr.factor,i.ssr.quality);return e?{renderUniforms:e,defines:{HAS_SSR:1}}:null}taa(t,i,{projMatrix:s,needClear:e}){const h=this.Qt;return{outputTex:h.render(t,i,s,e),redraw:h.needToRedraw()}}isTaaNeedRedraw(){return this.Qt.needToRedraw()}ssao(t,i,s){return this.oi||(this.oi=new xt$5(this.Kt),this.i.getRenderer().setToRedraw()),this.oi.render({projMatrix:s.projMatrix,cameraNear:s.cameraNear,cameraFar:s.cameraFar,bias:s.ssaoBias,radius:s.ssaoRadius,intensity:s.ssaoIntensity,quality:.6},t,i)}fxaa(t,i,s,e,h,n,r,o,l,c,d,u,f,p,m,g){!t||t.width===i.fbo&&t.height===i.height||t.resize(i.width,i.height);const _={};h?_.HAS_TAA_TEX=1:delete _.HAS_TAA_TEX,n?_.HAS_FXAA_TEX=1:delete _.HAS_FXAA_TEX,u?_.HAS_OUTLINE_TEX=1:delete _.HAS_OUTLINE_TEX,s?_.HAS_NOAA_TEX=1:delete _.HAS_NOAA_TEX,e?_.HAS_POINT_TEX=1:delete _.HAS_POINT_TEX,this.Zt.setDefines(_),this.Kt.render(this.Zt,{textureSource:i,noAaTextureSource:s,pointTextureSource:e,taaTextureSource:h,fxaaTextureSource:n,resolution:set(Q$6,i.width,i.height),enableFXAA:r,enableToneMapping:o,enableSharpen:l,pixelRatio:c,sharpFactor:d,textureOutline:u,highlightFactor:f,outlineFactor:p,outlineWidth:m,outlineColor:g},null,t)}renderFBOToScreen(t,i,s,e){this.ai||(this.ai=[]),this.ai[0]=t.width,this.ai[1]=t.height;const h=this.i.getRenderer();this.Kt.render(this.ti,{texture:t.color&&h.ei(t)||t,size:this.ai,enableSharpen:+!!i,sharpFactor:s,pixelRatio:e})}postprocess(t,i,s){this.li||(this.li=new yt$5);const e=this.i.getRenderer(),h=s||e.ei(t);return i.resolution=set(Q$6,h.width,h.height),i.textureSource=h,i.timeGrain=performance.now(),this.Kt.render(this.li,i),this.ci}dispose(){this.hi&&(this.hi.destroy(),delete this.hi),this.Qt&&(this.Qt.dispose(),delete this.Qt),this.oi&&(this.oi.dispose(),delete this.oi),this.si&&(this.si.dispose(),delete this.si),this.li&&(this.li.dispose(),delete this.li),this.Zt&&(this.Zt.dispose(),delete this.Zt),this.ti&&(this.ti.dispose(),delete this.ti)}ni(t,i){const{width:s,height:e}=this.i.getRenderer().canvas,h=this.I;let n;n=this.i.getRenderer().di()?h.renderbuffer({width:s,height:e,samples:this.i.options.multiSamples,format:"rgba8"}):h.texture({min:"nearest",mag:"nearest",format:i||"rgba",width:s,height:e});const r={width:s,height:e,colors:[n]};return t&&(r.depthStencil=t),r}}function et$5(t){return t._framebuffer.framebuffer}function ht$5(t){return t.depthStencil._texture.texture}class nt$5 extends ht$6{constructor(t){super({vert:"#if __VERSION__ == 300\n\t#define attribute in\n\t#define varying out\n#endif\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main()\n{\n  gl_Position = vec4(aPosition, 0., 1.);\n  vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n  #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n  #endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#ifdef HAS_FLOODANALYSE\n    uniform vec3 flood_waterColor;\n    uniform sampler2D floodMap;\n#endif\n#ifdef HAS_SKYLINE\n    uniform sampler2D skylineMap;\n#endif\n#ifdef HAS_VIEWSHED\n    uniform vec4 viewshed_visibleColor;\n    uniform vec4 viewshed_invisibleColor;\n    uniform sampler2D viewshedMap;\n#endif\n#ifdef HAS_INSIGHT\n    uniform vec4 insight_visibleColor;\n    uniform vec4 insight_invisibleColor;\n    uniform sampler2D insightMap;\n#endif\n#ifdef HAS_CUT\n    uniform sampler2D meshesMap;\n    uniform sampler2D invisibleMap;\n#endif\n#ifdef HAS_EXCAVATE\n    uniform sampler2D excavateMap;\n#endif\n#ifdef HAS_CROSSCUT\n    uniform sampler2D crosscutMap;\n    uniform vec4 cutLineColor;\n#endif\nuniform sampler2D sceneMap;\nvoid main() {\n    vec4 sceneColor = texture2D(sceneMap, vTexCoord);\n    glFragColor = sceneColor;\n    #ifdef HAS_VIEWSHED\n        vec4 viewshedColor = texture2D(viewshedMap, vTexCoord);\n        if (viewshedColor.r > 0.99) {\n            glFragColor = vec4(mix(viewshed_invisibleColor.rgb, sceneColor.rgb, 0.3), sceneColor.a);\n        } else if (viewshedColor.g > 0.99) {\n            glFragColor = vec4(mix(viewshed_visibleColor.rgb, sceneColor.rgb, 0.3), sceneColor.a);\n        } else if (viewshedColor.a < 0.01) {\n            glFragColor = vec4(viewshedColor.rgb, 1.0);\n        }\n    #endif\n    #ifdef HAS_FLOODANALYSE\n        vec4 floodColor = texture2D(floodMap, vTexCoord);\n        if (floodColor.r > 0.0) {\n            glFragColor = vec4(mix(flood_waterColor, glFragColor.rgb, 0.6), glFragColor.a);\n        }\n    #endif\n    #ifdef HAS_SKYLINE\n        vec4 skylineColor = texture2D(skylineMap, vTexCoord);\n        if (skylineColor.r > 0.0 || skylineColor.g > 0.0 || skylineColor.b > 0.0) {\n            glFragColor = skylineColor;\n        }\n    #endif\n    #ifdef HAS_INSIGHT\n        vec4 insightColor = texture2D(insightMap, vTexCoord);\n        if (insightColor.g > 0.0) {\n            glFragColor = insight_visibleColor;\n        } else if (insightColor.r > 0.0) {\n            glFragColor = insight_invisibleColor;\n        }\n    #endif\n    #ifdef HAS_CUT\n        vec4 cutColor = texture2D(invisibleMap, vTexCoord);\n        vec4 meshesMapColor = texture2D(meshesMap, vTexCoord);\n        if (cutColor.r == 1.0 && cutColor.g == 0.0 && cutColor.b == 0.0) {\n            glFragColor = meshesMapColor;\n        } else if (cutColor.r == 0.0 && cutColor.g == 1.0 && cutColor.b == 0.0) {\n            glFragColor = meshesMapColor;\n        } else if (cutColor.r == 0.0 && cutColor.g == 0.0 && cutColor.b == 1.0) {\n          glFragColor = sceneColor;\n        }\n    #endif\n    #ifdef HAS_EXCAVATE\n        vec4 excavateColor = texture2D(excavateMap, vTexCoord);\n        if (excavateColor.r == 1.0 && excavateColor.g == 0.0 && excavateColor.b == 0.0) {\n          glFragColor = sceneColor;\n        }  else {\n          glFragColor = excavateColor;\n        }\n    #endif\n    #ifdef HAS_CROSSCUT\n        vec4 crosscutColor = texture2D(crosscutMap, vTexCoord);\n        if (crosscutColor.r > 0.0) {\n            glFragColor = vec4(mix(cutLineColor.rgb, glFragColor.rgb, 0.99), glFragColor.a);\n        }\n    #endif\n    #if __VERSION__ == 100\n        gl_FragColor = glFragColor;\n    #endif\n}",extraCommandProps:{viewport:t},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}})}}class rt$5{constructor(t,i,s){this.I=t,this.i=i,this.Ht=s,this.s()}s(){this.renderer=new k$7(this.I);const t=this.i.getRenderer(),i=this.Nt={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.Vt=this.I.framebuffer({color:this.I.texture({width:t.canvas?t.canvas.width:1,height:t.canvas?t.canvas.height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.ft=new nt$5(i)}getMap(){return this.i&&this.i.getMap()}paint(t,i){if(!i&&i.length)return t;this.Jt();const s={},e=this.i.ui;if(!this.fi())return t;delete this.ft.shaderDefines.HAS_FLOODANALYSE,delete this.ft.shaderDefines.HAS_VIEWSHED,delete this.ft.shaderDefines.HAS_SKYLINE,delete this.ft.shaderDefines.HAS_INSIGHT,delete this.ft.shaderDefines.HAS_CUT,delete this.ft.shaderDefines.HAS_EXCAVATE,delete this.ft.shaderDefines.HAS_CROSSCUT;for(let t=0;t<e.length;t++){const h=e[t],n=h.getDefines();f$4(this.ft.shaderDefines,n);const r=this.getMap(),o=r.width,a=r.height,l=this.pi(i,h.getExcludeLayers());if(!h.isEnable())continue;const c=h.renderAnalysis(l,o,a);c&&f$4(s,c)}return s.sceneMap=t,this.ft.setDefines(this.ft.shaderDefines),this.renderer.render(this.ft,s,null,this.Vt),this.Vt}pi(t,i){const s=t.filter((t=>i.indexOf(t.getId())<0));let e=[];for(let t=0;t<s.length;t++){const i=s[t].getRenderer();if(i&&i.getAnalysisMeshes){const t=i.getAnalysisMeshes();e=e.concat(t)}}return e}Jt(){const t=t$2.Util.isFunction(this.Nt.width.data)?this.Nt.width.data():this.Nt.width,s=t$2.Util.isFunction(this.Nt.height.data)?this.Nt.height.data():this.Nt.height;!this.Vt||this.Vt.width===t&&this.Vt.height===s||this.Vt.resize(t,s)}fi(){const t=this.i&&this.i.ui;if(!t)return!1;for(let i=0;i<t.length;i++)if(t[i].isEnable())return!0;return!1}}const ot$5=[0,0,0,0],at$5=[0,0],lt$5=t=>!t.bloom&&!t.ssr,ct$5=t=>!t.bloom,dt$5=t=>!t.ssr;function ft$5(t){return"number"==typeof t&&!isNaN(t)}function pt$5(t){return t._framebuffer.framebuffer}function mt$5(t){return t.depthStencil._texture.texture}function gt$5(t,i,s){return null==t[i]?s:t[i]}class _t$4 extends t__namespace.Layer{static fromJSON(i){if(!i||"GroupGLLayer"!==i.type)return null;const s=i.layers.map((i=>t__namespace.Layer.fromJSON(i)));return new _t$4(i.id,s,i.options)}constructor(t,i,s){super(t,s),this.layers=i||[],this.layers.forEach((t=>{if(t.getMap())throw new Error(`layer(${t.getId()} is already added on map`)})),this.bs(),this.sortLayersByZIndex(),this.Ss={}}sortLayersByZIndex(){if(this.layers&&this.layers.length){for(let t=0,i=this.layers.length;t<i;t++)this.layers[t].Ms=t;this.layers.sort(vt$4)}}setSceneConfig(t){this.options.sceneConfig=t;const i=this.getRenderer();return i&&i.updateSceneConfig(),this}getSceneConfig(){return JSON.parse(JSON.stringify(this.options.sceneConfig||{}))}ot(){return this.options.sceneConfig}getGroundConfig(){const t=this.ot();return t?t.ground:null}getWeatherConfig(){const t=this.ot();return t&&t.weather}addLayer(t,i){if(t.getMap())throw new Error(`layer(${t.getId()} is already added on map`);void 0===i?this.layers.push(t):this.layers.splice(i,0,t),this.bs(),this.sortLayersByZIndex();const s=this.getRenderer();return s?(this.ys(t),s.setToRedraw(),this):this}removeLayer(i){t__namespace.Util.isString(i)&&(i=this.getChildLayer(i));const s=this.layers.indexOf(i);if(s<0)return this;i._doRemove(),i.off("show hide",this.Ts,this),i.off("idchange",this.Os,this),delete this.Ss[i.getId()],this.layers.splice(s,1);const e=this.getRenderer();return e?(e.setToRedraw(),this):this}Ci(){let t=0;for(let i=0;i<this.layers.length;i++)this.layers[i].setPolygonOffset&&this.layers[i].getPolygonOffsetCount&&(t+=this.layers[i].getPolygonOffsetCount());let i=0;for(let s=0;s<this.layers.length;s++)this.layers[s].setPolygonOffset&&this.layers[s].getPolygonOffsetCount&&(this.layers[s].setPolygonOffset(i,t),i+=this.layers[s].getPolygonOffsetCount())}getLayers(){return this.layers}toJSON(){const t=[];if(this.layers)for(let i=0;i<this.layers.length;i++){const s=this.layers[i];s&&s&&s.toJSON&&t.push(s.toJSON())}return{type:this.getJSONType(),id:this.getId(),layers:t,options:this.config()}}onLoadEnd(){this.layers.forEach((t=>{this.ys(t)})),super.onLoadEnd()}ys(t){const i=this.getMap();this.Ss[t.getId()]=t,t._canvas=this.getRenderer().canvas,t._bindMap(i),t.once("renderercreate",this.As,this),t.once("remove",(t=>{this.removeLayer(t.target)})),t.load(),this.Es(t)}onRemove(){this.layers.forEach((t=>{t._doRemove(),t.off("show hide",this.Ts,this),t.off("idchange",this.Os,this)})),this.Ss={},this.clearAnalysis(),super.onRemove()}getChildLayer(t){return this.Ss[t]||null}getLayer(t){return this.getChildLayer(t)}Es(t){t.on("show hide",this.Ts,this),t.on("idchange",this.Os,this)}Ts(){const t=this.getRenderer();t&&t.setToRedraw()}Os(t){const i=t.new,s=t.old,e=this.getLayer(s);delete this.Ss[s],this.Ss[i]=e}As(t){t.renderer.clearCanvas=wt$4}bs(){const t={};this.layers.forEach((i=>{const s=i.getId();if(t[s])throw new Error(`Duplicate child layer id (${s}) in the GroupGLLayer (${this.getId()})`);t[s]=1}))}addAnalysis(t){this.ui=this.ui||[],this.ui.push(t);const i=this.getRenderer();i&&i.setToRedraw()}removeAnalysis(t){if(this.ui){const i=this.ui.indexOf(t);i>-1&&(this.ui.splice(i,1),t.remove())}const i=this.getRenderer();i&&i.setToRedraw()}clearAnalysis(){this.ui&&(this.ui.forEach((t=>{t.remove()})),this.ui=[]);const t=this.getRenderer();t&&t.setToRedraw()}identify(i,s={}){const e=this.getMap(),h=this.getRenderer();if(!e||!h)return[];const n=e.coordToContainerPoint(new t__namespace.Coordinate(i));return this.identifyAtPoint(n,s)}identifyAtPoint(t,i={}){const s=i.includeInternals,e=this.getLayers(),h=i&&i.childLayers||e,r=this.getMap();if(!r)return[];const o=null==i.count?1:i.count;let a=[];for(let n=h.length-1;n>=0;n--){const r=h[n];if(e.indexOf(r)<0||!r.identifyAtPoint)continue;const o=r.options.geometryEvents;if(s&&(!1===o||0===o))continue;let l=r.identifyAtPoint(t,i);l&&l.length&&(i.filter&&(l=l.filter((t=>i.filter(t)))),l.length&&a.push(...l))}if(i.orderByCamera){const t=r.cameraPosition;a.sort(((i,s)=>s.point?i.point?dist$2(i.point,t)-dist$2(s.point,t):1:-1))}return o&&(a=a.slice(0,o)),a}}function wt$4(){}function vt$4(t,i){const s=t.getZIndex()-i.getZIndex();return 0===s?t.Ms-i.Ms:s}_t$4.mergeOptions({renderer:"gl",antialias:!0,extensions:[],onlyWebGL1:!1,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb"],forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,viewMoveThreshold:100,geometryEvents:!0,multiSamples:4}),_t$4.registerJSONType("GroupGLLayer"),_t$4.registerRenderer("gl",class extends t__namespace.renderer.CanvasRenderer{setToRedraw(){this.setRetireFrames(),super.setToRedraw()}onAdd(){super.onAdd(),this.prepareCanvas()}updateSceneConfig(){this.mi&&this.mi.update(),this.gi&&this.gi.update(),this._i&&this._i.update(),this.setToRedraw()}render(...t){this.getMap()&&this.layer.isVisible()&&(this.forEachRenderer((t=>{t._replacedDrawFn||(t.draw=this.wi(t.draw),t.drawOnInteracting=this.vi(t.drawOnInteracting),t.setToRedraw=this.xi(t.setToRedraw),t._replacedDrawFn=!0)})),this.prepareRender(),this.prepareCanvas(),this.layer.Ci(),this._toRedraw=!1,this.bi("render",t),this.Si(),this.Mi())}prepareCanvas(){super.prepareCanvas(),this.forEachRenderer((t=>{t.prepareCanvas()}))}drawOnInteracting(...t){this.getMap()&&this.layer.isVisible()&&(this.layer.Ci(),this._toRedraw=!1,this.bi("drawOnInteracting",t),this.Si(),this.Mi())}bi(t,i){this.yi="default";const s=this.hasRenderTarget(),e=this.Ti(i);if(s&&(this.Oi.renderTarget=this.Ai()),this.gi.paint(e),this.drawGround(!0),!s)return void this.Ei("default",null,t,i,!0);const h=this.glCtx,n=this.layer.ot(),r=n&&n.postProcess,o=this.isSSROn(),a=this.isEnableTAA(),l=e.jitter;if(e.jitter=at$5,h.resetDrawCalls(),this.Ei(a?"fxaaBeforeTaa":"fxaa",this.Li,t,i),this.Fi=h.getDrawCalls(),o&&this.Pi.drawSSR(this.Ri(),this.Li),a){const s=this.getMap(),n=this.Pi.isTaaNeedRedraw()||this.Ii||s.getRenderer().isViewChanged();e.jitter=n?l:this.Di.getAverage(),e.onlyUpdateDepthInTaa=!n;let o=this.Gi;if(o)o.width===this.Li.width&&o.height===this.Li.height||o.resize(this.Li.width,this.Li.height);else{const t=this.regl,i=this.ni(r,this.Hi);o=this.Gi=t.framebuffer(i)}h.resetDrawCalls(),this.Ei("taa",o,t,i),this.Ni=h.getDrawCalls(),delete e.onlyUpdateDepthInTaa,e.jitter=at$5;let a=this.Bi;if(a)a.width===this.Li.width&&a.height===this.Li.height||a.resize(this.Li.width,this.Li.height);else{const t=this.regl,i=this.ni(r,this.Hi);a=this.Bi=t.framebuffer(i)}h.resetDrawCalls(),this.Ei("fxaaAfterTaa",this.Bi,t,i),this.ji=h.getDrawCalls()}else this.Gi&&(this.Gi.destroy(),this.Bi.destroy(),delete this.Gi,delete this.Bi,delete this.ji);r.bloom&&r.bloom.enable&&(this.Vi=this.Pi.drawBloom(this.Hi)),2===o&&this.Pi.drawSSR(this.Ri(),this.Li,!0),h.resetDrawCalls(),this.Ei("noAa",this.ki,t,i),this.Wi=h.getDrawCalls(),h.resetDrawCalls(),this.Ei("point",this.Ui,t,i,!0),this._i.renderScene(e),this.zi=h.getDrawCalls()}Ei(t,i,s,e,h){this.yi=t;const n=this.Ti(e);n.renderMode=this.yi,n.renderTarget&&(n.renderTarget.fbo=i),h&&(n.isFinalRender=!0),this.forEachRenderer(((h,n)=>{n.isVisible()&&("default"===t||!h.supportRenderMode&&("fxaa"===t||"fxaaAfterTaa"===t)||h.supportRenderMode&&h.supportRenderMode(t))&&(this.clearStencil(h,i),h[s].apply(h,e))}))}Ti(t){let i=t[0];return ft$5(i)||(i=t[1]),i!==this.Yi&&(this.forEachRenderer(((t,i)=>{i.isVisible()&&t.needRetireFrames&&t.needRetireFrames()&&this.setRetireFrames()})),this.Oi=this.Ji(i),this.Yi=i,this.Xi=ft$5(t[0])?null:t[0]),this.Oi}Si(){if(!this.isEnableOutline())return;const t=this.qi(),i=this.glCtx;i.resetDrawCalls(),this.forEachRenderer(((i,s)=>{s.isVisible()&&i.drawOutline&&i.drawOutline(t)})),this.$i=i.getDrawCalls()}qi(){const{width:t,height:i}=this.canvas;let s=this.Ki;if(s)t===s.width&&i===s.height||s.resize(t,i);else{const e=this.regl.texture({width:t,height:i,format:"rgba4"});s=this.Ki=this.regl.framebuffer({width:t,height:i,colors:[e],depth:!1,stencil:!1})}return s}ei(t){if(this.di()){const i=this.Zi(t);return i.width!==t.width||i.height!==t.height?i.resize(t.width,t.height):this.regl.clear({color:[0,0,0,0],fbo:i}),i.blit(t),i.color[0]}return t.color[0]}Ri(){if(this.Hi.subimage)return this.Hi;const{width:t,height:i}=this.Hi;if(!this.Qi){const s=this.regl,e={depthStencil:s.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"depth stencil",width:t,height:i,format:"depth stencil"}),colors:[s.renderbuffer({width:t,height:i,format:"rgba4"})],colorFormat:"rgba4",width:t,height:i};this.Qi=s.framebuffer(e)}return this.Qi.width===t&&this.Qi.height===i||this.Qi.resize(t,i),this.regl.clear({color:[0,0,0,0],depth:1,fbo:this.Qi}),this.Qi.blit(this.Li,256,"nearest"),this.Qi.depthStencil}Zi(t){if(this.ts||(this.ts=[]),!t.ss){const i=this.es(!0),s=this.regl.framebuffer(i);this.ts.push(s),t.ss=s}return t.ss}di(){return 0===this.regl.limits.version.indexOf("WebGL 2.0")&&this.layer.options.antialias}hasRenderTarget(){const t=this.layer.ot(),i=t&&t.postProcess;return!(!i||!i.enable)}testIfNeedRedraw(){if(this._toRedraw)return this._toRedraw=!1,!0;if(this.getMap().isInteracting()&&(this.mi&&this.mi.isEnable()||this.gi&&this.gi.isEnable()))return!0;if(this._i&&this._i.isEnable())return!0;const t=this.layer.getLayers();for(const i of t){const t=i.getRenderer();if(t&&t.testIfNeedRedraw())return this.hs=!0,!0}return!1}isRenderComplete(){const t=this.layer.getLayers();for(const i of t){const t=i.getRenderer();if(t&&!t.isRenderComplete())return!1}return!0}mustRenderOnInteracting(){const t=this.layer.getLayers();for(const i of t){const t=i.getRenderer();if(t&&t.mustRenderOnInteracting())return!0}return!1}isCanvasUpdated(){if(super.isCanvasUpdated())return!0;const t=this.layer.getLayers();for(const i of t){const t=i.getRenderer();if(t&&t.isCanvasUpdated())return!0}return!1}isBlank(){if(this.mi&&this.mi.isEnable())return!1;if(this.gi&&this.gi.isEnable())return!1;const t=this.layer.getLayers();for(const i of t){const t=i.getRenderer();if(t&&!t.isBlank())return!1}return!0}createContext(){const t=this.layer,i=t.options.glOptions||{alpha:!0,depth:!0,stencil:!0};i.preserveDrawingBuffer=!0,i.antialias=t.options.antialias,this.glOptions=i;const s=this.gl=this.ns(this.canvas,i);this.rs(s),s.wrap=()=>new i$3(this.gl),this.glCtx=s.wrap(),this.canvas.gl=this.gl,this.reglGL=s.wrap(),this.regl=u$5({gl:this.reglGL,attributes:i,extensions:t.options.extensions,optionalExtensions:t.options.optionalExtensions}),this.gl.regl=this.regl,this.os=[0,0],this.mi=new y$5(this.regl,this.layer),this.gi=new F$7(this.regl,this.layer);const e=this.layer.getWeatherConfig();this._i=new Z$6(this.regl,t,e),this.as=new rt$5(this.regl,t);const h=this.layer.ot()||{},n=h&&h.postProcess;this.Di=new Ct$5(n&&n.antialias&&n.antialias.jitterRatio||.2),this.Pi=new st$5(this.regl,this.layer,this.Di),this.h=new v$6(this.regl,h,this.layer)}rs(){const t=this.layer,i=this.gl,s=t.options.extensions;s&&s.forEach((t=>{i.getExtension(t)}));const e=t.options.optionalExtensions;e&&e.forEach((t=>{i.getExtension(t)})),this.gl.clearColor(0,0,0,0)}clearCanvas(){super.clearCanvas(),this.ls()}ls(){const t=this.regl;this.Li&&(t.clear({color:ot$5,depth:1,stencil:255,framebuffer:this.Li}),t.clear({color:ot$5,framebuffer:this.ki}),t.clear({color:ot$5,framebuffer:this.Ui}),this.Gi&&this.Ni&&t.clear({color:ot$5,framebuffer:this.Gi}),this.Bi&&this.ji&&t.clear({color:ot$5,framebuffer:this.Bi})),this.Ki&&t.clear({color:ot$5,framebuffer:this.Ki}),t.clear({color:ot$5,depth:1,stencil:255})}resizeCanvas(){super.resizeCanvas();const t=this.canvas.width,i=this.canvas.height;!this.Li||this.Li.width===t&&this.Li.height===i||(this.Li.resize(t,i),this.ki.resize(t,i),this.Ui.resize(t,i),this.Gi&&this.Gi.resize(t,i),this.Bi&&this.Bi.resize(t,i)),this.ls(),this.forEachRenderer((t=>{t.canvas&&t.resizeCanvas()}))}getCanvasImage(){return this.forEachRenderer((t=>{t.getCanvasImage()})),super.getCanvasImage()}forEachRenderer(t){const i=this.layer.getLayers();for(const s of i){if(!s.isVisible())continue;const i=s.getRenderer();i&&t(i,s)}}ns(t,i){const s=this.layer.options.onlyWebGL1?["webgl","experimental-webgl"]:["webgl2","webgl","experimental-webgl"];let e=null;for(let h=0;h<s.length;++h){try{e=t.getContext(s[h],i)}catch(t){}if(e)break}return e}clearStencil(t,i){const s={stencil:t.getStencilValue?t.getStencilValue():255};i&&(s.framebuffer=i),this.regl.clear(s)}onRemove(){this.canvas.pickingFBO&&this.canvas.pickingFBO.destroy&&this.canvas.pickingFBO.destroy(),this.cs(),this.mi&&(this.mi.dispose(),delete this.mi),this.gi&&(this.gi.dispose(),delete this.gi),this.h&&(this.h.dispose(),delete this.h),this.Pi&&(this.Pi.dispose(),delete this.Pi),this.Ki&&(this.Ki.destroy(),delete this.Ki),this._i&&(this._i.dispose(),delete this._i),super.onRemove()}cs(){if(this.Li&&(this.Li.destroy(),this.ki.destroy(),this.Ui.destroy(),this.Gi&&(this.Gi.destroy(),delete this.Gi),this.Bi&&(this.Bi.destroy(),delete this.Bi),delete this.Li,delete this.ki,delete this.Ui,this.ds&&(this.ds.destroy(),delete this.ds),this.Qi&&(this.Qi.destroy(),delete this.Qi),this.ts)){for(let t=0;t<this.ts.length;t++)this.ts[t]&&this.ts[t].destroy();delete this.ts}}setRetireFrames(){this.Ii=!0}getFrameTime(){return this.Yi}getFrameEvent(){return this.Xi}getFrameContext(){return this.Oi}drawGround(t){if(!this.mi)return!1;const i=this.getFrameContext(),s=i.jitter;let e;i.jitter=at$5,i.offsetFactor=2,i.offsetUnits=2,t&&(e=i.sceneFilter,delete i.sceneFilter);const h=this.mi.paint(i);return this.mi.needToRedraw()&&this.setToRedraw(),e&&(i.sceneFilter=e),i.jitter=s,h}wi(t){const i=this;return function(s,e){return(e=e||i.Oi)&&e.renderTarget&&(e.renderTarget.getFramebuffer=pt$5,e.renderTarget.getDepthTexture=mt$5),t.call(this,s,e)}}vi(t){const i=this;return function(s,e,h){return(h=h||i.Oi)&&h.renderTarget&&(h.renderTarget.getFramebuffer=pt$5,h.renderTarget.getDepthTexture=mt$5),t.call(this,s,e,h)}}xi(t){return function(...i){return t.apply(this,i)}}isEnableSSR(){const t=this.layer.ot(),i=t&&t.postProcess;return i&&i.enable&&i.ssr&&i.ssr.enable}isSSROn(){const t=this.isEnableSSR(),i=this.getMap();if(!t||i.getPitch()<=-.001)return 0;const s=i.projViewMatrix,e=this.Pi.getPrevSsrProjViewMatrix();return e&&exactEquals$5(e,s)?1:2}isEnableTAA(){const t=this.layer.ot(),i=t&&t.postProcess;return i&&i.antialias&&i.antialias.enable&&i.antialias.taa}isEnableSSAO(){const t=this.layer.ot(),i=t&&t.postProcess;return i&&i.enable&&i.ssao&&i.ssao.enable}isEnableOutline(){const t=this.layer.ot(),i=t&&t.postProcess;return i&&i.enable&&i.outline&&i.outline.enable}isEnableWeather(){const t=this.layer.ot(),i=t&&t.weather;return i&&i.enable}us(){const t=this.layer.getMap();if(!this.T){this.T={center:t.getCenter(),bearing:t.getBearing(),pitch:t.getPitch(),res:t.getResolution()};let i=!1;if(t.options.lights){const s=t.getLightManager().getDirectionalLight().direction;this.T.lightDirection=copy$4([],s),i=!0}return{viewChanged:!0,lightDirectionChanged:i}}const i=t.getResolution()/this.T.res,s=t.coordToContainerPoint(this.T.center),e=this.layer.options.viewMoveThreshold,h=s._sub(t.width/2,t.height/2).mag()>e||i<.95||i>1.05;let r=!1;if(t.options.lights){const i=t.getLightManager().getDirectionalLight().direction;r=!equals$5(this.T.lightDirection,i),r&&(this.T.lightDirection=copy$4([],i))}return h&&(this.T.center=t.getCenter(),this.T.bearing=t.getBearing(),this.T.pitch=t.getPitch(),this.T.res=t.getResolution()),{viewChanged:h,lightDirectionChanged:r}}Ji(t){const i=this.layer.ot(),s=i&&i.postProcess,e=i&&i.weather,h={timestamp:t,renderMode:this.yi||"default",includes:{},states:this.us(),testSceneFilter:t=>!h.sceneFilter||h.sceneFilter(t),isFinalRender:!1,weather:{fog:e&&e.fog}},r=this.Di;r.setRatio(s&&s.antialias&&s.antialias.jitterRatio||.2);const o=this.isSSROn();let l;if(s&&s.enable){this.isEnableTAA()?((this.getMap().isInteracting()||this.Ii)&&r.reset(),r.getJitter(this.os),r.frame()):set(this.os,0,0),h.jitter=this.os;const t=s.bloom&&s.bloom.enable;t&&o?(h.bloom=1,h.sceneFilter=lt$5):t?(h.bloom=1,h.sceneFilter=ct$5):o&&(h.sceneFilter=dt$5),l=this.Ai(),l&&(h.renderTarget=l)}else this.cs();return"noAa"!==this.yi&&(this.fs=this.ps(h),this.fs&&(h.includes.shadow=1),this.ms=this.gs(h)),this.fs&&(h.shadow=this.fs,h.includes.shadow=1),h.states.includesChanged=this.ms,s&&s.enable&&this.Pi&&this.Pi.setContextIncludes(h),h}_s(t){const i=this.layer.getLayers().filter((t=>t.isVisible()));return this.as.paint(t,i)}gs(t){let i=!1;const s=Object.keys(t.includes),e=this.ws;if(e){const t=s.filter((t=>-1===e.indexOf(t))).concat(e.filter((t=>-1===s.indexOf(t))));t.length&&(i=t.reduce(((t,i)=>(t[i]=1,t)),{}))}return this.ws=s,i}ps(t){const i=this.layer.ot();if(!i||!i.shadow||!i.shadow.enable)return this.h&&(this.h.dispose(),delete this.h),null;this.h||(this.h=new v$6(this.regl,this.layer.ot()||{},this.layer));const s={config:i.shadow,defines:this.h.getDefines(),uniformDeclares:v$6.getUniformDeclares()};return s.renderUniforms=this.vs(t),s}vs(t){const i=t.renderTarget&&t.renderTarget.fbo,s=this.layer.ot(),e=[];let h=t.states.lightDirectionChanged||t.states.viewChanged;this.forEachRenderer(((t,i)=>{if(!t.getShadowMeshes||!i.isVisible())return;const s=t.getShadowMeshes();if(Array.isArray(s))for(let t=0;t<s.length;t++)s[t].needUpdateShadow&&(h=!0),s[t].needUpdateShadow=!1,e.push(s[t])})),this.xs||(this.xs=new pe$4),this.xs.setMeshes(e);const n=this.getMap(),r=s.shadow,o=n.getLightManager().getDirectionalLight().direction;return this.h.render(!s.ground||!s.ground.enable,n.projMatrix,n.viewMatrix,r.color,r.opacity,o,this.xs,this.os,i,h)}Cs(t){let i=[];if(this.forEachRenderer(((t,s)=>{if(!t.getShadowMeshes||!s.isVisible())return;const e=t.getShadowMeshes();i=i.concat(e)})),this.mi){const t=this.mi.getRenderMeshes();i=i.concat(t)}const s=this.layer.getWeatherConfig();return this._i.paint(t,i,s)}Ai(){const t=this.layer.ot(),i=t&&t.postProcess;if(!this.Li){const t=this.regl;let s=this.Hi;(!s||!s._texture||s._texture.refCount<=0)&&(s=null);const e=this.ni(i,s);this.Hi=e.depth||e.depthStencil,this.Li=t.framebuffer(e);const h=this.ni(i,this.Hi);this.ki=t.framebuffer(h);const n=this.ni(i,this.Hi);this.Ui=t.framebuffer(n),this.ls()}return{fbo:this.Li}}es(t){const i=this.canvas.width,s=this.canvas.height,e=this.regl,h=this.di();let n;if(!t&&h)n=e.renderbuffer({width:i,height:s,samples:this.layer.options.multiSamples,format:"rgba8"});else{n=e.texture({min:"nearest",mag:"nearest",type:"uint8",width:i,height:s})}return{width:i,height:s,colors:[n],colorFormat:h?"rgba8":"rgba"}}ni(t,i){const{width:s,height:e}=this.canvas,h=this.regl,n=this.es(),r=this.di(),o=h.hasExtension("WEBGL_depth_texture");if(r){const t=i||h.renderbuffer({width:s,height:e,format:"depth24 stencil8",samples:this.layer.options.multiSamples});n.depthStencil=t}else if(o){const t=i||h.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"depth stencil",width:s,height:e,format:"depth stencil"});n.depthStencil=t}else{const t=i||h.renderbuffer({width:s,height:e,format:"depth stencil"});n.depthStencil=t}return n}Mi(){if(!this.Li)return void(this.Ii=!1);const t=this.layer.ot(),i=t&&t.postProcess;if(!i||!i.enable)return;this.layer.fire("postprocessstart");const s=this.layer.getMap();let e;if(this.isEnableTAA()){const t=this.Ii||s.getRenderer().isViewChanged();t&&this.layer.fire("taastart");const{outputTex:i,redraw:h}=this.Pi.taa(this.ei(this.Gi),this.Ri(),{projMatrix:s.projMatrix,needClear:t});e=i,h?this.setToRedraw():this.layer.fire("taaend"),this.Ii=!1}let h=i.sharpen&&i.sharpen.factor;h||0===h||(h=.2);let n=0,r=.2,o=.3,a=1,l=[1,1,0];i.outline&&(n=+!!i.outline.enable,r=gt$5(i.outline,"highlightFactor",r),o=gt$5(i.outline,"outlineFactor",o),a=gt$5(i.outline,"outlineWidth",a),l=gt$5(i.outline,"outlineColor",l));const c=this.isEnableSSAO(),d=i.ssr&&i.ssr.enable,u=i.bloom&&i.bloom.enable,f=u&&this.Vi,p=+!(!i.antialias||!i.antialias.enable),m=this.as.fi(),g=c||u||d||m;let _=this.ds;if(g){if(!_){const t=this.es();this.di()&&(t.depthStencil=this.regl.renderbuffer({width:this.canvas.width,height:this.canvas.height,samples:this.layer.options.multiSamples,format:"depth24 stencil8"})),_=this.ds=this.regl.framebuffer(t)}const{width:t,height:i}=this.canvas;_.width===t&&_.height===i||_.resize(t,i)}else _=null,this.ds&&(this.ds.destroy(),delete this.ds);let w=this.ei(this.Li);const v=this.Wi&&this.ei(this.ki),x=this.zi&&this.ei(this.Ui);if(this.Pi.fxaa(_,w,!f&&v,!f&&x,e,this.ji&&this.Bi&&this.ei(this.Bi),p,+!(!i.toneMapping||!i.toneMapping.enable),+!(g||!i.sharpen||!i.sharpen.enable),s.getDevicePixelRatio(),h,n&&this.$i>0&&this.qi(),r,o,a,l),_&&(w=this.ei(_)),c&&(this.ji||this.Ni||this.Fi)&&(w=this.Pi.ssao(w,this.Ri(),{projMatrix:s.projMatrix,cameraNear:s.cameraNear,cameraFar:s.cameraFar,ssaoBias:i.ssao&&i.ssao.bias||10,ssaoRadius:i.ssao&&i.ssao.radius||100,ssaoIntensity:i.ssao&&i.ssao.intensity||.5})),u&&this.Vi){const t=i.bloom,s=+t.threshold||0,e=gt$5(t,"factor",1),h=gt$5(t,"radius",1);w=this.Pi.bloom(w,v,x,s,e,h,p)}if(d&&(this.Pi.genSsrMipmap(w,this.Ri()),this.hs)){const t=this.Ii;this.setToRedraw(),this.Ii=t,this.hs=!1}this.as&&(w=this._s(w)),this.isEnableWeather()&&(w=this.Cs(w)),g&&this.Pi.renderFBOToScreen(w,+!(!i.sharpen||!i.sharpen.enable),h,s.getDevicePixelRatio()),this.layer.fire("postprocessend")}}),_t$4.registerRenderer("canvas",null);class xt$4{constructor(t){this.Ls=t,this.D=new ve$4,this.onHDRLoaded=this.Fs.bind(this),this.onHDRError=this.Ps.bind(this)}getDirectionalLight(){return this.Ht&&this.Ht.directional||{}}getAmbientLight(){return this.Ht&&this.Ht.ambient||{}}getAmbientResource(){return this.Rs}setConfig(t){const i=this.Ht;this.Ht=JSON.parse(JSON.stringify(t));let s=!1;if(t&&t.ambient&&t.ambient.resource){if(!(i&&i.ambient&&function(t,i){return!!t.resource&&t.resource.url===i.resource.url}(i.ambient,t.ambient)))return void this.Is();this.Rs&&(t.ambient.prefilterCubeSize!==i.ambient&&i.ambient.prefilterCubeSize&&this.Fs(),s=!0,t.ambient.resource.sh&&(this.Rs.sh=t.ambient.resource.sh))}else this.Ds(),s=i&&i.ambient&&i.ambient.resource;this.Ls.fire("updatelights",{ambientUpdate:s})}Gs(t){const i=t.getLayers();for(let t=0;t<i.length;t++){const s=i[t]&&i[t].getRenderer();if(s&&s.regl)return s.regl}const s=document.createElement("canvas"),e=u$5({canvas:s,attributes:{depth:!1,stencil:!1,alpha:!1}});return e.Hs=!0,e}Is(){this.Ns=new je$4({url:this.Ht.ambient.resource.url,arrayBuffer:!0,hdr:!0,flipY:!0},this.D),this.Ns.once("complete",this.onHDRLoaded),this.Ns.once("error",this.onHDRError)}dispose(){this.Ds()}Fs(){this.Ns&&(this.Rs=this.Bs(this.Ns),this.Ls.fire("updatelights",{ambientUpdate:!0}))}Ps(){this.Ls.fire("hdrerror")}Bs(t){const i=this.Ht.ambient.resource,s=this.Ht.ambient.prefilterCubeSize||256,e=this.Gs(this.Ls),h=ur$4.PBRHelper.createIBLMaps(e,{envTexture:t.getREGLTexture(e),rgbmRange:t.rgbmRange,ignoreSH:!!i.sh,envCubeSize:s,prefilterCubeSize:s,format:"array"});if(i.sh&&(h.sh=i.sh,Array.isArray(h.sh[0]))){const t=h.sh,i=[];for(let s=0;s<t.length;s++)i.push(...t[s]);h.sh=i}return e.Hs&&(delete this.Ns,e.destroy()),h}Ds(){this.Ns&&(this.Ns.dispose(),delete this.Ns),delete this.Rs}}let Ct$4,bt$4,St$4,Mt$4;t$2.Map.include({setLights(t){return this.options.lights=t,this.js(),this},getLights(){return this.options.lights},js(){this.Vs||(this.Vs=new xt$4(this)),this.Vs.setConfig(this.getLights())},getLightManager(){return this.Vs?this.Vs:(this.ks||(this.ks=!0,console.warn("map's light config is not set, use map.setLights(config) to set lights.")),null)}}),t$2.Map.addOnLoadHook((function(){this.options.lights&&this.js()}));const yt$4={color:[0,0,0,0]},Tt$4={enable:!0};t$2.Map.include({setPostProcessConfig(t){return this.options.postProcessConfig=t,this},getPostProcessConfig(){return this.options.postProcessConfig}});const Ot$4=t$2.renderer.MapCanvasRenderer.prototype.drawLayerCanvas;t$2.renderer.MapCanvasRenderer.prototype.drawLayerCanvas=function(){const t=Ot$4.apply(this,arguments);return t&&Et$4(this,this.canvas),t};const At$4=t$2.renderer.MapCanvasRenderer.prototype.renderFrame;function Et$4(t,i){var s,e;Ct$4||(s=i.width,e=i.height,Ct$4=document.createElement("canvas",s,e),bt$4=u$5({canvas:Ct$4,attributes:{depth:!1,stencil:!1,alpha:!0,antialias:!1,premultipliedAlpha:!1}}),St$4=bt$4.texture({mag:"linear",min:"linear",mipmap:!1,flipY:!0,width:s,height:e}),Mt$4=bt$4.texture());const h=t.map.getPostProcessConfig();if(!h||!h.enable)return;Ct$4.width===i.width&&Ct$4.height===i.height||(Ct$4.width=i.width,Ct$4.height=i.height),bt$4.clear(yt$4);const n=h.filmicGrain||Tt$4;void 0===n.enable&&(n.enable=!0);const r=h.vignette||Tt$4;void 0===r.enable&&(r.enable=!0);const o=h.colorLUT||Tt$4;void 0===o.enable&&(o.enable=!0),t.Ws||(t.Ws={});const a=t.Ws;if(o.enable){const i=o.lut;if(!a.lutTexture||a.lutTexture.url!==i){const s=new Image;s.onload=function(){const e={data:s,min:"linear",mag:"linear"},h=a.lutTexture?a.lutTexture.texture(e):bt$4.texture(e);a.lutTexture={url:i,texture:h},t.setLayerCanvasUpdated()},s.src=i}}const l={enableGrain:+!!n.enable,grainFactor:void 0===n.factor?.15:n.factor,timeGrain:performance.now(),enableVignette:+!!r.enable,lensRadius:r.lensRadius||[.8,.25],frameMod:1,enableLut:+!!o.enable,lookupTable:a.lutTexture?a.lutTexture.texture:Mt$4};(void 0).postprocess(l,St$4({width:Ct$4.width,height:Ct$4.height,data:i,flipY:!0,mag:"linear",min:"linear",mipmap:!1})),n.enable&&t.setLayerCanvasUpdated(),t.context.drawImage(Ct$4,0,0,Ct$4.width,Ct$4.height)}t$2.renderer.MapCanvasRenderer.prototype.renderFrame=function(){const t=At$4.apply(this,arguments),i=this.map.getPostProcessConfig(),s=i&&i.filmicGrain;return!s||void 0!==s.enable&&!0!==s.enable||this.setLayerCanvasUpdated(),t};const Lt$4=[0,0,0,0];class Ft$4{constructor(t,i,s,e,h,n){this.renderer=new k$7(t),this.sceneConfig=i,this.i=s,this.Us=e,this.zs=h,this.Ys=n||{factor:0,units:0},this.s(),this.Js=[]}render(t,i,s){this.Xs();const e=this.i.getMap();this.renderer.regl.clear({color:Lt$4,depth:1,stencil:255,framebuffer:this.qs}),this.renderer.render(this.$s,i,t,this.qs);const h=this.i.getRenderer().canvas;this.Js[0]=h.width,this.Js[1]=h.height;const n=f$4({colorRamp:this.Ks,inputTexture:this.qs,projViewMatrix:e.projViewMatrix,textureOutputSize:this.Js},i);this.u(),this.renderer.render(this.Zs,n,this.R,s)}dispose(){this.$s&&(this.$s.dispose(),delete this.$s),this.Zs&&(this.Zs.dispose(),delete this.Zs),this._&&(this._.geometry.dispose(),this._.dispose(),delete this._,delete this.R),this.qs&&(this.qs.destroy(),delete this.qs)}Qs(){const t=this.Us;let i=this.te,s=this.ie;s?s.clearRect(0,0,256,1):(i=this.te=document.createElement("canvas"),i.width=256,i.height=1,s=this.ie=i.getContext("2d"));const e=s.createLinearGradient(0,0,256,1);for(let i=0;i<t.length;i++)e.addColorStop(t[i][0],t[i][1]);s.fillStyle=e,s.fillRect(0,0,256,1),this.Ks&&this.Ks.destroy();this.Ks=this.renderer.regl.texture({width:256,height:1,data:i,min:"linear",mag:"linear",premultiplyAlpha:!0})}Xs(){const t=this.i.getRenderer().canvas,i=Math.ceil(t.width/4),s=Math.ceil(t.height/4),e=this.qs;e.width===i&&e.height===s||e.resize(i,s)}s(){this.Qs(),this.se(),this.ee(),this.l()}l(){const t=new Xe$4;t.generateBuffers(this.renderer.regl),this._=new de$4(t),this.R=new pe$4([this._])}u(){const t=this.i.getMap(),i=y$5.getGroundTransform(this._.localTransform,t);this._.setLocalTransform(i)}ee(){const t=this.i.getRenderer().canvas,i=this.renderer.regl,s=i.hasExtension("OES_texture_half_float")?"half float":"float",e=Math.ceil(t.width/4),h=Math.ceil(t.height/4),n=i.texture({width:e,height:h,type:s,min:"linear",mag:"linear",format:"rgba"});this.qs=i.framebuffer({width:e,height:h,color:[n]})}se(){const t=this.i.getRenderer().canvas,i=this.sceneConfig.depthRange,s={viewport:{x:0,y:0,width:()=>t?Math.ceil(t.width/4):1,height:()=>t?Math.ceil(t.height/4):1},depth:{enable:!0,func:"always"}};this.zs&&(s.stencil=this.zs),this.$s=new Dt$4({extraCommandProps:s}),this.Zs=new Ht$4({x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},{extraCommandProps:{stencil:{enable:!1},depth:{enable:!0,range:i||[0,1],func:"<="},polygonOffset:{enable:!0,offset:this.Ys},scissor:{enable:!1}}})}}"undefined"!=typeof window&&window.maptalks&&(window.maptalks.GroupGLLayer=_t$4);const getGlobal=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},globals=getGlobal(),transcoders=globals.gl_trans__coders=globals.gl_trans__coders||{};function createFunction(parameters,defaultType){var fun,isFeatureConstant,isZoomConstant;if(isFunctionDefinition(parameters)){var innerFun,zoomAndFeatureDependent=parameters.stops&&"object"==typeof parameters.stops[0][0],zoomDependent=zoomAndFeatureDependent||!(zoomAndFeatureDependent||void 0!==parameters.property),type=parameters.type||defaultType||"exponential";if("exponential"===type)innerFun=evaluateExponentialFunction;else if("interval"===type)innerFun=evaluateIntervalFunction;else if("categorical"===type)innerFun=evaluateCategoricalFunction;else{if("identity"!==type)throw new Error('Unknown function type "'+type+'"');innerFun=evaluateIdentityFunction}if(zoomAndFeatureDependent){var featureFunctions={},featureFunctionStops=[];for(let s=0;s<parameters.stops.length;s++){var stop=parameters.stops[s];void 0===featureFunctions[stop[0].zoom]&&(featureFunctions[stop[0].zoom]={zoom:stop[0].zoom,type:parameters.type,property:parameters.property,default:parameters.default,stops:[]}),featureFunctions[stop[0].zoom].stops.push([stop[0].value,stop[1]])}for(let z in featureFunctions)featureFunctionStops.push([featureFunctions[z].zoom,createFunction(featureFunctions[z])]);fun=function(zoom,feature){const value=evaluateExponentialFunction({stops:featureFunctionStops,base:parameters.base},zoom)(zoom,feature);return"function"==typeof value?value(zoom,feature):value},isFeatureConstant=!1,isZoomConstant=!1}else zoomDependent?(fun=function(zoom){const value=innerFun(parameters,zoom);return"function"==typeof value?value(zoom):value},isFeatureConstant=!0,isZoomConstant=!1):(fun=function(zoom,feature){const value=innerFun(parameters,feature?feature[parameters.property]:null);return"function"==typeof value?value(zoom,feature):value},isFeatureConstant=!1,isZoomConstant=!0)}else fun=function(){return parameters},isFeatureConstant=!0,isZoomConstant=!0;return fun.isZoomConstant=isZoomConstant,fun.isFeatureConstant=isFeatureConstant,fun}function evaluateCategoricalFunction(parameters,input){for(let i=0;i<parameters.stops.length;i++)if(input===parameters.stops[i][0])return parameters.stops[i][1];return parameters.default}function evaluateIntervalFunction(parameters,input){for(var i=0;i<parameters.stops.length&&!(input<parameters.stops[i][0]);i++);return parameters.stops[Math.max(i-1,0)][1]}function evaluateExponentialFunction(parameters,input){for(var base=void 0!==parameters.base?parameters.base:1,i=0;!(i>=parameters.stops.length||input<=parameters.stops[i][0]);)i++;return 0===i?parameters.stops[i][1]:i===parameters.stops.length?parameters.stops[i-1][1]:interpolate(input,base,parameters.stops[i-1][0],parameters.stops[i][0],parameters.stops[i-1][1],parameters.stops[i][1])}function evaluateIdentityFunction(parameters,input){return function(a,b,c){return void 0!==a?a:void 0!==b?b:void 0!==c?c:null}(input,parameters.default)}function interpolate(input,base,inputLower,inputUpper,outputLower,outputUpper){return"function"==typeof outputLower?function(){var evaluatedLower=outputLower.apply(void 0,arguments),evaluatedUpper=outputUpper.apply(void 0,arguments);return interpolate(input,base,inputLower,inputUpper,evaluatedLower,evaluatedUpper)}:outputLower.length?function(input,base,inputLower,inputUpper,outputLower,outputUpper){var output=[];for(let i=0;i<outputLower.length;i++)output[i]=interpolateNumber(input,base,inputLower,inputUpper,outputLower[i],outputUpper[i]);return output}(input,base,inputLower,inputUpper,outputLower,outputUpper):interpolateNumber(input,base,inputLower,inputUpper,outputLower,outputUpper)}function interpolateNumber(input,base,inputLower,inputUpper,outputLower,outputUpper){var ratio,difference=inputUpper-inputLower,progress=input-inputLower;return outputLower*(1-(ratio=1===base?progress/difference:(Math.pow(base,progress)-1)/(Math.pow(base,difference)-1)))+outputUpper*ratio}function isFunctionDefinition(obj){return obj&&"object"==typeof obj&&(obj.stops||obj.property&&"identity"===obj.type)}function hasFunctionDefinition(obj){for(const p in obj)if(isFunctionDefinition(obj[p]))return!0;return!1}function interpolated(parameters){return createFunction1(parameters,"exponential")}function piecewiseConstant(parameters){return createFunction1(parameters,"interval")}function loadFunctionTypes(obj,argFn){if(!obj)return null;var hit=!1;if(Array.isArray(obj)){var loaded,multResult=[];for(let i=0;i<obj.length;i++)loaded=loadFunctionTypes(obj[i],argFn),loaded?(multResult.push(loaded),hit=!0):multResult.push(obj[i]);return hit?multResult:obj}var p,result={__fn_types_loaded:!0},props=[];for(p in obj)obj.hasOwnProperty(p)&&props.push(p);const buildFn=function(p){Object.defineProperty(result,p,{get:function(){return this["__fn_"+p]||(this["__fn_"+p]=interpolated(this["_"+p])),this["__fn_"+p].apply(this,argFn())},set:function(v){this["_"+p]=v},configurable:!0,enumerable:!0})};for(let i=0,len=props.length;i<len;i++)p=props[i],isFunctionDefinition(obj[p])?(hit=!0,result["_"+p]=obj[p],buildFn(p)):result[p]=obj[p];return hit?result:obj}function createFunction1(parameters,defaultType){if(!isFunctionDefinition(parameters))return function(){return parameters};let isZoomConstant=!0,isFeatureConstant=!0;const stops=(parameters=JSON.parse(JSON.stringify(parameters))).stops;if(stops)for(let i=0;i<stops.length;i++)if(isFunctionDefinition(stops[i][1])){const fn=createFunction1(stops[i][1],defaultType);isZoomConstant=isZoomConstant&&fn.isZoomConstant,isFeatureConstant=isFeatureConstant&&fn.isFeatureConstant,stops[i]=[stops[i][0],fn]}const fn=createFunction(parameters,defaultType);return fn.isZoomConstant=isZoomConstant&&fn.isZoomConstant,fn.isFeatureConstant=isFeatureConstant&&fn.isFeatureConstant,fn}transcoders.inject=function(chunk){const fnString=chunk.toString(),prefixIndex=fnString.indexOf("{")+1,prefix=fnString.substring(0,prefixIndex),transcoders=globals.gl_trans__coders=globals.gl_trans__coders||{};let injected=`${prefix}\n    const _____getGlobal = ${getGlobal.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const p in transcoders)"inject"!==p&&"getTranscoder"!==p&&"registerTranscoder"!==p&&(injected+='tran_____scoders["'+p+'"] ='+transcoders[p].toString()+"\n;");return injected+="\n"+fnString.substring(prefix.length),injected},transcoders.registerTranscoder=function(name,fn){transcoders[name]=fn},transcoders.getTranscoder=function(name){return transcoders[name]},"undefined"!=typeof console&&console.log("@maptalks/gl v0.74.0");var pointGeometry=Point;function Point(x,y){this.x=x,this.y=y}function ShelfPack(w,h,options){options=options||{},this.w=w||64,this.h=h||64,this.autoResize=!!options.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function Shelf(y,w,h){this.x=0,this.y=y,this.w=this.free=w,this.h=h}function Bin(id,x,y,w,h,maxw,maxh){this.id=id,this.x=x,this.y=y,this.w=w,this.h=h,this.maxw=maxw||w,this.maxh=maxh||h,this.refcount=0}Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},multByPoint:function(p){return this.clone()._multByPoint(p)},divByPoint:function(p){return this.clone()._divByPoint(p)},mult:function(k){return this.clone()._mult(k)},div:function(k){return this.clone()._div(k)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,p){return this.clone()._rotateAround(a,p)},matMult:function(m){return this.clone()._matMult(m)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(other){return this.x===other.x&&this.y===other.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var dx=p.x-this.x,dy=p.y-this.y;return dx*dx+dy*dy},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(x,y){return Math.atan2(this.x*y-this.y*x,this.x*x+this.y*y)},_matMult:function(m){var y=m[2]*this.x+m[3]*this.y;return this.x=m[0]*this.x+m[1]*this.y,this.y=y,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(k){return this.x*=k,this.y*=k,this},_div:function(k){return this.x/=k,this.y/=k,this},_multByPoint:function(p){return this.x*=p.x,this.y*=p.y,this},_divByPoint:function(p){return this.x/=p.x,this.y/=p.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var y=this.y;return this.y=this.x,this.x=-y,this},_rotate:function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),y=sin*this.x+cos*this.y;return this.x=cos*this.x-sin*this.y,this.y=y,this},_rotateAround:function(angle,p){var cos=Math.cos(angle),sin=Math.sin(angle),y=p.y+sin*(this.x-p.x)+cos*(this.y-p.y);return this.x=p.x+cos*(this.x-p.x)-sin*(this.y-p.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(a){return a instanceof Point?a:Array.isArray(a)?new Point(a[0],a[1]):a},ShelfPack.prototype.pack=function(bins,options){bins=[].concat(bins),options=options||{};for(var w,h,allocation,results=[],i=0;i<bins.length;i++)if(h=bins[i].h||bins[i].height,(w=bins[i].w||bins[i].width)&&h){if(!(allocation=this.packOne(w,h,bins[i].id)))continue;options.inPlace&&(bins[i].x=allocation.x,bins[i].y=allocation.y,bins[i].id=allocation.id),results.push(allocation)}return this.shrink(),results},ShelfPack.prototype.packOne=function(w,h,id){var bin,shelf,waste,i,h1,h2,w1,w2,best={freebin:-1,shelf:-1,waste:1/0},y=0;if("string"==typeof id||"number"==typeof id){if(bin=this.getBin(id))return this.ref(bin),bin;"number"==typeof id&&(this.maxId=Math.max(id,this.maxId))}else id=++this.maxId;for(i=0;i<this.freebins.length;i++){if(h===(bin=this.freebins[i]).maxh&&w===bin.maxw)return this.allocFreebin(i,w,h,id);h>bin.maxh||w>bin.maxw||h<=bin.maxh&&w<=bin.maxw&&(waste=bin.maxw*bin.maxh-w*h)<best.waste&&(best.waste=waste,best.freebin=i)}for(i=0;i<this.shelves.length;i++)if(y+=(shelf=this.shelves[i]).h,!(w>shelf.free)){if(h===shelf.h)return this.allocShelf(i,w,h,id);h>shelf.h||h<shelf.h&&(waste=(shelf.h-h)*w)<best.waste&&(best.freebin=-1,best.waste=waste,best.shelf=i)}return-1!==best.freebin?this.allocFreebin(best.freebin,w,h,id):-1!==best.shelf?this.allocShelf(best.shelf,w,h,id):h<=this.h-y&&w<=this.w?(shelf=new Shelf(y,this.w,h),this.allocShelf(this.shelves.push(shelf)-1,w,h,id)):this.autoResize?(h1=h2=this.h,((w1=w2=this.w)<=h1||w>w1)&&(w2=2*Math.max(w,w1)),(h1<w1||h>h1)&&(h2=2*Math.max(h,h1)),this.resize(w2,h2),this.packOne(w,h,id)):null},ShelfPack.prototype.allocFreebin=function(index,w,h,id){var bin=this.freebins.splice(index,1)[0];return bin.id=id,bin.w=w,bin.h=h,bin.refcount=0,this.bins[id]=bin,this.ref(bin),bin},ShelfPack.prototype.allocShelf=function(index,w,h,id){var bin=this.shelves[index].alloc(w,h,id);return this.bins[id]=bin,this.ref(bin),bin},ShelfPack.prototype.shrink=function(){if(this.shelves.length>0){for(var w2=0,h2=0,j=0;j<this.shelves.length;j++){var shelf=this.shelves[j];h2+=shelf.h,w2=Math.max(shelf.w-shelf.free,w2)}this.resize(w2,h2)}},ShelfPack.prototype.getBin=function(id){return this.bins[id]},ShelfPack.prototype.ref=function(bin){if(1==++bin.refcount){var h=bin.h;this.stats[h]=1+(0|this.stats[h])}return bin.refcount},ShelfPack.prototype.unref=function(bin){return 0===bin.refcount?0:(0==--bin.refcount&&(this.stats[bin.h]--,delete this.bins[bin.id],this.freebins.push(bin)),bin.refcount)},ShelfPack.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},ShelfPack.prototype.resize=function(w,h){this.w=w,this.h=h;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(w);return!0},Shelf.prototype.alloc=function(w,h,id){if(w>this.free||h>this.h)return null;var x=this.x;return this.x+=w,this.free-=w,new Bin(id,x,this.y,w,h,w,this.h)},Shelf.prototype.resize=function(w){return this.free+=w-this.w,this.w=w,!0};var colorString$1={exports:{}},colorName={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},simpleSwizzle={exports:{}},isArrayish=function(obj){return!(!obj||"string"==typeof obj)&&(obj instanceof Array||Array.isArray(obj)||obj.length>=0&&(obj.splice instanceof Function||Object.getOwnPropertyDescriptor(obj,obj.length-1)&&"String"!==obj.constructor.name))},concat=Array.prototype.concat,slice=Array.prototype.slice,swizzle$1=simpleSwizzle.exports=function(args){for(var results=[],i=0,len=args.length;i<len;i++){var arg=args[i];isArrayish(arg)?results=concat.call(results,slice.call(arg)):results.push(arg)}return results};swizzle$1.wrap=function(fn){return function(){return fn(swizzle$1(arguments))}};var colorNames=colorName,swizzle=simpleSwizzle.exports,hasOwnProperty=Object.hasOwnProperty,reverseNames=Object.create(null);for(var name in colorNames)hasOwnProperty.call(colorNames,name)&&(reverseNames[colorNames[name]]=name);var cs$1=colorString$1.exports={to:{},get:{}};function clamp(num,min,max){return Math.min(Math.max(min,num),max)}function hexDouble(num){var str=Math.round(num).toString(16).toUpperCase();return str.length<2?"0"+str:str}cs$1.get=function(string){var val,model;switch(string.substring(0,3).toLowerCase()){case"hsl":val=cs$1.get.hsl(string),model="hsl";break;case"hwb":val=cs$1.get.hwb(string),model="hwb";break;default:val=cs$1.get.rgb(string),model="rgb"}return val?{model,value:val}:null},cs$1.get.rgb=function(string){if(!string)return null;var match,i,hexAlpha,rgb=[0,0,0,1];if(match=string.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(hexAlpha=match[2],match=match[1],i=0;i<3;i++){var i2=2*i;rgb[i]=parseInt(match.slice(i2,i2+2),16)}hexAlpha&&(rgb[3]=parseInt(hexAlpha,16)/255)}else if(match=string.match(/^#([a-f0-9]{3,4})$/i)){for(hexAlpha=(match=match[1])[3],i=0;i<3;i++)rgb[i]=parseInt(match[i]+match[i],16);hexAlpha&&(rgb[3]=parseInt(hexAlpha+hexAlpha,16)/255)}else if(match=string.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)rgb[i]=parseInt(match[i+1],0);match[4]&&(rgb[3]=match[5]?.01*parseFloat(match[4]):parseFloat(match[4]))}else{if(!(match=string.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(match=string.match(/^(\w+)$/))?"transparent"===match[1]?[0,0,0,0]:hasOwnProperty.call(colorNames,match[1])?((rgb=colorNames[match[1]])[3]=1,rgb):null:null;for(i=0;i<3;i++)rgb[i]=Math.round(2.55*parseFloat(match[i+1]));match[4]&&(rgb[3]=match[5]?.01*parseFloat(match[4]):parseFloat(match[4]))}for(i=0;i<3;i++)rgb[i]=clamp(rgb[i],0,255);return rgb[3]=clamp(rgb[3],0,1),rgb},cs$1.get.hsl=function(string){if(!string)return null;var match=string.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(match){var alpha=parseFloat(match[4]);return[(parseFloat(match[1])%360+360)%360,clamp(parseFloat(match[2]),0,100),clamp(parseFloat(match[3]),0,100),clamp(isNaN(alpha)?1:alpha,0,1)]}return null},cs$1.get.hwb=function(string){if(!string)return null;var match=string.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(match){var alpha=parseFloat(match[4]);return[(parseFloat(match[1])%360+360)%360,clamp(parseFloat(match[2]),0,100),clamp(parseFloat(match[3]),0,100),clamp(isNaN(alpha)?1:alpha,0,1)]}return null},cs$1.to.hex=function(){var rgba=swizzle(arguments);return"#"+hexDouble(rgba[0])+hexDouble(rgba[1])+hexDouble(rgba[2])+(rgba[3]<1?hexDouble(Math.round(255*rgba[3])):"")},cs$1.to.rgb=function(){var rgba=swizzle(arguments);return rgba.length<4||1===rgba[3]?"rgb("+Math.round(rgba[0])+", "+Math.round(rgba[1])+", "+Math.round(rgba[2])+")":"rgba("+Math.round(rgba[0])+", "+Math.round(rgba[1])+", "+Math.round(rgba[2])+", "+rgba[3]+")"},cs$1.to.rgb.percent=function(){var rgba=swizzle(arguments),r=Math.round(rgba[0]/255*100),g=Math.round(rgba[1]/255*100),b=Math.round(rgba[2]/255*100);return rgba.length<4||1===rgba[3]?"rgb("+r+"%, "+g+"%, "+b+"%)":"rgba("+r+"%, "+g+"%, "+b+"%, "+rgba[3]+")"},cs$1.to.hsl=function(){var hsla=swizzle(arguments);return hsla.length<4||1===hsla[3]?"hsl("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%)":"hsla("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%, "+hsla[3]+")"},cs$1.to.hwb=function(){var hwba=swizzle(arguments),a="";return hwba.length>=4&&1!==hwba[3]&&(a=", "+hwba[3]),"hwb("+hwba[0]+", "+hwba[1]+"%, "+hwba[2]+"%"+a+")"},cs$1.to.keyword=function(rgb){return reverseNames[rgb.slice(0,3)]};var conversions$2={exports:{}},cssKeywords=colorName,reverseKeywords={};for(var key in cssKeywords)cssKeywords.hasOwnProperty(key)&&(reverseKeywords[cssKeywords[key]]=key);var convert$2=conversions$2.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var model in convert$2)if(convert$2.hasOwnProperty(model)){if(!("channels"in convert$2[model]))throw new Error("missing channels property: "+model);if(!("labels"in convert$2[model]))throw new Error("missing channel labels property: "+model);if(convert$2[model].labels.length!==convert$2[model].channels)throw new Error("channel and label counts mismatch: "+model);var channels=convert$2[model].channels,labels=convert$2[model].labels;delete convert$2[model].channels,delete convert$2[model].labels,Object.defineProperty(convert$2[model],"channels",{value:channels}),Object.defineProperty(convert$2[model],"labels",{value:labels})}function comparativeDistance(x,y){return Math.pow(x[0]-y[0],2)+Math.pow(x[1]-y[1],2)+Math.pow(x[2]-y[2],2)}convert$2.rgb.hsl=function(rgb){var h,l,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min;return max===min?h=0:r===max?h=(g-b)/delta:g===max?h=2+(b-r)/delta:b===max&&(h=4+(r-g)/delta),(h=Math.min(60*h,360))<0&&(h+=360),l=(min+max)/2,[h,100*(max===min?0:l<=.5?delta/(max+min):delta/(2-max-min)),100*l]},convert$2.rgb.hsv=function(rgb){var rdif,gdif,bdif,h,s,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,v=Math.max(r,g,b),diff=v-Math.min(r,g,b),diffc=function(c){return(v-c)/6/diff+.5};return 0===diff?h=s=0:(s=diff/v,rdif=diffc(r),gdif=diffc(g),bdif=diffc(b),r===v?h=bdif-gdif:g===v?h=1/3+rdif-bdif:b===v&&(h=2/3+gdif-rdif),h<0?h+=1:h>1&&(h-=1)),[360*h,100*s,100*v]},convert$2.rgb.hwb=function(rgb){var r=rgb[0],g=rgb[1],b=rgb[2];return[convert$2.rgb.hsl(rgb)[0],100*(1/255*Math.min(r,Math.min(g,b))),100*(b=1-1/255*Math.max(r,Math.max(g,b)))]},convert$2.rgb.cmyk=function(rgb){var k,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255;return[100*((1-r-(k=Math.min(1-r,1-g,1-b)))/(1-k)||0),100*((1-g-k)/(1-k)||0),100*((1-b-k)/(1-k)||0),100*k]},convert$2.rgb.keyword=function(rgb){var reversed=reverseKeywords[rgb];if(reversed)return reversed;var currentClosestKeyword,currentClosestDistance=1/0;for(var keyword in cssKeywords)if(cssKeywords.hasOwnProperty(keyword)){var distance=comparativeDistance(rgb,cssKeywords[keyword]);distance<currentClosestDistance&&(currentClosestDistance=distance,currentClosestKeyword=keyword)}return currentClosestKeyword},convert$2.keyword.rgb=function(keyword){return cssKeywords[keyword]},convert$2.rgb.xyz=function(rgb){var r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255;return[100*(.4124*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)+.3576*(g=g>.04045?Math.pow((g+.055)/1.055,2.4):g/12.92)+.1805*(b=b>.04045?Math.pow((b+.055)/1.055,2.4):b/12.92)),100*(.2126*r+.7152*g+.0722*b),100*(.0193*r+.1192*g+.9505*b)]},convert$2.rgb.lab=function(rgb){var xyz=convert$2.rgb.xyz(rgb),x=xyz[0],y=xyz[1],z=xyz[2];return y/=100,z/=108.883,x=(x/=95.047)>.008856?Math.pow(x,1/3):7.787*x+16/116,[116*(y=y>.008856?Math.pow(y,1/3):7.787*y+16/116)-16,500*(x-y),200*(y-(z=z>.008856?Math.pow(z,1/3):7.787*z+16/116))]},convert$2.hsl.rgb=function(hsl){var t1,t2,t3,rgb,val,h=hsl[0]/360,s=hsl[1]/100,l=hsl[2]/100;if(0===s)return[val=255*l,val,val];t1=2*l-(t2=l<.5?l*(1+s):l+s-l*s),rgb=[0,0,0];for(var i=0;i<3;i++)(t3=h+1/3*-(i-1))<0&&t3++,t3>1&&t3--,rgb[i]=255*(val=6*t3<1?t1+6*(t2-t1)*t3:2*t3<1?t2:3*t3<2?t1+(t2-t1)*(2/3-t3)*6:t1);return rgb},convert$2.hsl.hsv=function(hsl){var h=hsl[0],s=hsl[1]/100,l=hsl[2]/100,smin=s,lmin=Math.max(l,.01);return s*=(l*=2)<=1?l:2-l,smin*=lmin<=1?lmin:2-lmin,[h,100*(0===l?2*smin/(lmin+smin):2*s/(l+s)),100*((l+s)/2)]},convert$2.hsv.rgb=function(hsv){var h=hsv[0]/60,s=hsv[1]/100,v=hsv[2]/100,hi=Math.floor(h)%6,f=h-Math.floor(h),p=255*v*(1-s),q=255*v*(1-s*f),t=255*v*(1-s*(1-f));switch(v*=255,hi){case 0:return[v,t,p];case 1:return[q,v,p];case 2:return[p,v,t];case 3:return[p,q,v];case 4:return[t,p,v];case 5:return[v,p,q]}},convert$2.hsv.hsl=function(hsv){var lmin,sl,l,h=hsv[0],s=hsv[1]/100,v=hsv[2]/100,vmin=Math.max(v,.01);return l=(2-s)*v,sl=s*vmin,[h,100*(sl=(sl/=(lmin=(2-s)*vmin)<=1?lmin:2-lmin)||0),100*(l/=2)]},convert$2.hwb.rgb=function(hwb){var i,v,f,n,r,g,b,h=hwb[0]/360,wh=hwb[1]/100,bl=hwb[2]/100,ratio=wh+bl;switch(ratio>1&&(wh/=ratio,bl/=ratio),f=6*h-(i=Math.floor(6*h)),0!=(1&i)&&(f=1-f),n=wh+f*((v=1-bl)-wh),i){default:case 6:case 0:r=v,g=n,b=wh;break;case 1:r=n,g=v,b=wh;break;case 2:r=wh,g=v,b=n;break;case 3:r=wh,g=n,b=v;break;case 4:r=n,g=wh,b=v;break;case 5:r=v,g=wh,b=n}return[255*r,255*g,255*b]},convert$2.cmyk.rgb=function(cmyk){var m=cmyk[1]/100,y=cmyk[2]/100,k=cmyk[3]/100;return[255*(1-Math.min(1,cmyk[0]/100*(1-k)+k)),255*(1-Math.min(1,m*(1-k)+k)),255*(1-Math.min(1,y*(1-k)+k))]},convert$2.xyz.rgb=function(xyz){var r,g,b,x=xyz[0]/100,y=xyz[1]/100,z=xyz[2]/100;return g=-.9689*x+1.8758*y+.0415*z,b=.0557*x+-.204*y+1.057*z,r=(r=3.2406*x+-1.5372*y+-.4986*z)>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,g=g>.0031308?1.055*Math.pow(g,1/2.4)-.055:12.92*g,b=b>.0031308?1.055*Math.pow(b,1/2.4)-.055:12.92*b,[255*(r=Math.min(Math.max(0,r),1)),255*(g=Math.min(Math.max(0,g),1)),255*(b=Math.min(Math.max(0,b),1))]},convert$2.xyz.lab=function(xyz){var x=xyz[0],y=xyz[1],z=xyz[2];return y/=100,z/=108.883,x=(x/=95.047)>.008856?Math.pow(x,1/3):7.787*x+16/116,[116*(y=y>.008856?Math.pow(y,1/3):7.787*y+16/116)-16,500*(x-y),200*(y-(z=z>.008856?Math.pow(z,1/3):7.787*z+16/116))]},convert$2.lab.xyz=function(lab){var x,y,z;x=lab[1]/500+(y=(lab[0]+16)/116),z=y-lab[2]/200;var y2=Math.pow(y,3),x2=Math.pow(x,3),z2=Math.pow(z,3);return y=y2>.008856?y2:(y-16/116)/7.787,x=x2>.008856?x2:(x-16/116)/7.787,z=z2>.008856?z2:(z-16/116)/7.787,[x*=95.047,y*=100,z*=108.883]},convert$2.lab.lch=function(lab){var h,l=lab[0],a=lab[1],b=lab[2];return(h=360*Math.atan2(b,a)/2/Math.PI)<0&&(h+=360),[l,Math.sqrt(a*a+b*b),h]},convert$2.lch.lab=function(lch){var hr,c=lch[1];return hr=lch[2]/360*2*Math.PI,[lch[0],c*Math.cos(hr),c*Math.sin(hr)]},convert$2.rgb.ansi16=function(args){var r=args[0],g=args[1],b=args[2],value=1 in arguments?arguments[1]:convert$2.rgb.hsv(args)[2];if(0===(value=Math.round(value/50)))return 30;var ansi=30+(Math.round(b/255)<<2|Math.round(g/255)<<1|Math.round(r/255));return 2===value&&(ansi+=60),ansi},convert$2.hsv.ansi16=function(args){return convert$2.rgb.ansi16(convert$2.hsv.rgb(args),args[2])},convert$2.rgb.ansi256=function(args){var r=args[0],g=args[1],b=args[2];return r===g&&g===b?r<8?16:r>248?231:Math.round((r-8)/247*24)+232:16+36*Math.round(r/255*5)+6*Math.round(g/255*5)+Math.round(b/255*5)},convert$2.ansi16.rgb=function(args){var color=args%10;if(0===color||7===color)return args>50&&(color+=3.5),[color=color/10.5*255,color,color];var mult=.5*(1+~~(args>50));return[(1&color)*mult*255,(color>>1&1)*mult*255,(color>>2&1)*mult*255]},convert$2.ansi256.rgb=function(args){if(args>=232){var c=10*(args-232)+8;return[c,c,c]}var rem;return args-=16,[Math.floor(args/36)/5*255,Math.floor((rem=args%36)/6)/5*255,rem%6/5*255]},convert$2.rgb.hex=function(args){var string=(((255&Math.round(args[0]))<<16)+((255&Math.round(args[1]))<<8)+(255&Math.round(args[2]))).toString(16).toUpperCase();return"000000".substring(string.length)+string},convert$2.hex.rgb=function(args){var match=args.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!match)return[0,0,0];var colorString=match[0];3===match[0].length&&(colorString=colorString.split("").map((function(char){return char+char})).join(""));var integer=parseInt(colorString,16);return[integer>>16&255,integer>>8&255,255&integer]},convert$2.rgb.hcg=function(rgb){var hue,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,max=Math.max(Math.max(r,g),b),min=Math.min(Math.min(r,g),b),chroma=max-min;return hue=chroma<=0?0:max===r?(g-b)/chroma%6:max===g?2+(b-r)/chroma:4+(r-g)/chroma+4,hue/=6,[360*(hue%=1),100*chroma,100*(chroma<1?min/(1-chroma):0)]},convert$2.hsl.hcg=function(hsl){var s=hsl[1]/100,l=hsl[2]/100,c=1,f=0;return(c=l<.5?2*s*l:2*s*(1-l))<1&&(f=(l-.5*c)/(1-c)),[hsl[0],100*c,100*f]},convert$2.hsv.hcg=function(hsv){var v=hsv[2]/100,c=hsv[1]/100*v,f=0;return c<1&&(f=(v-c)/(1-c)),[hsv[0],100*c,100*f]},convert$2.hcg.rgb=function(hcg){var c=hcg[1]/100,g=hcg[2]/100;if(0===c)return[255*g,255*g,255*g];var mg,pure=[0,0,0],hi=hcg[0]/360%1*6,v=hi%1,w=1-v;switch(Math.floor(hi)){case 0:pure[0]=1,pure[1]=v,pure[2]=0;break;case 1:pure[0]=w,pure[1]=1,pure[2]=0;break;case 2:pure[0]=0,pure[1]=1,pure[2]=v;break;case 3:pure[0]=0,pure[1]=w,pure[2]=1;break;case 4:pure[0]=v,pure[1]=0,pure[2]=1;break;default:pure[0]=1,pure[1]=0,pure[2]=w}return[255*(c*pure[0]+(mg=(1-c)*g)),255*(c*pure[1]+mg),255*(c*pure[2]+mg)]},convert$2.hcg.hsv=function(hcg){var c=hcg[1]/100,v=c+hcg[2]/100*(1-c),f=0;return v>0&&(f=c/v),[hcg[0],100*f,100*v]},convert$2.hcg.hsl=function(hcg){var c=hcg[1]/100,l=hcg[2]/100*(1-c)+.5*c,s=0;return l>0&&l<.5?s=c/(2*l):l>=.5&&l<1&&(s=c/(2*(1-l))),[hcg[0],100*s,100*l]},convert$2.hcg.hwb=function(hcg){var c=hcg[1]/100,v=c+hcg[2]/100*(1-c);return[hcg[0],100*(v-c),100*(1-v)]},convert$2.hwb.hcg=function(hwb){var v=1-hwb[2]/100,c=v-hwb[1]/100,g=0;return c<1&&(g=(v-c)/(1-c)),[hwb[0],100*c,100*g]},convert$2.apple.rgb=function(apple){return[apple[0]/65535*255,apple[1]/65535*255,apple[2]/65535*255]},convert$2.rgb.apple=function(rgb){return[rgb[0]/255*65535,rgb[1]/255*65535,rgb[2]/255*65535]},convert$2.gray.rgb=function(args){return[args[0]/100*255,args[0]/100*255,args[0]/100*255]},convert$2.gray.hsl=convert$2.gray.hsv=function(args){return[0,0,args[0]]},convert$2.gray.hwb=function(gray){return[0,100,gray[0]]},convert$2.gray.cmyk=function(gray){return[0,0,0,gray[0]]},convert$2.gray.lab=function(gray){return[gray[0],0,0]},convert$2.gray.hex=function(gray){var val=255&Math.round(gray[0]/100*255),string=((val<<16)+(val<<8)+val).toString(16).toUpperCase();return"000000".substring(string.length)+string},convert$2.rgb.gray=function(rgb){return[(rgb[0]+rgb[1]+rgb[2])/3/255*100]};var conversions$1=conversions$2.exports;function deriveBFS(fromModel){var graph=function(){for(var graph={},models=Object.keys(conversions$1),len=models.length,i=0;i<len;i++)graph[models[i]]={distance:-1,parent:null};return graph}(),queue=[fromModel];for(graph[fromModel].distance=0;queue.length;)for(var current=queue.pop(),adjacents=Object.keys(conversions$1[current]),len=adjacents.length,i=0;i<len;i++){var adjacent=adjacents[i],node=graph[adjacent];-1===node.distance&&(node.distance=graph[current].distance+1,node.parent=current,queue.unshift(adjacent))}return graph}function link(from,to){return function(args){return to(from(args))}}function wrapConversion(toModel,graph){for(var path=[graph[toModel].parent,toModel],fn=conversions$1[graph[toModel].parent][toModel],cur=graph[toModel].parent;graph[cur].parent;)path.unshift(graph[cur].parent),fn=link(conversions$1[graph[cur].parent][cur],fn),cur=graph[cur].parent;return fn.conversion=path,fn}var conversions=conversions$2.exports,route=function(fromModel){for(var graph=deriveBFS(fromModel),conversion={},models=Object.keys(graph),len=models.length,i=0;i<len;i++){var toModel=models[i];null!==graph[toModel].parent&&(conversion[toModel]=wrapConversion(toModel,graph))}return conversion},convert$1={};Object.keys(conversions).forEach((function(fromModel){convert$1[fromModel]={},Object.defineProperty(convert$1[fromModel],"channels",{value:conversions[fromModel].channels}),Object.defineProperty(convert$1[fromModel],"labels",{value:conversions[fromModel].labels});var routes=route(fromModel);Object.keys(routes).forEach((function(toModel){var fn=routes[toModel];convert$1[fromModel][toModel]=function(fn){var wrappedFn=function(args){if(null==args)return args;arguments.length>1&&(args=Array.prototype.slice.call(arguments));var result=fn(args);if("object"==typeof result)for(var len=result.length,i=0;i<len;i++)result[i]=Math.round(result[i]);return result};return"conversion"in fn&&(wrappedFn.conversion=fn.conversion),wrappedFn}(fn),convert$1[fromModel][toModel].raw=function(fn){var wrappedFn=function(args){return null==args?args:(arguments.length>1&&(args=Array.prototype.slice.call(arguments)),fn(args))};return"conversion"in fn&&(wrappedFn.conversion=fn.conversion),wrappedFn}(fn)}))}));var colorString=colorString$1.exports,convert=convert$1,_slice=[].slice,skippedModels=["keyword","gray","hex"],hashedModelKeys={};Object.keys(convert).forEach((function(model){hashedModelKeys[_slice.call(convert[model].labels).sort().join("")]=model}));var limiters={};function Color(obj,model){if(!(this instanceof Color))return new Color(obj,model);if(model&&model in skippedModels&&(model=null),model&&!(model in convert))throw new Error("Unknown model: "+model);var i,channels;if(null==obj)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(obj instanceof Color)this.model=obj.model,this.color=obj.color.slice(),this.valpha=obj.valpha;else if("string"==typeof obj){var result=colorString.get(obj);if(null===result)throw new Error("Unable to parse color from string: "+obj);this.model=result.model,this.color=result.value.slice(0,channels=convert[this.model].channels),this.valpha="number"==typeof result.value[channels]?result.value[channels]:1}else if(obj.length){this.model=model||"rgb";var newArr=_slice.call(obj,0,channels=convert[this.model].channels);this.color=zeroArray(newArr,channels),this.valpha="number"==typeof obj[channels]?obj[channels]:1}else if("number"==typeof obj)obj&=16777215,this.model="rgb",this.color=[obj>>16&255,obj>>8&255,255&obj],this.valpha=1;else{this.valpha=1;var keys=Object.keys(obj);"alpha"in obj&&(keys.splice(keys.indexOf("alpha"),1),this.valpha="number"==typeof obj.alpha?obj.alpha:0);var hashedKeys=keys.sort().join("");if(!(hashedKeys in hashedModelKeys))throw new Error("Unable to parse color from object: "+JSON.stringify(obj));this.model=hashedModelKeys[hashedKeys];var labels=convert[this.model].labels,color=[];for(i=0;i<labels.length;i++)color.push(obj[labels[i]]);this.color=zeroArray(color)}if(limiters[this.model])for(channels=convert[this.model].channels,i=0;i<channels;i++){var limit=limiters[this.model][i];limit&&(this.color[i]=limit(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function getset(model,channel,modifier){return(model=Array.isArray(model)?model:[model]).forEach((function(m){(limiters[m]||(limiters[m]=[]))[channel]=modifier})),model=model[0],function(val){var result;return arguments.length?(modifier&&(val=modifier(val)),(result=this[model]()).color[channel]=val,result):(result=this[model]().color[channel],modifier&&(result=modifier(result)),result)}}function maxfn(max){return function(v){return Math.max(0,Math.min(max,v))}}function assertArray(val){return Array.isArray(val)?val:[val]}function zeroArray(arr,length){for(var i=0;i<length;i++)"number"!=typeof arr[i]&&(arr[i]=0);return arr}Color.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(places){var self=this.model in colorString.to?this:this.rgb(),args=1===(self=self.round("number"==typeof places?places:1)).valpha?self.color:self.color.concat(this.valpha);return colorString.to[self.model](args)},percentString:function(places){var self=this.rgb().round("number"==typeof places?places:1),args=1===self.valpha?self.color:self.color.concat(this.valpha);return colorString.to.rgb.percent(args)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var result={},channels=convert[this.model].channels,labels=convert[this.model].labels,i=0;i<channels;i++)result[labels[i]]=this.color[i];return 1!==this.valpha&&(result.alpha=this.valpha),result},unitArray:function(){var rgb=this.rgb().color;return rgb[0]/=255,rgb[1]/=255,rgb[2]/=255,1!==this.valpha&&rgb.push(this.valpha),rgb},unitObject:function(){var rgb=this.rgb().object();return rgb.r/=255,rgb.g/=255,rgb.b/=255,1!==this.valpha&&(rgb.alpha=this.valpha),rgb},round:function(places){return places=Math.max(places||0,0),new Color(this.color.map(function(places){return function(num){return function(num,places){return Number(num.toFixed(places))}(num,places)}}(places)).concat(this.valpha),this.model)},alpha:function(val){return arguments.length?new Color(this.color.concat(Math.max(0,Math.min(1,val))),this.model):this.valpha},red:getset("rgb",0,maxfn(255)),green:getset("rgb",1,maxfn(255)),blue:getset("rgb",2,maxfn(255)),hue:getset(["hsl","hsv","hsl","hwb","hcg"],0,(function(val){return(val%360+360)%360})),saturationl:getset("hsl",1,maxfn(100)),lightness:getset("hsl",2,maxfn(100)),saturationv:getset("hsv",1,maxfn(100)),value:getset("hsv",2,maxfn(100)),chroma:getset("hcg",1,maxfn(100)),gray:getset("hcg",2,maxfn(100)),white:getset("hwb",1,maxfn(100)),wblack:getset("hwb",2,maxfn(100)),cyan:getset("cmyk",0,maxfn(100)),magenta:getset("cmyk",1,maxfn(100)),yellow:getset("cmyk",2,maxfn(100)),black:getset("cmyk",3,maxfn(100)),x:getset("xyz",0,maxfn(100)),y:getset("xyz",1,maxfn(100)),z:getset("xyz",2,maxfn(100)),l:getset("lab",0,maxfn(100)),a:getset("lab",1),b:getset("lab",2),keyword:function(val){return arguments.length?new Color(val):convert[this.model].keyword(this.color)},hex:function(val){return arguments.length?new Color(val):colorString.to.hex(this.rgb().round().color)},rgbNumber:function(){var rgb=this.rgb().color;return(255&rgb[0])<<16|(255&rgb[1])<<8|255&rgb[2]},luminosity:function(){for(var rgb=this.rgb().color,lum=[],i=0;i<rgb.length;i++){var chan=rgb[i]/255;lum[i]=chan<=.03928?chan/12.92:Math.pow((chan+.055)/1.055,2.4)}return.2126*lum[0]+.7152*lum[1]+.0722*lum[2]},contrast:function(color2){var lum1=this.luminosity(),lum2=color2.luminosity();return lum1>lum2?(lum1+.05)/(lum2+.05):(lum2+.05)/(lum1+.05)},level:function(color2){var contrastRatio=this.contrast(color2);return contrastRatio>=7.1?"AAA":contrastRatio>=4.5?"AA":""},isDark:function(){var rgb=this.rgb().color;return(299*rgb[0]+587*rgb[1]+114*rgb[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var rgb=this.rgb(),i=0;i<3;i++)rgb.color[i]=255-rgb.color[i];return rgb},lighten:function(ratio){var hsl=this.hsl();return hsl.color[2]+=hsl.color[2]*ratio,hsl},darken:function(ratio){var hsl=this.hsl();return hsl.color[2]-=hsl.color[2]*ratio,hsl},saturate:function(ratio){var hsl=this.hsl();return hsl.color[1]+=hsl.color[1]*ratio,hsl},desaturate:function(ratio){var hsl=this.hsl();return hsl.color[1]-=hsl.color[1]*ratio,hsl},whiten:function(ratio){var hwb=this.hwb();return hwb.color[1]+=hwb.color[1]*ratio,hwb},blacken:function(ratio){var hwb=this.hwb();return hwb.color[2]+=hwb.color[2]*ratio,hwb},grayscale:function(){var rgb=this.rgb().color,val=.3*rgb[0]+.59*rgb[1]+.11*rgb[2];return Color.rgb(val,val,val)},fade:function(ratio){return this.alpha(this.valpha-this.valpha*ratio)},opaquer:function(ratio){return this.alpha(this.valpha+this.valpha*ratio)},rotate:function(degrees){var hsl=this.hsl(),hue=hsl.color[0];return hsl.color[0]=hue=(hue=(hue+degrees)%360)<0?360+hue:hue,hsl},mix:function(mixinColor,weight){if(!mixinColor||!mixinColor.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof mixinColor);var color1=mixinColor.rgb(),color2=this.rgb(),p=void 0===weight?.5:weight,w=2*p-1,a=color1.alpha()-color2.alpha(),w1=((w*a==-1?w:(w+a)/(1+w*a))+1)/2,w2=1-w1;return Color.rgb(w1*color1.red()+w2*color2.red(),w1*color1.green()+w2*color2.green(),w1*color1.blue()+w2*color2.blue(),color1.alpha()*p+color2.alpha()*(1-p))}},Object.keys(convert).forEach((function(model){if(-1===skippedModels.indexOf(model)){var channels=convert[model].channels;Color.prototype[model]=function(){if(this.model===model)return new Color(this);if(arguments.length)return new Color(arguments,model);var newAlpha="number"==typeof arguments[channels]?channels:this.valpha;return new Color(assertArray(convert[this.model][model].raw(this.color)).concat(newAlpha),model)},Color[model]=function(color){return"number"==typeof color&&(color=zeroArray(_slice.call(arguments),channels)),new Color(color,model)}}}));var color=Color;
/*!
	    Feature Filter by

	    (c) mapbox 2016 and maptalks 2018
	    www.mapbox.com | www.maptalks.org
	    License: MIT, header required.
	*/const types=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function createFilter(filter){return new Function("f",`var p = (f && f.properties || {}); return ${compile(filter)}`)}function compile(filter){if(!filter)return"true";const op=filter[0];if(filter.length<=1)return"any"===op?"false":"true";return`(${"=="===op?compileComparisonOp(filter[1],filter[2],"===",!1):"!="===op?compileComparisonOp(filter[1],filter[2],"!==",!1):"<"===op||">"===op||"<="===op||">="===op?compileComparisonOp(filter[1],filter[2],op,!0):"any"===op?compileLogicalOp(filter.slice(1),"||"):"all"===op?compileLogicalOp(filter.slice(1),"&&"):"none"===op?compileNegation(compileLogicalOp(filter.slice(1),"||")):"in"===op?compileInOp(filter[1],filter.slice(2)):"!in"===op?compileNegation(compileInOp(filter[1],filter.slice(2))):"has"===op?compileHasOp(filter[1]):"!has"===op?compileNegation(compileHasOp(filter[1])):"true"})`}function compilePropertyReference(property){return"$"===property[0]?"f."+property.substring(1):"p["+JSON.stringify(property)+"]"}function compileComparisonOp(property,value,op,checkType){const left=compilePropertyReference(property),right="$type"===property?types.indexOf(value):JSON.stringify(value);return(checkType?`typeof ${left}=== typeof ${right}&&`:"")+left+op+right}function compileLogicalOp(expressions,op){return expressions.map(compile).join(op)}function compileInOp(property,values){"$type"===property&&(values=values.map((value=>types.indexOf(value))));const left=JSON.stringify(values.sort(compare)),right=compilePropertyReference(property);return values.length<=200?`${left}.indexOf(${right}) !== -1`:`function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }(${right}, ${left},0,${values.length-1})`}function compileHasOp(property){return"$id"===property?'"id" in f':`${JSON.stringify(property)} in p`}function compileNegation(expression){return`!(${expression})`}function compare(a,b){return a<b?-1:a>b?1:0}function compileStyle(styles){if(!Array.isArray(styles))return compileStyle([styles]);const compiled=[];for(let i=0;i<styles.length;i++){let filter;filter=!0===styles[i].filter?function(){return!0}:createFilter(styles[i].filter),compiled.push(extend({},styles[i],{filter}))}return compiled}function extend(dest){for(let i=1;i<arguments.length;i++){const src=arguments[i];for(const k in src)dest[k]=src[k]}return dest}var quickselect={exports:{}};!function(module,exports){module.exports=function(){function quickselect(arr,k,left,right,compare){quickselectStep(arr,k,left||0,right||arr.length-1,compare||defaultCompare)}function quickselectStep(arr,k,left,right,compare){for(;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselectStep(arr,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}var t=arr[k],i=left,j=right;for(swap(arr,left,k),compare(arr[right],t)>0&&swap(arr,left,right);i<j;){for(swap(arr,i,j),i++,j--;compare(arr[i],t)<0;)i++;for(;compare(arr[j],t)>0;)j--}0===compare(arr[left],t)?swap(arr,left,j):swap(arr,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}return quickselect}()}(quickselect);var l$3=quickselect.exports,tinyqueue={exports:{}};function TinyQueue(data,compare){if(!(this instanceof TinyQueue))return new TinyQueue(data,compare);if(this.data=data||[],this.length=this.data.length,this.compare=compare||defaultCompare,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function defaultCompare(a,b){return a<b?-1:a>b?1:0}tinyqueue.exports=TinyQueue,tinyqueue.exports.default=TinyQueue,TinyQueue.prototype={push:function(item){this.data.push(item),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var top=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),top}},peek:function(){return this.data[0]},_up:function(pos){for(var data=this.data,compare=this.compare,item=data[pos];pos>0;){var parent=pos-1>>1,current=data[parent];if(compare(item,current)>=0)break;data[pos]=current,pos=parent}data[pos]=item},_down:function(pos){for(var data=this.data,compare=this.compare,halfLength=this.length>>1,item=data[pos];pos<halfLength;){var left=1+(pos<<1),right=left+1,best=data[left];if(right<this.length&&compare(data[right],best)<0&&(left=right,best=data[right]),compare(best,item)>=0)break;data[pos]=best,pos=left}data[pos]=item}};var earcut$1={exports:{}};function earcut(data,holeIndices,dim){dim=dim||2;var minX,minY,maxX,maxY,x,y,invSize,hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;if(hasHoles&&(outerNode=function(data,holeIndices,outerNode,dim){var i,len,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)(list=linkedList(data,holeIndices[i]*dim,i<len-1?holeIndices[i+1]*dim:data.length,dim,!1))===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)outerNode=eliminateHole(queue[i],outerNode);return outerNode}(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)(x=data[i])<minX&&(minX=x),(y=data[i+1])<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);invSize=0!==(invSize=Math.max(maxX-minX,maxY-minY))?32767/invSize:0}return earcutLinked(outerNode,triangles,dim,minX,minY,invSize,0),triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0)for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)break;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(ear){!pass&&invSize&&function(start,minX,minY,invSize){var p=start;do{0===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,invSize)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,function(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)0!==pSize&&(0===qSize||!q||p.z<=q.z)?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1)}(p)}(ear,minX,minY,invSize);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear))triangles.push(prev.i/dim|0),triangles.push(ear.i/dim|0),triangles.push(next.i/dim|0),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(filterPoints(ear),triangles,dim),triangles,dim,minX,minY,invSize,2):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,p=c.next;p!==a;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,minZ=zOrder(x0,y0,minX,minY,invSize),maxZ=zOrder(x1,y1,minX,minY,invSize),p=ear.prevZ,n=ear.nextZ;p&&p.z>=minZ&&n&&n.z<=maxZ;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(;p&&p.z>=minZ;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;n&&n.z<=maxZ;){if(n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim|0),triangles.push(p.i/dim|0),triangles.push(b.i/dim|0),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return filterPoints(p)}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,invSize,0),void earcutLinked(c,triangles,dim,minX,minY,invSize,0)}b=b.next}a=a.next}while(a!==start)}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){var bridge=function(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx&&(qx=x,m=p.x<p.next.x?p:p.next,x===hx))return m}p=p.next}while(p!==outerNode);if(!m)return null;var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0;p=m;do{hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&(tan=Math.abs(hy-p.y)/(hx-p.x),locallyInside(p,hole)&&(tan<tanMin||tan===tanMin&&(p.x>m.x||p.x===m.x&&sectorContainsSector(m,p)))&&(m=p,tanMin=tan)),p=p.next}while(p!==stop);return m}(hole,outerNode);if(!bridge)return outerNode;var bridgeReverse=splitPolygon(bridge,hole);return filterPoints(bridgeReverse,bridgeReverse.next),filterPoints(bridge,bridge.next)}function sectorContainsSector(m,p){return area(m.prev,m,p.prev)<0&&area(p.next,m,m.next)<0}function zOrder(x,y,minX,minY,invSize){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=(x-minX)*invSize|0)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=(y-minY)*invSize|0)|y<<8))|y<<4))|y<<2))|y<<1))<<1}function getLeftmost(start){var p=start,leftmost=start;do{(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)&&(leftmost=p),p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)>=(ax-px)*(cy-py)&&(ax-px)*(by-py)>=(bx-px)*(ay-py)&&(bx-px)*(cy-py)>=(cx-px)*(by-py)}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!function(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}(a,b)&&(locallyInside(a,b)&&locallyInside(b,a)&&function(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next}while(p!==a);return inside}(a,b)&&(area(a.prev,a,b.prev)||area(a,b.prev,b))||equals(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){var o1=sign(area(p1,q1,p2)),o2=sign(area(p1,q1,q2)),o3=sign(area(p2,q2,p1)),o4=sign(area(p2,q2,q1));return o1!==o2&&o3!==o4||(!(0!==o1||!onSegment(p1,p2,q1))||(!(0!==o2||!onSegment(p1,q2,q1))||(!(0!==o3||!onSegment(p2,p1,q2))||!(0!==o4||!onSegment(p2,q1,q2)))))}function onSegment(p,q,r){return q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y)}function sign(num){return num>0?1:num<0?-1:0}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}earcut$1.exports=earcut,earcut$1.exports.default=earcut,earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,polygonArea=Math.abs(signedArea(data,0,hasHoles?holeIndices[0]*dim:data.length,dim));if(hasHoles)for(var i=0,len=holeIndices.length;i<len;i++){polygonArea-=Math.abs(signedArea(data,holeIndices[i]*dim,i<len-1?holeIndices[i+1]*dim:data.length,dim))}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return 0===polygonArea&&0===trianglesArea?0:Math.abs((trianglesArea-polygonArea)/polygonArea)},earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&result.holes.push(holeIndex+=data[i-1].length)}return result};
/*!
	 * @maptalks/vector-packer v0.74.2
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.com
	 */
const g$4={Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6};function b$6(e,t={}){var i=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)x$6(i,e.features[r],t,r);else x$6(i,"Feature"===e.type?e:{geometry:e},t);return i}function x$6(e,t,i,r){if(t.geometry&&t.geometry.geometry){var n=t.geometry.coordinates,o=t.geometry.type,a=[],s=t.id;if(i.promoteId?s=t.properties[i.promoteId]:i.generateId&&(s=r||0),"Point"===o)v$5(n,a);else if("MultiPoint"===o)for(var l=0;l<n.length;l++)v$5(n[l],a);else if("LineString"===o)k$5([n],a);else if("MultiLineString"===o){if(i.lineMetrics){for(l=0;l<n.length;l++)w$6(n[l],a=[]),e.push(z$4(s,"LineString",a,t.properties));return}k$5(n,a)}else if("Polygon"===o)k$5(n,a);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<t.geometry.geometries.length;l++)x$6(e,{id:s,geometry:t.geometry.geometries[l],properties:t.properties},i,r);return}return void console.warn(`Input data type(${o}) is not a valid GeoJSON geometry type.`)}for(l=0;l<n.length;l++){var u=[];k$5(n[l],u),a.push(u)}}e.push(z$4(s,o,a,t.properties))}}function v$5(t,i){const r=new pointGeometry(t[0],t[1]);r.z=100*(t[2]||0),i.push([r])}function w$6(t,i){for(let r=0;r<t.length;r++){const n=new pointGeometry(t[r][0],t[r][1]);n.z=100*(t[r][2]||0),i.push(n)}}function k$5(e,t,i,r){for(var n=0;n<e.length;n++){var o=[];w$6(e[n],o),t.push(o)}}function z$4(e,t,i,r){return{id:void 0===e?null:e,type:g$4[t],geometry:i,properties:r}}
/*!
	 * Codes from mapbox-gl-js
	 * github.com/mapbox/mapbox-gl-js
	 * MIT License
	 */function A$4(e,{width:t,height:i},r,n){if(n){if(n.length!==t*i*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(t*i*r);return e.width=t,e.height=i,e.data=n,e}function _$5(e,{width:t,height:i},r){if(t===e.width&&i===e.height)return;const n=A$4({},{width:t,height:i},r);T$5(e,n,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,i)},r),e.width=t,e.height=i,e.data=n.data}function T$5(e,t,i,r,n,o){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const a=e.data,s=t.data;if(a===s)return t;for(let l=0;l<n.height;l++){const u=((i.y+l)*e.width+i.x)*o,c=((r.y+l)*t.width+r.x)*o;for(let e=0;e<n.width*o;e++)s[c+e]=a[u+e]}return t}class j$4{constructor(e,t){A$4(this,e,1,t)}resize(e){_$5(this,e,1)}clone(){return new j$4({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){T$5(e,t,i,r,n,1)}}class F$6{constructor(e,t){A$4(this,e,4,t)}resize(e){_$5(this,e,4)}clone(){return new F$6({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){T$5(e,t,i,r,n,4)}}
/*!
	 * Codes from mapbox-gl-js
	 * github.com/mapbox/mapbox-gl-js
	 * MIT License
	 */class P$6{constructor(e,{pixelRatio:t}){this.paddedRect=e,this.pixelRatio=t||1}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class S$6{constructor(e){this.glyphMap=e,this.build()}build(){const e=this.glyphMap,i={},r=new ShelfPack(0,0,{autoResize:!0}),n=[];for(const t in e){const r=e[t],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(o),i[t]=new P$6(o,r)}if(r.pack(n,{inPlace:!0}),!M$5(r.w)||!M$5(r.h)){const e=I$5(r.w),t=I$5(r.h);r.resize(e,t)}const o=new F$6({width:r.w,height:r.h});for(const t in e){const r=e[t],n=i[t].paddedRect;F$6.copy(r.data,o,{x:0,y:0},{x:n.x+1,y:n.y+1},r.data)}this.image=o,this.positions=i}}function M$5(e){return 0==(e&e-1)&&0!==e}function I$5(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}
/*!
	 * Codes from mapbox-gl-js
	 * github.com/mapbox/mapbox-gl-js
	 * MIT License
	 * TODO potpack
	 */class C$5{constructor(e){this.glyphMap=e,this.build()}build(){const e=this.glyphMap,i={},r=new ShelfPack(0,0,{autoResize:!0}),n=[];for(const t in e){const r=e[t],o=i[t]={};for(const e in r){const t=r[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const i={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};n.push(i),o[e]={rect:i,metrics:t.metrics}}}r.pack(n,{inPlace:!0});const o=new j$4({width:r.w,height:r.h});for(const t in e){const r=e[t];for(const e in r){const n=r[+e];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const a=i[t][e].rect;j$4.copy(n.bitmap,o,{x:0,y:0},{x:a.x+1,y:a.y+1},n.bitmap)}}this.image=o,this.positions=i}}function D$6(e){return e<65536?Uint16Array:Uint32Array}function E$5(e){return(e=Math.abs(e))<128?Int8Array:e<32768?Int16Array:Float32Array}function O$6(e){return e<256?Uint8Array:e<65536?Uint16Array:Float32Array}function L$6(e){const t=e.type,i=[];if(1===t||4===t)for(let t=0;t<e.geometry.length;t++)v$5(e.geometry[t],i);else if(2===t)k$5(e.geometry,i);else if(3===t)k$5(e.geometry,i);else if(5===t)k$5(e.geometry,i);else if(6===t)for(let t=0;t<e.geometry.length;t++){const r=[];k$5(e.geometry[t],r),i.push(r)}return e.geometry=i,e}function R$7(e){for(let t=1;t<arguments.length;t++){const i=arguments[t];for(const t in i)e[t]=i[t]}return e}function q$5(e){return null==e}function N$7(e){return"number"==typeof e&&!isNaN(e)}function $$5(e){return"object"==typeof e&&!!e}function U$5(e){return!q$5(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function W$5(e){return!q$5(e)&&("function"==typeof e||null!==e.constructor&&e.constructor===Function)}const V$6=Object.prototype.hasOwnProperty;function H$6(e,t){return V$6.call(e,t)}const G$5=Math.PI/180;function J$5(e){return e&&isFunctionDefinition(e)&&e.property}function B$7(e){const{pointAtTileRes:t,tileRatio:i}=e;return t*i}const Z$5={};function Y$4(e,t){if(Array.isArray(t))for(let i=0;i<t.length;i++)e[i]=255*t[i];else{t=Z$5[t]=Z$5[t]||color(t).array();for(let i=0;i<t.length;i++)e[i]=t[i]}return 3===e.length&&e.push(255),e}var K$6=Object.freeze({__proto__:null,now:function(){return Date.now()},extend:R$7,isNil:q$5,isNumber:N$7,isInteger:function(e){return(0|e)===e},isObject:$$5,isString:U$5,isFunction:W$5,hasOwn:H$6,join:function(e,t){return e.join?e.join(t||","):Array.prototype.join.call(e,t||",")},toRadian:function(e){return e*G$5},toDegree:function(e){return e/G$5},evaluate:function(e,t,i){return W$5(e)?e(void 0!==i?i:null,t):e},isFnTypeSymbol:J$5,getAltitudeToLocal:B$7,getTubeSizeScale:function(e){return"centimeter"===e||"cm"===e?1:"millimeter"===e||"mm"===e?.1:100},normalizeColor:Y$4});function Q$5(e){let t=0;for(let i,r,n=0,o=e.length,a=o-1;n<o;a=n++)i=e[n],r=e[a],t+=void 0!==i.x?(r.x-i.x)*(i.y+r.y):(r[0]-i[0])*(i[1]+r[1]);return t}function te$3(e,t,i){let r=i;return t&&e&&(r=e[t]),void 0===r&&(r=i),100*(r||0)}function re$3(e,t){return t<1/0&&(e.x<0||e.x>t||e.y<0||e.y>t)}function ne$3(e){return null==e}function oe$3(e,t,i){if(e===i||e===t)return e;const r=i-t;return((e-t)%r+r)%r+t}function ae$3(e){if(!e||!e.length)return{};let t=0,i=-1,r=e[0];const n={};for(let o=0,a=e.length;o<a;o++)o===a-1?n[r]=[t,a]:e[o]!==r&&(i=o,n[r]=[t,i],t=o,r=e[o]);return n}function se$3(e,t){if(!t)return null;const i={};for(let r=0;r<t.length;r++){const n=t[r],o=e[n];i[o]||(i[o]=[]),i[o].push(n)}return i}class le$3{constructor(e,t,i,r){this.feature=e,this.symbol=t,this.fnTypes=i,this.options=r}getPolygonResource(){let e=this.symbol.polygonPatternFile;const{polygonPatternFileFn:t}=this.fnTypes;return this._getResource(e,t)}getLineResource(){let e=this.symbol.linePatternFile;const{linePatternFileFn:t}=this.fnTypes;return this._getResource(e,t)}_getResource(e,t){return t&&(e=t(this.options.zoom,this.feature.properties)),e}}function ue$3(e,t,i,r){const n=Math.abs(r)>>15,o=n>>1,a=n%2;let s=r%Math.pow(2,15);const l=t+(o<<14)*Math.sign(t),u=i+(a<<14)*Math.sign(i);return e[0]=l,e[1]=u,s=Math.round(s),e[2]=0===s?r<0?-1:0:s,e}const ce$3=Math.pow(2,14),pe$3=Math.pow(2,15);var he$3={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90 orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Mercator, Natural Earth, and Winkel Tripel. Terrain, fog, sky and CustomLayerInterface are not supported for projections other than mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`)  it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},source_video:{type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesnt support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either ['horizontal', 'vertical'] or ['vertical', 'horizontal'], the order doesn't affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_symbol:{type:"boolean",doc:'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",doc:'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",doc:'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",doc:'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",doc:'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",doc:'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key]  value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key]  value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key]  value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key]  {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key]  {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0  ...  fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0  ...  fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `f0  ...  fn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},geometry_type:{type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},expression_name:{doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\n - a single literal value; or\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\n\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\nIf the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`'image'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`'format'`](#types-format) expression. A [`'coalesce'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `'image'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\'image\'`](#types-image) expression, `\'to-string\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns `null` if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0"}}},"geometry-type":{doc:"Returns the feature's geometry type: `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`. `Multi*` feature types are only returned in GeoJSON sources. When working with vector tile sources, use the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"distance-from-center":{doc:'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the fog. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the fog to the color of the sky. A value of zero leaves a sharp transition from fog to sky. Increasing the value blends the color of fog into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0"}}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0 (0 when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0 when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0, directly above, to 180, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},projection:{name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate Carre projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},terrain:{source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0 north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0 is directly above, at zenith, and 90 at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0 north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0 is directly above, at zenith, and 90 at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}}},de$3="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function fe$3(e){var t={exports:{}};return e(t,t.exports),t.exports}function me$3(e,t){return Object.prototype.hasOwnProperty.call(e,t)}
/*! https://mths.be/punycode v1.3.2 by @mathias */fe$3((function(e,t){!function(i){var r=t&&!t.nodeType&&t,n=e&&!e.nodeType&&e,o="object"==typeof de$3&&de$3;o.global!==o&&o.window!==o&&o.self!==o||(i=o);var a,s,l=2147483647,u=/^xn--/,c=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},d=Math.floor,f=String.fromCharCode;function m(e){throw RangeError(h[e])}function y(e,t){for(var i=e.length,r=[];i--;)r[i]=t(e[i]);return r}function g(e,t){var i=e.split("@"),r="";return i.length>1&&(r=i[0]+"@",e=i[1]),r+y((e=e.replace(p,".")).split("."),t).join(".")}function b(e){for(var t,i,r=[],n=0,o=e.length;n<o;)(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<o?56320==(64512&(i=e.charCodeAt(n++)))?r.push(((1023&t)<<10)+(1023&i)+65536):(r.push(t),n--):r.push(t);return r}function x(e){return y(e,(function(e){var t="";return e>65535&&(t+=f((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+f(e)})).join("")}function v(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function w(e,t,i){var r=0;for(e=i?d(e/700):e>>1,e+=d(e/t);e>455;r+=36)e=d(e/35);return d(r+36*e/(e+38))}function k(e){var t,i,r,n,o,a,s,u,c,p,h,f=[],y=e.length,g=0,b=128,v=72;for((i=e.lastIndexOf("-"))<0&&(i=0),r=0;r<i;++r)e.charCodeAt(r)>=128&&m("not-basic"),f.push(e.charCodeAt(r));for(n=i>0?i+1:0;n<y;){for(o=g,a=1,s=36;n>=y&&m("invalid-input"),((u=(h=e.charCodeAt(n++))-48<10?h-22:h-65<26?h-65:h-97<26?h-97:36)>=36||u>d((l-g)/a))&&m("overflow"),g+=u*a,!(u<(c=s<=v?1:s>=v+26?26:s-v));s+=36)a>d(l/(p=36-c))&&m("overflow"),a*=p;v=w(g-o,t=f.length+1,0==o),d(g/t)>l-b&&m("overflow"),b+=d(g/t),g%=t,f.splice(g++,0,b)}return x(f)}function z(e){var t,i,r,n,o,a,s,u,c,p,h,y,g,x,k,z=[];for(y=(e=b(e)).length,t=128,i=0,o=72,a=0;a<y;++a)(h=e[a])<128&&z.push(f(h));for(r=n=z.length,n&&z.push("-");r<y;){for(s=l,a=0;a<y;++a)(h=e[a])>=t&&h<s&&(s=h);for(s-t>d((l-i)/(g=r+1))&&m("overflow"),i+=(s-t)*g,t=s,a=0;a<y;++a)if((h=e[a])<t&&++i>l&&m("overflow"),h==t){for(u=i,c=36;!(u<(p=c<=o?1:c>=o+26?26:c-o));c+=36)z.push(f(v(p+(k=u-p)%(x=36-p),0))),u=d(k/x);z.push(f(v(u,0))),o=w(i,g,r==n),i=0,++r}++i,++t}return z.join("")}if(a={version:"1.3.2",ucs2:{decode:b,encode:x},decode:k,encode:z,toASCII:function(e){return g(e,(function(e){return c.test(e)?"xn--"+z(e):e}))},toUnicode:function(e){return g(e,(function(e){return u.test(e)?k(e.slice(4).toLowerCase()):e}))}},r&&n)if(e.exports==r)n.exports=a;else for(s in a)a.hasOwnProperty(s)&&(r[s]=a[s]);else i.punycode=a}(de$3)}));var ye$3=function(e,t,i,r){i=i||"=";var n={};if("string"!=typeof e||0===e.length)return n;var o=/\+/g;e=e.split(t=t||"&");var a=1e3;r&&"number"==typeof r.maxKeys&&(a=r.maxKeys);var s=e.length;a>0&&s>a&&(s=a);for(var l=0;l<s;++l){var u,c,p,h,d=e[l].replace(o,"%20"),f=d.indexOf(i);f>=0?(u=d.substr(0,f),c=d.substr(f+1)):(u=d,c=""),p=decodeURIComponent(u),h=decodeURIComponent(c),me$3(n,p)?Array.isArray(n[p])?n[p].push(h):n[p]=[n[p],h]:n[p]=h}return n},ge$3=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},be$3=function(e,t,i,r){return t=t||"&",i=i||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(r){var n=encodeURIComponent(ge$3(r))+i;return Array.isArray(e[r])?e[r].map((function(e){return n+encodeURIComponent(ge$3(e))})).join(t):n+encodeURIComponent(ge$3(e[r]))})).join(t):r?encodeURIComponent(ge$3(r))+i+encodeURIComponent(ge$3(e)):""};function xe$3(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}fe$3((function(e,t){t.decode=t.parse=ye$3,t.encode=t.stringify=be$3}));class ve$3 extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class we$3{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new we$3(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ke$3={kind:"null"},ze$3={kind:"number"},Ae$3={kind:"string"},_e$3={kind:"boolean"},Te$3={kind:"color"},je$3={kind:"object"},Fe$3={kind:"value"},Pe$3={kind:"collator"},Se$3={kind:"formatted"},Me$3={kind:"resolvedImage"};function Ie$3(e,t){return{kind:"array",itemType:e,N:t}}function Ce$3(e){if("array"===e.kind){const t=Ce$3(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const De$3=[ke$3,ze$3,Ae$3,_e$3,Te$3,Se$3,je$3,Ie$3(Fe$3),Me$3];function Ee$3(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Ee$3(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of De$3)if(!Ee$3(e,t))return null}return`Expected ${Ce$3(e)} but found ${Ce$3(t)} instead.`}function Oe$3(e,t){return t.some((t=>t.kind===e.kind))}function Le$3(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}var Re$3=fe$3((function(e,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function o(e){return r("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function a(e){return function(e){return e<0?0:e>1?1:e}("%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))}function s(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in i)return i[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=n.indexOf("("),u=n.indexOf(")");if(-1!==l&&u+1===n.length){var c=n.substr(0,l),p=n.substr(l+1,u-(l+1)).split(","),h=1;switch(c){case"rgba":if(4!==p.length)return null;h=a(p.pop());case"rgb":return 3!==p.length?null:[o(p[0]),o(p[1]),o(p[2]),h];case"hsla":if(4!==p.length)return null;h=a(p.pop());case"hsl":if(3!==p.length)return null;var d=(parseFloat(p[0])%360+360)%360/360,f=a(p[1]),m=a(p[2]),y=m<=.5?m*(f+1):m+f-m*f,g=2*m-y;return[r(255*s(g,y,d+1/3)),r(255*s(g,y,d)),r(255*s(g,y,d-1/3)),h];default:return null}}return null}}catch(e){}}));class qe$3{constructor(e,t,i,r=1){this.r=e,this.g=t,this.b=i,this.a=r}static parse(e){if(!e)return;if(e instanceof qe$3)return e;if("string"!=typeof e)return;const t=Re$3.parseCSSColor(e);return t?new qe$3(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,i,r]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${r})`}toArray(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*e/r,255*t/r,255*i/r,r]}}qe$3.black=new qe$3(0,0,0,1),qe$3.white=new qe$3(1,1,1,1),qe$3.transparent=new qe$3(0,0,0,0),qe$3.red=new qe$3(1,0,0,1),qe$3.blue=new qe$3(0,0,1,1);class Ne$3{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $e$3{constructor(e,t,i,r,n){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n}}class Ue$3{constructor(e){this.sections=e}static fromString(e){return new Ue$3([new $e$3(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof Ue$3?e:Ue$3.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class We$3{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new We$3({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ve$3(e,t,i,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function He$3(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof qe$3)return!0;if(e instanceof Ne$3)return!0;if(e instanceof Ue$3)return!0;if(e instanceof We$3)return!0;if(Array.isArray(e)){for(const t of e)if(!He$3(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!He$3(e[t]))return!1;return!0}return!1}function Ge$3(e){if(null===e)return ke$3;if("string"==typeof e)return Ae$3;if("boolean"==typeof e)return _e$3;if("number"==typeof e)return ze$3;if(e instanceof qe$3)return Te$3;if(e instanceof Ne$3)return Pe$3;if(e instanceof Ue$3)return Se$3;if(e instanceof We$3)return Me$3;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=Ge$3(t);if(i){if(i===e)continue;i=Fe$3;break}i=e}return Ie$3(i||Fe$3,t)}return je$3}function Je$3(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof qe$3||e instanceof Ue$3||e instanceof We$3?e.toString():JSON.stringify(e)}class Be$3{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!He$3(e[1]))return t.error("invalid value");const i=e[1];let r=Ge$3(i);const n=t.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new Be$3(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof qe$3?["rgba"].concat(this.value.toArray()):this.value instanceof Ue$3?this.value.serialize():this.value}}class Xe$3{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ze$3={string:Ae$3,number:ze$3,boolean:_e$3,object:je$3};class Ye$3{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,r=1;const n=e[0];if("array"===n){let n,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in Ze$3)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=Ze$3[i],r++}else n=Fe$3;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}i=Ie$3(n,o)}else i=Ze$3[n];const o=[];for(;r<e.length;r++){const i=t.parse(e[r],r,Fe$3);if(!i)return null;o.push(i)}return new Ye$3(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!Ee$3(this.type,Ge$3(i)))return i;if(t===this.args.length-1)throw new Xe$3(`Expected value to be of type ${Ce$3(this.type)}, but found ${Ce$3(Ge$3(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((e=>e.serialize())))}}class Ke$3{constructor(e){this.type=Se$3,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,ze$3),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,Ie$3(Ae$3)),!i))return null;let a=null;if(o["text-color"]&&(a=t.parse(o["text-color"],1,Te$3),!a))return null;const s=r[r.length-1];s.scale=e,s.font=i,s.textColor=a}else{const o=t.parse(e[i],1,Fe$3);if(!o)return null;const a=o.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new Ke$3(r)}evaluate(e){return new Ue$3(this.sections.map((t=>{const i=t.content.evaluate(e);return Ge$3(i)===Me$3?new $e$3("",i,null,null,null):new $e$3(Je$3(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class Qe$3{constructor(e){this.type=Me$3,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Ae$3);return i?new Qe$3(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=We$3.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const et$4={"to-boolean":_e$3,"to-color":Te$3,"to-number":ze$3,"to-string":Ae$3};class tt$4{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const r=et$4[i],n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,Fe$3);if(!r)return null;n.push(r)}return new tt$4(r,n)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof qe$3)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Ve$3(t[0],t[1],t[2],t[3]),!i))return new qe$3(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Xe$3(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new Xe$3(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Ue$3.fromString(Je$3(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?We$3.fromString(Je$3(this.args[0].evaluate(e))):Je$3(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Ke$3([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Qe$3(this.args[0]).serialize();const e=["to-"+this.type.kind];return this.eachChild((t=>{e.push(t.serialize())})),e}}const it$4=["Unknown","Point","LineString","Polygon"];class rt$4{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?it$4[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=qe$3.parse(e)),t}}class nt$4{constructor(e,t,i,r){this.name=e,this.type=t,this._evaluate=i,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],r=nt$4.definitions[i];if(!r)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,a=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let s=null;for(const[r,o]of a){s=new Tt$3(t.registry,t.path,null,t.scope);const a=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],n=Array.isArray(r)?r[t-1]:r.type,o=s.parse(i,1+a.length,n);if(!o){l=!0;break}a.push(o)}if(!l)if(Array.isArray(r)&&r.length!==a.length)s.error(`Expected ${r.length} arguments, but found ${a.length} instead.`);else{for(let e=0;e<a.length;e++){const t=Array.isArray(r)?r[e]:r.type,i=a[e];s.concat(e+1).checkSubtype(t,i.type)}if(0===s.errors.length)return new nt$4(i,n,o,a)}}if(1===a.length)t.errors.push(...s.errors);else{const i=(a.length?a:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Ce$3).join(", ")})`:`(${Ce$3(t.type)}...)`;var t})).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push(Ce$3(n.type))}t.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){nt$4.definitions=t;for(const i in t)e[i]=nt$4}}class ot$4{constructor(e,t,i){this.type=Pe$3,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,_e$3);if(!r)return null;const n=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,_e$3);if(!n)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,Ae$3),!o)?null:new ot$4(r,n,o)}evaluate(e){return new Ne$3(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function at$4(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function st$4(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function lt$4(e,t){const i=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(i*n*8192),Math.round(r*n*8192)]}function ut$4(e,t,i){const r=e[0]-t[0],n=e[1]-t[1],o=e[0]-i[0],a=e[1]-i[1];return r*a-o*n==0&&r*o<=0&&n*a<=0}function ct$4(e,t){let i=!1;for(let a=0,s=t.length;a<s;a++){const s=t[a];for(let t=0,a=s.length;t<a-1;t++){if(ut$4(e,s[t],s[t+1]))return!1;(n=s[t])[1]>(r=e)[1]!=(o=s[t+1])[1]>r[1]&&r[0]<(o[0]-n[0])*(r[1]-n[1])/(o[1]-n[1])+n[0]&&(i=!i)}}var r,n,o;return i}function pt$4(e,t){for(let i=0;i<t.length;i++)if(ct$4(e,t[i]))return!0;return!1}function ht$4(e,t,i,r){const n=r[0]-i[0],o=r[1]-i[1],a=(e[0]-i[0])*o-n*(e[1]-i[1]),s=(t[0]-i[0])*o-n*(t[1]-i[1]);return a>0&&s<0||a<0&&s>0}function dt$4(e,t,i){for(const u of i)for(let i=0;i<u.length-1;++i)if(void 0,void 0,0!=(s=[(a=u[i+1])[0]-(o=u[i])[0],a[1]-o[1]])[0]*(l=[(n=t)[0]-(r=e)[0],n[1]-r[1]])[1]-s[1]*l[0]&&ht$4(r,n,o,a)&&ht$4(o,a,r,n))return!0;var r,n,o,a,s,l;return!1}function ft$4(e,t){for(let i=0;i<e.length;++i)if(!ct$4(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(dt$4(e[i],e[i+1],t))return!1;return!0}function mt$4(e,t){for(let i=0;i<t.length;i++)if(ft$4(e,t[i]))return!0;return!1}function yt$3(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=[];for(let r=0;r<e[n].length;r++){const a=lt$4(e[n][r],i);at$4(t,a),o.push(a)}r.push(o)}return r}function gt$4(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=yt$3(e[n],t,i);r.push(o)}return r}function bt$3(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const t=.5*r;let n=e[0]-i[0]>t?-r:i[0]-e[0]>t?r:0;0===n&&(n=e[0]-i[2]>t?-r:i[2]-e[0]>t?r:0),e[0]+=n}at$4(t,e)}function xt$3(e,t,i,r){const n=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[];if(!e)return a;for(const r of e)for(const e of r){const r=[e.x+o[0],e.y+o[1]];bt$3(r,t,i,n),a.push(r)}return a}function vt$3(e,t,i,r){const n=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[];if(!e)return a;for(const i of e){const e=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];at$4(t,i),e.push(i)}a.push(e)}if(t[2]-t[0]<=n/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of a)for(const r of e)bt$3(r,t,i,n)}var s;return a}class wt$3{constructor(e,t){this.type=_e$3,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(He$3(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new wt$3(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new wt$3(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new wt$3(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const o=yt$3(t.coordinates,r,n),a=xt$3(e.geometry(),i,r,n);if(!st$4(i,r))return!1;for(const e of a)if(!ct$4(e,o))return!1}if("MultiPolygon"===t.type){const o=gt$4(t.coordinates,r,n),a=xt$3(e.geometry(),i,r,n);if(!st$4(i,r))return!1;for(const e of a)if(!pt$4(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const o=yt$3(t.coordinates,r,n),a=vt$3(e.geometry(),i,r,n);if(!st$4(i,r))return!1;for(const e of a)if(!ft$4(e,o))return!1}if("MultiPolygon"===t.type){const o=gt$4(t.coordinates,r,n),a=vt$3(e.geometry(),i,r,n);if(!st$4(i,r))return!1;for(const e of a)if(!mt$4(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function kt$3(e){if(e instanceof nt$4){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof wt$3)return!1;let t=!0;return e.eachChild((e=>{t&&!kt$3(e)&&(t=!1)})),t}function zt$3(e){if(e instanceof nt$4&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!zt$3(e)&&(t=!1)})),t}function At$3(e,t){if(e instanceof nt$4&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!At$3(e,t)&&(i=!1)})),i}class _t$3{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new _t$3(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Tt$3{constructor(e,t=[],i,r=new we$3,n=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=r,this.errors=n,this.expectedType=i}parse(e,t,i,r,n={}){return t?this.concat(t,i,r)._parse(e,n):this._parse(e,n)}_parse(e,t){function i(e,t,i){return"assert"===i?new Ye$3(t,[e]):"coerce"===i?new tt$4(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=e[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,n=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"assert")}if(!(r instanceof Be$3)&&"resolvedImage"!==r.type.kind&&function e(t){if(t instanceof _t$3)return e(t.boundExpression);if(t instanceof nt$4&&"error"===t.name)return!1;if(t instanceof ot$4)return!1;if(t instanceof wt$3)return!1;const i=t instanceof tt$4||t instanceof Ye$3;let r=!0;return t.eachChild((t=>{r=i?r&&e(t):r&&t instanceof Be$3})),!!r&&(kt$3(t)&&At$3(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}(r)){const e=new rt$4;try{r=new Be$3(r.type,r.evaluate(e))}catch(e){return this.error(e.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const r="number"==typeof e?this.path.concat(e):this.path,n=i?this.scope.concat(i):this.scope;return new Tt$3(this.registry,r,t||null,n,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new ve$3(i,e))}checkSubtype(e,t){const i=Ee$3(e,t);return i&&this.error(i),i}}function jt$3(e,t){const i=e.length-1;let r,n,o=0,a=i,s=0;for(;o<=a;)if(s=Math.floor((o+a)/2),r=e[s],n=e[s+1],r<=t){if(s===i||t<n)return s;o=s+1}else{if(!(r>t))throw new Xe$3("Input is not a number.");a=s-1}return 0}class Ft$3{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,ze$3);if(!i)return null;const r=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],a=e[i+1],s=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(r.length&&r[r.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const u=t.parse(a,l,n);if(!u)return null;n=n||u.type,r.push([o,u])}return new Ft$3(n,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;return r>=t[n-1]?i[n-1].evaluate(e):i[jt$3(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Pt$3=St$3;function St$3(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=i,this.p2y=r}function Mt$3(e,t,i){return e*(1-i)+t*i}St$3.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},St$3.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},St$3.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},St$3.prototype.solveCurveX=function(e,t){var i,r,n,o,a;for(void 0===t&&(t=1e-6),n=e,a=0;a<8;a++){if(o=this.sampleCurveX(n)-e,Math.abs(o)<t)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=o/s}if((n=e)<(i=0))return i;if(n>(r=1))return r;for(;i<r;){if(o=this.sampleCurveX(n),Math.abs(o-e)<t)return n;e>o?i=n:r=n,n=.5*(r-i)+i}return n},St$3.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var It$3=Object.freeze({__proto__:null,number:Mt$3,color:function(e,t,i){return new qe$3(Mt$3(e.r,t.r,i),Mt$3(e.g,t.g,i),Mt$3(e.b,t.b,i),Mt$3(e.a,t.a,i))},array:function(e,t,i){return e.map(((e,r)=>Mt$3(e,t[r],i)))}});const Ct$3=6/29,Dt$3=3*Ct$3*Ct$3,Et$3=Math.PI/180,Ot$3=180/Math.PI;function Lt$3(e){return e>.008856451679035631?Math.pow(e,1/3):e/Dt$3+4/29}function Rt$3(e){return e>Ct$3?e*e*e:Dt$3*(e-4/29)}function qt$3(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Nt$3(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function $t$3(e){const t=Nt$3(e.r),i=Nt$3(e.g),r=Nt$3(e.b),n=Lt$3((.4124564*t+.3575761*i+.1804375*r)/.95047),o=Lt$3((.2126729*t+.7151522*i+.072175*r)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-Lt$3((.0193339*t+.119192*i+.9503041*r)/1.08883)),alpha:e.a}}function Ut$3(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*Rt$3(t),i=.95047*Rt$3(i),r=1.08883*Rt$3(r),new qe$3(qt$3(3.2404542*i-1.5371385*t-.4985314*r),qt$3(-.969266*i+1.8760108*t+.041556*r),qt$3(.0556434*i-.2040259*t+1.0572252*r),e.alpha)}function Wt$3(e,t,i){const r=t-e;return e+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const Vt$3={forward:$t$3,reverse:Ut$3,interpolate:function(e,t,i){return{l:Mt$3(e.l,t.l,i),a:Mt$3(e.a,t.a,i),b:Mt$3(e.b,t.b,i),alpha:Mt$3(e.alpha,t.alpha,i)}}},Ht$3={forward:function(e){const{l:t,a:i,b:r}=$t$3(e),n=Math.atan2(r,i)*Ot$3;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Et$3,i=e.c;return Ut$3({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Wt$3(e.h,t.h,i),c:Mt$3(e.c,t.c,i),l:Mt$3(e.l,t.l,i),alpha:Mt$3(e.alpha,t.alpha,i)}}};var Gt$3=Object.freeze({__proto__:null,lab:Vt$3,hcl:Ht$3});class Jt$3{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,r){let n=0;if("exponential"===e.name)n=Bt$3(t,e.base,i,r);else if("linear"===e.name)n=Bt$3(t,1,i,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;n=new Pt$3(o[0],o[1],o[2],o[3]).solve(Bt$3(t,1,i,r))}return n}static parse(e,t){let[i,r,n,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error("Unknown interpolation type "+String(r[0]),1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,ze$3),!n)return null;const a=[];let s=null;"interpolate-hcl"===i||"interpolate-lab"===i?s=Te$3:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],r=o[e+1],n=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(a.length&&a[a.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const u=t.parse(r,l,s);if(!u)return null;s=s||u.type,a.push([i,u])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new Jt$3(s,i,r,n,a):t.error(`Type ${Ce$3(s)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);const o=jt$3(t,r),a=Jt$3.interpolationFactor(this.interpolation,r,t[o],t[o+1]),s=i[o].evaluate(e),l=i[o+1].evaluate(e);return"interpolate"===this.operator?It$3[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?Ht$3.reverse(Ht$3.interpolate(Ht$3.forward(s),Ht$3.forward(l),a)):Vt$3.reverse(Vt$3.interpolate(Vt$3.forward(s),Vt$3.forward(l),a))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Bt$3(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}class Xt$3{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of e.slice(1)){const e=t.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}const o=r&&n.some((e=>Ee$3(r,e.type)));return new Xt$3(o?Fe$3:i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args){if(r++,i=n.evaluate(e),i&&i instanceof We$3&&!i.available&&(t||(t=i),i=null,r===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class Zt$3{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let r=1;r<e.length-1;r+=2){const n=e[r];if("string"!=typeof n)return t.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;i.push([n,o])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new Zt$3(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}class Yt$3{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ze$3),r=t.parse(e[2],2,Ie$3(t.expectedType||Fe$3));return i&&r?new Yt$3(r.type.itemType,i,r):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new Xe$3(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new Xe$3(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new Xe$3(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Kt$3{constructor(e,t){this.type=_e$3,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Fe$3),r=t.parse(e[2],2,Fe$3);return i&&r?Oe$3(i.type,[_e$3,Ae$3,ze$3,ke$3,Fe$3])?new Kt$3(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ce$3(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!Le$3(t,["boolean","string","number","null"]))throw new Xe$3(`Expected first argument to be of type boolean, string, number or null, but found ${Ce$3(Ge$3(t))} instead.`);if(!Le$3(i,["string","array"]))throw new Xe$3(`Expected second argument to be of type array or string, but found ${Ce$3(Ge$3(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Qt$3{constructor(e,t,i){this.type=ze$3,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Fe$3),r=t.parse(e[2],2,Fe$3);if(!i||!r)return null;if(!Oe$3(i.type,[_e$3,Ae$3,ze$3,ke$3,Fe$3]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ce$3(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,ze$3);return n?new Qt$3(i,r,n):null}return new Qt$3(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!Le$3(t,["boolean","string","number","null"]))throw new Xe$3(`Expected first argument to be of type boolean, string, number or null, but found ${Ce$3(Ge$3(t))} instead.`);if(!Le$3(i,["string","array"]))throw new Xe$3(`Expected second argument to be of type array or string, but found ${Ce$3(Ge$3(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(e);return i.indexOf(t,r)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ei$2{constructor(e,t,i,r,n,o){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n={},o=[];for(let a=2;a<e.length-1;a+=2){let s=e[a];const l=e[a+1];Array.isArray(s)||(s=[s]);const u=t.concat(a);if(0===s.length)return u.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return u.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return u.error("Numeric branch labels must be integer values.");if(i){if(u.checkSubtype(i,Ge$3(e)))return null}else i=Ge$3(e);if(void 0!==n[String(e)])return u.error("Branch labels must be unique.");n[String(e)]=o.length}const c=t.parse(l,a,r);if(!c)return null;r=r||c.type,o.push(c)}const a=t.parse(e[1],1,Fe$3);if(!a)return null;const s=t.parse(e[e.length-1],e.length-1,r);return s?"value"!==a.type.kind&&t.concat(1).checkSubtype(i,a.type)?null:new ei$2(i,r,a,n,o,s):null}evaluate(e){const t=this.input.evaluate(e);return(Ge$3(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],r={};for(const e of t){const t=r[this.cases[e]];void 0===t?(r[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}const n=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,r]of i)e.push(1===r.length?n(r[0]):r.map(n)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}class ti$2{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r=[];for(let n=1;n<e.length-1;n+=2){const o=t.parse(e[n],n,_e$3);if(!o)return null;const a=t.parse(e[n+1],n+1,i);if(!a)return null;r.push([o,a]),i=i||a.type}const n=t.parse(e[e.length-1],e.length-1,i);return n?new ti$2(i,r,n):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class ii$2{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Fe$3),r=t.parse(e[2],2,ze$3);if(!i||!r)return null;if(!Oe$3(i.type,[Ie$3(Fe$3),Ae$3,Fe$3]))return t.error(`Expected first argument to be of type array or string, but found ${Ce$3(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,ze$3);return n?new ii$2(i.type,i,r,n):null}return new ii$2(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!Le$3(t,["string","array"]))throw new Xe$3(`Expected first argument to be of type array or string, but found ${Ce$3(Ge$3(t))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(e);return t.slice(i,r)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ri$2(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ni$2(e,t,i,r){return 0===r.compare(t,i)}function oi$2(e,t,i){const r="=="!==e&&"!="!==e;return class n{constructor(e,t,i){this.type=_e$3,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,Fe$3);if(!o)return null;if(!ri$2(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${Ce$3(o.type)}'.`);let a=t.parse(e[2],2,Fe$3);if(!a)return null;if(!ri$2(i,a.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${Ce$3(a.type)}'.`);if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error(`Cannot compare types '${Ce$3(o.type)}' and '${Ce$3(a.type)}'.`);r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new Ye$3(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new Ye$3(o.type,[a])));let s=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,Pe$3),!s)return null}return new n(o,a,s)}evaluate(n){const o=this.lhs.evaluate(n),a=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const t=Ge$3(o),i=Ge$3(a);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new Xe$3(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=Ge$3(o),i=Ge$3(a);if("string"!==e.kind||"string"!==i.kind)return t(n,o,a)}return this.collator?i(n,o,a,this.collator.evaluate(n)):t(n,o,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const ai$2=oi$2("==",(function(e,t,i){return t===i}),ni$2),si$2=oi$2("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!ni$2(0,t,i,r)})),li$2=oi$2("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),ui$2=oi$2(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),ci$2=oi$2("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0})),pi$2=oi$2(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0}));class hi$2{constructor(e,t,i,r,n){this.type=Ae$3,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,ze$3);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=t.parse(r.locale,1,Ae$3),!n))return null;let o=null;if(r.currency&&(o=t.parse(r.currency,1,Ae$3),!o))return null;let a=null;if(r["min-fraction-digits"]&&(a=t.parse(r["min-fraction-digits"],1,ze$3),!a))return null;let s=null;return r["max-fraction-digits"]&&(s=t.parse(r["max-fraction-digits"],1,ze$3),!s)?null:new hi$2(i,n,o,a,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class di$2{constructor(e){this.type=ze$3,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${Ce$3(i.type)} instead.`):new di$2(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Xe$3(`Expected value to be of type string or array, but found ${Ce$3(Ge$3(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const fi$2={"==":ai$2,"!=":si$2,">":ui$2,"<":li$2,">=":pi$2,"<=":ci$2,array:Ye$3,at:Yt$3,boolean:Ye$3,case:ti$2,coalesce:Xt$3,collator:ot$4,format:Ke$3,image:Qe$3,in:Kt$3,"index-of":Qt$3,interpolate:Jt$3,"interpolate-hcl":Jt$3,"interpolate-lab":Jt$3,length:di$2,let:Zt$3,literal:Be$3,match:ei$2,number:Ye$3,"number-format":hi$2,object:Ye$3,slice:ii$2,step:Ft$3,string:Ye$3,"to-boolean":tt$4,"to-color":tt$4,"to-number":tt$4,"to-string":tt$4,var:_t$3,within:wt$3};function mi$2(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const o=n?n.evaluate(e):1,a=Ve$3(t,i,r,o);if(a)throw new Xe$3(a);return new qe$3(t/255*o,i/255*o,r/255*o,o)}function yi$2(e,t){return e in t}function gi$2(e,t){const i=t[e];return void 0===i?null:i}function bi$2(e){return{type:e}}function xi$2(e){return{result:"success",value:e}}function vi$2(e){return{result:"error",value:e}}function wi$2(e){return!!e.expression&&e.expression.interpolated}function ki$2(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function zi$2(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Ai$2(e){return e}function _i$2(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function Ti$2(e,t,i,r,n){return _i$2(typeof i===n?r[i]:void 0,e.default,t.default)}function ji$2(e,t,i){if("number"!==ki$2(i))return _i$2(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const n=jt$3(e.stops.map((e=>e[0])),i);return e.stops[n][1]}function Fi$2(e,t,i){const r=void 0!==e.base?e.base:1;if("number"!==ki$2(i))return _i$2(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const o=jt$3(e.stops.map((e=>e[0])),i),a=function(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}(i,r,e.stops[o][0],e.stops[o+1][0]),s=e.stops[o][1],l=e.stops[o+1][1];let u=It$3[t.type]||Ai$2;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Gt$3[e.colorSpace];u=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),a))}return"function"==typeof s.evaluate?{evaluate(...e){const t=s.evaluate.apply(void 0,e),i=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==i)return u(t,i,a)}}:u(s,l,a)}function Pi$2(e,t,i){return"color"===t.type?i=qe$3.parse(i):"formatted"===t.type?i=Ue$3.fromString(i.toString()):"resolvedImage"===t.type?i=We$3.fromString(i.toString()):ki$2(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),_i$2(i,e.default,t.default)}nt$4.register(fi$2,{error:[{kind:"error"},[Ae$3],(e,[t])=>{throw new Xe$3(t.evaluate(e))}],typeof:[Ae$3,[Fe$3],(e,[t])=>Ce$3(Ge$3(t.evaluate(e)))],"to-rgba":[Ie$3(ze$3,4),[Te$3],(e,[t])=>t.evaluate(e).toArray()],rgb:[Te$3,[ze$3,ze$3,ze$3],mi$2],rgba:[Te$3,[ze$3,ze$3,ze$3,ze$3],mi$2],has:{type:_e$3,overloads:[[[Ae$3],(e,[t])=>yi$2(t.evaluate(e),e.properties())],[[Ae$3,je$3],(e,[t,i])=>yi$2(t.evaluate(e),i.evaluate(e))]]},get:{type:Fe$3,overloads:[[[Ae$3],(e,[t])=>gi$2(t.evaluate(e),e.properties())],[[Ae$3,je$3],(e,[t,i])=>gi$2(t.evaluate(e),i.evaluate(e))]]},"feature-state":[Fe$3,[Ae$3],(e,[t])=>gi$2(t.evaluate(e),e.featureState||{})],properties:[je$3,[],e=>e.properties()],"geometry-type":[Ae$3,[],e=>e.geometryType()],id:[Fe$3,[],e=>e.id()],zoom:[ze$3,[],e=>e.globals.zoom],pitch:[ze$3,[],e=>e.globals.pitch||0],"distance-from-center":[ze$3,[],e=>e.distanceFromCenter()],"heatmap-density":[ze$3,[],e=>e.globals.heatmapDensity||0],"line-progress":[ze$3,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[ze$3,[],e=>e.globals.skyRadialProgress||0],accumulated:[Fe$3,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[ze$3,bi$2(ze$3),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[ze$3,bi$2(ze$3),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:ze$3,overloads:[[[ze$3,ze$3],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[ze$3],(e,[t])=>-t.evaluate(e)]]},"/":[ze$3,[ze$3,ze$3],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[ze$3,[ze$3,ze$3],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[ze$3,[],()=>Math.LN2],pi:[ze$3,[],()=>Math.PI],e:[ze$3,[],()=>Math.E],"^":[ze$3,[ze$3,ze$3],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[ze$3,[ze$3],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[ze$3,[ze$3],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[ze$3,[ze$3],(e,[t])=>Math.log(t.evaluate(e))],log2:[ze$3,[ze$3],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[ze$3,[ze$3],(e,[t])=>Math.sin(t.evaluate(e))],cos:[ze$3,[ze$3],(e,[t])=>Math.cos(t.evaluate(e))],tan:[ze$3,[ze$3],(e,[t])=>Math.tan(t.evaluate(e))],asin:[ze$3,[ze$3],(e,[t])=>Math.asin(t.evaluate(e))],acos:[ze$3,[ze$3],(e,[t])=>Math.acos(t.evaluate(e))],atan:[ze$3,[ze$3],(e,[t])=>Math.atan(t.evaluate(e))],min:[ze$3,bi$2(ze$3),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[ze$3,bi$2(ze$3),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[ze$3,[ze$3],(e,[t])=>Math.abs(t.evaluate(e))],round:[ze$3,[ze$3],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[ze$3,[ze$3],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[ze$3,[ze$3],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[_e$3,[Ae$3,Fe$3],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[_e$3,[Fe$3],(e,[t])=>e.id()===t.value],"filter-type-==":[_e$3,[Ae$3],(e,[t])=>e.geometryType()===t.value],"filter-<":[_e$3,[Ae$3,Fe$3],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[_e$3,[Fe$3],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<r}],"filter->":[_e$3,[Ae$3,Fe$3],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[_e$3,[Fe$3],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>r}],"filter-<=":[_e$3,[Ae$3,Fe$3],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[_e$3,[Fe$3],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<=r}],"filter->=":[_e$3,[Ae$3,Fe$3],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[_e$3,[Fe$3],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>=r}],"filter-has":[_e$3,[Fe$3],(e,[t])=>t.value in e.properties()],"filter-has-id":[_e$3,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[_e$3,[Ie$3(Ae$3)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[_e$3,[Ie$3(Fe$3)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[_e$3,[Ae$3,Ie$3(Fe$3)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[_e$3,[Ae$3,Ie$3(Fe$3)],(e,[t,i])=>function(e,t,i,r){for(;i<=r;){const n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:_e$3,overloads:[[[_e$3,_e$3],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[bi$2(_e$3),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:_e$3,overloads:[[[_e$3,_e$3],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[bi$2(_e$3),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[_e$3,[_e$3],(e,[t])=>!t.evaluate(e)],"is-supported-script":[_e$3,[Ae$3],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[Ae$3,[Ae$3],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Ae$3,[Ae$3],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Ae$3,bi$2(Fe$3),(e,t)=>t.map((t=>Je$3(t.evaluate(e)))).join("")],"resolved-locale":[Ae$3,[Pe$3],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Si$2{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new rt$4,this._defaultValue=t?function(e){return"color"===e.type&&zi$2(e.default)?new qe$3(0,0,0,0):"color"===e.type?qe$3.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,n,o,a,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,o,a,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Xe$3(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Mi$2(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in fi$2}function Ii$2(e,t){const i=new Tt$3(fi$2,[],t?function(e){const t={color:Te$3,string:Ae$3,number:ze$3,enum:Ae$3,boolean:_e$3,formatted:Se$3,resolvedImage:Me$3};return"array"===e.type?Ie$3(t[e.value]||Fe$3,e.length):t[e.type]}(t):void 0),r=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?xi$2(new Si$2(r,t)):vi$2(i.errors)}class Ci$2{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!zt$3(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}}class Di$2{constructor(e,t,i,r){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!zt$3(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}interpolationFactor(e,t,i){return this.interpolationType?Jt$3.interpolationFactor(this.interpolationType,e,t,i):0}}function Ei$2(e,t){if("error"===(e=Ii$2(e,t)).result)return e;const i=e.value.expression,r=kt$3(i);if(!r&&!function(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}(t))return vi$2([new ve$3("","data expressions not supported")]);const n=At$3(i,["zoom","pitch","distance-from-center"]);if(!n&&!function(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}(t))return vi$2([new ve$3("","zoom expressions not supported")]);const o=function e(t){let i=null;if(t instanceof Zt$3)i=e(t.result);else if(t instanceof Xt$3){for(const r of t.args)if(i=e(r),i)break}else(t instanceof Ft$3||t instanceof Jt$3)&&t.input instanceof nt$4&&"zoom"===t.input.name&&(i=t);return i instanceof ve$3||t.eachChild((t=>{const r=e(t);r instanceof ve$3?i=r:!i&&r?i=new ve$3("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&r&&i!==r&&(i=new ve$3("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),i}(i);if(!o&&!n)return vi$2([new ve$3("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof ve$3)return vi$2([o]);if(o instanceof Jt$3&&!wi$2(t))return vi$2([new ve$3("",'"interpolate" expressions cannot be used with this property')]);if(!o)return xi$2(new Ci$2(r?"constant":"source",e.value));return xi$2(new Di$2(r?"camera":"composite",e.value,o.labels,o instanceof Jt$3?o.interpolation:void 0))}class Oi$2{constructor(e,t){this._parameters=e,this._specification=t,xe$3(this,function e(t,i){const r="color"===i.type,n=t.stops&&"object"==typeof t.stops[0][0],o=n||!(n||void 0!==t.property),a=t.type||(wi$2(i)?"exponential":"interval");if(r&&((t=xe$3({},t)).stops&&(t.stops=t.stops.map((e=>[e[0],qe$3.parse(e[1])]))),t.default=qe$3.parse(t.default?t.default:i.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Gt$3[t.colorSpace])throw new Error("Unknown color space: "+t.colorSpace);let s,l,u;if("exponential"===a)s=Fi$2;else if("interval"===a)s=ji$2;else if("categorical"===a){s=Ti$2,l=Object.create(null);for(const e of t.stops)l[e[0]]=e[1];u=typeof t.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);s=Pi$2}if(n){const r={},n=[];for(let e=0;e<t.stops.length;e++){const i=t.stops[e],o=i[0].zoom;void 0===r[o]&&(r[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},n.push(o)),r[o].stops.push([i[0].value,i[1]])}const o=[];for(const t of n)o.push([r[t].zoom,e(r[t],i)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:Jt$3.interpolationFactor.bind(void 0,a),zoomStops:o.map((e=>e[0])),evaluate:({zoom:e},r)=>Fi$2({stops:o,base:t.base},i,e).evaluate(e,r)}}if(o){const e="exponential"===a?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:e,interpolationFactor:Jt$3.interpolationFactor.bind(void 0,e),zoomStops:t.stops.map((e=>e[0])),evaluate:({zoom:e})=>s(t,i,e,l,u)}}return{kind:"source",evaluate(e,r){const n=r&&r.properties?r.properties[t.property]:void 0;return void 0===n?_i$2(t.default,i.default):s(t,i,n,l,u)}}}(this._parameters,this._specification))}static deserialize(e){return new Oi$2(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Li$2(e){if(Array.isArray(e))return e.map(Li$2);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=Li$2(e[i]);return t}return function(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}(e)}function Ri$2(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Ri$2(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Ni$2(e){if(!Array.isArray(e))return!1;if(function(e){return"pitch"===e||"distance-from-center"===e}(e[0]))return!0;for(let t=1;t<e.length;t++)if(Ni$2(e[t]))return!0;return!1}const $i$2=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ui$2(e,t){return e<t?-1:e>t?1:0}function Wi$2(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Vi$2(e[1],e[2],"=="):"!="===t?Ji$2(Vi$2(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Vi$2(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(Wi$2))):"all"===t?["all"].concat(e.slice(1).map(Wi$2)):"none"===t?["all"].concat(e.slice(1).map(Wi$2).map(Ji$2)):"in"===t?Hi$2(e[1],e.slice(2)):"!in"===t?Ji$2(Hi$2(e[1],e.slice(2))):"has"===t?Gi$2(e[1]):"!has"===t?Ji$2(Gi$2(e[1])):"within"!==t||e;var i}function Vi$2(e,t,i){switch(e){case"$type":return["filter-type-"+i,t];case"$id":return["filter-id-"+i,t];default:return["filter-"+i,e,t]}}function Hi$2(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(Ui$2)]]:["filter-in-small",e,["literal",t]]}}function Gi$2(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Ji$2(e){return["!",e]}fe$3((function(e,t){var i=function(){var e=function(e,t,i,r){for(i=i||{},r=e.length;r--;i[e[r]]=t);return i},t=[1,12],i=[1,13],r=[1,9],n=[1,10],o=[1,11],a=[1,14],s=[1,15],l=[14,18,22,24],u=[18,22],c=[22,24],p={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(e,t,i,r,n,o,a){var s=o.length-1;switch(n){case 1:this.$=new String(e.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(e),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=o[s-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=o[s-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[o[s-2],o[s]];break;case 16:this.$={},this.$[o[s][0]]=o[s][1];break;case 17:this.$=o[s-2],o[s-2][o[s][0]]=o[s][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[o[s]];break;case 21:this.$=o[s-2],o[s-2].push(o[s])}},table:[{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,12:1,13:2,15:7,16:8,17:a,23:s},{1:[3]},{14:[1,16]},e(l,[2,7]),e(l,[2,8]),e(l,[2,9]),e(l,[2,10]),e(l,[2,11]),e(l,[2,12]),e(l,[2,3]),e(l,[2,4]),e(l,[2,5]),e([14,18,21,22,24],[2,1]),e(l,[2,2]),{3:20,4:t,18:[1,17],19:18,20:19},{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,13:23,15:7,16:8,17:a,23:s,24:[1,21],25:22},{1:[2,6]},e(l,[2,13]),{18:[1,24],22:[1,25]},e(u,[2,16]),{21:[1,26]},e(l,[2,18]),{22:[1,28],24:[1,27]},e(c,[2,20]),e(l,[2,14]),{3:20,4:t,20:29},{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,13:30,15:7,16:8,17:a,23:s},e(l,[2,19]),{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,13:31,15:7,16:8,17:a,23:s},e(u,[2,17]),e(u,[2,15]),e(c,[2,21])],defaultActions:{16:[2,6]},parseError:function(e,t){if(!t.recoverable)throw new Error(e);this.trace(e)},parse:function(e){var t=this,i=[0],r=[null],n=[],o=this.table,a="",s=0,l=0,u=2,c=1,p=n.slice.call(arguments,1),h=Object.create(this.lexer),d={yy:{}};for(var f in this.yy)Object.prototype.hasOwnProperty.call(this.yy,f)&&(d.yy[f]=this.yy[f]);h.setInput(e,d.yy),d.yy.lexer=h,d.yy.parser=this,void 0===h.yylloc&&(h.yylloc={});var m=h.yylloc;n.push(m);var y=h.options&&h.options.ranges;function g(){var e;return"number"!=typeof(e=h.lex()||c)&&(e=t.symbols_[e]||e),e}this.parseError="function"==typeof d.yy.parseError?d.yy.parseError:Object.getPrototypeOf(this).parseError;for(var b,x,v,w,k,z,A,_={};;){if(this.defaultActions[x=i[i.length-1]]?v=this.defaultActions[x]:(null==b&&(b=g()),v=o[x]&&o[x][b]),void 0===v||!v.length||!v[0]){var T="";for(k in A=[],o[x])this.terminals_[k]&&k>u&&A.push("'"+this.terminals_[k]+"'");T=h.showPosition?"Parse error on line "+(s+1)+":\n"+h.showPosition()+"\nExpecting "+A.join(", ")+", got '"+(this.terminals_[b]||b)+"'":"Parse error on line "+(s+1)+": Unexpected "+(b==c?"end of input":"'"+(this.terminals_[b]||b)+"'"),this.parseError(T,{text:h.match,token:this.terminals_[b]||b,line:h.yylineno,loc:m,expected:A})}if(v[0]instanceof Array&&v.length>1)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+b);switch(v[0]){case 1:i.push(b),r.push(h.yytext),n.push(h.yylloc),i.push(v[1]),b=null,l=h.yyleng,a=h.yytext,s=h.yylineno,m=h.yylloc;break;case 2:if(_.$=r[r.length-(z=this.productions_[v[1]][1])],_._$={first_line:n[n.length-(z||1)].first_line,last_line:n[n.length-1].last_line,first_column:n[n.length-(z||1)].first_column,last_column:n[n.length-1].last_column},y&&(_._$.range=[n[n.length-(z||1)].range[0],n[n.length-1].range[1]]),void 0!==(w=this.performAction.apply(_,[a,l,s,d.yy,v[1],r,n].concat(p))))return w;z&&(i=i.slice(0,-1*z*2),r=r.slice(0,-1*z),n=n.slice(0,-1*z)),i.push(this.productions_[v[1]][0]),r.push(_.$),n.push(_._$),i.push(o[i[i.length-2]][i[i.length-1]]);break;case 3:return!0}}return!0}};function h(){this.yy={}}return p.lexer={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,i=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===r.length?this.yylloc.first_column:0)+r[r.length-i.length].length-i[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var i,r,n;if(this.options.backtrack_lexer&&(n={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(n.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],i=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var o in n)this[o]=n[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,i,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),o=0;o<n.length;o++)if((i=this._input.match(this.rules[n[o]]))&&(!t||i[0].length>t[0].length)){if(t=i,r=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(i,n[o])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,n[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,i,r){switch(i){case 0:break;case 1:return 6;case 2:return t.yytext=t.yytext.substr(1,t.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}},h.prototype=p,p.Parser=h,new h}();t.parser=i,t.Parser=i.Parser,t.parse=function(){return i.parse.apply(i,arguments)}}));const Bi$2={StyleExpression:Si$2,isExpression:Mi$2,isExpressionFilter:Ri$2,createExpression:Ii$2,createPropertyExpression:Ei$2,normalizePropertyExpression:function(e,t){if(zi$2(e))return new Oi$2(e,t);if(Mi$2(e)){const i=Ei$2(e,t);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return"string"==typeof e&&"color"===t.type&&(i=qe$3.parse(e)),{kind:"constant",evaluate:()=>i}}},ZoomConstantExpression:Ci$2,ZoomDependentExpression:Di$2,StylePropertyFunction:Oi$2},{isExpressionFilter:Xi$2,isExpression:Zi$2,createExpression:Yi$2}=Bi$2,Ki$2={};function Qi$2(e){if(!0===e)return function(){return!0};if(e&&e.condition){if("any"===e.type){const t=e.condition,i=[];for(let e=0;e<t.length;e++)i.push(Qi$2(t[e]));return(e,t)=>{for(let r=0;r<i.length;r++)if(i[r](e,t))return!0;return!1}}const t=Qi$2(e.condition);if(q$5(e.layer))return t;const i=t=>t.layer===e.layer;return(e,r)=>i(e)&&t(e,r)}if(Xi$2(e)){let t=function(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ri$2(e)||(e=Wi$2(e));const i=e;let r=!0;try{r=function(e){if(!Ni$2(e))return e;let t=Li$2(e);return function e(t){let i=!1;const r=[];if("case"===t[0]){for(let e=1;e<t.length-1;e+=2)i=i||Ni$2(t[e]),r.push(t[e+1]);r.push(t[t.length-1])}else if("match"===t[0]){i=i||Ni$2(t[1]);for(let e=2;e<t.length-1;e+=2)r.push(t[e+1]);r.push(t[t.length-1])}else if("step"===t[0]){i=i||Ni$2(t[1]);for(let e=1;e<t.length-1;e+=2)r.push(t[e+1])}i&&(t.length=0,t.push("any",...r));for(let i=1;i<t.length;i++)e(t[i])}(t),t=function e(t){if(!Array.isArray(t))return t;const i=function(e){if($i$2.has(e[0]))for(let t=1;t<e.length;t++)if(Ni$2(e[t]))return!0;return e}(t);return!0===i?i:i.map((t=>e(t)))}(t),t}(i)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const n=he$3["filter_"+t],o=Ii$2(r,n);let a=null;if("error"===o.result)throw new Error(o.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(e,t,i)=>o.value.evaluate(e,t,{},i);let s=null,l=null;if(r!==i){const e=Ii$2(i,n);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(t,i,r,n,o)=>e.value.evaluate(t,i,{},r,void 0,void 0,n,o),l=!kt$3(e.value.expression)}return{filter:a,dynamicFilter:s||void 0,needGeometry:function e(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let i=1;i<t.length;i++)if(e(t[i]))return!0;return!1}(r),needFeature:!!l}}(e);return t=t&&t.filter,(e,i)=>(Ki$2.zoom=i,t&&t(Ki$2,e))}return createFilter(e)}const er$3={type:"number","property-type":"data-driven",expression:{parameters:["zoom","feature"]}};function tr$3(e,t){er$3.type=t||"number";const i=Yi$2(e,er$3);if("success"!==i.result)throw new Error(`Invalid maplibre spec expression: ${JSON.stringify(e)} (${i.value})`);return i.value}function ir$3(e){return Zi$2(e)}const rr$3={lineWidth:1,lineStrokeWidth:1,lineDx:1,lineDy:1,lineOpacity:1,linePatternAnimSpeed:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerSpacing:1,markerOpacity:1,markerRotation:1,textWrapWidth:1,textSpacing:1,textSize:1,textHaloRadius:1,textHaloOpacity:1,textDx:1,textDy:1,textOpacity:1,textRotation:1,polygonOpacity:1};function nr$3(e){return rr$3[e]}const or$3={markerPlacement:1,markerFile:1,mergeOnProperty:1,markerTextFit:1,markerType:1,markerHorizontalAlignment:1,markerVerticalAlignment:1,markerRotationAlignment:1,markerPitchAlignment:1,markerFillPatternFile:1,markerLinePatternFile:1,textName:1,textPlacement:1,textFaceName:1,textStyle:1,textHorizontalAlignment:1,textVerticalAlignment:1,textRotationAlignment:1,textPitchAlignment:1,lineJoin:1,lineCap:1,linePatternFile:1,polygonPatternFile:1};function ar$3(e){return or$3[e]?"string":nr$3(e)?"number":"color"}var sr$3=Object.freeze({__proto__:null,compileStyle:function(e){return function e(t){if(!Array.isArray(t))return e([t]);const i=[];for(let e=0;e<t.length;e++){let r;r=!0===t[e].filter?function(){return!0}:Qi$2(t[e].filter),i.push(R$7({},t[e],{filter:r}))}return i}(e=e.map((e=>{const t=R$7({},e);return t.filter&&t.filter.value&&(t.filter=t.filter.value),t})))},compileFilter:Qi$2,createExpression:tr$3,isExpression:ir$3,isInterpolated:nr$3,getExpressionType:ar$3});const lr$3=[],ur$3={},cr$3={},pr$3={},hr$3=[];class dr$3{static isAtlasLoaded(e,t={}){const{iconAtlas:i}=t;return!!(!e||i&&i.positions[e])}static genFnTypes(e){const t={};for(const i in e)if(ir$3(e[i])){const r=(i+"_Fn_0").trim(),n=(i+"Fn").trim(),o=ar$3(i);t[r]=tr$3(e[i],o),t[n]=(e,i)=>{let n;ur$3.zoom=e,cr$3.properties=i;try{n=t[r].evaluateWithoutErrorHandling(ur$3,cr$3,pr$3,null,hr$3)}catch(e){return null}return n}}else if(J$5(e[i])){const o=(i+"_Fn_0").trim(),a=(i+"Fn").trim();nr$3(i)?(t[o]=interpolated(e[i]),t[a]=(e,i)=>{const n=t[o](e,i);return J$5(n)?interpolated(n)(e,i):n}):(t[o]=piecewiseConstant(e[i]),t[a]=(e,i)=>{const r=t[o](e,i);return J$5(r)?piecewiseConstant(r)(e,i):r})}return t}constructor(e,t,i){this.options=i,this.symbolDef=t,this.symbol=loadFunctionTypes(t,(()=>[i.zoom])),this.styledVectors=[],this.properties={},this._fnTypes=i.fnTypes||dr$3.genFnTypes(this.symbolDef),J$5(this.symbolDef.visible)&&(this._visibleFn=interpolated(this.symbolDef.visible)),i.atlas&&(this.iconAtlas=i.atlas.iconAtlas,this.glyphAtlas=i.atlas.glyphAtlas),this.features=this._check(e)}needAltitudeAttribute(){return this.options.forceAltitudeAttribute||this.maxPosZ>=Math.pow(2,17)||this.options.positionType===Float32Array}getPositionFormat(){return this.needAltitudeAttribute()?[{type:Int16Array,width:2,name:"aPosition"},{type:Float32Array,width:1,name:"aAltitude"}]:[{type:Int16Array,width:3,name:"aPosition"}]}fillPosition(e,t,i,r){this.needAltitudeAttribute()?(e.aPosition.push(t,i),e.aAltitude.push(r)):(ue$3(lr$3,t,i,r),e.aPosition.push(...lr$3))}_check(t){if(!t.length)return t;const i="__fea_idx".trim();let r,n=0,o=t[n];for(;!o.geometry;)n++,o=t[n];if(Array.isArray(o.geometry)&&o.properties){let i=o.geometry[0];for(;Array.isArray(i);)i=i[0];i instanceof pointGeometry&&(r=t)}if(!r)if(r=[],Array.isArray(o.geometry))for(let e=0;e<t.length;e++){const i=R$7({},t[e]);r.push(L$6(i))}else for(let e=0;e<t.length;e++){const n=t[e],o=b$6(n);for(let e=0;e<o.length;e++){const t=o[e];t[i]=n[i],r.push(t)}}if(this.maxPosZ=0,!this.options.forceAltitudeAttribute){const e="line"===this.symbolDef.textPlacement;let t=0,i=!1;const{textPitchAlignmentFn:n}=this._fnTypes;!n&&e&&"map"===this.symbolDef.textPitchAlignment&&(i=!0);for(let o=0;o<r.length;o++){const a=mr$3(r[o]&&r[o].geometry);if(a>t&&(t=a),e&&!i&&n&&r[o].properties){const e=n(null,r[o].properties);"map"===e&&(i=e)}}this.hasMapPitchAlign=i,this.maxPosZ=t}const a=this.options.order;if(a){const e=[];for(let t=0;t<a.length;t++)a[t]&&e.push(Qi$2(a[t]));r=r.sort(((t,i)=>{const r=e.length;let n=r,o=r;for(let a=0;a<r&&(e[a](t)&&(n=a),e[a](i)&&(o=a),!(n<r&&o<r));a++);return n-o}))}return r}load(e=1){const t="__fea_idx".trim(),i="_debug_info".trim(),r=this._fnTypes,n=this.styledVectors;this.count=0;const a=this.features;if(!a||!a.length)return Promise.resolve(null);const s={},l={},u={zoom:this.options.zoom},c=loadFunctionTypes(this.symbolDef,(()=>[u.zoom]));let p=0,h=a.length;const d=this.options.debugIndex;try{for(;p<h;p++){const e=a[p];if(!e||!e.geometry)continue;if(void 0!==d&&e[i].index!==d)continue;e.properties||(e.properties={}),e.properties.$layer=e.layer,e.properties.$type=e.type;const o=this.createStyledVector(e,c,r,u,s,l);o&&o.feature.geometry&&(o.featureIdx=void 0===e[t]?p:e[t],this.count++,n.push(o))}}catch(e){return Promise.reject(e)}return this.options.atlas?Promise.resolve(this.pack(e)):this.loadAtlas(s,l).then((()=>this.pack(e)))}loadAtlas(e,t){return new Promise(((i,r)=>{this.fetchAtlas(e,t,((e,t)=>{if(e)r(e);else{if(t){const{icons:e,glyphs:i}=t;if(e&&Object.keys(e).length){for(const t in e){const i=e[t],{width:r,height:n,data:o}=i.data;i.data=new F$6({width:r,height:n},o)}this.iconAtlas=new S$6(e)}if(i&&Object.keys(i).length){for(const e in i){const t=i[e];for(const e in t){const i=t[e],{width:r,height:n,data:o}=i.bitmap;i.bitmap=new j$4({width:r,height:n},o)}}this.glyphAtlas=new C$5(i)}}i({glyphAtlas:this.glyphAtlas,iconAtlas:this.iconAtlas})}}))}))}fetchAtlas(e,t,i){Object.keys(e).length>0||Object.keys(t).length>0?this.options.requestor(e,t,i):i()}pack(e){if(!this.count)return null;if(null==e)throw new Error("layout scale is undefined");const t=this.createDataPack(this.styledVectors,e);if(!t)return null;t.properties=this.properties,this.empty&&(t.empty=!0);const i=t.buffers;delete t.buffers;const r={data:t,buffers:i};if(this.iconAtlas){const e=r.data.iconAtlas=fr$3(this.iconAtlas);if(e.glyphMap)for(const t in e.glyphMap)i.push(e.glyphMap[t].data.data.buffer);i.push(r.data.iconAtlas.image.data.buffer)}return this.glyphAtlas&&(r.data.glyphAtlas=fr$3(this.glyphAtlas),i.push(r.data.glyphAtlas.image.data.buffer)),r}createStyledVector(e,t,i,r){return new le$3(e,t,i,r)}createDataPack(e,t){if(!e||!e.length)return null;this.maxIndex=0,this.maxPos=0,this.maxAltitude=0;const i=this.data={};let r=this.elements=[];const n=this.getFormat(Array.isArray(e[0])?e[0][0].symbol:e[0].symbol),o=this.needAltitudeAttribute()?2:3;for(let e=0;e<n.length;e++)i[n[e].name]=[];let a=[],s=0;const l=[];let u=0,c=!1;for(let r=0,n=e.length;r<n;r++){if(!e[r].feature.geometry)continue;const n=Array.isArray(e[r])?e[r][0].feature.id:e[r].feature.id;N$7(n)&&(Math.abs(n)>u&&(u=Math.abs(n)),n<0&&(c=!0));const p=this.data.aPosition.length;if(Array.isArray(e[r]))for(let i=0;i<e[r].length;i++)this._placeVector(e[r][i],t);else this._placeVector(e[r],t);const h=(i.aPosition.length-p)/o;for(let t=0;t<h;t++)a.push(e[r].featureIdx),N$7(n)&&l.push(n);s=Math.max(s,e[r].featureIdx)}if(this.hasElements()&&!r.length)return null;a=new(O$6(s))(a),n[0].type=this.options.positionType?this.options.positionType:E$5(this.maxPos);const p=this.options.center;if(p&&(p[0]||p[1])){const e=i.aPosition;for(let t=0;t<e.length;t+=o)e[t]-=p[0],e[t+1]-=p[1]}const h=function(e,t){const i={};for(let r=0;r<e.length;r++){const n=e[r],o=n.type,a=n.name;i[a]=o===Array?t[a]:new o(t[a])}return i}(n,i);h.aPickingId=a;const d=[];for(const e in h)d.push(h[e].buffer);r=new(D$6(this.maxIndex))(r),d.push(r.buffer);const f={data:h,indices:this.hasElements()?r:null,positionSize:o,buffers:d,symbolIndex:this.symbolDef.index||{index:0}};if(l.length){const e=c?E$5(u):O$6(u);f.featureIds=new e(l),d.push(f.featureIds.buffer)}else f.featureIds=[];return f.feaIdAttrMap=ae$3(l),f.feaIdIndiceMap=se$3(l,f.indices),f}_placeVector(e,t){this._visibleFn&&this._visibleFn.isZoomConstant&&!this._visibleFn(null,e.feature.properties)||this.placeVector(e,t,this.formatWidth)}addElements(...e){this.maxIndex=Math.max(this.maxIndex,...e),this.elements.push(...e)}hasElements(){return!0}getAltitude(e){const{altitudeProperty:t,defaultAltitude:i,altitudeScale:r}=this.options;let n=te$3(e,t,i);return r&&(n*=r),this.maxAltitude=Math.max(this.maxAltitude,Math.abs(n)),n}getIconAtlasMaxValue(){const e=this.iconAtlas.positions;let t=0;for(const i in e)if(H$6(e,i)){const{tl:r,displaySize:n}=e[i],o=Math.max(r[0],r[1],n[0]-1,n[1]-1);o>t&&(t=o)}return t}}function fr$3(e){let t=e.positions,i=e.image&&e.image.format||"alpha";if(e instanceof S$6){t={};for(const i in e.positions){const r=e.positions[i];t[i]={paddedRect:r.paddedRect,pixelRatio:r.pixelRatio,tl:r.tl,br:r.br,displaySize:r.displaySize}}i="rgba"}const r=e.image;return{image:{width:r.width,height:r.height,data:r.data,format:i},glyphMap:e.glyphMap,positions:t}}function mr$3(e){if(!e)return 0;let t=0;if(Array.isArray(e))for(let i=0;i<e.length;i++)if(Array.isArray(e[i])){const r=mr$3(e[i]);r>t&&(t=r)}else{const r=Math.abs(e[i].z||0);r>t&&(t=r)}else{const i=Math.abs(e.z||0);i>t&&(t=i)}return t}function yr$3(e,t,i,r){const n="__fn_textSize".trim();let o=e.textSize;if(q$5(t.textSize))return[16,16];e[n]&&(o=e[n]);const a=[];return a[0]=W$5(o)?o(r,i):o,a[1]=a[0],a}function gr$3(e){const t=e.stops;let i=-1/0;for(let e=0;e<t.length;e++){let r=t[e][1];$$5(t[e][1])&&(r=gr$3(t[e][1])),r>i&&(i=r)}return i}function br$3(e,t,i){return[t||"normal",i||"normal","24px",e||"monospace"].join(" ")}const xr$3=/\{[\w-]+(?:\|[\w-]+)*\}/g;function vr$3(e,t){return U$5(e)?e.replace(xr$3,(function(e){if(!t)return"";if((e=e.substring(1,e.length-1)).indexOf("|")>0){const i=e.split("|");for(let e=0;e<i.length;e++){const r=t[i[e]];if(!q$5(r))return r}return""}const i=t[e];return q$5(i)?"":Array.isArray(i)?i.join():i})):e}var wr$3=Object.freeze({__proto__:null,getSDFFont:br$3,resolveText:vr$3});const qr$2=e=>e>=11904&&e<=12031,Nr$3=e=>e>=12032&&e<=12255,$r$2=e=>e>=12272&&e<=12287,Ur$3=e=>e>=12288&&e<=12351,Wr$2=e=>e>=12352&&e<=12447,Vr$2=e=>e>=12448&&e<=12543,Hr$2=e=>e>=12544&&e<=12591,Br$2=e=>e>=12704&&e<=12735,Xr$2=e=>e>=12736&&e<=12783,Zr$2=e=>e>=12784&&e<=12799,Yr$2=e=>e>=12800&&e<=13055,Kr$2=e=>e>=13056&&e<=13311,Qr$2=e=>e>=13312&&e<=19903,tn$2=e=>e>=19968&&e<=40959,rn$2=e=>e>=40960&&e<=42127,nn$2=e=>e>=42128&&e<=42191,un$2=e=>e>=63744&&e<=64255,cn$2=e=>e>=64336&&e<=65023,pn$2=e=>e>=65040&&e<=65055,hn$2=e=>e>=65072&&e<=65103,dn$2=e=>e>=65104&&e<=65135,fn$2=e=>e>=65136&&e<=65279,mn$2=e=>e>=65280&&e<=65519;function yn$2(e){return!((e=>e>=1536&&e<=1791)(e)||(e=>e>=1872&&e<=1919)(e)||(e=>e>=2208&&e<=2303)(e)||cn$2(e)||fn$2(e))}function gn$2(e){return!!(746===e||747===e||!(e<4352)&&(Br$2(e)||Hr$2(e)||hn$2(e)&&!(e>=65097&&e<=65103)||un$2(e)||Kr$2(e)||qr$2(e)||Xr$2(e)||!(!Ur$3(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Qr$2(e)||tn$2(e)||Yr$2(e)||(e=>e>=12592&&e<=12687)(e)||(e=>e>=43360&&e<=43391)(e)||(e=>e>=55216&&e<=55295)(e)||(e=>e>=4352&&e<=4607)(e)||(e=>e>=44032&&e<=55215)(e)||Wr$2(e)||$r$2(e)||(e=>e>=12688&&e<=12703)(e)||Nr$3(e)||Zr$2(e)||Vr$2(e)&&12540!==e||!(!mn$2(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!dn$2(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(e=>e>=5120&&e<=5759)(e)||(e=>e>=6320&&e<=6399)(e)||pn$2(e)||(e=>e>=19904&&e<=19967)(e)||rn$2(e)||nn$2(e)))}function bn$2(e){return!(gn$2(e)||function(e){return!!((e=>e>=128&&e<=255)(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(e=>e>=8192&&e<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(e=>e>=8448&&e<=8527)(e)||(e=>e>=8528&&e<=8591)(e)||(e=>e>=8960&&e<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(e=>e>=9216&&e<=9279)(e)&&9251!==e||(e=>e>=9280&&e<=9311)(e)||(e=>e>=9312&&e<=9471)(e)||(e=>e>=9632&&e<=9727)(e)||(e=>e>=9728&&e<=9983)(e)&&!(e>=9754&&e<=9759)||(e=>e>=11008&&e<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ur$3(e)||Vr$2(e)||(e=>e>=57344&&e<=63743)(e)||hn$2(e)||dn$2(e)||mn$2(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function xn$2(e){return e>=1424&&e<=2303||cn$2(e)||fn$2(e)}const vn$2=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]];function wn$2(e){for(const t of vn$2)if(e>=t[0]&&e<=t[1])return!0;return!1}const kn$2={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function _n$2(e,t,i,r,n,o,a,s,l,u){let c=e.trim();2===u&&(c=function(e){let t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i+1)||null,n=e.charCodeAt(i-1)||null;t+=r&&bn$2(r)&&!kn$2[e[i+1]]||n&&bn$2(n)&&!kn$2[e[i-1]]||!kn$2[e[i]]?e[i]:kn$2[e[i]]}return t}(c));const p=[],h={positionedGlyphs:p,text:c,top:s[1],bottom:s[1],left:s[0],right:s[0],writingMode:u};let d;return d=function(e,t){const i=[];let r=0;for(let n=0;n<t.length;n++){const o=t[n];i.push(e.substring(r,o)),r=o}return r<e.length&&i.push(e.substring(r,e.length)),i}(c,function(e,t,i,r){if(!i)return[];if(!e)return[];const n=[],o=function(e,t,i,r){let n=0;for(let i=0;i<e.length;i++){const o=r[e.charCodeAt(i)];o&&(n+=o.metrics.advance+t)}return n/Math.max(1,Math.ceil(n/i))}(e,t,i,r);let a=0;for(let i=0;i<e.length;i++){const l=e.charCodeAt(i),u=r[l];u&&!Tn$2[l]&&(a+=u.metrics.advance+t),i<e.length-1&&(jn$2[l]||!((s=l)<11904)&&(Br$2(s)||Hr$2(s)||hn$2(s)||un$2(s)||Kr$2(s)||qr$2(s)||Xr$2(s)||Ur$3(s)||Qr$2(s)||tn$2(s)||Yr$2(s)||mn$2(s)||Wr$2(s)||$r$2(s)||Nr$3(s)||Zr$2(s)||Vr$2(s)||pn$2(s)||nn$2(s)||rn$2(s)))&&n.push(Sn$2(i+1,a,o,n,Pn$2(l,e.charCodeAt(i+1)),!1))}var s;return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(Sn$2(e.length,a,o,n,0,!0))}(c,a,i,t)),function(e,t,i,r,n,o,a,s,l){let u=0,c=8,p=0;const h=e.positionedGlyphs,d="right"===o?1:"left"===o?0:.5;for(let e=0;e<i.length;e++){let n=i[e];if(n=n.trim(),!n.length){c-=r;continue}const o=h.length;for(let e=0;e<n.length;e++){const i=n.charCodeAt(e),r=t[i];r&&(gn$2(i)&&1!==a?(32!==i&&h.push({glyph:i,x:u,y:0,vertical:!0}),u+=l+s):(32!==i&&h.push({glyph:i,x:u,y:c,vertical:!1}),u+=r.metrics.advance+s))}h.length!==o&&(p=Math.max(u-s,p),In$2(h,t,o,h.length-1,d)),u=0,c-=r}const{horizontalAlign:f,verticalAlign:m}=Mn$2(n);!function(e,t,i,r,n,o,a){const s=(t-i)*n,l=-(-r*a+.5)*o;if(s||l)for(let t=0;t<e.length;t++)e[t].x+=s,e[t].y+=l}(h,d,f,m,p,r,i.length);const y=i.length*r;e.top+=-m*y,e.bottom=e.top+y,e.left+=-f*p,e.right=e.left+p}(h,t,d,r,n,o,u,a,l),!!p.length&&h}const Tn$2={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jn$2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Fn$2(e,t,i,r){const n=Math.pow(e-t,2);return r?e<t?n/2:2*n:n+Math.abs(i)*i}function Pn$2(e,t){let i=0;return 10===e&&(i-=1e4),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function Sn$2(e,t,i,r,n,o){let a=null,s=Fn$2(t,i,n,o);for(let e=0;e<r.length;e++){const l=r[e],u=Fn$2(t-l.x,i,n,o)+l.badness;u<=s&&(a=l,s=u)}return{index:e,x:t,priorBreak:a,badness:s}}function Mn$2(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function In$2(e,t,i,r,n){if(!n)return;const o=t[e[r].glyph];if(o){const t=(e[r].x+o.metrics.advance)*n;if(!t)return;for(let n=i;n<=r;n++)e[n].x-=t}}function Cn$2(e){if(!function(e){for(const t of e)if(xn$2(t.charCodeAt(0)))return!0;return!1}(e))return e;const t=[],i=[],r=[];let n=0,o=0,a=1,s=1;for(const l of e){const e=l.codePointAt(0);wn$2(e)?(r.push(l),n++):(a=xn$2(e)?-1:1,s!==a?(o=n,i.length&&(s>0&&i.reverse(),t.push(...i)),r.length&&(t.splice(o,0,...r),r.length=0),s=a,i.length=0):r.length&&(i.push(...r),r.length=0),i.push(l),n++)}return r.length&&i.push(...r),i.length&&(s>0&&i.reverse(),t.push(...i)),t.reverse().join("")}const Dn$2=/\{ *([\w_]+) *\}/g;class En$2{constructor(e,t,i,r,n){this.feature=e,this.symbolDef=t,this.symbol=i,this.options=n,this._thisReplacer=this._replacer.bind(this),this._fnTypes=r}_replacer(e,t){return this.feature.properties[t]||"default"}getShape(e,t){if(this._shape)return this._shape;const{textHorizontalAlignmentFn:i,textVerticalAlignmentFn:r,markerHorizontalAlignmentFn:n,markerVerticalAlignmentFn:o,textWrapWidthFn:a}=this._fnTypes;let s;const l=this.symbol,u=this.getIconAndGlyph(),c=this.feature.properties;if(u&&u.glyph){const{font:e,text:n}=u.glyph;if(""===n)return null;const o=this.size[0]/24,p=24,h=l.textKeepUpright,d="map"===l.textRotationAlignment&&"line"===l.textPlacement&&!l.isIconText,f=t.glyphMap[e],m=On$2(i?i(null,c):l.textHorizontalAlignment,r?r(null,c):l.textVerticalAlignment),y=1.2*p,g=function(e){for(let t=0;t<e.length;t++)if(!yn$2(e.charAt(t).charCodeAt(0)))return!1;return!0}(n),b=g&&l.textLetterSpacing/o||0,x=[l.textDx/o||0,l.textDy/o||0],v=((a?a(null,c):l.textWrapWidth)||10*p)/o;s={},s.horizontal=_n$2(n,f,v,y,m,"center",b,x,p,1),g&&d&&h&&(s.vertical=_n$2(n,f,v,y,m,"center",b,x,p,2))}else if(u&&u.icon){if(!e.positions[u.icon.url])return null;const t=On$2(n?n(null,c):l.markerHorizontalAlignment,o?o(null,c):l.markerVerticalAlignment);s=function(e,t){const{horizontalAlign:i,verticalAlign:r}=Mn$2(t),n=-24*i,o=-24*r;return{image:e,top:o,bottom:o+24,left:n,right:n+24}}(e.positions[u.icon.url],t),this.size||(this.size=s.image.displaySize)}return this._shape=s,s}getIconAndGlyph(){if(this.iconGlyph)return this.iconGlyph;const{markerFileFn:e,markerTypeFn:t,markerPathFn:n,markerWidthFn:o,markerHeightFn:a,markerFillFn:s,markerFillPatternFileFn:l,markerFillOpacityFn:u,markerTextFitFn:c,markerTextFitPaddingFn:p,markerLineColorFn:h,markerLineWidthFn:d,markerLineOpacityFn:f,markerLineDasharrayFn:m,markerLinePatternFileFn:y,markerPathWidthFn:g,markerPathHeightFn:b,textNameFn:x,textFaceNameFn:v,textStyleFn:w,textWeightFn:k}=this._fnTypes,{zoom:z}=this.options,A={},_=this.symbol,T=this.feature.properties,j=e?e(null,T):_.markerFile,F=t?t(null,T):_.markerType,P=j||F||_.markerPath,S=!q$5(this.symbolDef.textName);let M;if(P){M=function(e,t,i,r,n,o){if(q$5(t.markerWidth)&&q$5(t.markerHeight))return null;const a="__fn_markerWidth".trim(),s="__fn_markerHeight".trim();let l=t.markerWidth||0,u=t.markerHeight||0;return $$5(l)&&("identity"!==l.type?l=gr$3(l):(l=e.markerWidth,e[a]&&(l=e[a](r,i)),$$5(l)&&(l="identity"===l.type?n(r,i):gr$3(l)))),$$5(u)&&("identity"!==u.type?u=gr$3(u):(u=e.markerHeight,e[s]&&(u=e[s](r,i)),$$5(u)&&(u="identity"===u.type?o(r,i):gr$3(u)))),[l,u]}(_,this.symbolDef,T,z,o,a)||[0,0];let e=_.markerTextFit;if(c&&(e=c(z,T)),e&&_.text&&"none"!==e){const t=_.text.textSize;let n=_.text.textName;isFunctionDefinition(n)&&(n=interpolated(n)(z,T));const o=vr$3(n,T);if(o){const n="__fn_textSize".trim(),a="__fn_textSize_0".trim();isFunctionDefinition(t)&&!_.text[n]&&(_.text[a]=interpolated(t),_.text[n]=(e,t)=>{const n=_.text[a](e,t);return isFunctionDefinition(n)?interpolated(n)(e,t):n});const s=yr$3(_.text,_.text,T,z);if("width"!==e&&"both"!==e||(M[0]=s[0]*o.length),"height"!==e&&"both"!==e||(M[1]=s[1]),s[0]&&s[1]){let e=_.markerTextFitPadding||[0,0,0,0];p&&(e=p(z,T)),M[0]+=e[1]+e[3],M[1]+=e[0]+e[2]}}else M[0]=M[1]=-1}}if(S&&(M=yr$3(_,this.symbolDef,T,z)),!M)return A;if(M[0]=Math.ceil(M[0]),M[1]=Math.ceil(M[1]),this.size=M,P&&M[0]>=0&&M[1]>=0){let e;if(F){const t={};if(t.markerType=F,"path"===F&&(t.markerPath=n?n(null,T):_.markerPath,t.markerPathWidth=g?g(null,T):_.markerPathWidth,t.markerPathHeight=b?b(null,T):_.markerPathHeight),o){const e=o(null,T);q$5(e)||(t.markerWidth=e)}else _.markerWidth>=0&&(t.markerWidth=_.markerWidth);if(a){const e=a(null,T);q$5(e)||(t.markerHeight=e)}else _.markerHeight>=0&&(t.markerHeight=_.markerHeight);if(s){const e=s(null,T);q$5(e)||(t.markerFill=e)}else _.markerFill&&(t.markerFill=_.markerFill);if(l){const e=l(null,T);q$5(e)||(t.markerFillPatternFile=e)}else _.markerFillPatternFile&&(t.markerFillPatternFile=_.markerFillPatternFile);if(u){const e=u(null,T);q$5(e)||(t.markerFillOpacity=e)}else _.markerFillOpacity>=0&&(t.markerFillOpacity=_.markerFillOpacity);if(h){const e=h(null,T);q$5(e)||(t.markerLineColor=e)}else _.markerLineColor&&(t.markerLineColor=_.markerLineColor);if(d){const e=d(null,T);q$5(e)||(t.markerLineWidth=e)}else _.markerLineWidth>=0&&(t.markerLineWidth=_.markerLineWidth);if(f){const e=f(null,T);q$5(e)||(t.markerLineOpacity=e)}else _.markerLineOpacity>=0&&(t.markerLineOpacity=_.markerLineOpacity);if(m){const e=m(null,T);q$5(e)||(t.markerLineDasharray=e)}else _.markerLineDasharray&&(t.markerLineDasharray=_.markerLineDasharray);if(y){const e=y(null,T);q$5(e)||(t.markerLinePatternFile=e)}else _.markerLinePatternFile&&(t.markerLinePatternFile=_.markerLinePatternFile);e="vector://"+JSON.stringify(t)}else e=j?j.replace(Dn$2,this._thisReplacer):_.markerPath?function(e,t,i){if(!e.markerPath)return null;let r=1;const n=function(e){const t={stroke:{stroke:e.markerLineColor,"stroke-width":e.markerLineWidth,"stroke-opacity":e.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:e.markerFill,"fill-opacity":e.markerFillOpacity}};return 0===t.stroke["stroke-width"]&&(t.stroke["stroke-opacity"]=0),t}(e);N$7(e.markerOpacity)&&(r=e.markerOpacity),N$7(e.opacity)&&(r*=e.opacity);const o={};if(n){for(const e in n.stroke)H$6(n.stroke,e)&&(q$5(n.stroke[e])||(o[e]=n.stroke[e]));for(const e in n.fill)H$6(n.fill,e)&&(q$5(n.fill[e])||(o[e]=n.fill[e]))}const a=Array.isArray(e.markerPath)?e.markerPath:[e.markerPath];let s;const l=[];for(let e=0;e<a.length;e++)s=U$5(a[e])?{path:a[e]}:a[e],s=R$7({},s,o),s.d=s.path,delete s.path,l.push(s);const u=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];r<1&&u.push('opacity="'+r+'"'),e.markerPathWidth&&e.markerPathHeight&&u.push('viewBox="0 0 '+e.markerPathWidth+" "+e.markerPathHeight+'"'),u.push('preserveAspectRatio="none"'),t&&u.push('width="'+t+'"'),i&&u.push('height="'+i+'"'),u.push("><defs></defs>");for(let e=0;e<l.length;e++){let t="<path ";for(const i in l[e])H$6(l[e],i)&&(t+=" "+i+'="'+l[e][i]+'"');t+="></path>",u.push(t)}return u.push("</svg>"),"data:image/svg+xml;base64,"+btoa(u.join(" "))}(_,M[0],M[1]):null;A.icon={url:e,size:M}}if(S){const e=x?x(this.options.zoom,T):_.textName;if(e||0===e){const t=br$3(v?v(null,T):_.textFaceName,w?w(null,T):_.textStyle,k?k(null,T):_.textWeight);let i=vr$3(e,T);i&&i.length&&(i=Cn$2(i),A.glyph={font:t,text:i})}}return this.iconGlyph=A,A}}function On$2(e,t){t&&"middle"!==t||(t="center"),e&&"middle"!==e||(e="center");let i="center"!==t?t:"";return i+="center"!==e?(i.length?"-":"")+e:"",i
/*!
	 * From mapbox-gl-js
	 * MIT License
	 * https://github.com/mapbox/mapbox-gl-js
	 */}function Ln$2(t,i,r,n,o){const a=[];let s;for(let l=0;l<t.length;l++){const u=t[l];let c,p=!1;for(let t=0;t<u.length-1;t++){let l=u[t],h=u[t+1];l.x<i&&h.x<i||(l.x<i?(s=l,l=new pointGeometry(i,l.y+(i-l.x)/(h.x-l.x)*(h.y-l.y))._round(),l.z=s.z+(i-s.x)/(h.x-s.x)*(h.z-s.z),p=!0):h.x<i&&(s=h,h=new pointGeometry(i,l.y+(i-l.x)/(h.x-l.x)*(h.y-l.y))._round(),h.z=l.z+(i-l.x)/(s.x-l.x)*(s.z-l.z),p=!0),l.y<r&&h.y<r||(l.y<r?(s=l,l=new pointGeometry(l.x+(r-l.y)/(h.y-l.y)*(h.x-l.x),r)._round(),l.z=s.z+(r-s.y)/(h.y-s.y)*(h.z-s.z),p=!0):h.y<r&&(s=h,h=new pointGeometry(l.x+(r-l.y)/(h.y-l.y)*(h.x-l.x),r)._round(),h.z=l.z+(r-l.y)/(s.y-l.y)*(s.z-l.z),p=!0),l.x>=n&&h.x>=n||(l.x>=n?(s=l,l=new pointGeometry(n,l.y+(n-l.x)/(h.x-l.x)*(h.y-l.y))._round(),l.z=s.z+(n-s.x)/(h.x-s.x)*(h.z-s.z),p=!0):h.x>=n&&(s=h,h=new pointGeometry(n,l.y+(n-l.x)/(h.x-l.x)*(h.y-l.y))._round(),h.z=l.z+(n-l.x)/(s.x-l.x)*(s.z-l.z),p=!0),l.y>=o&&h.y>=o||(l.y>=o?(s=l,l=new pointGeometry(l.x+(o-l.y)/(h.y-l.y)*(h.x-l.x),o)._round(),l.z=s.z+(o-s.y)/(h.y-s.y)*(h.z-s.z),p=!0):h.y>=o&&(s=h,h=new pointGeometry(l.x+(o-l.y)/(h.y-l.y)*(h.x-l.x),o)._round(),h.z=l.z+(o-l.y)/(s.y-l.y)*(s.z-l.z),p=!0),c&&l.equals(c[c.length-1])||(c=[l],a.push(c)),p&&(c.clipped=!0),c.push(h)))))}}return a}class Rn$2 extends pointGeometry{constructor(e,t,i,r){super(e,t),this.angle=i,void 0!==r&&(this.segment=r)}clone(){return new Rn$2(this.x,this.y,this.angle,this.segment)}}
/*!
	 * From mapbox-gl-js
	 * MIT License
	 * https://github.com/mapbox/mapbox-gl-js
	 */function qn$2(e,t,i,r,n){if(void 0===t.segment)return!0;let o=t,a=t.segment+1,s=0;for(;s>-i/2;){if(a--,a<0)return!1;s-=e[a].dist(o),o=e[a]}s+=e[a].dist(e[a+1]),a++;const l=[];let u=0;for(;s<i/2;){const t=e[a],i=e[a+1];if(!i)return!1;let o=e[a-1].angleTo(t)-t.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:o}),u+=o;s-l[0].distance>r;)u-=l.shift().angleDelta;if(u>n)return!1;a++,s+=t.dist(i)}return!0}function Nn$2(e,t,i,r,n,o,a,s,l,u,c){const p=function(e,t,i){return e?.6*t*i:0}(r,o,a),h=function(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}(r,n),d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h*a<t/4&&(t=h*a+t/4),function e(t,i,r,n,o,a,s,l,u,c,p){const h=a/2,d=function(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}(t);let f=0,m=i-r,y=[];for(let e=0;e<t.length-1;e++){const i=t[e],s=t[e+1],l=i.dist(s),g=s.angleTo(i);for(;m+r<f+l;){m+=r;const b=(m-f)/l,x=$n$2(i.x,s.x,b),v=$n$2(i.y,s.y,b),w=$n$2(i.z||0,s.z||0,b);if(x>=0&&x<u&&v>=0&&v<u&&m-h>=0&&m+h<=d){const r=new Rn$2(x,v,g,e);r.z=w,c&&(r.axis=[i.y-v,x-i.x],r.angleR=w===(i.z||0)?0:Math.atan(.9*(w-(i.z||0))*p/i.dist(r))),r.line=t,r._round(),n&&!qn$2(t,r,a,n,o)||y.push(r)}}f+=l}return l||y.length||s||(y=e(t,f/2,r,n,o,a,s,!0,u,c,p)),y}(e,d?t/2*s%t:(h/2+2*o)*a*s%t,t,p,i,h*a,d,!1,l,u,c)}function $n$2(e,t,i){return e*(1-i)+t*i}function Un$2(e,t){const i=e.length;if(i<=1)return[e];const r=[];let n,o;for(let t=0;t<i;t++){const i=Q$5(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(n&&r.push(n),n=[e[t]]):n.push(e[t]))}if(n&&r.push(n),t>1)for(let e=0;e<r.length;e++)r[e].length<=t||(l$3(r[e],t,1,r[e].length-1,Wn$2),r[e]=r[e].slice(0,t));return r}function Wn$2(e,t){return t.area-e.area}function Vn$2(e,t,i){const r=t.distSqr(i);if(0===r)return e.distSqr(t);const n=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return e.distSqr(n<0?t:n>1?i:i.sub(t)._mult(n)._add(t))}function Hn$2(t,i=1,r=!1){let n=1/0,o=1/0,a=-1/0,s=-1/0;const l=t[0];for(let e=0;e<l.length;e++){const t=l[e];(!e||t.x<n)&&(n=t.x),(!e||t.y<o)&&(o=t.y),(!e||t.x>a)&&(a=t.x),(!e||t.y>s)&&(s=t.y)}const c=Math.min(a-n,s-o);let p=c/2;const h=new tinyqueue.exports(null,Gn$2);if(0===c)return new pointGeometry(n,o);for(let e=n;e<a;e+=c)for(let i=o;i<s;i+=c)h.push(new Jn$2(e+p,i+p,p,t));let d=function(e){let t=0,i=0,r=0;const n=e[0];for(let e=0,o=n.length,a=o-1;e<o;a=e++){const o=n[e],s=n[a],l=o.x*s.y-s.x*o.y;i+=(o.x+s.x)*l,r+=(o.y+s.y)*l,t+=3*l}return new Jn$2(i/t,r/t,0,e)}(t),f=h.length;for(;h.length;){const e=h.pop();(e.d>d.d||!d.d)&&(d=e,r&&console.log("found best %d after %d probes",Math.round(1e4*e.d)/1e4,f)),e.max-d.d<=i||(p=e.h/2,h.push(new Jn$2(e.p.x-p,e.p.y-p,p,t)),h.push(new Jn$2(e.p.x+p,e.p.y-p,p,t)),h.push(new Jn$2(e.p.x-p,e.p.y+p,p,t)),h.push(new Jn$2(e.p.x+p,e.p.y+p,p,t)),f+=4)}return r&&(console.log("num probes: "+f),console.log("best distance: "+d.d)),d.p}function Gn$2(e,t){return t.max-e.max}function Jn$2(t,i,r,n){this.p=new pointGeometry(t,i),this.h=r,this.d=function(e,t){let i=!1,r=1/0;for(let n=0;n<t.length;n++){const o=t[n];for(let t=0,n=o.length,a=n-1;t<n;a=t++){const n=o[t],s=o[a];n.y>e.y!=s.y>e.y&&e.x<(s.x-n.x)*(e.y-n.y)/(s.y-n.y)+n.x&&(i=!i),r=Math.min(r,Vn$2(e,n,s))}}return(i?1:-1)*Math.sqrt(r)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const Bn$2=45*Math.PI/100;function Zn$2(e,t){const i={},r={},n=[];let o=0;function a(t){n.push(e[t]),o++}function s(e,t,i){const o=r[e];return delete r[e],r[t]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(i[0]),o}function l(e,t,r){const o=i[t];return delete i[t],i[e]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function u(e,t,i){const r=i?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let c=0;c<e.length;c++){const p=e[c],h=p.geometry;if(!h)continue;const d=p.properties[t]?p.properties[t].toString():null;if(!d){a(c);continue}const f=u(d,h),m=u(d,h,!0);if(f in r&&m in i&&r[f]!==i[m]){const e=l(f,m,h),t=s(f,m,n[e].geometry);delete i[f],delete r[m],r[u(d,n[t].geometry,!0)]=t,n[e].geometry=null}else f in r?s(f,m,h):m in i?l(f,m,h):(a(c),i[f]=o-1,r[m]=o-1)}return n.filter((e=>e.geometry))}class Kn$2 extends dr$3{static needMerge(e,t,i){if(!e)return!1;let r="line"===e.textPlacement||"line"===e.markerPlacement;return r||(t.textPlacementFn&&(r="line"===t.textPlacementFn(i)),t.markerPlacementFn&&(r="line"===t.markerPlacementFn(i))),e.mergeOnProperty&&r}static mergeLineFeatures(e,t,i,r){const n="__index".trim();let o=t.textPlacement,a=t.markerPlacement;i.textPlacementFn&&(o=i.textPlacementFn(r)),i.markerPlacementFn&&(a=i.markerPlacementFn(r));const s=function(e,t,i,r,n){const o="__index".trim(),a=dr$3.genFnTypes(t),{mergeOnPropertyFn:s}=a;if(!t.mergeOnProperty||"line"!==r&&"line"!==i)return[];if(!(ne$3(l=t.mergeOnProperty)||"string"!=typeof l&&(null===l.constructor||l.constructor!==String)||"line"!==r&&"line"!==i))return[{features:e,property:t.mergeOnProperty}];var l;const u=[],c={},p=[];for(let a=0;a<e.length;a++){e[a][o]=a;const l=e[a].properties=e[a].properties||{};l.$layer=e[a].layer,l.$type=e[a].type;let h=i;"line"!==h&&(h=r);const d=s?s(n,l):t.mergeOnProperty;"line"!==h||ne$3(d)?p.push(e[a]):(void 0===c[d]&&(c[d]=u.length,u.push({features:[],property:d})),u[c[d]].features.push(e[a]))}return p.length&&u.push({features:p}),u}(e,t,a,o,r);if(s.length){const t=[];for(let i=0;i<s.length;i++)t.push(s[i].property?Zn$2(s[i].features,s[i].property):e);if(1===t.length)return t[0];{let e=[];for(let i=0;i<t.length;i++)e=e.concat(t[i]);return e.sort(((e,t)=>e[n]-t[n])),e}}}static splitPointSymbol(e,t=0){const i=[];if(Array.isArray(e)){const t=e;for(let e=0;e<t.length;e++)t[e]&&i.push(...Kn$2.splitPointSymbol(t[e],e));return i}let r=null,n=null;for(const t in e)0===t.indexOf("marker")?(r=r||{},r[t]=e[t]):0===t.indexOf("text")&&(n=n||{},n[t]=e[t]);return r&&(r.isIconText=!0,e.mergeOnProperty&&(r.mergeOnProperty=e.mergeOnProperty),i.push(r)),n&&(r&&(n.textPlacement=r.markerPlacement,n.textSpacing=r.markerSpacing,n.isIconText=!0),e.mergeOnProperty&&(n.mergeOnProperty=e.mergeOnProperty),i.push(n)),void 0!==e.visible&&(r&&(r.visible=e.visible),n&&(n.visible=e.visible)),r&&(r.markerTextFit&&n&&(r.text={},r.text.textName=n.textName,r.text.textSize=n.textSize),r.index={index:t,type:0}),n&&(n.index={index:t,type:1}),i}static isAtlasLoaded(e,t){const{icon:i,glyph:r}=e,{iconAtlas:n,glyphAtlas:o}=t;if(i&&(!n||!n.positions[i.url]))return!1;if(r){if(!o||!o.positions[r.font])return!1;const e=o.positions[r.font],{text:t}=r;for(let i=0;i<t.length;i++)if(!e[t.charCodeAt(i)])return!1}return!0}constructor(e,t,i){super(e,t,i),this._textPlacement=t.textPlacement,this._fnTypes.textPlacementFn&&(this._textPlacement=this._fnTypes.textPlacementFn(this.options.zoom))}createStyledVector(e,t,i,r,n,o){const a=new En$2(e,this.symbolDef,t,i,r),s=a.getIconAndGlyph();if(s.icon&&!this.options.atlas){const{url:e,size:t}=s.icon;n[e]||(n[e]=s.icon.size),n[e][0]<t[0]&&(n[e][0]=t[0]),n[e][1]<t[1]&&(n[e][1]=t[1])}if(s.glyph&&!this.options.atlas){const{font:e,text:t}=s.glyph,i=o[e]=o[e]||{};for(let e=0;e<t.length;e++)i[t.charCodeAt(e)]=1;"line"===this._textPlacement&&(o.options={isCharsCompact:!1})}return this.options.allowEmptyPack||s.icon||s.glyph?a:null}getFormat(e){const t=void 0!==e.textName,i=t?this.getPackSDFFormat(e):this.getPackMarkerFormat();t?i.push(...this._getTextFnTypeFormats()):i.push(...this._getMarkerFnTypeFormats());const{markerOpacityFn:r,textOpacityFn:n,markerPitchAlignmentFn:o,textPitchAlignmentFn:a,markerRotationAlignmentFn:s,textRotationAlignmentFn:l,markerRotationFn:u,textRotationFn:c,markerAllowOverlapFn:p,textAllowOverlapFn:h,markerIgnorePlacementFn:d,textIgnorePlacementFn:f}=this._fnTypes;return(r||n)&&i.push({type:Uint8Array,width:1,name:"aColorOpacity"}),(o||a)&&i.push({type:Uint8Array,width:1,name:"aPitchAlign"}),(s||l)&&i.push({type:Uint8Array,width:1,name:"aRotationAlign"}),(u||c)&&i.push({type:Uint16Array,width:1,name:"aRotation"}),(p||h||d||f)&&i.push({type:Uint8Array,width:1,name:"aOverlap"}),i}_is3DPitchText(){return this.hasMapPitchAlign}_getTextFnTypeFormats(){const{textFillFn:e,textSizeFn:t,textHaloFillFn:i,textHaloRadiusFn:r,textHaloOpacityFn:n,textDxFn:o,textDyFn:a}=this._fnTypes,s=[];return e&&s.push({type:Uint8Array,width:4,name:"aTextFill"}),t&&s.push({type:Uint8Array,width:1,name:"aTextSize"}),i&&s.push({type:Uint8Array,width:4,name:"aTextHaloFill"}),r&&s.push({type:Uint8Array,width:1,name:"aTextHaloRadius"}),n&&s.push({type:Uint8Array,width:1,name:"aTextHaloOpacity"}),o&&s.push({type:Int8Array,width:1,name:"aTextDx"}),a&&s.push({type:Int8Array,width:1,name:"aTextDy"}),s}_getMarkerFnTypeFormats(){const{markerWidthFn:e,markerHeightFn:t,markerDxFn:i,markerDyFn:r}=this._fnTypes,n=[];return e&&n.push({type:Uint8Array,width:1,name:"aMarkerWidth"}),t&&n.push({type:Uint8Array,width:1,name:"aMarkerHeight"}),i&&n.push({type:Int8Array,width:1,name:"aMarkerDx"}),r&&n.push({type:Int8Array,width:1,name:"aMarkerDy"}),n}createDataPack(){if(!this.iconAtlas&&!this.glyphAtlas){if(!this.options.allowEmptyPack)return null;this.empty=!0}this.lineVertex=[];const e=super.createDataPack.apply(this,arguments);return e?(e.lineVertex=new Int16Array(this.lineVertex),e.buffers.push(e.lineVertex.buffer),e):null}placeVector(t,r){const n=t.getShape(this.iconAtlas,this.glyphAtlas);if(!this.options.allowEmptyPack&&!n)return;const o=this._getAnchors(t,n,r);if(0===o.length)return;const a=this.data,s=this.needAltitudeAttribute()?2:3;let l=this.data.aPosition.length/s;const u=t.symbol,c=t.feature.properties,p="line"===this._textPlacement&&!u.isIconText,h=void 0!==u.textName,d=h&&p&&function(e){let t=0;for(let i=0;i<e.length;i++)if(gn$2(e.charAt(i).charCodeAt(0)))t=0;else if(t++,t>=1)return!1;return!0}(t.getIconAndGlyph().glyph.text)?1:0,{textFillFn:f,textSizeFn:m,textHaloFillFn:y,textHaloRadiusFn:g,textHaloOpacityFn:b,textDxFn:x,textDyFn:v,textPitchAlignmentFn:w,textRotationAlignmentFn:k,textRotationFn:z,textAllowOverlapFn:A,textIgnorePlacementFn:_,textOpacityFn:T,markerWidthFn:j,markerHeightFn:F,markerDxFn:P,markerDyFn:S,markerPitchAlignmentFn:M,markerRotationAlignmentFn:I,markerRotationFn:C,markerAllowOverlapFn:D,markerIgnorePlacementFn:E,markerOpacityFn:O}=this._fnTypes;let L,R,q,N,$,U,W,V,H,G,J,B,X,Z,K,Q,ee;if(h){const r=t.getIconAndGlyph().glyph.font;L=function(t,i,r){const n=t.positionedGlyphs,o=[];for(let a=0;a<n.length;a++){const s=n[a],l=r[s.glyph];if(!l)continue;const u=l.rect;if(!u)continue;const c=4,p=l.metrics.advance/2,h=l.metrics.height/2,d=i?[s.x+p,0]:[0,0],f=i?[0,s.y-h]:[s.x+p,s.y-h],m=l.metrics.left-c-p+f[0],y=l.metrics.top-c+f[1],g=m+u.w,b=y+u.h,x=new pointGeometry(m,y),v=new pointGeometry(g,y),w=new pointGeometry(m,b),k=new pointGeometry(g,b);if(i&&s.vertical){const t=new pointGeometry(-p,p),i=-Math.PI/2,r=new pointGeometry(5,0);x._rotateAround(i,t)._add(r),v._rotateAround(i,t)._add(r),w._rotateAround(i,t)._add(r),k._rotateAround(i,t)._add(r)}o.push({tl:x,tr:v,bl:w,br:k,tex:u,writingMode:t.writingMode,glyphOffset:d})}return o}(n.horizontal,p,this.glyphAtlas.positions[r]),f&&(R=f(null,c),R=isFunctionDefinition(R)?[0,0,0,0]:Y$4([],R)),m&&(q=m(this.options.zoom,c),ne$3(q)&&(q=14)),y&&(N=y(null,c),N=Y$4([],N)),g&&($=g(null,c)),b&&(U=255*b(null,c)),x&&(W=x(null,c)||0),v&&(V=v(null,c)||0),w&&(X=+("map"===w(null,c))),k&&(Z=+("map"===k(null,c))),z&&(K=oe$3(z(null,c),0,360)*Math.PI/180)}else L=n?function(t){const i=t.image,r=t.top-1/i.pixelRatio,n=t.left-1/i.pixelRatio,o=t.bottom+1/i.pixelRatio,a=t.right+1/i.pixelRatio;let s,l,u,c;return s=new pointGeometry(n,r),l=new pointGeometry(a,r),u=new pointGeometry(a,o),c=new pointGeometry(n,o),[{tl:s,tr:l,bl:c,br:u,tex:{x:i.tl[0],y:i.tl[1],w:i.displaySize[0],h:i.displaySize[1]},writingMode:void 0,glyphOffset:[0,0]}]}(n):function(){const t=new pointGeometry(0,0),i=new pointGeometry(0,0),r=new pointGeometry(0,0);return[{tl:t,tr:i,bl:new pointGeometry(0,0),br:r,tex:{x:0,y:0,w:0,h:0},writingMode:void 0,glyphOffset:[0,0]}]}(),j&&(H=j(null,c)),F&&(G=F(null,c)),P&&(J=P(null,c)),S&&(B=S(null,c)),M&&(X=+("map"===M(null,c))),I&&(Z=+("map"===I(null,c))),C&&(K=oe$3(C(null,c),0,360)*Math.PI/180);const te=D||A;te&&(Q=te(null,c)||0);const ie=E||_;let ae;ie&&(ee=ie(null,c)||0);const se=T||O;se&&(ae=255*se(this.options.zoom,c));const le=this.options.EXTENT,ue=L.length;for(let e=0;e<o.length;e++){const t=o[e],i=t.z||0;if(le!==1/0&&re$3(t,le))continue;const r=t.x,n=t.y,s=L.length;for(let e=0;e<s;e++){const o=L[e],{tl:s,tr:u,bl:c,br:f,tex:m}=o;this._fillPos(a,r,n,i,10*s.x,10*s.y,m.x,m.y+m.h),h&&this._fillData(a,p,ue,o.glyphOffset,t,d,t.axis,t.angleR),this._fillFnTypeData(a,R,q,N,$,U,W,V,H,G,J,B,ae,X,Z,K,Q,ee),this._fillPos(a,r,n,i,10*u.x,10*u.y,m.x+m.w,m.y+m.h),h&&this._fillData(a,p,ue,o.glyphOffset,t,d,t.axis,t.angleR),this._fillFnTypeData(a,R,q,N,$,U,W,V,H,G,J,B,ae,X,Z,K,Q,ee),this._fillPos(a,r,n,i,10*c.x,10*c.y,m.x,m.y),h&&this._fillData(a,p,ue,o.glyphOffset,t,d,t.axis,t.angleR),this._fillFnTypeData(a,R,q,N,$,U,W,V,H,G,J,B,ae,X,Z,K,Q,ee),this._fillPos(a,r,n,i,10*f.x,10*f.y,m.x+m.w,m.y),h&&this._fillData(a,p,ue,o.glyphOffset,t,d,t.axis,t.angleR),this._fillFnTypeData(a,R,q,N,$,U,W,V,H,G,J,B,ae,X,Z,K,Q,ee),this.addElements(l,l+1,l+2),this.addElements(l+1,l+2,l+3),l+=4;const y=Math.max(Math.abs(r),Math.abs(n),Math.abs(i));y>this.maxPos&&(this.maxPos=y)}}}_fillPos(e,t,i,r,n,o,a,s){this.fillPosition(e,t,i,r),e.aShape.push(n,o),e.aTexCoord.push(a,s)}_fillData(e,t,i,r,n,o,a,s){if(e.aCount.push(i),t){e.aGlyphOffset.push(r[0],r[1]),this._is3DPitchText()&&e.aPitchRotation.push(a[0],a[1],s);const t=n.startIndex;e.aSegment.push(n.segment+t,t,n.line.length),e.aVertical.push(o)}}_fillFnTypeData(e,t,i,r,n,o,a,s,l,u,c,p,h,d,f,m,y,g){const{textFillFn:b,textSizeFn:x,textHaloFillFn:v,textHaloRadiusFn:w,textHaloOpacityFn:k,textDxFn:z,textDyFn:A,textPitchAlignmentFn:_,textRotationAlignmentFn:T,textRotationFn:j,textAllowOverlapFn:F,textIgnorePlacementFn:P,textOpacityFn:S,markerWidthFn:M,markerHeightFn:I,markerDxFn:C,markerDyFn:D,markerPitchAlignmentFn:E,markerRotationAlignmentFn:O,markerRotationFn:L,markerAllowOverlapFn:R,markerIgnorePlacementFn:q,markerOpacityFn:N}=this._fnTypes;b&&e.aTextFill.push(...t),x&&e.aTextSize.push(i),v&&e.aTextHaloFill.push(...r),w&&e.aTextHaloRadius.push(n),k&&e.aTextHaloOpacity.push(o),z&&e.aTextDx.push(a),A&&e.aTextDy.push(s),M&&e.aMarkerWidth.push(l),I&&e.aMarkerHeight.push(u),C&&e.aMarkerDx.push(c),D&&e.aMarkerDy.push(p),(N||S)&&e.aColorOpacity.push(h),(_||E)&&e.aPitchAlign.push(d),(O||T)&&e.aRotationAlign.push(f),(L||j)&&e.aRotation.push(9362*m);const $=R||F,U=q||P;($||U)&&e.aOverlap.push(($?8:0)+4*y+((U?2:0)+g)),n>0&&(this.properties.hasHalo=1)}_getAnchors(e,t,i){const{feature:r,symbol:n}=e,o=this._getPlacement(e,n),a=r.properties,{markerSpacingFn:s,textSpacingFn:l}=this._fnTypes,u=((s?s(null,a):n.markerSpacing)||(l?l(null,a):n.textSpacing)||250)*i,c=this.options.altitudeToTileScale;return function(e,t,i,r,n,o,a,s,l){const{feature:u,size:c,symbol:p}=e,h=c?24:0,d=r*(c?c[0]/h:1),f=[];if("line"===o){let e=u.geometry;n&&(e=Ln$2(u.geometry,0,0,n,n));for(let r=0;r<e.length;r++){const o=Nn$2(e[r],a,Bn$2,p.isIconText?null:i.vertical||i.horizontal||i,null,h,p.isIconText?1:d,1,n||1/0,s,l);if(p.textPlacement&&!p.isIconText)for(let e=0;e<o.length;e++)o[e].startIndex=t.length/3;if(f.push.apply(f,o),p.textPlacement&&!p.isIconText)for(let i=0;i<e[r].length;i++)t.push(e[r][i].x,e[r][i].y,e[r][i].z||0)}}else if(3===u.type){const e=Un$2(u.geometry,0);for(let t=0;t<e.length;t++){const i=e[t];if("vertex"===o)for(let e=0;e<i.length;e++){const t=i[e];for(let e=0;e<t.length;e++)re$3(t[e],n)||f.push(t[e])}else{const e=Hn$2(i,16);re$3(e,n)||f.push(e)}}}else if(2===u.type)for(let e=0;e<u.geometry.length;e++){const t=u.geometry[e];if("vertex"===o)for(let e=0;e<t.length;e++)re$3(t[e],n)||f.push(t[e]);else re$3(t[0],n)||f.push(t[0])}else if(1===u.type)for(let e=0;e<u.geometry.length;e++){const t=u.geometry[e];for(let e=0;e<t.length;e++){const i=t[e];re$3(i,n)||f.push(i)}}return f}(e,this.lineVertex,t,i,this.options.EXTENT,o,u,this._is3DPitchText(),c)}_getPlacement(e,t){return this._fnTypes.markerPlacementFn?this._fnTypes.markerPlacementFn(this.options.zoom,e.feature.properties):t.markerPlacement||this._textPlacement}getPackSDFFormat(e){if("line"!==this._textPlacement||e.isIconText)return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"}];{const e=[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"},{type:Int16Array,width:2,name:"aGlyphOffset"},{type:Uint16Array,width:3,name:"aSegment"},{type:Uint8Array,width:1,name:"aVertical"}];return this._is3DPitchText()&&e.push({type:Float32Array,width:3,name:"aPitchRotation"}),e}}getPackMarkerFormat(){return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"}]}}class Qn$2{constructor(e){this.x=e.x,this.y=e.y,this.z=e.z||0}clone(){return new Qn$2(this)}_unit(){return this._div(this.mag()),this}_div(e){return this.x/=e,this.y/=e,this.z/=e,this}_perp(){var e=this.y;return this.y=this.x,this.x=-e,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}add(e){return this.clone()._add(e)}sub(e){return this.clone()._sub(e)}_add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}_sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}mult(e){return this.clone()._mult(e)}_mult(e){return this.x*=e,this.y*=e,this.z*=e,this}dist(e){return Math.sqrt(this.distSqr(e))}distSqr(e){var t=e.x-this.x,i=e.y-this.y,r=e.z-this.z;return t*t+i*i+r*r}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)}}const eo$2=Math.cos(Math.PI/180*37.5),to$2=Math.pow(2,16)/1,io$2=new pointGeometry,ro$2=new pointGeometry,no$2=new pointGeometry;class oo$2 extends dr$3{constructor(e,t,i){super(e,t,i);let r=!1;const{lineDasharrayFn:n,lineDashColorFn:o}=this._fnTypes;this.hasGradient=this.symbol.lineGradientProperty,n&&(r=function(e,t,i){for(let r=0;r<e.length;r++)if(i(t,e[r].properties))return!0;return!1}(e,this.options.zoom,n),r&&(this.dasharrayFn=n)),this.hasDasharray=lo$1(this.symbol.lineDasharray)||r,this.hasDasharray&&o&&(this.dashColorFn=o)}createStyledVector(e,t,i,r,n){const o=new le$3(e,t,i,r),a=o.getLineResource();return!this.options.atlas&&a&&(n[a]=[0,0]),o}getFormat(){const{lineWidthFn:e,lineStrokeWidthFn:t,lineStrokeColorFn:i,lineColorFn:r,lineOpacityFn:n,lineDxFn:o,lineDyFn:a,linePatternAnimSpeedFn:s,linePatternGapFn:l}=this._fnTypes,u=[...this.getPositionFormat()];if(u.push(this.iconAtlas||this.hasDasharray?{type:Int8Array,width:3,name:"aExtrude"}:{type:Int8Array,width:2,name:"aExtrude"}),u.push({type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}),e&&u.push({type:Uint8Array,width:1,name:"aLineWidth"}),t&&u.push({type:Uint8Array,width:1,name:"aLineStrokeWidth"}),r&&u.push({type:Uint8Array,width:4,name:"aColor"}),i&&u.push({type:Uint8Array,width:4,name:"aStrokeColor"}),n&&u.push({type:Uint8Array,width:1,name:"aOpacity"}),this.dasharrayFn&&u.push({type:Uint8Array,width:4,name:"aDasharray"}),this.dashColorFn&&u.push({type:Uint8Array,width:4,name:"aDashColor"}),this.iconAtlas){const e=this.getIconAtlasMaxValue();u.push({type:e>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return(o||a)&&u.push({type:Int8Array,width:2,name:"aLineDxDy"}),(s||l)&&u.push({type:Int8Array,width:2,name:"aLinePattern"}),u}placeVector(e){const{lineJoinFn:t,lineCapFn:r,lineWidthFn:n,lineHeightFn:o,lineStrokeWidthFn:a,lineStrokeColorFn:s,lineColorFn:l,lineOpacityFn:u,lineDxFn:c,lineDyFn:p,linePatternAnimSpeedFn:h,linePatternGapFn:d}=this._fnTypes,f=this.symbol,m=e.feature,y=m.properties;let g=f.lineJoin||"miter",b=f.lineCap||"butt";if(t&&(g=t(this.options.zoom,y)||"miter"),r&&(b=r(this.options.zoom,y)||"butt"),n){let e=n(this.options.zoom,y);q$5(e)&&(e=4),this.feaLineWidth=+e}else this.feaLineWidth=+f.lineWidth;if(o){let e=o(this.options.zoom,y);q$5(e)&&(e=this.feaLineWidth),this.feaLineHeight=+e}else this.feaLineHeight=+f.lineHeight||this.feaLineWidth;if(a){let e=a(this.options.zoom,y);q$5(e)&&(e=0),this.feaLineStrokeWidth=e}else this.feaLineStrokeWidth=f.lineStrokeWidth||0;if(l&&(this.feaColor=l(this.options.zoom,y)||[255,255,255,255],this.feaColor=isFunctionDefinition(this.feaColor)?[0,0,0,0]:Y$4([],this.feaColor)),s&&(this.feaStrokeColor=s(this.options.zoom,y)||[0,0,0,255],this.feaStrokeColor=isFunctionDefinition(this.feaStrokeColor)?[0,0,0,0]:Y$4([],this.feaStrokeColor)),u){let e=u(this.options.zoom,y);q$5(e)&&(e=1),this.feaOpacity=255*e}if(this.dasharrayFn){let e=this.dasharrayFn(this.options.zoom,y)||[0,0,0,0];if(e.length<4){const t=e;1===e.length?e=[t[0],t[0],t[0],t[0]]:2===e.length?e=[t[0],t[1],t[0],t[1]]:3===e.length&&(e=[t[0],t[1],t[2],t[2]])}this.feaDash=e}if(this.dashColorFn){let e=(this.dashColorFn?this.dashColorFn(this.options.zoom,y):this.symbol.lineDashColor)||[0,0,0,0];e=Y$4([],e),this.feaDashColor=e}if(this.iconAtlas){const t=e.getLineResource(),i=this.iconAtlas.glyphMap[t];if(this.feaTexInfo=this.feaTexInfo||[0,0,0,0],i){const{tl:e,displaySize:i}=this.iconAtlas.positions[t];this.feaTexInfo[0]=e[0]+1,this.feaTexInfo[1]=e[1]+1,this.feaTexInfo[2]=i[0]-3,this.feaTexInfo[3]=i[1]-3}else this.feaTexInfo[0]=this.feaTexInfo[1]=this.feaTexInfo[2]=this.feaTexInfo[3]=0}if(c){let e=c(this.options.zoom,y);q$5(e)&&(e=0),this.feaLineDx=e}if(p){let e=p(this.options.zoom,y);q$5(e)&&(e=0),this.feaLineDy=e}if(h){let e=h(this.options.zoom,y);q$5(e)&&(e=0),0!==e&&(this.properties.hasPatternAnim=1),this.feaPatternAnimSpeed=e}if(d){let e=d(this.options.zoom,y);q$5(e)&&(e=0),this.feaLinePatternGap=e}const x=this.options.EXTENT;let v=m.geometry;if(x!==1/0){v=[];const e=[];for(let t=0;t<m.geometry.length;t++){e[0]=m.geometry[t];const i=Ln$2(e,-1,-1,x+1,x+1);if(3===m.type&&i.length>1){const e=i[0],t=i[i.length-1];e[0].equals(t[t.length-1])&&(i[0]=t.concat(e.slice(1)),i.length=i.length-1)}v.push(...i)}}const w=this.needAltitudeAttribute()?2:3;for(let e=0;e<v.length;e++)this.offset=this.data.aPosition.length/w,this._addLine(v[e],m,g,b,2,1.05)}_hasPattern(){return this.iconAtlas&&this.feaTexInfo[2]&&this.feaTexInfo[3]}_addLine(e,t,i,r,n,o){const a=this._hasPattern()||lo$1(this.feaDash)||lo$1(this.symbol.lineDasharray),s=this.options.isTube;s&&(e=e.map((e=>new Qn$2(e)))),this.overscaling=1;const l=this.options.EXTENT;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.prevVertex=null,this.symbol.lineGradientProperty&&t.properties&&H$6(t.properties,"mapbox_clip_start")&&H$6(t.properties,"mapbox_clip_end")){this.clipStart=+t.properties.mapbox_clip_start,this.clipEnd=+t.properties.mapbox_clip_end;for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance()}const u=3===t.type&&!e.clipped;let c=e.length;for(;c>=2&&e[c-1].equals(e[c-2]);)c--;let p=0;for(;p<c-1&&e[p].equals(e[p+1]);)p++;if(c<(u?3:2))return;"bevel"===i&&(n=1.05);const h=this.overscaling<=16?15*l/(512*this.overscaling):0,d={vertexLength:0,primitiveLength:0,currentNormal:null};let f,m,y,g,b;this.e1=this.e2=-1,u&&(f=e[c-2],b=e[p].sub(f)._unit()._perp());for(let t=p;t<c;t++){if(y=t===c-1?u?e[p+1]:void 0:e[t+1],y&&e[t].equals(y))continue;b&&(g=b),f&&(m=f),f=e[t],b=y?y.sub(f)._unit()._perp():g,d.dir=m?f.sub(m)._unit():y.sub(f)._unit(),g=g||b,d.currentNormal=g;let l=g.add(b);0===l.x&&0===l.y||l._unit();const x=g.x*b.x+g.y*b.y,v=l.x*b.x+l.y*b.y,w=0!==v?1/v:1/0,k=2*Math.sqrt(2-2*v),z=v<eo$2&&m&&y,A=g.x*b.y-g.y*b.x>0;if(!s&&z&&t>p){const e=f.dist(m);if(e>2*h){const t=f.sub(f.sub(m)._mult(h/e)._round());t.z=f.z,this.updateDistance(m,t),this.addCurrentVertex(t,g,0,0,d),m=t}}const _=m&&y;d.middleVertex=_;let T=_?i:u?"butt":r;if(_&&"round"===T&&(w<o?T="miter":w<=2&&(T="fakeround")),"miter"===T&&w>n&&!s&&(T="bevel"),"bevel"===T&&(w>2&&(T="flipbevel"),w<n&&(T="miter")),m&&this.updateDistance(m,f),"miter"===T)s?(this.addCurrentVertex(f,g,0,0,d),d.dir=y.sub(f)._unit(),this.addCurrentVertex(f,b,0,0,d)):(l._mult(w),this.addCurrentVertex(f,l,0,0,d),a&&(d.currentNormal=b,this.addCurrentVertex(f,l,0,0,d)));else if("flipbevel"===T){if(w>100)l=b.mult(-1);else{const e=w*g.add(b).mag()/g.sub(b).mag();l._perp()._mult(e*(A?-1:1))}this.addCurrentVertex(f,l,0,0,d),this.addCurrentVertex(f,l.mult(-1),0,0,d)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(w*w-1),t=A?e:0,i=A?0:e;if(m&&this.addCurrentVertex(f,g,t,i,d),"fakeround"===T){const e=Math.round(180*k/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+x*(x*(3.55645-1.43519*x)-3.2452))*e*e+(.848013+x*(.215638*x-1.06021)))}const r=b.sub(g)._mult(i)._add(g)._unit()._mult(A?-1:1);this.addHalfVertex(f,r.x,r.y,!1,A,0,d)}}y&&(d.currentNormal=b,this.addCurrentVertex(f,b,-t,-i,d))}else if("butt"===T)this.addCurrentVertex(f,l,0,0,d);else if("square"===T){const e=m?1:-1;this.addCurrentVertex(f,l,e,e,d)}else"round"===T&&(m&&(this.addCurrentVertex(f,g,0,0,d),this.addCurrentVertex(f,g,1,1,d,!0)),y&&(this.addCurrentVertex(f,b,-1,-1,d,!0),this.addCurrentVertex(f,b,0,0,d)));if(!s&&z&&t<c-1){const e=f.dist(y);if(e>2*h){const t=f.add(y.sub(f)._mult(h/e)._round());t.z=f.z,this.updateDistance(f,t),this.addCurrentVertex(t,b,0,0,d),f=t}}}}addCurrentVertex(e,t,i,r,n,o=!1){const a=t.x+t.y*i,s=t.y-t.x*i,l=t.y*r-t.x,u=-t.y-t.x*r;let c=0,p=0;if(n.middleVertex){io$2.x=a,io$2.y=s,ro$2.x=l,ro$2.y=u;const e=n.currentNormal;if(c=po$1(e,io$2),0===i&&0===r)p=-c;else{const t=no$2;t.x=e.x,t.y=e.y,t._mult(-1),p=po$1(t,ro$2)}}this.addHalfVertex(e,a,s,o,!1,i,n,c),this.addHalfVertex(e,l,u,o,!0,-r,n,p),this.prevVertex&&e.equals(this.prevVertex)||(this.prevVertex=e),this.distance>to$2/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,i,r,n,o))}addHalfVertex({x:e,y:t,z:i},r,n,o,a,s,l,u){this.fillData(this.data,e,t,i||0,r,n,o,a,1*this.scaledDistance,u);const c=l.vertexLength++;this.e1>=0&&this.e2>=0&&(this.addElements(this.e1,this.e2,c),l.primitiveLength++),a?this.e2=c:this.e1=c}fillData(e,t,i,r,n,o,a,s,l,u){const{lineWidthFn:c,lineStrokeWidthFn:p,lineStrokeColorFn:h,lineColorFn:d,lineOpacityFn:f,lineDxFn:m,lineDyFn:y,linePatternAnimSpeedFn:g,linePatternGapFn:b}=this._fnTypes;this.fillPosition(e,t,i,r);let x=63*n;x=(Math.sign(x)||1)*((Math.floor(Math.abs(x))>>1<<1)+ +a);let v=63*o;v=(Math.sign(v)||1)*((Math.floor(Math.abs(v))>>1<<1)+ +s),e.aExtrude.push(x,v),(this.iconAtlas||this.hasDasharray)&&e.aExtrude.push(63*u),e.aLinesofar.push(l),c&&e.aLineWidth.push(Math.round(2*this.feaLineWidth)),p&&e.aLineStrokeWidth.push(Math.round(2*this.feaLineStrokeWidth)),d&&e.aColor.push(...this.feaColor),h&&e.aStrokeColor.push(...this.feaStrokeColor),f&&e.aOpacity.push(this.feaOpacity),this.dasharrayFn&&e.aDasharray.push(...this.feaDash),this.dashColorFn&&e.aDashColor.push(...this.feaDashColor),this.iconAtlas&&e.aTexInfo.push(...this.feaTexInfo),(m||y)&&e.aLineDxDy.push(this.feaLineDx||0,this.feaLineDy||0),(g||b)&&e.aLinePattern.push(127*(this.feaPatternAnimSpeed||0),10*(this.feaLinePatternGap||0)),this.maxPos=Math.max(this.maxPos,Math.abs(t)+1,Math.abs(i)+1)}addElements(e,t,i){super.addElements(this.offset+e,this.offset+t,this.offset+i)}_filterPolygonEdges(e){const t=this.options.EXTENT,i=this.elements;for(let r=0;r<i.length;r+=3)t!==1/0&&(so$1(this.data.aPosition,i[r],i[r+1],3,t)||so$1(this.data.aPosition,i[r+1],i[r+2],3,t))||e.push(i[r],i[r+1],i[r+2])}_filterLine(e){if(e.length<=1)return e;const t=[],i=this.options.EXTENT;let r,n=!0;for(r=0;r<e.length-1;r++){const o=ao$1(e[r],e[r+1],i);o&&n||(t.push(e[r]),n=o)}return n||t.push(e[r]),t}updateDistance(e,t){if(this.options.isTube){const i=e.dist(t),r=B$7(this.options)*(t.z-e.z);this.distance+=Math.sqrt(i*i+r*r)}else this.distance+=e.dist(t);this.updateScaledDistance()}updateScaledDistance(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(to$2-1):this.distance}}function ao$1(e,t,i){return i!==1/0&&(e.x<0&&t.x<0||e.x>i&&t.x>i||e.y<0&&t.y<0||e.y>i&&t.y>i)}function so$1(e,t,i,r,n){if(n===1/0)return!1;const o=Math.floor(.5*e[t*r]),a=Math.floor(.5*e[t*r+1]),s=Math.floor(.5*e[i*r]),l=Math.floor(.5*e[i*r+1]);return o===s&&(o<0||o>n)&&a!==l||a===l&&(a<0||a>n)&&o!==s}function lo$1(e){if(!Array.isArray(e))return!1;for(let t=0;t<e.length;t++)if(e[t])return!0;return!1}const uo$1=new pointGeometry(0,0),co$1=new pointGeometry(0,0);function po$1(e,t){const i=e.mag(),r=t.mag();uo$1.x=t.x,uo$1.y=t.y;const n=e.angleTo(co$1),o=t.angleTo(co$1);return Math.sign(o-n)*Math.sqrt(r*r-i*i)}
/*!
	 * from @turf/bboxClip
	 * https://github.com/Turfjs/turf
	 * MIT LICENSE
	 */const bo$1=[],xo$1=[];function vo$1(t,i){var r,n,o,a,s,l,u;for(n=1;n<=8;n*=2){for(r=[],a=!(ko$1(o=t[t.length-1],i)&n),s=0;s<t.length;s++){if((u=!(ko$1(l=t[s],i)&n))!==a){const t=wo$1(o,l,n,i);r.push(void 0!==l.x?new pointGeometry(t[0],t[1]):t)}u&&r.push(l),o=l,a=u}if(!(t=r).length)break}return r}function wo$1(e,t,i,r){return bo$1[0]=void 0===e.x?e[0]:e.x,bo$1[1]=void 0===e.y?e[1]:e.y,e=bo$1,xo$1[0]=void 0===t.x?t[0]:t.x,xo$1[1]=void 0===t.y?t[1]:t.y,t=xo$1,8&i?[e[0]+(t[0]-e[0])*(r[3]-e[1])/(t[1]-e[1]),r[3]]:4&i?[e[0]+(t[0]-e[0])*(r[1]-e[1])/(t[1]-e[1]),r[1]]:2&i?[r[2],e[1]+(t[1]-e[1])*(r[2]-e[0])/(t[0]-e[0])]:1&i?[r[0],e[1]+(t[1]-e[1])*(r[0]-e[0])/(t[0]-e[0])]:null}function ko$1(e,t){bo$1[0]=void 0===e.x?e[0]:e.x,bo$1[1]=void 0===e.y?e[1]:e.y;var i=0;return(e=bo$1)[0]<t[0]?i|=1:e[0]>t[2]&&(i|=2),e[1]<t[1]?i|=4:e[1]>t[3]&&(i|=8),i}const zo$1=[0,0,0,0];class Ao$1 extends dr$3{constructor(...e){super(...e),this.lineElements=[]}createStyledVector(e,t,i,r,n){const o=new le$3(e,t,i,r),a=o.getPolygonResource();return!this.options.atlas&&a&&(n[a]=[0,0]),o}getFormat(){const e=[...this.getPositionFormat()],{polygonFillFn:t,polygonOpacityFn:i,uvScaleFn:r,uvOffsetFn:n}=this._fnTypes;if(this.iconAtlas){const t=this.getIconAtlasMaxValue();e.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return t&&e.push({type:Uint8Array,width:4,name:"aColor"}),i&&e.push({type:Uint8Array,width:1,name:"aOpacity"}),r&&e.push({type:Uint16Array,width:2,name:"aUVScale"}),n&&e.push({type:Uint8Array,width:2,name:"aUVOffset"}),e}createDataPack(...e){this.maxLineIndex=0,this.lineElements=[];const t=super.createDataPack(...e);if(!t)return t;let i=this.lineElements;return i=new(D$6(this.maxLineIndex))(this.lineElements),t.lineIndices=i,t.buffers.push(i.buffer),t}placeVector(e,t){const i=e.feature;this._addPolygon(i.geometry,i,t)}_addPolygon(e,t){let r,n,o,a;const{polygonFillFn:s,polygonOpacityFn:l,uvScaleFn:u,uvOffsetFn:c}=this._fnTypes,d=t.properties;s&&(r=s(this.options.zoom,d)||set$3([],255,255,255,255),r=isFunctionDefinition(r)?zo$1:Y$4([],r)),l&&(n=l(this.options.zoom,d),q$5(n)&&(n=1),n*=255),u&&(o=u(this.options.zoom,d),q$5(o)&&(o=[1,1]),o=[255*o[0],255*o[1]]),c&&(a=c(this.options.zoom,d),q$5(a)&&(a=[0,0]),a=[255*a[0],255*a[1]]);const f=!!this.iconAtlas,m=Un$2(e,500),y=[0,0],g=[0,0];if(f){const{polygonPatternFileFn:e}=this._fnTypes,t=e?e(null,d):this.symbol.polygonPatternFile;if(this.iconAtlas.glyphMap[t]){const e=this.iconAtlas.positions[t];y[0]=e.tl[0]+1,y[1]=e.tl[1]+1,g[0]=e.displaySize[0]-3,g[1]=e.displaySize[1]-3}}const b=this.needAltitudeAttribute()?2:3,x=[-1,-1,t.extent+1,t.extent+1];for(let e=0;e<m.length;e++){const t=m[e],i=this.data.aPosition.length/b,s=[],l=[];for(let e=0;e<t.length;e++){let i=t[e];if(this.options.EXTENT!==1/0&&0===this.maxPosZ&&(i=vo$1(i,x)),0===i.length)continue;0!==e&&l.push(s.length/3);const u=this.lineElements.length;this.fillPosition(this.data,i[0].x,i[0].y,i[0].z||0),f&&this.data.aTexInfo.push(...y,...g),void 0!==r&&this.data.aColor.push(...r),void 0!==n&&this.data.aOpacity.push(n),void 0!==o&&this.data.aUVScale.push(...o),void 0!==a&&this.data.aUVOffset.push(...a),this.maxPos=Math.max(this.maxPos,Math.abs(i[0].x),Math.abs(i[0].y)),this.addLineElements(u+i.length-1,u),s.push(i[0].x),s.push(i[0].y),s.push(i[0].z||0);for(let e=1;e<i.length;e++)this.fillPosition(this.data,i[e].x,i[e].y,i[e].z||0),f&&this.data.aTexInfo.push(...y,...g),void 0!==r&&this.data.aColor.push(...r),void 0!==n&&this.data.aOpacity.push(n),void 0!==o&&this.data.aUVScale.push(...o),void 0!==a&&this.data.aUVOffset.push(...a),this.maxPos=Math.max(this.maxPos,Math.abs(i[e].x),Math.abs(i[e].y)),this.addLineElements(u+e-1,u+e),s.push(i[e].x),s.push(i[e].y),s.push(i[e].z||0)}const u=earcut$1.exports(s,l,3);for(let e=0;e<u.length;e+=3)this.addElements(i+u[e],i+u[e+1],i+u[e+2])}}addLineElements(...e){this.maxLineIndex=Math.max(this.maxLineIndex,...e),this.lineElements.push(...e)}}class No$1{constructor(e){this.max=e,this.reset()}reset(){return this.data={},this.order=[],this}clear(){this.reset()}add(e,t){return this.has(e)?(this.order.splice(this.order.indexOf(e),1),this.data[e]=t,this.order.push(e)):(this.data[e]=t,this.order.push(e),this.order.length>this.max&&this.getAndRemove(this.order[0])),this}has(e){return e in this.data}keys(){return this.order}getAndRemove(e){if(!this.has(e))return null;const t=this.data[e];return delete this.data[e],this.order.splice(this.order.indexOf(e),1),t}get(e){return this.has(e)?this.data[e]:null}remove(e){return this.has(e)?(delete this.data[e],this.order.splice(this.order.indexOf(e),1),this):this}setMaxSize(e){for(this.max=e;this.order.length>this.max;)this.getAndRemove(this.order[0]);return this}}
/*!
	 * based on @mapbox/tiny-sdf
	 * https://github.com/mapbox/tiny-sdf
	 * @License BSD 2-Clause
	 */var $o=1e20;function Uo$1(e,t,i,r,n,o,a){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=n||"sans-serif",this.fontWeight=o||"normal",this.fontStyle=a||"normal",this.radius=i||8;var s=this.size=this.fontSize+2*this.buffer;this.canvas="undefined"==typeof document?new OffscreenCanvas(s,s):document.createElement("canvas"),this.canvas.width=this.canvas.height=s,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.middle=Math.round(s/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Wo$1(e,t,i,r,n,o){for(var a=0;a<t;a++)Vo$1(e,a,t,i,r,n,o);for(var s=0;s<i;s++)Vo$1(e,s*t,1,t,r,n,o)}function Vo$1(e,t,i,r,n,o,a){var s,l,u,c;for(o[0]=0,a[0]=-$o,a[1]=$o,s=0;s<r;s++)n[s]=e[t+s*i];for(s=1,l=0,u=0;s<r;s++){do{u=(n[s]-n[c=o[l]]+s*s-c*c)/(s-c)/2}while(u<=a[l]&&--l>-1);o[++l]=s,a[l]=u,a[l+1]=$o}for(s=0,l=0;s<r;s++){for(;a[l+1]<s;)l++;e[t+s*i]=n[c=o[l]]+(s-c)*(s-c)}}Uo$1.prototype.draw=function(e,t,i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.textBaseline="bottom",this.ctx.fillText(e,this.buffer,i-this.buffer+1);for(var r=this.ctx.getImageData(0,0,t,i),n=new Uint8ClampedArray(t*i),o=0;o<t*i;o++){var a=r.data[4*o+3]/255;this.gridOuter[o]=1===a?0:0===a?$o:Math.pow(Math.max(0,.5-a),2),this.gridInner[o]=1===a?$o:0===a?0:Math.pow(Math.max(0,a-.5),2)}for(Wo$1(this.gridOuter,t,i,this.f,this.v,this.z),Wo$1(this.gridInner,t,i,this.f,this.v,this.z),o=0;o<t*i;o++){var s=Math.sqrt(this.gridOuter[o])-Math.sqrt(this.gridInner[o]);n[o]=Math.round(255-255*(s/this.radius+this.cutoff))}return n};let Ho$1=0;class Go$1{constructor(e,t=15,i){this.entries={},this._cachedFont={},this._cache=new No$1(2048,(function(){})),this._framer=e,this._limit=t,this._isCompactChars=i}getGlyphs(e,t){if(!e||!Object.keys(e).length)return void t(null,{glyphs:null});const i=this.entries,r=e.options;let n=!0;r&&(n=!1!==r.isCharsCompact),n=n||this._isCompactChars;const o=(r,o,s)=>{let l=0,u=0;for(const t in e)if("options"!==t){i[t]=i[t]||{},o[t]=o[t]||{};for(const c in e[t]){if(u++,u<=r)continue;const e=t.split(" "),p=n&&"normal"===e[0]&&!gn$2(+c),h=t+":"+c+":"+p;let d;if(this._cache.has(h)?d=this._cache.get(h):(d=this._tinySDF(i[t],e,c,p),this._cache.add(h,d),l++),d=Jo(d),o[t][c]=d,s.push(d.bitmap.data.buffer),l>this._limit)return void this._framer(a(u,o,s))}}t(null,{glyphs:o,buffers:s})};function a(e,t,i){return()=>{o(e,t,i)}}o(0,{},[])}_tinySDF(e,t,i,r){const n=t[0],o=t[1],a=t.slice(3).join(" ");let s=e.tinySDF,l="normal"!==n?5:2;const u=r?-1:2;if(!s){let t="400";/bolder/i.test(o)?t="1000":/bold/i.test(o)?t="900":/medium/i.test(o)?t="500":/light/i.test(o)&&(t="200"),s=e.tinySDF=new Uo$1(24,l,8,.25,a,t,n)}const c=String.fromCharCode(i),p=s.ctx.measureText(c),h=Math.round(p.width),d=s.draw(String.fromCharCode(i),h+2*l,24+2*l);if(Ho$1<4){const e="undefined"!=typeof document&&document.getElementById("sdf-debug-"+Ho$1++);e&&(e.width=h+2*l,e.height=s.canvas.height,e.getContext("2d").drawImage(s.canvas,0,0))}return{charCode:i,bitmap:{width:h+2*l,height:24+2*l,data:d},metrics:{width:h,height:24,left:0,top:-7-(l-2),advance:h+l+u}}}}function Jo(e){const t={width:e.bitmap.width,height:e.bitmap.height,data:new Uint8ClampedArray(e.bitmap.data)};return{charCode:e.charCode,bitmap:t,metrics:R$7({},e.metrics)}}class Bo$1{constructor(e){this.options=e||{},this._requesting={},this._cache=new No$1(256,(function(){}));const t=document.createElement("canvas");this.ctx=t.getContext("2d")}getIcons(e,t){if(!e||!Object.keys(e).length)return void t(null,{icons:null});const i=Object.keys(e),r={},n=[];let o=0,a=0;const s=this;function l(e,i){r[e]=s._getCache(e,i),r[e]&&"error"!==r[e]?n.push(r[e].data.data.buffer):delete r[e],a++,a===o&&t(null,{icons:r,buffers:n})}function u(e){const t=s._requesting[e.url];for(let i=0;i<t.length;i++)t[i].call(e,e.url,e.size);delete s._requesting[e.url]}function c(){const e=s.ctx;let t,i;try{const r=this.width/this.height;t=this.size[0]?this.size[0]:this.width,this.size[1]?(i=this.size[1],this.size[0]||(t=i*r)):i=this.size[0]?t/r:this.height,this.size[0]=t,this.size[1]=i,s._ensureMaxSize(null,this.size),t=this.size[0],i=this.size[1],e.canvas.width=t,e.canvas.height=i,e.imageSmoothingEnabled=!1,e.drawImage(this,0,0,t,i);const n=e.getImageData(0,0,t,i).data;s._addCache(this.url,n,t,i)}catch(e){console.warn(e)}u(this)}function p(e){console.warn(`failed loading icon(${this.index}) at "${this.url}"`),console.warn(e),s.options.iconErrorUrl?this.src=s.options.iconErrorUrl:(s._addCache(this.url),u(this))}let h,d=!1;for(let t=0;t<i.length;t++){const a=i[t],s=e[a];this._ensureMaxSize(a,s);const u=this._getCache(a,s);if(u&&"error"!==u){r[a]=this._getCache(a,s);continue}if("error"===u)continue;let f,g=a;if(0===a.indexOf("vector://")&&(f=JSON.parse(a.substring("vector://".length)),"path"===f.markerType&&(g=t$2.Util.getMarkerPathBase64(f,f.markerWidth,f.markerHeight))),0===a.indexOf("vector://")&&"path"!==f.markerType){h=h||new t$2.Marker([0,0]);const{markerFill:e,markerLineColor:t}=f;e&&Array.isArray(e)&&(f.markerFill=Xo(e)),t&&Array.isArray(t)&&(f.markerLineColor=Xo(t)),delete f.markerHorizontalAlignment,delete f.markerVerticalAlignment,delete f.markerDx,delete f.markerDy,delete f.markerPlacement,delete f.markerFile,f.markerWidth=s[0],f.markerHeight=s[1],h.setSymbol(f);const i=h["_getSprite".trim()]();if(i){const e=i.canvas,t=e.width,o=e.height,s=e.getContext("2d").getImageData(0,0,t,o).data;r[a]={data:{data:new Uint8ClampedArray(s),width:t,height:o},url:a},n.push(r[a].data.data.buffer),this._addCache(a,s,t,o)}}else{if(this._requesting[a]){d=!0,o++,this._requesting[a].push(l);continue}this._requesting[a]=[],this._requesting[a].push(l);const e=new Image;e.index=t,e.size=s,e.onload=c,e.onerror=p,e.onabort=p,e.url=a,e.crossOrigin="Anonymous",d=!0,o++,e.src=g}}d||t(null,{icons:r,buffers:n})}_hasCache(e,t,i){const r=this._cache.get(e);return r&&"error"!==r&&r.data.width>=t&&r.data.height>=i}_addCache(e,t,i,r){this._hasCache(e,i,r)||this._cache.add(e,t?{data:{data:t,width:i,height:r},url:e}:"error")}_getCache(e,t){if(!this._hasCache(e,t[0],t[1]))return null;const i=this._cache.get(e);return i?"error"===i?i:{data:{data:new Uint8ClampedArray(i.data.data),width:i.data.width,height:i.data.height},url:i.url}:null}_ensureMaxSize(e,t){if(!t[0]||!t[1])return;const i=this.options.maxSize||254;let[r,n]=t;const o=r/n;if(e){const t=this._cache.get(e);if(t&&"error"!==t){const{width:e,height:i}=t.data;e>r&&(r=e),i>n&&(n=i)}}r>i&&(n=i/o,r=i),n>i&&(r=i*o,n=i),t[0]=Math.floor(r),t[1]=Math.floor(n)}}function Xo(e){return 3===e.length&&e.push(1),e.reduce(((e,t,i)=>e+(i<3?255*t+",":t+")")),"rgba(")}var Zo=Object.freeze({__proto__:null,clipPolygon:vo$1,calculateSignedArea:Q$5,getFeaAltitudeAndHeight:function(e,t,i,r,n,o,a){t||0===t||(t=1);const s=te$3(e.properties,i,r),l=s*t;let u=o&&100*o||s;return n?u=te$3(e.properties,n,o):a&&(u=s-te$3(e.properties,a,o)),u*=t,{altitude:l,height:u}},generateFeatureIndex:ae$3,generateFeatureIndiceIndex:se$3,convertRTLText:Cn$2,packPosition:ue$3,unpackPosition:function(e,t,i,r){const n=(Math.sign(t)||1)*(Math.abs(t)%ce$3),o=(Math.sign(i)||1)*(Math.abs(i)%ce$3),a=Math.floor(Math.abs(t)/ce$3),s=Math.floor(Math.abs(i)/ce$3);return e[0]=n,e[1]=o,e[2]=Math.sign(r+1e-5)*(2*a+s)*pe$3+r,e}});const Ko$1={polygonPatternFile:1,markerFile:1,markerPlacement:1,markerSpacing:1,textName:1,textStyle:1,textFaceName:1,textWeight:1,textPlacement:1,textSpacing:1,lineJoin:1,lineCap:1,linePatternFile:1},Qo$1={visible:1,textHorizontalAlignment:1,textVerticalAlignment:1,textWrapWidth:1,markerHorizontalAlignment:1,markerVerticalAlignment:1},ea={lineDasharray:1};Object.assign(Qo$1,Ko$1),Object.assign(ea,Ko$1);
/*!
	* Contains code from jquery.easing
	* BSD License
	* https://github.com/gdsmith/jquery.easing/
	*/
var pow=Math.pow,sqrt=Math.sqrt,sin=Math.sin,cos=Math.cos,PI=Math.PI,c1=1.70158,c2=1.525*c1,c3=c1+1,c4=2*PI/3,c5=2*PI/4.5;function bounceOut(x){var n1=7.5625,d1=2.75;return x<1/d1?n1*x*x:x<2/d1?n1*(x-=1.5/d1)*x+.75:x<2.5/d1?n1*(x-=2.25/d1)*x+.9375:n1*(x-=2.625/d1)*x+.984375}function F$5(easing,x){switch(easing=easing.toLowerCase()){case"swing":return function(x){return easeInQuad(x)}(x);case"easeinquad":return easeInQuad(x);case"easeoutquad":return function(x){return 1-(1-x)*(1-x)}(x);case"easeinoutquad":return function(x){return x<.5?2*x*x:1-pow(-2*x+2,2)/2}(x);case"easeincubic":return function(x){return x*x*x}(x);case"easeoutcubic":return function(x){return 1-pow(1-x,3)}(x);case"easeinoutcubic":return function(x){return x<.5?4*x*x*x:1-pow(-2*x+2,3)/2}(x);case"easeinquart":return function(x){return x*x*x*x}(x);case"easeoutquart":return function(x){return 1-pow(1-x,4)}(x);case"easeinoutquart":return function(x){return x<.5?8*x*x*x*x:1-pow(-2*x+2,4)/2}(x);case"easeinquint":return function(x){return x*x*x*x*x}(x);case"easeoutquint":return function(x){return 1-pow(1-x,5)}(x);case"easeinoutquint":return function(x){return x<.5?16*x*x*x*x*x:1-pow(-2*x+2,5)/2}(x);case"easeinsine":return function(x){return 1-cos(x*PI/2)}(x);case"easeoutsine":return function(x){return sin(x*PI/2)}(x);case"easeinoutsine":return function(x){return-(cos(PI*x)-1)/2}(x);case"easeinexpo":return function(x){return 0===x?0:pow(2,10*x-10)}(x);case"easeoutexpo":return function(x){return 1===x?1:1-pow(2,-10*x)}(x);case"easeinoutexpo":return function(x){return 0===x?0:1===x?1:x<.5?pow(2,20*x-10)/2:(2-pow(2,-20*x+10))/2}(x);case"easeincirc":return function(x){return 1-sqrt(1-pow(x,2))}(x);case"easeoutcirc":return function(x){return sqrt(1-pow(x-1,2))}(x);case"easeinoutcirc":return function(x){return x<.5?(1-sqrt(1-pow(2*x,2)))/2:(sqrt(1-pow(-2*x+2,2))+1)/2}(x);case"easeinelastic":return function(x){return 0===x?0:1===x?1:-pow(2,10*x-10)*sin((10*x-10.75)*c4)}(x);case"easeoutelastic":return function(x){return 0===x?0:1===x?1:pow(2,-10*x)*sin((10*x-.75)*c4)+1}(x);case"easeinoutelastic":return function(x){return 0===x?0:1===x?1:x<.5?-pow(2,20*x-10)*sin((20*x-11.125)*c5)/2:pow(2,-20*x+10)*sin((20*x-11.125)*c5)/2+1}(x);case"easeinback":return function(x){return c3*x*x*x-c1*x*x}(x);case"easeoutback":return function(x){return 1+c3*pow(x-1,3)+c1*pow(x-1,2)}(x);case"easeinoutback":return function(x){return x<.5?pow(2*x,2)*(7.189819*x-c2)/2:(pow(2*x-2,2)*((c2+1)*(2*x-2)+c2)+2)/2}(x);case"easeinbounce":return function(x){return 1-bounceOut(1-x)}(x);case"easeoutbounce":return function(x){return bounceOut(x)}(x);case"easeinoutbounce":return function(x){return x<.5?(1-bounceOut(1-2*x))/2:(1+bounceOut(2*x-1))/2}(x)}throw new Error("Unsupported easing function:"+easing)}function easeInQuad(x){return x*x}function VectorTilePlugin(){}const parentProto=VectorTilePlugin.prototype;parentProto.getType=function(){return Object.getPrototypeOf(this).constructor.type},parentProto.isVisible=function(){throw new Error("to be implemented.")},parentProto.prepareRender=function(){throw new Error("to be implemented.")},parentProto.updateCollision=function(){throw new Error("to be implemented.")},parentProto.supportRenderMode=function(){throw new Error("to be implemented.")},parentProto.startFrame=function(){throw new Error("to be implemented.")},parentProto.endFrame=function(){throw new Error("to be implemented.")},parentProto.paintTile=function(){throw new Error("to be implemented.")},parentProto.getShadowMeshes=function(){throw new Error("to be implemented.")},parentProto.updateSceneConfig=function(){throw new Error("to be implemented.")},parentProto.updateDataConfig=function(){throw new Error("to be implemented.")},parentProto.updateSymbol=function(){throw new Error("to be implemented.")},parentProto.pick=function(){throw new Error("to be implemented.")},parentProto.resize=function(){throw new Error("to be implemented.")},parentProto.deleteTile=function(){throw new Error("to be implemented.")},parentProto.remove=function(){throw new Error("to be implemented.")},parentProto.needToRedraw=function(){throw new Error("to be implemented.")},parentProto.needToRetireFrames=function(){throw new Error("to be implemented.")},parentProto.outline=function(){throw new Error("to be implemented.")},parentProto.outlineAll=function(){throw new Error("to be implemented.")},parentProto.needPolygonOffset=function(){throw new Error("to be implemented.")},parentProto.constructor=VectorTilePlugin;const hasOwn=Object.prototype.hasOwnProperty;function registerAt(VectorTileLayer){VectorTileLayer.registerPlugin(this)}
/*!
	 * @maptalks/vt v0.74.2
	 * LICENSE : undefined
	 * (c) 2016-2022 maptalks.org
	 */VectorTilePlugin.extend=function(type,props){const clazz=function(){this.init&&this.init()},proto=Object.create(parentProto);proto.constructor=clazz,clazz.prototype=proto,clazz.type=type;for(const p in props)hasOwn.call(props,p)&&(clazz.prototype[p]=props[p]);return clazz.registerAt=registerAt.bind(clazz),clazz};const D$5='function(t){function e(t,e){for(let i=0;i<t.stops.length;i++)if(e===t.stops[i][0])return t.stops[i][1];return t.default}function i(t,e){for(var i=0;i<t.stops.length&&!(e<t.stops[i][0]);i++);return t.stops[Math.max(i-1,0)][1]}function n(t,e){for(var i=void 0!==t.base?t.base:1,n=0;!(n>=t.stops.length||e<=t.stops[n][0]);)n++;return 0===n?t.stops[n][1]:n===t.stops.length?t.stops[n-1][1]:function t(e,i,n,r,s,a){return"function"==typeof s?function(){var o=s.apply(void 0,arguments),l=a.apply(void 0,arguments);return t(e,i,n,r,o,l)}:s.length?function(t,e,i,n,r,s){var a=[];for(let l=0;l<r.length;l++)a[l]=o(t,e,i,n,r[l],s[l]);return a}(e,i,n,r,s,a):o(e,i,n,r,s,a)}(e,i,t.stops[n-1][0],t.stops[n][0],t.stops[n-1][1],t.stops[n][1])}function r(t,e){return function(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:null}(e,t.default)}function o(t,e,i,n,r,o){var s,a=n-i,l=t-i;return r*(1-(s=1===e?l/a:(Math.pow(e,l)-1)/(Math.pow(e,a)-1)))+o*s}function s(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type)}function a(t){return c(t,"exponential")}function l(t){return c(t,"interval")}function u(t,e){if(!t)return null;var i=!1;if(Array.isArray(t)){var n,r=[];for(let o=0;o<t.length;o++)(n=u(t[o],e))?(r.push(n),i=!0):r.push(t[o]);return i?r:t}var o,l={__fn_types_loaded:!0},c=[];for(o in t)t.hasOwnProperty(o)&&c.push(o);const h=function(t){Object.defineProperty(l,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=a(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})};for(let e=0,n=c.length;e<n;e++)s(t[o=c[e]])?(i=!0,l["_"+o]=t[o],h(o)):l[o]=t[o];return i?l:t}function c(t,o){if(!s(t))return function(){return t};let a=!0,l=!0;const u=(t=JSON.parse(JSON.stringify(t))).stops;if(u)for(let t=0;t<u.length;t++)if(s(u[t][1])){const e=c(u[t][1],o);a=a&&e.isZoomConstant,l=l&&e.isFeatureConstant,u[t]=[u[t][0],e]}const h=function t(o,a){var l,u,c;if(s(o)){var h,d=o.stops&&"object"==typeof o.stops[0][0],f=d||void 0!==o.property,p=d||!f,m=o.type||a||"exponential";if("exponential"===m)h=n;else if("interval"===m)h=i;else if("categorical"===m)h=e;else{if("identity"!==m)throw new Error(\'Unknown function type "\'+m+\'"\');h=r}if(d){var y={},g=[];for(let t=0;t<o.stops.length;t++){var b=o.stops[t];void 0===y[b[0].zoom]&&(y[b[0].zoom]={zoom:b[0].zoom,type:o.type,property:o.property,default:o.default,stops:[]}),y[b[0].zoom].stops.push([b[0].value,b[1]])}for(let e in y)g.push([y[e].zoom,t(y[e])]);l=function(t,e){const i=n({stops:g,base:o.base},t)(t,e);return"function"==typeof i?i(t,e):i},u=!1,c=!1}else p?(l=function(t){const e=h(o,t);return"function"==typeof e?e(t):e},u=!0,c=!1):(l=function(t,e){const i=h(o,e?e[o.property]:null);return"function"==typeof i?i(t,e):i},u=!1,c=!0)}else l=function(){return o},u=!0,c=!0;return l.isZoomConstant=c,l.isFeatureConstant=u,l}(t,o);return h.isZoomConstant=a&&h.isZoomConstant,h.isFeatureConstant=l&&h.isFeatureConstant,h}let h=0;const d="function"==typeof Object.assign;function f(t,...e){if(d)return Object.assign(t,...e),t;for(let i=0;i<e.length;i++){const n=e[i];for(const e in n)t[e]=n[e]}return t}function p(t){return!b(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function m(t){return"number"==typeof t&&!isNaN(t)}function y(t){return!b(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function g(t){return!Array.isArray(t)&&"object"==typeof t&&!!t}function b(t){return null==t}function v(t){for(let e=1;e<arguments.length;e++){const i=arguments[e];if(i)for(let e=0,n=i.length;e<n;e++)t.push(i[e])}return t.length}function w(t){return t<65536?Uint16Array:Uint32Array}function x(t){return t<256?Uint8Array:t<65536?Uint16Array:Uint32Array}function k(t){return(t=Math.abs(t))<128?Int8Array:t<32768?Int16Array:Float32Array}function M(t){return s(t)&&t.property}const j="function"==typeof fetch&&"function"==typeof AbortController,A={jsonp:function(t,e){const i="_maptalks_jsonp_"+h++;t.match(/\\?/)?t+="&callback="+i:t+="?callback="+i;let n=document.createElement("script");return n.type="text/javascript",n.src=t,window[i]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[i]},document.getElementsByTagName("head")[0].appendChild(n),this},get:function(t,e,i){if(y(e)){const t=i;i=e,e=t}(e=e||{}).method&&(e.method=e.method.toUpperCase());const n="POST"===e.method;if(j){const r=new AbortController,o={signal:r.signal,method:e.method||"GET",referrerPolicy:"origin"};return n&&(b(e.body)||(o.body=JSON.stringify(e.body))),b(e.headers)||(o.headers=e.headers),b(e.credentials)||(o.credentials=e.credentials),fetch(t,o).then(n=>{const r=this.t(n,e.returnJSON,e.responseType);r.message?(r.url=t,i(r)):r.then(t=>{"arraybuffer"===e.responseType?i(null,{data:t,cacheControl:n.headers.get("Cache-Control"),expires:n.headers.get("Expires"),contentType:n.headers.get("Content-Type")}):i(null,t)}).catch(t=>{t.code&&t.code===DOMException.ABORT_ERR||(console.error(t),i(t))})}).catch(t=>{t.code&&t.code===DOMException.ABORT_ERR||(console.error(t),i(t))}),r}{const r=A.o(i);if(r.open(e.method||"GET",t,!0),e){for(const t in e.headers)r.setRequestHeader(t,e.headers[t]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(n?e.body:null),r}},t:(t,e,i)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===i?t.arrayBuffer():e?t.json():t.text(),s:function(t,e){return function(){if(4===t.readyState)if(200===t.status)if("arraybuffer"===t.responseType){0===t.response.byteLength?e({status:200,statusText:t.statusText,message:"http status 200 returned without content."}):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")})}else e(null,t.responseText);else e({status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`})}},o:function(t){let e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=A.s(e,t),e},getArrayBuffer(t,e,i){if(y(e)){const t=i;i=e,e=t}return e||(e={}),e.responseType="arraybuffer",A.get(t,e,i)}};function F(t,e,i,n,r,o){let s=r-i,a=o-n;if(0!==s||0!==a){const l=((t-i)*s+(e-n)*a)/(s*s+a*a);l>1?(i=r,n=o):l>0&&(i+=s*l,n+=a*l)}return s=t-i,a=e-n,s*s+a*a}function T(t,e,i,n,r,o){const s={id:null==t?null:t,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};r&&(s.layer=r);return function(t,e){const i=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)z(t,i,e);else if("Polygon"===n)z(t,i[0],e);else if("MultiLineString"===n)for(const n of i)z(t,n,e);else if("MultiPolygon"===n)for(const n of i)z(t,n[0],e)}(s,o?4:3),s}function z(t,e,i){for(let n=0;n<e.length;n+=i)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function S(t,e,i,n){if(n.layer=e,"FeatureCollection"===i.type)for(let e=0;e<i.features.length;e++)_(t,i.features[e],n,e);else"Feature"===i.type?_(t,i,n):_(t,{geometry:i},n)}function _(t,e,i,n){if(!e.geometry)return;const r=e.geometry.coordinates,o=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=n||0),"Point"===o)P(r,a,i.hasAltitude);else if("MultiPoint"===o)for(const t of r)P(t,a,i.hasAltitude);else if("LineString"===o)I(r,a,s,!1,i.hasAltitude);else if("MultiLineString"===o){if(i.lineMetrics){for(const n of r)a=[],I(n,a,s,!1,i.hasAltitude),t.push(T(l,"LineString",a,e.properties,i.layer,i.hasAltitude));return}O(r,a,s,!1,i.hasAltitude)}else if("Polygon"===o)O(r,a,s,!0,i.hasAltitude);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const r of e.geometry.geometries)_(t,{id:l,geometry:r,properties:e.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of r){const e=[];O(t,e,s,!0,i.hasAltitude),a.push(e)}}t.push(T(l,o,a,e.properties,i.layer,i.hasAltitude))}function P(t,e,i){e.push(E(t[0]),q(t[1]),0),i&&(t.length>2?e.push(t[2]):e.push(0))}function I(t,e,i,n,r){let o,s,a=0;for(let i=0;i<t.length;i++){const l=E(t[i][0]),u=q(t[i][1]);e.push(l,u,0),r&&(t[i].length>2?e.push(t[i][2]):e.push(0)),i>0&&(a+=n?(o*u-l*s)/2:Math.sqrt(Math.pow(l-o,2)+Math.pow(u-s,2))),o=l,s=u}const l=r?4:3,u=e.length-l;e[2]=1,function t(e,i,n,r,o=3){let s=r;const a=n-i>>1;let l,u=n-i;const c=e[i],h=e[i+1],d=e[n],f=e[n+1];for(let t=i+o;t<n;t+=o){const i=F(e[t],e[t+1],c,h,d,f);if(i>s)l=t,s=i;else if(i===s){const e=Math.abs(t-a);e<u&&(l=t,u=e)}}s>r&&(l-i>o&&t(e,i,l,r,o),e[l+2]=s,n-l>o&&t(e,l,n,r,o))}(e,0,u,i,l),e[u+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function O(t,e,i,n,r){for(let o=0;o<t.length;o++){const s=[];I(t[o],s,i,n,r),e.push(s)}}function E(t){return t/360+.5}function q(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function R(t,e,i,n,r,o,s,a){if(n/=e,o>=(i/=e)&&s<n)return t;if(s<i||o>=n)return null;const l=[];for(const e of t){const t=e.geometry;let o=e.type;const s=0===r?e.minX:e.minY,u=0===r?e.maxX:e.maxY;if(s>=i&&u<n){l.push(e);continue}if(u<i||s>=n)continue;let c=[];if("Point"===o||"MultiPoint"===o)C(t,c,i,n,r,a.hasAltitude);else if("LineString"===o)N(t,c,i,n,r,!1,a.lineMetrics,a.hasAltitude);else if("MultiLineString"===o)D(t,c,i,n,r,!1,a.hasAltitude);else if("Polygon"===o)D(t,c,i,n,r,!0,a.hasAltitude);else if("MultiPolygon"===o)for(const e of t){const t=[];D(e,t,i,n,r,!0,a.hasAltitude),t.length&&c.push(t)}if(c.length){if(a.lineMetrics&&"LineString"===o){for(const t of c)l.push(T(e.id,o,t,e.tags,e.layer,a.hasAltitude));continue}"LineString"!==o&&"MultiLineString"!==o||(1===c.length?(o="LineString",c=c[0]):o="MultiLineString"),"Point"!==o&&"MultiPoint"!==o||(o=3===c.length?"Point":"MultiPoint"),l.push(T(e.id,o,c,e.tags,e.layer,a.hasAltitude))}}return l.length?l:null}function C(t,e,i,n,r,o){const s=o?4:3;for(let a=0;a<t.length;a+=s){const s=t[a+r];s>=i&&s<=n&&(U(e,t[a],t[a+1],t[a+2]),o&&e.push(t[a+3]))}}function N(t,e,i,n,r,o,s,a){let l=L(t);const u=0===r?$:W;let c,h,d=t.start;const f=a?4:3;for(let p=0;p<t.length-f;p+=f){const m=t[p],y=t[p+1],g=t[p+2],b=t[p+f],v=t[p+f+1];let w,x;a&&(w=t[p+3],x=t[p+f+3]);const k=0===r?m:y,M=0===r?b:v;let j=!1;s&&(c=Math.sqrt(Math.pow(m-b,2)+Math.pow(y-v,2))),k<i?M>i&&(h=u(l,m,y,b,v,i),a&&l.push(J(w,x,h)),s&&(l.start=d+c*h)):k>n?M<n&&(h=u(l,m,y,b,v,n),a&&l.push(J(w,x,h)),s&&(l.start=d+c*h)):(U(l,m,y,g),a&&l.push(w)),M<i&&k>=i&&(h=u(l,m,y,b,v,i),a&&l.push(J(w,x,h)),j=!0),M>n&&k<=n&&(h=u(l,m,y,b,v,n),a&&l.push(J(w,x,h)),j=!0),!o&&j&&(s&&(l.end=d+c*h),e.push(l),l=L(t)),s&&(d+=c)}let p=t.length-f;const m=t[p],y=t[p+1],g=t[p+2],b=0===r?m:y;if(b>=i&&b<=n&&U(l,m,y,g),b>=i&&b<=n&&a){const e=t[p+3];l.push(e)}p=l.length-f,o&&p>=f&&(l[p]!==l[0]||l[p+1]!==l[1])&&(U(l,l[0],l[1],l[2]),a&&l.push(l[3])),l.length&&e.push(l)}function L(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function D(t,e,i,n,r,o,s){for(const a of t)N(a,e,i,n,r,o,!1,s)}function U(t,e,i,n){t.push(e,i,n)}function $(t,e,i,n,r,o){const s=(o-e)/(n-e);return U(t,o,i+(r-i)*s,1),s}function W(t,e,i,n,r,o){const s=(o-i)/(r-i);return U(t,e+(n-e)*s,o,1),s}function J(t,e,i){return t+(e-t)*i}function H(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=t[r],s=o.type;let a;if("Point"===s||"MultiPoint"===s||"LineString"===s)a=V(o.geometry,e,i);else if("MultiLineString"===s||"Polygon"===s){a=[];for(const t of o.geometry)a.push(V(t,e,i))}else if("MultiPolygon"===s){a=[];for(const t of o.geometry){const n=[];for(const r of t)n.push(V(r,e,i));a.push(n)}}n.push(T(o.id,s,a,o.tags,o.layer,i))}return n}function V(t,e,i){const n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);const r=i?4:3;for(let o=0;o<t.length;o+=r)n.push(t[o]+e,t[o+1],t[o+2]),i&&n.push(t[o+3]);return n}function G(t,e,i){if(t.transformed)return t;const n=1<<t.z,r=t.x,o=t.y,s=i?3:2;for(const a of t.features){const t=a.geometry,l=a.type;if(a.geometry=[],1===l)for(let l=0;l<t.length;l+=s)a.geometry.push(B(t[l],t[l+1],e,n,r,o)),i&&a.geometry[a.geometry.length-1].push(t[l+2]);else for(let l=0;l<t.length;l++){const u=[];for(let a=0;a<t[l].length;a+=s)u.push(B(t[l][a],t[l][a+1],e,n,r,o)),i&&u[u.length-1].push(t[l][a+2]);a.geometry.push(u)}}return t.transformed=!0,t}function B(t,e,i,n,r,o){return[Math.round(i*(t*n-r)),Math.round(i*(e*n-o))]}function X(t,e,i,n,r){const o=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:i,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const e of t)Z(s,e,o,r);return s}function Z(t,e,i,n){const r=e.geometry,o=e.type,s=[],a=n.hasAltitude?4:3;if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===o||"MultiPoint"===o)for(let e=0;e<r.length;e+=a)s.push(r[e],r[e+1]),n.hasAltitude&&s.push(r[e+3]),t.numPoints++,t.numSimplified++;else if("LineString"===o)Y(s,r,t,i,!1,!1,n);else if("MultiLineString"===o||"Polygon"===o)for(let e=0;e<r.length;e++)Y(s,r[e],t,i,"Polygon"===o,0===e,n);else if("MultiPolygon"===o)for(let e=0;e<r.length;e++){const o=r[e];for(let e=0;e<o.length;e++)Y(s,o[e],t,i,!0,0===e,n)}if(s.length){let i=e.tags||null;if("LineString"===o&&n.lineMetrics){i={};for(const t in e.tags)i[t]=e.tags[t];i.mapbox_clip_start=r.start/r.size,i.mapbox_clip_end=r.end/r.size}const a={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:i};e.layer&&(a.layer=e.layer),null!==e.id&&(a.id=e.id),t.features.push(a)}}function Y(t,e,i,n,r,o,s){const a=n*n,{hasAltitude:l,disableFilter:u}=s,c=l?4:3;if(!u&&n>0&&e.size<(r?a:n))return void(i.numPoints+=e.length/c);const h=[];for(let t=0;t<e.length;t+=c)(0===n||e[t+2]>a)&&(i.numSimplified++,h.push(e[t],e[t+1]),l&&h.push(e[t+3])),i.numPoints++;r&&function(t,e,i){const n=i?3:2;let r=0;for(let e=0,i=t.length,o=i-n;e<i;o=e,e+=n)r+=(t[e]-t[o])*(t[e+1]+t[o+1]);if(r>0===e){const e=n,r=n-1,o=n-2;for(let s=0,a=t.length;s<a/2;s+=n){const n=t[s],l=t[s+1];let u;i&&(u=t[s+2]),t[s]=t[a-e-s],t[s+1]=t[a-r-s],i&&(t[s+2]=t[a-o-s]),t[a-e-s]=n,t[a-r-s]=l,i&&(t[a-o-s]=u)}}}(h,o,l),t.push(h)}A.getJSON=function(t,e,i){if(y(e)){const t=i;i=e,e=t}const n=function(t,e){const n="string"==typeof e?JSON.parse(e):e||null;i(t,n)};return e&&e.jsonp?A.jsonp(t,n):((e=e||{}).returnJSON=!0,A.get(t,e,n))};const K={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,hasAltitude:!1,disableFilter:!1,debug:0};class Q{constructor(t,e){const i=(e=this.options=function(t,e){for(const i in e)t[i]=e[i];return t}(Object.create(K),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let n=function(t,e){const i=[];if(Array.isArray(t)){for(let n=0;n<t.length;n++)S(i,t[n].layer,t[n].data,e);return i}if("FeatureCollection"===t.type)for(let n=0;n<t.features.length;n++)_(i,t.features[n],e,n);else"Feature"===t.type?_(i,t,e):_(i,{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(t,e){const i=e.buffer/e.extent;let n=t;const r=R(t,1,-1-i,i,0,-1,2,e),o=R(t,1,1-i,2+i,0,-1,2,e);return(r||o)&&(n=R(t,1,-i,1+i,0,-1,2,e)||[],r&&(n=H(r,1,e.hasAltitude).concat(n)),o&&(n=n.concat(H(o,-1,e.hasAltitude)))),n}(n,e),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,e,i,n,r,o,s){const a=[t,e,i,n],l=this.options,u=l.debug;for(;a.length;){n=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();const c=1<<e,h=tt(e,i,n);let d=this.tiles[h];if(!d&&(u>1&&console.time("creation"),d=this.tiles[h]=X(t,e,i,n,l),this.tileCoords.push({z:e,x:i,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const t="z"+e;this.stats[t]=(this.stats[t]||0)+1,this.total++}if(d.source=t,null==r){if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(e===l.maxZoom||e===r)continue;if(null!=r){const t=r-e;if(i!==o>>t||n!==s>>t)continue}}if(d.source=null,0===t.length)continue;u>1&&console.time("clipping");const f=.5*l.buffer/l.extent,p=.5-f,m=.5+f,y=1+f;let g=null,b=null,v=null,w=null,x=R(t,c,i-f,i+m,0,d.minX,d.maxX,l),k=R(t,c,i+p,i+y,0,d.minX,d.maxX,l);t=null,x&&(g=R(x,c,n-f,n+m,1,d.minY,d.maxY,l),b=R(x,c,n+p,n+y,1,d.minY,d.maxY,l),x=null),k&&(v=R(k,c,n-f,n+m,1,d.minY,d.maxY,l),w=R(k,c,n+p,n+y,1,d.minY,d.maxY,l),k=null),u>1&&console.timeEnd("clipping"),a.push(g||[],e+1,2*i,2*n),a.push(b||[],e+1,2*i,2*n+1),a.push(v||[],e+1,2*i+1,2*n),a.push(w||[],e+1,2*i+1,2*n+1)}}getTile(t,e,i){t=+t,e=+e,i=+i;const n=this.options,{extent:r,debug:o}=n,{hasAltitude:s}=n;if(t<0||t>24)return null;const a=1<<t,l=tt(t,e=e+a&a-1,i);if(this.tiles[l])return G(this.tiles[l],r,s);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);let u,c=t,h=e,d=i;for(;!u&&c>0;)c--,h>>=1,d>>=1,u=this.tiles[tt(c,h,d)];return u&&u.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,h,d),console.time("drilling down")),this.splitTile(u.source,c,h,d,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[l]?G(this.tiles[l],r,s):null):null}}function tt(t,e,i){return 32*((1<<t)*i+e)+t}function et(t,e,i,n,r,o){const s=i&&Array.isArray(i[0]);for(let a=0,l=i.length;a<l;a++){t[e]=Math.round((s?i[a][0]:i[a].x)*n),t[e+1]=Math.round((s?i[a][1]:i[a].y)*n);let u=r||0;Array.isArray(r)&&(u=r[a]),u=u?Math.round(n*u):0,t[e+2]=u,e+=3,o&&0!==a&&a!==l-1&&(t[e]=t[e-3],t[e+1]=t[e-2],t[e+2]=t[e-1],e+=3)}return e}function it(t,e,i,n){const r=t[3*e],o=t[3*e+1],s=t[3*i],a=t[3*i+1];return r===s&&(r<0||r>n)||o===a&&(o<0||o>n)}class nt{constructor(t,e){this.x=t,this.y=e}clone(){return new nt(this.x,this.y)}normalize(){const t=this.length();this.x/=t,this.y/=t}negate(){this.x=-this.x,this.y=-this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}diff(t){return new nt(this.x-t.x,this.y-t.y)}distance(t){const e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}orthogonal(){return new nt(this.y,-this.x)}}function rt(t,e,i){const n=(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x);return n>1e-5?1:n<-1e-5?2:0}function ot(t,e,i,n){const r=e.x*n.y-e.y*n.x,o=i.x-t.x,s=i.y-t.y,a=(o*n.y-s*n.x)/r;return new nt(t.x+a*e.x,t.y+a*e.y)}const st=[];function at(t,e,i){let n=0;const r=[];for(let o=e;o<i;o+=3)st[n]?(st[n].x=t[o],st[n].y=t[o+1]):st[n]=new nt(t[o],t[o+1]),r.push(st[n]),n++;const o=function(t){let e;this.UpdateOmbb=function(t,i,n,r,o,s,a,l){const u=ot(t,i,o,s),c=ot(n,r,o,s),h=ot(a,l,t,i),d=ot(a,l,n,r),f=u.distance(c)*u.distance(h);f<this.BestObbArea&&(e=[u,h,d,c],this.BestObbArea=f)},this.BestObbArea=Number.MAX_VALUE;const i=[];for(let e=0;e<t.length;e++)i.push(t[(e+1)%t.length].diff(t[e])),i[e].normalize();const n=new nt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new nt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);let o,s,a,l;for(let e=0;e<t.length;e++){const i=t[e];i.x<n.x&&(n.x=i.x,o=e),i.x>r.x&&(r.x=i.x,s=e),i.y<n.y&&(n.y=i.y,l=e),i.y>r.y&&(r.y=i.y,a=e)}let u=new nt(0,-1),c=new nt(0,1),h=new nt(-1,0),d=new nt(1,0);for(let e=0;e<t.length;e++){const e=[Math.acos(u.dot(i[o])),Math.acos(c.dot(i[s])),Math.acos(h.dot(i[a])),Math.acos(d.dot(i[l]))];switch(e.indexOf(Math.min.apply(Math,e))){case 0:u=i[o].clone(),c=u.clone(),c.negate(),h=u.orthogonal(),d=h.clone(),d.negate(),o=(o+1)%t.length;break;case 1:c=i[s].clone(),u=c.clone(),u.negate(),h=u.orthogonal(),d=h.clone(),d.negate(),s=(s+1)%t.length;break;case 2:h=i[a].clone(),d=h.clone(),d.negate(),u=d.orthogonal(),c=u.clone(),c.negate(),a=(a+1)%t.length;break;case 3:d=i[l].clone(),h=d.clone(),h.negate(),u=d.orthogonal(),c=u.clone(),c.negate(),l=(l+1)%t.length}this.UpdateOmbb(t[o],u,t[s],c,t[a],h,t[l],d)}return e}(function(t){if(t.length<3)return t;let e=t[0];const i=[];for(let i=1;i<t.length;i++)(t[i].x<e.x||Math.abs(t[i].x-e.x)<1e-5&&t[i].y<e.y)&&(e=t[i]);let n=t[0];do{i.unshift(e.clone());for(let i=1;i<t.length;i++){const r=rt(e,n,t[i]);(n.equals(e)||1===r||0===r&&e.distance(t[i])>e.distance(n))&&(n=t[i])}e=n}while(!n.equals(i[i.length-1]));return i}(r)),s=o[0].distance(o[1]),a=o[1].distance(o[2]),l=o.map(t=>[t.x,t.y]);return l.push(+(a>s)),l}var lt="undefined"!=typeof Float32Array?Float32Array:Array;function ut(){var t=new lt(3);return lt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ct(t,e,i){var n=new lt(3);return n[0]=t,n[1]=e,n[2]=i,n}function ht(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function dt(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t}function ft(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function pt(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function mt(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function yt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function gt(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=r*l-o*a,t[1]=o*s-n*l,t[2]=n*a-r*s,t}var bt=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t};function vt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function wt(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t}function xt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function kt(){var t=new lt(4);return lt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Mt(t,e){var i=e[0]+e[4]+e[8],n=void 0;if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;n=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*s+s]+1),t[r]=.5*n,n=.5/n,t[3]=(e[3*o+s]-e[3*s+o])*n,t[o]=(e[3*o+r]+e[3*r+o])*n,t[s]=(e[3*s+r]+e[3*r+s])*n}return t}ut(),function(){var t,e=(t=new lt(4),lt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var jt,At=xt,Ft=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*i+n*n+r*r+o*o;return s>0&&(s=1/Math.sqrt(s),t[0]=i*s,t[1]=n*s,t[2]=r*s,t[3]=o*s),t};function Tt(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)}ut(),ct(1,0,0),ct(0,1,0),kt(),kt(),jt=new lt(9),lt!=Float32Array&&(jt[1]=0,jt[2]=0,jt[3]=0,jt[5]=0,jt[6]=0,jt[7]=0),jt[0]=1,jt[4]=1,jt[8]=1;var zt=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)};function St(t,e,i,n,r,o,s,a,l,u){0===t?function(t,e,i,n,r,o,s,a,l){const u=[0,0];for(let r=t;r<e;r+=3){const t=r/3*2,e=n[r],c=n[r+1];i[t]=u[0]+e*o*s/a,i[t+1]=u[1]-c*o*s/l}}(e,i,n,r,0,s,a,l,u):1===t&&function(t,e,i,n){const r=at(n,t,e),o=r[4],s=r[o],a=r[o+1],l=r[o+2],u=(a[1]-s[1])/(a[0]-s[0]),c=(l[1]-a[1])/(l[0]-a[0]),h=Tt(s,a),d=Tt(a,l);for(let r=t;r<e;r+=3){const t=r/3*2,e=n[r],o=n[r+1];i[t]=Pt(e,o,s,u,h),i[t+1]=-Pt(e,o,a,c,d)}}(e,i,n,r)}!function(){var t=function(){var t=new lt(2);return lt!=Float32Array&&(t[0]=0,t[1]=0),t}()}();const _t=[];function Pt(t,e,i,n,r){return _t[0]=(n*n*i[0]+n*(e-i[1])+t)/(n*n+1),_t[1]=n*(_t[0]-i[0])+i[1],Tt(i,_t)/r}function It(t,e,i,n,r){const o=3*e[i-1],s=3*e[i-1]+1,a=t[o],l=t[s];return u=n,c=r,h=a,d=l,Math.sqrt((h-u)*(h-u)+(d-c)*(d-c));var u,c,h,d}"undefined"!=typeof undefinedThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof undefined?global:"undefined"!=typeof self&&self;var Ot=Et;function Et(t,e){this.x=t,this.y=e}function qt(t,e,i){i=i||{},this.w=t||64,this.h=e||64,this.autoResize=!!i.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function Rt(t,e,i){this.x=0,this.y=t,this.w=this.free=e,this.h=i}function Ct(t,e,i,n,r,o,s){this.id=t,this.x=e,this.y=i,this.w=n,this.h=r,this.maxw=o||n,this.maxh=s||r,this.refcount=0}Et.prototype={clone:function(){return new Et(this.x,this.y)},add:function(t){return this.clone().u(t)},sub:function(t){return this.clone().m(t)},multByPoint:function(t){return this.clone().v(t)},divByPoint:function(t){return this.clone().k(t)},mult:function(t){return this.clone().M(t)},div:function(t){return this.clone().j(t)},rotate:function(t){return this.clone().A(t)},rotateAround:function(t,e){return this.clone().F(t,e)},matMult:function(t){return this.clone().T(t)},unit:function(){return this.clone().S()},perp:function(){return this.clone()._()},round:function(){return this.clone().P()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},T:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},u:function(t){return this.x+=t.x,this.y+=t.y,this},m:function(t){return this.x-=t.x,this.y-=t.y,this},M:function(t){return this.x*=t,this.y*=t,this},j:function(t){return this.x/=t,this.y/=t,this},v:function(t){return this.x*=t.x,this.y*=t.y,this},k:function(t){return this.x/=t.x,this.y/=t.y,this},S:function(){return this.j(this.mag()),this},_:function(){var t=this.y;return this.y=this.x,this.x=-t,this},A:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,r=i*this.x+e*this.y;return this.x=n,this.y=r,this},F:function(t,e){var i=Math.cos(t),n=Math.sin(t),r=e.x+i*(this.x-e.x)-n*(this.y-e.y),o=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=r,this.y=o,this},P:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Et.convert=function(t){return t instanceof Et?t:Array.isArray(t)?new Et(t[0],t[1]):t},qt.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var i,n,r,o,s=[],a=0;a<t.length;a++)if(i=t[a].w||t[a].width,n=t[a].h||t[a].height,r=t[a].id,i&&n){if(!(o=this.packOne(i,n,r)))continue;e.inPlace&&(t[a].x=o.x,t[a].y=o.y,t[a].id=o.id),s.push(o)}return this.shrink(),s},qt.prototype.packOne=function(t,e,i){var n,r,o,s,a,l,u,c,h={freebin:-1,shelf:-1,waste:1/0},d=0;if("string"==typeof i||"number"==typeof i){if(n=this.getBin(i))return this.ref(n),n;"number"==typeof i&&(this.maxId=Math.max(i,this.maxId))}else i=++this.maxId;for(s=0;s<this.freebins.length;s++){if(e===(n=this.freebins[s]).maxh&&t===n.maxw)return this.allocFreebin(s,t,e,i);e>n.maxh||t>n.maxw||e<=n.maxh&&t<=n.maxw&&(o=n.maxw*n.maxh-t*e)<h.waste&&(h.waste=o,h.freebin=s)}for(s=0;s<this.shelves.length;s++)if(d+=(r=this.shelves[s]).h,!(t>r.free)){if(e===r.h)return this.allocShelf(s,t,e,i);e>r.h||e<r.h&&(o=(r.h-e)*t)<h.waste&&(h.freebin=-1,h.waste=o,h.shelf=s)}return-1!==h.freebin?this.allocFreebin(h.freebin,t,e,i):-1!==h.shelf?this.allocShelf(h.shelf,t,e,i):e<=this.h-d&&t<=this.w?(r=new Rt(d,this.w,e),this.allocShelf(this.shelves.push(r)-1,t,e,i)):this.autoResize?(a=l=this.h,((u=c=this.w)<=a||t>u)&&(c=2*Math.max(t,u)),(a<u||e>a)&&(l=2*Math.max(e,a)),this.resize(c,l),this.packOne(t,e,i)):null},qt.prototype.allocFreebin=function(t,e,i,n){var r=this.freebins.splice(t,1)[0];return r.id=n,r.w=e,r.h=i,r.refcount=0,this.bins[n]=r,this.ref(r),r},qt.prototype.allocShelf=function(t,e,i,n){var r=this.shelves[t].alloc(e,i,n);return this.bins[n]=r,this.ref(r),r},qt.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,i=0;i<this.shelves.length;i++){var n=this.shelves[i];e+=n.h,t=Math.max(n.w-n.free,t)}this.resize(t,e)}},qt.prototype.getBin=function(t){return this.bins[t]},qt.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},qt.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},qt.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},qt.prototype.resize=function(t,e){this.w=t,this.h=e;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(t);return!0},Rt.prototype.alloc=function(t,e,i){if(t>this.free||e>this.h)return null;var n=this.x;return this.x+=t,this.free-=t,new Ct(i,n,this.y,t,e,t,this.h)},Rt.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};var Nt={exports:{}},Lt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Dt={exports:{}},Ut=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},$t=Array.prototype.concat,Wt=Array.prototype.slice,Jt=Dt.exports=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];Ut(r)?e=$t.call(e,Wt.call(r)):e.push(r)}return e};Jt.wrap=function(t){return function(){return t(Jt(arguments))}};var Ht=Lt,Vt=Dt.exports,Gt=Object.hasOwnProperty,Bt={};for(var Xt in Ht)Gt.call(Ht,Xt)&&(Bt[Ht[Xt]]=Xt);var Zt=Nt.exports={to:{},get:{}};function Yt(t,e,i){return Math.min(Math.max(e,t),i)}function Kt(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}Zt.get=function(t){var e,i;switch(t.substring(0,3).toLowerCase()){case"hsl":e=Zt.get.hsl(t),i="hsl";break;case"hwb":e=Zt.get.hwb(t),i="hwb";break;default:e=Zt.get.rgb(t),i="rgb"}return e?{model:i,value:e}:null},Zt.get.rgb=function(t){if(!t)return null;var e,i,n,r=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(n=e[2],e=e[1],i=0;i<3;i++){var o=2*i;r[i]=parseInt(e.slice(o,o+2),16)}n&&(r[3]=parseInt(n,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(n=(e=e[1])[3],i=0;i<3;i++)r[i]=parseInt(e[i]+e[i],16);n&&(r[3]=parseInt(n+n,16)/255)}else if(e=t.match(/^rgba?\\(\\s*([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)){for(i=0;i<3;i++)r[i]=parseInt(e[i+1],0);e[4]&&(e[5]?r[3]=.01*parseFloat(e[4]):r[3]=parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)))return(e=t.match(/^(\\w+)$/))?"transparent"===e[1]?[0,0,0,0]:Gt.call(Ht,e[1])?((r=Ht[e[1]])[3]=1,r):null:null;for(i=0;i<3;i++)r[i]=Math.round(2.55*parseFloat(e[i+1]));e[4]&&(e[5]?r[3]=.01*parseFloat(e[4]):r[3]=parseFloat(e[4]))}for(i=0;i<3;i++)r[i]=Yt(r[i],0,255);return r[3]=Yt(r[3],0,1),r},Zt.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\\(\\s*([+-]?(?:\\d{0,3}\\.)?\\d+)(?:deg)?\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*(?:[,|\\/]\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(e){var i=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,Yt(parseFloat(e[2]),0,100),Yt(parseFloat(e[3]),0,100),Yt(isNaN(i)?1:i,0,1)]}return null},Zt.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\\(\\s*([+-]?\\d{0,3}(?:\\.\\d+)?)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(e){var i=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,Yt(parseFloat(e[2]),0,100),Yt(parseFloat(e[3]),0,100),Yt(isNaN(i)?1:i,0,1)]}return null},Zt.to.hex=function(){var t=Vt(arguments);return"#"+Kt(t[0])+Kt(t[1])+Kt(t[2])+(t[3]<1?Kt(Math.round(255*t[3])):"")},Zt.to.rgb=function(){var t=Vt(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},Zt.to.rgb.percent=function(){var t=Vt(arguments),e=Math.round(t[0]/255*100),i=Math.round(t[1]/255*100),n=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+i+"%, "+n+"%)":"rgba("+e+"%, "+i+"%, "+n+"%, "+t[3]+")"},Zt.to.hsl=function(){var t=Vt(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},Zt.to.hwb=function(){var t=Vt(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},Zt.to.keyword=function(t){return Bt[t.slice(0,3)]};var Qt={exports:{}},te=Lt,ee={};for(var ie in te)te.hasOwnProperty(ie)&&(ee[te[ie]]=ie);var ne=Qt.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var re in ne)if(ne.hasOwnProperty(re)){if(!("channels"in ne[re]))throw new Error("missing channels property: "+re);if(!("labels"in ne[re]))throw new Error("missing channel labels property: "+re);if(ne[re].labels.length!==ne[re].channels)throw new Error("channel and label counts mismatch: "+re);var oe=ne[re].channels,se=ne[re].labels;delete ne[re].channels,delete ne[re].labels,Object.defineProperty(ne[re],"channels",{value:oe}),Object.defineProperty(ne[re],"labels",{value:se})}function ae(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}ne.rgb.hsl=function(t){var e,i,n=t[0]/255,r=t[1]/255,o=t[2]/255,s=Math.min(n,r,o),a=Math.max(n,r,o),l=a-s;return a===s?e=0:n===a?e=(r-o)/l:r===a?e=2+(o-n)/l:o===a&&(e=4+(n-r)/l),(e=Math.min(60*e,360))<0&&(e+=360),i=(s+a)/2,[e,100*(a===s?0:i<=.5?l/(a+s):l/(2-a-s)),100*i]},ne.rgb.hsv=function(t){var e,i,n,r,o,s=t[0]/255,a=t[1]/255,l=t[2]/255,u=Math.max(s,a,l),c=u-Math.min(s,a,l),h=function(t){return(u-t)/6/c+.5};return 0===c?r=o=0:(o=c/u,e=h(s),i=h(a),n=h(l),s===u?r=n-i:a===u?r=1/3+e-n:l===u&&(r=2/3+i-e),r<0?r+=1:r>1&&(r-=1)),[360*r,100*o,100*u]},ne.rgb.hwb=function(t){var e=t[0],i=t[1],n=t[2];return[ne.rgb.hsl(t)[0],100*(1/255*Math.min(e,Math.min(i,n))),100*(n=1-1/255*Math.max(e,Math.max(i,n)))]},ne.rgb.cmyk=function(t){var e,i=t[0]/255,n=t[1]/255,r=t[2]/255;return[100*((1-i-(e=Math.min(1-i,1-n,1-r)))/(1-e)||0),100*((1-n-e)/(1-e)||0),100*((1-r-e)/(1-e)||0),100*e]},ne.rgb.keyword=function(t){var e=ee[t];if(e)return e;var i,n=1/0;for(var r in te)if(te.hasOwnProperty(r)){var o=ae(t,te[r]);o<n&&(n=o,i=r)}return i},ne.keyword.rgb=function(t){return te[t]},ne.rgb.xyz=function(t){var e=t[0]/255,i=t[1]/255,n=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.1805*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)),100*(.2126*e+.7152*i+.0722*n),100*(.0193*e+.1192*i+.9505*n)]},ne.rgb.lab=function(t){var e=ne.rgb.xyz(t),i=e[0],n=e[1],r=e[2];return n/=100,r/=108.883,i=(i/=95.047)>.008856?Math.pow(i,1/3):7.787*i+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(i-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},ne.hsl.rgb=function(t){var e,i,n,r,o,s=t[0]/360,a=t[1]/100,l=t[2]/100;if(0===a)return[o=255*l,o,o];e=2*l-(i=l<.5?l*(1+a):l+a-l*a),r=[0,0,0];for(var u=0;u<3;u++)(n=s+1/3*-(u-1))<0&&n++,n>1&&n--,o=6*n<1?e+6*(i-e)*n:2*n<1?i:3*n<2?e+(i-e)*(2/3-n)*6:e,r[u]=255*o;return r},ne.hsl.hsv=function(t){var e=t[0],i=t[1]/100,n=t[2]/100,r=i,o=Math.max(n,.01);return i*=(n*=2)<=1?n:2-n,r*=o<=1?o:2-o,[e,100*(0===n?2*r/(o+r):2*i/(n+i)),100*((n+i)/2)]},ne.hsv.rgb=function(t){var e=t[0]/60,i=t[1]/100,n=t[2]/100,r=Math.floor(e)%6,o=e-Math.floor(e),s=255*n*(1-i),a=255*n*(1-i*o),l=255*n*(1-i*(1-o));switch(n*=255,r){case 0:return[n,l,s];case 1:return[a,n,s];case 2:return[s,n,l];case 3:return[s,a,n];case 4:return[l,s,n];case 5:return[n,s,a]}},ne.hsv.hsl=function(t){var e,i,n,r=t[0],o=t[1]/100,s=t[2]/100,a=Math.max(s,.01);return n=(2-o)*s,i=o*a,[r,100*(i=(i/=(e=(2-o)*a)<=1?e:2-e)||0),100*(n/=2)]},ne.hwb.rgb=function(t){var e,i,n,r,o,s,a,l=t[0]/360,u=t[1]/100,c=t[2]/100,h=u+c;switch(h>1&&(u/=h,c/=h),n=6*l-(e=Math.floor(6*l)),0!=(1&e)&&(n=1-n),r=u+n*((i=1-c)-u),e){default:case 6:case 0:o=i,s=r,a=u;break;case 1:o=r,s=i,a=u;break;case 2:o=u,s=i,a=r;break;case 3:o=u,s=r,a=i;break;case 4:o=r,s=u,a=i;break;case 5:o=i,s=u,a=r}return[255*o,255*s,255*a]},ne.cmyk.rgb=function(t){var e=t[0]/100,i=t[1]/100,n=t[2]/100,r=t[3]/100;return[255*(1-Math.min(1,e*(1-r)+r)),255*(1-Math.min(1,i*(1-r)+r)),255*(1-Math.min(1,n*(1-r)+r))]},ne.xyz.rgb=function(t){var e,i,n,r=t[0]/100,o=t[1]/100,s=t[2]/100;return i=-.9689*r+1.8758*o+.0415*s,n=.0557*r+-.204*o+1.057*s,e=(e=3.2406*r+-1.5372*o+-.4986*s)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,[255*(e=Math.min(Math.max(0,e),1)),255*(i=Math.min(Math.max(0,i),1)),255*(n=Math.min(Math.max(0,n),1))]},ne.xyz.lab=function(t){var e=t[0],i=t[1],n=t[2];return i/=100,n/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(e-i),200*(i-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]},ne.lab.xyz=function(t){var e,i,n,r=t[0];e=t[1]/500+(i=(r+16)/116),n=i-t[2]/200;var o=Math.pow(i,3),s=Math.pow(e,3),a=Math.pow(n,3);return i=o>.008856?o:(i-16/116)/7.787,e=s>.008856?s:(e-16/116)/7.787,n=a>.008856?a:(n-16/116)/7.787,[e*=95.047,i*=100,n*=108.883]},ne.lab.lch=function(t){var e,i=t[0],n=t[1],r=t[2];return(e=360*Math.atan2(r,n)/2/Math.PI)<0&&(e+=360),[i,Math.sqrt(n*n+r*r),e]},ne.lch.lab=function(t){var e,i=t[0],n=t[1];return e=t[2]/360*2*Math.PI,[i,n*Math.cos(e),n*Math.sin(e)]},ne.rgb.ansi16=function(t){var e=t[0],i=t[1],n=t[2],r=1 in arguments?arguments[1]:ne.rgb.hsv(t)[2];if(0===(r=Math.round(r/50)))return 30;var o=30+(Math.round(n/255)<<2|Math.round(i/255)<<1|Math.round(e/255));return 2===r&&(o+=60),o},ne.hsv.ansi16=function(t){return ne.rgb.ansi16(ne.hsv.rgb(t),t[2])},ne.rgb.ansi256=function(t){var e=t[0],i=t[1],n=t[2];return e===i&&i===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(i/255*5)+Math.round(n/255*5)},ne.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var i=.5*(1+~~(t>50));return[(1&e)*i*255,(e>>1&1)*i*255,(e>>2&1)*i*255]},ne.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var i;return t-=16,[Math.floor(t/36)/5*255,Math.floor((i=t%36)/6)/5*255,i%6/5*255]},ne.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},ne.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var i=e[0];3===e[0].length&&(i=i.split("").map((function(t){return t+t})).join(""));var n=parseInt(i,16);return[n>>16&255,n>>8&255,255&n]},ne.rgb.hcg=function(t){var e,i=t[0]/255,n=t[1]/255,r=t[2]/255,o=Math.max(Math.max(i,n),r),s=Math.min(Math.min(i,n),r),a=o-s;return e=a<=0?0:o===i?(n-r)/a%6:o===n?2+(r-i)/a:4+(i-n)/a+4,e/=6,[360*(e%=1),100*a,100*(a<1?s/(1-a):0)]},ne.hsl.hcg=function(t){var e=t[1]/100,i=t[2]/100,n=1,r=0;return(n=i<.5?2*e*i:2*e*(1-i))<1&&(r=(i-.5*n)/(1-n)),[t[0],100*n,100*r]},ne.hsv.hcg=function(t){var e=t[1]/100,i=t[2]/100,n=e*i,r=0;return n<1&&(r=(i-n)/(1-n)),[t[0],100*n,100*r]},ne.hcg.rgb=function(t){var e=t[0]/360,i=t[1]/100,n=t[2]/100;if(0===i)return[255*n,255*n,255*n];var r,o=[0,0,0],s=e%1*6,a=s%1,l=1-a;switch(Math.floor(s)){case 0:o[0]=1,o[1]=a,o[2]=0;break;case 1:o[0]=l,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=a;break;case 3:o[0]=0,o[1]=l,o[2]=1;break;case 4:o[0]=a,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=l}return r=(1-i)*n,[255*(i*o[0]+r),255*(i*o[1]+r),255*(i*o[2]+r)]},ne.hcg.hsv=function(t){var e=t[1]/100,i=e+t[2]/100*(1-e),n=0;return i>0&&(n=e/i),[t[0],100*n,100*i]},ne.hcg.hsl=function(t){var e=t[1]/100,i=t[2]/100*(1-e)+.5*e,n=0;return i>0&&i<.5?n=e/(2*i):i>=.5&&i<1&&(n=e/(2*(1-i))),[t[0],100*n,100*i]},ne.hcg.hwb=function(t){var e=t[1]/100,i=e+t[2]/100*(1-e);return[t[0],100*(i-e),100*(1-i)]},ne.hwb.hcg=function(t){var e=t[1]/100,i=1-t[2]/100,n=i-e,r=0;return n<1&&(r=(i-n)/(1-n)),[t[0],100*n,100*r]},ne.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},ne.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},ne.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},ne.gray.hsl=ne.gray.hsv=function(t){return[0,0,t[0]]},ne.gray.hwb=function(t){return[0,100,t[0]]},ne.gray.cmyk=function(t){return[0,0,0,t[0]]},ne.gray.lab=function(t){return[t[0],0,0]},ne.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),i=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(i.length)+i},ne.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var le=Qt.exports;function ue(t){var e=function(){for(var t={},e=Object.keys(le),i=e.length,n=0;n<i;n++)t[e[n]]={distance:-1,parent:null};return t}(),i=[t];for(e[t].distance=0;i.length;)for(var n=i.pop(),r=Object.keys(le[n]),o=r.length,s=0;s<o;s++){var a=r[s],l=e[a];-1===l.distance&&(l.distance=e[n].distance+1,l.parent=n,i.unshift(a))}return e}function ce(t,e){return function(i){return e(t(i))}}function he(t,e){for(var i=[e[t].parent,t],n=le[e[t].parent][t],r=e[t].parent;e[r].parent;)i.unshift(e[r].parent),n=ce(le[e[r].parent][r],n),r=e[r].parent;return n.conversion=i,n}var de=Qt.exports,fe=function(t){for(var e=ue(t),i={},n=Object.keys(e),r=n.length,o=0;o<r;o++){var s=n[o];null!==e[s].parent&&(i[s]=he(s,e))}return i},pe={};Object.keys(de).forEach((function(t){pe[t]={},Object.defineProperty(pe[t],"channels",{value:de[t].channels}),Object.defineProperty(pe[t],"labels",{value:de[t].labels});var e=fe(t);Object.keys(e).forEach((function(i){var n=e[i];pe[t][i]=function(t){var e=function(e){if(null==e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var i=t(e);if("object"==typeof i)for(var n=i.length,r=0;r<n;r++)i[r]=Math.round(i[r]);return i};return"conversion"in t&&(e.conversion=t.conversion),e}(n),pe[t][i].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(n)}))}));var me=pe,ye=Nt.exports,ge=me,be=[].slice,ve=["keyword","gray","hex"],we={};Object.keys(ge).forEach((function(t){we[be.call(ge[t].labels).sort().join("")]=t}));var xe={};function ke(t,e){if(!(this instanceof ke))return new ke(t,e);if(e&&e in ve&&(e=null),e&&!(e in ge))throw new Error("Unknown model: "+e);var i,n;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof ke)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var r=ye.get(t);if(null===r)throw new Error("Unable to parse color from string: "+t);this.model=r.model,n=ge[this.model].channels,this.color=r.value.slice(0,n),this.valpha="number"==typeof r.value[n]?r.value[n]:1}else if(t.length){this.model=e||"rgb",n=ge[this.model].channels;var o=be.call(t,0,n);this.color=Fe(o,n),this.valpha="number"==typeof t[n]?t[n]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var s=Object.keys(t);"alpha"in t&&(s.splice(s.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=s.sort().join("");if(!(a in we))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=we[a];var l=ge[this.model].labels,u=[];for(i=0;i<l.length;i++)u.push(t[l[i]]);this.color=Fe(u)}if(xe[this.model])for(n=ge[this.model].channels,i=0;i<n;i++){var c=xe[this.model][i];c&&(this.color[i]=c(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function Me(t,e,i){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(xe[t]||(xe[t]=[]))[e]=i})),t=t[0],function(n){var r;return arguments.length?(i&&(n=i(n)),(r=this[t]()).color[e]=n,r):(r=this[t]().color[e],i&&(r=i(r)),r)}}function je(t){return function(e){return Math.max(0,Math.min(t,e))}}function Ae(t){return Array.isArray(t)?t:[t]}function Fe(t,e){for(var i=0;i<e;i++)"number"!=typeof t[i]&&(t[i]=0);return t}ke.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in ye.to?this:this.rgb(),i=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha);return ye.to[e.model](i)},percentString:function(t){var e=this.rgb().round("number"==typeof t?t:1),i=1===e.valpha?e.color:e.color.concat(this.valpha);return ye.to.rgb.percent(i)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=ge[this.model].channels,i=ge[this.model].labels,n=0;n<e;n++)t[i[n]]=this.color[n];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new ke(this.color.map(function(t){return function(e){return function(t,e){return Number(t.toFixed(e))}(e,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new ke(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:Me("rgb",0,je(255)),green:Me("rgb",1,je(255)),blue:Me("rgb",2,je(255)),hue:Me(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:Me("hsl",1,je(100)),lightness:Me("hsl",2,je(100)),saturationv:Me("hsv",1,je(100)),value:Me("hsv",2,je(100)),chroma:Me("hcg",1,je(100)),gray:Me("hcg",2,je(100)),white:Me("hwb",1,je(100)),wblack:Me("hwb",2,je(100)),cyan:Me("cmyk",0,je(100)),magenta:Me("cmyk",1,je(100)),yellow:Me("cmyk",2,je(100)),black:Me("cmyk",3,je(100)),x:Me("xyz",0,je(100)),y:Me("xyz",1,je(100)),z:Me("xyz",2,je(100)),l:Me("lab",0,je(100)),a:Me("lab",1),b:Me("lab",2),keyword:function(t){return arguments.length?new ke(t):ge[this.model].keyword(this.color)},hex:function(t){return arguments.length?new ke(t):ye.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],i=0;i<t.length;i++){var n=t[i]/255;e[i]=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),i=t.luminosity();return e>i?(e+.05)/(i+.05):(i+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return ke.rgb(e,e,e)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),i=e.color[0];return i=(i=(i+t)%360)<0?360+i:i,e.color[0]=i,e},mix:function(t,e){if(!t||!t.rgb)throw new Error(\'Argument to "mix" was not a Color instance, but rather an instance of \'+typeof t);var i=t.rgb(),n=this.rgb(),r=void 0===e?.5:e,o=2*r-1,s=i.alpha()-n.alpha(),a=((o*s==-1?o:(o+s)/(1+o*s))+1)/2,l=1-a;return ke.rgb(a*i.red()+l*n.red(),a*i.green()+l*n.green(),a*i.blue()+l*n.blue(),i.alpha()*r+n.alpha()*(1-r))}},Object.keys(ge).forEach((function(t){if(-1===ve.indexOf(t)){var e=ge[t].channels;ke.prototype[t]=function(){if(this.model===t)return new ke(this);if(arguments.length)return new ke(arguments,t);var i="number"==typeof arguments[e]?e:this.valpha;return new ke(Ae(ge[this.model][t].raw(this.color)).concat(i),t)},ke[t]=function(i){return"number"==typeof i&&(i=Fe(be.call(arguments),e)),new ke(i,t)}}}));var Te=ke;\n/*!\n        Feature Filter by\n\n        (c) mapbox 2016 and maptalks 2018\n        www.mapbox.com | www.maptalks.org\n        License: MIT, header required.\n    */const ze=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Se(t){return new Function("f","var p = (f && f.properties || {}); return "+_e(t))}function _e(t){if(!t)return"true";const e=t[0];if(t.length<=1)return"any"===e?"false":"true";return`(${"=="===e?Ie(t[1],t[2],"===",!1):"!="===e?Ie(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?Ie(t[1],t[2],e,!0):"any"===e?Oe(t.slice(1),"||"):"all"===e?Oe(t.slice(1),"&&"):"none"===e?Re(Oe(t.slice(1),"||")):"in"===e?Ee(t[1],t.slice(2)):"!in"===e?Re(Ee(t[1],t.slice(2))):"has"===e?qe(t[1]):"!has"===e?Re(qe(t[1])):"true"})`}function Pe(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function Ie(t,e,i,n){const r=Pe(t),o="$type"===t?ze.indexOf(e):JSON.stringify(e);return(n?`typeof ${r}=== typeof ${o}&&`:"")+r+i+o}function Oe(t,e){return t.map(_e).join(e)}function Ee(t,e){"$type"===t&&(e=e.map(t=>ze.indexOf(t)));const i=JSON.stringify(e.sort(Ce)),n=Pe(t);return e.length<=200?`${i}.indexOf(${n}) !== -1`:`function(v, a, i, j) {\\n        while (i <= j) { var m = (i + j) >> 1;\\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\\n        }\\n    return false; }(${n}, ${i},0,${e.length-1})`}function qe(t){return"$id"===t?\'"id" in f\':JSON.stringify(t)+" in p"}function Re(t){return`!(${t})`}function Ce(t,e){return t<e?-1:t>e?1:0}var Ne={exports:{}};Ne.exports=function(){function t(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function e(t,e){return t<e?-1:t>e?1:0}return function(i,n,r,o,s){!function e(i,n,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,l=n-r+1,u=Math.log(a),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(a-c)/a)*(l-a/2<0?-1:1),d=Math.max(r,Math.floor(n-l*c/a+h)),f=Math.min(o,Math.floor(n+(a-l)*c/a+h));e(i,n,d,f,s)}var p=i[n],m=r,y=o;for(t(i,r,n),s(i[o],p)>0&&t(i,r,o);m<y;){for(t(i,m,y),m++,y--;s(i[m],p)<0;)m++;for(;s(i[y],p)>0;)y--}0===s(i[r],p)?t(i,r,y):(y++,t(i,y,o)),y<=n&&(r=y+1),n<=y&&(o=y-1)}}(i,n,r||0,o||i.length-1,s||e)}}();var Le=Ne.exports,De={exports:{}};function Ue(t,e){if(!(this instanceof Ue))return new Ue(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||$e,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this.I(i)}function $e(t,e){return t<e?-1:t>e?1:0}De.exports=Ue,De.exports.default=Ue,Ue.prototype={push:function(t){this.data.push(t),this.length++,this.O(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this.I(0)),this.data.pop(),t}},peek:function(){return this.data[0]},O:function(t){for(var e=this.data,i=this.compare,n=e[t];t>0;){var r=t-1>>1,o=e[r];if(i(n,o)>=0)break;e[t]=o,t=r}e[t]=n},I:function(t){for(var e=this.data,i=this.compare,n=this.length>>1,r=e[t];t<n;){var o=1+(t<<1),s=o+1,a=e[o];if(s<this.length&&i(e[s],a)<0&&(o=s,a=e[s]),i(a,r)>=0)break;e[t]=a,t=o}e[t]=r}};var We=De.exports;class Je{constructor(t,e){this.position=t,this.index=e,this.faces=[],this.neighbors=[]}addUniqueNeighbor(t){-1===this.neighbors.indexOf(t)&&this.neighbors.push(t)}}class He{constructor(t,e,i,n){this.a=n.a,this.b=n.b,this.c=n.c,this.v1=t,this.v2=e,this.v3=i,this.normal=[],this.computeNormal(),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(i),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(i),i.faces.push(this),i.addUniqueNeighbor(t),i.addUniqueNeighbor(e)}computeNormal(){const t=this.v1.position,e=this.v2.position,i=this.v3.position,n=gt([],bt([],i,e),bt([],t,e));mt(this.normal,n)}hasVertex(t){return t===this.v1||t===this.v2||t===this.v3}}\n/*!\n     * Contains code from google filament\n     * https://github.com/google/filament/\n     * License Apache-2.0\n     */const Ve=[],Ge=[],Be=[],Xe=[];function Ze(t,e,i){const n=gt(Ge,e,i);t=Mt(t,function(t,e,i,n,r,o,s,a,l,u){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=u,t}(Ve,i[0],i[1],i[2],...n,...e));if((t=function(t){return t[3]<0?At(t,t,-1):t}(t=Ft(t,t)))[3]<1/32767){t[3]=1/32767;const e=Math.sqrt(.9999999990686206);t[0]*=e,t[1]*=e,t[2]*=e}const r=i[3]>0?gt(Be,i,e):gt(Be,e,i);return yt(gt(Xe,i,e),r)<0&&At(t,t,-1),t}function Ye(t,e){const i=[],n=[];let r=0;for(r=0;r<t.length;r+=3){const e=new Je([t[r],t[r+1],t[r+2]],r/3);i.push(e)}if(!e.length){const t=e;e=[];for(let i=0;i<t;i++)e.push(i)}for(r=0;r<e.length/3;r++){const t={a:e[3*r],b:e[3*r+1],c:e[3*r+2]};new He(i[t.a],i[t.b],i[t.c],t)}const o=[],s=[0,0,0];for(r=0;r<i.length;r++){const t=i[r],e=t.index;dt(s,0,0,0);let a=t.faces.length;for(let e=0;e<a;e++)ft(s,s,t.faces[e].normal);a=a||1,dt(o,a,a,a),pt(s,s,o),n[3*e]=s[0],n[3*e+1]=s[1],n[3*e+2]=s[2]}return n}\n/*!\n     * Contains code from THREE.JS\n     * https://github.com/mrdoob/three.js/\n     * License MIT\n     * \n     * Generate tangents per vertex.\n     */function Ke(t,e,i){return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t}function Qe(t,e,i){return t[0]=e[i],t[1]=e[i+1],t}var ti={exports:{}};function ei(t,e,i){i=i||2;var n,r,o,s,a,l,u,c=e&&e.length,h=c?e[0]*i:t.length,d=ii(t,0,h,i,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(t,e,i,n){var r,o,s,a,l,u=[];for(r=0,o=e.length;r<o;r++)s=e[r]*n,a=r<o-1?e[r+1]*n:t.length,(l=ii(t,s,a,n,!1))===l.next&&(l.steiner=!0),u.push(fi(l));for(u.sort(ui),r=0;r<u.length;r++)i=ci(u[r],i);return i}(t,e,d,i)),t.length>80*i){n=o=t[0],r=s=t[1];for(var p=i;p<h;p+=i)(a=t[p])<n&&(n=a),(l=t[p+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);u=0!==(u=Math.max(o-n,s-r))?32767/u:0}return ri(d,f,i,n,r,u,0),f}function ii(t,e,i,n,r){var o,s;if(r===Fi(t,e,i,n)>0)for(o=e;o<i;o+=n)s=Mi(o,t[o],t[o+1],s);else for(o=i-n;o>=e;o-=n)s=Mi(o,t[o],t[o+1],s);return s&&gi(s,s.next)&&(ji(s),s=s.next),s}function ni(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!gi(n,n.next)&&0!==yi(n.prev,n,n.next))n=n.next;else{if(ji(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function ri(t,e,i,n,r,o,s){if(t){!s&&o&&function(t,e,i,n){var r=t;do{0===r.z&&(r.z=di(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,o,s,a,l,u=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,n=i,a=0,e=0;e<u&&(a++,n=n.nextZ);e++);for(l=u;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,u*=2}while(s>1)}(r)}(t,n,r,o);for(var a,l,u=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?si(t,n,r,o):oi(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),ji(t),t=l.next,u=l.next;else if((t=l)===u){s?1===s?ri(t=ai(ni(t),e,i),e,i,n,r,o,2):2===s&&li(t,e,i,n,r,o):ri(ni(t),e,i,n,r,o,1);break}}}function oi(t){var e=t.prev,i=t,n=t.next;if(yi(e,i,n)>=0)return!1;for(var r=e.x,o=i.x,s=n.x,a=e.y,l=i.y,u=n.y,c=r<o?r<s?r:s:o<s?o:s,h=a<l?a<u?a:u:l<u?l:u,d=r>o?r>s?r:s:o>s?o:s,f=a>l?a>u?a:u:l>u?l:u,p=n.next;p!==e;){if(p.x>=c&&p.x<=d&&p.y>=h&&p.y<=f&&pi(r,a,o,l,s,u,p.x,p.y)&&yi(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function si(t,e,i,n){var r=t.prev,o=t,s=t.next;if(yi(r,o,s)>=0)return!1;for(var a=r.x,l=o.x,u=s.x,c=r.y,h=o.y,d=s.y,f=a<l?a<u?a:u:l<u?l:u,p=c<h?c<d?c:d:h<d?h:d,m=a>l?a>u?a:u:l>u?l:u,y=c>h?c>d?c:d:h>d?h:d,g=di(f,p,e,i,n),b=di(m,y,e,i,n),v=t.prevZ,w=t.nextZ;v&&v.z>=g&&w&&w.z<=b;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=y&&v!==r&&v!==s&&pi(a,c,l,h,u,d,v.x,v.y)&&yi(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,w.x>=f&&w.x<=m&&w.y>=p&&w.y<=y&&w!==r&&w!==s&&pi(a,c,l,h,u,d,w.x,w.y)&&yi(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;v&&v.z>=g;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=y&&v!==r&&v!==s&&pi(a,c,l,h,u,d,v.x,v.y)&&yi(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;w&&w.z<=b;){if(w.x>=f&&w.x<=m&&w.y>=p&&w.y<=y&&w!==r&&w!==s&&pi(a,c,l,h,u,d,w.x,w.y)&&yi(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function ai(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!gi(r,o)&&bi(r,n,n.next,o)&&xi(r,o)&&xi(o,r)&&(e.push(r.i/i|0),e.push(n.i/i|0),e.push(o.i/i|0),ji(n),ji(n.next),n=t=o),n=n.next}while(n!==t);return ni(n)}function li(t,e,i,n,r,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&mi(s,a)){var l=ki(s,a);return s=ni(s,s.next),l=ni(l,l.next),ri(s,e,i,n,r,o,0),void ri(l,e,i,n,r,o,0)}a=a.next}s=s.next}while(s!==t)}function ui(t,e){return t.x-e.x}function ci(t,e){var i=function(t,e){var i,n=e,r=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,i=n.x<n.next.x?n:n.next,a===r))return i}n=n.next}while(n!==e);if(!i)return null;var l,u=i,c=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=c&&r!==n.x&&pi(o<h?r:s,o,c,h,o<h?s:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),xi(n,t)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&hi(i,n)))&&(i=n,d=l)),n=n.next}while(n!==u);return i}(t,e);if(!i)return e;var n=ki(i,t);return ni(n,n.next),ni(i,i.next)}function hi(t,e){return yi(t.prev,t,e.prev)<0&&yi(e.next,t,t.next)<0}function di(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function fi(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function pi(t,e,i,n,r,o,s,a){return(r-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(n-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(r-s)*(n-a)}function mi(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&bi(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(xi(t,e)&&xi(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(yi(t.prev,t,e.prev)||yi(t,e.prev,e))||gi(t,e)&&yi(t.prev,t,t.next)>0&&yi(e.prev,e,e.next)>0)}function yi(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function gi(t,e){return t.x===e.x&&t.y===e.y}function bi(t,e,i,n){var r=wi(yi(t,e,i)),o=wi(yi(t,e,n)),s=wi(yi(i,n,t)),a=wi(yi(i,n,e));return r!==o&&s!==a||(!(0!==r||!vi(t,i,e))||(!(0!==o||!vi(t,n,e))||(!(0!==s||!vi(i,t,n))||!(0!==a||!vi(i,e,n)))))}function vi(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function wi(t){return t>0?1:t<0?-1:0}function xi(t,e){return yi(t.prev,t,t.next)<0?yi(t,e,t.next)>=0&&yi(t,t.prev,e)>=0:yi(t,e,t.prev)<0||yi(t,t.next,e)<0}function ki(t,e){var i=new Ai(t.i,t.x,t.y),n=new Ai(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function Mi(t,e,i,n){var r=new Ai(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function ji(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ai(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Fi(t,e,i,n){for(var r=0,o=e,s=i-n;o<i;o+=n)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}ti.exports=ei,ti.exports.default=ei,ei.deviation=function(t,e,i,n){var r=e&&e.length,o=r?e[0]*i:t.length,s=Math.abs(Fi(t,0,o,i));if(r)for(var a=0,l=e.length;a<l;a++){var u=e[a]*i,c=a<l-1?e[a+1]*i:t.length;s-=Math.abs(Fi(t,u,c,i))}var h=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,f=n[a+1]*i,p=n[a+2]*i;h+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},ei.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[r][o][s]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i};var Ti=ti.exports;\n/*!\n     * @maptalks/vector-packer v0.74.2\n     * LICENSE : UNLICENSED\n     * (c) 2016-2022 maptalks.com\n     */const zi={Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6};function Si(t,e={}){var i=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)_i(i,t.features[n],e,n);else _i(i,"Feature"===t.type?t:{geometry:t},e);return i}function _i(t,e,i,n){if(e.geometry&&e.geometry.geometry){var r=e.geometry.coordinates,o=e.geometry.type,s=[],a=e.id;if(i.promoteId?a=e.properties[i.promoteId]:i.generateId&&(a=n||0),"Point"===o)Pi(r,s);else if("MultiPoint"===o)for(var l=0;l<r.length;l++)Pi(r[l],s);else if("LineString"===o)Oi([r],s);else if("MultiLineString"===o){if(i.lineMetrics){for(l=0;l<r.length;l++)Ii(r[l],s=[]),t.push(Ei(a,"LineString",s,e.properties));return}Oi(r,s)}else if("Polygon"===o)Oi(r,s);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<e.geometry.geometries.length;l++)_i(t,{id:a,geometry:e.geometry.geometries[l],properties:e.properties},i,n);return}return void console.warn(`Input data type(${o}) is not a valid GeoJSON geometry type.`)}for(l=0;l<r.length;l++){var u=[];Oi(r[l],u),s.push(u)}}t.push(Ei(a,o,s,e.properties))}}function Pi(t,e){const i=new Ot(t[0],t[1]);i.z=100*(t[2]||0),e.push([i])}function Ii(t,e){for(let i=0;i<t.length;i++){const n=new Ot(t[i][0],t[i][1]);n.z=100*(t[i][2]||0),e.push(n)}}function Oi(t,e,i,n){for(var r=0;r<t.length;r++){var o=[];Ii(t[r],o),e.push(o)}}function Ei(t,e,i,n){return{id:void 0===t?null:t,type:zi[e],geometry:i,properties:n}}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     */function qi(t,{width:e,height:i},n,r){if(r){if(r.length!==e*i*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(e*i*n);return t.width=e,t.height=i,t.data=r,t}function Ri(t,{width:e,height:i},n){if(e===t.width&&i===t.height)return;const r=qi({},{width:e,height:i},n);Ci(t,r,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,i)},n),t.width=e,t.height=i,t.data=r.data}function Ci(t,e,i,n,r,o){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;if(s===a)return e;for(let l=0;l<r.height;l++){const u=((i.y+l)*t.width+i.x)*o,c=((n.y+l)*e.width+n.x)*o;for(let t=0;t<r.width*o;t++)a[c+t]=s[u+t]}return e}class Ni{constructor(t,e){qi(this,t,1,e)}resize(t){Ri(this,t,1)}clone(){return new Ni({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r){Ci(t,e,i,n,r,1)}}class Li{constructor(t,e){qi(this,t,4,e)}resize(t){Ri(this,t,4)}clone(){return new Li({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r){Ci(t,e,i,n,r,4)}}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     */class Di{constructor(t,{pixelRatio:e}){this.paddedRect=t,this.pixelRatio=e||1}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ui{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,e={},i=new qt(0,0,{autoResize:!0}),n=[];for(const i in t){const r=t[i],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(o),e[i]=new Di(o,r)}if(i.pack(n,{inPlace:!0}),!$i(i.w)||!$i(i.h)){const t=Wi(i.w),e=Wi(i.h);i.resize(t,e)}const r=new Li({width:i.w,height:i.h});for(const i in t){const n=t[i],o=e[i].paddedRect;Li.copy(n.data,r,{x:0,y:0},{x:o.x+1,y:o.y+1},n.data)}this.image=r,this.positions=e}}function $i(t){return 0==(t&t-1)&&0!==t}function Wi(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     * TODO potpack\n     */class Ji{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,e={},i=new qt(0,0,{autoResize:!0}),n=[];for(const i in t){const r=t[i],o=e[i]={};for(const t in r){const e=r[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const i={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};n.push(i),o[t]={rect:i,metrics:e.metrics}}}i.pack(n,{inPlace:!0});const r=new Ni({width:i.w,height:i.h});for(const i in t){const n=t[i];for(const t in n){const o=n[+t];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const s=e[i][t].rect;Ni.copy(o.bitmap,r,{x:0,y:0},{x:s.x+1,y:s.y+1},o.bitmap)}}this.image=r,this.positions=e}}function Hi(t){return t<65536?Uint16Array:Uint32Array}function Vi(t){return(t=Math.abs(t))<128?Int8Array:t<32768?Int16Array:Float32Array}function Gi(t){return t<256?Uint8Array:t<65536?Uint16Array:Float32Array}function Bi(t){const e=t.type,i=[];if(1===e||4===e)for(let e=0;e<t.geometry.length;e++)Pi(t.geometry[e],i);else if(2===e)Oi(t.geometry,i);else if(3===e)Oi(t.geometry,i);else if(5===e)Oi(t.geometry,i);else if(6===e)for(let e=0;e<t.geometry.length;e++){const n=[];Oi(t.geometry[e],n),i.push(n)}return t.geometry=i,t}function Xi(t){for(let e=1;e<arguments.length;e++){const i=arguments[e];for(const e in i)t[e]=i[e]}return t}function Zi(t){return null==t}function Yi(t){return"number"==typeof t&&!isNaN(t)}function Ki(t){return"object"==typeof t&&!!t}function Qi(t){return!Zi(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function tn(t){return!Zi(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}const en=Object.prototype.hasOwnProperty;function nn(t,e){return en.call(t,e)}const rn=Math.PI/180;function on(t){return t&&s(t)&&t.property}function sn(t){const{pointAtTileRes:e,tileRatio:i}=t;return e*i}function an(t){return"centimeter"===t||"cm"===t?1:"millimeter"===t||"mm"===t?.1:100}const ln={};function un(t,e){if(Array.isArray(e))for(let i=0;i<e.length;i++)t[i]=255*e[i];else{e=ln[e]=ln[e]||Te(e).array();for(let i=0;i<e.length;i++)t[i]=e[i]}return 3===t.length&&t.push(255),t}var cn=Object.freeze({__proto__:null,now:function(){return Date.now()},extend:Xi,isNil:Zi,isNumber:Yi,isInteger:function(t){return(0|t)===t},isObject:Ki,isString:Qi,isFunction:tn,hasOwn:nn,join:function(t,e){return t.join?t.join(e||","):Array.prototype.join.call(t,e||",")},toRadian:function(t){return t*rn},toDegree:function(t){return t/rn},evaluate:function(t,e,i){return tn(t)?t(void 0!==i?i:null,e):t},isFnTypeSymbol:on,getAltitudeToLocal:sn,getTubeSizeScale:an,normalizeColor:un});function hn(t){let e=0;for(let i,n,r=0,o=t.length,s=o-1;r<o;s=r++)i=t[r],n=t[s],e+=void 0!==i.x?(n.x-i.x)*(i.y+n.y):(n[0]-i[0])*(i[1]+n[1]);return e}function dn(t,e,i,n,r){const o=t[e*n],s=t[e*n+1],a=t[i*n],l=t[i*n+1];return o===a&&(o<0||o>r)&&s!==l||s===l&&(s<0||s>r)&&o!==a}function fn(t,e,i){let n=i;return e&&t&&(n=t[e]),void 0===n&&(n=i),100*(n||0)}function pn(t,e,i,n,r,o,s){e||0===e||(e=1);const a=fn(t.properties,i,n),l=a*e;let u=o&&100*o||a;return r?u=fn(t.properties,r,o):s&&(u=a-fn(t.properties,s,o)),u*=e,{altitude:l,height:u}}function mn(t,e){return e<1/0&&(t.x<0||t.x>e||t.y<0||t.y>e)}function yn(t){return null==t}function gn(t,e,i){if(t===i||t===e)return t;const n=i-e;return((t-e)%n+n)%n+e}function bn(t){if(!t||!t.length)return{};let e=0,i=-1,n=t[0];const r={};for(let o=0,s=t.length;o<s;o++)o===s-1?r[n]=[e,s]:t[o]!==n&&(i=o,r[n]=[e,i],e=o,n=t[o]);return r}function vn(t,e){if(!e)return null;const i={};for(let n=0;n<e.length;n++){const r=e[n],o=t[r];i[o]||(i[o]=[]),i[o].push(r)}return i}class wn{constructor(t,e,i,n){this.feature=t,this.symbol=e,this.fnTypes=i,this.options=n}getPolygonResource(){let t=this.symbol.polygonPatternFile;const{polygonPatternFileFn:e}=this.fnTypes;return this.q(t,e)}getLineResource(){let t=this.symbol.linePatternFile;const{linePatternFileFn:e}=this.fnTypes;return this.q(t,e)}q(t,e){return e&&(t=e(this.options.zoom,this.feature.properties)),t}}function xn(t,e,i,n){const r=Math.abs(n)>>15,o=r>>1,s=r%2;let a=n%Math.pow(2,15);const l=e+(o<<14)*Math.sign(e),u=i+(s<<14)*Math.sign(i);return t[0]=l,t[1]=u,a=Math.round(a),t[2]=0===a?n<0?-1:0:a,t}const kn=Math.pow(2,14),Mn=Math.pow(2,15);var jn={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like \'mapbox:\'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:\'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90 orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).\',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style\'s `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Mercator, Natural Earth, and Winkel Tripel. Terrain, fog, sky and CustomLayerInterface are not supported for projections other than mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source\'s bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source\'s tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source\'s bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source\'s tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source\'s bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source\'s tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\\n * `cluster` Is `true` if the point is a cluster \\n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\\n * `point_count` Number of original points grouped into this cluster\\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:\'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`)  it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\\n\\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\\n\\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`\'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},source_video:{type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like \'mapbox:\'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:\'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.\'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line\'s width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line\'s width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line\'s width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line\'s width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don\'t have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol\'s anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text\'s language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text\'s language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol\'s orientation. Note that the property values act as a hint, so that a symbol whose language doesnt support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single \'vertical\' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either [\'horizontal\', \'vertical\'] or [\'vertical\', \'horizontal\'], the order doesn\'t affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_symbol:{type:"boolean",doc:\'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",doc:\'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",doc:\'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",doc:\'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",doc:\'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",doc:\'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{doc:\'`["==", key, value]` equality: `feature[key] = value`\'},"!=":{doc:\'`["!=", key, value]` inequality: `feature[key]  value`\'},">":{doc:\'`[">", key, value]` greater than: `feature[key] > value`\'},">=":{doc:\'`[">=", key, value]` greater than or equal: `feature[key]  value`\'},"<":{doc:\'`["<", key, value]` less than: `feature[key] < value`\'},"<=":{doc:\'`["<=", key, value]` less than or equal: `feature[key]  value`\'},in:{doc:\'`["in", key, v0, ..., vn]` set inclusion: `feature[key]  {v0, ..., vn}`\'},"!in":{doc:\'`["!in", key, v0, ..., vn]` set exclusion: `feature[key]  {v0, ..., vn}`\'},all:{doc:\'`["all", f0, ..., fn]` logical `AND`: `f0  ...  fn`\'},any:{doc:\'`["any", f0, ..., fn]` logical `OR`: `f0  ...  fn`\'},none:{doc:\'`["none", f0, ..., fn]` logical `NOR`: `f0  ...  fn`\'},has:{doc:\'`["has", key]` `feature[key]` exists\'},"!has":{doc:\'`["!has", key]` `feature[key]` does not exist\'},within:{doc:\'`["within", object]` feature geometry is within object geometry\'}},doc:"The filter operator."},geometry_type:{type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn\'t otherwise available. It is used in the following circumstances:\\n* In categorical functions, when the feature value does not match any of the stop domain values.\\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\\nIf no default is provided, the style property\'s default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},expression_name:{doc:"",type:"enum",values:{let:{doc:\'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].\',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:\'References variable bound using "let".\',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:\'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\\n - a single literal value; or\\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\\n\\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\\nIf the input type does not match the type of the labels, the result will be the fallback value.\',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`\'image\'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:\'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.\',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:\'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\\n\\nInterpolation types:\\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.\',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:\'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.\',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:\'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.\',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:\'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\\\'image\\\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\\n- `"text-font"`: Overrides the font stack specified by the root layout property.\\n- `"text-color"`: Overrides the color specified by the root paint property.\\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.\',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`\'format\'`](#types-format) expression. A [`\'coalesce\'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `\'image\'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:\'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\\\'image\\\'`](#types-image) expression, `\\\'to-string\\\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.\',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:\'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.\',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color\'s red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature\'s properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature\'s properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:\'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.\',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature\'s state. Returns `null` if the requested property is not present on the feature\'s state. A feature\'s state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\\"feature-state\\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0"}}},"geometry-type":{doc:"Returns the feature\'s geometry type: `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`. `Multi*` feature types are only returned in GeoJSON sources. When working with vector tile sources, use the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature\'s id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:\'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.\',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:\'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.\',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"distance-from-center":{doc:\'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.\',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:\'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.\',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line\'s endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the fog. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the fog to the color of the sky. A value of zero leaves a sharp transition from fog to sky. Increasing the value blends the color of fog into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0"}}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0 (0 when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0 when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0, directly above, to 180, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},projection:{name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate Carre projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},terrain:{source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color\'s opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry\'s offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion\'s surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry\'s offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry\'s offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line\'s actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line\'s offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won\'t render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",doc:\'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.\',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry\'s offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle\'s stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle\'s stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:\'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.\',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon\'s halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon\'s anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text\'s halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo\'s fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text\'s anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0 north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0 is directly above, at zenith, and 90 at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0 north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0 is directly above, at zenith, and 90 at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}}},An="undefined"!=typeof undefinedThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof undefined?global:"undefined"!=typeof self?self:{};function Fn(t){var e={exports:{}};return t(e,e.exports),e.exports}function Tn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}\n/*! https://mths.be/punycode v1.3.2 by @mathias */Fn((function(t,e){!function(i){var n=e&&!e.nodeType&&e,r=t&&!t.nodeType&&t,o="object"==typeof An&&An;o.global!==o&&o.window!==o&&o.self!==o||(i=o);var s,a,l=2147483647,u=/^xn--/,c=/[^\\x20-\\x7E]/,h=/[\\x2E\\u3002\\uFF0E\\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,p=String.fromCharCode;function m(t){throw RangeError(d[t])}function y(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}function g(t,e){var i=t.split("@"),n="";return i.length>1&&(n=i[0]+"@",t=i[1]),n+y((t=t.replace(h,".")).split("."),e).join(".")}function b(t){for(var e,i,n=[],r=0,o=t.length;r<o;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<o?56320==(64512&(i=t.charCodeAt(r++)))?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),r--):n.push(e);return n}function v(t){return y(t,(function(t){var e="";return t>65535&&(e+=p((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+p(t)})).join("")}function w(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function x(t,e,i){var n=0;for(t=i?f(t/700):t>>1,t+=f(t/e);t>455;n+=36)t=f(t/35);return f(n+36*t/(t+38))}function k(t){var e,i,n,r,o,s,a,u,c,h,d,p=[],y=t.length,g=0,b=128,w=72;for((i=t.lastIndexOf("-"))<0&&(i=0),n=0;n<i;++n)t.charCodeAt(n)>=128&&m("not-basic"),p.push(t.charCodeAt(n));for(r=i>0?i+1:0;r<y;){for(o=g,s=1,a=36;r>=y&&m("invalid-input"),((u=(d=t.charCodeAt(r++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:36)>=36||u>f((l-g)/s))&&m("overflow"),g+=u*s,!(u<(c=a<=w?1:a>=w+26?26:a-w));a+=36)s>f(l/(h=36-c))&&m("overflow"),s*=h;w=x(g-o,e=p.length+1,0==o),f(g/e)>l-b&&m("overflow"),b+=f(g/e),g%=e,p.splice(g++,0,b)}return v(p)}function M(t){var e,i,n,r,o,s,a,u,c,h,d,y,g,v,k,M=[];for(y=(t=b(t)).length,e=128,i=0,o=72,s=0;s<y;++s)(d=t[s])<128&&M.push(p(d));for(n=r=M.length,r&&M.push("-");n<y;){for(a=l,s=0;s<y;++s)(d=t[s])>=e&&d<a&&(a=d);for(a-e>f((l-i)/(g=n+1))&&m("overflow"),i+=(a-e)*g,e=a,s=0;s<y;++s)if((d=t[s])<e&&++i>l&&m("overflow"),d==e){for(u=i,c=36;!(u<(h=c<=o?1:c>=o+26?26:c-o));c+=36)M.push(p(w(h+(k=u-h)%(v=36-h),0))),u=f(k/v);M.push(p(w(u,0))),o=x(i,g,n==r),i=0,++n}++i,++e}return M.join("")}if(s={version:"1.3.2",ucs2:{decode:b,encode:v},decode:k,encode:M,toASCII:function(t){return g(t,(function(t){return c.test(t)?"xn--"+M(t):t}))},toUnicode:function(t){return g(t,(function(t){return u.test(t)?k(t.slice(4).toLowerCase()):t}))}},n&&r)if(t.exports==n)r.exports=s;else for(a in s)s.hasOwnProperty(a)&&(n[a]=s[a]);else i.punycode=s}(An)}));var zn=function(t,e,i,n){i=i||"=";var r={};if("string"!=typeof t||0===t.length)return r;var o=/\\+/g;t=t.split(e=e||"&");var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var l=0;l<a;++l){var u,c,h,d,f=t[l].replace(o,"%20"),p=f.indexOf(i);p>=0?(u=f.substr(0,p),c=f.substr(p+1)):(u=f,c=""),h=decodeURIComponent(u),d=decodeURIComponent(c),Tn(r,h)?Array.isArray(r[h])?r[h].push(d):r[h]=[r[h],d]:r[h]=d}return r},Sn=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},_n=function(t,e,i,n){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(n){var r=encodeURIComponent(Sn(n))+i;return Array.isArray(t[n])?t[n].map((function(t){return r+encodeURIComponent(Sn(t))})).join(e):r+encodeURIComponent(Sn(t[n]))})).join(e):n?encodeURIComponent(Sn(n))+i+encodeURIComponent(Sn(t)):""};function Pn(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}Fn((function(t,e){e.decode=e.parse=zn,e.encode=e.stringify=_n}));class In extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class On{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new On(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const En={kind:"null"},qn={kind:"number"},Rn={kind:"string"},Cn={kind:"boolean"},Nn={kind:"color"},Ln={kind:"object"},Dn={kind:"value"},Un={kind:"collator"},$n={kind:"formatted"},Wn={kind:"resolvedImage"};function Jn(t,e){return{kind:"array",itemType:t,N:e}}function Hn(t){if("array"===t.kind){const e=Hn(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Vn=[En,qn,Rn,Cn,Nn,$n,Ln,Jn(Dn),Wn];function Gn(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Gn(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of Vn)if(!Gn(t,e))return null}return`Expected ${Hn(t)} but found ${Hn(e)} instead.`}function Bn(t,e){return e.some(e=>e.kind===t.kind)}function Xn(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}var Zn=Fn((function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return function(t){return t<0?0:t>1?1:t}("%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))}function s(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{e.parseCSSColor=function(t){var e,a=t.replace(/ /g,"").toLowerCase();if(a in i)return i[a].slice();if("#"===a[0])return 4===a.length?(e=parseInt(a.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===a.length&&(e=parseInt(a.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=a.indexOf("("),u=a.indexOf(")");if(-1!==l&&u+1===a.length){var c=a.substr(0,l),h=a.substr(l+1,u-(l+1)).split(","),d=1;switch(c){case"rgba":if(4!==h.length)return null;d=o(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),d];case"hsla":if(4!==h.length)return null;d=o(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,p=o(h[1]),m=o(h[2]),y=m<=.5?m*(p+1):m+p-m*p,g=2*m-y;return[n(255*s(g,y,f+1/3)),n(255*s(g,y,f)),n(255*s(g,y,f-1/3)),d];default:return null}}return null}}catch(t){}}));class Yn{constructor(t,e,i,n=1){this.r=t,this.g=e,this.b=i,this.a=n}static parse(t){if(!t)return;if(t instanceof Yn)return t;if("string"!=typeof t)return;const e=Zn.parseCSSColor(t);return e?new Yn(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,i,n]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${n})`}toArray(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*t/n,255*e/n,255*i/n,n]}}Yn.black=new Yn(0,0,0,1),Yn.white=new Yn(1,1,1,1),Yn.transparent=new Yn(0,0,0,0),Yn.red=new Yn(1,0,0,1),Yn.blue=new Yn(0,0,1,1);class Kn{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qn{constructor(t,e,i,n,r){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=i,this.fontStack=n,this.textColor=r}}class tr{constructor(t){this.sections=t}static fromString(t){return new tr([new Qn(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof tr?t:tr.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(i)}return t}}class er{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new er({name:t,available:!1}):null}serialize(){return["image",this.name]}}function ir(t,e,i,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: \'a\' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: \'r\', \'g\', and \'b\' must be between 0 and 255.`}function nr(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof Yn)return!0;if(t instanceof Kn)return!0;if(t instanceof tr)return!0;if(t instanceof er)return!0;if(Array.isArray(t)){for(const e of t)if(!nr(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!nr(t[e]))return!1;return!0}return!1}function rr(t){if(null===t)return En;if("string"==typeof t)return Rn;if("boolean"==typeof t)return Cn;if("number"==typeof t)return qn;if(t instanceof Yn)return Nn;if(t instanceof Kn)return Un;if(t instanceof tr)return $n;if(t instanceof er)return Wn;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=rr(e);if(i){if(i===t)continue;i=Dn;break}i=t}return Jn(i||Dn,e)}return Ln}function or(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Yn||t instanceof tr||t instanceof er?t.toString():JSON.stringify(t)}class sr{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`\'literal\' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!nr(t[1]))return e.error("invalid value");const i=t[1];let n=rr(i);const r=e.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new sr(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Yn?["rgba"].concat(this.value.toArray()):this.value instanceof tr?this.value.serialize():this.value}}class ar{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const lr={string:Rn,number:qn,boolean:Cn,object:Ln};class ur{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,n=1;const r=t[0];if("array"===r){let r,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in lr)||"object"===i)return e.error(\'The item type argument of "array" must be one of string, number, boolean\',1);r=lr[i],n++}else r=Dn;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error(\'The length argument to "array" must be a positive integer literal\',2);o=t[2],n++}i=Jn(r,o)}else i=lr[r];const o=[];for(;n<t.length;n++){const i=e.parse(t[n],n,Dn);if(!i)return null;o.push(i)}return new ur(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!Gn(this.type,rr(i)))return i;if(e===this.args.length-1)throw new ar(`Expected value to be of type ${Hn(this.type)}, but found ${Hn(rr(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);const n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map(t=>t.serialize()))}}class cr{constructor(t){this.type=$n,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,qn),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,Jn(Rn)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,Nn),!s))return null;const a=n[n.length-1];a.scale=t,a.font=i,a.textColor=s}else{const o=e.parse(t[i],1,Dn);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be \'string\', \'value\', \'image\' or \'null\'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null})}}return new cr(n)}evaluate(t){return new tr(this.sections.map(e=>{const i=e.content.evaluate(t);return rr(i)===Wn?new Qn("",i,null,null,null):new Qn(or(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class hr{constructor(t){this.type=Wn,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,Rn);return i?new hr(i):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=er.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const dr={"to-boolean":Cn,"to-color":Nn,"to-number":qn,"to-string":Rn};class fr{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0];if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");const n=dr[i],r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],i,Dn);if(!n)return null;r.push(n)}return new fr(n,r)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,i;for(const n of this.args){if(e=n.evaluate(t),i=null,e instanceof Yn)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:ir(e[0],e[1],e[2],e[3]),!i))return new Yn(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ar(i||`Could not parse color from value \'${"string"==typeof e?e:String(JSON.stringify(e))}\'`)}if("number"===this.type.kind){let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new ar(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?tr.fromString(or(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?er.fromString(or(this.args[0].evaluate(t))):or(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new cr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new hr(this.args[0]).serialize();const t=["to-"+this.type.kind];return this.eachChild(e=>{t.push(e.serialize())}),t}}const pr=["Unknown","Point","LineString","Polygon"];class mr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this.R={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?pr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this.R[t];return e||(e=this.R[t]=Yn.parse(t)),e}}class yr{constructor(t,e,i,n){this.name=t,this.type=e,this.C=i,this.args=n}evaluate(t){return this.C(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,e){const i=t[0],n=yr.definitions[i];if(!n)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter(([e])=>!Array.isArray(e)||e.length===t.length-1);let a=null;for(const[n,o]of s){a=new Nr(e.registry,e.path,null,e.scope);const s=[];let l=!1;for(let e=1;e<t.length;e++){const i=t[e],r=Array.isArray(n)?n[e-1]:n.type,o=a.parse(i,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(n)&&n.length!==s.length)a.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);else{for(let t=0;t<s.length;t++){const e=Array.isArray(n)?n[t]:n.type,i=s[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new yr(i,r,o,s)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o).map(([t])=>{return e=t,Array.isArray(e)?`(${e.map(Hn).join(", ")})`:`(${Hn(e.type)}...)`;var e}).join(" | "),n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],1+n.length);if(!r)return null;n.push(Hn(r.type))}e.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){yr.definitions=e;for(const i in e)t[i]=yr}}class gr{constructor(t,e,i){this.type=Un,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const n=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Cn);if(!n)return null;const r=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Cn);if(!r)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,Rn),!o)?null:new gr(n,r,o)}evaluate(t){return new Kn(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function br(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function vr(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function wr(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(i*r*8192),Math.round(n*r*8192)]}function xr(t,e,i){const n=t[0]-e[0],r=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return n*s-o*r==0&&n*o<=0&&r*s<=0}function kr(t,e){let i=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(xr(t,a[e],a[e+1]))return!1;(r=a[e])[1]>(n=t)[1]!=(o=a[e+1])[1]>n[1]&&n[0]<(o[0]-r[0])*(n[1]-r[1])/(o[1]-r[1])+r[0]&&(i=!i)}}var n,r,o;return i}function Mr(t,e){for(let i=0;i<e.length;i++)if(kr(t,e[i]))return!0;return!1}function jr(t,e,i,n){const r=n[0]-i[0],o=n[1]-i[1],s=(t[0]-i[0])*o-r*(t[1]-i[1]),a=(e[0]-i[0])*o-r*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function Ar(t,e,i){for(const u of i)for(let i=0;i<u.length-1;++i)if(void 0,void 0,0!=(a=[(s=u[i+1])[0]-(o=u[i])[0],s[1]-o[1]])[0]*(l=[(r=e)[0]-(n=t)[0],r[1]-n[1]])[1]-a[1]*l[0]&&jr(n,r,o,s)&&jr(o,s,n,r))return!0;var n,r,o,s,a,l;return!1}function Fr(t,e){for(let i=0;i<t.length;++i)if(!kr(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Ar(t[i],t[i+1],e))return!1;return!0}function Tr(t,e){for(let i=0;i<e.length;i++)if(Fr(t,e[i]))return!0;return!1}function zr(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=[];for(let n=0;n<t[r].length;n++){const s=wr(t[r][n],i);br(e,s),o.push(s)}n.push(o)}return n}function Sr(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=zr(t[r],e,i);n.push(o)}return n}function _r(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const e=.5*n;let r=t[0]-i[0]>e?-n:i[0]-t[0]>e?n:0;0===r&&(r=t[0]-i[2]>e?-n:i[2]-t[0]>e?n:0),t[0]+=r}br(e,t)}function Pr(t,e,i,n){const r=8192*Math.pow(2,n.z),o=[8192*n.x,8192*n.y],s=[];if(!t)return s;for(const n of t)for(const t of n){const n=[t.x+o[0],t.y+o[1]];_r(n,e,i,r),s.push(n)}return s}function Ir(t,e,i,n){const r=8192*Math.pow(2,n.z),o=[8192*n.x,8192*n.y],s=[];if(!t)return s;for(const i of t){const t=[];for(const n of i){const i=[n.x+o[0],n.y+o[1]];br(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const n of t)_r(n,e,i,r)}var a;return s}class Or{constructor(t,e){this.type=Cn,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`\'within\' expression requires exactly one argument, but found ${t.length-1} instead.`);if(nr(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Or(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Or(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Or(e,e)}return e.error("\'within\' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const o=zr(e.coordinates,n,r),s=Pr(t.geometry(),i,n,r);if(!vr(i,n))return!1;for(const t of s)if(!kr(t,o))return!1}if("MultiPolygon"===e.type){const o=Sr(e.coordinates,n,r),s=Pr(t.geometry(),i,n,r);if(!vr(i,n))return!1;for(const t of s)if(!Mr(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const o=zr(e.coordinates,n,r),s=Ir(t.geometry(),i,n,r);if(!vr(i,n))return!1;for(const t of s)if(!Fr(t,o))return!1}if("MultiPolygon"===e.type){const o=Sr(e.coordinates,n,r),s=Ir(t.geometry(),i,n,r);if(!vr(i,n))return!1;for(const t of s)if(!Tr(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Er(t){if(t instanceof yr){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Or)return!1;let e=!0;return t.eachChild(t=>{e&&!Er(t)&&(e=!1)}),e}function qr(t){if(t instanceof yr&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!qr(t)&&(e=!1)}),e}function Rr(t,e){if(t instanceof yr&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(t=>{i&&!Rr(t,e)&&(i=!1)}),i}class Cr{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("\'var\' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new Cr(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Nr{constructor(t,e=[],i,n=new On,r=[]){this.registry=t,this.path=e,this.key=e.map(t=>`[${t}]`).join(""),this.scope=n,this.errors=r,this.expectedType=i}parse(t,e,i,n,r={}){return e?this.concat(e,i,n).L(t,r):this.L(t,r)}L(t,e){function i(t,e,i){return"assert"===i?new ur(e,[t]):"coerce"===i?new fr(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error(\'Expected an array with at least one element. If you wanted a literal array, use ["literal", []].\');const n=t[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[n];if(r){let n=r.parse(t,this);if(!n)return null;if(this.expectedType){const t=this.expectedType,r=n.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(t,r))return null}else n=i(n,t,e.typeAnnotation||"coerce");else n=i(n,t,e.typeAnnotation||"assert")}if(!(n instanceof sr)&&"resolvedImage"!==n.type.kind&&function t(e){if(e instanceof Cr)return t(e.boundExpression);if(e instanceof yr&&"error"===e.name)return!1;if(e instanceof gr)return!1;if(e instanceof Or)return!1;const i=e instanceof fr||e instanceof ur;let n=!0;return e.eachChild(e=>{n=i?n&&t(e):n&&e instanceof sr}),!!n&&(Er(e)&&Rr(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}(n)){const e=new mr;try{n=new sr(n.type,n.evaluate(e))}catch(t){return this.error(t.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"\'undefined\' value invalid. Use null instead.":"object"==typeof t?\'Bare objects invalid. Use ["literal", {...}] instead.\':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const n="number"==typeof t?this.path.concat(t):this.path,r=i?this.scope.concat(i):this.scope;return new Nr(this.registry,n,e||null,r,this.errors)}error(t,...e){const i=`${this.key}${e.map(t=>`[${t}]`).join("")}`;this.errors.push(new In(i,t))}checkSubtype(t,e){const i=Gn(t,e);return i&&this.error(i),i}}function Lr(t,e){const i=t.length-1;let n,r,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),n=t[a],r=t[a+1],n<=e){if(a===i||e<r)return a;o=a+1}else{if(!(n>e))throw new ar("Input is not a number.");s=a-1}return 0}class Dr{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,qn);if(!i)return null;const n=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error(\'Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.\',a);if(n.length&&n[n.length-1][0]>=o)return e.error(\'Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.\',a);const u=e.parse(s,l,r);if(!u)return null;r=r||u.type,n.push([o,u])}return new Dr(r,i,n)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;return n>=e[r-1]?i[r-1].evaluate(t):i[Lr(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}var Ur=$r;function $r(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}function Wr(t,e,i){return t*(1-i)+e*i}$r.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},$r.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},$r.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},$r.prototype.solveCurveX=function(t,e){var i,n,r,o,s;for(void 0===e&&(e=1e-6),r=t,s=0;s<8;s++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=o/a}if((r=t)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;t>o?i=r:n=r,r=.5*(n-i)+i}return r},$r.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var Jr=Object.freeze({__proto__:null,number:Wr,color:function(t,e,i){return new Yn(Wr(t.r,e.r,i),Wr(t.g,e.g,i),Wr(t.b,e.b,i),Wr(t.a,e.a,i))},array:function(t,e,i){return t.map((t,n)=>Wr(t,e[n],i))}});const Hr=6/29*3*(6/29),Vr=Math.PI/180,Gr=180/Math.PI;function Br(t){return t>.008856451679035631?Math.pow(t,1/3):t/Hr+4/29}function Xr(t){return t>6/29?t*t*t:Hr*(t-4/29)}function Zr(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Yr(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Kr(t){const e=Yr(t.r),i=Yr(t.g),n=Yr(t.b),r=Br((.4124564*e+.3575761*i+.1804375*n)/.95047),o=Br((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-Br((.0193339*e+.119192*i+.9503041*n)/1.08883)),alpha:t.a}}function Qr(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Xr(e),i=.95047*Xr(i),n=1.08883*Xr(n),new Yn(Zr(3.2404542*i-1.5371385*e-.4985314*n),Zr(-.969266*i+1.8760108*e+.041556*n),Zr(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function to(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const eo={forward:Kr,reverse:Qr,interpolate:function(t,e,i){return{l:Wr(t.l,e.l,i),a:Wr(t.a,e.a,i),b:Wr(t.b,e.b,i),alpha:Wr(t.alpha,e.alpha,i)}}},io={forward:function(t){const{l:e,a:i,b:n}=Kr(t),r=Math.atan2(n,i)*Gr;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Vr,i=t.c;return Qr({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:to(t.h,e.h,i),c:Wr(t.c,e.c,i),l:Wr(t.l,e.l,i),alpha:Wr(t.alpha,e.alpha,i)}}};var no=Object.freeze({__proto__:null,lab:eo,hcl:io});class ro{constructor(t,e,i,n,r){this.type=t,this.operator=e,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,n){let r=0;if("exponential"===t.name)r=oo(e,t.base,i,n);else if("linear"===t.name)r=oo(e,1,i,n);else if("cubic-bezier"===t.name){const o=t.controlPoints;r=new Ur(o[0],o[1],o[2],o[3]).solve(oo(e,1,i,n))}return r}static parse(t,e){let[i,n,r,...o]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t}}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);{const t=n.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,qn),!r)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=Nn:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const i=o[t],n=o[t+1],r=t+3,l=t+4;if("number"!=typeof i)return e.error(\'Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.\',r);if(s.length&&s[s.length-1][0]>=i)return e.error(\'Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.\',r);const u=e.parse(n,l,a);if(!u)return null;a=a||u.type,s.push([i,u])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new ro(a,i,n,r,s):e.error(`Type ${Hn(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);const o=Lr(e,n),s=ro.interpolationFactor(this.interpolation,n,e[o],e[o+1]),a=i[o].evaluate(t),l=i[o+1].evaluate(t);return"interpolate"===this.operator?Jr[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?io.reverse(io.interpolate(io.forward(a),io.forward(l),s)):eo.reverse(eo.interpolate(eo.forward(a),eo.forward(l),s))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function oo(t,e,i,n){const r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}class so{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const n=e.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of t.slice(1)){const t=e.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,r.push(t)}const o=n&&r.some(t=>Gn(n,t.type));return new so(o?Dn:i,r)}evaluate(t){let e,i=null,n=0;for(const r of this.args){if(n++,i=r.evaluate(t),i&&i instanceof er&&!i.available&&(e||(e=i),i=null,n===this.args.length))return e;if(null!==i)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class ao{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let n=1;n<t.length-1;n+=2){const r=t[n];if("string"!=typeof r)return e.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or \'_\'.",n);const o=e.parse(t[n+1],n+1);if(!o)return null;i.push([r,o])}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return n?new ao(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}class lo{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,qn),n=e.parse(t[2],2,Jn(e.expectedType||Dn));return i&&n?new lo(n.type.itemType,i,n):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new ar(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new ar(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new ar(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class uo{constructor(t,e){this.type=Cn,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Dn),n=e.parse(t[2],2,Dn);return i&&n?Bn(i.type,[Cn,Rn,qn,En,Dn])?new uo(i,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(null==i)return!1;if(!Xn(e,["boolean","string","number","null"]))throw new ar(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(rr(e))} instead.`);if(!Xn(i,["string","array"]))throw new ar(`Expected second argument to be of type array or string, but found ${Hn(rr(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class co{constructor(t,e,i){this.type=qn,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Dn),n=e.parse(t[2],2,Dn);if(!i||!n)return null;if(!Bn(i.type,[Cn,Rn,qn,En,Dn]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,qn);return r?new co(i,n,r):null}return new co(i,n)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!Xn(e,["boolean","string","number","null"]))throw new ar(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(rr(e))} instead.`);if(!Xn(i,["string","array"]))throw new ar(`Expected second argument to be of type array or string, but found ${Hn(rr(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(t);return i.indexOf(e,n)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ho{constructor(t,e,i,n,r,o){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const r={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const u=e.concat(s);if(0===a.length)return u.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return u.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return u.error("Numeric branch labels must be integer values.");if(i){if(u.checkSubtype(i,rr(t)))return null}else i=rr(t);if(void 0!==r[String(t)])return u.error("Branch labels must be unique.");r[String(t)]=o.length}const c=e.parse(l,s,n);if(!c)return null;n=n||c.type,o.push(c)}const s=e.parse(t[1],1,Dn);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new ho(i,n,s,r,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(rr(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],n={};for(const t of e){const e=n[this.cases[t]];void 0===e?(n[this.cases[t]]=i.length,i.push([this.cases[t],[t]])):i[e][1].push(t)}const r=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,n]of i)t.push(1===n.length?r(n[0]):n.map(r)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}class fo{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const n=[];for(let r=1;r<t.length-1;r+=2){const o=e.parse(t[r],r,Cn);if(!o)return null;const s=e.parse(t[r+1],r+1,i);if(!s)return null;n.push([o,s]),i=i||s.type}const r=e.parse(t[t.length-1],t.length-1,i);return r?new fo(i,n,r):null}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every(([t,e])=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class po{constructor(t,e,i,n){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Dn),n=e.parse(t[2],2,qn);if(!i||!n)return null;if(!Bn(i.type,[Jn(Dn),Rn,Dn]))return e.error(`Expected first argument to be of type array or string, but found ${Hn(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,qn);return r?new po(i.type,i,n,r):null}return new po(i.type,i,n)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!Xn(e,["string","array"]))throw new ar(`Expected first argument to be of type array or string, but found ${Hn(rr(e))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(t);return e.slice(i,n)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function mo(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function yo(t,e,i,n){return 0===n.compare(e,i)}function go(t,e,i){const n="=="!==t&&"!="!==t;return class r{constructor(t,e,i){this.type=Cn,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,Dn);if(!o)return null;if(!mo(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type \'${Hn(o.type)}\'.`);let s=e.parse(t[2],2,Dn);if(!s)return null;if(!mo(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type \'${Hn(s.type)}\'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types \'${Hn(o.type)}\' and \'${Hn(s.type)}\'.`);n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new ur(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new ur(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Un),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const e=rr(o),i=rr(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new ar(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=rr(o),i=rr(s);if("string"!==t.kind||"string"!==i.kind)return e(r,o,s)}return this.collator?i(r,o,s,this.collator.evaluate(r)):e(r,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild(t=>{e.push(t.serialize())}),e}}}const bo=go("==",(function(t,e,i){return e===i}),yo),vo=go("!=",(function(t,e,i){return e!==i}),(function(t,e,i,n){return!yo(0,e,i,n)})),wo=go("<",(function(t,e,i){return e<i}),(function(t,e,i,n){return n.compare(e,i)<0})),xo=go(">",(function(t,e,i){return e>i}),(function(t,e,i,n){return n.compare(e,i)>0})),ko=go("<=",(function(t,e,i){return e<=i}),(function(t,e,i,n){return n.compare(e,i)<=0})),Mo=go(">=",(function(t,e,i){return e>=i}),(function(t,e,i,n){return n.compare(e,i)>=0}));class jo{constructor(t,e,i,n,r){this.type=Rn,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=n,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,qn);if(!i)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=e.parse(n.locale,1,Rn),!r))return null;let o=null;if(n.currency&&(o=e.parse(n.currency,1,Rn),!o))return null;let s=null;if(n["min-fraction-digits"]&&(s=e.parse(n["min-fraction-digits"],1,qn),!s))return null;let a=null;return n["max-fraction-digits"]&&(a=e.parse(n["max-fraction-digits"],1,qn),!a)?null:new jo(i,r,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Ao{constructor(t){this.type=qn,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${Hn(i.type)} instead.`):new Ao(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ar(`Expected value to be of type string or array, but found ${Hn(rr(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(e=>{t.push(e.serialize())}),t}}const Fo={"==":bo,"!=":vo,">":xo,"<":wo,">=":Mo,"<=":ko,array:ur,at:lo,boolean:ur,case:fo,coalesce:so,collator:gr,format:cr,image:hr,in:uo,"index-of":co,interpolate:ro,"interpolate-hcl":ro,"interpolate-lab":ro,length:Ao,let:ao,literal:sr,match:ho,number:ur,"number-format":jo,object:ur,slice:po,step:Dr,string:ur,"to-boolean":fr,"to-color":fr,"to-number":fr,"to-string":fr,var:Cr,within:Or};function To(t,[e,i,n,r]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const o=r?r.evaluate(t):1,s=ir(e,i,n,o);if(s)throw new ar(s);return new Yn(e/255*o,i/255*o,n/255*o,o)}function zo(t,e){return t in e}function So(t,e){const i=e[t];return void 0===i?null:i}function _o(t){return{type:t}}function Po(t){return{result:"success",value:t}}function Io(t){return{result:"error",value:t}}function Oo(t){return!!t.expression&&t.expression.interpolated}function Eo(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function qo(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Ro(t){return t}function Co(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function No(t,e,i,n,r){return Co(typeof i===r?n[i]:void 0,t.default,e.default)}function Lo(t,e,i){if("number"!==Eo(i))return Co(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const r=Lr(t.stops.map(t=>t[0]),i);return t.stops[r][1]}function Do(t,e,i){const n=void 0!==t.base?t.base:1;if("number"!==Eo(i))return Co(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const o=Lr(t.stops.map(t=>t[0]),i),s=function(t,e,i,n){const r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}(i,n,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1];let u=Jr[e.type]||Ro;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=no[t.colorSpace];u=(t,i)=>e.reverse(e.interpolate(e.forward(t),e.forward(i),s))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==i)return u(e,i,s)}}:u(a,l,s)}function Uo(t,e,i){return"color"===e.type?i=Yn.parse(i):"formatted"===e.type?i=tr.fromString(i.toString()):"resolvedImage"===e.type?i=er.fromString(i.toString()):Eo(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Co(i,t.default,e.default)}yr.register(Fo,{error:[{kind:"error"},[Rn],(t,[e])=>{throw new ar(e.evaluate(t))}],typeof:[Rn,[Dn],(t,[e])=>Hn(rr(e.evaluate(t)))],"to-rgba":[Jn(qn,4),[Nn],(t,[e])=>e.evaluate(t).toArray()],rgb:[Nn,[qn,qn,qn],To],rgba:[Nn,[qn,qn,qn,qn],To],has:{type:Cn,overloads:[[[Rn],(t,[e])=>zo(e.evaluate(t),t.properties())],[[Rn,Ln],(t,[e,i])=>zo(e.evaluate(t),i.evaluate(t))]]},get:{type:Dn,overloads:[[[Rn],(t,[e])=>So(e.evaluate(t),t.properties())],[[Rn,Ln],(t,[e,i])=>So(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Dn,[Rn],(t,[e])=>So(e.evaluate(t),t.featureState||{})],properties:[Ln,[],t=>t.properties()],"geometry-type":[Rn,[],t=>t.geometryType()],id:[Dn,[],t=>t.id()],zoom:[qn,[],t=>t.globals.zoom],pitch:[qn,[],t=>t.globals.pitch||0],"distance-from-center":[qn,[],t=>t.distanceFromCenter()],"heatmap-density":[qn,[],t=>t.globals.heatmapDensity||0],"line-progress":[qn,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[qn,[],t=>t.globals.skyRadialProgress||0],accumulated:[Dn,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[qn,_o(qn),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[qn,_o(qn),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:qn,overloads:[[[qn,qn],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[qn],(t,[e])=>-e.evaluate(t)]]},"/":[qn,[qn,qn],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[qn,[qn,qn],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[qn,[],()=>Math.LN2],pi:[qn,[],()=>Math.PI],e:[qn,[],()=>Math.E],"^":[qn,[qn,qn],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[qn,[qn],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[qn,[qn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[qn,[qn],(t,[e])=>Math.log(e.evaluate(t))],log2:[qn,[qn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[qn,[qn],(t,[e])=>Math.sin(e.evaluate(t))],cos:[qn,[qn],(t,[e])=>Math.cos(e.evaluate(t))],tan:[qn,[qn],(t,[e])=>Math.tan(e.evaluate(t))],asin:[qn,[qn],(t,[e])=>Math.asin(e.evaluate(t))],acos:[qn,[qn],(t,[e])=>Math.acos(e.evaluate(t))],atan:[qn,[qn],(t,[e])=>Math.atan(e.evaluate(t))],min:[qn,_o(qn),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[qn,_o(qn),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[qn,[qn],(t,[e])=>Math.abs(e.evaluate(t))],round:[qn,[qn],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[qn,[qn],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[qn,[qn],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Cn,[Rn,Dn],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Cn,[Dn],(t,[e])=>t.id()===e.value],"filter-type-==":[Cn,[Rn],(t,[e])=>t.geometryType()===e.value],"filter-<":[Cn,[Rn,Dn],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[Cn,[Dn],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[Cn,[Rn,Dn],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[Cn,[Dn],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[Cn,[Rn,Dn],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[Cn,[Dn],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[Cn,[Rn,Dn],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[Cn,[Dn],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[Cn,[Dn],(t,[e])=>e.value in t.properties()],"filter-has-id":[Cn,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Cn,[Jn(Rn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Cn,[Jn(Dn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Cn,[Rn,Jn(Dn)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Cn,[Rn,Jn(Dn)],(t,[e,i])=>function(t,e,i,n){for(;i<=n;){const r=i+n>>1;if(e[r]===t)return!0;e[r]>t?n=r-1:i=r+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Cn,overloads:[[[Cn,Cn],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[_o(Cn),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Cn,overloads:[[[Cn,Cn],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[_o(Cn),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Cn,[Cn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Cn,[Rn],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Rn,[Rn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Rn,[Rn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Rn,_o(Dn),(t,e)=>e.map(e=>or(e.evaluate(t))).join("")],"resolved-locale":[Rn,[Un],(t,[e])=>e.evaluate(t).resolvedLocale()]});class $o{constructor(t,e){this.expression=t,this.D={},this.U=new mr,this.W=e?function(t){return"color"===t.type&&qo(t.default)?new Yn(0,0,0,0):"color"===t.type?Yn.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this.J=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,n,r,o,s,a){return this.U.globals=t,this.U.feature=e,this.U.featureState=i,this.U.canonical=n||null,this.U.availableImages=r||null,this.U.formattedSection=o,this.U.featureTileCoord=s||null,this.U.featureDistanceData=a||null,this.expression.evaluate(this.U)}evaluate(t,e,i,n,r,o,s,a){this.U.globals=t,this.U.feature=e||null,this.U.featureState=i||null,this.U.canonical=n||null,this.U.availableImages=r||null,this.U.formattedSection=o||null,this.U.featureTileCoord=s||null,this.U.featureDistanceData=a||null;try{const t=this.expression.evaluate(this.U);if(null==t||"number"==typeof t&&t!=t)return this.W;if(this.J&&!(t in this.J))throw new ar(`Expected value to be one of ${Object.keys(this.J).map(t=>JSON.stringify(t)).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this.D[t.message]||(this.D[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this.W}}}function Wo(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Fo}function Jo(t,e){const i=new Nr(Fo,[],e?function(t){const e={color:Nn,string:Rn,number:qn,enum:Rn,boolean:Cn,formatted:$n,resolvedImage:Wn};return"array"===t.type?Jn(e[t.value]||Dn,t.length):e[t.type]}(e):void 0),n=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?Po(new $o(n,e)):Io(i.errors)}class Ho{constructor(t,e){this.kind=t,this.H=e,this.isStateDependent="constant"!==t&&!qr(e.expression)}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this.H.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this.H.evaluate(t,e,i,n,r,o)}}class Vo{constructor(t,e,i,n){this.kind=t,this.zoomStops=i,this.H=e,this.isStateDependent="camera"!==t&&!qr(e.expression),this.interpolationType=n}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this.H.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this.H.evaluate(t,e,i,n,r,o)}interpolationFactor(t,e,i){return this.interpolationType?ro.interpolationFactor(this.interpolationType,t,e,i):0}}function Go(t,e){if("error"===(t=Jo(t,e)).result)return t;const i=t.value.expression,n=Er(i);if(!n&&!function(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}(e))return Io([new In("","data expressions not supported")]);const r=Rr(i,["zoom","pitch","distance-from-center"]);if(!r&&!function(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}(e))return Io([new In("","zoom expressions not supported")]);const o=function t(e){let i=null;if(e instanceof ao)i=t(e.result);else if(e instanceof so){for(const n of e.args)if(i=t(n),i)break}else(e instanceof Dr||e instanceof ro)&&e.input instanceof yr&&"zoom"===e.input.name&&(i=e);return i instanceof In||e.eachChild(e=>{const n=t(e);n instanceof In?i=n:!i&&n?i=new In("",\'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.\'):i&&n&&i!==n&&(i=new In("",\'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.\'))}),i}(i);if(!o&&!r)return Io([new In("",\'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.\')]);if(o instanceof In)return Io([o]);if(o instanceof ro&&!Oo(e))return Io([new In("",\'"interpolate" expressions cannot be used with this property\')]);if(!o)return Po(new Ho(n?"constant":"source",t.value));const s=o instanceof ro?o.interpolation:void 0;return Po(new Vo(n?"camera":"composite",t.value,o.labels,s))}class Bo{constructor(t,e){this.V=t,this.G=e,Pn(this,function t(e,i){const n="color"===i.type,r=e.stops&&"object"==typeof e.stops[0][0],o=r||!(r||void 0!==e.property),s=e.type||(Oo(i)?"exponential":"interval");if(n&&((e=Pn({},e)).stops&&(e.stops=e.stops.map(t=>[t[0],Yn.parse(t[1])])),e.default=Yn.parse(e.default?e.default:i.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!no[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);let a,l,u;if("exponential"===s)a=Do;else if("interval"===s)a=Lo;else if("categorical"===s){a=No,l=Object.create(null);for(const t of e.stops)l[t[0]]=t[1];u=typeof e.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);a=Uo}if(r){const n={},r=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],o=i[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},r.push(o)),n[o].stops.push([i[0].value,i[1]])}const o=[];for(const e of r)o.push([n[e].zoom,t(n[e],i)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:ro.interpolationFactor.bind(void 0,s),zoomStops:o.map(t=>t[0]),evaluate:({zoom:t},n)=>Do({stops:o,base:e.base},i,t).evaluate(t,n)}}if(o){const t="exponential"===s?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:t,interpolationFactor:ro.interpolationFactor.bind(void 0,t),zoomStops:e.stops.map(t=>t[0]),evaluate:({zoom:t})=>a(e,i,t,l,u)}}return{kind:"source",evaluate(t,n){const r=n&&n.properties?n.properties[e.property]:void 0;return void 0===r?Co(e.default,i.default):a(e,i,r,l,u)}}}(this.V,this.G))}static deserialize(t){return new Bo(t.V,t.G)}static serialize(t){return{V:t.V,G:t.G}}}function Xo(t){if(Array.isArray(t))return t.map(Xo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Xo(t[i]);return e}return function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}(t)}function Zo(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Zo(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Yo(t){if(!Array.isArray(t))return!1;if(function(t){return"pitch"===t||"distance-from-center"===t}(t[0]))return!0;for(let e=1;e<t.length;e++)if(Yo(t[e]))return!0;return!1}const Ko=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Qo(t,e){return t<e?-1:t>e?1:0}function ts(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?es(t[1],t[2],"=="):"!="===e?rs(es(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?es(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(ts))):"all"===e?["all"].concat(t.slice(1).map(ts)):"none"===e?["all"].concat(t.slice(1).map(ts).map(rs)):"in"===e?is(t[1],t.slice(2)):"!in"===e?rs(is(t[1],t.slice(2))):"has"===e?ns(t[1]):"!has"===e?rs(ns(t[1])):"within"!==e||t;var i}function es(t,e,i){switch(t){case"$type":return["filter-type-"+i,e];case"$id":return["filter-id-"+i,e];default:return["filter-"+i,t,e]}}function is(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Qo)]]:["filter-in-small",t,["literal",e]]}}function ns(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function rs(t){return["!",t]}Fn((function(t,e){var i=function(){var t=function(t,e,i,n){for(i=i||{},n=t.length;n--;i[t[n]]=e);return i},e=[1,12],i=[1,13],n=[1,9],r=[1,10],o=[1,11],s=[1,14],a=[1,15],l=[14,18,22,24],u=[18,22],c=[22,24],h={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(t,e,i,n,r,o,s){var a=o.length-1;switch(r){case 1:this.$=new String(t.replace(/\\\\(\\\\|")/g,"$1").replace(/\\\\n/g,"\\n").replace(/\\\\r/g,"\\r").replace(/\\\\t/g,"\\t").replace(/\\\\v/g,"\\v").replace(/\\\\f/g,"\\f").replace(/\\\\b/g,"\\b")),this.$.B=this.X.first_line;break;case 2:this.$=new Number(t),this.$.B=this.X.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.B=this.X.first_line;break;case 5:this.$=new Boolean(!1),this.$.B=this.X.first_line;break;case 6:return this.$=o[a-1];case 13:this.$={},Object.defineProperty(this.$,"B",{value:this.X.first_line,enumerable:!1});break;case 14:case 19:this.$=o[a-1],Object.defineProperty(this.$,"B",{value:this.X.first_line,enumerable:!1});break;case 15:this.$=[o[a-2],o[a]];break;case 16:this.$={},this.$[o[a][0]]=o[a][1];break;case 17:this.$=o[a-2],o[a-2][o[a][0]]=o[a][1];break;case 18:this.$=[],Object.defineProperty(this.$,"B",{value:this.X.first_line,enumerable:!1});break;case 20:this.$=[o[a]];break;case 21:this.$=o[a-2],o[a-2].push(o[a])}},table:[{3:5,4:e,5:6,6:i,7:3,8:n,9:4,10:r,11:o,12:1,13:2,15:7,16:8,17:s,23:a},{1:[3]},{14:[1,16]},t(l,[2,7]),t(l,[2,8]),t(l,[2,9]),t(l,[2,10]),t(l,[2,11]),t(l,[2,12]),t(l,[2,3]),t(l,[2,4]),t(l,[2,5]),t([14,18,21,22,24],[2,1]),t(l,[2,2]),{3:20,4:e,18:[1,17],19:18,20:19},{3:5,4:e,5:6,6:i,7:3,8:n,9:4,10:r,11:o,13:23,15:7,16:8,17:s,23:a,24:[1,21],25:22},{1:[2,6]},t(l,[2,13]),{18:[1,24],22:[1,25]},t(u,[2,16]),{21:[1,26]},t(l,[2,18]),{22:[1,28],24:[1,27]},t(c,[2,20]),t(l,[2,14]),{3:20,4:e,20:29},{3:5,4:e,5:6,6:i,7:3,8:n,9:4,10:r,11:o,13:30,15:7,16:8,17:s,23:a},t(l,[2,19]),{3:5,4:e,5:6,6:i,7:3,8:n,9:4,10:r,11:o,13:31,15:7,16:8,17:s,23:a},t(u,[2,17]),t(u,[2,15]),t(c,[2,21])],defaultActions:{16:[2,6]},parseError:function(t,e){if(!e.recoverable)throw new Error(t);this.trace(t)},parse:function(t){var e=this,i=[0],n=[null],r=[],o=this.table,s="",a=0,l=0,u=2,c=1,h=r.slice.call(arguments,1),d=Object.create(this.lexer),f={yy:{}};for(var p in this.yy)Object.prototype.hasOwnProperty.call(this.yy,p)&&(f.yy[p]=this.yy[p]);d.setInput(t,f.yy),f.yy.lexer=d,f.yy.parser=this,void 0===d.yylloc&&(d.yylloc={});var m=d.yylloc;r.push(m);var y=d.options&&d.options.ranges;function g(){var t;return"number"!=typeof(t=d.lex()||c)&&(t=e.symbols_[t]||t),t}this.parseError="function"==typeof f.yy.parseError?f.yy.parseError:Object.getPrototypeOf(this).parseError;for(var b,v,w,x,k,M,j,A={};;){if(this.defaultActions[v=i[i.length-1]]?w=this.defaultActions[v]:(null==b&&(b=g()),w=o[v]&&o[v][b]),void 0===w||!w.length||!w[0]){var F="";for(k in j=[],o[v])this.terminals_[k]&&k>u&&j.push("\'"+this.terminals_[k]+"\'");F=d.showPosition?"Parse error on line "+(a+1)+":\\n"+d.showPosition()+"\\nExpecting "+j.join(", ")+", got \'"+(this.terminals_[b]||b)+"\'":"Parse error on line "+(a+1)+": Unexpected "+(b==c?"end of input":"\'"+(this.terminals_[b]||b)+"\'"),this.parseError(F,{text:d.match,token:this.terminals_[b]||b,line:d.yylineno,loc:m,expected:j})}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+v+", token: "+b);switch(w[0]){case 1:i.push(b),n.push(d.yytext),r.push(d.yylloc),i.push(w[1]),b=null,l=d.yyleng,s=d.yytext,a=d.yylineno,m=d.yylloc;break;case 2:if(A.$=n[n.length-(M=this.productions_[w[1]][1])],A.X={first_line:r[r.length-(M||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(M||1)].first_column,last_column:r[r.length-1].last_column},y&&(A.X.range=[r[r.length-(M||1)].range[0],r[r.length-1].range[1]]),void 0!==(x=this.performAction.apply(A,[s,l,a,f.yy,w[1],n,r].concat(h))))return x;M&&(i=i.slice(0,-1*M*2),n=n.slice(0,-1*M),r=r.slice(0,-1*M)),i.push(this.productions_[w[1]][0]),n.push(A.$),r.push(A.X),i.push(o[i[i.length-2]][i[i.length-1]]);break;case 3:return!0}}return!0}};function d(){this.yy={}}return h.lexer={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this.Z=t,this.Y=this.K=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this.Z[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\\r\\n?|\\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this.Z=this.Z.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\\r\\n?|\\n)/g);this.Z=t+this.Z,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var n=this.match.split(/(?:\\r\\n?|\\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===n.length?this.yylloc.first_column:0)+n[n.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this.Y=!0,this},reject:function(){return this.options.backtrack_lexer?(this.K=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this.Z.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\\n"+e+"^"},test_match:function(t,e){var i,n,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,Y:this.Y,Z:this.Z,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),(n=t[0].match(/(?:\\r\\n?|\\n).*/g))&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\\r?\\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this.Y=!1,this.K=!1,this.Z=this.Z.slice(t[0].length),this.matched+=t[0],i=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this.Z&&(this.done=!1),i)return i;if(this.K){for(var o in r)this[o]=r[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,e,i,n;this.Z||(this.done=!0),this.Y||(this.yytext="",this.match="");for(var r=this.tt(),o=0;o<r.length;o++)if((i=this.Z.match(this.rules[r[o]]))&&(!e||i[0].length>e[0].length)){if(e=i,n=o,this.options.backtrack_lexer){if(!1!==(t=this.test_match(i,r[o])))return t;if(this.K){e=!1;continue}return!1}if(!this.options.flex)break}return e?!1!==(t=this.test_match(e,r[n]))&&t:""===this.Z?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},tt:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return(t=this.conditionStack.length-1-Math.abs(t||0))>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,i,n){switch(i){case 0:break;case 1:return 6;case 2:return e.yytext=e.yytext.substr(1,e.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\\.[0-9]+)?([eE][-+]?[0-9]+)?\\b)/,/^(?:"(?:\\\\[\\\\"bfnrt/]|\\\\u[a-fA-F0-9]{4}|[^\\\\\\0-\\x09\\x0a-\\x1f"])*")/,/^(?:\\{)/,/^(?:\\})/,/^(?:\\[)/,/^(?:\\])/,/^(?:,)/,/^(?::)/,/^(?:true\\b)/,/^(?:false\\b)/,/^(?:null\\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}},d.prototype=h,h.Parser=d,new d}();e.parser=i,e.Parser=i.Parser,e.parse=function(){return i.parse.apply(i,arguments)}}));const os={StyleExpression:$o,isExpression:Wo,isExpressionFilter:Zo,createExpression:Jo,createPropertyExpression:Go,normalizePropertyExpression:function(t,e){if(qo(t))return new Bo(t,e);if(Wo(t)){const i=Go(t,e);if("error"===i.result)throw new Error(i.value.map(t=>`${t.key}: ${t.message}`).join(", "));return i.value}{let i=t;return"string"==typeof t&&"color"===e.type&&(i=Yn.parse(t)),{kind:"constant",evaluate:()=>i}}},ZoomConstantExpression:Ho,ZoomDependentExpression:Vo,StylePropertyFunction:Bo},{isExpressionFilter:ss,isExpression:as,createExpression:ls}=os,us={};function cs(t){if(!0===t)return function(){return!0};if(t&&t.condition){if("any"===t.type){const e=t.condition,i=[];for(let t=0;t<e.length;t++)i.push(cs(e[t]));return(t,e)=>{for(let n=0;n<i.length;n++)if(i[n](t,e))return!0;return!1}}const e=cs(t.condition);if(Zi(t.layer))return e;const i=e=>e.layer===t.layer;return(t,n)=>i(t)&&e(t,n)}if(ss(t)){let e=function(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Zo(t)||(t=ts(t));const i=t;let n=!0;try{n=function(t){if(!Yo(t))return t;let e=Xo(t);return function t(e){let i=!1;const n=[];if("case"===e[0]){for(let t=1;t<e.length-1;t+=2)i=i||Yo(e[t]),n.push(e[t+1]);n.push(e[e.length-1])}else if("match"===e[0]){i=i||Yo(e[1]);for(let t=2;t<e.length-1;t+=2)n.push(e[t+1]);n.push(e[e.length-1])}else if("step"===e[0]){i=i||Yo(e[1]);for(let t=1;t<e.length-1;t+=2)n.push(e[t+1])}i&&(e.length=0,e.push("any",...n));for(let i=1;i<e.length;i++)t(e[i])}(e),e=function t(e){if(!Array.isArray(e))return e;const i=function(t){if(Ko.has(t[0]))for(let e=1;e<t.length;e++)if(Yo(t[e]))return!0;return t}(e);return!0===i?i:i.map(e=>t(e))}(e),e}(i)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\\nand paste the contents of this message in the report.\\nThank you!\\nFilter Expression:\\n${JSON.stringify(i,null,2)}\\n        `)}const r=jn["filter_"+e],o=Jo(n,r);let s=null;if("error"===o.result)throw new Error(o.value.map(t=>`${t.key}: ${t.message}`).join(", "));s=(t,e,i)=>o.value.evaluate(t,e,{},i);let a=null,l=null;if(n!==i){const t=Jo(i,r);if("error"===t.result)throw new Error(t.value.map(t=>`${t.key}: ${t.message}`).join(", "));a=(e,i,n,r,o)=>t.value.evaluate(e,i,{},n,void 0,void 0,r,o),l=!Er(t.value.expression)}return s=s,{filter:s,dynamicFilter:a||void 0,needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let i=1;i<e.length;i++)if(t(e[i]))return!0;return!1}(n),needFeature:!!l}}(t);return e=e&&e.filter,(t,i)=>(us.zoom=i,e&&e(us,t))}return Se(t)}const hs={type:"number","property-type":"data-driven",expression:{parameters:["zoom","feature"]}};function ds(t,e){hs.type=e||"number";const i=ls(t,hs);if("success"!==i.result)throw new Error(`Invalid maplibre spec expression: ${JSON.stringify(t)} (${i.value})`);return i.value}function fs(t){return as(t)}const ps={lineWidth:1,lineStrokeWidth:1,lineDx:1,lineDy:1,lineOpacity:1,linePatternAnimSpeed:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerSpacing:1,markerOpacity:1,markerRotation:1,textWrapWidth:1,textSpacing:1,textSize:1,textHaloRadius:1,textHaloOpacity:1,textDx:1,textDy:1,textOpacity:1,textRotation:1,polygonOpacity:1};function ms(t){return ps[t]}const ys={markerPlacement:1,markerFile:1,mergeOnProperty:1,markerTextFit:1,markerType:1,markerHorizontalAlignment:1,markerVerticalAlignment:1,markerRotationAlignment:1,markerPitchAlignment:1,markerFillPatternFile:1,markerLinePatternFile:1,textName:1,textPlacement:1,textFaceName:1,textStyle:1,textHorizontalAlignment:1,textVerticalAlignment:1,textRotationAlignment:1,textPitchAlignment:1,lineJoin:1,lineCap:1,linePatternFile:1,polygonPatternFile:1};function gs(t){return ys[t]?"string":ms(t)?"number":"color"}var bs=Object.freeze({__proto__:null,compileStyle:function(t){return function t(e){if(!Array.isArray(e))return t([e]);const i=[];for(let t=0;t<e.length;t++){let n;n=!0===e[t].filter?function(){return!0}:cs(e[t].filter),i.push(Xi({},e[t],{filter:n}))}return i}(t=t.map(t=>{const e=Xi({},t);return e.filter&&e.filter.value&&(e.filter=e.filter.value),e}))},compileFilter:cs,createExpression:ds,isExpression:fs,isInterpolated:ms,getExpressionType:gs});const vs=[],ws={},xs={},ks={},Ms=[];class js{static isAtlasLoaded(t,e={}){const{iconAtlas:i}=e;return!!(!t||i&&i.positions[t])}static genFnTypes(t){const e={};for(const i in t)if(fs(t[i])){const n=(i+"_Fn_0").trim(),r=(i+"Fn").trim(),o=gs(i);e[n]=ds(t[i],o),e[r]=(t,i)=>{let r;ws.zoom=t,xs.properties=i;try{r=e[n].evaluateWithoutErrorHandling(ws,xs,ks,null,Ms)}catch(t){return null}return r}}else if(on(t[i])){const n=(i+"_Fn_0").trim(),r=(i+"Fn").trim();ms(i)?(e[n]=a(t[i]),e[r]=(t,i)=>{const r=e[n](t,i);return on(r)?a(r)(t,i):r}):(e[n]=l(t[i]),e[r]=(t,i)=>{const r=e[n](t,i);return on(r)?l(r)(t,i):r})}return e}constructor(t,e,i){this.options=i,this.symbolDef=e,this.symbol=u(e,()=>[i.zoom]),this.styledVectors=[],this.properties={},this.et=i.fnTypes||js.genFnTypes(this.symbolDef),on(this.symbolDef.visible)&&(this.it=a(this.symbolDef.visible)),i.atlas&&(this.iconAtlas=i.atlas.iconAtlas,this.glyphAtlas=i.atlas.glyphAtlas),this.features=this.nt(t)}needAltitudeAttribute(){return this.options.forceAltitudeAttribute||this.maxPosZ>=Math.pow(2,17)||this.options.positionType===Float32Array}getPositionFormat(){return this.needAltitudeAttribute()?[{type:Int16Array,width:2,name:"aPosition"},{type:Float32Array,width:1,name:"aAltitude"}]:[{type:Int16Array,width:3,name:"aPosition"}]}fillPosition(t,e,i,n){this.needAltitudeAttribute()?(t.aPosition.push(e,i),t.aAltitude.push(n)):(xn(vs,e,i,n),t.aPosition.push(...vs))}nt(t){if(!t.length)return t;const e="__fea_idx".trim();let i,n=0,r=t[n];for(;!r.geometry;)n++,r=t[n];if(Array.isArray(r.geometry)&&r.properties){let e=r.geometry[0];for(;Array.isArray(e);)e=e[0];e instanceof Ot&&(i=t)}if(!i)if(i=[],Array.isArray(r.geometry))for(let e=0;e<t.length;e++){const n=Xi({},t[e]);i.push(Bi(n))}else for(let n=0;n<t.length;n++){const r=t[n],o=Si(r);for(let t=0;t<o.length;t++){const n=o[t];n[e]=r[e],i.push(n)}}if(this.maxPosZ=0,!this.options.forceAltitudeAttribute){const t="line"===this.symbolDef.textPlacement;let e=0,n=!1;const{textPitchAlignmentFn:r}=this.et;!r&&t&&"map"===this.symbolDef.textPitchAlignment&&(n=!0);for(let o=0;o<i.length;o++){const s=Fs(i[o]&&i[o].geometry);if(s>e&&(e=s),t&&!n&&r&&i[o].properties){const t=r(null,i[o].properties);"map"===t&&(n=t)}}this.hasMapPitchAlign=n,this.maxPosZ=e}const o=this.options.order;if(o){const t=[];for(let e=0;e<o.length;e++)o[e]&&t.push(cs(o[e]));i=i.sort((e,i)=>{const n=t.length;let r=n,o=n;for(let s=0;s<n&&(t[s](e)&&(r=s),t[s](i)&&(o=s),!(r<n&&o<n));s++);return r-o})}return i}load(t=1){const e="__fea_idx".trim(),i="_debug_info".trim(),n=this.et,r=this.styledVectors;this.count=0;const o=this.features;if(!o||!o.length)return Promise.resolve(null);const s={},a={},l={zoom:this.options.zoom},c=u(this.symbolDef,()=>[l.zoom]);let h=0,d=o.length;const f=this.options.debugIndex;try{for(;h<d;h++){const t=o[h];if(!t||!t.geometry)continue;if(void 0!==f&&t[i].index!==f)continue;t.properties||(t.properties={}),t.properties.$layer=t.layer,t.properties.$type=t.type;const u=this.createStyledVector(t,c,n,l,s,a);u&&u.feature.geometry&&(u.featureIdx=void 0===t[e]?h:t[e],this.count++,r.push(u))}}catch(t){return Promise.reject(t)}return this.options.atlas?Promise.resolve(this.pack(t)):this.loadAtlas(s,a).then(()=>this.pack(t))}loadAtlas(t,e){return new Promise((i,n)=>{this.fetchAtlas(t,e,(t,e)=>{if(t)n(t);else{if(e){const{icons:t,glyphs:i}=e;if(t&&Object.keys(t).length){for(const e in t){const i=t[e],{width:n,height:r,data:o}=i.data;i.data=new Li({width:n,height:r},o)}this.iconAtlas=new Ui(t)}if(i&&Object.keys(i).length){for(const t in i){const e=i[t];for(const t in e){const i=e[t],{width:n,height:r,data:o}=i.bitmap;i.bitmap=new Ni({width:n,height:r},o)}}this.glyphAtlas=new Ji(i)}}i({glyphAtlas:this.glyphAtlas,iconAtlas:this.iconAtlas})}})})}fetchAtlas(t,e,i){Object.keys(t).length>0||Object.keys(e).length>0?this.options.requestor(t,e,i):i()}pack(t){if(!this.count)return null;if(null==t)throw new Error("layout scale is undefined");const e=this.createDataPack(this.styledVectors,t);if(!e)return null;e.properties=this.properties,this.empty&&(e.empty=!0);const i=e.buffers;delete e.buffers;const n={data:e,buffers:i};if(this.iconAtlas){const t=n.data.iconAtlas=As(this.iconAtlas);if(t.glyphMap)for(const e in t.glyphMap)i.push(t.glyphMap[e].data.data.buffer);i.push(n.data.iconAtlas.image.data.buffer)}return this.glyphAtlas&&(n.data.glyphAtlas=As(this.glyphAtlas),i.push(n.data.glyphAtlas.image.data.buffer)),n}createStyledVector(t,e,i,n){return new wn(t,e,i,n)}createDataPack(t,e){if(!t||!t.length)return null;this.maxIndex=0,this.maxPos=0,this.maxAltitude=0;const i=this.data={};let n=this.elements=[];const r=this.getFormat(Array.isArray(t[0])?t[0][0].symbol:t[0].symbol),o=this.needAltitudeAttribute()?2:3;for(let t=0;t<r.length;t++)i[r[t].name]=[];let s=[],a=0;const l=[];let u=0,c=!1;for(let n=0,r=t.length;n<r;n++){if(!t[n].feature.geometry)continue;const r=Array.isArray(t[n])?t[n][0].feature.id:t[n].feature.id;Yi(r)&&(Math.abs(r)>u&&(u=Math.abs(r)),r<0&&(c=!0));const h=this.data.aPosition.length;if(Array.isArray(t[n]))for(let i=0;i<t[n].length;i++)this.rt(t[n][i],e);else this.rt(t[n],e);const d=(i.aPosition.length-h)/o;for(let e=0;e<d;e++)s.push(t[n].featureIdx),Yi(r)&&l.push(r);a=Math.max(a,t[n].featureIdx)}if(this.hasElements()&&!n.length)return null;s=new(Gi(a))(s),r[0].type=this.options.positionType?this.options.positionType:Vi(this.maxPos);const h=this.options.center;if(h&&(h[0]||h[1])){const t=i.aPosition;for(let e=0;e<t.length;e+=o)t[e]-=h[0],t[e+1]-=h[1]}const d=function(t,e){const i={};for(let n=0;n<t.length;n++){const r=t[n],o=r.type,s=r.name;i[s]=o===Array?e[s]:new o(e[s])}return i}(r,i);d.aPickingId=s;const f=[];for(const t in d)f.push(d[t].buffer);n=new(Hi(this.maxIndex))(n),f.push(n.buffer);const p={data:d,indices:this.hasElements()?n:null,positionSize:o,buffers:f,symbolIndex:this.symbolDef.index||{index:0}};if(l.length){const t=c?Vi(u):Gi(u);p.featureIds=new t(l),f.push(p.featureIds.buffer)}else p.featureIds=[];return p.feaIdAttrMap=bn(l),p.feaIdIndiceMap=vn(l,p.indices),p}rt(t,e){this.it&&this.it.isZoomConstant&&!this.it(null,t.feature.properties)||this.placeVector(t,e,this.formatWidth)}addElements(...t){this.maxIndex=Math.max(this.maxIndex,...t),this.elements.push(...t)}hasElements(){return!0}getAltitude(t){const{altitudeProperty:e,defaultAltitude:i,altitudeScale:n}=this.options;let r=fn(t,e,i);return n&&(r*=n),this.maxAltitude=Math.max(this.maxAltitude,Math.abs(r)),r}getIconAtlasMaxValue(){const t=this.iconAtlas.positions;let e=0;for(const i in t)if(nn(t,i)){const{tl:n,displaySize:r}=t[i],o=Math.max(n[0],n[1],r[0]-1,r[1]-1);o>e&&(e=o)}return e}}function As(t){let e=t.positions,i=t.image&&t.image.format||"alpha";if(t instanceof Ui){e={};for(const i in t.positions){const n=t.positions[i];e[i]={paddedRect:n.paddedRect,pixelRatio:n.pixelRatio,tl:n.tl,br:n.br,displaySize:n.displaySize}}i="rgba"}const n=t.image;return{image:{width:n.width,height:n.height,data:n.data,format:i},glyphMap:t.glyphMap,positions:e}}function Fs(t){if(!t)return 0;let e=0;if(Array.isArray(t))for(let i=0;i<t.length;i++)if(Array.isArray(t[i])){const n=Fs(t[i]);n>e&&(e=n)}else{const n=Math.abs(t[i].z||0);n>e&&(e=n)}else{const i=Math.abs(t.z||0);i>e&&(e=i)}return e}function Ts(t,e,i,n){const r="__fn_textSize".trim();let o=t.textSize;if(Zi(e.textSize))return[16,16];t[r]&&(o=t[r]);const s=[];return s[0]=tn(o)?o(n,i):o,s[1]=s[0],s}function zs(t){const e=t.stops;let i=-1/0;for(let t=0;t<e.length;t++){let n=e[t][1];Ki(e[t][1])&&(n=zs(e[t][1])),n>i&&(i=n)}return i}function Ss(t,e,i){return[e||"normal",i||"normal","24px",t||"monospace"].join(" ")}const _s=/\\{[\\w-]+(?:\\|[\\w-]+)*\\}/g;function Ps(t,e){return Qi(t)?t.replace(_s,(function(t){if(!e)return"";if((t=t.substring(1,t.length-1)).indexOf("|")>0){const i=t.split("|");for(let t=0;t<i.length;t++){const n=e[i[t]];if(!Zi(n))return n}return""}const i=e[t];return Zi(i)?"":Array.isArray(i)?i.join():i})):t}Object.freeze({__proto__:null,getSDFFont:Ss,resolveText:Ps});const Is=t=>t>=11904&&t<=12031,Os=t=>t>=12032&&t<=12255,Es=t=>t>=12272&&t<=12287,qs=t=>t>=12288&&t<=12351,Rs=t=>t>=12352&&t<=12447,Cs=t=>t>=12448&&t<=12543,Ns=t=>t>=12544&&t<=12591,Ls=t=>t>=12704&&t<=12735,Ds=t=>t>=12736&&t<=12783,Us=t=>t>=12784&&t<=12799,$s=t=>t>=12800&&t<=13055,Ws=t=>t>=13056&&t<=13311,Js=t=>t>=13312&&t<=19903,Hs=t=>t>=19968&&t<=40959,Vs=t=>t>=40960&&t<=42127,Gs=t=>t>=42128&&t<=42191,Bs=t=>t>=63744&&t<=64255,Xs=t=>t>=64336&&t<=65023,Zs=t=>t>=65040&&t<=65055,Ys=t=>t>=65072&&t<=65103,Ks=t=>t>=65104&&t<=65135,Qs=t=>t>=65136&&t<=65279,ta=t=>t>=65280&&t<=65519;function ea(t){return!((t=>t>=1536&&t<=1791)(t)||(t=>t>=1872&&t<=1919)(t)||(t=>t>=2208&&t<=2303)(t)||Xs(t)||Qs(t))}function ia(t){return!!(746===t||747===t||!(t<4352)&&(Ls(t)||Ns(t)||Ys(t)&&!(t>=65097&&t<=65103)||Bs(t)||Ws(t)||Is(t)||Ds(t)||!(!qs(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Js(t)||Hs(t)||$s(t)||(t=>t>=12592&&t<=12687)(t)||(t=>t>=43360&&t<=43391)(t)||(t=>t>=55216&&t<=55295)(t)||(t=>t>=4352&&t<=4607)(t)||(t=>t>=44032&&t<=55215)(t)||Rs(t)||Es(t)||(t=>t>=12688&&t<=12703)(t)||Os(t)||Us(t)||Cs(t)&&12540!==t||!(!ta(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Ks(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(t=>t>=5120&&t<=5759)(t)||(t=>t>=6320&&t<=6399)(t)||Zs(t)||(t=>t>=19904&&t<=19967)(t)||Vs(t)||Gs(t)))}function na(t){return!(ia(t)||function(t){return!!((t=>t>=128&&t<=255)(t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(t=>t>=8192&&t<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(t=>t>=8448&&t<=8527)(t)||(t=>t>=8528&&t<=8591)(t)||(t=>t>=8960&&t<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(t=>t>=9216&&t<=9279)(t)&&9251!==t||(t=>t>=9280&&t<=9311)(t)||(t=>t>=9312&&t<=9471)(t)||(t=>t>=9632&&t<=9727)(t)||(t=>t>=9728&&t<=9983)(t)&&!(t>=9754&&t<=9759)||(t=>t>=11008&&t<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||qs(t)||Cs(t)||(t=>t>=57344&&t<=63743)(t)||Ys(t)||Ks(t)||ta(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function ra(t){return t>=1424&&t<=2303||Xs(t)||Qs(t)}const oa=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]];function sa(t){for(const e of oa)if(t>=e[0]&&t<=e[1])return!0;return!1}const aa={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\\\":"","]":"","^":"",ot:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function la(t,e,i,n,r,o,s,a,l,u){let c=t.trim();2===u&&(c=function(t){let e="";for(let i=0;i<t.length;i++){const n=t.charCodeAt(i+1)||null,r=t.charCodeAt(i-1)||null;e+=n&&na(n)&&!aa[t[i+1]]||r&&na(r)&&!aa[t[i-1]]||!aa[t[i]]?t[i]:aa[t[i]]}return e}(c));const h=[],d={positionedGlyphs:h,text:c,top:a[1],bottom:a[1],left:a[0],right:a[0],writingMode:u};let f;return f=function(t,e){const i=[];let n=0;for(let r=0;r<e.length;r++){const o=e[r];i.push(t.substring(n,o)),n=o}return n<t.length&&i.push(t.substring(n,t.length)),i}(c,function(t,e,i,n){if(!i)return[];if(!t)return[];const r=[],o=function(t,e,i,n){let r=0;for(let i=0;i<t.length;i++){const o=n[t.charCodeAt(i)];o&&(r+=o.metrics.advance+e)}return r/Math.max(1,Math.ceil(r/i))}(t,e,i,n);let s=0;for(let i=0;i<t.length;i++){const l=t.charCodeAt(i),u=n[l];u&&!ua[l]&&(s+=u.metrics.advance+e),i<t.length-1&&(ca[l]||!((a=l)<11904)&&(Ls(a)||Ns(a)||Ys(a)||Bs(a)||Ws(a)||Is(a)||Ds(a)||qs(a)||Js(a)||Hs(a)||$s(a)||ta(a)||Rs(a)||Es(a)||Os(a)||Us(a)||Cs(a)||Zs(a)||Gs(a)||Vs(a)))&&r.push(fa(i+1,s,o,r,da(l,t.charCodeAt(i+1)),!1))}var a;return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(fa(t.length,s,o,r,0,!0))}(c,s,i,e)),function(t,e,i,n,r,o,s,a,l){let u=0,c=8,h=0;const d=t.positionedGlyphs,f="right"===o?1:"left"===o?0:.5;for(let t=0;t<i.length;t++){let r=i[t];if(r=r.trim(),!r.length){c-=n;continue}const o=d.length;for(let t=0;t<r.length;t++){const i=r.charCodeAt(t),n=e[i];n&&(ia(i)&&1!==s?(32!==i&&d.push({glyph:i,x:u,y:0,vertical:!0}),u+=l+a):(32!==i&&d.push({glyph:i,x:u,y:c,vertical:!1}),u+=n.metrics.advance+a))}d.length!==o&&(h=Math.max(u-a,h),ma(d,e,o,d.length-1,f)),u=0,c-=n}const{horizontalAlign:p,verticalAlign:m}=pa(r);!function(t,e,i,n,r,o,s){const a=(e-i)*r,l=-(-n*s+.5)*o;if(a||l)for(let e=0;e<t.length;e++)t[e].x+=a,t[e].y+=l}(d,f,p,m,h,n,i.length);const y=i.length*n;t.top+=-m*y,t.bottom=t.top+y,t.left+=-p*h,t.right=t.left+h}(d,e,f,n,r,o,u,s,l),!!h.length&&d}const ua={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ca={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ha(t,e,i,n){const r=Math.pow(t-e,2);return n?t<e?r/2:2*r:r+Math.abs(i)*i}function da(t,e){let i=0;return 10===t&&(i-=1e4),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function fa(t,e,i,n,r,o){let s=null,a=ha(e,i,r,o);for(let t=0;t<n.length;t++){const l=n[t],u=ha(e-l.x,i,r,o)+l.badness;u<=a&&(s=l,a=u)}return{index:t,x:e,priorBreak:s,badness:a}}function pa(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function ma(t,e,i,n,r){if(!r)return;const o=e[t[n].glyph];if(o){const e=(t[n].x+o.metrics.advance)*r;if(!e)return;for(let r=i;r<=n;r++)t[r].x-=e}}function ya(t){if(!function(t){for(const e of t)if(ra(e.charCodeAt(0)))return!0;return!1}(t))return t;const e=[],i=[],n=[];let r=0,o=0,s=1,a=1;for(const l of t){const t=l.codePointAt(0);sa(t)?(n.push(l),r++):(s=ra(t)?-1:1,a!==s?(o=r,i.length&&(a>0&&i.reverse(),e.push(...i)),n.length&&(e.splice(o,0,...n),n.length=0),a=s,i.length=0):n.length&&(i.push(...n),n.length=0),i.push(l),r++)}return n.length&&i.push(...n),i.length&&(a>0&&i.reverse(),e.push(...i)),e.reverse().join("")}const ga=/\\{ *([\\w_]+) *\\}/g;class ba{constructor(t,e,i,n,r){this.feature=t,this.symbolDef=e,this.symbol=i,this.options=r,this.st=this.lt.bind(this),this.et=n}lt(t,e){return this.feature.properties[e]||"default"}getShape(t,e){if(this.ut)return this.ut;const{textHorizontalAlignmentFn:i,textVerticalAlignmentFn:n,markerHorizontalAlignmentFn:r,markerVerticalAlignmentFn:o,textWrapWidthFn:s}=this.et;let a;const l=this.symbol,u=this.getIconAndGlyph(),c=this.feature.properties;if(u&&u.glyph){const{font:t,text:r}=u.glyph;if(""===r)return null;const o=this.size[0]/24,h=24,d=l.textKeepUpright,f="map"===l.textRotationAlignment&&"line"===l.textPlacement&&!l.isIconText,p=e.glyphMap[t],m=va(i?i(null,c):l.textHorizontalAlignment,n?n(null,c):l.textVerticalAlignment),y=1.2*h,g=function(t){for(let e=0;e<t.length;e++)if(!ea(t.charAt(e).charCodeAt(0)))return!1;return!0}(r),b=g&&l.textLetterSpacing/o||0,v=[l.textDx/o||0,l.textDy/o||0],w=((s?s(null,c):l.textWrapWidth)||10*h)/o;a={},a.horizontal=la(r,p,w,y,m,"center",b,v,h,1),g&&f&&d&&(a.vertical=la(r,p,w,y,m,"center",b,v,h,2))}else if(u&&u.icon){if(!t.positions[u.icon.url])return null;const e=va(r?r(null,c):l.markerHorizontalAlignment,o?o(null,c):l.markerVerticalAlignment);a=function(t,e){const{horizontalAlign:i,verticalAlign:n}=pa(e),r=-24*i,o=-24*n;return{image:t,top:o,bottom:o+24,left:r,right:r+24}}(t.positions[u.icon.url],e),this.size||(this.size=a.image.displaySize)}return this.ut=a,a}getIconAndGlyph(){if(this.iconGlyph)return this.iconGlyph;const{markerFileFn:t,markerTypeFn:e,markerPathFn:i,markerWidthFn:n,markerHeightFn:r,markerFillFn:o,markerFillPatternFileFn:l,markerFillOpacityFn:u,markerTextFitFn:c,markerTextFitPaddingFn:h,markerLineColorFn:d,markerLineWidthFn:f,markerLineOpacityFn:p,markerLineDasharrayFn:m,markerLinePatternFileFn:y,markerPathWidthFn:g,markerPathHeightFn:b,textNameFn:v,textFaceNameFn:w,textStyleFn:x,textWeightFn:k}=this.et,{zoom:M}=this.options,j={},A=this.symbol,F=this.feature.properties,T=t?t(null,F):A.markerFile,z=e?e(null,F):A.markerType,S=T||z||A.markerPath,_=!Zi(this.symbolDef.textName);let P;if(S){P=function(t,e,i,n,r,o){if(Zi(e.markerWidth)&&Zi(e.markerHeight))return null;const s="__fn_markerWidth".trim(),a="__fn_markerHeight".trim();let l=e.markerWidth||0,u=e.markerHeight||0;return Ki(l)&&("identity"!==l.type?l=zs(l):(l=t.markerWidth,t[s]&&(l=t[s](n,i)),Ki(l)&&(l="identity"===l.type?r(n,i):zs(l)))),Ki(u)&&("identity"!==u.type?u=zs(u):(u=t.markerHeight,t[a]&&(u=t[a](n,i)),Ki(u)&&(u="identity"===u.type?o(n,i):zs(u)))),[l,u]}(A,this.symbolDef,F,M,n,r)||[0,0];let t=A.markerTextFit;if(c&&(t=c(M,F)),t&&A.text&&"none"!==t){const e=A.text.textSize;let i=A.text.textName;s(i)&&(i=a(i)(M,F));const n=Ps(i,F);if(n){const i="__fn_textSize".trim(),r="__fn_textSize_0".trim();s(e)&&!A.text[i]&&(A.text[r]=a(e),A.text[i]=(t,e)=>{const i=A.text[r](t,e);return s(i)?a(i)(t,e):i});const o=Ts(A.text,A.text,F,M);if("width"!==t&&"both"!==t||(P[0]=o[0]*n.length),"height"!==t&&"both"!==t||(P[1]=o[1]),o[0]&&o[1]){let t=A.markerTextFitPadding||[0,0,0,0];h&&(t=h(M,F)),P[0]+=t[1]+t[3],P[1]+=t[0]+t[2]}}else P[0]=P[1]=-1}}if(_&&(P=Ts(A,this.symbolDef,F,M)),!P)return j;if(P[0]=Math.ceil(P[0]),P[1]=Math.ceil(P[1]),this.size=P,S&&P[0]>=0&&P[1]>=0){let t;if(z){const e={};if(e.markerType=z,"path"===z&&(e.markerPath=i?i(null,F):A.markerPath,e.markerPathWidth=g?g(null,F):A.markerPathWidth,e.markerPathHeight=b?b(null,F):A.markerPathHeight),n){const t=n(null,F);Zi(t)||(e.markerWidth=t)}else A.markerWidth>=0&&(e.markerWidth=A.markerWidth);if(r){const t=r(null,F);Zi(t)||(e.markerHeight=t)}else A.markerHeight>=0&&(e.markerHeight=A.markerHeight);if(o){const t=o(null,F);Zi(t)||(e.markerFill=t)}else A.markerFill&&(e.markerFill=A.markerFill);if(l){const t=l(null,F);Zi(t)||(e.markerFillPatternFile=t)}else A.markerFillPatternFile&&(e.markerFillPatternFile=A.markerFillPatternFile);if(u){const t=u(null,F);Zi(t)||(e.markerFillOpacity=t)}else A.markerFillOpacity>=0&&(e.markerFillOpacity=A.markerFillOpacity);if(d){const t=d(null,F);Zi(t)||(e.markerLineColor=t)}else A.markerLineColor&&(e.markerLineColor=A.markerLineColor);if(f){const t=f(null,F);Zi(t)||(e.markerLineWidth=t)}else A.markerLineWidth>=0&&(e.markerLineWidth=A.markerLineWidth);if(p){const t=p(null,F);Zi(t)||(e.markerLineOpacity=t)}else A.markerLineOpacity>=0&&(e.markerLineOpacity=A.markerLineOpacity);if(m){const t=m(null,F);Zi(t)||(e.markerLineDasharray=t)}else A.markerLineDasharray&&(e.markerLineDasharray=A.markerLineDasharray);if(y){const t=y(null,F);Zi(t)||(e.markerLinePatternFile=t)}else A.markerLinePatternFile&&(e.markerLinePatternFile=A.markerLinePatternFile);t="vector://"+JSON.stringify(e)}else t=T?T.replace(ga,this.st):A.markerPath?function(t,e,i){if(!t.markerPath)return null;let n=1;const r=function(t){const e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}(t);Yi(t.markerOpacity)&&(n=t.markerOpacity),Yi(t.opacity)&&(n*=t.opacity);const o={};if(r){for(const t in r.stroke)nn(r.stroke,t)&&(Zi(r.stroke[t])||(o[t]=r.stroke[t]));for(const t in r.fill)nn(r.fill,t)&&(Zi(r.fill[t])||(o[t]=r.fill[t]))}const s=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath];let a;const l=[];for(let t=0;t<s.length;t++)a=Qi(s[t])?{path:s[t]}:s[t],a=Xi({},a,o),a.d=a.path,delete a.path,l.push(a);const u=[\'<svg version="1.1"\',\'xmlns="http://www.w3.org/2000/svg"\'];n<1&&u.push(\'opacity="\'+n+\'"\'),t.markerPathWidth&&t.markerPathHeight&&u.push(\'viewBox="0 0 \'+t.markerPathWidth+" "+t.markerPathHeight+\'"\'),u.push(\'preserveAspectRatio="none"\'),e&&u.push(\'width="\'+e+\'"\'),i&&u.push(\'height="\'+i+\'"\'),u.push("><defs></defs>");for(let t=0;t<l.length;t++){let e="<path ";for(const i in l[t])nn(l[t],i)&&(e+=" "+i+\'="\'+l[t][i]+\'"\');e+="></path>",u.push(e)}return u.push("</svg>"),"data:image/svg+xml;base64,"+btoa(u.join(" "))}(A,P[0],P[1]):null;j.icon={url:t,size:P}}if(_){const t=v?v(this.options.zoom,F):A.textName;if(t||0===t){const e=Ss(w?w(null,F):A.textFaceName,x?x(null,F):A.textStyle,k?k(null,F):A.textWeight);let i=Ps(t,F);i&&i.length&&(i=ya(i),j.glyph={font:e,text:i})}}return this.iconGlyph=j,j}}function va(t,e){e&&"middle"!==e||(e="center"),t&&"middle"!==t||(t="center");let i="center"!==e?e:"";return i+="center"!==t?(i.length?"-":"")+t:"",i\n/*!\n     * From mapbox-gl-js\n     * MIT License\n     * https://github.com/mapbox/mapbox-gl-js\n     */}function wa(t,e,i,n,r){const o=[];let s;for(let a=0;a<t.length;a++){const l=t[a];let u,c=!1;for(let t=0;t<l.length-1;t++){let a=l[t],h=l[t+1];a.x<e&&h.x<e||(a.x<e?(s=a,a=new Ot(e,a.y+(e-a.x)/(h.x-a.x)*(h.y-a.y)).P(),a.z=s.z+(e-s.x)/(h.x-s.x)*(h.z-s.z),c=!0):h.x<e&&(s=h,h=new Ot(e,a.y+(e-a.x)/(h.x-a.x)*(h.y-a.y)).P(),h.z=a.z+(e-a.x)/(s.x-a.x)*(s.z-a.z),c=!0),a.y<i&&h.y<i||(a.y<i?(s=a,a=new Ot(a.x+(i-a.y)/(h.y-a.y)*(h.x-a.x),i).P(),a.z=s.z+(i-s.y)/(h.y-s.y)*(h.z-s.z),c=!0):h.y<i&&(s=h,h=new Ot(a.x+(i-a.y)/(h.y-a.y)*(h.x-a.x),i).P(),h.z=a.z+(i-a.y)/(s.y-a.y)*(s.z-a.z),c=!0),a.x>=n&&h.x>=n||(a.x>=n?(s=a,a=new Ot(n,a.y+(n-a.x)/(h.x-a.x)*(h.y-a.y)).P(),a.z=s.z+(n-s.x)/(h.x-s.x)*(h.z-s.z),c=!0):h.x>=n&&(s=h,h=new Ot(n,a.y+(n-a.x)/(h.x-a.x)*(h.y-a.y)).P(),h.z=a.z+(n-a.x)/(s.x-a.x)*(s.z-a.z),c=!0),a.y>=r&&h.y>=r||(a.y>=r?(s=a,a=new Ot(a.x+(r-a.y)/(h.y-a.y)*(h.x-a.x),r).P(),a.z=s.z+(r-s.y)/(h.y-s.y)*(h.z-s.z),c=!0):h.y>=r&&(s=h,h=new Ot(a.x+(r-a.y)/(h.y-a.y)*(h.x-a.x),r).P(),h.z=a.z+(r-a.y)/(s.y-a.y)*(s.z-a.z),c=!0),u&&a.equals(u[u.length-1])||(u=[a],o.push(u)),c&&(u.clipped=!0),u.push(h)))))}}return o}class xa extends Ot{constructor(t,e,i,n){super(t,e),this.angle=i,void 0!==n&&(this.segment=n)}clone(){return new xa(this.x,this.y,this.angle,this.segment)}}\n/*!\n     * From mapbox-gl-js\n     * MIT License\n     * https://github.com/mapbox/mapbox-gl-js\n     */function ka(t,e,i,n,r){if(void 0===e.segment)return!0;let o=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let u=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let o=t[s-1].angleTo(e)-e.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),u+=o;a-l[0].distance>n;)u-=l.shift().angleDelta;if(u>r)return!1;s++,a+=e.dist(i)}return!0}function Ma(t,e,i,n,r,o,s,a,l,u,c){const h=function(t,e,i){return t?.6*e*i:0}(n,o,s),d=function(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}(n,r),f=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-d*s<e/4&&(e=d*s+e/4),function t(e,i,n,r,o,s,a,l,u,c,h){const d=s/2,f=function(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}(e);let p=0,m=i-n,y=[];for(let t=0;t<e.length-1;t++){const i=e[t],a=e[t+1],l=i.dist(a),g=a.angleTo(i);for(;m+n<p+l;){m+=n;const b=(m-p)/l,v=ja(i.x,a.x,b),w=ja(i.y,a.y,b),x=ja(i.z||0,a.z||0,b);if(v>=0&&v<u&&w>=0&&w<u&&m-d>=0&&m+d<=f){const n=new xa(v,w,g,t);n.z=x,c&&(n.axis=[i.y-w,v-i.x],n.angleR=x===(i.z||0)?0:Math.atan(.9*(x-(i.z||0))*h/i.dist(n))),n.line=e,n.P(),r&&!ka(e,n,s,r,o)||y.push(n)}}p+=l}return l||y.length||a||(y=t(e,p/2,n,r,o,s,a,!0,u,c,h)),y}(t,f?e/2*a%e:(d/2+2*o)*s*a%e,e,h,i,d*s,f,!1,l,u,c)}function ja(t,e,i){return t*(1-i)+e*i}function Aa(t,e){const i=t.length;if(i<=1)return[t];const n=[];let r,o;for(let e=0;e<i;e++){const i=hn(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(r&&n.push(r),r=[t[e]]):r.push(t[e]))}if(r&&n.push(r),e>1)for(let t=0;t<n.length;t++)n[t].length<=e||(Le(n[t],e,1,n[t].length-1,Fa),n[t]=n[t].slice(0,e));return n}function Fa(t,e){return e.area-t.area}function Ta(t,e,i){const n=e.distSqr(i);if(0===n)return t.distSqr(e);const r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(r<0?e:r>1?i:i.sub(e).M(r).u(e))}function za(t,e=1,i=!1){let n=1/0,r=1/0,o=-1/0,s=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const e=a[t];(!t||e.x<n)&&(n=e.x),(!t||e.y<r)&&(r=e.y),(!t||e.x>o)&&(o=e.x),(!t||e.y>s)&&(s=e.y)}const l=Math.min(o-n,s-r);let u=l/2;const c=new We(null,Sa);if(0===l)return new Ot(n,r);for(let e=n;e<o;e+=l)for(let i=r;i<s;i+=l)c.push(new _a(e+u,i+u,u,t));let h=function(t){let e=0,i=0,n=0;const r=t[0];for(let t=0,o=r.length,s=o-1;t<o;s=t++){const o=r[t],a=r[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,n+=(o.y+a.y)*l,e+=3*l}return new _a(i/e,n/e,0,t)}(t),d=c.length;for(;c.length;){const n=c.pop();(n.d>h.d||!h.d)&&(h=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,d)),n.max-h.d<=e||(u=n.h/2,c.push(new _a(n.p.x-u,n.p.y-u,u,t)),c.push(new _a(n.p.x+u,n.p.y-u,u,t)),c.push(new _a(n.p.x-u,n.p.y+u,u,t)),c.push(new _a(n.p.x+u,n.p.y+u,u,t)),d+=4)}return i&&(console.log("num probes: "+d),console.log("best distance: "+h.d)),h.p}function Sa(t,e){return e.max-t.max}function _a(t,e,i,n){this.p=new Ot(t,e),this.h=i,this.d=function(t,e){let i=!1,n=1/0;for(let r=0;r<e.length;r++){const o=e[r];for(let e=0,r=o.length,s=r-1;e<r;s=e++){const r=o[e],a=o[s];r.y>t.y!=a.y>t.y&&t.x<(a.x-r.x)*(t.y-r.y)/(a.y-r.y)+r.x&&(i=!i),n=Math.min(n,Ta(t,r,a))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const Pa=45*Math.PI/100;function Ia(t,e,i,n,r,o,s,a,l){const{feature:u,size:c,symbol:h}=t,d=c?24:0,f=n*(c?c[0]/d:1),p=[];if("line"===o){let t=u.geometry;r&&(t=wa(u.geometry,0,0,r,r));for(let n=0;n<t.length;n++){const o=Ma(t[n],s,Pa,h.isIconText?null:i.vertical||i.horizontal||i,null,d,h.isIconText?1:f,1,r||1/0,a,l);if(h.textPlacement&&!h.isIconText)for(let t=0;t<o.length;t++)o[t].startIndex=e.length/3;if(p.push.apply(p,o),h.textPlacement&&!h.isIconText)for(let i=0;i<t[n].length;i++)e.push(t[n][i].x,t[n][i].y,t[n][i].z||0)}}else if(3===u.type){const t=Aa(u.geometry,0);for(let e=0;e<t.length;e++){const i=t[e];if("vertex"===o)for(let t=0;t<i.length;t++){const e=i[t];for(let t=0;t<e.length;t++)mn(e[t],r)||p.push(e[t])}else{const t=za(i,16);mn(t,r)||p.push(t)}}}else if(2===u.type)for(let t=0;t<u.geometry.length;t++){const e=u.geometry[t];if("vertex"===o)for(let t=0;t<e.length;t++)mn(e[t],r)||p.push(e[t]);else mn(e[0],r)||p.push(e[0])}else if(1===u.type)for(let t=0;t<u.geometry.length;t++){const e=u.geometry[t];for(let t=0;t<e.length;t++){const i=e[t];mn(i,r)||p.push(i)}}return p}function Oa(t,e){const i={},n={},r=[];let o=0;function s(e){r.push(t[e]),o++}function a(t,e,i){const o=n[t];return delete n[t],n[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function l(t,e,n){const o=i[e];return delete i[e],i[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function u(t,e,i){const n=i?e[0][e[0].length-1]:e[0][0];return`${t}:${n.x}:${n.y}`}for(let c=0;c<t.length;c++){const h=t[c],d=h.geometry;if(!d)continue;const f=h.properties[e]?h.properties[e].toString():null;if(!f){s(c);continue}const p=u(f,d),m=u(f,d,!0);if(p in n&&m in i&&n[p]!==i[m]){const t=l(p,m,d),e=a(p,m,r[t].geometry);delete i[p],delete n[m],n[u(f,r[e].geometry,!0)]=e,r[t].geometry=null}else p in n?a(p,m,d):m in i?l(p,m,d):(s(c),i[p]=o-1,n[m]=o-1)}return r.filter(t=>t.geometry)}class Ea extends js{static needMerge(t,e,i){if(!t)return!1;let n="line"===t.textPlacement||"line"===t.markerPlacement;return n||(e.textPlacementFn&&(n="line"===e.textPlacementFn(i)),e.markerPlacementFn&&(n="line"===e.markerPlacementFn(i))),t.mergeOnProperty&&n}static mergeLineFeatures(t,e,i,n){const r="__index".trim();let o=e.textPlacement,s=e.markerPlacement;i.textPlacementFn&&(o=i.textPlacementFn(n)),i.markerPlacementFn&&(s=i.markerPlacementFn(n));const a=function(t,e,i,n,r){const o="__index".trim(),s=js.genFnTypes(e),{mergeOnPropertyFn:a}=s;if(!e.mergeOnProperty||"line"!==n&&"line"!==i)return[];if(!(yn(l=e.mergeOnProperty)||"string"!=typeof l&&(null===l.constructor||l.constructor!==String)||"line"!==n&&"line"!==i))return[{features:t,property:e.mergeOnProperty}];var l;const u=[],c={},h=[];for(let s=0;s<t.length;s++){t[s][o]=s;const l=t[s].properties=t[s].properties||{};l.$layer=t[s].layer,l.$type=t[s].type;let d=i;"line"!==d&&(d=n);const f=a?a(r,l):e.mergeOnProperty;"line"!==d||yn(f)?h.push(t[s]):(void 0===c[f]&&(c[f]=u.length,u.push({features:[],property:f})),u[c[f]].features.push(t[s]))}return h.length&&u.push({features:h}),u}(t,e,s,o,n);if(a.length){const e=[];for(let i=0;i<a.length;i++)e.push(a[i].property?Oa(a[i].features,a[i].property):t);if(1===e.length)return e[0];{let t=[];for(let i=0;i<e.length;i++)t=t.concat(e[i]);return t.sort((t,e)=>t[r]-e[r]),t}}}static splitPointSymbol(t,e=0){const i=[];if(Array.isArray(t)){const e=t;for(let t=0;t<e.length;t++)e[t]&&i.push(...Ea.splitPointSymbol(e[t],t));return i}let n=null,r=null;for(const e in t)0===e.indexOf("marker")?(n=n||{},n[e]=t[e]):0===e.indexOf("text")&&(r=r||{},r[e]=t[e]);return n&&(n.isIconText=!0,t.mergeOnProperty&&(n.mergeOnProperty=t.mergeOnProperty),i.push(n)),r&&(n&&(r.textPlacement=n.markerPlacement,r.textSpacing=n.markerSpacing,r.isIconText=!0),t.mergeOnProperty&&(r.mergeOnProperty=t.mergeOnProperty),i.push(r)),void 0!==t.visible&&(n&&(n.visible=t.visible),r&&(r.visible=t.visible)),n&&(n.markerTextFit&&r&&(n.text={},n.text.textName=r.textName,n.text.textSize=r.textSize),n.index={index:e,type:0}),r&&(r.index={index:e,type:1}),i}static isAtlasLoaded(t,e){const{icon:i,glyph:n}=t,{iconAtlas:r,glyphAtlas:o}=e;if(i&&(!r||!r.positions[i.url]))return!1;if(n){if(!o||!o.positions[n.font])return!1;const t=o.positions[n.font],{text:e}=n;for(let i=0;i<e.length;i++)if(!t[e.charCodeAt(i)])return!1}return!0}constructor(t,e,i){super(t,e,i),this.ct=e.textPlacement,this.et.textPlacementFn&&(this.ct=this.et.textPlacementFn(this.options.zoom))}createStyledVector(t,e,i,n,r,o){const s=new ba(t,this.symbolDef,e,i,n),a=s.getIconAndGlyph();if(a.icon&&!this.options.atlas){const{url:t,size:e}=a.icon;r[t]||(r[t]=a.icon.size),r[t][0]<e[0]&&(r[t][0]=e[0]),r[t][1]<e[1]&&(r[t][1]=e[1])}if(a.glyph&&!this.options.atlas){const{font:t,text:e}=a.glyph,i=o[t]=o[t]||{};for(let t=0;t<e.length;t++)i[e.charCodeAt(t)]=1;"line"===this.ct&&(o.options={isCharsCompact:!1})}return this.options.allowEmptyPack||a.icon||a.glyph?s:null}getFormat(t){const e=void 0!==t.textName,i=e?this.getPackSDFFormat(t):this.getPackMarkerFormat();e?i.push(...this.ht()):i.push(...this.dt());const{markerOpacityFn:n,textOpacityFn:r,markerPitchAlignmentFn:o,textPitchAlignmentFn:s,markerRotationAlignmentFn:a,textRotationAlignmentFn:l,markerRotationFn:u,textRotationFn:c,markerAllowOverlapFn:h,textAllowOverlapFn:d,markerIgnorePlacementFn:f,textIgnorePlacementFn:p}=this.et;return(n||r)&&i.push({type:Uint8Array,width:1,name:"aColorOpacity"}),(o||s)&&i.push({type:Uint8Array,width:1,name:"aPitchAlign"}),(a||l)&&i.push({type:Uint8Array,width:1,name:"aRotationAlign"}),(u||c)&&i.push({type:Uint16Array,width:1,name:"aRotation"}),(h||d||f||p)&&i.push({type:Uint8Array,width:1,name:"aOverlap"}),i}ft(){return this.hasMapPitchAlign}ht(){const{textFillFn:t,textSizeFn:e,textHaloFillFn:i,textHaloRadiusFn:n,textHaloOpacityFn:r,textDxFn:o,textDyFn:s}=this.et,a=[];return t&&a.push({type:Uint8Array,width:4,name:"aTextFill"}),e&&a.push({type:Uint8Array,width:1,name:"aTextSize"}),i&&a.push({type:Uint8Array,width:4,name:"aTextHaloFill"}),n&&a.push({type:Uint8Array,width:1,name:"aTextHaloRadius"}),r&&a.push({type:Uint8Array,width:1,name:"aTextHaloOpacity"}),o&&a.push({type:Int8Array,width:1,name:"aTextDx"}),s&&a.push({type:Int8Array,width:1,name:"aTextDy"}),a}dt(){const{markerWidthFn:t,markerHeightFn:e,markerDxFn:i,markerDyFn:n}=this.et,r=[];return t&&r.push({type:Uint8Array,width:1,name:"aMarkerWidth"}),e&&r.push({type:Uint8Array,width:1,name:"aMarkerHeight"}),i&&r.push({type:Int8Array,width:1,name:"aMarkerDx"}),n&&r.push({type:Int8Array,width:1,name:"aMarkerDy"}),r}createDataPack(){if(!this.iconAtlas&&!this.glyphAtlas){if(!this.options.allowEmptyPack)return null;this.empty=!0}this.lineVertex=[];const t=super.createDataPack.apply(this,arguments);return t?(t.lineVertex=new Int16Array(this.lineVertex),t.buffers.push(t.lineVertex.buffer),t):null}placeVector(t,e){const i=t.getShape(this.iconAtlas,this.glyphAtlas);if(!this.options.allowEmptyPack&&!i)return;const n=this.pt(t,i,e);if(0===n.length)return;const r=this.data,o=this.needAltitudeAttribute()?2:3;let a=this.data.aPosition.length/o;const l=t.symbol,u=t.feature.properties,c="line"===this.ct&&!l.isIconText,h=void 0!==l.textName,d=h&&c&&function(t){let e=0;for(let i=0;i<t.length;i++)if(ia(t.charAt(i).charCodeAt(0)))e=0;else if(e++,e>=1)return!1;return!0}(t.getIconAndGlyph().glyph.text)?1:0,{textFillFn:f,textSizeFn:p,textHaloFillFn:m,textHaloRadiusFn:y,textHaloOpacityFn:g,textDxFn:b,textDyFn:v,textPitchAlignmentFn:w,textRotationAlignmentFn:x,textRotationFn:k,textAllowOverlapFn:M,textIgnorePlacementFn:j,textOpacityFn:A,markerWidthFn:F,markerHeightFn:T,markerDxFn:z,markerDyFn:S,markerPitchAlignmentFn:_,markerRotationAlignmentFn:P,markerRotationFn:I,markerAllowOverlapFn:O,markerIgnorePlacementFn:E,markerOpacityFn:q}=this.et;let R,C,N,L,D,U,$,W,J,H,V,G,B,X,Z,Y,K;if(h){const e=t.getIconAndGlyph().glyph.font;R=function(t,e,i){const n=t.positionedGlyphs,r=[];for(let o=0;o<n.length;o++){const s=n[o],a=i[s.glyph];if(!a)continue;const l=a.rect;if(!l)continue;const u=4,c=a.metrics.advance/2,h=a.metrics.height/2,d=e?[s.x+c,0]:[0,0],f=e?[0,s.y-h]:[s.x+c,s.y-h],p=a.metrics.left-u-c+f[0],m=a.metrics.top-u+f[1],y=p+l.w,g=m+l.h,b=new Ot(p,m),v=new Ot(y,m),w=new Ot(p,g),x=new Ot(y,g);if(e&&s.vertical){const t=new Ot(-c,c),e=-Math.PI/2,i=new Ot(5,0);b.F(e,t).u(i),v.F(e,t).u(i),w.F(e,t).u(i),x.F(e,t).u(i)}r.push({tl:b,tr:v,bl:w,br:x,tex:l,writingMode:t.writingMode,glyphOffset:d})}return r}(i.horizontal,c,this.glyphAtlas.positions[e]),f&&(C=f(null,u),C=s(C)?[0,0,0,0]:un([],C)),p&&(N=p(this.options.zoom,u),yn(N)&&(N=14)),m&&(L=m(null,u),L=un([],L)),y&&(D=y(null,u)),g&&(U=255*g(null,u)),b&&($=b(null,u)||0),v&&(W=v(null,u)||0),w&&(B=+("map"===w(null,u))),x&&(X=+("map"===x(null,u))),k&&(Z=gn(k(null,u),0,360)*Math.PI/180)}else R=i?function(t){const e=t.image,i=t.top-1/e.pixelRatio,n=t.left-1/e.pixelRatio,r=t.bottom+1/e.pixelRatio,o=t.right+1/e.pixelRatio;let s,a,l,u;return s=new Ot(n,i),a=new Ot(o,i),l=new Ot(o,r),u=new Ot(n,r),[{tl:s,tr:a,bl:u,br:l,tex:{x:e.tl[0],y:e.tl[1],w:e.displaySize[0],h:e.displaySize[1]},writingMode:void 0,glyphOffset:[0,0]}]}(i):function(){const t=new Ot(0,0),e=new Ot(0,0),i=new Ot(0,0);return[{tl:t,tr:e,bl:new Ot(0,0),br:i,tex:{x:0,y:0,w:0,h:0},writingMode:void 0,glyphOffset:[0,0]}]}(),F&&(J=F(null,u)),T&&(H=T(null,u)),z&&(V=z(null,u)),S&&(G=S(null,u)),_&&(B=+("map"===_(null,u))),P&&(X=+("map"===P(null,u))),I&&(Z=gn(I(null,u),0,360)*Math.PI/180);const Q=O||M;Q&&(Y=Q(null,u)||0);const tt=E||j;let et;tt&&(K=tt(null,u)||0);const it=A||q;it&&(et=255*it(this.options.zoom,u));const nt=this.options.EXTENT,rt=R.length;for(let t=0;t<n.length;t++){const e=n[t],i=e.z||0;if(nt!==1/0&&mn(e,nt))continue;const o=e.x,s=e.y,l=R.length;for(let t=0;t<l;t++){const n=R[t],{tl:l,tr:u,bl:f,br:p,tex:m}=n;this.yt(r,o,s,i,10*l.x,10*l.y,m.x,m.y+m.h),h&&this.gt(r,c,rt,n.glyphOffset,e,d,e.axis,e.angleR),this.bt(r,C,N,L,D,U,$,W,J,H,V,G,et,B,X,Z,Y,K),this.yt(r,o,s,i,10*u.x,10*u.y,m.x+m.w,m.y+m.h),h&&this.gt(r,c,rt,n.glyphOffset,e,d,e.axis,e.angleR),this.bt(r,C,N,L,D,U,$,W,J,H,V,G,et,B,X,Z,Y,K),this.yt(r,o,s,i,10*f.x,10*f.y,m.x,m.y),h&&this.gt(r,c,rt,n.glyphOffset,e,d,e.axis,e.angleR),this.bt(r,C,N,L,D,U,$,W,J,H,V,G,et,B,X,Z,Y,K),this.yt(r,o,s,i,10*p.x,10*p.y,m.x+m.w,m.y),h&&this.gt(r,c,rt,n.glyphOffset,e,d,e.axis,e.angleR),this.bt(r,C,N,L,D,U,$,W,J,H,V,G,et,B,X,Z,Y,K),this.addElements(a,a+1,a+2),this.addElements(a+1,a+2,a+3),a+=4;const y=Math.max(Math.abs(o),Math.abs(s),Math.abs(i));y>this.maxPos&&(this.maxPos=y)}}}yt(t,e,i,n,r,o,s,a){this.fillPosition(t,e,i,n),t.aShape.push(r,o),t.aTexCoord.push(s,a)}gt(t,e,i,n,r,o,s,a){if(t.aCount.push(i),e){t.aGlyphOffset.push(n[0],n[1]),this.ft()&&t.aPitchRotation.push(s[0],s[1],a);const e=r.startIndex;t.aSegment.push(r.segment+e,e,r.line.length),t.aVertical.push(o)}}bt(t,e,i,n,r,o,s,a,l,u,c,h,d,f,p,m,y,g){const{textFillFn:b,textSizeFn:v,textHaloFillFn:w,textHaloRadiusFn:x,textHaloOpacityFn:k,textDxFn:M,textDyFn:j,textPitchAlignmentFn:A,textRotationAlignmentFn:F,textRotationFn:T,textAllowOverlapFn:z,textIgnorePlacementFn:S,textOpacityFn:_,markerWidthFn:P,markerHeightFn:I,markerDxFn:O,markerDyFn:E,markerPitchAlignmentFn:q,markerRotationAlignmentFn:R,markerRotationFn:C,markerAllowOverlapFn:N,markerIgnorePlacementFn:L,markerOpacityFn:D}=this.et;b&&t.aTextFill.push(...e),v&&t.aTextSize.push(i),w&&t.aTextHaloFill.push(...n),x&&t.aTextHaloRadius.push(r),k&&t.aTextHaloOpacity.push(o),M&&t.aTextDx.push(s),j&&t.aTextDy.push(a),P&&t.aMarkerWidth.push(l),I&&t.aMarkerHeight.push(u),O&&t.aMarkerDx.push(c),E&&t.aMarkerDy.push(h),(D||_)&&t.aColorOpacity.push(d),(A||q)&&t.aPitchAlign.push(f),(R||F)&&t.aRotationAlign.push(p),(C||T)&&t.aRotation.push(9362*m);const U=N||z,$=L||S;(U||$)&&t.aOverlap.push((U?8:0)+4*y+(($?2:0)+g)),r>0&&(this.properties.hasHalo=1)}pt(t,e,i){const{feature:n,symbol:r}=t,o=this.vt(t,r),s=n.properties,{markerSpacingFn:a,textSpacingFn:l}=this.et,u=((a?a(null,s):r.markerSpacing)||(l?l(null,s):r.textSpacing)||250)*i,c=this.options.altitudeToTileScale;return Ia(t,this.lineVertex,e,i,this.options.EXTENT,o,u,this.ft(),c)}vt(t,e){return this.et.markerPlacementFn?this.et.markerPlacementFn(this.options.zoom,t.feature.properties):e.markerPlacement||this.ct}getPackSDFFormat(t){if("line"!==this.ct||t.isIconText)return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"}];{const t=[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"},{type:Int16Array,width:2,name:"aGlyphOffset"},{type:Uint16Array,width:3,name:"aSegment"},{type:Uint8Array,width:1,name:"aVertical"}];return this.ft()&&t.push({type:Float32Array,width:3,name:"aPitchRotation"}),t}}getPackMarkerFormat(){return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"}]}}class qa{constructor(t){this.x=t.x,this.y=t.y,this.z=t.z||0}clone(){return new qa(this)}S(){return this.j(this.mag()),this}j(t){return this.x/=t,this.y/=t,this.z/=t,this}_(){var t=this.y;return this.y=this.x,this.x=-t,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}add(t){return this.clone().u(t)}sub(t){return this.clone().m(t)}u(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}m(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}mult(t){return this.clone().M(t)}M(t){return this.x*=t,this.y*=t,this.z*=t,this}dist(t){return Math.sqrt(this.distSqr(t))}distSqr(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return e*e+i*i+n*n}P(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}}const Ra=Math.cos(Math.PI/180*37.5),Ca=Math.pow(2,16)/1,Na=new Ot,La=new Ot,Da=new Ot;class Ua extends js{constructor(t,e,i){super(t,e,i);let n=!1;const{lineDasharrayFn:r,lineDashColorFn:o}=this.et;this.hasGradient=this.symbol.lineGradientProperty,r&&(n=function(t,e,i){for(let n=0;n<t.length;n++)if(i(e,t[n].properties))return!0;return!1}(t,this.options.zoom,r),n&&(this.dasharrayFn=r)),this.hasDasharray=Ja(this.symbol.lineDasharray)||n,this.hasDasharray&&o&&(this.dashColorFn=o)}createStyledVector(t,e,i,n,r){const o=new wn(t,e,i,n),s=o.getLineResource();return!this.options.atlas&&s&&(r[s]=[0,0]),o}getFormat(){const{lineWidthFn:t,lineStrokeWidthFn:e,lineStrokeColorFn:i,lineColorFn:n,lineOpacityFn:r,lineDxFn:o,lineDyFn:s,linePatternAnimSpeedFn:a,linePatternGapFn:l}=this.et,u=[...this.getPositionFormat()];if(u.push(this.iconAtlas||this.hasDasharray?{type:Int8Array,width:3,name:"aExtrude"}:{type:Int8Array,width:2,name:"aExtrude"}),u.push({type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}),t&&u.push({type:Uint8Array,width:1,name:"aLineWidth"}),e&&u.push({type:Uint8Array,width:1,name:"aLineStrokeWidth"}),n&&u.push({type:Uint8Array,width:4,name:"aColor"}),i&&u.push({type:Uint8Array,width:4,name:"aStrokeColor"}),r&&u.push({type:Uint8Array,width:1,name:"aOpacity"}),this.dasharrayFn&&u.push({type:Uint8Array,width:4,name:"aDasharray"}),this.dashColorFn&&u.push({type:Uint8Array,width:4,name:"aDashColor"}),this.iconAtlas){const t=this.getIconAtlasMaxValue();u.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return(o||s)&&u.push({type:Int8Array,width:2,name:"aLineDxDy"}),(a||l)&&u.push({type:Int8Array,width:2,name:"aLinePattern"}),u}placeVector(t){const{lineJoinFn:e,lineCapFn:i,lineWidthFn:n,lineHeightFn:r,lineStrokeWidthFn:o,lineStrokeColorFn:a,lineColorFn:l,lineOpacityFn:u,lineDxFn:c,lineDyFn:h,linePatternAnimSpeedFn:d,linePatternGapFn:f}=this.et,p=this.symbol,m=t.feature,y=m.properties;let g=p.lineJoin||"miter",b=p.lineCap||"butt";if(e&&(g=e(this.options.zoom,y)||"miter"),i&&(b=i(this.options.zoom,y)||"butt"),n){let t=n(this.options.zoom,y);Zi(t)&&(t=4),this.feaLineWidth=+t}else this.feaLineWidth=+p.lineWidth;if(r){let t=r(this.options.zoom,y);Zi(t)&&(t=this.feaLineWidth),this.feaLineHeight=+t}else this.feaLineHeight=+p.lineHeight||this.feaLineWidth;if(o){let t=o(this.options.zoom,y);Zi(t)&&(t=0),this.feaLineStrokeWidth=t}else this.feaLineStrokeWidth=p.lineStrokeWidth||0;if(l&&(this.feaColor=l(this.options.zoom,y)||[255,255,255,255],this.feaColor=s(this.feaColor)?[0,0,0,0]:un([],this.feaColor)),a&&(this.feaStrokeColor=a(this.options.zoom,y)||[0,0,0,255],this.feaStrokeColor=s(this.feaStrokeColor)?[0,0,0,0]:un([],this.feaStrokeColor)),u){let t=u(this.options.zoom,y);Zi(t)&&(t=1),this.feaOpacity=255*t}if(this.dasharrayFn){let t=this.dasharrayFn(this.options.zoom,y)||[0,0,0,0];if(t.length<4){const e=t;1===t.length?t=[e[0],e[0],e[0],e[0]]:2===t.length?t=[e[0],e[1],e[0],e[1]]:3===t.length&&(t=[e[0],e[1],e[2],e[2]])}this.feaDash=t}if(this.dashColorFn){let t=(this.dashColorFn?this.dashColorFn(this.options.zoom,y):this.symbol.lineDashColor)||[0,0,0,0];t=un([],t),this.feaDashColor=t}if(this.iconAtlas){const e=t.getLineResource(),i=this.iconAtlas.glyphMap[e];if(this.feaTexInfo=this.feaTexInfo||[0,0,0,0],i){const{tl:t,displaySize:i}=this.iconAtlas.positions[e];this.feaTexInfo[0]=t[0]+1,this.feaTexInfo[1]=t[1]+1,this.feaTexInfo[2]=i[0]-3,this.feaTexInfo[3]=i[1]-3}else this.feaTexInfo[0]=this.feaTexInfo[1]=this.feaTexInfo[2]=this.feaTexInfo[3]=0}if(c){let t=c(this.options.zoom,y);Zi(t)&&(t=0),this.feaLineDx=t}if(h){let t=h(this.options.zoom,y);Zi(t)&&(t=0),this.feaLineDy=t}if(d){let t=d(this.options.zoom,y);Zi(t)&&(t=0),0!==t&&(this.properties.hasPatternAnim=1),this.feaPatternAnimSpeed=t}if(f){let t=f(this.options.zoom,y);Zi(t)&&(t=0),this.feaLinePatternGap=t}const v=this.options.EXTENT;let w=m.geometry;if(v!==1/0){w=[];const t=[];for(let e=0;e<m.geometry.length;e++){t[0]=m.geometry[e];const i=wa(t,-1,-1,v+1,v+1);if(3===m.type&&i.length>1){const t=i[0],e=i[i.length-1];t[0].equals(e[e.length-1])&&(i[0]=e.concat(t.slice(1)),i.length=i.length-1)}w.push(...i)}}const x=this.needAltitudeAttribute()?2:3;for(let t=0;t<w.length;t++)this.offset=this.data.aPosition.length/x,this.wt(w[t],m,g,b,2,1.05)}xt(){return this.iconAtlas&&this.feaTexInfo[2]&&this.feaTexInfo[3]}wt(t,e,i,n,r,o){const s=this.xt()||Ja(this.feaDash)||Ja(this.symbol.lineDasharray),a=this.options.isTube;a&&(t=t.map(t=>new qa(t))),this.overscaling=1;const l=this.options.EXTENT;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.prevVertex=null,this.symbol.lineGradientProperty&&e.properties&&nn(e.properties,"mapbox_clip_start")&&nn(e.properties,"mapbox_clip_end")){this.clipStart=+e.properties.mapbox_clip_start,this.clipEnd=+e.properties.mapbox_clip_end;for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance()}const u=3===e.type&&!t.clipped;let c=t.length;for(;c>=2&&t[c-1].equals(t[c-2]);)c--;let h=0;for(;h<c-1&&t[h].equals(t[h+1]);)h++;if(c<(u?3:2))return;"bevel"===i&&(r=1.05);const d=this.overscaling<=16?15*l/(512*this.overscaling):0,f={vertexLength:0,primitiveLength:0,currentNormal:null};let p,m,y,g,b;this.e1=this.e2=-1,u&&(p=t[c-2],b=t[h].sub(p).S()._());for(let e=h;e<c;e++){if(y=e===c-1?u?t[h+1]:void 0:t[e+1],y&&t[e].equals(y))continue;b&&(g=b),p&&(m=p),p=t[e],b=y?y.sub(p).S()._():g,f.dir=m?p.sub(m).S():y.sub(p).S(),g=g||b,f.currentNormal=g;let l=g.add(b);0===l.x&&0===l.y||l.S();const v=g.x*b.x+g.y*b.y,w=l.x*b.x+l.y*b.y,x=0!==w?1/w:1/0,k=2*Math.sqrt(2-2*w),M=w<Ra&&m&&y,j=g.x*b.y-g.y*b.x>0;if(!a&&M&&e>h){const t=p.dist(m);if(t>2*d){const e=p.sub(p.sub(m).M(d/t).P());e.z=p.z,this.updateDistance(m,e),this.addCurrentVertex(e,g,0,0,f),m=e}}const A=m&&y;f.middleVertex=A;let F=A?i:u?"butt":n;if(A&&"round"===F&&(x<o?F="miter":x<=2&&(F="fakeround")),"miter"===F&&x>r&&!a&&(F="bevel"),"bevel"===F&&(x>2&&(F="flipbevel"),x<r&&(F="miter")),m&&this.updateDistance(m,p),"miter"===F)a?(this.addCurrentVertex(p,g,0,0,f),f.dir=y.sub(p).S(),this.addCurrentVertex(p,b,0,0,f)):(l.M(x),this.addCurrentVertex(p,l,0,0,f),s&&(f.currentNormal=b,this.addCurrentVertex(p,l,0,0,f)));else if("flipbevel"===F){if(x>100)l=b.mult(-1);else{const t=x*g.add(b).mag()/g.sub(b).mag();l._().M(t*(j?-1:1))}this.addCurrentVertex(p,l,0,0,f),this.addCurrentVertex(p,l.mult(-1),0,0,f)}else if("bevel"===F||"fakeround"===F){const t=-Math.sqrt(x*x-1),e=j?t:0,i=j?0:t;if(m&&this.addCurrentVertex(p,g,e,i,f),"fakeround"===F){const t=Math.round(180*k/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*t*t+(.848013+v*(.215638*v-1.06021)))}const n=b.sub(g).M(i).u(g).S().M(j?-1:1);this.addHalfVertex(p,n.x,n.y,!1,j,0,f)}}y&&(f.currentNormal=b,this.addCurrentVertex(p,b,-e,-i,f))}else if("butt"===F)this.addCurrentVertex(p,l,0,0,f);else if("square"===F){const t=m?1:-1;this.addCurrentVertex(p,l,t,t,f)}else"round"===F&&(m&&(this.addCurrentVertex(p,g,0,0,f),this.addCurrentVertex(p,g,1,1,f,!0)),y&&(this.addCurrentVertex(p,b,-1,-1,f,!0),this.addCurrentVertex(p,b,0,0,f)));if(!a&&M&&e<c-1){const t=p.dist(y);if(t>2*d){const e=p.add(y.sub(p).M(d/t).P());e.z=p.z,this.updateDistance(p,e),this.addCurrentVertex(e,b,0,0,f),p=e}}}}addCurrentVertex(t,e,i,n,r,o=!1){const s=e.x+e.y*i,a=e.y-e.x*i,l=e.y*n-e.x,u=-e.y-e.x*n;let c=0,h=0;if(r.middleVertex){Na.x=s,Na.y=a,La.x=l,La.y=u;const t=r.currentNormal;if(c=Ga(t,Na),0===i&&0===n)h=-c;else{const e=Da;e.x=t.x,e.y=t.y,e.M(-1),h=Ga(e,La)}}this.addHalfVertex(t,s,a,o,!1,i,r,c),this.addHalfVertex(t,l,u,o,!0,-n,r,h),this.prevVertex&&t.equals(this.prevVertex)||(this.prevVertex=t),this.distance>Ca/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,e,i,n,r,o))}addHalfVertex({x:t,y:e,z:i},n,r,o,s,a,l,u){this.fillData(this.data,t,e,i||0,n,r,o,s,1*this.scaledDistance,u);const c=l.vertexLength++;this.e1>=0&&this.e2>=0&&(this.addElements(this.e1,this.e2,c),l.primitiveLength++),s?this.e2=c:this.e1=c}fillData(t,e,i,n,r,o,s,a,l,u){const{lineWidthFn:c,lineStrokeWidthFn:h,lineStrokeColorFn:d,lineColorFn:f,lineOpacityFn:p,lineDxFn:m,lineDyFn:y,linePatternAnimSpeedFn:g,linePatternGapFn:b}=this.et;this.fillPosition(t,e,i,n);let v=63*r;v=(Math.sign(v)||1)*((Math.floor(Math.abs(v))>>1<<1)+ +s);let w=63*o;w=(Math.sign(w)||1)*((Math.floor(Math.abs(w))>>1<<1)+ +a),t.aExtrude.push(v,w),(this.iconAtlas||this.hasDasharray)&&t.aExtrude.push(63*u),t.aLinesofar.push(l),c&&t.aLineWidth.push(Math.round(2*this.feaLineWidth)),h&&t.aLineStrokeWidth.push(Math.round(2*this.feaLineStrokeWidth)),f&&t.aColor.push(...this.feaColor),d&&t.aStrokeColor.push(...this.feaStrokeColor),p&&t.aOpacity.push(this.feaOpacity),this.dasharrayFn&&t.aDasharray.push(...this.feaDash),this.dashColorFn&&t.aDashColor.push(...this.feaDashColor),this.iconAtlas&&t.aTexInfo.push(...this.feaTexInfo),(m||y)&&t.aLineDxDy.push(this.feaLineDx||0,this.feaLineDy||0),(g||b)&&t.aLinePattern.push(127*(this.feaPatternAnimSpeed||0),10*(this.feaLinePatternGap||0)),this.maxPos=Math.max(this.maxPos,Math.abs(e)+1,Math.abs(i)+1)}addElements(t,e,i){super.addElements(this.offset+t,this.offset+e,this.offset+i)}kt(t){const e=this.options.EXTENT,i=this.elements;for(let n=0;n<i.length;n+=3)e!==1/0&&(Wa(this.data.aPosition,i[n],i[n+1],3,e)||Wa(this.data.aPosition,i[n+1],i[n+2],3,e))||t.push(i[n],i[n+1],i[n+2])}Mt(t){if(t.length<=1)return t;const e=[],i=this.options.EXTENT;let n,r=!0;for(n=0;n<t.length-1;n++){const o=$a(t[n],t[n+1],i);o&&r||(e.push(t[n]),r=o)}return r||e.push(t[n]),e}updateDistance(t,e){if(this.options.isTube){const i=t.dist(e),n=sn(this.options)*(e.z-t.z);this.distance+=Math.sqrt(i*i+n*n)}else this.distance+=t.dist(e);this.updateScaledDistance()}updateScaledDistance(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(Ca-1):this.distance}}function $a(t,e,i){return i!==1/0&&(t.x<0&&e.x<0||t.x>i&&e.x>i||t.y<0&&e.y<0||t.y>i&&e.y>i)}function Wa(t,e,i,n,r){if(r===1/0)return!1;const o=Math.floor(.5*t[e*n]),s=Math.floor(.5*t[e*n+1]),a=Math.floor(.5*t[i*n]),l=Math.floor(.5*t[i*n+1]);return o===a&&(o<0||o>r)&&s!==l||s===l&&(s<0||s>r)&&o!==a}function Ja(t){if(!Array.isArray(t))return!1;for(let e=0;e<t.length;e++)if(t[e])return!0;return!1}const Ha=new Ot(0,0),Va=new Ot(0,0);function Ga(t,e){const i=t.mag(),n=e.mag();Ha.x=e.x,Ha.y=e.y;const r=t.angleTo(Va),o=e.angleTo(Va);return Math.sign(o-r)*Math.sqrt(n*n-i*i)}class Ba extends Ua{constructor(t,e,i){super(t,e,i),this.jt=i.altitudeProperty}getFormat(){const{lineColorFn:t,lineWidthFn:e}=this.et,i=[{type:this.maxPosZ>=Math.pow(2,15)?Float32Array:Int16Array,width:3,name:"aPosition"},{type:Uint16Array,width:1,name:"aLinesofar"},{type:Uint8Array,width:1,name:"aUp"},{type:Int16Array,width:3,name:"aExtrudedPosition"},{type:Int8Array,width:2,name:"aExtrude"}];return t&&i.push({type:Uint8Array,width:4,name:"aColor"}),e&&i.push({type:Uint8Array,width:1,name:"aLineWidth"}),this.jt&&i.push({type:Array,width:1,name:"aLineHeight"}),i}placeVector(t){const e=t.feature;if(this.jt){const{altitudeScale:t,altitudeProperty:i,defaultAltitude:n,heightProperty:r,defaultHeight:o,minHeightProperty:s}=this.options,{altitude:a,height:l}=pn(e,t,i,n,r,o,s);this.feaAltitude=a,this.feaMinHeight=(a-l)/a*32767,a>this.maxAltitude&&(this.maxAltitude=a)}return super.placeVector(t)}needAltitudeAttribute(){return!1}wt(t,e,i,n,r,o){const s=this.data.aPosition.length/3;super.wt(t,e,i,n,r,o);const a=this.data.aPosition.length/3,l=this.data.aPosition.length/3-this.offset;if(3!==e.type&&l>0&&!1!==this.options.side){const t=!1!==this.options.top?1:0,e=t+4;let i=this.data.aPosition.length/3;for(const t in this.data){const e=this.data[t],n=e.length/i;for(let t=0;t<n;t++)e.push(e[s*n+3*n+t])}i=this.data.aPosition.length/3;for(const t in this.data){const n=this.data[t],r=n.length/i;for(let t=0;t<r;t++)n.push(n[s*r+r*e+t])}i=this.data.aPosition.length/3;for(const t in this.data){const n=this.data[t],r=n.length/i;for(let t=0;t<r;t++)n.push(n[s*r+r*(e+3)+t])}super.addElements(t+1,l+1,l),super.addElements(l,l+1,l+2);const n=this.data.aPosition.length/3-this.offset;i=this.data.aPosition.length/3;for(const t in this.data){const e=this.data[t],n=e.length/i;for(let t=0;t<n;t++)e.push(e[a*n-n+t])}i=this.data.aPosition.length/3;for(const t in this.data){const n=this.data[t],r=n.length/i;for(let t=0;t<r;t++)n.push(n[a*r-e*r-r+t])}i=this.data.aPosition.length/3;for(const t in this.data){const n=this.data[t],r=n.length/i;for(let t=0;t<r;t++)n.push(n[a*r-e*r-3*r+t])}super.addElements(n,l-3,n+1),super.addElements(l-3,n+2,n+1)}}fillData(t,e,i,n,r,o,s,a,l){const u=!1!==this.options.top,c=!1!==this.options.side,h=this.feaLineWidth||this.symbol.lineWidth/2*(this.options.EXTENT/this.options.tileSize),d=63*r,f=63*o,p=h*r+e,m=h*o+i;this.At(t,e,i,r,o,s,a,l,p,m,d,f),c&&(u&&this.At(t,e,i,r,o,s,a,l,p,m,d,f),this.At(t,e,i,r,o,s,a,l,p,m,d,f),this.Ft(t,e,i,r,o,s,a,l,p,m,d,f),this.Ft(t,e,i,r,o,s,a,l,p,m,d,f)),this.maxPos=Math.max(this.maxPos,Math.abs(e),Math.abs(i))}At(t,e,i,n,r,o,s,a,l,u,c,h){const{lineColorFn:d,lineWidthFn:f}=this.et;t.aPosition.push(e,i,32767),t.aLinesofar.push(a),t.aUp.push(+s),t.aExtrudedPosition.push(l,u,1),t.aExtrude.push(c,h),d&&t.aColor.push(...this.feaColor),f&&t.aLineWidth.push(Math.round(2*this.feaLineWidth)),this.jt&&t.aLineHeight.push(this.feaAltitude)}Ft(t,e,i,n,r,o,s,a,l,u,c,h){const{lineColorFn:d,lineWidthFn:f}=this.et;t.aPosition.push(e,i,this.feaMinHeight||0),t.aLinesofar.push(a),t.aUp.push(+s),t.aExtrudedPosition.push(l,u,1),t.aExtrude.push(c,h),d&&t.aColor.push(...this.feaColor),f&&t.aLineWidth.push(Math.round(2*this.feaLineWidth)),this.jt&&t.aLineHeight.push(this.feaAltitude)}addElements(t,e,i){const n=!1!==this.options.top,r=!1!==this.options.side,o=(n?1:0)+(r?4:0);if(t*=o,e*=o,this.data.aUp[this.offset+(i*=o)+4]){if(n&&super.addElements(e,t,i),r){const t=n?1:0;super.addElements(e+t,i+t,i+t+2),super.addElements(e+t+1,i+t+1+2,e+t+1+2)}}else if(n&&super.addElements(t,i,e),r){const e=n?1:0;super.addElements(t+e,t+e+2,i+e),super.addElements(t+e+1+2,i+e+1+2,i+e+1)}}createDataPack(t,e){this.maxAltitude=0;const i=super.createDataPack(t,e);if(!i)return i;const{data:n,indices:r}=i;this.getFormat().reduce((t,e)=>(t[e.name]={size:e.width},t),{}).aPickingId={size:1};const{aExtrudedPosition:o,aPosition:s,aLinesofar:a,aUp:l,aExtrude:u,aColor:c,aLineHeight:h,aLineWidth:d}=n,f={},p=Ye(o,r);let m,y=!0;for(let t=0;t<p.length;t++)p[t]=-p[t],p[t]%1!=0&&(y=!1);if(!1!==this.options.top&&this.symbol.material&&function(t){for(const e in t)if(e.indexOf("Texture")>=0&&t[e])return!0;return!1}(this.symbol.material)&&(m=function(t,e,i){const n=[];for(let r=0;r<t.length;r+=3){const t=e[r/3];n.push(t/256,i[r/3]?1:0)}return n}(o,a,l)),f.aPosition=s,m&&(f.aTexCoord0=new Float32Array(m)),f.aNormal=y?new Int8Array(p):new Float32Array(p),f.aPickingId=n.aPickingId,f.aExtrude=u,c&&(f.aColor=c),d&&(f.aLineWidth=d),h){const t=Vi(this.maxAltitude);f.aLineHeight=new t(h)}const g=[];for(const t in f)g.push(f[t].buffer);return i.data=f,i.buffers=g,i}}const Xa=Math.pow(2,16)/1;class Za extends js{getFormat(){return[...this.getPositionFormat()]}placeVector(t){const e=t.feature,i=3===e.type,n=e.geometry,r=this.elements;i&&(this.elements=[]);const o=this.needAltitudeAttribute()?2:3;for(let t=0;t<n.length;t++)this.offset=this.data.aPosition.length/o,this.wt(n[t],e),i&&(this.kt(r),this.elements=[]);i&&(this.elements=r)}wt(t,e){const i=3===e.type;let n=t.length;for(;n>=2&&t[n-1].equals(t[n-2]);)n--;let r,o,s,a=0;for(;a<n-1&&t[a].equals(t[a+1]);)a++;if(!(n<(i?3:2))){this.distance=0,this.vertexLength=0,this.primitiveLength=0,this.e1=this.e2=this.e3=-1,i&&(r=t[n-2]);for(let e=a;e<n;e++)s=i&&e===n-1?t[a+1]:t[e+1],s&&t[e].equals(s)||(r&&(o=r),r=t[e],o&&(this.distance+=r.dist(o)),this.addCurrentVertex(r,this.distance))}}addCurrentVertex(t,e){const i=this.vertexLength++;this.addLineVertex(this.data,t,e),i>=1&&this.addElements(i-1,i),e>Xa&&(this.distance=0,this.addCurrentVertex(t,this.distance))}addLineVertex(t,e){this.fillPosition(t,e.x,e.y,e.z||0),this.maxPos=Math.max(this.maxPos,Math.abs(e.x),Math.abs(e.y))}addElements(t,e){super.addElements(this.offset+t,this.offset+e)}kt(t){const e=this.options.EXTENT,i=this.elements;for(let n=0;n<i.length;n+=2)dn(this.data.aPosition,i[n],i[n+1],3,e)||t.push(i[n],i[n+1])}}const Ya=45*Math.PI/100;class Ka extends js{getFormat(){return[...this.getPositionFormat()]}placeVector(t){const e=this.pt(t,this.symbol.markerSpacing||250,this.symbol.markerPlacement||"point");for(let t=0;t<e.length;t++){const i=e[t];this.fillPosition(this.data,i.x,i.y,i.z);const n=Math.max(Math.abs(i.x),Math.abs(i.y));n>this.maxPos&&(this.maxPos=n)}}pt(t,e,i){const n=t.feature,r=t.feature.type,o=this.options.EXTENT,s=[];if("line"===i){let t=n.geometry;o&&(t=wa(n.geometry,0,0,o,o));for(let i=0;i<t.length;i++){const n=Ma(t[i],e,Ya,null,null,24,1,1,o||1/0);s.push.apply(s,n)}}else if(3===r){const t=Aa(n.geometry,0);for(let e=0;e<t.length;e++){const i=za(t[e],16);mn(i,o)||s.push(i)}}else if(2===n.type)for(let t=0;t<n.geometry.length;t++){const e=n.geometry[t];mn(e[0],o)||s.push(e[0])}else if(1===n.type)for(let t=0;t<n.geometry.length;t++){const e=n.geometry[t];for(let t=0;t<e.length;t++){const i=e[t];mn(i,o)||s.push(i)}}return s}hasElements(){return!1}}\n/*!\n     * from @turf/bboxClip\n     * https://github.com/Turfjs/turf\n     * MIT LICENSE\n     */const Qa=[],tl=[];function el(t,e){var i,n,r,o,s,a,l;for(n=1;n<=8;n*=2){for(i=[],o=!(nl(r=t[t.length-1],e)&n),s=0;s<t.length;s++){if((l=!(nl(a=t[s],e)&n))!==o){const t=il(r,a,n,e);i.push(void 0!==a.x?new Ot(t[0],t[1]):t)}l&&i.push(a),r=a,o=l}if(!(t=i).length)break}return i}function il(t,e,i,n){return Qa[0]=void 0===t.x?t[0]:t.x,Qa[1]=void 0===t.y?t[1]:t.y,t=Qa,tl[0]=void 0===e.x?e[0]:e.x,tl[1]=void 0===e.y?e[1]:e.y,e=tl,8&i?[t[0]+(e[0]-t[0])*(n[3]-t[1])/(e[1]-t[1]),n[3]]:4&i?[t[0]+(e[0]-t[0])*(n[1]-t[1])/(e[1]-t[1]),n[1]]:2&i?[n[2],t[1]+(e[1]-t[1])*(n[2]-t[0])/(e[0]-t[0])]:1&i?[n[0],t[1]+(e[1]-t[1])*(n[0]-t[0])/(e[0]-t[0])]:null}function nl(t,e){Qa[0]=void 0===t.x?t[0]:t.x,Qa[1]=void 0===t.y?t[1]:t.y;var i=0;return(t=Qa)[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}const rl=[0,0,0,0];class ol extends js{constructor(...t){super(...t),this.lineElements=[]}createStyledVector(t,e,i,n,r){const o=new wn(t,e,i,n),s=o.getPolygonResource();return!this.options.atlas&&s&&(r[s]=[0,0]),o}getFormat(){const t=[...this.getPositionFormat()],{polygonFillFn:e,polygonOpacityFn:i,uvScaleFn:n,uvOffsetFn:r}=this.et;if(this.iconAtlas){const e=this.getIconAtlasMaxValue();t.push({type:e>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return e&&t.push({type:Uint8Array,width:4,name:"aColor"}),i&&t.push({type:Uint8Array,width:1,name:"aOpacity"}),n&&t.push({type:Uint16Array,width:2,name:"aUVScale"}),r&&t.push({type:Uint8Array,width:2,name:"aUVOffset"}),t}createDataPack(...t){this.maxLineIndex=0,this.lineElements=[];const e=super.createDataPack(...t);if(!e)return e;let i=this.lineElements;return i=new(Hi(this.maxLineIndex))(this.lineElements),e.lineIndices=i,e.buffers.push(i.buffer),e}placeVector(t,e){const i=t.feature;this.Tt(i.geometry,i,e)}Tt(t,e){let i,n,r,o;const{polygonFillFn:a,polygonOpacityFn:l,uvScaleFn:u,uvOffsetFn:c}=this.et,h=e.properties;a&&(i=a(this.options.zoom,h)||wt([],255,255,255,255),i=s(i)?rl:un([],i)),l&&(n=l(this.options.zoom,h),Zi(n)&&(n=1),n*=255),u&&(r=u(this.options.zoom,h),Zi(r)&&(r=[1,1]),r=[255*r[0],255*r[1]]),c&&(o=c(this.options.zoom,h),Zi(o)&&(o=[0,0]),o=[255*o[0],255*o[1]]);const d=!!this.iconAtlas,f=Aa(t,500),p=[0,0],m=[0,0];if(d){const{polygonPatternFileFn:t}=this.et,e=t?t(null,h):this.symbol.polygonPatternFile;if(this.iconAtlas.glyphMap[e]){const t=this.iconAtlas.positions[e];p[0]=t.tl[0]+1,p[1]=t.tl[1]+1,m[0]=t.displaySize[0]-3,m[1]=t.displaySize[1]-3}}const y=this.needAltitudeAttribute()?2:3,g=[-1,-1,e.extent+1,e.extent+1];for(let t=0;t<f.length;t++){const e=f[t],s=this.data.aPosition.length/y,a=[],l=[];for(let t=0;t<e.length;t++){let s=e[t];if(this.options.EXTENT!==1/0&&0===this.maxPosZ&&(s=el(s,g)),0===s.length)continue;0!==t&&l.push(a.length/3);const u=this.lineElements.length;this.fillPosition(this.data,s[0].x,s[0].y,s[0].z||0),d&&this.data.aTexInfo.push(...p,...m),void 0!==i&&this.data.aColor.push(...i),void 0!==n&&this.data.aOpacity.push(n),void 0!==r&&this.data.aUVScale.push(...r),void 0!==o&&this.data.aUVOffset.push(...o),this.maxPos=Math.max(this.maxPos,Math.abs(s[0].x),Math.abs(s[0].y)),this.addLineElements(u+s.length-1,u),a.push(s[0].x),a.push(s[0].y),a.push(s[0].z||0);for(let t=1;t<s.length;t++)this.fillPosition(this.data,s[t].x,s[t].y,s[t].z||0),d&&this.data.aTexInfo.push(...p,...m),void 0!==i&&this.data.aColor.push(...i),void 0!==n&&this.data.aOpacity.push(n),void 0!==r&&this.data.aUVScale.push(...r),void 0!==o&&this.data.aUVOffset.push(...o),this.maxPos=Math.max(this.maxPos,Math.abs(s[t].x),Math.abs(s[t].y)),this.addLineElements(u+t-1,u+t),a.push(s[t].x),a.push(s[t].y),a.push(s[t].z||0)}const u=Ti(a,l,3);for(let t=0;t<u.length;t+=3)this.addElements(s+u[t],s+u[t+1],s+u[t+2])}}addLineElements(...t){this.maxLineIndex=Math.max(this.maxLineIndex,...t),this.lineElements.push(...t)}}const sl=[{type:Int16Array,width:3,name:"aPosition"}];class al extends js{getFormat(){return sl}placeVector(t,e){const i=this.pt(t,e);if(0===i.length)return;const n=this.data,r=this.getAltitude(t.feature.properties);let o=n.aPosition.length/sl[0].width;for(let t=0;t<i.length;t++){const e=i[t];n.aPosition.push(2*e.x+0,2*e.y+0,r),n.aPosition.push(2*e.x+1,2*e.y+0,r),n.aPosition.push(2*e.x+1,2*e.y+1,r),n.aPosition.push(2*e.x+0,2*e.y+1,r),this.addElements(o,o+1,o+2),this.addElements(o,o+2,o+3),o+=4;const s=Math.max(Math.abs(2*e.x+1),Math.abs(2*e.y+1));s>this.maxPos&&(this.maxPos=s)}}pt(t,e){const{feature:i,symbol:n}=t,r=this.vt(t,n),o=i.properties,{markerSpacingFn:s}=this.et,a=((s?s(null,o):n.markerSpacing)||250)*e;return Ia(t,null,null,e,this.options.EXTENT,r,a)}vt(t,e){return this.et.markerPlacementFn?this.et.markerPlacementFn(this.options.zoom,t.feature.properties):e.markerPlacement}}class ll extends Ua{constructor(t,e,i){(e=Xi({},e)).lineJoin="miter",e.lineCap="butt",super(t,e,i),this.options.radialSegments%2==1&&this.options.radialSegments--}getFormat(){const{lineWidthFn:t,lineColorFn:e,lineOpacityFn:i,linePatternAnimSpeedFn:n,linePatternGapFn:r}=this.et,o=[...this.getPositionFormat(),{type:Int8Array,size:4,name:"aTubeNormal"},{type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}];if(this.iconAtlas){o.push({type:Int8Array,width:1,name:"aNormalDistance"});const t=this.getIconAtlasMaxValue();o.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return t&&o.push({type:Uint16Array,width:1,name:"aLineWidth"}),e&&o.push({type:Uint8Array,width:4,name:"aColor"}),i&&o.push({type:Uint8Array,width:1,name:"aOpacity"}),n&&o.push({type:Int8Array,width:1,name:"aLinePatternAnimSpeed"}),r&&o.push({type:Int8Array,width:1,name:"aLinePatternGap"}),o}addHalfVertex(t,e,i,n,r,o,s,a){const{x:l,y:u,z:c}=t,h=1*this.scaledDistance,d=this.options.radialSegments/2,{x:f,y:p,z:m}=s.dir,y=function(t,e,i,n,r,o,s,a){dt(ul,i,n,r),dt(cl,o,s,0),gt(hl,ul,cl),mt(cl,cl),mt(hl,hl),dl[e]||(dl[e]=[]);const l=dl[e];for(var u=0;u<e;u++){const t=Math.PI*u/e,i=1-Math.abs(t-0)/(Math.PI/2);l[u]=l[u]||[],fl(cl,hl,l[u],1,t,i*(a?-1:1))}return l}(0,d,f,p,m,e,i,r);this.prevVertex&&this.fillTubeElements(r),this.fillData(this.data,l,u,c||0,y,r,h,a)}fillTubeElements(t){const e=this.options.radialSegments/2,i=this.needAltitudeAttribute()?2:3,n=this.data.aPosition.length/i;for(let i=0;i<e;i++){const r=i+n-2*e;let o,s;i===e-1&&t?(o=i+n-2*e+1,s=i+n-2*e-2*e+1):(o=i+n+1,s=i+n+1-2*e),super.addElements(i+n-this.offset,o-this.offset,r-this.offset),super.addElements(r-this.offset,o-this.offset,s-this.offset)}}fillData(t,e,i,n,r,o,s,a){const{lineWidthFn:l,lineColorFn:u,lineOpacityFn:c,linePatternAnimSpeedFn:h,linePatternGapFn:d}=this.et,f=r.length;for(let o=0;o<f;o++){if(this.fillPosition(t,e,i,n),xt(r[o],r[o],63),t.aTubeNormal.push(...r[o]),t.aLinesofar.push(s),this.iconAtlas&&(t.aNormalDistance.push(63*a),t.aTexInfo.push(...this.feaTexInfo)),l){const e=an(this.options.metric);let i=this.feaLineWidth*e;isNaN(i)&&(i=0),t.aLineWidth.push(Math.round(i))}u&&t.aColor.push(...this.feaColor),c&&t.aOpacity.push(this.feaOpacity),h&&t.aLinePatternAnimSpeed.push(127*(this.feaPatternAnimSpeed||0)),d&&t.aLinePatternGap.push(10*(this.feaLinePatternGap||0))}this.maxPos=Math.max(this.maxPos,Math.abs(e)+1,Math.abs(i)+1)}}const ul=[],cl=[],hl=[],dl={};function fl(t,e,i,n,r,o){return wt(i,n*(Math.cos(r)*t[0]+Math.sin(r)*e[0]),n*(Math.cos(r)*t[1]+Math.sin(r)*e[1]),n*(Math.cos(r)*t[2]+Math.sin(r)*e[2]),o),i}class pl extends ll{addHalfVertex(t,e,i,n,r,o,s,a){const{x:l,y:u,z:c}=t,h=1*this.scaledDistance,{x:d,y:f,z:p}=s.dir,m=function(t,e,i,n,r,o,s,a){dt(yl,i,n,r),dt(gl,o,s,0),gt(bl,yl,gl),mt(gl,gl),mt(bl,bl),function(t,e,i){t[0]=e,t[1]=i}(ml,t,e);const l=zt(ml)/t,u=Math.atan(e/t);let c=Math.PI/2+(Math.PI/2-u);return vl[0]||(vl[0]=[]),fl(gl,bl,vl[0],l,c,a?1:-1),c+=2*u,vl[1]||(vl[1]=[]),fl(gl,bl,vl[1],l,c,a?1:-1),vl}(this.feaLineWidth,this.feaLineHeight,d,f,p,e,i,r);this.prevVertex&&this.fillTubeElements(r),this.fillData(this.data,l,u,c||0,m,r,h,a)}}const ml=[],yl=[],gl=[],bl=[],vl=[];var wl=Object.freeze({__proto__:null,clipPolygon:el,calculateSignedArea:hn,getFeaAltitudeAndHeight:pn,generateFeatureIndex:bn,generateFeatureIndiceIndex:vn,convertRTLText:ya,packPosition:xn,unpackPosition:function(t,e,i,n){const r=(Math.sign(e)||1)*(Math.abs(e)%kn),o=(Math.sign(i)||1)*(Math.abs(i)%kn),s=Math.floor(Math.abs(e)/kn),a=Math.floor(Math.abs(i)/kn);return t[0]=r,t[1]=o,t[2]=Math.sign(n+1e-5)*(2*s+a)*Mn+n,t}});const xl={polygonPatternFile:1,markerFile:1,markerPlacement:1,markerSpacing:1,textName:1,textStyle:1,textFaceName:1,textWeight:1,textPlacement:1,textSpacing:1,lineJoin:1,lineCap:1,linePatternFile:1};Object.assign({visible:1,textHorizontalAlignment:1,textVerticalAlignment:1,textWrapWidth:1,markerHorizontalAlignment:1,markerVerticalAlignment:1},xl),Object.assign({lineDasharray:1},xl);function kl(t,e,i,n,r,o,s,a,l,u,c,h,d,f,p){const m=e.length,y=r/3;for(let i=2,n=m;i<n;i+=3)t[r+i-2]=e[i-2],t[r+i-1]=e[i-1],t[r+i-0]=e[i]-o;r+=m;for(let i=2,n=m;i<n;i+=3)t[r+i-2]=e[i-2],t[r+i-1]=e[i-1],t[r+i-0]=e[i]-s;r+=m;for(let i=2,n=m;i<n;i+=3)t[r+i-2]=e[i-2],t[r+i-1]=e[i-1],t[r+i-0]=e[i]-o;r+=m;for(let i=2,n=m;i<n;i+=3)t[r+i-2]=e[i-2],t[r+i-1]=e[i-1],t[r+i-0]=e[i]-s;r+=m,(i=i||[]).push(m/3);for(let e=0;e<i.length;e++){Ml(y+(i[e-1]||0),y+i[e],t,m/3,a,n,l,u,c,h,d,f,p)}return r}function Ml(t,e,i,n,r,o,s,a,l,u,c,h,d){const f=o.length;let p,m;for(let s=t,a=e;s<a-1;s++)p=s,m=s+1,it(i,p,m,r)||((s-t)%2==1&&(p+=2*n,m+=2*n),o.push(p+n,p,m),o.push(m,m+n,p+n));s&&function(t,e,i,n,r,o,s,a,l){let u,c=0,h=0,d=0,f=0;for(let p=n.length-1;p>=0;p--){const m=3*n[p],y=3*n[p]+1,g=3*n[p]+2,b=i[m],v=i[y],w=i[g];c||h||(c=Math.max(i[g],i[3*n[p-2]+2]),h=Math.min(i[g],i[3*n[p-2]+2]),u=c-h);let x=d;const k=p%6;0===t?(5===k&&(f=It(i,n,p,b,v)),x=2===k||3===k||4===k?d:d+f):1===t&&(2===k||3===k||4===k?x=0:5===k?(f=It(i,n,p,b,v),x=f):x=f);const M=x*s*a/r,j=w===c?0:u*l/o;e[m/3*2]=M,e[m/3*2+1]=-j,0===k&&(d+=f)}}(a,l,i,o.slice(f,o.length),u[0],u[1],c,h,d)}function jl(t,e,i,n,r,o,s,u,c,h){void 0===e.top&&(e.top=!0),void 0===e.side&&(e.side=!0);const{altitudeScale:d,altitudeProperty:f,defaultAltitude:p,heightProperty:y,minHeightProperty:g,defaultHeight:b,tangent:j,uv:A,uvScale:F,topUVMode:T,sideUVMode:z,top:S,side:_,topThickness:P}=e,I=function(t,e,{altitudeScale:i,altitudeProperty:n,defaultAltitude:r,heightProperty:o,minHeightProperty:s,defaultHeight:a},{side:l,top:u,topThickness:c,uvOrigin:h,uv:d,uvSize:f,topUVMode:p,sideUVMode:y,glScale:g,localScale:b,vScale:w},M){const j=e/t[0].extent,A=[],F=[],T=[],z=[],S=[],_=[],P=!!d,I=!!u,O=!!l,E=P?[]:null;function q(t,i,n,r){if(I){const r=Ti(z,n,3);if(0===r.length)return i;let o;v(S,z),i+=z.length;for(let e=2,i=r.length;e<i;e+=3)o=r[e-1],r[e-1]=r[e]+t/3,r[e]=o+t/3,r[e-2]+=t/3;v(_,r),P&&St(p||0,t,i,E,S,0,g,b,f[0],f[1]),c>0&&!O&&(i=kl(S,z,n,_,i,0,c,e,P,y||0,E,f,g,b,w))}return O&&(I&&(c=0),i=kl(S,z,n,_,i,c,r,e,P,y||0,E,f,g,b,w)),i}let R=0,C=0;const N=[-1,-1,e+1,e+1];let L=0,D=t.length;void 0!==M&&(L=M,D=M+1);let U=0,$=!1;for(;L<D;L++){const l=t[L],u=l.id;m(u)&&(Math.abs(u)>U&&(U=Math.abs(u)),u<0&&($=!0));const c=l.geometry,{altitude:h,height:d}=wl.getFeaAltitudeAndHeight(l,i,n,r,o,a,s);R=Math.max(Math.abs(h),R);const f=S.length;let p=C,y=[];z.length=0;for(let t=0,i=c.length;t<i;t++){const n=wl.calculateSignedArea(c[t])<0;!n&&t>0&&(C=q(p,C,y,d*j),z.length=0,y=[],p=C);let r=c[t];if(e!==1/0&&(r=wl.clipPolygon(r,N)),!r.length){t===i-1&&(C=q(p,C,y,d*j));continue}const o=r.length;Array.isArray(r[0])?r[0][0]===r[o-1][0]&&r[0][1]===r[o-1][1]||r.push([r[0][0],r[0][1]]):r[0].x===r[o-1].x&&r[0].y===r[o-1].y||r.push(r[0]),n&&y.push(z.length/3),et(z,z.length,r,j,h),t===i-1&&(C=q(p,C,y,d*j))}const g=S.length-f,b="__fea_idx".trim();for(let t=0;t<g/3;t++)F.push(void 0===l[b]?L:l[b]),A.push(L),m(u)&&T.push(u)}const W=x(F.length?F[F.length-1]:0),J={maxAltitude:R,vertices:new(k(Math.max(512,R)))(S),indices:_,pickingIds:new W(F),featureIndexes:A};if(T.length){const t=$?k(U):x(U);J.featureIds=new t(T)}else J.featureIds=[];return E&&(E.length=S.length/3*2,J.uvs=E),J}(t,i,{altitudeScale:d,altitudeProperty:f,defaultAltitude:p||0,heightProperty:y,minHeightProperty:g,defaultHeight:b||0},{top:S,side:_,topThickness:10*P||0,uv:A||j,uvSize:F?[.5*F[0],.5*F[1]]:[.5,.5],uvOrigin:n,topUVMode:T,sideUVMode:z,glScale:r,localScale:s,vScale:o},h),O=[],E=new(w(I.vertices.length/3))(I.indices);delete I.indices,O.push(E.buffer,I.vertices.buffer,I.pickingIds.buffer);const q=Ye(I.vertices,E);let R=!0;for(let t=0;t<q.length;t++)q[t]=-q[t],q[t]%1!=0&&(R=!1);if(I.normals=q,j){let t=function(t,e,i,n){const r=t.length/3,o=new Array(4*r),s=[],a=[];for(let t=0;t<r;t++)s[t]=[0,0,0],a[t]=[0,0,0];const l=[0,0,0],u=[0,0,0],c=[0,0,0],h=[0,0],d=[0,0],f=[0,0],p=[0,0,0],m=[0,0,0];function y(e,n,r){Ke(l,t,3*e),Ke(u,t,3*n),Ke(c,t,3*r),Qe(h,i,2*e),Qe(d,i,2*n),Qe(f,i,2*r);const o=u[0]-l[0],y=c[0]-l[0],g=u[1]-l[1],b=c[1]-l[1],v=u[2]-l[2],w=c[2]-l[2],x=d[0]-h[0],k=f[0]-h[0],M=d[1]-h[1],j=f[1]-h[1],A=1/(x*j-k*M);dt(p,(j*o-M*y)*A,(j*g-M*b)*A,(j*v-M*w)*A),dt(m,(x*y-k*o)*A,(x*b-k*g)*A,(x*w-k*v)*A),ft(s[e],s[e],p),ft(s[n],s[n],p),ft(s[r],s[r],p),ft(a[e],a[e],m),ft(a[n],a[n],m),ft(a[r],a[r],m)}for(let t=0,e=n.length;t<e;t+=3)y(n[t+0],n[t+1],n[t+2]);const g=[],b=[],v=[],w=[];let x,k,M;function j(t){Ke(v,e,3*t),ht(w,v),k=s[t],ht(g,k),bt(g,g,function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}(v,v,yt(v,k))),mt(g,g),gt(b,w,k),M=yt(b,a[t]),x=M<0?-1:1,o[4*t]=g[0],o[4*t+1]=g[1],o[4*t+2]=g[2],o[4*t+3]=x}for(let t=0,e=n.length;t<e;t+=3)j(n[t+0]),j(n[t+1]),j(n[t+2]);return o}(I.vertices,I.normals,I.uvs,E);t=function(t,e){const i=new Float32Array(e.length),n=[],r=[],o=[];for(let s=0;s<e.length;s+=4){const a=s/4*3;dt(r,t[a]||0,t[a+1]||0,t[a+2]||0),wt(n,e[s]||0,e[s+1]||0,e[s+2]||0,e[s+3]||0),Ze(o,r,n),vt(i.subarray(s,s+4),o)}return i}(I.normals,t),I.tangents=t,O.push(t.buffer),delete I.normals}if(I.normals&&(I.normals=R?new Int8Array(I.normals):new Float32Array(I.normals),O.push(I.normals.buffer)),I.uvs){const t=I.uvs;I.uvs=new Float32Array(t),O.push(I.uvs.buffer)}const C=function(t,e,i,n){const r={};if(M(e.polygonFill)){const o=l(e.polygonFill),s=new Uint8Array(4*n.length);s.fill(255);for(let e=0;e<n.length;e++){const r=t[n[e]],a=r.properties||{};a.$layer=r.layer,a.$type=r.type;let l=o(i,a);delete a.$layer,delete a.$type,cn.normalizeColor(Al,l),s[4*e]=Al[0],s[4*e+1]=Al[1],s[4*e+2]=Al[2],s[4*e+3]=Al[3]}r.aColor=s}if(M(e.polygonOpacity)){const o=a(e.polygonOpacity),s=new Uint8Array(n.length);s.fill(255);for(let e=0;e<n.length;e++){const r=t[n[e]],a=r.properties||{};a.$layer=r.layer,a.$type=r.type;const l=o(i,a);delete a.$layer,delete a.$type,s[e]=255*l}r.aOpacity=s}return r}(t,u,c,I.featureIndexes),N={data:{data:{aPosition:I.vertices,aNormal:I.normals,aTexCoord0:I.uvs,aTangent:I.tangents,aPickingId:I.pickingIds},indices:E,properties:{maxAltitude:I.maxAltitude}},buffers:O};return I.featureIds.length?(N.data.featureIds=I.featureIds,O.push(N.data.featureIds.buffer)):N.data.featureIds=[],C.aColor&&(N.data.data.aColor=C.aColor,N.buffers.push(C.aColor.buffer)),C.aOpacity&&(N.data.data.aOpacity=C.aOpacity,N.buffers.push(C.aOpacity.buffer)),N.data.feaIdAttrMap=wl.generateFeatureIndex(N.data.featureIds),N.data.feaIdIndiceMap=wl.generateFeatureIndiceIndex(N.data.featureIds,N.data.indices),N}const Al=[];function Fl(t,e,{altitudeScale:i,altitudeProperty:n,defaultAltitude:r,heightProperty:o,minHeightProperty:s,defaultHeight:a,bottom:l}){const u=l,c=e/t[0].extent,h=2*function(t,e){let i=0;for(let n=0,r=t.length;n<r;n++){const r=t[n];if(m(r.geometry[0][0])){const t=3*r.geometry.length;i+=e?2*t-6:t}else for(let t=0,n=r.geometry.length;t<n;t++){let n=3*r.geometry[t].length;3===r.type&&(n-=3),i+=e?2*n-6:n}}return i}(t)+3*t.length*2,d=[],f=new Int16Array(h),p=[];function y(t,i,n){const r=i-t,o=f.subarray(t,i),s=f.subarray(i,i+r);s.set(o);for(let t=2,e=s.length;t<e;t+=3)s[t]=o[t]-n;const a=t/3,l=r/3;let c,h;for(let t=a,i=l+a;t<i;t++)t<i-1?(c=t,h=t+1):(c=t,h=a),it(f,c,h,e)||(p.push(c,h),u&&p.push(c+l,h+l),Tl(f,c,e)||p.push(c,c+l));return i+r}let g=0,b=0;const v="__fea_idx".trim();for(let e=0,l=t.length;e<l;e++){const l=t[e],u=l.geometry,{altitude:h,height:m}=wl.getFeaAltitudeAndHeight(l,i,n,r,o,a,s);b=Math.max(Math.abs(h),b);let w=g;for(let t=0,e=u.length;t<e;t++){let e=u[t];const i=e.length;e[0][0]===e[i-1][0]&&e[0][1]===e[i-1][1]&&(e=e.slice(0,i-1)),g=et(f,w,e,c,h),g=y(w,g,m*c),w=g}const x=p.length-d.length;for(let t=0;t<x;t++)d.push(l[v])}const M=new(w(p.reduce((t,e)=>Math.max(t,e),0)))(p),j=x(t.length);return{aPosition:new(k(Math.max(512,b)))(f),indices:M,aPickingId:new j(d)}}function Tl(t,e,i){const n=t[3*e],r=t[3*e+1];return n<0||n>i||r<0||r>i}function zl(t,e,i){const n=Fl(t,i,e),r=[n.aPosition.buffer,n.indices.buffer,n.aPickingId.buffer],o=n.indices;return delete n.indices,{data:{data:n,indices:o},buffers:r}}class Sl{constructor(t,e,i,n,r){this.id=t,this.options=e,this.upload=i,this.zt(e.style),this.requests={},this.St=n,this._t=0,this.loadings=r}updateStyle(t,e){this.options.style=t,this._t=t.styleCounter,this.zt(t),e()}updateOptions(t,e){this.options=f(this.options,t),e()}loadTile(t,e){const i=this.loadings,n=t.tileInfo.url,r=this.options.debugTile;if(r){const{x:i,y:n,z:o}=t.tileInfo;if(o!==r.z||i!==r.x||n!==r.y)return void e()}if(this.St.has(n)){const{features:r,layers:o}=this.St.get(n),s=i[n];if(delete i[n],!r||!r.length)return this.Pt(s),void e();if(s)for(let e=0;e<s.length;e++)this.It.call(s[e].ref,t,s[e].callback,n,o,r);this.It(t,e,n,o,r)}else i[n]?i[n].push({callback:e,ref:this}):(i[n]=[{callback:e,ref:this}],this.requests[n]=this.getTileFeatures(t.tileInfo,(e,r,o,s)=>{const a=i[n];if(delete i[n],this.checkIfCanceled(n))return delete this.requests[n],void this.Pt(a,null,{canceled:!0});if(delete this.requests[n],this.options.debug&&r)for(let e=0;e<r.length;e++)r[e]._debug_info={index:e,tileId:t.tileInfo.id};if(e)return e.loading||this.St.add(n,{features:[],layers:[]}),void this.Pt(a,e);if(!r||!r.length)return this.St.add(n,{features:[],layers:[]}),void this.Pt(a);if(this.St.add(n,{features:r,layers:o}),a)for(let e=0;e<a.length;e++)this.It.call(a[e].ref,t,a[e].callback,n,o,r,s)}))}It(t,e,i,n,r,o){this.Ot(n,r,t).then(i=>{i.canceled?e(null,{canceled:!0}):(i.data.style=t.styleCounter,o&&f(i.data,o),e(null,i.data,i.buffers))}).catch(t=>{e(t)})}abortTile(t,e){delete this.requests[t],this.Et(t),e()}Et(t){const e=this.loadings[t];if(e)for(let t=0;t<e.length;t++)e[t].callback(null,{canceled:!0});delete this.loadings[t]}Pt(t,e,i){if(t)for(let n=0;n<t.length;n++)t[n].callback(e,i)}checkIfCanceled(t){return!this.requests[t]}fetchIconGlyphs(t,e,i){this.upload("fetchIconGlyphs",{icons:t,glyphs:e},null,i)}Ot(t,e,i){if(!e.length)return Promise.resolve({data:null,buffers:[]});const{glScale:n,tileInfo:r}=i,o=!this.options.style.style.length&&!this.options.style.featureStyle.length;let s=this.pluginConfig.slice(0);o&&(s=this.qt(t)),this.featurePlugins&&v(s,this.featurePlugins);const a=e[0].extent,l=r.z,u={x:r.extent2d.xmin*n,y:r.extent2d.ymax*n},c=[],h=[],d=[],p=this.options,m=[],y={},g=[Promise.resolve(i.styleCounter)];let b=0,x=-1;for(let t=0;t<s.length;t++){x++;const n=s[t];n.type!==b&&(x=0,b=n.type);const r=0===n.type?c:h;if(n.symbol&&!1===n.symbol.visible){r[x]=null;continue}const{tileFeatures:f,tileFeaIndexes:p}=this.Rt(l,n.type,n.filter,e,y,t);if(!f.length){r[x]=null;continue}const v=w(p[p.length-1]);r[x]={styledFeatures:new v(p)},d.push({idx:t,typeIdx:x}),m.push(r[x].styledFeatures.buffer);let k=this.Ct(f,n,{extent:a,zoom:l,tilePoint:u,...i});o&&(k=k.then(t=>{if(!t)return null;if(t.data)t.data.layer=f[0].layer;else if(Array.isArray(t))for(let e=0;e<t.length;e++)t[e]&&t[e].data&&(t[e].data.layer=f[0].layer);return t})),g.push(k)}return Promise.all(g).then(([i,...n])=>{function r(t,e){if(void 0===t.data.ref&&(t.data.type=s[d[e].idx].renderPlugin.dataConfig.type,t.data.filter=s[d[e].idx].filter.def,t.buffers&&t.buffers.length))for(let e=0;e<t.buffers.length;e++)m.push(t.buffers[e])}if(i!==this._t)return{canceled:!0};for(let t=0;t<n.length;t++){if(!n[t])continue;const e=n[t],i=0===s[d[t].idx].type?c:h;if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;i++)e[i]&&(r(e[i],t),(void 0===e[i].data.ref||e[e[i].data.ref])&&n.push(e[i].data));n.length&&(i[d[t].typeIdx].data=n)}else r(e,t),i[d[t].typeIdx].data=e.data}const o={},l=t;if(p.features||p.schema){let t;for(let i=0,n=e.length;i<n;i++)if(t=e[i],l[t.layer].properties||(l[t.layer].properties=Il(t.properties)),p.features&&t&&y[i])if("id"===p.features)o[i]=t.id;else{const e=f({},t);p.pickingGeometry||delete e.geometry,delete e.extent,delete e.properties.$layer,delete e.properties.$type,delete e.__index,o[i]=e}}return{data:{schema:l,data:c,featureData:h,extent:a,features:o},buffers:m}}).catch(t=>{console.error(t)})}Ct(t,e,i){let n=function(t,e,i){const n=i.customProperties;if(n)for(let t=0;t<n.length;t++)n[t].fn=bs.compileFilter(n[t].filter);for(let i=0;i<t.length;i++)if(t[i]=f({},t[i]),n)for(let r=0;r<n.length;r++)if(n[r].fn(t[i],e)){t[i].geojson&&(t[i].properties=f({},t[i].properties)),f(t[i].properties,n[r].properties);break}return t}(t,i.tileInfo.z,e);const r=e.renderPlugin.dataConfig,o=e.symbol,s=this.options.tileSize[0],{extent:a,glScale:l,zScale:u,zoom:c,tilePoint:h,pointAtTileRes:d}=i,p=a/s,m=r.type,y=this.options.debugTile&&this.options.debugTile.index;if("3d-extrusion"===m){const t=Ol(o);return t&&(r.uv=1,2===t&&(r.tangent=1)),Promise.all([Promise.resolve(jl(n,r,a,h,l,u,this.options.tileSize[1]/a,o,c,y))])}if("3d-wireframe"===m)return Promise.all([Promise.resolve(zl(n,r,a))]);if("point"===m){const t=f({},r,{EXTENT:a,requestor:this.fetchIconGlyphs.bind(this),zoom:c,debugIndex:y,altitudeToTileScale:u*a/this.options.tileSize[1]/l}),e=Ea.splitPointSymbol(o),i=js.genFnTypes(e[0]);return Ea.needMerge(e[0],i,c)&&(n=Ea.mergeLineFeatures(n,e[0],i,c)),Promise.all(e.map((e,r)=>(0===r?t.fnTypes=i:delete t.fnTypes,new Ea(n,e,t).load(p))))}if("native-point"===m){const t=f({},r,{EXTENT:a,zoom:c,debugIndex:y});return El(n,o,t,Ka,a/s)}if("line"===m){const t=f({},r,{EXTENT:a,requestor:this.fetchIconGlyphs.bind(this),tileRatio:p,zoom:c,debugIndex:y});return El(n,o,t,Ua)}if("native-line"===m){const t=f({},r,{EXTENT:a,zoom:c,debugIndex:y});return El(n,o,t,Za)}if("fill"===m){const t=f({},r,{EXTENT:a,requestor:this.fetchIconGlyphs.bind(this),zoom:c,debugIndex:y});return El(n,o,t,ol)}if("line-extrusion"===m){delete o.lineGradientProperty,o.lineJoin="miter",o.lineCap="butt";const t=Ol(o);t&&(r.uv=1,2===t&&(r.tangent=1));const e=f({},r,{EXTENT:a,tileSize:s,zScale:u,glScale:l,zoom:c,debugIndex:y});if(t){const t=[];if(!1!==r.top){const i=f({},e);i.side=!1,t.push(new Ba(n,o,i))}return!1!==r.side&&(e.side=!0,e.top=!1,t.push(new Ba(n,o,e))),Promise.all(t.map(t=>t.load()))}return Promise.all([new Ba(n,o,e).load()])}if("circle"===m){const t=f({},r,{EXTENT:a,zoom:c,debugIndex:y});return El(n,o,t,al)}if("round-tube"===m||"square-tube"===m){const t="round-tube"===m?ll:pl,e=f({},r,{EXTENT:a,requestor:this.fetchIconGlyphs.bind(this),zoom:c,debugIndex:y,radialSegments:"round-tube"===m?r.radialSegments||8:4,pointAtTileRes:d,tileRatio:p,isTube:!0});return El(n,o,e,t)}return Promise.resolve([])}Rt(t,e,i,n,r){const o="__fea_idx".trim(),s=[],a=[],l=n.length;for(let u=0;u<l;u++)if((1===e||void 0===n[u].id||!this.styledFeatures[n[u].id])&&((!i.def||"default"===i.def)&&!r[u]||!0===i.def||i.def&&(void 0!==i.def.condition||Array.isArray(i.def))&&i(n[u],t))){r[u]=1;const t=f({},n[u]);if(t[o]=u,a.push(t),s.push(u),1===e)break}return{tileFeatures:a,tileFeaIndexes:s}}zt(t){const{style:e,featureStyle:i}=t,n={};i.forEach(t=>{Array.isArray(t.id)?(t.id.forEach(t=>{n[t]=1}),t.filter=["in","$id",...t.id]):(n[t.id]=1,t.filter=["==","$id",t.id])});const r=bs.compileStyle(e);for(let t=0;t<e.length;t++)r[t].filter&&(r[t].filter.def=e[t].filter?e[t].filter.value||e[t].filter:void 0),r[t].type=0;const o=[],s=bs.compileStyle(i);for(let t=0;t<i.length;t++)s[t].type=1,s[t].filter.def=i[t].filter?i[t].filter.value||i[t].filter:void 0,s[t].renderPlugin&&o.push(s[t]);this.pluginConfig=r,this.featurePlugins=o,this.styledFeatures=n}qt(t){let e=this.Nt;this.Nt||(e=this.Nt={});const i=["","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"],n=[];for(const r in t){const o=r;if(!e[r]){const n=[];for(let e=0;e<t[r].types.length;e++){const s=t[r].types[e],a=["all",["==","$layer",o],["==","$type",i[s]]],l={filter:Se(a),renderPlugin:_l(s),symbol:Pl(s)};l.filter.def=a,l.type=0,n.push(l)}e[o]=n}n.push(...e[o])}return n}}function _l(t){switch(t){case 1:return{type:"native-point",dataConfig:{type:"native-point",only2D:!0}};case 2:return{type:"native-line",dataConfig:{type:"native-line",only2D:!0}};case 3:return{type:"fill",dataConfig:{type:"fill",only2D:!0}}}return null}function Pl(t){switch(t){case 1:return{markerFill:"#f00",markerSize:10};case 2:return{lineColor:"#fff"};case 3:return{polygonFill:"#00f",polygonOpacity:.4}}return null}function Il(t){if(Array.isArray(t)||!g(t))return{};const e={};for(const i in t){const n=t[i];p(n)?e[i]="string":m(n)?e[i]="number":!0===n||!1===n?e[i]="boolean":Array.isArray(n)?e[i]="array":e[i]="object"}return e}function Ol(t){if(!t)return 0;let e=0;for(const i in t){if(("normalTexture"===i||"bumpTexture"===i)&&t[i])return 2;if(i.indexOf("Texture")>0&&t[i])e=1;else if(g(t[i])){const n=Ol(t[i]);if(2===n)return n;1===n&&(e=1)}}return e}function El(t,e,i,n,r){const o={},s=Array.isArray(e)?e:[e];let a=-1;for(let t=0;t<s.length;t++)o[t]=ql(s[t]),!o[t]&&s[t]&&-1===a&&(a=t);const l=[];for(let e=0;e<s.length;e++)s[e]&&(s[e].index={index:e},o[e]||e===a?l.push(new n(t,s[e],i).load(r)):l.push({data:{ref:a,symbolIndex:{index:e}}}));return Promise.all(l)}function ql(t){if(!t)return 0;for(const e in t)if(M(t[e]))return 1;return 0}function Rl(t,e){Cl(t.geometry,e)}function Cl(t,e){if(t)switch(t.type){case"Point":Nl(t.coordinates,e);break;case"MultiPoint":case"LineString":Ll(t.coordinates,e);break;case"MultiLineString":case"Polygon":Dl(t.coordinates,e);break;case"MultiPolygon":!function(t,e){for(let i=0;i<t.length;i++)Dl(t[i],e)}(t.coordinates,e);break;case"GeometryCollection":for(let i=0;i<t.geometries.length;i++)Cl(t.geometries[i],e)}}function Nl(t,e){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ll(t,e){for(let i=0;i<t.length;i++)Nl(t[i],e)}function Dl(t,e){for(let i=0;i<t.length;i++)Ll(t[i],e)}class Ul extends Sl{constructor(t,e,i,n,r,o){super(t,e,i,n,r),(e=e||{}).extent||(e.extent=8192),this.zoomOffset=0,e.tileSize&&(this.zoomOffset=-function(t){if(Math.log2)return Math.log2(t);const e=Math.log(t)*Math.LOG2E,i=Math.round(e);return Math.abs(i-e)<1e-14?i:e}(e.tileSize[0]/256)),this.setData(e.data,o)}setData(t,e){if(delete this.index,!t)return void e();const i={maxZoom:24,tolerance:this.options.simplifyTolerance,extent:this.options.extent,buffer:this.options.tileBuffer||64,hasAltitude:!!this.options.hasAltitude,debug:0,lineMetrics:!0,indexMaxZoom:5,indexMaxPoints:1e5,disableFilter:!0};if(p(t)&&"{"!=t.substring(0,1)||t.url)A.getJSON(t.url?t.url:t,t.url?t:{},(t,n)=>{if(t&&e(t),!n)return void e(null,{extent:null,idMap:{}});const r=n,{first1000:o,idMap:s}=this.Lt(r);this.Dt(o,s,r,i,e)});else{"string"==typeof t&&(t=JSON.parse(t));const n=Array.isArray(t)?t:t.features;let r=n;n&&n.length>1e3&&(r=n.slice(0,1e3)),this.Dt(r,null,t,i,e)}}Dt(t,e,i,n,r){try{const o=t&&t.length?function(t){let e=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];switch(t.type){case"FeatureCollection":for(let i=0;i<t.features.length;i++)Rl(t.features[i],e);break;case"Feature":Rl(t,e);break;default:Cl(t,e)}return e}({type:"FeatureCollection",features:t}):null;this.index=function(t,e){return new Q(t,e)}(i,this.options.geojsonvt||n),r(null,{extent:o,idMap:e})}catch(t){console.warn(t),r({error:t.message})}}Lt(t){const e=[],i={};let n=0;function r(t){t&&("Feature"!==t.type||t.geometry)&&(void 0!==t.id&&null!==t.id||(t.id=n++),i[t.id]=f({},t),t.geometry?(i[t.id].geometry=f({},t.geometry),i[t.id].geometry.coordinates=null):t.coordinates&&(i[t.id].coordinates=null),e.length<1e3&&e.push(t))}return Array.isArray(t)?t.forEach(t=>{r(t)}):t.features&&t.features.forEach(t=>{r(t)}),{first1000:e,idMap:i}}getTileFeatures(t,e){const i=[];if(!this.index)return setTimeout((function(){e({loading:!0})}),1),1;const n=this.index.getTile(t.z+this.zoomOffset,t.x,t.y);if(!n||0===n.features.length)return setTimeout((function(){e(null,i,[])}),1),1;const r=[];for(let t=0,e=n.features.length;t<e;t++){const e=n.features[t];let o=e.layer;void 0===o&&(o="0"),r[o]={types:{}};r[o].types[e.type]=1,e.tags=e.tags||{},i.push({type:e.type,layer:o,id:e.id,geometry:e.geometry,properties:e.tags,extent:this.options.extent,geojson:!0})}for(const t in r)r[t].types=Object.keys(r[t].types).map(t=>+t);return setTimeout((function(){e(null,i,r)}),1),1}onRemove(){delete this.index}}var $l={\n/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nread:function(t,e,i,n,r){var o,s,a=8*r-n-1,l=(1<<a)-1,u=l>>1,c=-7,h=i?r-1:0,d=i?-1:1,f=t[e+h];for(h+=d,o=f&(1<<-c)-1,f>>=-c,c+=a;c>0;o=256*o+t[e+h],h+=d,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;c>0;s=256*s+t[e+h],h+=d,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),o-=u}return(f?-1:1)*s*Math.pow(2,o-n)},write:function(t,e,i,n,r,o){var s,a,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=c?(a=0,s=c):s+h>=1?(a=(e*l-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;t[i+f]=255&a,f+=p,a/=256,r-=8);for(s=s<<r|a,u+=r;u>0;t[i+f]=255&s,f+=p,s/=256,u-=8);t[i+f-p]|=128*m}},Wl=Hl,Jl=$l;function Hl(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Hl.Varint=0,Hl.Fixed64=1,Hl.Bytes=2,Hl.Fixed32=5;var Vl="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Gl(t){return t.type===Hl.Bytes?t.readVarint()+t.pos:t.pos+1}function Bl(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Xl(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function Zl(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Yl(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Kl(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Ql(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function tu(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function eu(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function iu(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function nu(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function ru(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function ou(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function su(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function au(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Hl.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,t(r,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ou(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=au(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ou(this.buf,this.pos)+4294967296*ou(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=ou(this.buf,this.pos)+4294967296*au(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Jl.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Jl.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,o=i.buf;if(r=o[i.pos++],n=(112&r)>>4,r<128)return Bl(t,n,e);if(r=o[i.pos++],n|=(127&r)<<3,r<128)return Bl(t,n,e);if(r=o[i.pos++],n|=(127&r)<<10,r<128)return Bl(t,n,e);if(r=o[i.pos++],n|=(127&r)<<17,r<128)return Bl(t,n,e);if(r=o[i.pos++],n|=(127&r)<<24,r<128)return Bl(t,n,e);if(r=o[i.pos++],n|=(1&r)<<31,r<128)return Bl(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Vl?function(t,e,i){return Vl.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){var n="",r=e;for(;r<i;){var o,s,a,l=t[r],u=null,c=l>239?4:l>223?3:l>191?2:1;if(r+c>i)break;1===c?l<128&&(u=l):2===c?128==(192&(o=t[r+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(o=t[r+1],s=t[r+2],128==(192&o)&&128==(192&s)&&((u=(15&l)<<12|(63&o)<<6|63&s)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(o=t[r+1],s=t[r+2],a=t[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((u=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),r+=c}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Hl.Bytes)return t.push(this.readVarint(e));var i=Gl(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Hl.Bytes)return t.push(this.readSVarint());var e=Gl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Hl.Bytes)return t.push(this.readBoolean());var e=Gl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Hl.Bytes)return t.push(this.readFloat());var e=Gl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Hl.Bytes)return t.push(this.readDouble());var e=Gl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Hl.Bytes)return t.push(this.readFixed32());var e=Gl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Hl.Bytes)return t.push(this.readSFixed32());var e=Gl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Hl.Bytes)return t.push(this.readFixed64());var e=Gl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Hl.Bytes)return t.push(this.readSFixed64());var e=Gl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Hl.Varint)for(;this.buf[this.pos++]>127;);else if(e===Hl.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Hl.Fixed32)this.pos+=4;else{if(e!==Hl.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),su(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),su(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),su(this.buf,-1&t,this.pos),su(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),su(this.buf,-1&t,this.pos),su(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn\'t fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}(i,0,e),function(t,e){var i=(7&t)<<4;if(e.buf[e.pos++]|=i|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Xl(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Jl.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Jl.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&Xl(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,Hl.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Zl,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Yl,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,tu,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Kl,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Ql,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,eu,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,iu,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,nu,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,ru,e)},writeBytesField:function(t,e){this.writeTag(t,Hl.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Hl.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Hl.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Hl.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Hl.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Hl.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Hl.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Hl.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Hl.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Hl.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var lu=Ot,uu=cu;function cu(t,e,i,n,r){this.properties={},this.extent=i,this.type=0,this.Ut=t,this.$t=-1,this.Wt=n,this.Jt=r,t.readFields(hu,this,e)}function hu(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){var i=t.readVarint()+t.pos;for(;t.pos<i;){var n=e.Wt[t.readVarint()],r=e.Jt[t.readVarint()];e.properties[n]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e.$t=i.pos)}function du(t){for(var e,i,n=0,r=0,o=t.length,s=o-1;r<o;s=r++)e=t[r],n+=((i=t[s]).x-e.x)*(e.y+i.y);return n}cu.types=["Unknown","Point","LineString","Polygon"],cu.prototype.loadGeometry=function(){var t=this.Ut;t.pos=this.$t;for(var e,i=t.readVarint()+t.pos,n=1,r=0,o=0,s=0,a=[];t.pos<i;){if(r<=0){var l=t.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)o+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&a.push(e),e=[]),e.push(new lu(o,s));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&a.push(e),a},cu.prototype.bbox=function(){var t=this.Ut;t.pos=this.$t;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,u=-1/0;t.pos<e;){if(n<=0){var c=t.readVarint();i=7&c,n=c>>3}if(n--,1===i||2===i)(r+=t.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=t.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,u]},cu.prototype.toGeoJSON=function(t,e,i){var n,r,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),u=cu.types[this.type];function c(t){for(var e=0;e<t.length;e++){var i=t[e],n=180-360*(i.y+a)/o;t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];c(l=h);break;case 2:for(n=0;n<l.length;n++)c(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,n,r=[],o=0;o<e;o++){var s=du(t[o]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(i&&r.push(i),i=[t[o]]):i.push(t[o]))}i&&r.push(i);return r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)c(l[n][r])}1===l.length?l=l[0]:u="Multi"+u;var d={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var fu=uu,pu=mu;function mu(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this.Ut=t,this.Wt=[],this.Jt=[],this.Ht=[],t.readFields(yu,this,e),this.length=this.Ht.length}function yu(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e.Ht.push(i.pos):3===t?e.Wt.push(i.readString()):4===t&&e.Jt.push(function(t){var e=null,i=t.readVarint()+t.pos;for(;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}mu.prototype.feature=function(t){if(t<0||t>=this.Ht.length)throw new Error("feature index out of bounds");this.Ut.pos=this.Ht[t];var e=this.Ut.readVarint()+this.Ut.pos;return new fu(this.Ut,e,this.extent,this.Wt,this.Jt)};var gu=pu;function bu(t,e,i){if(3===t){var n=new gu(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var vu=function(t,e){this.layers=t.readFields(bu,{},e)};class wu extends Sl{constructor(t,e,i,n,r,o){super(t,e,i,n,r),e=e||{},o()}getTileFeatures(t,e){const i=t.url;return A.getArrayBuffer(i,(t,i)=>{if(t)return void e(t);let n;try{n=new vu(new Wl(i.data))}catch(t){return void e(t.message,[],[])}const r=[];if(!n.layers)return void e(null,r,[]);const o={};let s;for(const e in n.layers)if(a=n.layers,l=e,Object.prototype.hasOwnProperty.call(a,l)){o[e]={types:{}};const i=o[e].types;for(let o=0,a=n.layers[e].length;o<a;o++)try{s=n.layers[e].feature(o),i[s.type]=1,r.push({type:s.type,layer:e,geometry:s.loadGeometry(),properties:s.properties,extent:s.extent})}catch(t){console.warn("error when load vt geometry:",t)}}var a,l;for(const t in o)o[t].types=Object.keys(o[t].types).map(t=>+t);e(null,r,o,{byteLength:i.data.byteLength})})}abortTile(t,e){const i=this.requests[t];delete this.requests[t],i&&i.abort&&i.abort(),this.Et(t),e()}onRemove(){for(const t in this.requests)this.requests[t].abort();this.requests={}}}let xu=0;const ku=new class{constructor(t){this.max=t,this.reset()}reset(){return this.data={},this.order=[],this}clear(){this.reset()}add(t,e){return this.has(t)?(this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t)):(this.data[t]=e,this.order.push(t),this.order.length>this.max&&this.getAndRemove(this.order[0])),this}has(t){return t in this.data}keys(){return this.order}getAndRemove(t){if(!this.has(t))return null;const e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e}get(t){return this.has(t)?this.data[t]:null}remove(t){return this.has(t)?(delete this.data[t],this.order.splice(this.order.indexOf(t),1),this):this}setMaxSize(t){for(this.max=t;this.order.length>this.max;)this.getAndRemove(this.order[0]);return this}}(128),Mu={};class ju{constructor(t){this.Vt={},this.Gt={},this.workerId=t}addLayer({actorId:t,mapId:e,layerId:i,params:n},r){if(this.Bt(e,i))return;const o=this.Xt(e,i),s=n.type,a=n.options,l=this.send.bind(this,t);this.Vt[o]="GeoJSONVectorTileLayer"===s?new Ul(i,a,l,ku,Mu,r):new wu(i,a,l,ku,Mu,r)}removeLayer({mapId:t,layerId:e},i){const n=this.Bt(t,e),r=this.Xt(t,e);delete this.Vt[r],n&&(n.onRemove(i),this.Zt())}loadTile({mapId:t,layerId:e,params:i},n){const r=this.Bt(t,e);r&&r.loadTile(i,n)}abortTile({mapId:t,layerId:e,params:i},n){const r=this.Bt(t,e);r&&r.abortTile&&r.abortTile(i.url,n)}removeTile({mapId:t,layerId:e,params:i},n){const r=this.Bt(t,e);r&&r.removeTile(i,n)}updateStyle({mapId:t,layerId:e,params:i},n){const r=this.Bt(t,e);r&&(r.updateStyle(i,n),this.Zt())}updateOptions({mapId:t,layerId:e,params:i},n){const r=this.Bt(t,e);r&&(r.updateOptions(i,n),this.Zt())}setData({mapId:t,layerId:e,params:i},n){const r=this.Bt(t,e);r&&(r.setData(i.data,n),this.Zt())}receive(t){const e=t.callback,i=this.Gt[e];delete this.Gt[e],i&&t.error?i(new Error(t.error)):i&&i(null,t.data)}send(t,e,i,n,r){const o=r?`${t}-${xu++}`:null;r&&(this.Gt[o]=r),postMessage({type:"<request>",workerId:this.workerId,actorId:t,command:e,params:i,callback:String(o)},n||[])}Xt(t,e){return`${t}-${e}`}Bt(t,e){const i=this.Xt(t,e);return this.Vt[i]}Zt(){const t=Object.keys(Mu);for(let e=0;e<t.length;e++)delete Mu[t[e]];ku.reset()}}t.initialize=function(){},t.onmessage=function(t,e){const i=t.data;if(this.dispatcher||(this.dispatcher=new ju(t.workerId)),"<response>"===t.type)this.dispatcher.workerId===t.workerId&&this.dispatcher.receive(t);else{const n=i.command;this.dispatcher[n]({actorId:t.actorId,mapId:i.mapId,layerId:i.layerId,params:i.params},(t,i,r)=>{t&&404!==t.status&&console.error(n,t),e(t,i,r)})}},Object.defineProperty(t,"Yt",{value:!0})}';let R$6=0;function N$6(){return R$6++}const L$5="function"==typeof Object.assign;function H$5(t,...e){if(L$5)return Object.assign(t,...e),t;for(let i=0;i<e.length;i++){const n=e[i];for(const e in n)t[e]=n[e]}return t}function V$5(t){return!q$4(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function U$4(t){return!q$4(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function q$4(t){return null==t}function G$4(t){for(let e=1;e<arguments.length;e++){const i=arguments[e];if(i)for(let e=0,n=i.length;e<n;e++)t.push(i[e])}return t.length}function W$4(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function B$6(t,e){let i;return i=e.altitudeToPoint?e.altitudeToPoint(100,t):e.distanceToPointAtRes(100,0,t).x,i/100/100}function $$4(t,e){if(!t||!e)return!1;if(t.length!=e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}const X$4=["GeoJSONVectorTileLayer"];class Y$3 extends t__namespace.worker.Actor{constructor(t,e){super(t);const i=e.getMap().id;this.t=e,this.i=i,this.o="vt_"+N$6();const n=e.getJSONType();this.s=X$4.indexOf(n)>=0,this.l={},this.h=new Bo$1({iconErrorUrl:e.options.iconErrorUrl,maxSize:e.options.maxIconSize});const r=!e.getRenderer().isEnableWorkAround("win-intel-gpu-crash");this.u=new Go$1((t=>{e.getMap().getRenderer().callInNextFrame(t)}),e.options.glyphSdfLimitPerFrame,r)}initialize(t){t(null)}addLayer(t){const e=this.t,i=e.getWorkerOptions()||{},n=this.o,r=e.getJSONType(),o={mapId:this.i,layerId:n,command:"addLayer",params:{type:r,options:i}};this.s?(void 0===this.l[n]&&(this.l[n]=this.getDedicatedWorker()),this.send(o,null,t,this.l[n])):this.broadcast(o,null,t)}abortTile(t,e){const i=this.o,n={mapId:this.i,layerId:i,command:"abortTile",params:{url:t}};this.s?(void 0===this.l[i]&&(this.l[i]=this.getDedicatedWorker()),this.send(n,null,e,this.l[i])):this.broadcast(n,null,e)}removeLayer(t){const e=this.o,i={mapId:this.i,layerId:e,command:"removeLayer"};this.s?(void 0!==this.l[e]&&this.send(i,null,t,this.l[e]),delete this.l[e]):this.broadcast(i,null,t)}updateStyle(t,e){const i=this.o,n={mapId:this.i,layerId:i,command:"updateStyle",params:t};this.s?void 0!==this.l[i]&&this.send(n,null,e,this.l[i]):this.broadcast(n,null,e)}updateOptions(t,e){const i=this.o,n={mapId:this.i,layerId:i,command:"updateOptions",params:t};this.s?void 0!==this.l[i]&&this.send(n,null,e,this.l[i]):this.broadcast(n,null,e)}loadTile(t,e){const i=H$5({},t);i.tileInfo=function(t){const e={};for(const i in t)null!=t[i]&&(e[i]=t[i].toJSON?t[i].toJSON():t[i]);return e}(t.tileInfo);const n=this.o,r={mapId:this.i,layerId:n,command:"loadTile",params:i},{x:o,y:s}=t.tileInfo;this.send(r,null,e,void 0===this.l[n]?this.workers[(o+s)%this.workers.length].id:this.l[n])}remove(){super.remove(),this.l={}}fetchIconGlyphs({icons:t,glyphs:e},i){this.u.getGlyphs(e,((e,n)=>{if(e)throw e;const r=n.buffers||[];this.h.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&e.buffers.length&&r.push(...e.buffers),i(null,{icons:e.icons,glyphs:n.glyphs},r)}))}))}setData(t,e){const i=this.o;this.send({mapId:this.i,layerId:i,command:"setData",params:{data:t}},null,e,this.l[i])}p(t){return t.id}}const J$4={};class Z$4{constructor(t,e,i){this.m=t,this.g=e,this.v=i||[0,1,0]}draw(t,e,i,n,r){if(this.A||this.k(),!this._){this._=this.m.buffer(K$5(n));this.S=this.m.buffer(Q$4(n,n/i))}if(n!==this.T){const t=n/i;this._(K$5(n)),this.S(Q$4(n,t))}this.T=n;let o=this.M;if(!o){const t=this.g.getDevicePixelRatio()>1?2:1;o=this.M=document.createElement("canvas"),o.width=512*t,o.height=64*t;const e=o.getContext("2d");e.font="36px monospace",e.scale(t,t),this.P=this.m.texture({width:o.width,height:o.height,data:o})}const s=o.getContext("2d");s.clearRect(0,0,o.width,o.height),s.fillStyle=`rgba(${this.v.map((t=>255*t)).join()})`,s.fillText(t,20,36),this.P({width:o.width,height:o.height,data:o}),this.A({transform:e,data:this._,debugLine:1,primitive:"lines",framebuffer:r||null,image:this.P,count:8}),this.A({transform:e,data:this.S,debugLine:0,primitive:"triangle strip",framebuffer:r||null,image:this.P,count:4})}delete(){this.P&&(this.P.destroy(),delete this.P),this.I&&(this.I.destroy(),delete this.I),this._&&(this._.destroy(),this.S.destroy(),delete this._,delete this.S),this.A&&(this.A.destroy(),delete this.A)}k(){this.I=this.m.buffer(new Uint8Array([0,0,0,1,1,0,1,1,0,0,0,1,1,0,1,1])),this.A=this.m({vert:"\n                attribute vec2 aPosition;\n                attribute vec2 aTexCoord;\n                uniform mat4 transform;\n\n                varying vec2 vTexCoord;\n                void main()\n                {\n                    gl_Position = transform * vec4(aPosition, 0.0, 1.0);\n                    vTexCoord = aTexCoord;\n                }\n            ",frag:"\n                precision mediump float;\n                uniform sampler2D uImage;\n                uniform vec3 uColor;\n                uniform float uOpacity;\n                uniform float uDebugLine;\n\n                varying vec2 vTexCoord;\n\n                void main()\n                {\n                    if (uDebugLine == 1.) {\n                        gl_FragColor = vec4(uColor, 1.0) * uOpacity;\n                    } else {\n                        gl_FragColor = texture2D(uImage, vTexCoord) * uOpacity;\n                    }\n                    gl_FragColor *= gl_FragColor.a;\n                }\n            ",attributes:{aPosition:this.m.prop("data"),aTexCoord:this.I},uniforms:{transform:this.m.prop("transform"),uColor:this.v,uOpacity:1,uDebugLine:this.m.prop("debugLine"),uImage:this.m.prop("image")},count:this.m.prop("count"),primitive:this.m.prop("primitive"),depth:{enable:!1,mask:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},stencil:{enable:!1},viewport:{x:0,y:0,width:()=>this.g.getRenderer().canvas.width,height:()=>this.g.getRenderer().canvas.height},framebuffer:this.m.prop("framebuffer")})}}function K$5(t){return new Uint16Array([0,0,0,t,0,t,t,t,t,t,t,0,t,0,0,0])}function Q$4(t,e){return new Uint16Array([0,t-64*e,0,t,512*e,t-64*e,512*e,t])}const tt$3=new Uint8Array([0,0,0,1,1,0,1,0,0,1,1,1]),et$3=[];class it$3{constructor(t,e,n){this.m=t,(this.O=new Z$7({aPosition:tt$3},null,tt$3.length/2,{positionSize:2})).generateBuffers(t),this.C=new pe$4,this.F=[],this.j=0,this.D=e,this.g=n,this.k(t)}start(){this.j=0,this.C.clear()}add(t,e,i){const o=this.R(i);o.setUniform("ref",t),set$4(et$3,e,e,1);const s=o.localTransform;fromScaling(s,et$3),mul$5(s,i,s),o.setLocalTransform(s),this.C.addMesh(o)}render(t){this.N.render(this.L,{projViewMatrix:this.g.projViewMatrix},this.C,t)}R(){const t=this.j++;return this.F[t]||(this.F[t]=new de$4(this.O)),this.F[t]}k(t){const e=this.D,n={viewport:{x:0,y:0,width:()=>e.width,height:()=>e.height},stencil:{enable:!0,mask:255,func:{cmp:"always",ref:(t,e)=>e.ref,mask:255},op:{fail:"replace",zfail:"replace",zpass:"replace"}},depth:{enable:!0,func:"always",mask:!1},colorMask:[!1,!1,!1,!1]};this.L=new rt$6({vert:"\n#define SHADER_NAME TILE_STENCIL_VERT\nattribute vec2 aPosition;\nuniform mat4 projViewModelMatrix;\n\nvoid main()\n{\n    gl_Position = projViewModelMatrix * vec4(aPosition, 0.0, 1.0);\n}\n",frag:"\n#define SHADER_NAME TILE_STENCIL_FRAG\nvoid main()\n{\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 0.1);\n}\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],extraCommandProps:n}),this.N=new k$7(t)}remove(){this.O.dispose();for(let t=0;t<this.F.length;t++)this.F[t].dispose();this.F.length=0,this.L.dispose()}}const nt$3="__fea_idx".trim();function rt$3(t,e,i,n,r){const o={};if(function(t){if(!t)return!1;for(const e in t)if(null!=t[e])return!0;return!1}(t))for(let s=0,a=(e||t).length;s<a;s++){let a=e?t[e[s]]:t[s];"id"===r.options.features&&r.getFeature&&(a=r.getFeature(a),a.layer=i),o[e?e[s]:a[nt$3]]={feature:a,symbol:n}}return o}const ot$3=[],st$3=[0,0,0,0],at$3=new t__namespace.Point(0,0);class lt$3 extends t__namespace.renderer.TileLayerCanvasRenderer{supportRenderMode(){return!0}constructor(t){super(t),this.ready=!1,this.H=0,this.V={},this.U=[],this.q={},this.G={}}getTileLevelValue(t,e){if(this.isBackTile(t.id)){const i=t.z;return i-e>=0?0:e-i}return 0}getWorkerConnection(){return this.W}setStyle(){if(this.B&&this.B.update(),this.W){this.H++,this.$();const t=this.layer.X();t.styleCounter=this.H,this.W.updateStyle(t,(t=>{if(t)throw new Error(t);this.Y=!0,this.J(),this.setToRedraw(),this.layer.fire("refreshstyle")}))}else this.J()}$(){if(this.Z)for(const t in this.Z){const e=this.Z[t];e&&this.deleteTile(e)}this.Z=this.tilesInView;const t=this.tileCache;for(const e in this.Z){const i=this.Z[e];i&&i.info&&t.getAndRemove(i.info.id)}t.reset(),this.tilesInView={},this.tilesLoading={},this._parentTiles=[],this._childTiles=[]}updateOptions(t){this.W&&this.W.updateOptions(this.layer.getWorkerOptions(),(e=>{if(e)throw new Error(e);(t.features||t.pickingGeometry||t.altitudeProperty)&&(this.clear(),this.K(),this.J()),this.setToRedraw()}))}updateSceneConfig(t,e,i){const n=0===t?this.tt():this.et();if(!n||!n[e])return;this.Y=!0;const r=this.layer.X(),o=this.layer.it(t,r);n[e].config=o[e].renderPlugin,n[e].updateSceneConfig({sceneConfig:i}),this.setToRedraw()}updateDataConfig(t,e,i,n){const r=0===t?this.tt():this.et();r&&r[e]&&(this.Y=!0,r[e].updateDataConfig(i,n)?this.setStyle():this.setToRedraw())}updateSymbol(t,e,i){const n=0===t?this.tt():this.et();if(!n||!n[e])return!1;const r=this.layer.X(),o=this.layer.it(t,r),s=n[e];s.style=o[e];const a=s.updateSymbol(i,o[e].symbol);return this.setToRedraw(),a}needToRedraw(){if(this.U.length)return!0;const t=super.needToRedraw();if(!t){const t=this.nt();for(let e=0;e<t.length;e++)if(t[e]&&t[e].needToRedraw())return!0}return t}needRetireFrames(){if(this.Y)return!0;const t=this.nt();for(let e=0;e<t.length;e++)if(t[e]&&t[e].needToRetireFrames())return!0;return!1}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;t?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):this.rt(),t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.ot=new Z$4(this.regl,this.getMap()),this.st(),this.B=new y$5(this.regl,this.layer)}rt(){const t=this.layer,e=t.options.glOptions||{alpha:!0,depth:!0,antialias:this.layer.options.antialias};e.preserveDrawingBuffer=!0,e.stencil=!0,this.glOptions=e,this.gl=this.gl||this.lt(this.canvas,e),this.regl=u$5({gl:this.gl,attributes:e,extensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives"],optionalExtensions:t.options.glExtensions||["OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_draw_buffers","EXT_shader_texture_lod"]})}st(){this.W||(this.W=new Y$3("@maptalks/vt",this.layer)),this.W.addLayer(((t,e)=>{this.layer&&(this.ready=!0,this.layer.onWorkerReady(t,e),this.layer.fire("workerready"),this.setToRedraw())}))}clearCanvas(){super.clearCanvas(),this.regl&&this.regl.clear(this.glOptions.depth?{color:st$3,depth:1,stencil:0}:{color:st$3,stencil:0})}isDrawable(){return!0}checkResources(){return ot$3}_drawTiles(t,e,i,n,r){if(super._drawTiles(t,e,i,n,r),this.Z)if(Object.keys(this.Z).length)for(const t in this.Z){const e=this.Z[t];this.tileCache.has(e.id)||this._drawTile(e.info,e.image,r)}else this.ht(),delete this.Z}ht(){const t=this.H,e=[],i=[];for(const i in this.q)+i!==t&&(e.push(i),this.tt(i).forEach((t=>{t.remove()})));for(const e in this.G)+e!==t&&(i.push(e),this.et(e).forEach((t=>{t.remove()})));for(let t=0;t<e.length;t++)delete this.q[e[t]];for(let t=0;t<i.length;t++)delete this.G[i[t]]}draw(t,e){this.ct!==t&&(this.Y=!1,this.ut());const i=this.layer;if(this.prepareCanvas(),!this.ready||!i.ready)return void this.completeRender();let n=this.q[this.H];n||(this.J(),n=this.tt());const r=this.et();i.isDefaultRender()||n.length||r.length?(i.options.collision&&(i.clearCollisionIndex(),i.clearBackgroundCollisionIndex()),this.dt=t,this.ft=this.pt(this.getMap().getGLRes()),this.yt=e||{},this.gt(t),(!e||e&&e.isFinalRender)&&this.vt(),super.draw(t),this.ct!==t&&this.bt(t),this.xt(t),this.completeRender(),this.ct=t):this.completeRender()}ut(){this.nt().forEach(((t,e)=>{t.renderIndex=e}))}bt(){const t=this.nt();this.wt=[];let e=+!!this.layer.getGroundConfig().enable;t.forEach(((t,i)=>{t.isVisible()&&ut$3(t)&&(this.wt[i]=e,t.needPolygonOffset()&&e++)})),this.At=e}getFrameTimestamp(){return this.dt}drawOnInteracting(t,e,i){this.draw(e,i)}drawOutline(t){(this.kt||this._t)&&(this._t?this.paintOutlineAll(t):this.kt.forEach((e=>{this[e[0]](t,...e[1])})))}getShadowMeshes(){const t=[];return this.St().forEach(((e,i)=>{if(!e)return;if(!this.Tt(i))return;const n=e.getShadowMeshes();if(Array.isArray(n))for(let e=0;e<n.length;e++)t.push(n[e])})),t}isForeground(t){return!(!this.Mt||!this.Mt[t.properties.tile.id])}isTileNearCamera(t){return this.getCurrentTileZoom()-t.properties.tile.z<=1}isBackTile(t){return!(!this.Pt||!this.Pt[t])}loadTile(t){const{url:e}=t,i=this.V[e];if(i)i.keys[t.id]||(i.tiles.push(t),i.keys[t.id]=1);else{const i=this.getTilePointAtTileRes(t.z),n=this.getTileGLScale(t.z);this.V[e]={keys:{},tiles:[t]},this.V[e].keys[t.id]=1,this.W.loadTile({tileInfo:t,glScale:n,zScale:this.ft,pointAtTileRes:i,styleCounter:this.H},this.It.bind(this,e))}return{}}getTileGLScale(t){const e=this.getMap();return this.layer.getSpatialReference().getResolution(t)/e.getGLRes()}getTilePointAtTileRes(t){const e=this.getMap(),i=this.layer.getSpatialReference();return e.distanceToPointAtRes(100,100,i.getResolution(t)).x/1e4}It(t,e,i){if(!this.V[t])return;if(i&&i.canceled)return;const n=this.layer,r=n.isDefaultRender(),{tiles:o}=this.V[t];if(delete this.V[t],e){if(e.status&&404===e.status)for(let t=0;t<o.length;t++){this.onTileError(J$4,o[t])}return}if(!i){for(let t=0;t<o.length;t++){this.onTileLoad({Ot:!0},o[t])}return}if(i.style!==this.H)return;let s=!1;const a=i.features,l=[];for(let t=0;t<i.data.length;t++){const e=i.data[t];if(!e||!e.data||!e.styledFeatures.length)continue;const{isUpdated:n,layer:r}=this.Ct(0,t,e,a,l);l.push(r),n&&(s=n)}for(let t=0;t<i.featureData.length;t++){const e=i.featureData[t];e&&e.data&&e.styledFeatures.length&&this.Ct(1,t,e,a)}s&&n.Et();const c=this.layer.getDataSchema(o[0].z);if(this.Ft(c,i.schema),delete i.features,r&&i.data.length!==l.length){const t=i.data;i.data=[];for(let e=0;e<t.length;e++)t[e]&&t[e].features&&i.data.push(t[e])}i.layers=l;for(let t=0;t<o.length;t++){const e=o[t],n=0===t?i:ht$3(i);for(let t=0;t<n.data.length;t++){if(!n.data[t])continue;const i=n.data[t].features;for(const t in i)i[t].tile=e}e.extent=n&&n.extent,this.U.push({tileData:n,tileInfo:e})}this.layer.fire("datareceived",{url:t})}Ct(t,e,i,n){const{style:r,isUpdated:o}=this.zt(t,e,i.data),s=this.layer,a=s.isDefaultRender(),h=rt$3(n,i.styledFeatures,e,r.symbol,s);delete i.styledFeatures,i.features=h;let c=i.data;return Array.isArray(c)&&(c=c[0]),{isUpdated:o,layer:a?{layer:c.layer,type:c.type}:null}}Ft(t,e){for(const i in e){t[i]||(t[i]={types:e[i].types,properties:{}});const n=e[i].properties,r=t[i].properties;for(const t in n)(!r[t]||r[t]&&"object"!==n[t]&&"object"===r[t])&&(r[t]=n[t])}}zt(t,e,i){Array.isArray(i)&&(i=i[0]);const n=this.layer;let r,o=!1;if(n.isDefaultRender()&&0===t){let t=this.jt;t||(t=this.jt={});const e=i.layer,n=i.type;t[e]||(t[e]=[]);const s=("plugin_"+n).trim();t[e][s]?r=t[e][s]:(r=this.Dt(n),r.filter=i.filter,t[e].push(r),t[e][s]=r,o=!0)}else{const s=n.X(),a=n.it(t,s),l=this.tt();if(r=a[e],!r.renderPlugin){o=!0;const{plugin:t,symbol:n,renderPlugin:s}=this.Dt(i.type);l[e]=t,r.symbol=n,r.renderPlugin=s}}return{style:r,isUpdated:o}}nt(t){const e=t&&t.style;let i=this.tt(e)||[];this.layer.isDefaultRender()&&this.jt&&(i=[],t?t.layers&&t.layers.forEach((t=>{const e=("plugin_"+t.type).trim();i.push(this.jt[t.layer][e].plugin)})):Object.keys(this.jt).forEach((t=>{for(let e=0;e<this.jt[t].length;e++)i.push(this.jt[t][e].plugin)})));const n=this.et(e);return n&&n.length&&(i=i.slice(),G$4(i,n)),i}St(){if(this.layer.isDefaultRender()&&this.jt){const t=[];return Object.keys(this.jt).forEach((e=>{for(let i=0;i<this.jt[e].length;i++)t.push(this.jt[e][i].plugin)})),t}const t=[];for(const e in this.q)t.push(...this.q[e]);for(const e in this.G)t.push(...this.G[e]);return t}tt(t){return q$4(t)&&(t=this.H),this.q[t]||ot$3}et(t){return q$4(t)&&(t=this.H),this.G[t]||ot$3}gt(t){const e=this.layer.isDefaultRender()&&this.jt,i=this.yt;this.St().forEach(((n,r)=>{if(!n)return;if(!this.Tt(r))return;const s={regl:this.regl,layer:this.layer,symbol:e?n.defaultSymbol:n.style&&n.style.symbol,gl:this.gl,sceneConfig:n.config?n.config.sceneConfig:null,dataConfig:n.config?n.config.dataConfig:null,pluginIndex:r,timestamp:t};i&&H$5(s,i),n.startFrame(s)}))}xt(t){const e=this.yt,i=e.renderMode,n=e&&e.renderTarget&&e.renderTarget.fbo,r=this.getMap().cameraPosition,o=this.St();o.forEach(this.layer.options.collision?e=>{if(!ut$3(e))return;if(i&&"default"!==i&&!e.supportRenderMode(i))return;const n=this.Rt(e,0,r,t);e.prepareRender(n),e.updateCollision(n)}:e=>{if(!ut$3(e))return;if(i&&"default"!==i&&!e.supportRenderMode(i))return;const n=this.Rt(e,0,r,t);e.prepareRender(n)});const s=!e.timestamp||e.isFinalRender;let l=!1;if(this.ct!==e.timestamp){const e=-this.layer.getPolygonOffset(),i=this.Rt(null,e,r,t);i.offsetFactor=i.offsetUnits=e,this.B.paint(i)}o.forEach(((e,o)=>{if(!this.Nt(e))return;if(i&&"default"!==i&&!e.supportRenderMode(i))return;this.regl.clear({stencil:255,fbo:n}),this.isEnableTileStencil()&&e.painter&&!e.painter.needClearStencil()&&this.Lt(n);const a=this.Rt(e,this.wt[o]||0,r,t),h=e.endFrame(a);h&&h.redraw&&this.setToRedraw(),l=!0})),l&&this.layer.fire("canvasisdirty"),s&&this.Ht()}getPolygonOffsetCount(){return this.At||0}Ht(){if(this.layer.options.debug){const t=this.yt,e=[],i=this.getMap().projViewMatrix;for(const n in this.tilesInView){const o=this.tilesInView[n].info,s=o.transform,a=this.tilesInView[n].image.extent,l=t&&t.renderTarget;if(s&&a){const t=this.getDebugInfo(o.id),n=multiply$5(e,i,s),h=this.layer.getTileSize().width;this.ot.draw(t,n,h,a,l&&l.fbo)}}}}Nt(t){if(!t)return!0;const i=this.yt,n=this.Tt(t.renderIndex),r=i&&i.states&&i.states.includesChanged,o=this.Vt(t.painter.scene.getMeshes());return n&&(r||o)?o?2:1:0}Rt(t,e,i,n){const r={regl:this.regl,layer:this.layer,gl:this.gl,sceneConfig:t&&t.config.sceneConfig,pluginIndex:t&&t.renderIndex,polygonOffsetIndex:e,cameraPosition:i,timestamp:n},o=this.yt;return o&&H$5(r,o),r}Vt(t){if(!t)return!1;const e=this.yt&&this.yt.sceneFilter;return e?t.filter((t=>e(t)||t.properties.hlBloomMesh&&e(t.properties.hlBloomMesh))).length>0:t.length>0}Lt(t){const e=this.isEnableTileStencil(),i=this.getCurrentTileZoom();let n=this.Ut;n||(n=this.Ut=new it$3(this.regl,this.canvas,this.getMap())),n.start();const{tiles:r}=this.qt;let{parentTiles:o,childTiles:s}=this.qt,a=1;s=s.sort(ct$3);for(let t=0;t<s.length;t++)this.Gt(s[t].info,e?a:this.getTileLevelValue(s[t].info.z,i)),a++;o=o.sort(ct$3);for(let t=0;t<o.length;t++)this.Gt(o[t].info,e?a:this.getTileLevelValue(o[t].info.z,i)),a++;const l=r.sort(ct$3);for(let t=l.length-1;t>=0;t--)this.Gt(l[t].info,e?a:this.getTileLevelValue(l[t].info.z,i)),a++;n.render(t)}Gt(t,e){const i=at$3.set(t.extent2d.xmin,t.extent2d.ymax),n=t.transform=t.transform||this.calculateTileMatrix(i,t.z,t.extent);t.stencilRef=e,this.Ut.add(e,t.extent,n)}onDrawTileStart(t){super.onDrawTileStart(t);const{tiles:e,childTiles:i,parentTiles:n}=t;this.Mt={},this.Pt={};for(let t=0;t<e.length;t++)this.Mt[e[t].info.id]=1;for(let t=0;t<i.length;t++)this.Pt[i[t].info.id]=1;for(let t=0;t<n.length;t++)this.Pt[n[t].info.id]=1;this.qt=t}isEnableTileStencil(){return this.layer.isOnly2D()}drawTile(t,e){if(!e.cache)return;const i=e.cache,n=at$3.set(t.extent2d.xmin,t.extent2d.ymax),r=t.transform=t.transform||this.calculateTileMatrix(n,t.z,t.extent),o=t.tileTranslationMatrix=t.tileTranslationMatrix||this.calculateTileTranslationMatrix(n,t.z),s=[];G$4(s,e.data),G$4(s,e.featureData),this.nt(e).forEach(((n,a)=>{if(!n)return;const l=this.Tt(a);if(!s[a]||!l)return;if(!i[a])return;const c=n.paintTile({regl:this.regl,layer:this.layer,gl:this.gl,sceneConfig:n.config.sceneConfig,pluginIndex:a,tileCache:i[a],tileData:s[a],tileTransform:r,tileTranslationMatrix:o,tileExtent:e.extent,timestamp:this.dt,tileInfo:t,tileZoom:this._tileZoom,bloom:this.yt&&this.yt.bloom});!this.Y&&(c.retire||c.redraw)&&n.supportRenderMode("taa")&&(this.Y=!0),c.redraw&&this.setToRedraw()})),e&&e.style===this.H&&this.Wt(t),this.setCanvasUpdated()}Bt(t,e){if(!e.loadTime||e.Ot)return;let i=e.cache;i||(i=e.cache={});const n=at$3.set(t.extent2d.xmin,t.extent2d.ymax),r=t.transform=t.transform||this.calculateTileMatrix(n,t.z,e.extent),o=t.tileTranslationMatrix=t.tileTranslationMatrix||this.calculateTileTranslationMatrix(n,t.z),s=[];G$4(s,e.data),G$4(s,e.featureData),this.nt(e).forEach(((n,a)=>{if(!n)return;const l=this.Tt(a);if(!s[a]||!l)return;i[a]||(i[a]={});const c=n.createTile({regl:this.regl,layer:this.layer,gl:this.gl,sceneConfig:n.config.sceneConfig,pluginIndex:a,tileCache:i[a],tileData:s[a],tileTransform:r,tileTranslationMatrix:o,tileExtent:e.extent,timestamp:this.dt,tileInfo:t,tileZoom:this._tileZoom});i[a].geometry&&(s[a]=1),!this.Y&&c.retire&&n.supportRenderMode("taa")&&(this.Y=!0)}))}vt(){let t=0;const e=this.layer.options.meshLimitPerFrame,i=this.U;for(;i.length&&t<e;){const{tileData:e,tileInfo:n}=i.shift();e.style===this.H&&(this.onTileLoad(e,n),this.Bt(n,e),t++)}}pick(t,e,i){const n=[];return this.nt().forEach(((r,o)=>{if(!r)return;if(!this.Tt(o))return;const s=r.pick(t,e,i.tolerance);s&&(s.type=r.getType(),n.push(s))})),n}deleteTile(t){if(t){if(t.image&&!t.image.Ot){const i=this.tt(t.image&&t.image.style);i&&i.forEach(((e,i)=>{e&&e.deleteTile({pluginIndex:i,regl:this.regl,layer:this.layer,gl:this.gl,tileCache:t.image.cache?t.image.cache[i]:{},tileInfo:t.info,tileData:t.image})})),t.image.cache={}}super.deleteTile(t)}}abortTileLoading(t,e){e&&e.url&&(this.W&&this.W.abortTile(e.url),delete this.V[e.url]),super.abortTileLoading(t,e)}resizeCanvas(t){super.resizeCanvas(t);const e=this.canvas;e&&(!this.pickingFBO||this.pickingFBO.width===e.width&&this.pickingFBO.height===e.height||this.pickingFBO.resize(e.width,e.height),this.nt().forEach((t=>{t&&t.resize(e.width,e.height)})))}onRemove(){this.Ut&&this.Ut.remove(),this.W&&(this.W.removeLayer((t=>{if(t)throw t})),this.W.remove(),delete this.W),this.pickingFBO&&(this.canvas.pickingFBO||this.pickingFBO.destroy(),delete this.pickingFBO),this.ot&&this.ot.delete(),super.onRemove&&super.onRemove(),this.K()}K(){this.St().forEach((t=>{t.remove()})),this.plugins={}}hitDetect(t){if(!this.gl||!this.layer.options.hitDetect)return!1;const e=this.gl,i=new Uint8Array(4);return e.readPixels(t.x,this.canvas.height-t.y,1,1,e.RGBA,e.UNSIGNED_BYTE,i),i[3]>0}J(){const{style:t,featureStyle:e}=this.layer.X(),i=t.map(((t,e)=>{const i=t.renderPlugin;if(!i)return null;if(!i.type)throw new Error("invalid plugin type for style at "+e);const n=this.$t(i);return n.styleCounter=this.H,n.style=t,n})),n=[];e.forEach(((t,e)=>{const i=t.renderPlugin;if(!i)return null;if(!i.type)throw new Error("invalid plugin type for features at "+e);const r=this.$t(i);return r.style=t,r.styleCounter=this.H,n.push(r),r}));const r=this.H;return this.q[r]=i,this.G[r]=n,this.layer.fire("pluginsinited"),i}$t(t){const e=this.layer.constructor.getPlugins()[t.type];if(!e)throw new Error(`Plugin for (${t.type}) is not loaded.`);const i=new e;return i.config=t,i.config.sceneConfig||(i.config.sceneConfig={}),i}lt(t,e){const i=["webgl","experimental-webgl"];let n=null;for(let r=0;r<i.length;++r){try{n=t.getContext(i[r],e)}catch(t){}if(n)break}return n}pt(t){return B$6(t,this.getMap())}debugFBO(t,e){const i=document.getElementById(t),n=e.width,r=e.height;i.width=n,i.height=r;const o=i.getContext("2d"),s=this.regl.read({framebuffer:e}),a=r/2|0,l=4*n;for(let t=0;t<s.length;t++)s[t]*=255;const h=new Uint8Array(4*n);for(let t=0;t<a;++t){const e=t*l,i=(r-t-1)*l;h.set(s.subarray(e,e+l)),s.copyWithin(e,i,i+l),s.set(h,i)}const c=new ImageData(n,r);c.data.set(s),o.putImageData(c,0,0)}Dt(t){let e;switch(t){case"native-line":e={type:"native-line",dataConfig:{type:"native-line",only2D:!0}};break;case"native-point":e={type:"native-point",dataConfig:{type:"native-point",only2D:!0}};break;case"fill":e={type:"fill",dataConfig:{type:"fill",only2D:!0},sceneConfig:{antialias:!0}};break;default:e=null}const i=function(t){switch(t){case"native-point":return{markerFill:"#f00",markerSize:6,markerOpacity:.5};case"native-line":return{lineColor:"#bbb",lineOpacity:.5};case"fill":return{polygonFill:"#00f",polygonOpacity:.6}}return null}(t),n=this.$t(e);return n.defaultSymbol=i,{plugin:n,symbol:i,renderPlugin:e}}Tt(){return!0}isEnableWorkAround(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&function(t){const e=t.getExtension("WEBGL_debug_renderer_info");if(e&&"undefined"!=typeof navigator){const i=t.getParameter(e.UNMASKED_RENDERER_WEBGL),n="Win32"===navigator.platform||"Win64"===navigator.platform;if(i&&i.toLowerCase().indexOf("intel")>=0&&n)return!0}return!1}(this.gl)}getZScale(){return this.ft}outline(t,e){e&&(Array.isArray(e)||(e=[e]),this.kt||(this.kt=[]),this.kt.push(["paintOutline",[t,e]]),this.setToRedraw())}outlineFeatures(t){t&&(Array.isArray(t)||(t=[t]),this.kt||(this.kt=[]),this.kt.push(["paintOutline",[null,t]]),this.setToRedraw())}outlineBatch(t){this.kt||(this.kt=[]),this.kt.push(["paintBatchOutline",[t]]),this.setToRedraw()}outlineAll(){this._t=!0,this.setToRedraw()}paintOutlineAll(t){const e=this.nt();for(let i=0;i<e.length;i++)e[i].outlineAll(t)}paintOutline(t,e,i){if(!q$4(e)){const n=e,r=this.nt();if(!r[n]||r[n].painter&&!r[n].painter.isVisible())return;return void r[n].outline(t,i)}const n=this.nt();for(let e=0;e<i.length;e++){const r=i[e];for(let e=0;e<n.length;e++)n[e].style&&n[e].style.id===r&&n[e].outline(t,[r])}}paintBatchOutline(t,e){const i=this.nt();!i[e]||i[e].painter&&!i[e].painter.isVisible()||i[e].outlineAll(t)}cancelOutline(){delete this.kt,delete this._t,this.setToRedraw()}setZIndex(){return this.setToRedraw(),this.Y=!0,super.setZIndex.apply(this,arguments)}onTileLoad(t,e){t.Ot&&this.Wt(e),super.onTileLoad(t,e)}onTileError(t,e){this.Wt(e),super.onTileError(t,e)}Wt(t){const{id:e}=t;if(this.Z&&this.Z[e]){this.deleteTile(this.Z[e]),delete this.Z[e]}}highlight(t){if(this.Xt||(this.Xt={}),Array.isArray(t))for(let e=0;e<t.length;e++)this.Xt[t[e].id]=t[e];else this.Xt[t.id]=t;this.nt().forEach((t=>{t.highlight(this.Xt)}))}cancelHighlight(t){if(Array.isArray(t))for(let e=0;e<t.length;e++)delete this.Xt[t[e]];else delete this.Xt[t];this.nt().forEach((t=>{t.highlight(this.Xt)}))}cancelAllHighlight(){delete this.Xt,this.nt().forEach((t=>{t.cancelAllHighlight()}))}}function ht$3(t){let e;Array.isArray(t.data)?(e=[],G$4(e,t.data)):(e={},H$5(e,t.data));const i=H$5({},t);return i.data=e,i}function ct$3(t,e){return e.info.z-t.info.z}function ut$3(t){const e=t.painter&&t.painter.scene&&t.painter.scene.getMeshes();return e&&e.length}function dt$3(t,e,i){for(let n=0;n<t.length;n++){const r=t[n],o=H$5({},r),{renderPlugin:s}=r,a=H$5({},s);a.sceneConfig&&!Object.keys(a.sceneConfig).length&&delete a.sceneConfig;let l=-1;for(let t=i.length-1;t>=0;t--)if(fastDeepEqual(a,i[t])){l=t;break}l<0&&(l=i.length,i.push(a)),o.renderPlugin=l,e.push(o)}}lt$3.include({calculateTileMatrix:function(){const t=new Array(3),e=new Array(3),i=new Array(3);return function(o,s,a){const l=this.getTileGLScale(s),h=o,c=this.layer.getTileSize(),u=identity$2([]);return scale$5(u,u,set$4(t,l,l,this.ft)),translate$1(u,u,set$4(e,h.x,h.y,0)),scale$5(u,u,set$4(i,c.width/a,-c.height/a,1)),u}}(),calculateTileTranslationMatrix:function(){const t=new Array(3);return function(e,i){const o=this.getTileGLScale(i),s=e,a=identity$2([]);return translate$1(a,a,set$4(t,s.x*o,s.y*o,0)),a}}()});const ft$3="function"==typeof fetch&&"function"==typeof AbortController,pt$3={jsonp:function(t,e){const i="_maptalks_jsonp_"+N$6();t.match(/\?/)?t+="&callback="+i:t+="?callback="+i;let n=document.createElement("script");return n.type="text/javascript",n.src=t,window[i]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[i]},document.getElementsByTagName("head")[0].appendChild(n),this},get:function(t,e,i){if(U$4(e)){const t=i;i=e,e=t}(e=e||{}).method&&(e.method=e.method.toUpperCase());const n="POST"===e.method;if(ft$3){const r=new AbortController,o={signal:r.signal,method:e.method||"GET",referrerPolicy:"origin"};return n&&(q$4(e.body)||(o.body=JSON.stringify(e.body))),q$4(e.headers)||(o.headers=e.headers),q$4(e.credentials)||(o.credentials=e.credentials),fetch(t,o).then((n=>{const r=this.Yt(n,e.returnJSON,e.responseType);r.message?(r.url=t,i(r)):r.then((t=>{i(null,"arraybuffer"===e.responseType?{data:t,cacheControl:n.headers.get("Cache-Control"),expires:n.headers.get("Expires"),contentType:n.headers.get("Content-Type")}:t)})).catch((t=>{t.code&&t.code===DOMException.ABORT_ERR||(console.error(t),i(t))}))})).catch((t=>{t.code&&t.code===DOMException.ABORT_ERR||(console.error(t),i(t))})),r}{const r=pt$3.Jt(i);if(r.open(e.method||"GET",t,!0),e){for(const t in e.headers)r.setRequestHeader(t,e.headers[t]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(n?e.body:null),r}},Yt:(t,e,i)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===i?t.arrayBuffer():e?t.json():t.text(),Zt:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e({status:200,statusText:t.statusText,message:"http status 200 returned without content."}):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e({status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}))}},Jt:function(t){let e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=pt$3.Zt(e,t),e},getArrayBuffer(t,e,i){if(U$4(e)){const t=i;i=e,e=t}return e||(e={}),e.responseType="arraybuffer",pt$3.get(t,e,i)},getJSON:function(t,e,i){if(U$4(e)){const t=i;i=e,e=t}const n=function(t,e){const n="string"==typeof e?JSON.parse(e):e||null;i(t,n)};return e&&e.jsonp?pt$3.jsonp(t,n):((e=e||{}).returnJSON=!0,pt$3.get(t,e,n))}},mt$3=new t__namespace.Point(0,0),yt$2=new t__namespace.Coordinate(0,0),gt$3={renderer:"gl",altitudeProperty:"altitude",forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,tileSize:[512,512],tileSystem:[1,-1,-6378137*Math.PI,6378137*Math.PI],features:!0,schema:!1,cascadeTiles:!0,collision:!0,picking:!0,pickingPoint:!1,pickingGeometry:!1,glyphSdfLimitPerFrame:15,meshLimitPerFrame:1,maxCacheSize:72,antialias:!1,iconErrorUrl:null,collisionFrameLimit:1.5,defaultRendering:!0,textGamma:1,maxIconSize:254,workarounds:{"win-intel-gpu-crash":!0},pyramidMode:1,styleScale:1,spatialReference:null,enableAltitude:!0,fadeAnimation:!1};class vt$2 extends t__namespace.TileLayer{constructor(t,e){super(t,e),this.VERSION=vt$2.VERSION;this.setStyle(e&&e.style)}onAdd(){const t=this.getMap(),e=this.getSpatialReference().toJSON().projection,i=t.getSpatialReference().toJSON().projection;if((e&&e.toLowerCase())!==(i&&i.toLowerCase()))throw new Error(`VectorTileLayer's projection(${e}) must be the same with map(${i}).`)}onWorkerReady(){}onConfig(t){const e=this.getRenderer();e&&e.updateOptions(t)}getWorkerOptions(){const t=this.getMap();return{debug:this.options.debug,debugTile:this.options.debugTile,altitudeProperty:this.options.altitudeProperty,tileSize:this.options.tileSize,baseRes:t.getGLRes(),style:this.isDefaultRender()?{style:[],featureStyle:[]}:this.X(),features:this.options.features,schema:this.options.schema,pickingGeometry:this.options.pickingGeometry}}setStyle(t){if(t&&(V$5(t)||t.url)){const e=t,i=e.lastIndexOf("/"),n=i<0?".":e.substring(0,i);return this.ready=!1,pt$3.getJSON(t.url?t.url:t,t.url?t:{},((t,i)=>{if(t)throw this.setStyle([]),t;let r;i.style?(r=i,r.$root||(r.$root=n)):r={$root:n,style:i},this.options.style=e,this.Kt(r)})),this}return this.options.style=t,this.Kt(t),this}Kt(t){if(this.Qt=null,t&&t.$root){let e=t.$root;e&&"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),this.Qt=e,this.te=function(t){return"{$root}"===t?e:null}}this.ready=!0,t=t||[],Array.isArray(t)?t={style:t}:t.renderPlugin&&(t={style:[t]}),t=function(t){if(!t.plugins)return t;const{plugins:e,styles:i}=t;let{style:n,featureStyle:r}=i;n=n||[],r=r||[];const o=new Array(n.length);for(let t=0;t<n.length;t++)o[t]=H$5({},n[t]),o[t].renderPlugin=e[n[t].renderPlugin];const s=new Array(r.length);for(let t=0;t<r.length;t++)s[t]=H$5({},r[t]),s[t].renderPlugin=e[r[t].renderPlugin];const a={style:o,featureStyle:s};return t.$root&&(a.$root=t.$root),a}(t=JSON.parse(JSON.stringify(t))),this.ee=t.featureStyle||[],this.ie=function(t){if(!t||!Array.isArray(t))return[];const e=[];for(let i=0;i<t.length;i++){const n=t[i].style;if(n&&Array.isArray(n)&&n.length)for(let r=0;r<n.length;r++){const o=H$5({},t[i],n[r]);n[r].ne=e.length,delete o.style,e.push(o)}else e.push(H$5({},t[i]))}return e}(t.featureStyle),this.re=t.style||[];const e=t.background||{};this.oe={enable:e.enable||!1,color:xt$2(e.color)||[0,0,0,0],opacity:wt$2(e.opacity,1),patternFile:e.patternFile,depthRange:e.depthRange},this.validateStyle(),this.te&&this.se(),this.Et();const i=this.getRenderer();i&&i.setStyle(),this.fire("setstyle",{style:this.getStyle(),computedStyle:this.getComputedStyle()})}getPolygonOffsetCount(){const t=this.getRenderer();return t?t.getPolygonOffsetCount():0}getPolygonOffset(){return this.ae||0}setPolygonOffset(t,e){return this.ae=t,this.le=e,this}getTotalPolygonOffset(){return this.le}outlineAll(){const t=this.getRenderer();return t?(t.outlineAll(),this):this}outline(t,e){const i=this.getRenderer();return i?(i.outline(t,e),this):this}outlineBatch(t){const e=this.getRenderer();return e?(e.outlineBatch(t),this):this}outlineFeatures(t){const e=this.getRenderer();return e?(e.outlineFeatures(t),this):this}cancelOutline(){const t=this.getRenderer();return t?(t.cancelOutline(),this):this}highlight(t){const e=this.getRenderer();return e?(e.highlight(t),this):this}cancelHighlight(t){const e=this.getRenderer();return e?(e.cancelHighlight(t),this):this}cancelAllHighlight(){const t=this.getRenderer();return t?(t.cancelAllHighlight(),this):this}se(){t__namespace.Util.convertStylePath(this.re,this.te),t__namespace.Util.convertStylePath(this.ie,this.te)}updateSceneConfig(t,e){return this.he(0,t,e)}updateFeatureSceneConfig(t,e,i){return this.he(1,t,i,e)}he(t,e,i,n){const r=this.it(t);if(!r)return this;let o,s=e;if(r[e].renderPlugin.sceneConfig||(r[e].renderPlugin.sceneConfig={}),H$5(r[e].renderPlugin.sceneConfig,i),void 0!==n){At$2(this.ee,e,n),s=this.ee[e].style[n].ne;const t=r[s].renderPlugin;t.sceneConfig||(t.sceneConfig={}),o=t.sceneConfig}else kt$2(r,e),o=r[e].renderPlugin.sceneConfig;if(H$5(o,i),Array.isArray(this.options.style)){const t=this.options.style[e].renderPlugin;t.sceneConfig||(t.sceneConfig={}),H$5(t.sceneConfig,i)}else{const r=this.it(t,this.options.style);let o;void 0!==n?(At$2(r,e,n),o=r[e].style[n].renderPlugin):(kt$2(r,e),o=r[e].renderPlugin),o.sceneConfig||(o.sceneConfig={}),H$5(o.sceneConfig,i)}const a=this.getRenderer();return a&&a.updateSceneConfig(t,s,i),0===t?this.fire("updatesceneconfig",{index:e,sceneConfig:i}):1===t&&this.fire("updatefeaturesceneconfig",{index:e,styleIdx:n,sceneConfig:i}),this}updateDataConfig(t,e){return this.ce(0,t,e)}updateFeatureDataConfig(t,e,i){return this.ce(1,t,i,e)}ce(t,e,i,n){const r=this.it(t);if(!r)return this;let o,s=e;void 0!==n?(At$2(this.ee,e,n),s=this.ee[e].style[n].ne,o=r[s].renderPlugin.dataConfig):(kt$2(r,e),o=r[e].renderPlugin.dataConfig);const a=H$5({},o);if(H$5(o,i),Array.isArray(this.options.style))H$5(this.options.style[e].renderPlugin.dataConfig,i);else{const r=this.it(t,this.options.style);let o;void 0!==n?(At$2(r,e,n),o=r[e].style[n].renderPlugin):(kt$2(r,e),o=r[e].renderPlugin),o.dataConfig||(o.dataConfig={}),H$5(o.dataConfig,i)}const l=this.getRenderer();return l&&l.updateDataConfig(t,s,i,a),0===t?this.fire("updatedataconfig",{index:e,dataConfig:i}):1===t&&this.fire("updatefeaturedataconfig",{index:e,styleIdx:n,dataConfig:i}),this}updateSymbol(t,e){return V$5(t)&&(t=this.ue(t)),this.de(0,t,e)}updateFeatureSymbol(t,e,i){return this.de(1,t,i,e)}de(e,i,n,r){const o=this.it(e);if(!o)return this;let s=i;void 0!==r&&(At$2(this.ee,i,r),s=this.ee[i].style[r].ne);const a=o[s];if(!a)throw new Error("No style defined at "+i);const l=this,h=this.te;function c(n,o,s){if(!n)return!1;h&&(n=JSON.parse(JSON.stringify(n)),t__namespace.Util.parseSymbolPath(n,h));const a=Object.keys(n);let c=!1;for(let t=0;t<a.length;t++){const e=a[t];if(bt$2(o[e])||bt$2(n[e])){c=!0;break}}for(const e in n)W$4(n,e)&&(!t__namespace.Util.isObject(n[e])||Array.isArray(n[e])||n[e].stops?o[e]=n[e]:(o[e]||(o[e]={}),H$5(o[e],n[e])));let u=l.options.style;Array.isArray(u)||(u=l.it(e,l.options.style));const d=JSON.parse(JSON.stringify(o));return void 0!==r?(At$2(u,i,r),void 0===s?u[i].style[r].symbol=d:u[i].style[r].symbol[s]=d):(kt$2(u,i),void 0===s?u[i].symbol=d:u[i].symbol[s]=d),c}const u=this.getRenderer();if(!u)return c(),this.Et(),this;let d=!1;const f=a.symbol;if(Array.isArray(n))for(let t=0;t<n.length;t++){const e=c(n[t],f[t],t);e&&(d=e)}else c(n,f);return this.Et(),d?u.setStyle():(d=u.updateSymbol(e,s,n),d&&u.setStyle()),0===e?this.fire("updatesymbol",{index:i,symbol:n}):1===e&&this.fire("updatefeaturesymbol",{index:i,featureStyleIndex:r,symbol:n}),this}it(t,e){return e?0===t?e.style:e.featureStyle:0===t?this.re:this.ie}isDefaultRender(){return!!this.fe&&this.options.defaultRendering}validateStyle(){this.pe=!0,this.fe=!1;let t=this.re;this.options.style||(this.fe=!0,t=this.re=[]),Array.isArray(t)||(t=this.re=[t]);for(let e=0;e<t.length;e++){let i=t[e].filter;if(i&&i.value&&(i=i.value),void 0!==i&&"default"!==i&&!0!==i&&!Array.isArray(i)&&void 0===i.condition)throw new Error(`Invalid filter at ${e} : ${JSON.stringify(i)}`);t[e].renderPlugin.dataConfig.only2D||(this.pe=!1)}}getStyle(){return this.options.style?JSON.parse(JSON.stringify(this.options.style)):null}getRenderStyle(t){V$5(t)&&(t=this.ue(t));let e=this.re;return e&&e[t]}addRenderStyle(t,e){let i=this.re;return i?t<0||t>=i.length?i.push(e):i.splice(t,0,e):i=[e],this.Kt({$root:this.Qt,style:i,featureStyle:this.ee}),this}updateRenderStyle(t,e){V$5(t)&&(t=this.ue(t));let i=this.re;return!i||t<0||t>=i.length||(i.splice(t,1,e),this.Kt({$root:this.Qt,style:i,featureStyle:this.ee})),this}removeRenderStyle(t){V$5(t)&&(t=this.ue(t));let e=this.re;return!e||t<0||t>=e.length||(e.splice(t,1),this.Kt({$root:this.Qt,style:e,featureStyle:this.ee})),this}getFeatureStyle(t){const e=this.getFeatureStyleIndex(t);return e<0?null:this.ee[e]}updateFeatureStyle(t){if(!t)return this;const e=t.id;if(q$4(e))return this;const i=this.getFeatureStyleIndex(e),n=this.ee||[];return i<0?n.push(t):n[i]=t,this.Kt({$root:this.Qt,style:this.re,featureStyle:n}),this}removeFeatureStyle(t){const e=this.getFeatureStyleIndex(t);if(e<0)return this;const i=this.ee.splice(e,1);return this.Kt({$root:this.Qt,style:this.re,featureStyle:i}),this}getFeatureStyleIndex(t){if(q$4(t))return-1;const e=this.ee;if(!e)return-1;const i=Array.isArray(t);for(let n=0;n<e.length;n++){if(i)return Array.isArray(e[n].id)&&$$4(t,e[n].id);if(e[n].id===t)return n}return-1}ue(t){const e=this.re;if(!e)return-1;for(let i=0;i<e.length;i++)if(e[i].name===t)return i;throw new Error("No style defined with name: "+t)}getGroundConfig(){this.me||(this.me={enable:!0,renderPlugin:{type:"fill",sceneConfig:{}},symbol:{polygonFill:[0,0,0,0],polygonOpacity:1}});const t=this.X().background||{};return this.me.enable=t.enable,this.me.symbol.polygonFill=t.color,this.me.symbol.polygonOpacity=t.opacity,this.me.symbol.polygonPatternFile=t.patternFile,this.me.renderPlugin.sceneConfig.depthRange=t.depthRange,this.me}getComputedStyle(){return JSON.parse(JSON.stringify(this.X()))}X(){return{background:this.oe,style:this.re||[],featureStyle:this.ie||[]}}isOnly2D(){return this.pe}identify(e,i={}){const n=this.getMap(),r=this.getRenderer();if(!n||!r)return[];const o=n.coordToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(o,i)}identifyAtPoint(t,e={}){const i=this.getMap(),n=this.getRenderer();if(!i||!n)return[];const r=i.getDevicePixelRatio(),o=n.pick(t.x*r,t.y*r,e);return"GeoJSONVectorTileLayer"!==this.getJSONType()?this.ye(o):o}ye(t){if(!this.getRenderer())return t;const e=this._getTileConfig(),i=this.getSpatialReference();for(let n=0;n<t.length;n++){let r=t[n];if(!r||!r.data)continue;const{tile:o}=r.data,{x:s,y:a,z:l,extent:h}=o,c=i.getResolution(l),u=e.getTilePointNW(s,a,c),d=r.data.feature&&r.data.feature.geometry;d&&(r.data=H$5({},r.data),r.data.feature=H$5({},r.data.feature),r.data.feature.geometry=this.ge(d,u,h,c))}return t}ge(t,e,i,n){const r=i/this.options.tileSize[0],o=this.getMap(),s=[];for(let a=0;a<t.length;a++)Array.isArray(t[a])?s.push(this.ge(t[a],e,i,n)):(mt$3.x=e.x+t[a].x/r,mt$3.y=e.y-t[a].y/r,o.pointAtResToCoord(mt$3,n,yt$2),s.push(yt$2.toArray()));return s}getBackgroundCollisionIndex(){return this.ve||(this.ve=new t__namespace.CollisionIndex),this.ve}clearBackgroundCollisionIndex(){return this.ve&&this.ve.clear(),this}getDataSchema(t){return this.be||(this.be={}),q$4(t)||this.be[t]||(this.be[t]={}),q$4(t)?this.be:this.be[t]}onRemove(){super.onRemove()}static fromJSON(t){return t&&"VectorTileLayer"===t.type?new vt$2(t.id,t.options):null}Et(){}static registerPlugin(t){vt$2.plugins||(vt$2.plugins={}),vt$2.plugins[t.type]=t}static getPlugins(){return vt$2.plugins||{}}static compressStyleJSON(t){return Array.isArray(t)&&t.length?function(t){Array.isArray(t)&&(t={style:t,featureStyle:[]});const e=[],i=[],n=[];dt$3(t.style,e,n),dt$3(t.featureStyle,i,n);const r={plugins:n,styles:{style:e,featureStyle:i}};return t.$root&&(r.$root=t.$root),r}(t):t}}function bt$2(t){return!(!t||!t.properties)}function xt$2(t){return t?(Array.isArray(t)||(t=color(t).unitArray()),3===t.length&&t.push(1),t):null}function wt$2(t,e){return null==t?e:t}function At$2(t,e,i){if(!t[e]||!t[e].style||!t[e].style[i])throw new Error(`No plugin defined at feature style of ${e} - ${i}`)}function kt$2(t,e){if(!t[e])throw new Error("No plugin defined at style of "+e)}vt$2.prototype._getTileZoom=function(e){return e=Math.floor(e),t__namespace.TileLayer.prototype._getTileZoom.call(this,e)},vt$2.registerJSONType("VectorTileLayer"),vt$2.mergeOptions(gt$3),vt$2.registerRenderer("gl",lt$3),vt$2.registerRenderer("canvas",null);class _t$2 extends vt$2{getTileUrl(t,e,i){const n=this.getMap().getResolution(i);return super.getTileUrl(t,e,function(t){return 19-Math.log(t/St$2)/Math.LN2}(n))}static fromJSON(t){return t&&"MapboxVectorTileLayer"===t.type?new _t$2(t.id,t.options):null}}_t$2.registerJSONType("MapboxVectorTileLayer");const St$2=12756274*Math.PI/(256*Math.pow(2,20));class Tt$2 extends vt$2{constructor(t,e={}){e.spatialReference=null,super(t,e),this.setData(e.data)}getWorkerOptions(){const t=super.getWorkerOptions();let e=this.options.data;return e=V$5(e)||e&&e.url?Pt$2(e):this.features,t.data=e,t.tileBuffer=this.options.tileBuffer,t.extent=this.options.extent,t.hasAltitude=this.options.enableAltitude,t.simplifyTolerance=this.options.simplifyTolerance,t}setData(t){return this.options.data=t,t&&(V$5(t)||t.url)?(!!this.getRenderer()&&this.xe(),this):(this.we(t),this.xe(),this)}we(t){return this.options.convertFn&&(t=new Function("data",this.options.convertFn+"\nreturn convert(data)")(t)),this.features=t,this.Ae(),this}xe(){const t=this.getRenderer();if(t){const e=t.getWorkerConnection();if(e){let i=this.options.data;i=V$5(i)||i.url?Pt$2(i):this.features,e.setData(i,((e,i)=>{t.clear(),this.onWorkerReady(null,i),t.setToRedraw()}))}}}getExtent(){return this.ke}onWorkerReady(t,e){t?this.fire("dataerror",{error:t}):(e&&(e.extent&&this._e(e.extent),e.idMap&&(this.Se=e.idMap)),this.fire("dataload",{extent:e&&e.extent}))}_e(e){this.ke=new t__namespace.Extent(...e)}Te(t,e){V$5(t)?pt$3.getJSON(t,e):pt$3.getJSON(t.url,t,e)}getData(){return this.features||null}getTileUrl(t,e,i){return this.getId()+","+t+","+e+","+i}getFeature(t){return this.Se[t]}static fromJSON(t){return t&&"GeoJSONVectorTileLayer"===t.type?new Tt$2(t.id,t.options):null}Ae(){if(!this.features)return;if(this.features=JSON.parse(JSON.stringify(this.features)),!this.features)return;let t=0;this.Se={};const e=this.features;Array.isArray(e)?e.forEach((e=>{null!=e.id||(e.id=t++),this.Se[e.id]=e})):e.features&&e.features.forEach((e=>{null!=e.id||(e.id=t++),this.Se[e.id]=e}))}}function Mt$2(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}function Pt$2(t){return t.url?t.url=Mt$2(t.url):t=Mt$2(t),t}Tt$2.registerJSONType("GeoJSONVectorTileLayer"),Tt$2.mergeOptions({features:"id",tileBuffer:64,extent:8192,pyramidMode:1,simplifyTolerance:3});class It$2 extends t__namespace.OverlayLayer{static registerPainter(t,e){It$2.painters||(It$2.painters={}),It$2.painters[t]=e}static get3DPainterClass(t){return It$2.painters[t]}constructor(...t){super(...t),this.options.sceneConfig||(this.options.sceneConfig={}),q$4(this.options.sceneConfig.blendSrc)&&(this.options.sceneConfig.blendSrc="one")}updateSymbol(t,e){if(!this.options.style)throw new Error("can't call update symbol when style is not set");const i=Array.isArray(this.options.style)?this.options.style:this.options.style.style;if(!i[t])throw new Error("invalid style at "+t);return H$5(i[t].symbol,e),this.setStyle(this.options.style),this}getPolygonOffsetCount(){return 1}getPolygonOffset(){return this.ae||0}setPolygonOffset(t,e){return this.ae=t,this.le=e,this}getTotalPolygonOffset(){return this.le}identify(e,i={}){const n=this.getMap(),r=this.getRenderer();if(!n||!r)return[];const o=n.coordToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(o,i)}identifyAtPoint(t,e={}){const i=this.getMap(),n=this.getRenderer();if(!i||!n)return[];const r=this.getMap().getDevicePixelRatio();return n.pick(t.x*r,t.y*r,e)}getComputedStyle(){return{style:this.getStyle()||[]}}outlineAll(){const t=this.getRenderer();return t?(t.outlineAll(),this):this}outline(t){if(!Array.isArray(t)||!t.length)return this;const e=this.getRenderer();return e?(e.outline(t),this):this}cancelOutline(){const t=this.getRenderer();return t?(t.cancelOutline(),this):this}toJSON(){const t={type:this.getJSONType(),id:this.getId(),options:this.config(),geometries:[]},e=this.getGeometries();for(let i=0,n=e.length;i<n;i++){const n=e[i].toJSON();t.geometries.push(n)}return t}}It$2.mergeOptions({picking:!0,renderer:"gl",collision:!1,textGamma:1,geometryEvents:!0,styleScale:1,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,meshRenderOrder:0,enableBloom:!1,workarounds:{"win-intel-gpu-crash":!0}});const Ot$2={markerFile:{type:"identity",default:void 0,property:"_symbol_markerFile"},markerWidth:{type:"identity",default:20,property:"_symbol_markerWidth"},markerHeight:{type:"identity",default:20,property:"_symbol_markerHeight"},markerPathWidth:{type:"identity",default:20,property:"_symbol_markerPathWidth"},markerPathHeight:{type:"identity",default:20,property:"_symbol_markerPathHeight"},markerDx:{type:"identity",default:void 0,property:"_symbol_markerDx"},markerDy:{type:"identity",default:void 0,property:"_symbol_markerDy"},markerType:{type:"identity",default:void 0,property:"_symbol_markerType"},markerPath:{type:"identity",default:void 0,property:"_symbol_markerPath"},markerFill:{type:"identity",default:void 0,property:"_symbol_markerFill"},markerFillPatternFile:{type:"identity",default:void 0,property:"_symbol_markerFillPatternFile"},markerFillOpacity:{type:"identity",default:void 0,property:"_symbol_markerFillOpacity"},markerLineColor:{type:"identity",default:void 0,property:"_symbol_markerLineColor"},markerLineWidth:{type:"identity",default:void 0,property:"_symbol_markerLineWidth"},markerLineOpacity:{type:"identity",default:void 0,property:"_symbol_markerLineOpacity"},markerLineDasharray:{type:"identity",default:void 0,property:"_symbol_markerLineDasharray"},markerLinePatternFile:{type:"identity",default:void 0,property:"_symbol_markerLinePatternFile"},markerVerticalAlignment:{type:"identity",default:"top",property:"_symbol_markerVerticalAlignment"},markerHorizontalAlignment:{type:"identity",default:"middle",property:"_symbol_markerHorizontalAlignment"},markerOpacity:{type:"identity",default:1,property:"_symbol_markerOpacity"},markerPitchAlignment:{type:"identity",default:"viewport",property:"_symbol_markerPitchAlignment"},markerRotationAlignment:{type:"identity",default:"viewport",property:"_symbol_markerRotationAlignment"},markerRotation:{type:"identity",default:0,property:"_symbol_markerRotation"},markerAllowOverlap:{type:"identity",default:0,property:"_symbol_markerAllowOverlap"},markerIgnorePlacement:{type:"identity",default:0,property:"_symbol_markerIgnorePlacement"},markerTextFit:{type:"identity",default:null,property:"_symbol_markerTextFit"},markerSpacing:{type:"identity",default:250,property:"_symbol_markerSpacing"},markerTextFitPadding:{type:"identity",default:null,property:"_symbol_markerTextFitPadding"},markerPlacement:{type:"identity",default:"point",property:"_symbol_markerPlacement"}},Ct$2={textName:{type:"identity",default:void 0,property:"_symbol_textName"},textFaceName:{type:"identity",default:void 0,property:"_symbol_textFaceName"},textWeight:{type:"identity",default:void 0,property:"_symbol_textWeight"},textStyle:{type:"identity",default:void 0,property:"_symbol_textStyle"},textWrapWidth:{type:"identity",default:void 0,property:"_symbol_textWrapWidth"},textHorizontalAlignment:{type:"identity",default:void 0,property:"_symbol_textHorizontalAlignment"},textVerticalAlignment:{type:"identity",default:void 0,property:"_symbol_textVerticalAlignment"},textFill:{type:"identity",default:void 0,property:"_symbol_textFill"},textSize:{type:"identity",default:void 0,property:"_symbol_textSize"},textHaloRadius:{type:"identity",default:void 0,property:"_symbol_textHaloRadius"},textHaloFill:{type:"identity",default:void 0,property:"_symbol_textHaloFill"},textHaloOpacity:{type:"identity",default:1,property:"_symbol_textHaloOpacity"},textDx:{type:"identity",default:void 0,property:"_symbol_textDx"},textDy:{type:"identity",default:void 0,property:"_symbol_textDy"},textOpacity:{type:"identity",default:1,property:"_symbol_textOpacity"},textPitchAlignment:{type:"identity",default:"viewport",property:"_symbol_textPitchAlignment"},textRotationAlignment:{type:"identity",default:"viewport",property:"_symbol_textRotationAlignment"},textRotation:{type:"identity",default:0,property:"_symbol_textRotation"},textAllowOverlap:{type:"identity",default:0,property:"_symbol_textAllowOverlap"},textIgnorePlacement:{type:"identity",default:0,property:"_symbol_textIgnorePlacement"},textSpacing:{type:"identity",default:250,property:"_symbol_textSpacing"},textPlacement:{type:"identity",default:"point",property:"_symbol_textPlacement"}},Et$2={lineWidth:{type:"identity",default:2,property:"_symbol_lineWidth"},lineStrokeWidth:{type:"identity",default:0,property:"_symbol_lineStrokeWidth"},lineColor:{type:"identity",default:[1,1,1,1],property:"_symbol_lineColor"},lineStrokeColor:{type:"identity",default:[0,0,0,0],property:"_symbol_lineStrokeColor"},lineDx:{type:"identity",default:0,property:"_symbol_lineDx"},lineDy:{type:"identity",default:0,property:"_symbol_lineDy"},linePatternFile:{type:"identity",default:void 0,property:"_symbol_linePatternFile"},linePatternAnimSpeed:{type:"identity",default:0,property:"_symbol_linePatternAnimSpeed"},linePatternGap:{type:"identity",default:0,property:"_symbol_linePatternGap"},lineOpacity:{type:"identity",default:1,property:"_symbol_lineOpacity"},lineJoin:{type:"identity",default:void 0,property:"_symbol_lineJoin"},lineCap:{type:"identity",default:void 0,property:"_symbol_lineCap"},lineDasharray:{type:"identity",default:void 0,property:"_symbol_lineDasharray"},lineDashColor:{type:"identity",default:void 0,property:"_symbol_lineDashColor"}},Ft$2=new t__namespace.Point(0,0),zt$2="_vector3dlayer_id",jt$2="_line_gradient_property".trim();function Dt$2(e,i,n){const r="__fea_idx".trim(),o=e.getMap(),s=o.getGLRes();let a=e.getCoordinates();const l=[];let h=1;if(e instanceof t__namespace.Marker||e instanceof t__namespace.MultiPoint){e instanceof t__namespace.Marker&&(a=[a]);for(let t=0;t<a.length;t++)o.coordToPointAtRes(a[t],s,Ft$2),l.push([Ft$2.x,Ft$2.y,a[t].z||0])}else if(e instanceof t__namespace.LineString||e instanceof t__namespace.MultiLineString){h=2,e instanceof t__namespace.LineString&&(a=[a]);for(let t=0;t<a.length;t++){l[t]=[];for(let e=0;e<a[t].length;e++)o.coordToPointAtRes(a[t][e],s,Ft$2),l[t].push([Ft$2.x,Ft$2.y,a[t][e].z||0])}}else if(e instanceof t__namespace.Polygon||e instanceof t__namespace.MultiPolygon){h=3,e instanceof t__namespace.Polygon&&(a=[a]);let i=0;for(let t=0;t<a.length;t++)for(let e=0;e<a[t].length;e++){l[i]=[];for(let n=0;n<a[t][e].length;n++)o.coordToPointAtRes(a[t][e][n],s,Ft$2),l[i].push([Ft$2.x,Ft$2.y,a[t][e][n].z||0]);i++}}const c=e.getProperties()?Object.assign({},e.getProperties()):{},u=e._getInternalSymbol(),d=n?Array.isArray(n)?n[0][r]:n[r]:i.id++;if(Array.isArray(u)&&u.length){const t=[],o=u.length;for(let s=0;s<o;s++){const a=s===o-1?c:H$5({},c),f=Rt$2(u[s],a);for(const t in u[s])W$4(u[s],t)&&(a[("_symbol_"+t).trim()]=u[s][t]);f&&(u[s].lineGradientProperty=f);const p=n&&n[s]?n[s][r]:i.pickingId++,m={type:h,id:d,properties:a,visible:e.isVisible(),geometry:l,extent:1/0};m[r]=p,t.push(m)}return t}if(u){const t=Rt$2(u,c);for(const t in u)W$4(u,t)&&(c[("_symbol_"+t).trim()]=u[t]);t&&(u.lineGradientProperty=t)}const f=n?n.id:i.pickingId++,p={type:h,id:d,properties:c,visible:e.isVisible(),geometry:l,extent:1/0};return p[r]=f,p}function Rt$2(t,e){const i=t.lineGradientProperty;return i&&(e[jt$2]=e[i],e.mapbox_clip_start=0,e.mapbox_clip_end=1,delete e[i]),i}let Nt$2=1;const Lt$2="_symbol_".trim(),Ht$2="__fea_idx".trim();let Vt$2=new Float32Array(1);class Ut$2 extends t__namespace.renderer.CanvasRenderer{constructor(...t){super(...t),this.features={},this.Me={},this.j=0,this.Pe={},this.Ie={},this.Oe={},this.Ce={},this.Ee={},this.Fe=!0,this.ze={id:0,pickingId:0},this.je=H$5({},Ot$2,Ct$2),this.De={}}hasNoAARendering(){return!0}needToRedraw(){return super.needToRedraw()||this.painter&&this.painter.needToRedraw()||this.Re&&this.Re.needToRedraw()||this.Ne&&this.Ne.needToRedraw()}draw(t,e){const i=this.layer;if(this.prepareCanvas(),this.ft=this.pt(this.getMap().getGLRes()),this.Fe)this.buildMesh(),this.Le(),this.He(),this.De={},this.Ve=!1,this.Fe=!1,this.Ue=!1;else if(this.Ve){const t=this.atlas,e=this.qe,i=this.Ge;delete this.atlas,delete this.qe,delete this.Ge,this.buildMesh(t),this.Le(e),this.He(i),this.Ve=!1,this.Ue=!1}else if(this.Ue){const t=this.Ge;delete this.Ge,this.He(t),this.Ue=!1}if(!this.meshes&&!this.We&&!this.Be)return void this.completeRender();this.$e&&(this.Xe(),this.$e=!1),this.Ye(),this.dt=t,this.yt=e||{};const n=this.yt.renderMode,r=!n||"default"===n,o=this.Je();let s=0;0===this.layer.options.meshRenderOrder&&this.Ze(o,s++,n),this.Be&&(r||this.Ne.supportRenderMode(n))&&(this.Ne.startFrame(o),this.Ne.addMesh(this.Be,null,{bloom:this.yt.bloom}),this.Ne.prepareRender(o),o.polygonOffsetIndex=s++,this.Ne.render(o)),1===this.layer.options.meshRenderOrder&&this.Ze(o,s++,n),this.We&&(r||this.Re.supportRenderMode(n))&&(i.options.collision&&i.clearCollisionIndex(),this.Re.startFrame(o),this.Re.addMesh(this.We,null,{bloom:this.yt.bloom}),this.Re.prepareRender(o),i.options.collision&&this.Re.updateCollision(o),this.Re.render(o)),(r||e&&e.isFinalRender)&&(this.completeRender(),this.layer.fire("canvasisdirty"))}Ze(t,e,i){this.painter&&this.meshes&&(!i||"default"===i||this.painter.supportRenderMode(i))&&(this.painter.startFrame(t),this.painter.addMesh(this.meshes,null,{bloom:t&&t.bloom}),this.painter.prepareRender(t),t.polygonOffsetIndex=e++,this.painter.render(t))}supportRenderMode(){return!0}isForeground(){return!0}Je(){const t={regl:this.regl,layer:this.layer,symbol:this.Ke,gl:this.gl,sceneConfig:this.layer.options.sceneConfig,pluginIndex:0,cameraPosition:this.getMap().cameraPosition,timestamp:this.getFrameTimestamp()};return this.yt&&H$5(t,this.yt),t}drawOnInteracting(t,e,i){this.draw(e,i)}getFrameTimestamp(){return this.dt}Qe(t,e){(t=t||e)===e&&(e=null);const i=[],n=[0,0,0,0];this.layer._sortGeometries();const r=this.layer.getGeometries();for(let o=0;o<r.length;o++){const s=r[o][zt$2];if(!this.features[s])continue;const a=this.features[s];if(Array.isArray(a))for(let r=0;r<a.length;r++){const o=a[r],s=o[Ht$2];(!t||t[s]||e&&(!e||e[s]))&&(o.visible||(this.$e=!0),this.ti(o.geometry,n),i.push(o))}else{a.visible||(this.$e=!0);const r=a[Ht$2];if(t&&!t[r]&&(!e||e&&!e[r]))continue;this.ti(a.geometry,n),i.push(a)}}if(i.length||(this.meshes&&this.painter&&(this.painter.deleteMesh(this.meshes),delete this.meshes),this.We&&(this.Re.deleteMesh(this.We),delete this.We),this.Be&&(this.Ne.deleteMesh(this.Be),delete this.Be)),n[3]&&(n[0]/=n[3],n[1]/=n[3]),isNaN(n[0])||isNaN(n[1]))throw new Error("invalid geometry coordinates for "+this.layer.getJSONType());return{features:i,center:n}}buildMesh(){}createVectorPacks(t,e,i,n,r,o){return t&&n&&n.length?new e(n,i,{zoom:this.getMap().getZoom(),EXTENT:1/0,requestor:this.requestor,atlas:r,center:o,positionType:Float32Array}).load():Promise.resolve(null)}createMesh(t,e,i,o,s,a){const l=[],h=[];return this.createVectorPacks(t,e,i,o,s,a).then((e=>{if(!e)return null;const s=t.createGeometries([e.data],rt$3(o,null,0,i,this.layer));for(let t=0;t<s.length;t++)this.ei(s[t].geometry);const c=identity$2([]);translate$1(c,c,set$4(h,a[0],a[1],0)),scale$5(c,c,set$4(l,1,1,this.ft));const u=t.createMeshes(s,c,{tilePoint:[a[0],a[1]]});for(let t=0;t<u.length;t++){const e=u[t];e.properties.level=0;const i=e.defines;i.ENABLE_TILE_STENCIL=1,e.setDefines(i),e.properties.meshKey=this.layer.getId()}return{meshes:u,atlas:{iconAtlas:e.data.iconAtlas}}}))}ti(t,e){for(let i=0;i<t.length;i++)if(Array.isArray(t[i][0]))for(let n=0;n<t[i].length;n++)if(Array.isArray(t[i][n][0]))for(let r=0;r<t[i][n].length;r++)isNaN(+t[i][n][r][0])||isNaN(+t[i][n][r][1])||(e[0]+=t[i][n][r][0],e[1]+=t[i][n][r][1],e[3]+=1);else isNaN(+t[i][n][0])||isNaN(+t[i][n][1])||(e[0]+=t[i][n][0],e[1]+=t[i][n][1],e[3]+=1);else isNaN(+t[i][0])||isNaN(+t[i][1])||(e[0]+=t[i][0],e[1]+=t[i][1],e[3]+=1)}ei(t){const e=this.getMap(),i=t.properties;Object.defineProperty(i,"tileResolution",{enumerable:!0,get:function(){return e.getGLRes()}}),i.tileRatio=1,i.z=1,i.tileExtent=1}ii(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&Gt$2(this.gl)}prepareRequestors(){if(this.h)return;const t=this.layer;this.h=new Bo$1({iconErrorUrl:t.options.iconErrorUrl});const e=!this.ii("win-intel-gpu-crash");this.u=new Go$1((e=>{t.getMap().getRenderer().callInNextFrame(e)}),t.options.glyphSdfLimitPerFrame,e),this.requestor=this.ni.bind(this),this.ri=this.oi.bind(this)}ni(t,e,i){const n=[];this.h.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&n.push(...e.buffers),i(null,{icons:e.icons},n)}))}oi(t,e,i){this.u.getGlyphs(e,((e,n)=>{if(e)throw e;const r=n.buffers||[];this.h.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&e.buffers.length&&r.push(...e.buffers),i(null,{icons:e.icons,glyphs:n.glyphs},r)}))}))}Le(t){const e=Object.keys(this.Oe),i=Object.keys(this.Ce);if(!e.length&&!i.length)return void(this.We&&(this.Re.deleteMesh(this.We),delete this.We));const{features:o,center:s}=this.Qe(this.Oe,this.Ce),a=[],l=[];for(let t=0;t<o.length;t++){const e=o[t][Ht$2];this.Oe[e]&&a.push(o[t]),this.Ce[e]&&l.push(o[t])}if(!a.length&&!l.length)return void(this.We&&(this.Re.deleteMesh(this.We),delete this.We));const h=this.$e;this.si=s;const c=this.ai(a,l,t,s);this.qe={};const u=[],d=[];this.li=!0,Promise.all(c).then((t=>{if(this.We&&(this.Re.deleteMesh(this.We),delete this.We),!t||!t.length)return void this.setToRedraw();const e=this.Re.createGeometries(t.map((t=>t&&t.data)),this.Pe);for(let i=0;i<e.length;i++)this.ei(e[i].geometry,t[i]&&t[i].data);const i=t[0]&&t[0].data.iconAtlas,o=t[0]&&t[0].data.glyphAtlas||t[1]&&t[1].data.glyphAtlas;i&&(this.qe.iconAtlas=i),o&&(this.qe.glyphAtlas=o);const a=identity$2([]);translate$1(a,a,set$4(d,s[0],s[1],0)),scale$5(a,a,set$4(u,1,1,this.ft));const l=this.Re.createMeshes(e,a);for(let t=0;t<l.length;t++)l[t].geometry.properties.originElements=l[t].geometry.properties.elements.slice(),l[t].properties.level=0,l[t].material.set("flipY",1),l[t].properties.meshKey=Nt$2++;this.We=l,h&&(this.$e=!0),this.li=!1,this.setToRedraw()}))}Xe(){if(this.We&&(this.hi(this.We[0],this.Oe),this.hi(this.We[1],this.Ce)),this.Be)for(let t=0;t<this.Be.length;t++)this.hi(this.Be[t],this.Ee);if(this.meshes)for(let t=0;t<this.meshes.length;t++)this.hi(this.meshes[t],this.Pe)}hi(t,e){if(!t)return;const{aPickingId:i,originElements:n}=t.geometry.properties,r=[];for(let t=0;t<n.length;t++){const o=i[n[t]];e[o]&&e[o].feature.visible&&r.push(n[t])}const o=t.geometry.properties.elements=new n.constructor(r);t.geometry.setElements(o)}ai(t,e,i,n){const r={zoom:this.getMap().getZoom(),EXTENT:1/0,requestor:this.ri,atlas:i,center:n,positionType:Float32Array,defaultAltitude:0,forceAltitudeAttribute:!0},o=H$5({},r);return r.allowEmptyPack=1,Kn$2.splitPointSymbol(this.je).map(((i,n)=>new Kn$2(0===n?t:e,i,0===n?r:o).load()))}updateMesh(){}ci(t){const e=t._getInternalSymbol(),i={zoom:this.getMap().getZoom()},n=this.ui(t);if(!this.We)return!1;let r=this.features[n];Array.isArray(r)||(r=[r]);const o=[],s=[],a=this.getMap().getZoom();let l,h;l=Array.isArray(e)?e.map((t=>t?loadFunctionTypes(t,(()=>a)):t)):loadFunctionTypes(e,(()=>a)),h=Array.isArray(e)?e.map((t=>t?dr$3.genFnTypes(t):t)):dr$3.genFnTypes(e);for(let t=0;t<r.length;t++){if(!r[t])continue;const n=Array.isArray(e)?e[t]:e,o=Array.isArray(l)?l[t]:l,s=Array.isArray(h)?h[t]:h,a=new En$2(r,n,o,s,i).getIconAndGlyph();if(!this.qe||!Kn$2.isAtlasLoaded(a,this.qe))return this.di(),this.setToRedraw(),!1}for(let t=0;t<r.length;t++){const e=r[t][Ht$2];this.Oe[e]&&o.push(r[t]),this.Ce[e]&&s.push(r[t])}const c=r[0].id,u=this.ai(o,s,this.qe,this.si),d=this.We;return Promise.all(u).then((t=>{for(let e=0;e<t.length;e++){if(!t[e])continue;const i=d[e],n=i.geometry.properties.aFeaIds.indexOf(c);if(n<0)continue;const r=t[e].data.featureIds.length;for(const o in t[e].data.data){if("aPickingId"===o)continue;const s=t[e].data.data[o];i.geometry.updateSubData(o,s,n*s.length/r)}}this.setToRedraw()})),!0}fi(t){return this.pi(t,this.Be,this.Ge,this.mi,this.Ne,oo$2,Et$2,this.yi)}pi(t,e,i,n,r,o,s,a){if(!e)return!1;if(!i)return this.di(),this.setToRedraw(),!1;const l=t._getInternalSymbol(),h={zoom:this.getMap().getZoom()};let u=this.features[t[zt$2]];Array.isArray(u)||(u=[u]);const d=[];for(let t=0;t<u.length;t++){const e=u[t];if(!e)continue;const n=Array.isArray(l)?l[t]:l,r=dr$3.genFnTypes(n),s=new le$3(u,n,r,h),a=o===oo$2?s.getLineResource():s.getPolygonResource();if(!dr$3.isAtlasLoaded(a,i[t]))return this.di(),this.setToRedraw(),!1;d.push(e)}const f=u[0].id,p=a.call(this,d);for(let t=0;t<p.length;t++)if(p[t].length){const i=e.filter((e=>e.feaGroupIndex===t));if(!i.length)return this.di(),this.setToRedraw(),!1;if(i[0].geometry.properties.aFeaIds.indexOf(f)<0)return this.di(),this.setToRedraw(),!1}const m=H$5({},s),y=p.map((t=>this.createVectorPacks(r,o,m,t,i[0],n)));return Promise.all(y).then((t=>{for(let i=0;i<t.length;i++){let n;if(Array.isArray(e)){for(let t=0;t<e.length;t++)if(e[t].feaGroupIndex===i){n=e[t];break}}else n=e;if(!n)continue;const r=n.geometry.properties.aFeaIds,o=r.indexOf(f);if(!(o<0)){if(t[i]){const e=t[i].data.featureIds.length,r=t[i].data.data;for(const t in r)if(W$4(r,t)){const i=r[t];n.geometry.updateSubData(t,i,o*i.length/e)}}else{let t=o+1;for(;r[t]===f;)t++;const e=t-o,i=n.geometry.desc.positionSize;Vt$2.length!==3*e&&(Vt$2=new Float32Array(e*i),Vt$2.fill(-1/0,0)),n.geometry.updateSubData(n.geometry.desc.positionAttribute,Vt$2,o*i)}this.setToRedraw()}}})),!0}He(t){if(!Object.keys(this.Ee).length)return void(this.Be&&(this.Ne.deleteMesh(this.Be),delete this.Be));const{features:e,center:i}=this.Qe(this.Ee);if(!e.length)return;const n=this.$e;this.mi=i;const r=this.yi(e),o=H$5({},Et$2),s=r.map(((e,n)=>this.createMesh(this.Ne,oo$2,o,e,t&&t[n],i)));this.gi=!0,Promise.all(s).then((t=>{this.Be&&this.Ne.deleteMesh(this.Be);const e=[],i=[];for(let n=0;n<t.length;n++){const r=t[n]&&t[n].meshes;if(r){for(let t=0;t<r.length;t++){const i=r[t];i.feaGroupIndex=n,e.push(i),i.geometry.properties.originElements=i.geometry.properties.elements.slice()}i[n]=t[n].atlas}}this.Be=e,this.Ge=i,n&&(this.$e=n),this.gi=!1,this.setToRedraw()}))}yi(t){const e=(Lt$2+"lineDasharray").trim(),i=(Lt$2+"linePatternFile").trim(),n=[],r=[],o=[];for(let s=0;s<t.length;s++){const a=t[s],l=a.properties&&a.properties[e];l&&Jt$2(l)?o.push(a):a.properties&&a.properties[i]?r.push(a):n.push(a)}return[r,o,n]}vi(){this.Ve=!0,this.setToRedraw()}di(){this.Fe=!0,this.setToRedraw()}bi(t){const e=this.layer.getId();for(let i=0;i<t.length;i++){const n=t[i];let r=!1;for(let t=0;t<this.GeometryTypes.length;t++)if(n instanceof this.GeometryTypes[t]){r=!0;break}if(!r)throw new Error(`${n.getJSONType()} can't be added to ${this.layer.getJSONType()}(id:${e}).`);this.ui(n)}}ui(t){void 0===t[zt$2]&&(t[zt$2]=this.j++);const e=t[zt$2];this.features[e]&&this.xi(e),this.features[e]=Dt$2(t,this.ze,this.features[e]);return this.wi(this.features[e],e),this.Me[e]=t,e}wi(t,e){if(!t)return;const i=Array.isArray(t)?t[0].id:t.id;if(this.Ie[i]=t,Array.isArray(t))for(let i=0;i<t.length;i++){const n=t[i][Ht$2];t[i][zt$2]=e,this.Pe[n]={feature:t[i]},this.Pe[n][zt$2]=e;const r={feature:t[i]};Wt$2(t[i])&&(this.Oe[n]=r),Bt$2(t[i])&&(this.Ce[n]=r),Yt$2(t[i])&&(this.Ee[n]=r)}else{t[zt$2]=e;const i={feature:t},n=t[Ht$2];Wt$2(t)&&(this.Oe[n]=i),Bt$2(t)&&(this.Ce[n]=i),Yt$2(t)&&(this.Ee[n]=i),this.Pe[n]=i}}xi(t){const e=this.features[t];if(Array.isArray(e))for(let t=0;t<e.length;t++){const i=e[t][Ht$2];delete this.Ie[e[t].id],delete this.Pe[i],delete this.Oe[i],delete this.Ce[i],delete this.Ee[i]}else{const t=e[Ht$2];delete this.Ie[e.id],delete this.Pe[t],delete this.Oe[t],delete this.Ce[t],delete this.Ee[t]}}pick(t,e,i){const n=[];return[this.painter,this.Re,this.Ne].forEach((r=>{if(!r)return;const o=r.pick(t,e,i.tolerance);if(o&&o.data&&o.data.feature){n.push(this.Me[o.data.feature[zt$2]])}})),n}Ai(t){const i=this.features[t[zt$2]];return Array.isArray(i)?i[0][Ht$2]:i[Ht$2]}Ye(){let t=!1;for(const e in this.De){const i=this.De[e],n=this.Ai(i);if(!this.li&&(this.Oe[n]||this.Ce[n])){const e=this.ci(i);t=t||e}if(!this.gi&&this.Ee[n]){const e=this.fi(i);t=t||e}if(!this.ki){const e=this.updateMesh(i);t=t||e}}this.De={},t&&(qt$2(this),this.layer.fire("partialupdate"))}_i(t){this.ui(t),this.di(),qt$2(this)}onGeometryAdd(t){this.setToRedraw(),this.canvas&&t&&t.length&&(this.bi(t),this.di(),qt$2(this))}onGeometryRemove(t){if(t&&t.length){for(let e=0;e<t.length;e++){const i=t[e][zt$2];void 0!==i&&(delete this.Me[i],this.xi(i),delete this.features[i])}this.di(),qt$2(this)}}onGeometrySymbolChange(t){const e=t.target._getParent()||t.target,i=t.properties;for(const t in i)if(W$4(i,t)&&ea[t])return void this._i(e);const n=e[zt$2],r=e._getInternalSymbol(),o=this.features[n];if(this.ui(e),o)if(function(t,e){return Array.isArray(t)?!!Array.isArray(e)&&t.length===e.length:!Array.isArray(e)}(r,o)){if(Array.isArray(r)){for(let t=0;t<r.length;t++)if(!Zt$2(r[t],o[t]))return void this._i(e)}else if(!Zt$2(r,o))return void this._i(e);this.onGeometryPositionChange(t)}else this._i(e);else this._i(e)}onGeometryShapeChange(t){const e=t.target._getParent()||t.target,i=Dt$2(e,{id:0}).geometry,r=this.features[e[zt$2]];if(function t(e,i){if(e.length!==i.length)return!1;if(Array.isArray(e[0])&&Array.isArray(i[0])){for(let n=0;n<e.length;n++)if(!t(e[0],i[0]))return!1}else if(Array.isArray(e[0])||Array.isArray(i[0]))return!1;return!0}(i,(Array.isArray(r)?r[0]:r).geometry))return this.Be&&(this.Ue=!0),void this.onGeometryPositionChange(t);this.bi([e]),this.vi(),qt$2(this)}onGeometryPositionChange(t){const e=t.target._getParent()||t.target,i=e[zt$2];this.bi([e]),this.De[i]=e,qt$2(this)}onGeometryZIndexChange(){this.di()}onGeometryShow(t){this.Si(t)}onGeometryHide(t){this.Si(t)}Si(t){const e=t.target,n=this.features[e[zt$2]];if(n){const t=e.isVisible();if(Array.isArray(n)){if(t===n[0].visible)return;for(let e=0;e<n.length;e++)n[e].visible=t}else{if(t===n.visible)return;n.visible=t}this.Ti(),qt$2(this)}}Ti(){this.$e=!0}onGeometryPropertiesChange(t){const e=t.target,i=e[zt$2];this.features[i]=Dt$2(e,this.ze),this.wi(this.features[i],i),this.di(),qt$2(this)}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;t?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):this.rt(),t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.prepareRequestors(),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.painter=this.createPainter();const e=It$2.get3DPainterClass("icon"),i=H$5({},Ot$2,Ct$2);this.Mi(i,"markerBloom"),this.Mi(i,"textBloom"),this.Re=new e(this.regl,this.layer,i,this.layer.options.sceneConfig,0),this.Re.setTextShaderDefines({REVERSE_MAP_ROTATION_ON_PITCH:1});const n=It$2.get3DPainterClass("line"),r=H$5({},Et$2);this.Mi(r,"lineBloom"),this.Ne=new n(this.regl,this.layer,r,this.layer.options.sceneConfig,0),this.layer.getGeometries()&&this.onGeometryAdd(this.layer.getGeometries())}Mi(t,e){const i=this.layer;Object.defineProperty(t,e,{enumerable:!0,get:function(){return i&&i.options.enableBloom}})}createPainter(){}rt(){const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0,antialias:!1};t.preserveDrawingBuffer=!0,t.stencil=!0,this.glOptions=t,this.gl=this.gl||this.lt(this.canvas,t),this.regl=u$5({gl:this.gl,attributes:t,extensions:N$9.WEBGL_EXTENSIONS,optionalExtensions:N$9.WEBGL_OPTIONAL_EXTENSIONS})}lt(t,e){const i=["webgl","experimental-webgl"];let n=null;for(let r=0;r<i.length;++r){try{n=t.getContext(i[r],e)}catch(t){}if(n)break}return n}clearCanvas(){super.clearCanvas(),this.regl&&this.regl.clear({color:[0,0,0,0],depth:1,stencil:255})}resizeCanvas(t){super.resizeCanvas(t);const e=this.canvas;e&&(!this.pickingFBO||this.pickingFBO.width===e.width&&this.pickingFBO.height===e.height||this.pickingFBO.resize(e.width,e.height),this.painter&&this.painter.resize(e.width,e.height))}onRemove(){super.onRemove(),this.painter&&this.painter.delete(),this.Re&&this.Re.delete(),this.Ne&&this.Ne.delete()}drawOutline(t){if(this._t&&(this.painter&&this.painter.outlineAll(t),this.Re.outlineAll(t),this.Ne.outlineAll(t)),this.Pi)for(let e=0;e<this.Pi.length;e++)this.painter&&this.painter.outline(t,this.Pi[e]),this.Re.outline(t,this.Pi[e]),this.Ne.outline(t,this.Pi[e])}outlineAll(){this._t=!0,this.setToRedraw()}outline(t){this.Pi||(this.Pi=[]);const e=[];for(let i=0;i<t.length;i++){const n=this.layer.getGeometryById(t[i]);if(n){const t=this.features[n[zt$2]];if(Array.isArray(t))for(let i=0;i<t.length;i++)e.push(t[i].id);else e.push(t.id)}}this.Pi.push(e),this.setToRedraw()}cancelOutline(){delete this._t,delete this.Pi,this.setToRedraw()}isEnableWorkAround(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&Gt$2(this.gl)}pt(t){return B$6(t,this.getMap())}}function qt$2(t){t.setToRedraw()}function Gt$2(t){const e=t.getExtension("WEBGL_debug_renderer_info");if(e&&"undefined"!=typeof navigator){const i=t.getParameter(e.UNMASKED_RENDERER_WEBGL),n="Win32"===navigator.platform||"Win64"===navigator.platform;if(i&&i.toLowerCase().indexOf("intel")>=0&&n)return!0}return!1}function Wt$2({properties:t}){const e=(Lt$2+"markerFile").trim(),i=(Lt$2+"markerType").trim();return t[e]||t[i]}function Bt$2({properties:t}){return t[(Lt$2+"textName").trim()]}const $t$2=(Lt$2+"lineWidth").trim(),Xt$2="_line_gradient_property".trim();function Yt$2(t){return 2===t.type&&!t.properties[Xt$2]&&void 0!==t.properties[$t$2]||3===t.type&&void 0!==t.properties[$t$2]}function Jt$2(t){if(!Array.isArray(t))return 0;let e=0;for(let i=0;i<t.length;i++)e+=t[i];return e}function Zt$2(t,e){if(Object.keys(t).sort().join()!==Object.keys(e.properties||{}).filter((t=>0===t.indexOf(Lt$2))).map((t=>t.substring(Lt$2.length))).sort().join())return!1;for(const i in t)if(W$4(t,i)){const n=(Lt$2+i).trim();if(isFunctionDefinition(t[i])!==isFunctionDefinition(e.properties[n]))return!1}return!0}function Kt$2(e,i,n){if(!e||e.type!==i)return null;const r=new n(e.id,e.options),o=e.geometries,s=[];for(let e=0;e<o.length;e++){const i=t__namespace.Geometry.fromJSON(o[e]);i&&s.push(i)}return r.addGeometry(s),r}class Qt$2 extends It$2{static fromJSON(t){return Kt$2(t,"PointLayer",Qt$2)}}Qt$2.mergeOptions({glyphSdfLimitPerFrame:15,iconErrorUrl:null,workarounds:{"win-intel-gpu-crash":!0},collision:!1,collisionFrameLimit:1,sceneConfig:{collision:!0,fading:!1,fadingDuration:224,fadeInDelay:600,fadeOutDelay:100,uniquePlacement:!1,depthFunc:"always"}}),Qt$2.registerJSONType("PointLayer"),Qt$2.registerRenderer("canvas",null),Qt$2.registerRenderer("gl",class extends Ut$2{constructor(...e){super(...e),this.GeometryTypes=[t__namespace.Marker,t__namespace.MultiPoint]}onGeometryAdd(t){t&&(Array.isArray(t)?t.forEach((t=>{t.options.maxMarkerWidth=t.options.maxMarkerHeight=255})):t.options.maxMarkerWidth=t.options.maxMarkerHeight=255,super.onGeometryAdd(t))}});class te$2 extends It$2{static fromJSON(t){return Kt$2(t,"LineStringLayer",te$2)}}te$2.mergeOptions({meshRenderOrder:1}),te$2.registerJSONType("LineStringLayer");const ee$2="_line_gradient_property".trim();te$2.registerRenderer("gl",class extends Ut$2{constructor(...e){super(...e),this.GeometryTypes=[t__namespace.LineString,t__namespace.MultiLineString]}createPainter(){const t=It$2.get3DPainterClass("line-gradient");return this.painterSymbol=H$5({},{lineGradientProperty:ee$2},Et$2),this.Mi(this.painterSymbol,"lineBloom"),new t(this.regl,this.layer,this.painterSymbol,this.layer.options.sceneConfig,0)}buildMesh(){let{features:t,center:e}=this.Qe();if(t=t.filter((t=>!!t.properties[ee$2])),!t.length)return;const i=this.$e;this.Ii=e;const n=H$5({},this.painterSymbol),r=this.createMesh(this.painter,oo$2,n,t,null,e);this.ki=!0,r.then((t=>{this.meshes&&this.painter.deleteMesh(this.meshes);const e=[],n=t&&t.meshes;if(n){e.push(...n);for(let t=0;t<n.length;t++)n[t].feaGroupIndex=0,n[t].geometry.properties.originElements=n[t].geometry.properties.elements.slice()}this.meshes=e,i&&(this.$e=i),this.ki=!1,this.setToRedraw()}))}}),te$2.registerRenderer("canvas",null);class ie$2 extends It$2{static fromJSON(t){return Kt$2(t,"PolygonLayer",ie$2)}}ie$2.registerJSONType("PolygonLayer");const ne$2={polygonFill:{type:"identity",default:void 0,property:"_symbol_polygonFill"},polygonPatternFile:{type:"identity",default:void 0,property:"_symbol_polygonPatternFile"},polygonOpacity:{type:"identity",default:1,property:"_symbol_polygonOpacity"},uvScale:{type:"identity",default:[1,1],property:"_symbol_uvScale"},uvOffset:{type:"identity",default:[0,0],property:"_symbol_uvOffset"}};ie$2.registerRenderer("gl",class extends Ut$2{constructor(...e){super(...e),this.PackClass=Ao$1,this.GeometryTypes=[t__namespace.Polygon,t__namespace.MultiPolygon]}buildMesh(t){const{features:e,center:i}=this.Qe();if(!e.length)return;const n=this.$e;this.Ii=i;const r=this.Oi(e),o=H$5({},ne$2),s=r.map(((e,n)=>this.createMesh(this.painter,Ao$1,o,e,t&&t[n],i)));this.ki=!0,Promise.all(s).then((t=>{this.meshes&&this.painter.deleteMesh(this.meshes);const e=[],i=[];for(let n=0;n<t.length;n++){const r=t[n]&&t[n].meshes;if(r){e.push(...r);for(let t=0;t<r.length;t++)r[t].feaGroupIndex=n,r[t].geometry.properties.originElements=r[t].geometry.properties.elements.slice(),1===n&&(r[t].transparent=!0);i[n]=t[n].atlas}}this.meshes=e,this.atlas=i,n&&(this.$e=n),this.ki=!1,this.setToRedraw()}))}Oi(t){const e=[],i=[];for(let n=0;n<t.length;n++){const r=t[n];r.properties&&r.properties._symbol_polygonOpacity<1?i.push(r):e.push(r)}return[e,i]}createPainter(){const t=It$2.get3DPainterClass("fill");return this.painterSymbol=H$5({},ne$2),this.Mi(this.painterSymbol,"polygonBloom"),new t(this.regl,this.layer,this.painterSymbol,this.layer.options.sceneConfig,0)}updateMesh(t){return this.pi(t,this.meshes,this.atlas,this.Ii,this.painter,Ao$1,ne$2,this.Oi)}}),ie$2.registerRenderer("canvas",null);const re$2={redraw:!1,retire:!1},oe$2=[];let se$2=1;function ae$2(t,e){return VectorTilePlugin.extend(t,{init:function(){this.Ci={}},isVisible(){return this.painter&&this.painter.isVisible()},supportRenderMode:function(t){return this.painter.supportRenderMode(t)},startFrame:function(t){const r=t.sceneConfig;let a=this.painter;if(!a){a=this.painter=new e(t.regl,t.layer,t.symbol,r,t.pluginIndex,t.dataConfig)}this.Ci||(this.Ci={});const l=r.excludes;this.Ei?l!==this.Ei&&(this.Fi=l?createFilter(l):null,this.Ei=l):l&&(this.Ei=l),a.startFrame(t),this.zi={}},updateCollision:function(t){const e=this.painter;return e&&e.isVisible()?e.updateCollision(t):null},prepareRender:function(t){const e=this.painter;return e&&e.isVisible()?e.prepareRender(t):null},endFrame:function(t){const e=this.painter;return e&&e.isVisible()?e.render(t):null},getShadowMeshes(){const t=this.painter;return t&&t.getShadowMeshes&&t.getShadowMeshes()||oe$2},createTile:function(t){const{tileCache:e,tileData:i}=t;let n=!1;const r=this.painter;if(!r)return{retire:n};const o=this.ji(t);let s=e.geometry;if(!s){const o=i.features,a=i.data;if(!a||!a.length)return{retire:n};const l=a;if(this.painter.colorSymbol)for(let t=0;t<a.length;t++){const e=this.Di(o,a[t].data.aPickingId,a[t].indices,a[t].data.aPosition,a[t].positionSize);a[t].data.aColor=e}s=e.geometry=r.createGeometries(l,o);for(let e=0;e<s.length;e++)s[e]&&s[e].geometry&&(n=!0,s[e].geometry.properties.features=o,this.ei(s[e].geometry,t))}let a=this.R(o);if(!a){const{meshes:e,retire:i}=this.Ri(s,t);n||(n=i),a=e}return{retire:n}},Ri(t,e){const{layer:i,tileInfo:n,tileExtent:r,tileTransform:o,tileTranslationMatrix:s,tileZoom:a,sceneConfig:l}=e;let h=!1;const d=this.painter.createMeshes(t,o,{tileExtent:r,tilePoint:[n.extent2d.xmin,n.extent2d.ymax],tileZoom:a,tileTranslationMatrix:s});if(d.length){const t=i.getRenderer().isEnableTileStencil();for(let i=0;i<d.length;i++)d[i]&&(h=!0,this.Ni(d[i],o,e.timestamp,se$2++,t));l.animation&&(d.Li=e.timestamp);const n=this.ji(e);this.Ci[n]=d}return{meshes:d,retire:h}},paintTile:function(t){const{tileCache:e,tileInfo:i,tileZoom:n,sceneConfig:r}=t,o=this.painter;if(!o)return re$2;let s=e.geometry;if(!s)return re$2;let a=!1;const l=this.ji(t);let h=this.R(l);if(!h){const{meshes:e,retire:i}=this.Ri(s,t);a||(a=i),h=e}if(!h.length)return re$2;const c=o.getTileLevelValue(i,n);h.forEach((t=>{t.properties.tile=i,t.properties.level=c}));let u=!1;if(!this.zi[l]){let e=null,i=r.animation;if(i){const n=t.sceneConfig.animationDuration||800,r=(t.timestamp-h.Li)/n;h.Li-h[0].properties.createTime<n&&r<1&&(!0!==i&&1!==i||(i="linear"),e="linear"===i?r:F$5(i,r),u=!0)}o.addMesh(h,e,t),this.zi[l]=1}return{redraw:u,retire:a}},Ni:function(t,e,i,n,r){if(t.properties.tileTransform=e,t.properties.createTime=i,t.properties.meshKey=n,t.needUpdateShadow=!0,r){const e=t.defines||{};e.ENABLE_TILE_STENCIL=1,t.setDefines(e),Object.defineProperty(t.uniforms,"stencilRef",{enumerable:!0,get:function(){return t.properties.tile?t.properties.tile.stencilRef:255}})}},ei:function(t,e){const{layer:i,tileInfo:n}=e,r=i.getMap(),o=(i.getSpatialReference?i.getSpatialReference():r.getSpatialReference()).getResolution(n.z),s=e.tileExtent/i.getTileSize().width;t.properties.tileResolution=o,t.properties.tileRatio=s,t.properties.z=n.z,t.properties.tileExtent=e.tileExtent},updateSceneConfig:function(t){const e=this.painter;e&&e.updateSceneConfig(t.sceneConfig)},updateDataConfig:function(t,e){const i=this.painter;return!i||i.updateDataConfig(t,e)},updateSymbol:function(t,e){const i=this.painter;if(!i)return!1;if(i.shouldDeleteMeshOnUpdateSymbol(t)){if(this.Ci)for(const t in this.Ci)i.deleteMesh(this.Ci[t],!0);delete this.Ci,delete this.zi}return i.updateSymbol(t,e)},pick:function(t,e,i){return this.painter&&this.painter.pick?this.painter.pick(t,e,i):null},deleteTile:function(t){if(!this.Ci)return;const e=this.ji(t),i=this.Ci[e];i&&this.painter&&this.painter.deleteMesh(i),delete this.Ci[e],this.zi&&delete this.zi[e]},remove:function(){const t=this.painter;if(t&&this.Ci){for(const e in this.Ci)t.deleteMesh(this.Ci[e]);t.delete(),delete this.painter}delete this.Ci,delete this.zi},resize:function(t,e){const i=this.painter;i&&i.resize(t,e)},needToRedraw:function(){return!!this.painter&&this.painter.needToRedraw()},needToRetireFrames:function(){return!!this.painter&&this.painter.needToRetireFrames()},Di:function(t,e,i,n,r=3){if(!n||!t||!e.length)return null;const o=new Uint8Array(n.length/r*4);let s,a;const l=this.painter.colorSymbol,h={};let c;for(let i=0,n=e.length;i<n;i++){const n=e[i];if(s=t[n].symbol,a=h[n],!a)if(l){let e;e="function"==typeof l?l(t[n].feature&&t[n].feature.properties):l,e=color(e),a=h[n]=e.array()}else a=h[n]=[255,255,255];c=4*i,o[c]=a[0],o[c+1]=a[1],o[c+2]=a[2],o[c+3]=255*(s[this.painter.opacitySymbol]||1)}return o},ji:function(t){const e=t.tileInfo;return e.meshKey||(e.meshKey=se$2++),e.meshKey},R:function(t){return this.Ci[t]},Hi(t,e){if(Array.isArray(t))t.forEach(((t,i)=>{const{features:n}=t.properties;this.Vi(t,e[i],n)}));else{const{features:i}=t.properties;this.Vi(t,Array.isArray(e)?e[0]:e,i)}},Vi(t,e,i){const n=e.featureIndexes||e.data.featureIndexes;if(n)if(this.Fi){const r=e.indices;let o=null,s=!1;const a=[];for(let t=0;t<r.length;t++){const e=i[n[r[t]]];null!==o&&o===r[t]||(s=this.Fi(e.feature),o=r[t]),s||a.push(r[t])}t.setElements(new e.indices.constructor(a))}else t.setElements(e.indices)},outline(t,e){const i=this.painter;i&&i.outline(t,e)},outlineAll(t){const e=this.painter;e&&e.outlineAll(t)},needPolygonOffset(){const t=this.painter;return t&&t.needPolygonOffset()},highlight(t){const e=this.painter;return e&&e.highlight(t)},cancelAllHighlight(){const t=this.painter;return t&&t.cancelAllHighlight()}})}class le$2{constructor(){this.Ui=1}write(t,e){const i=t.gl,n=this.Ui++;return t.stencilFunc(i.ALWAYS,n,255),t.draw(e),n}start(t){const e=t.gl;e.clearStencil(255),e.clear(e.STENCIL_BUFFER_BIT),this.Ui=1,t.start()}end(t){t.end()}}function he$2(t){for(let e=1;e<arguments.length;e++){const i=arguments[e];for(const e in i)t[e]=i[e]}return t}function ce$2(t,e,i){return Math.min(i,Math.max(e,t))}function ue$2(t,e,i){if(t===i||t===e)return t;const n=i-e;return((t-e)%n+n)%n+e}function de$2(t){return null==t}function fe$2(t){return JSON.parse(JSON.stringify(t))}function pe$2(t,e,i,n,r,o){Object.defineProperty(t,e,{enumerable:!0,get:function(){const t=de$2(i[n])||isFunctionDefinition(i[n])?r:i[n];return o?o(t):t}})}const me$2=[];function ye$2(t){for(let e=0;e<t.length;e++)me$2[e]=t[e],me$2[e]*=255;return 3===t.length&&(me$2[3]=255),me$2}function ge$2(t,e=4){return ve$2.bind(this,t,e)}function ve$2(t,e,i){if(Array.isArray(i))return 3===i.length&&4===e&&i.push(1),i;if(t&&t[i])return t[i];const n=color(i).unitArray();return 3===n.length&&4===e&&n.push(1),t&&(t[i]=n),n}function be$2(t,e,i,n){if(t.fill)t.fill(e,i,n);else for(let r=i;r<n;r++)t[r]=e}function xe$2(t){return"number"==typeof t&&!isNaN(t)}function we$2(t){return t&&(t.markerFile||t.markerType)&&void 0!==t.textName}function Ae$2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ke$2(t){const e=[t[0]];let i=t[0];for(let n=1;n<t.length;n++)t[n]!==i&&(e.push(t[n]),i=t[n]);return e}const _e$2="_fn_type_",Se$2={textFill:1,textSize:1,textOpacity:1,markerWidth:1,markerHeight:1,markerOpacity:1,markerDx:1,markerDy:1,lineWidth:1,lineColor:1,lineOpacity:1,polygonFill:1,polygonOpacity:1};function Te$2(t,e,i){for(let n=0;n<i.length;n++){const{symbolName:r}=i[n];(t.qi=t.qi||{})[r]=e[r],Me$2(t,e,i[n])}}function Me$2(t,e,i){const n=t.properties;let r=n.aPickingId;r||(r=n.aPickingId=new t.data.aPickingId.constructor(t.data.aPickingId));const{attrName:o,symbolName:s,evaluate:a,related:l}=i,h=(_e$2+o+"Index").trim();let c=t.data[o];return c?De$2(e[s])||function(t,e){if(!Array.isArray(t))return!1;for(let i=0;i<t.length;i++)if(De$2(e[t[i]]))return!0;return!1}(l,e)?(De$2(e[s])&&Pe$2(t,e,i),c):(c&&c.buffer&&c.buffer.destroy&&c.buffer.destroy(),delete t.data[o],Ie$2(t,o),null):De$2(e[s])?(c=t.data[o]=new i.type(i.width*r.length),Pe$2(t,e,i),ze$2(o,t,t.properties[h],a),c):null}function Pe$2(t,e,i){const{attrName:n,symbolName:r}=i,o=t.properties,s=(_e$2+n+"Index").trim(),a=(_e$2+n).trim();if(o[s]&&o[a])return;const l=function(t){if(!t)return Fe$2;const e=[];for(let i=0;i<t.length;i++)isFunctionDefinition(t[i][1])&&!interpolated(t[i][1]).isZoomConstant&&e.push(t[i][0]);return e}(e[r].stops),h="identity"===e[r].type&&function(t,e,i){let{features:n}=i.properties;if(Array.isArray(n)||(n=Object.values(n)),!n||!n.length)return!1;const{symbolName:r}=t;if(!Se$2[r])return!1;const o=e.property;for(let t=0;t<n.length;t++){const e=n[t]&&n[t].feature;if(!e)continue;const i=e.properties&&e.properties[o];if(i&&isFunctionDefinition(i)&&!interpolated(i).isZoomConstant)return!0}return!1}(i,e[r],t);if(!h&&!l.length)return void Ie$2(t,n);const{features:c,aPickingId:u}=o,d=function(t,e,i,n,r){const o=[];let s=0,a=e[0];for(let l=1,h=e.length;l<h;l++)e[l]===a&&l!==h-1||((r||Ee$2(t[a].feature,i,n))&&o.push(s,l===h-1?h:l),a=e[l],s=l);return o}(c,u,e[r].property,l,h);if(!d.length)return void Ie$2(t,n);const f=t.data[n];o[s]=d,o[a]=f.BYTES_PER_ELEMENT?new f.constructor(f):new i.type(f.length)}function Ie$2(t,e){const i=t.properties,n=(_e$2+e+"Index").trim(),r=(_e$2+e).trim();delete i[n],delete i[r]}function Oe$2(t,e,i,n,r){if(!n)return;const o=n.geometry;if(o){for(let s=0;s<i.length;s++){const a=i[s],l=a.attrName,h=(_e$2+l+"Index").trim();if(!Ce$2(o,e,a)){const{aPickingId:t}=o.properties;if(!t||o.Gi===r)continue;const e=o.properties[h];if(!e)continue;ze$2(l,o,e,a.evaluate);continue}if(o.data[l]){const t=o.data[l];t&&t.buffer&&t.buffer.destroy&&t.buffer.destroy(),delete o.data[l]}const c=Me$2(o,e,a),u=a.define;if(c){if(ze$2(l,o,o.properties[h],a.evaluate),u){const t=n.defines;t[u]=1,n.setDefines(t)}o.generateBuffers(t)}else if(u){const t=n.defines;t[u]&&(delete t[u],n.setDefines(t))}}o.Gi=r}}function Ce$2(t,e,i){const n=e[i.symbolName],r=t.qi;return n!==r[i.symbolName]&&(r[i.symbolName]=n,!0)}function Ee$2(t,e,i){for(let n=0;n<i.length;n++)if("$"===e[0]&&t[e.substring(1)]===i[n]||t.properties[e]===i[n])return!0;return!1}const Fe$2=[];function ze$2(t,e,i,n){const{aPickingId:r,features:o}=e.properties;let s;if(i){const a=(_e$2+t).trim();s=e.properties[a];const l=s.length/r.length,h=i.length;for(let t=0;t<h;t+=2){const a=i[t],h=i[t+1];let c=o[r[a]];c&&c.feature&&je$2(s,c,n,a,h,l,e)}}else{s=e.data[t],s.dirty=!0;const i=s.length/r.length,a=r.length;let l=0;for(let t=0;t<a;t++){if(r[t]===r[l]&&t<a-1)continue;let h=o[r[l]];h&&h.feature&&(je$2(s,h,n,l,t===a-1?a:t,i,e),l=t)}}s.dirty&&(e.updateData(t,s),s.dirty=!1)}function je$2(t,e,i,n,r,o,s){const a=(e=e.feature).properties||{};void 0===a.$layer&&(e.properties||(e.properties=a),a.$layer=e.layer,a.$type=e.type);const l=i(a,s,t,n*o);if(Array.isArray(l)){let e=!1;for(let i=0;i<o;i++)if(t[n*o+i]!==l[i]){e=!0;break}if(e){for(let e=n*o;e<r*o;e+=o)t.set(l,e);t.dirty=!0}}else t[n]!==l&&(be$2(t,l,n,r),t.dirty=!0)}function De$2(t){return K$6.isFnTypeSymbol(t)}const{loginIBLResOnCanvas:Re$2,logoutIBLResOnCanvas:Ne$2,getIBLResOnCanvas:Le$2}=ur$4.PBRUtils,He$2=[],Ve$2=[],Ue$2=[],qe$2=t=>0===t.properties.level,Ge$2=t=>t.properties.level>0;class We$2{constructor(t,e,n,r,o,s){this.regl=t,this.layer=e,this.canvas=e.getRenderer().canvas,this.sceneConfig=r||{},this.dataConfig=s||{},this.pluginIndex=o,this.scene=new pe$4,this.pickingFBO=e.getRenderer().pickingFBO,this.Wi=new le$2,this.level0Filter=qe$2,this.levelNFilter=Ge$2,this.loginTextureCache(),this.symbolDef=Array.isArray(n)?n.map((t=>fe$2(t))):[fe$2(n)],this.Bi(),this.pickingViewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},this.sortByCommandKey=Be$2.bind(this),this.colorCache={}}getMap(){return this.layer?this.layer.getMap():null}getTileLevelValue(t,e){const i=this.layer.getRenderer();return i.getTileLevelValue&&i.getTileLevelValue(t,e)||0}isVisible(){const t=this.$i;if(t.length)for(let e=0;e<t.length;e++)if(t[e]&&!t[e].isFeatureConstant)return!0;const e=this.getSymbols();for(let t=0;t<e.length;t++){const i=e[t].visible;if(!1!==i&&0!==i)return!0}return!1}isMeshVisible(t){const e=t&&t.properties&&t.properties.symbolIndex;if(!e)return!1;const i=this.$i,n=e.index;let r;if(i[n]){if(!i[n].isFeatureConstant)return!0;r=i[n](this.getMap().getZoom())}else r=this.getSymbol(e).visible;return!1!==r&&0!==r}needToRedraw(){return this.Xi}needToRetireFrames(){return this.Y}fillIncludes(t,e,i){const n=i&&i.includes;if(n)for(const r in n)n[r]&&(i[r].uniformDeclares&&e.push(...i[r].uniformDeclares),i[r].defines&&he$2(t,i[r].defines))}setIncludeUniformValues(t,e){const i=e&&e.includes;if(i)for(const n in i)i[n]&&e[n].renderUniforms&&he$2(t,e[n].renderUniforms)}createGeometries(t,e){if(!t.length)return Ve$2;const i=[];for(let n=0;n<t.length;n++)if(t[n])if(void 0!==t[n].ref)i.push(i[t[n].ref]?{geometry:i[t[n].ref].geometry,symbolIndex:t[n].symbolIndex,ref:t[n].ref}:null);else{const r=this.createGeometry(t[n],e,n);if(r&&r.geometry){const{pickingIdMap:o,idPickingMap:s,hasFeaIds:a}=this.Yi(t[n]),l=r.geometry.properties;l.symbolIndex=r.symbolIndex,l.features=e,l.elements=l.elements||r.geometry.elements,a&&(l.feaIdPickingMap=o,l.feaPickingIdMap=s),this.postCreateGeometry(r,i)}i.push(r)}return i}postCreateGeometry(){}Yi(t){if(!t)return{};if(Array.isArray(t)&&!(t=t[0]))return{};const e=t.featureIds,i={},n={},r=e&&e.length;if(r)for(let r=0;r<e.length;r++)i[t.data.aPickingId[r]]=e[r],n[e[r]]||(n[e[r]]=[]),n[e[r]].push(t.data.aPickingId[r]);return{hasFeaIds:r,idPickingMap:i,pickingIdMap:n}}createGeometry(){throw new Error("not implemented")}createMeshes(t,e,i){const n={},r=[];for(let o=0;o<t.length;o++){if(!t[o])continue;let s=this.createMesh(t[o],e,i,n);Array.isArray(s)?(s=s.filter((t=>!!t)),r.push(...s)):s&&r.push(s)}return r}createMesh(){throw new Error("not implemented")}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).bloom}addMesh(t,e,i){t=t.filter((t=>this.isMeshVisible(t)));const n=!!i.bloom;t.forEach((t=>{const e=this.isBloom(t)&&n;t.bloom=e;const i=t.defines||{};!!i.HAS_BLOOM!==e&&(e?i.HAS_BLOOM=1:delete i.HAS_BLOOM,t.setDefines(i)),this.Ji(t)})),this.scene.addMesh(t)}updateCollision(){}render(t){return this.pluginIndex=t.pluginIndex,this.polygonOffsetIndex=t.polygonOffsetIndex,this.paint(t)}prepareRender(t){if(this.ct===t.timestamp)return;if(this.ct=t.timestamp,!this.createFnTypeConfig)return;const e=this.scene.getMeshes();if(!e||!e.length)return;const i=this.getMap().getZoom();for(let t=0;t<e.length;t++){if(!e[t]||!e[t].geometry)continue;const{symbolIndex:n}=e[t].properties,r=this.getSymbolDef(n);if(!r)continue;const o=this.getFnTypeConfig(n);Oe$2(this.regl,r,o,e[t],i)}}paint(t){const e=this.layer.getMap();if(!e)return{redraw:!1};this.Zi=t;const i=this.getUniformValues(e,t);return this.callShader(i,t),{redraw:this.Xi}}setToRedraw(t){t&&(this.Y=t),this.Xi=!0}callShader(t,e){this.callCurrentTileShader(t,e),this.callBackgroundTileShader(t,e)}callCurrentTileShader(t,e){this.shader&&(this.shader.filter=e.sceneFilter?[this.level0Filter,e.sceneFilter]:this.level0Filter),this.callRenderer(this.shader,t,e)}callBackgroundTileShader(t,e){this.shader&&(this.shader.filter=e.sceneFilter?[this.levelNFilter,e.sceneFilter]:this.levelNFilter),this.scene.getMeshes().sort($e$2),this.callRenderer(this.shader,t,e)}callRenderer(t,e,i){const n=this.scene.getMeshes(),r=[];n.forEach((t=>{t.properties.hlBloomMesh&&i.bloom&&r.push(t.properties.hlBloomMesh),r.push(t)})),this.scene.setMeshes(r),this.renderer.render(t,e,this.scene,this.getRenderFBO(i)),this.scene.setMeshes(n)}getRenderFBO(t){return t&&t.renderTarget&&t.renderTarget.fbo}needPolygonOffset(){return!1}getPolygonOffset(){const t=this.layer;return{factor:(e,i)=>i.meshConfig.ssr?1:-(t.getPolygonOffset()+(this.polygonOffsetIndex||0)),units:(e,i)=>i.meshConfig.ssr?1:-(t.getPolygonOffset()+(this.polygonOffsetIndex||0))}}getBlendFunc(){return{src:()=>this.sceneConfig.blendSrc||"src alpha",dst:()=>this.sceneConfig.blendDst||"one minus src alpha"}}pick(t,e,i=3){if(!this.layer.options.picking||!1===this.sceneConfig.picking)return null;if(!this.pickingFBO||!this.picking)return null;const n=this.getMap(),r=this.getUniformValues(n);for(let o=0;o<this.picking.length;o++){const s=this.picking[o];s.render(this.scene.getMeshes(),r,!0);let a={};s.getRenderedMeshes().length&&(a=s.pick(t,e,i,r,{viewMatrix:n.viewMatrix,projMatrix:n.projMatrix,returnPoint:this.layer.options.pickingPoint&&!1!==this.sceneConfig.pickingPoint}));const{meshId:l,pickingId:h,point:c}=a,u=(0===l||l)&&s.getMeshAt(l);if(!u||!u.geometry)continue;let d=u.geometry.properties;d.features||(d=u.properties),c&&c.length&&(c[0]=Math.round(1e5*c[0])/1e5,c[1]=Math.round(1e5*c[1])/1e5,c[2]=Math.round(1e5*c[2])/1e5);const f={data:d&&d.features&&d.features[h],point:c,plugin:this.pluginIndex},p=u.geometry.properties.feaPickingIdMap;return p&&(f.featureId=p[h]),f}return null}updateSceneConfig(){}updateDataConfig(){return!0}deleteMesh(t,e){if(t)if(this.scene.removeMesh(t),Array.isArray(t))for(let i=0;i<t.length;i++){if(!t[i].isValid())continue;const n=t[i].geometry;!e&&n&&n.dispose(),t[i].material&&t[i].material.dispose(),t[i].dispose(),this.Ki(t[i])}else{if(!t.isValid())return;!e&&t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose(),t.dispose(),this.Ki(t)}}Ki(t){if(!t)return;const{hlBloomMesh:e}=t.properties;e&&(e.geometry.dispose(),e.dispose(),delete t.properties.hlBloomMesh)}startFrame(t){this.Qi||(this.init(t),this.Qi=!0),this.ct!==t.timestamp&&(this.Xi=!1,this.Y=!1),this.scene.clear()}resize(){}delete(){if(this.scene.clear(),this.shader&&this.shader.dispose(),this.picking){for(let t=0;t<this.picking.length;t++)this.picking[t].dispose();delete this.picking}if(this.tn){for(let t=0;t<this.tn.length;t++)this.tn[t].dispose();delete this.tn}this.logoutTextureCache()}updateSymbol(t,e){const i=this.supportRenderMode("taa");Array.isArray(t)||(t=[t],e=[e]);let n=!1;for(let i=0;i<t.length;i++)if(t[i]){const r=this.en(i,t[i],e[i]);r&&(n=r)}return delete this.in,this.setToRedraw(i),n}nn(t,e){for(const i in e)if(Ae$2(e,i)&&Qo$1[i]&&!fastDeepEqual(e[i],t[i]))return!0;return!1}en(t,e,i){if(!this.rn)return!1;const n=this.nn(this.symbolDef[t]||{},i);this.symbolDef[t]=fe$2(i);const r=this.rn[t];for(const t in r)delete r[t];const o=this.getMap(),s=loadFunctionTypes(this.symbolDef[t],(()=>[o.getZoom()]));for(const t in s){const e=Object.getOwnPropertyDescriptor(s,t);e.get?Object.defineProperty(r,t,{get:e.get,set:e.set,configurable:!0,enumerable:!0}):r[t]=s[t]}return isFunctionDefinition(i.visible)&&(this.$i[t]=interpolated(i.visible)),n}getSymbolDef(t){return this.symbolDef[t.index]}getSymbols(){return this.rn}getSymbol(t){return this.rn[t.index]}Bi(){const t=this.getMap(),e=()=>[t.getZoom()];this.rn=[],this.$i=[];for(let t=0;t<this.symbolDef.length;t++)this.rn[t]=loadFunctionTypes(he$2({},this.symbolDef[t]),e),this.symbolDef[t]&&isFunctionDefinition(this.symbolDef[t].visible)&&(this.$i[t]=interpolated(this.symbolDef[t].visible))}getFnTypeConfig(t){this.in||(this.in=[]);const e=t.index;if(!this.in[e]){const i=this.getSymbolDef(t),n=this.getMap();this.in[e]=this.createFnTypeConfig(n,i)}return this.in[e]}sn(){delete this.in}loginTextureCache(){const t="__gl_textures".trim(),e=this.getMap();e[t]||(e[t]={count:0}),e[t].count++}logoutTextureCache(){const t="__gl_textures".trim(),e=this.getMap(),i=this.an;if(i)for(const n in i)Ae$2(i,n)&&e[t][n]&&(e[t][n].count--,e[t][n].count<=0&&delete e[t][n]);e[t].count--,e[t].count<=0&&(e[t]={})}getCachedTexture(t){const e="__gl_textures".trim(),i=this.getMap()[e][t];return i?i.data:null}addCachedTexture(t,e){const i="__gl_textures".trim(),n=this.getMap();let r=n[i][t];r?r.data=e:r=n[i][t]={data:e,count:0},this.an||(this.an={}),r.data.then||this.an[t]||(r.count++,this.an[t]=1)}disposeCachedTexture(t){let e;if(e="string"==typeof t?t:t.url,!this.an||!this.an[e])return;const i="__gl_textures".trim();delete this.an[e];const n=this.getMap();n[i][e]&&(n[i][e].count--,n[i][e].count<=0&&delete n[i][e])}shouldDeleteMeshOnUpdateSymbol(){return!1}needClearStencil(){return!1}supportRenderMode(t){return"taa"===t||"fxaa"===t}ln(t){const e=this.scene.getMeshes();if(!e.length)return;const i=e.map((t=>({transform:t.localTransform,level:t.properties.level,mesh:t}))).sort(this.hn),n=this.getMap().projViewMatrix;this.Wi.start(t);const o={};for(let e=0;e<i.length;e++){const s=i[e].mesh;let a=o[s.properties.tile.id];void 0===a&&(multiply$5(He$2,n,i[e].transform),a=this.Wi.write(t,He$2),o[s.properties.tile.id]=a),s.setUniform("ref",a)}this.Wi.end(t),this.regl.cn()}hn(t,e){return e.level-t.level}outline(t,e){const i={};for(let n=0;n<e.length;n++)de$2(e[n])||i[e[n]]||(this.un(t,e[n]),i[e[n]]=1)}un(t,e){if(!this.picking)return;if(this.dn||(this.dn=new pe$4),!this.tn&&(this.pn(),!this.tn))return void console.warn(`Plugin at ${this.pluginIndex} doesn't support outline.`);const n=this.getUniformValues(this.getMap(),this.Zi),r=this.mn(e);if(r.length)for(let i=0;i<r.length;i++){const o=r[i].geometry.properties.feaIdPickingMap;if(o){const s=o[e];if(s){const e={};this.dn.setMeshes(r[i]);for(let i=0;i<s.length;i++){const r=s[i];if(!e[r]){e[r]=1,n.highlightPickingId=r;for(let e=0;e<this.tn.length;e++)this.renderer.render(this.tn[e],n,this.dn,t)}}}}}}mn(t){const e=[],i=this.scene.getMeshes();for(let n=0;n<i.length;n++){const r=i[n],o=r.geometry.properties.feaIdPickingMap;o&&void 0!==o[t]&&e.push(r)}return e}outlineAll(t){if(!this.picking)return;if(!this.tn&&(this.pn(),!this.tn))return void console.warn(`Plugin at ${this.pluginIndex} doesn't support outline.`);const e=this.getUniformValues(this.getMap(),this.Zi);e.highlightPickingId=-1;for(let i=0;i<this.tn.length;i++)this.renderer.render(this.tn[i],e,this.scene,t)}pn(){if(!this.picking)return;const t=this.layer.getRenderer().canvas;this.tn=[];for(let e=0;e<this.picking.length;e++){const n=this.picking[e].getPickingVert(),r={ENABLE_PICKING:1,HAS_PICKING_ID:1},o=this.picking[e].getUniformDeclares().slice(0);void 0!==o.uPickingId&&(r.HAS_PICKING_ID=2),this.tn[e]=new rt$6({vert:n,frag:"precision highp float;\nuniform float highlightPickingId;\nvarying float vPickingId;\nvoid main() {\n  if(highlightPickingId < .0 || floor(highlightPickingId + .5) == floor(vPickingId + .5)) {\n    gl_FragColor = vec4(1.);\n  } else {\n    discard;\n  }\n}",uniforms:o,defines:r,extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height},depth:{enable:!0,mask:!1,func:"always"},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}),this.tn[e].filter=this.picking[e].filter}}hasIBL(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}updateIBLDefines(t){const e=t.shaderDefines;let i=!1;this.hasIBL()?e[["HAS_IBL_LIGHTING"]]||(e.HAS_IBL_LIGHTING=1,i=!0):e[["HAS_IBL_LIGHTING"]]&&(delete e.HAS_IBL_LIGHTING,i=!0),i&&(t.shaderDefines=e)}getIBLRes(){const t=this.layer.getRenderer().canvas;return Le$2(t)}createIBLTextures(){const t=this.layer.getRenderer().canvas;Re$2(t,this.regl,this.getMap()),this.setToRedraw(!0),this.layer.fire("iblupdated")}disposeIBLTextures(){const t=this.layer.getRenderer().canvas;Ne$2(t,this.getMap())}evaluateInFnTypeConfig(t,e,i,n,r){let o=this.yn;o||(o=this.yn={});const s=function(t){let e=0;const i=t&&t.length||0;if(!i)return e;let n;for(let r=0;r<i;r++)n=t.charCodeAt(r),e=(e<<5)-e+n,e&=e;return e}(JSON.stringify(t));let a=o[s];return a||(a=o[s]=r?piecewiseConstant(t):interpolated(t)),a(i.getZoom(),n)}highlight(t){this.Xt=t,this.gn=this.layer.getRenderer().getFrameTimestamp(),this.setToRedraw(!0)}cancelAllHighlight(){this.Xt=null,this.gn=this.layer.getRenderer().getFrameTimestamp(),this.setToRedraw(!0)}vn(t,e){const{featureIds:i,feaIdAttrMap:n,feaIdIndiceMap:r}=e;t.properties.aFeaIds=i;const o=new Set;for(let t=0,e=i.length;t<e;t++)o.add(i[t]);t.properties.featureIdSet=o,t.properties.feaIdAttrMap=n,t.properties.feaIdIndiceMap=r}Ji(t){const{highlightTimestamp:e}=t.properties;if(!this.Xt){if(e){const e=t.defines;delete e.HAS_HIGHLIGHT_COLOR,delete e.HAS_HIGHLIGHT_OPACITY,t.setDefines(e),delete t.properties.highlightTimestamp,this.Ki(t)}return}if(this.gn===e)return;const{featureIdSet:n,aFeaIds:o,feaIdAttrMap:s,feaIdIndiceMap:l}=t.geometry.properties;let{aHighlightColor:h,aHighlightOpacity:c}=t.geometry.properties;h&&h.fill(0),c&&c.fill(255);let u=!1,d=!1;const f=this.Xt,p=Object.keys(this.Xt),m=[];for(let t=0;t<p.length;t++){const e=f[p[t]].id;if(n.has(e)){let{color:t,opacity:i,bloom:n}=f[e];if(t){u||(h||(h=new Uint8Array(4*o.length)),u=!0);const i=K$6.normalizeColor(Ue$2,t),[n,r]=s[e],l=r-n;for(let t=0;t<l;t++){const e=4*(n+t);set$3(h.subarray(e,e+4),...i)}}if(i=de$2(i)?1:i,i<1){d||(c||(c=new Uint8Array(o.length),c.fill(255)),d=!0);const[t,n]=s[e],r=n-t;for(let e=0;e<r;e++)c[t+e]=255*i}if(n){const t=l[e];if(t)for(let e=0;e<t.length;e++)m.push(t[e])}}}const y=t.defines;u?(t.geometry.data.aHighlightColor?t.geometry.updateData("aHighlightColor",h):(t.geometry.data.aHighlightColor=h,t.geometry.generateBuffers(this.regl)),t.geometry.properties.aHighlightColor=h,y.HAS_HIGHLIGHT_COLOR=1):y.HAS_HIGHLIGHT_COLOR&&(t.geometry.updateData("aHighlightColor",h),delete y.HAS_HIGHLIGHT_COLOR),d?(t.geometry.data.aHighlightOpacity?t.geometry.updateData("aHighlightOpacity",c):(t.geometry.data.aHighlightOpacity=c,t.geometry.generateBuffers(this.regl)),t.geometry.properties.aHighlightOpacity=c,y.HAS_HIGHLIGHT_OPACITY=1):y.HAS_HIGHLIGHT_OPACITY&&(t.geometry.updateData("aHighlightOpacity",c),delete y.HAS_HIGHLIGHT_OPACITY),t.setDefines(y),t.properties.highlightTimestamp=this.gn;let g=t.properties.hlBloomMesh;if(m.length){if(g){const e=copy$5(g.localTransform,t.localTransform),i=copy$5(g.positionMatrix,t.positionMatrix);g.setLocalTransform(e),g.setPositionMatrix(i),t.properties.hlBloomMesh.geometry.setElements(m)}else{const e=new Z$7(t.geometry.data,m,0,t.geometry.desc);g=new de$4(e,t.material,t.config);const o=t.uniforms;for(const e in o)Object.defineProperty(g.uniforms,e,{enumerable:!0,get:function(){return t.getUniform(e)}});const s=he$2({},t.defines);s.HAS_BLOOM=1;const a=copy$5([],t.localTransform),l=copy$5([],t.positionMatrix);g.setLocalTransform(a),g.setPositionMatrix(l),he$2(g.properties,t.properties),he$2(e.properties,t.geometry.properties),g.setDefines(s),g.bloom=1}t.properties.hlBloomMesh=g}else g&&this.Ki(t)}}function Be$2(t,e){const i=t&&t.getCommandKey(this.regl)||"",n=e&&e.getCommandKey(this.regl)||"";return i.localeCompare(n)}function $e$2(t,e){return t.properties.level-e.properties.level}class Xe$2 extends We$2{createGeometry(t,e){if(!t.data)return{geometry:null,symbolIndex:t.symbolIndex};t.iconAtlas&&t.iconAtlas.image&&(t.iconAtlas.image.dataType=t.type,t.iconAtlas.image.type="icon"),t.glyphAtlas&&t.glyphAtlas.image&&(t.glyphAtlas.image.type="glyph");const n=he$2({},t.data),r=new Z$7(n,t.indices,0,{primitive:this.getPrimitive(),positionSize:t.positionSize});return r.properties={features:e,elements:t.indices},t.iconAtlas&&(r.properties.iconAtlas=t.iconAtlas.image),t.glyphAtlas&&(r.properties.glyphAtlas=t.glyphAtlas.image),r.properties.aFeaIds=t.featureIds,this.vn(r,t),r.properties.collideIds=t.featureIds&&t.featureIds.length?t.featureIds:t.data.aPickingId,r.properties.uniqueCollideIds=ke$2(r.properties.collideIds),he$2(r.properties,t.properties),{geometry:r,symbolIndex:t.symbolIndex}}getPrimitive(){return"triangles"}getRenderFBO(t){return t&&t.renderTarget&&t.renderTarget.fbo}supportRenderMode(t){return"noAa"===t}createAtlasTexture(t,e){const i=this.regl,r={width:t.width,height:t.height,data:t.data,format:t.format,mag:"linear",min:"linear",flipY:e};if("icon"===t.type){const e="point"!==t.dataType?"repeat":"clamp";r.wrapS=e,r.wrapT=e}return i.texture(r)}drawDebugAtlas(t){if(document.getElementById("MAPTALKS_ICON_DEBUG")){const e=document.getElementById("MAPTALKS_ICON_DEBUG");let i;if(e.width=t.width,e.height=t.height,e.style.width=t.width+"px",e.style.height=t.height+"px","alpha"===t.format){i=new Uint8ClampedArray(4*t.data.length);for(let e=0;e<t.data.length;e++)i[4*e+3]=t.data[e]}else i=new Uint8ClampedArray(t.data);const n=e.getContext("2d");n.imageSmoothingEnabled=!1,n.putImageData(new ImageData(i,t.width,t.height),0,0)}}}var Ye$2="#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 projViewModelMatrix;\n#include <fbo_picking_vert>\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n  fbo_picking_setData(gl_Position.w, true);\n}";function Je$2(t,e,i){const r={width:e.width,height:e.height,data:e.data,format:e.format,mag:"linear",min:"linear",flipY:i};if("icon"===e.type){const t="point"!==e.dataType?"repeat":"clamp";r.wrapS=t,r.wrapT=t}return t.texture(r)}const Ze$2={polygonFill:[1,1,1,1],polygonOpacity:1,uvScale:[1,1],uvOffset:[0,0]};class Ke$2 extends Xe$2{prepareSymbol(t){const e=t.polygonFill;Array.isArray(e)&&(3===e.length&&e.push(1),t.polygonFill=e.map((t=>255*t)))}supportRenderMode(t){return this.sceneConfig.antialias||void 0===this.sceneConfig.antialias?"fxaa"===t||"fxaaBeforeTaa"===t:super.supportRenderMode(t)}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).polygonBloom}needPolygonOffset(){return!0}createMesh(t,e,n){const{tilePoint:r}=n,{geometry:o,symbolIndex:s,ref:a}=t,l=o.data.aPosition instanceof Int16Array,h={tileExtent:o.properties.tileExtent,tileRatio:o.properties.tileRatio},c=this.getSymbol(s);if(pe$2(h,"polygonFill",c,"polygonFill",Ze$2.polygonFill,ge$2(this.colorCache)),pe$2(h,"polygonOpacity",c,"polygonOpacity",Ze$2.polygonOpacity),pe$2(h,"uvScale",c,"uvScale",Ze$2.uvScale),pe$2(h,"uvOffset",c,"uvOffset",Ze$2.uvOffset),void 0===a){const t=this.getSymbolDef(s),e=this.getFnTypeConfig(s);Te$2(o,t,e),o.generateBuffers(this.regl)}const u=o.properties.iconAtlas;if(u&&o.data.aTexInfo){const t=this.getMap();h.tilePoint=r,Object.defineProperty(h,"tileScale",{enumerable:!0,get:function(){return o.properties.tileResolution/t.getResolution()}}),h.polygonPatternFile=Je$2(this.regl,u,!1),h.atlasSize=[u.width,u.height],this.drawDebugAtlas(u)}const d=new ee$3(h,Ze$2),f=new de$4(o,d,{disableVAO:!0,castShadow:!1,picking:!0}),p={};return u&&o.data.aTexInfo&&(p.HAS_PATTERN=1),o.data.aAltitude&&(p.HAS_ALTITUDE=1),o.data.aColor&&(p.HAS_COLOR=1),o.data.aOpacity&&(p.HAS_OPACITY=1),o.data.aUVScale&&(p.HAS_UV_SCALE=1),o.data.aUVOffset&&(p.HAS_UV_OFFSET=1),l&&(p.IS_VT=1),f.setDefines(p),f.setLocalTransform(e),f.properties.symbolIndex=s,f}createFnTypeConfig(t,e){const i=piecewiseConstant(e.polygonFill),n=interpolated(e.polygonOpacity),r=interpolated(e.uvScale),o=interpolated(e.uvOffset),s=new Uint8Array(1),a=new Uint16Array(1);return[{attrName:"aColor",symbolName:"polygonFill",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||color(r).unitArray()),r=ye$2(r),r}},{attrName:"aOpacity",symbolName:"polygonOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e)),s[0]=255*r,s[0]}},{attrName:"aUVScale",symbolName:"uvScale",type:Uint16Array,width:2,define:"HAS_UV_SCALE",evaluate:e=>{let i=r(t.getZoom(),e);return a[0]=10*i,a[0]}},{attrName:"aUVOffset",symbolName:"uvOffset",type:Uint8Array,width:2,define:"HAS_UV_OFFSET",evaluate:e=>{let i=o(t.getZoom(),e);return s[0]=255*i,s[0]}}]}paint(t){t.states&&t.states.includesChanged.shadow&&(this.shader.dispose(),this.bn(t)),super.paint(t)}init(t){this.renderer=new k$7(this.regl);const n=this.layer.getRenderer(),o=n.isEnableTileStencil&&n.isEnableTileStencil(),a={viewport:this.pickingViewport,stencil:{enable:!0,func:{cmp:()=>o?"=":"<=",ref:(t,e)=>o?e.stencilRef:e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:(t,e)=>{if(!de$2(this.sceneConfig.depthMask))return!!this.sceneConfig.depthMask;if(e.meshConfig.transparent)return!1;const i=e.polygonOpacity;return!(xe$2(i)&&i<1)},func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}};this.bn(t,a),this.pickingFBO&&(this.picking=[new nr$4(this.renderer,{vert:Ye$2,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],extraCommandProps:a},this.pickingFBO)])}bn(t,e){const n=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],o={};this.fillIncludes(o,n,t),this.shader=new rt$6({vert:"#define SHADER_NAME FILL\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\nuniform mat4 projViewModelMatrix;\n#ifndef IS_VT\nuniform mat4 modelMatrix;\n#endif\n#ifdef HAS_PATTERN\nattribute vec4 aTexInfo;\nuniform vec2 tilePoint;\n#ifdef IS_VT\nuniform float tileRatio;\nuniform float tileScale;\n#else\nuniform float glScale;\n#endif\n#ifdef HAS_UV_SCALE\nattribute vec2 aUVScale;\nvarying vec2 vUVScale;\n#endif\n#ifdef HAS_UV_OFFSET\nattribute vec2 aUVOffset;\nvarying vec2 vUVOffset;\n#endif\nvarying vec2 vTexCoord;\nvarying vec4 vTexInfo;\nvec2 c(vec2 d, vec2 e) {\n  vTexInfo = vec4(aTexInfo.xy, e);\n#ifdef IS_VT\nfloat f = d.x / e.x;\n  float h = d.y / e.y;\n  return vec2(f, h);\n#else\nfloat f = (d.x - tilePoint.x) * glScale / e.x;\n  float h = (d.y - tilePoint.y) * glScale / e.y;\n  return vec2(f, -h);\n#endif\n}\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <vt_position_vert>\n#include <highlight_vert>\nvoid main() {\n  vec3 i = unpackVTPosition();\n  vec4 j = vec4(i, 1.);\n  gl_Position = projViewModelMatrix * j;\n#ifdef HAS_PATTERN\nvec2 k = aTexInfo.zw + 1.;\n#ifdef IS_VT\nvec2 l = mod((tilePoint) * tileScale * vec2(1., -1.) / k, 1.);\n  vTexCoord = l + c(i.xy * tileScale / tileRatio, k);\n#else\nvec4 m = modelMatrix * j;\n  vTexCoord = c(m.xy, k);\n#endif\n#ifdef HAS_UV_SCALE\nvUVScale = aUVScale / 255.;\n#endif\n#ifdef HAS_UV_OFFSET\nvUVOffset = aUVOffset / 255.;\n#endif\n#endif\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\nhighlight_setVarying();\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(j);\n#endif\n}",frag:"#define SHADER_NAME FILL\nprecision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#ifdef HAS_PATTERN\n#ifdef HAS_UV_SCALE\nvarying vec2 vUVScale;\n#else\nuniform vec2 uvScale;\n#endif\n#ifdef HAS_UV_OFFSET\nvarying vec2 vUVOffset;\n#else\nuniform vec2 uvOffset;\n#endif\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D polygonPatternFile;\nuniform vec2 atlasSize;\nvarying vec2 vTexCoord;\nvarying vec4 vTexInfo;\nvec2 c() {\n  \n#ifdef HAS_UV_SCALE\nvec2 d = vUVScale;\n#else\nvec2 d = uvScale;\n#endif\n#ifdef HAS_UV_OFFSET\nvec2 e = vUVOffset;\n#else\nvec2 e = uvOffset;\n#endif\nvec2 f = mod(vTexCoord * d + e, 1.);\n  vec2 h = vTexInfo.xy;\n  vec2 i = vTexInfo.zw;\n  return (h + f * i) / atlasSize;\n}\n#endif\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#include <highlight_frag>\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float polygonOpacity;\n#endif\nuniform float tileExtent;\nvoid main() {\n  \n#ifdef HAS_COLOR\nvec4 j = vColor;\n#else\nvec4 j = polygonFill;\n#endif\n#ifdef HAS_PATTERN\nif(vTexInfo.z * vTexInfo.w > 1.) {\n    vec2 f = c();\n    j = texture2D(polygonPatternFile, f);\n  }\n#endif\n#ifdef HAS_OPACITY\ngl_FragColor = vec4(j.rgb, j.a * vOpacity);\n#else\ngl_FragColor = vec4(j.rgb, j.a * polygonOpacity);\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat k = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, k);\n#endif\ngl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:n,defines:o,extraCommandProps:e})}getUniformValues(t,e){const i={projViewMatrix:t.projViewMatrix,glScale:1/t.getGLScale()};return this.setIncludeUniformValues(i,e),i}}var Qe$2="#define SHADER_NAME LINE\n#define AA_CLIP_LIMIT 2.0\n#define AA_LINE_WIDTH 16.0\n#define DEVICE_PIXEL_RATIO 1.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define EXTRUDE_SCALE 63.0\n#define EXTRUDE_MOD 64.0\n#define MAX_LINE_DISTANCE 65535.0\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY)\nattribute vec3 aExtrude;\n#else\nattribute vec2 aExtrude;\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nattribute float aLinesofar;\nvarying highp float vLinesofar;\n#endif\nuniform float cameraToCenterDistance;\n#if defined(HAS_STROKE_WIDTH)\nattribute float aLineStrokeWidth;\n#else\nuniform float lineStrokeWidth;\n#endif\nuniform mat4 projViewModelMatrix;\nuniform mat4 modelMatrix;\nuniform float tileResolution;\nuniform float resolution;\nuniform float tileRatio;\n#if defined(HAS_LINE_DX) || defined(HAS_LINE_DY)\nattribute vec2 aLineDxDy;\n#endif\n#ifndef HAS_LINE_DX\nuniform float lineDx;\n#endif\n#ifndef HAS_LINE_DY\nuniform float lineDy;\n#endif\nuniform vec2 canvasSize;\nuniform float layerScale;\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\n#ifdef USE_LINE_OFFSET\nattribute vec2 aExtrudeOffset;\n#endif\n#ifdef HAS_LINE_WIDTH\nattribute float aLineWidth;\n#else\nuniform float lineWidth;\n#endif\n#ifndef PICKING_MODE\n#ifndef HAS_GRADIENT\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_PATTERN\n#if defined(HAS_PATTERN_ANIM) || defined(HAS_PATTERN_GAP)\nattribute vec2 aLinePattern;\n#endif\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#endif\nattribute vec4 aTexInfo;\nvarying vec4 vTexInfo;\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nattribute vec4 aDasharray;\nvarying vec4 vDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nattribute vec4 aDashColor;\nvarying vec4 vDashColor;\n#endif\n#endif\n#endif\n#ifdef HAS_STROKE_COLOR\nattribute vec4 aStrokeColor;\nvarying vec4 vStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\n#ifdef HAS_GRADIENT\nattribute float aGradIndex;\nvarying float vGradIndex;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\nvarying vec3 vVertex;\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  float d = mod(abs(aExtrude.x), 2.);\n  float e = mod(abs(aExtrude.y), 2.);\n  vNormal = vec2(d, e * 2. - 1.);\n  vec4 f = vec4(c, 1.);\n  vec4 h = projViewModelMatrix * f;\n  vVertex = (modelMatrix * f).xyz;\n#ifdef HAS_STROKE_WIDTH\nfloat i = aLineStrokeWidth / 2. * layerScale;\n#else\nfloat i = lineStrokeWidth;\n#endif\n#ifdef HAS_LINE_WIDTH\nfloat j = aLineWidth / 2. * layerScale;\n#else\nfloat j = lineWidth * layerScale;\n#endif\nfloat k = j / 2. + i;\n  float l = sign(i) * j / 2.;\n  float m = l + sign(l) * ANTIALIASING;\n  float n = k + sign(k) * ANTIALIASING;\n#ifdef USE_LINE_OFFSET\nvec2 o = lineOffset * (vNormal.y * (aExtrude.xy - aExtrudeOffset) + aExtrudeOffset);\n  vec2 u = (n * aExtrude.xy + o) / EXTRUDE_SCALE;\n#else\nvec2 v = aExtrude.xy / EXTRUDE_SCALE;\n  vec2 u = n * v;\n#endif\nfloat A = tileResolution / resolution;\n  vec4 B = vec4(c + vec3(u, .0) * tileRatio / A, 1.);\n  gl_Position = projViewModelMatrix * B;\n  float C = min(AA_CLIP_LIMIT / canvasSize.x, AA_CLIP_LIMIT / canvasSize.y);\n  float D = distance(gl_Position.xy / gl_Position.w, h.xy / h.w) - C;\n  if(D * j < .0) {\n    float E = -D / C;\n    float F = E * E * E * E * AA_LINE_WIDTH;\n    u += F * v;\n    n += F / 6.;\n    B = vec4(c + vec3(u, .0) * tileRatio / A, 1.);\n    gl_Position = projViewModelMatrix * B;\n  }\n#ifdef HAS_LINE_DX\nfloat G = aLineDxDy[0];\n#else\nfloat G = lineDx;\n#endif\n#ifdef HAS_LINE_DY\nfloat H = aLineDxDy[1];\n#else\nfloat H = lineDy;\n#endif\nfloat I = gl_Position.w;\n  gl_Position.xy += vec2(G, H) * 2. / canvasSize * I;\n#ifndef PICKING_MODE\nvWidth = vec2(n, m);\n  vGammaScale = I / cameraToCenterDistance;\n#ifndef ENABLE_TILE_STENCIL\nvPosition = c.xy;\n#ifdef USE_LINE_OFFSET\nvPosition += tileRatio * o / EXTRUDE_SCALE;\n#endif\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT)\n#ifdef HAS_GRADIENT\nvLinesofar = aLinesofar / MAX_LINE_DISTANCE;\n  vGradIndex = aGradIndex;\n#else\nfloat J = aLinesofar - k * aExtrude.z / EXTRUDE_SCALE / A * tileRatio;\n  vLinesofar = J / tileRatio * A;\n#endif\n#endif\n#ifndef HAS_GRADIENT\n#ifdef HAS_COLOR\nvColor = aColor;\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvDasharray = aDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvDashColor = aDashColor / 255.;\n#endif\n#endif\n#ifdef HAS_PATTERN\nvTexInfo = vec4(aTexInfo.xy, aTexInfo.zw + 1.);\n#ifdef HAS_PATTERN_ANIM\nvLinePatternAnimSpeed = aLinePattern[0] / 127.;\n#endif\n#ifdef HAS_PATTERN_GAP\nvLinePatternGap = aLinePattern[1] / 10.0;\n#endif\n#endif\n#endif\n#ifdef HAS_STROKE_COLOR\nvStrokeColor = aStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(B);\n#endif\nhighlight_setVarying();\n#else\nfbo_picking_setData(I, true);\n#endif\n}";class ti$1 extends Xe$2{prepareSymbol(t){const e=t.lineColor;Array.isArray(e)&&(3===e.length&&e.push(1),t.lineColor=e.map((t=>255*t)));const i=t.lineStrokeColor;Array.isArray(i)&&(3===i.length&&i.push(1),t.lineStrokeColor=i.map((t=>255*t)));const n=t.lineDashColor;Array.isArray(n)&&(3===n.length&&n.push(1),t.lineDashColor=n.map((t=>255*t)))}needToRedraw(){if(super.needToRedraw())return!0;if(this.xn)return!0;const t=this.getSymbols(),e=this.sceneConfig.trailAnimation;if(e&&e.enable||super.needToRedraw())return!0;for(let e=0;e<t.length;e++)if(t[e].linePatternAnimSpeed)return!0;return!1}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).lineBloom}needPolygonOffset(){return!0}createMesh(t,e){if(!t.geometry)return null;const{geometry:n,symbolIndex:r,ref:o}=t,s=this.getSymbolDef(r);void 0===o&&Te$2(n,s,this.getFnTypeConfig(r));const a=this.getSymbol(r),l={tileResolution:n.properties.tileResolution,tileRatio:n.properties.tileRatio,tileExtent:n.properties.tileExtent};this.setLineUniforms(a,l),pe$2(l,"lineColor",a,"lineColor","#fff",ge$2(this.colorCache)),pe$2(l,"linePatterGapColor",a,"linePatterGapColor",[0,0,0,0],ge$2(this.colorCache)),pe$2(l,"lineStrokeColor",a,"lineStrokeColor",[0,0,0,0],ge$2(this.colorCache)),pe$2(l,"lineDasharray",a,"lineDasharray",[0,0,0,0],(t=>{let e;if(t&&t.length){const i=t;1===t.length?e=[i[0],i[0],i[0],i[0]]:2===t.length?e=[i[0],i[1],i[0],i[1]]:3===t.length?e=[i[0],i[1],i[2],i[2]]:4===t.length&&(e=t)}return e||[0,0,0,0]})),pe$2(l,"lineDashColor",a,"lineDashColor",[0,0,0,0],ge$2(this.colorCache));const h=n.properties.iconAtlas,c=n.data.aPosition instanceof Int16Array;h&&(l.linePatternFile=Je$2(this.regl,h,!1),l.atlasSize=h?[h.width,h.height]:[0,0],l.flipY=c?-1:1,this.drawDebugAtlas(h)),void 0===o&&n.generateBuffers(this.regl);const u=new ee$3(l),d=new de$4(n,u,{castShadow:!1,picking:!0});d.setLocalTransform(e);const f={};return h&&(f.HAS_PATTERN=1),d.properties.symbolIndex=r,this.wn(d,f),n.data.aColor&&(f.HAS_COLOR=1),n.data.aStrokeColor&&(f.HAS_STROKE_COLOR=1),this.setMeshDefines(f,n,s),n.data.aAltitude&&(f.HAS_ALTITUDE=1),d.setDefines(f),d}addMesh(...t){delete this.xn;const e=t[0];Array.isArray(e)&&e.forEach((t=>{this.An(t)})),super.addMesh(...t)}An(t){if(!t.geometry.aLineWidth&&t.material.get("lineWidth")<=0||!t.geometry.aOpacity&&t.material.get("lineOpacity")<=0)return;const e=t.defines;this.wn(t,e),t.setDefines(e),t.geometry.properties.hasPatternAnim&&(this.xn=1)}wn(t,e){const i=t.geometry,n=this.getSymbol(t.properties.symbolIndex);i.data.aDasharray||Array.isArray(n.lineDasharray)&&n.lineDasharray.reduce(((t,e)=>t+e),0)>0?(e.HAS_DASHARRAY=1,i.data.aDasharray&&(e.HAS_DASHARRAY_ATTR=1),i.data.aDashColor&&(e.HAS_DASHARRAY_COLOR=1)):e.HAS_DASHARRAY&&delete e.HAS_DASHARRAY}setLineUniforms(t,e){pe$2(e,"lineWidth",t,"lineWidth",2),pe$2(e,"lineOpacity",t,"lineOpacity",1),pe$2(e,"lineStrokeWidth",t,"lineStrokeWidth",0),pe$2(e,"lineBlur",t,"lineBlur",.7),pe$2(e,"lineOffset",t,"lineOffset",0),pe$2(e,"lineDx",t,"lineDx",0),pe$2(e,"lineDy",t,"lineDy",0),pe$2(e,"linePatternAnimSpeed",t,"linePatternAnimSpeed",0),pe$2(e,"linePatternGap",t,"linePatternGap",0)}setMeshDefines(t,e,i){e.data.aOpacity&&(t.HAS_OPACITY=1),e.data.aLineWidth&&(t.HAS_LINE_WIDTH=1),e.data.aLineStrokeWidth&&(t.HAS_STROKE_WIDTH=1),De$2(i.lineDx)&&(t.HAS_LINE_DX=1),De$2(i.lineDy)&&(t.HAS_LINE_DY=1),De$2(i.linePatternAnimSpeed)&&(t.HAS_PATTERN_ANIM=1),De$2(i.linePatternGap)&&(t.HAS_PATTERN_GAP=1)}paint(t){t.states&&t.states.includesChanged.shadow&&(this.shader.dispose(),this.createShader(t)),super.paint(t)}createFnTypeConfig(t,e){const i=piecewiseConstant(e.lineColor),n=piecewiseConstant(e.aLinePatternAnimSpeed),r=piecewiseConstant(e.aLinePatternGap),o=this.createShapeFnTypeConfigs(t,e),s=new Int8Array(2);return[{attrName:"aColor",symbolName:"lineColor",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||color(r).unitArray()),r=ye$2(r),r}},{attrName:"aLinePattern",symbolName:"linePatternAnimSpeed",type:Int8Array,width:2,related:["linePatternGap"],define:"HAS_LINE_PATTERN",evaluate:(e,i,r,o)=>{let a=n(t.getZoom(),e);return de$2(a)&&(a=0),0!==a&&(i.properties.hasPatternAnim=1),s[0]=a/127,s[1]=r[o+1],s[0]}},{attrName:"aLinePattern",symbolName:"linePatternGap",type:Int8Array,width:2,related:["linePatternAnimSpeed"],define:"HAS_LINE_PATTERN",evaluate:(e,i,n,o)=>{let a=r(t.getZoom(),e);return de$2(a)&&(a=0),s[1]=10*a,s[0]=n[o],s[0]}}].concat(o)}createShapeFnTypeConfigs(t,e){const i=interpolated(e.lineWidth),n=interpolated(e.lineOpacity),r=interpolated(e.lineStrokeWidth),o=interpolated(e.lineDx),s=interpolated(e.lineDy),a=new Uint16Array(1),l=new Int8Array(1);return[{attrName:"aLineWidth",symbolName:"lineWidth",type:Uint8Array,width:1,define:"HAS_LINE_WIDTH",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e)),a[0]=Math.round(2*r),a[0]}},{attrName:"aLineStrokeWidth",symbolName:"lineStrokeWidth",type:Uint8Array,width:1,define:"HAS_STROKE_WIDTH",evaluate:e=>{const i=r(t.getZoom(),e);return a[0]=Math.round(2*i),a[0]}},{attrName:"aLineDxDy",symbolName:"lineDx",type:Int8Array,width:2,define:"HAS_LINE_DX",evaluate:e=>{const i=o(t.getZoom(),e);return l[0]=i,l[0]}},{attrName:"aLineDxDy",symbolName:"lineDy",type:Int8Array,width:2,define:"HAS_LINE_DY",evaluate:e=>{const i=s(t.getZoom(),e);return l[0]=i,l[0]}},{attrName:"aOpacity",symbolName:"lineOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e)),a[0]=255*r,a[0]}}]}updateSceneConfig(t){t.trailAnimation&&this.createShader(this.kn)}init(t){this.renderer=new k$7(this.regl),this.createShader(t),this.pickingFBO&&(this.picking=[new nr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+Qe$2,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],extraCommandProps:this.getExtraCommandProps()},this.pickingFBO)])}createShader(t){this.kn=t;const e=[],n={};this.fillIncludes(n,e,t),this.sceneConfig.trailAnimation&&this.sceneConfig.trailAnimation.enable&&(n.HAS_TRAIL=1),e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}),this.shader=new rt$6({vert:Qe$2,frag:"#define SHADER_NAME LINE\n#define DEVICE_PIXEL_RATIO 1.0\nprecision highp float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\nuniform lowp float blendSrcIsOne;\nuniform lowp float lineBlur;\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform lowp vec4 lineColor;\n#endif\n#include <highlight_frag>\n#ifdef HAS_STROKE_COLOR\nvarying vec4 vStrokeColor;\n#else\nuniform lowp vec4 lineStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float lineOpacity;\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D linePatternFile;\nuniform vec2 atlasSize;\nuniform float flipY;\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#else\nuniform float linePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#else\nuniform float linePatternGap;\n#endif\nuniform vec4 linePatterGapColor;\nvarying vec4 vTexInfo;\nvec2 c(vec2 d) {\n  vec2 e = mod(d, 1.);\n  vec2 f = vTexInfo.xy;\n  vec2 h = vTexInfo.zw;\n  return (f + e * h) / atlasSize;\n}\n#endif\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\nuniform float tileExtent;\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvarying vec4 vDasharray;\n#else\nuniform vec4 lineDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvarying vec4 vDashColor;\n#else\nuniform vec4 lineDashColor;\n#endif\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nvarying highp float vLinesofar;\n#endif\n#ifdef HAS_TRAIL\nuniform float trailSpeed;\nuniform float trailLength;\nuniform float trailCircle;\n#endif\n#if defined(HAS_TRAIL) || defined(HAS_PATTERN)\nuniform float currentTime;\n#endif\nfloat i(float j, float k) {\n  float l = k / 2.;\n  float m = abs(j - l);\n  float n = (.1 + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  return clamp(min(m + n, l - m) / n, .0, 1.);\n}\nvarying vec3 vVertex;\nuniform vec3 cameraPosition;\nuniform float cameraToCenterDistance;\nvoid main() {\n  \n#ifndef ENABLE_TILE_STENCIL\nfloat o = sign(tileExtent - min(tileExtent, abs(vPosition.x))) * sign(1. + sign(vPosition.x)) * sign(tileExtent - min(tileExtent, abs(vPosition.y))) * sign(1. + sign(vPosition.y));\n  if(o == .0) {\n    discard;\n  }\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nfloat u = vLinesofar;\n#endif\nfloat v = length(vNormal) * vWidth.s;\n#ifdef HAS_PATTERN\nvec2 h = vTexInfo.zw;\n  float A = sign(h.x * h.y);\n  float B = mix(lineBlur, .0, A);\n#else\nfloat B = lineBlur;\n#endif\nfloat n = (B + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  float C = clamp(min(v - (vWidth.t - n), vWidth.s - v) / n, .0, 1.);\n#ifdef HAS_COLOR\nvec4 D = vColor / 255.;\n#else\nvec4 D = lineColor;\n#endif\n#ifdef HAS_PATTERN\nif(A == 1.) {\n    \n#ifdef HAS_PATTERN_GAP\nfloat E = vLinePatternGap;\n#else\nfloat E = linePatternGap;\n#endif\n#ifdef HAS_PATTERN_ANIM\nfloat F = vLinePatternAnimSpeed;\n#else\nfloat F = linePatternAnimSpeed;\n#endif\nfloat G = ceil(h.x * vWidth.s * 2. / h.y);\n    float H = G * (1. + E);\n    u += mod(currentTime * -F * .2, H);\n    float I = mod(u / H, 1.);\n    float J = mod((flipY * vNormal.y + 1.) / 2., 1.);\n    vec4 K = texture2D(linePatternFile, c(vec2(I * (1. + E), J)));\n    float L = clamp(sign(1. / (1. + E) - I) + .000001, .0, 1.);\n    K = mix(linePatterGapColor, K, L);\n    D *= K;\n  }\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvec4 M = vDasharray;\n#else\nvec4 M = lineDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvec4 N = vDashColor;\n#else\nvec4 N = lineDashColor;\n#endif\nfloat k = M[0] + M[1] + M[2] + M[3];\n  float j = mod(u, k);\n  float O = max(sign(M[0] - j), .0);\n  float P = j - M[0] - M[1];\n  float Q = max(sign(P), .0) * max(sign(M[2] - P), .0);\n  float R = O + Q;\n  float S = i(j, M[0]);\n  float T = i(P, M[2]);\n  float U = S * O + T * Q;\n  D = D * (1. - U) + N * U;\n#endif\n#ifdef HAS_STROKE_COLOR\nvec4 V = vStrokeColor / 255.;\n#else\nvec4 V = lineStrokeColor;\n#endif\nV = mix(D, V, sign(vWidth.t));\n  D = V * C + max(sign(vWidth.t - v), .0) * D * (1. - C);\n#ifdef HAS_TRAIL\nfloat W = mod(u - currentTime * trailSpeed * .1, trailCircle);\n  float X = W < trailLength ? mix(.0, 1., W / trailLength) : .0;\n  D *= X;\n#endif\n#ifdef HAS_OPACITY\nfloat Y = vOpacity;\n#else\nfloat Y = lineOpacity;\n#endif\ngl_FragColor = D * Y;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat Z = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, Z);\n#endif\nfloat ba = clamp(cameraToCenterDistance * 1.5 / distance(vVertex, cameraPosition), .0, 1.);\n  if(blendSrcIsOne == 1.) {\n    gl_FragColor *= gl_FragColor.a;\n  }\n  gl_FragColor *= ba;\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:e,defines:n,extraCommandProps:this.getExtraCommandProps()})}getExtraCommandProps(){const t=this.layer.getRenderer().isEnableTileStencil&&this.layer.getRenderer().isEnableTileStencil(),e=this.canvas;return{viewport:{x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1},stencil:{enable:!1,func:{cmp:()=>t?"=":"<=",ref:(e,i)=>t?i.stencilRef:i.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:this.sceneConfig.depthMask||!1,func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}getUniformValues(t,e){const i=t.projViewMatrix,n=t.viewMatrix,r=t.cameraToCenterDistance,o=t.getResolution(),a=this.sceneConfig.trailAnimation||{},l={layerScale:this.layer.options.styleScale||1,projViewMatrix:i,viewMatrix:n,cameraToCenterDistance:r,resolution:o,canvasSize:[t.width,t.height],trailSpeed:a.speed||1,trailLength:a.trailLength||500,trailCircle:a.trailCircle||1e3,currentTime:this.layer.getRenderer().getFrameTimestamp()||0,blendSrcIsOne:+!("one"!==this.sceneConfig.blendSrc),cameraPosition:t.cameraPosition};return this.setIncludeUniformValues(l,e),l}}class ei$1 extends ti$1{postCreateGeometry(t){const{symbolIndex:e,geometry:i}=t,{features:n}=i.properties,r=this.getSymbol(e).lineGradientProperty,o=i.data.aPickingId,s=new Uint8Array(o.length),a=[];let l=o[0];a.push(n[l].feature.properties[r]);for(let t=1;t<o.length;t++)o[t]!==l&&(l=o[t],a.push(n[l].feature.properties[r])),s[t]=a.length-1;i.data.aGradIndex=s,i.properties.gradients=a}createMesh(t,e){const{geometry:n,symbolIndex:r,ref:o}=t,s=this.getSymbolDef(r);void 0===o&&Te$2(n,s,this.getFnTypeConfig(r));const a={tileResolution:n.properties.tileResolution,tileRatio:n.properties.tileRatio,tileExtent:n.properties.tileExtent},l=this.getSymbol(r);this.setLineUniforms(l,a);const h=n.properties.gradients;let c=2*h.length;ni$1(c)||(c=ri$1(c));const u=this.regl.texture({width:256,height:c,data:ii$1(h),format:"rgba",mag:"linear",min:"linear",flipY:!1});a.lineGradientTexture=u,a.lineGradientTextureHeight=u.height,void 0===o&&n.generateBuffers(this.regl);const d=new ee$3(a),f=new de$4(n,d,{castShadow:!1,picking:!0});f.setLocalTransform(e);const p={HAS_GRADIENT:1};return this.setMeshDefines(p,n,s),f.setDefines(p),f.properties.symbolIndex=r,f}createFnTypeConfig(t,e){return this.createShapeFnTypeConfigs(t,e)}createShader(t){this.kn=t;const e=[],n={};this.fillIncludes(n,e,t),this.sceneConfig.trailAnimation&&this.sceneConfig.trailAnimation.enable&&(n.HAS_TRAIL=1),e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}),this.shader=new rt$6({vert:Qe$2,frag:"#define SHADER_NAME LINE_GRADIENT\n#define DEVICE_PIXEL_RATIO 1.0\n#define MAX_LINE_COUNT 128.0\nprecision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float lineOpacity;\n#endif\nuniform lowp float lineBlur;\nuniform float lineGradientTextureHeight;\nuniform float tileExtent;\nuniform sampler2D lineGradientTexture;\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\nvarying highp float vLinesofar;\nvarying float vGradIndex;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\n#ifdef HAS_TRAIL\nuniform float trailSpeed;\nuniform float trailLength;\nuniform float trailCircle;\nuniform float currentTime;\n#endif\n#include <highlight_frag>\nvoid main() {\n  \n#ifndef ENABLE_TILE_STENCIL\nfloat c = sign(tileExtent - min(tileExtent, abs(vPosition.x))) * sign(1. + sign(vPosition.x)) * sign(tileExtent - min(tileExtent, abs(vPosition.y))) * sign(1. + sign(vPosition.y));\n  if(c == .0) {\n    discard;\n  }\n#endif\nfloat d = length(vNormal) * vWidth.s;\n  float e = (lineBlur + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  float f = clamp(min(d - (vWidth.t - e), vWidth.s - d) / e, .0, 1.);\n  float h = vLinesofar;\n  vec4 i = texture2D(lineGradientTexture, vec2(h, (vGradIndex * 2. + .5) / lineGradientTextureHeight)) * f;\n  i *= max(sign(MAX_LINE_COUNT - vGradIndex), .0);\n#ifdef HAS_TRAIL\nfloat j = mod(h - currentTime * trailSpeed * .1, trailCircle);\n  float k = j < trailLength ? mix(.0, 1., j / trailLength) : .0;\n  i *= k;\n#endif\n#ifdef HAS_OPACITY\nfloat l = vOpacity;\n#else\nfloat l = lineOpacity;\n#endif\ngl_FragColor = i * l;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat m = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, m);\n#endif\ngl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:e,defines:n,extraCommandProps:this.getExtraCommandProps()})}}function ii$1(t){t.length>128&&(console.warn("Line count in a tile exceeds maximum limit (128) for line-gradient render plugin."),t=t.slice(0,128));const e=document.createElement("canvas"),i=e.getContext("2d");e.width=256,e.height=2*t.length,ni$1(e.height)||(e.height=ri$1(2*t.length));for(let e=0;e<t.length;e++){const n=t[e],r=i.createLinearGradient(0,0,256,0);for(let t=0;t<n.length;t+=2)r.addColorStop(+n[t],n[t+1]);i.fillStyle=r;const o=e%256;i.fillRect(0,2*o,256,2*o+2)}return i.canvas}function ni$1(t){return 0==(t&t-1)&&0!==t}function ri$1(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}class oi$1{constructor(t){this.F=t||[],this.properties={}}set meshes(t){this.F=t}get meshes(){return this.F}}const hi$1=new Uint8Array(1),ci$1=[],ui$1={collides:0,boxes:[]};class di$1 extends Xe$2{supportRenderMode(t){const e=this.sceneConfig.renderToPointRenderTarget;return e||void 0===e?"point"===t:"fxaa"===t||"fxaaAfterTaa"===t}startMeshCollision(t){const{meshKey:e}=t.properties,{renderer:i}=this._n,n=i.isForeground(t instanceof oi$1?t.meshes[0]:t);if(t.properties.isForeground=n,t instanceof oi$1&&t.meshes.length)for(let e=0;e<t.meshes.length;e++)t.meshes[e].properties.isForeground=n;this.Sn=performance.now(),this.Tn=this.Mn(),this.Pn=this.In(e)}endMeshCollision(t){const e=this.On.tags[t];if(this.Tn&&e&&this.Pn){const t=this.getMap();e.anchor0=t.containerPointToCoord(this.Cn),e.anchor1=t.containerPointToCoord(this.En),e.anchor0.z=t.getZoom(),e.anchor0.width=t.width,e.anchor0.height=t.height}this.getMap().collisionFrameTime+=performance.now()-this.Sn}In(t){const e=this.getMap(),i=e.getZoom(),[n,r]=this.Fn(t);return!n||!r||n.z!==i||n.width!==e.width||n.height!==e.height||n.distanceTo(this.Cn)>2||r.distanceTo(this.En)>2}zn(){const e=this.getMap();this.jn={},this.Cn=new t__namespace.Point(e.width/2,e.height/3),this.En=new t__namespace.Point(e.width/2,2*e.height/3),delete this.Tn,this.On||(this.On={tags:{}}),this._n={layer:this.layer,renderer:this.layer.getRenderer(),frameTimestamp:this.layer.getRenderer().getFrameTimestamp(),map:this.getMap(),zoom:e.getZoom(),collisionTags:this.On.tags,isEnableUniquePlacement:this.isEnableUniquePlacement()}}Dn(){this.Rn=!1!==this.sceneConfig.collision}Nn(t,e){const i=this.On;return i.tags[t]&&i.tags[t][e]}Ln(t,e,i){const n=this.On;n.tags[t]=n.tags[t]||[],n.tags[t][e]=i}Mn(){const t=this.getMap();if(!t.isInteracting())return!0;return t.collisionFrameTime<=this.layer.options.collisionFrameLimit}Fn(t){const e="__meshAnchorKey".trim(),i=this.On.tags[t];if(i&&i.anchor0){const{anchor0:t,anchor1:n}=i,r=t[e]=t[e]||t.x+","+t.y,o=n[e]=n[e]||n.x+","+n.y;let s=this.jn[r],a=this.jn[o];if(!s||!a){const e=this.getMap();s=this.jn[r]=e.coordToContainerPoint(t),a=this.jn[o]=e.coordToContainerPoint(n)}return s.z=t.z,ci$1[0]=s,ci$1[1]=a,s.width=t.width,s.height=t.height,ci$1}return ci$1[0]=ci$1[1]=null,ci$1}updateBoxCollisionFading(t,e,i,n,r){const{layer:o,renderer:s,zoom:a,collisionTags:l,isEnableUniquePlacement:h}=this._n,{meshKey:c,isForeground:u}=e.properties;if(h&&this.Hn(c,r))return!1;const d=i.length;let f=l[c]&&l[c][r];const p=f,m=this.Vn&&f;if((!m||0===f.collides)&&t){const t=m&&0===f.collides;if(this.Tn||t)if((this.Pn||f&&f.z!==a)&&(f=null),f){if(f.boxes&&f.boxes.length){const{boxes:t,isAllowOverlap:e}=f;let i=0;if(!e){let e=0;for(let n=0;n<t.length;n++)if(!i){const r=this.isCollides(t[n]);if(-1===r)e++;else if(1===r){i=1;break}}e===t.length&&(i=-1)}f.collides=i}}else{f=p||{collides:0,boxes:[]},f.boxes.length=0,f.z=a;let t=0;for(let e=0;e<d;e++){const{mesh:o,allElements:s,boxCount:a,start:l,end:h}=i[e],c=this.Un(o,s,a,l,h,n,r);c.isAllowOverlap&&(f.isAllowOverlap=1),0===t&&(t=c.collides),c.boxes&&f.boxes.push(...c.boxes)}f.collides=t,this.Ln(c,r,f)}}let y=t&&f&&0===f.collides,g=1,v=!1;if(this.sceneConfig.fading){const t=this.qn(e);if(this.Gn)t[r]=y?1:-1;else if(u&&delete e.Wn,g=this.Bn(u,y,t,r),u?(g>0&&(y=!0),v=this.isBoxFading(e,r),v&&this.setToRedraw()):y||(this.$n(t,r),g=0),y){const i=e.Wn;if(i&&1===g&&t[r]>0){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;de$2(e)&&(e=224),de$2(t)&&(t=100);const n=ce$2(1-(s.getFrameTimestamp()-i-t)/e,0,1);g*=n,n>0&&this.setToRedraw()}}}if(f&&o.options.debugCollision&&this.addCollisionDebugBox(f.boxes,f.collides?0:1),y||v){const{mesh:t,start:e}=i[0],n=this.getSymbol(t.properties.symbolIndex);!this.Xn(n,t,e)&&f&&f.boxes&&this.Yn(f.boxes,t)}if(y){const t=hi$1[0]=255*g;for(let e=0;e<d;e++){const{mesh:n,allElements:r,start:o,end:s,boxIndex:a}=i[e];this.setCollisionOpacity(n,r,t,o,s,a)}}return y&&g>0}isMeshIterable(){return!0}setCollisionOpacity(t,e,i,n,r){this.Jn(t,i,e[n],e[r-1])}Jn(t,e,i,n){const{aOpacity:r}=t.geometry.properties;if(!r)return;const o=i;if(r[o]!==e){const t=n;for(let i=o;i<=t;i++)r[i]=e;r.dirty=!0}}isBoxFading(t,e){const{frameTimestamp:i}=this._n;let n=this.sceneConfig.fadingDuration;return de$2(n)&&(n=224),i-Math.abs(this.qn(t)[e])<n}Un(t,e,i,n,r,o,s){const a=this.getSymbol(t.properties.symbolIndex),l=this.Xn(a,t,e[n]),h=this.Zn(a,t,e[n]);if(!1===this.sceneConfig.collision||l&&h)return ui$1;const c=this.isBoxCollides(t,e,i,n,r,o,s);return h&&(c.collides=0,c.isAllowOverlap=1),c}Xn(t,e,i){if(!1===this.sceneConfig.collision)return!0;const n=e.geometry.properties.aOverlap;if(!n)return 1==+t[this.propIgnorePlacement];const r=n[i];return r<2?1==+t[this.propIgnorePlacement]:r%8%2}Zn(t,e,i){if(!1===this.sceneConfig.collision)return!0;const n=e.geometry.properties.aOverlap;if(!n)return 1==+t[this.propAllowOverlap];const r=n[i];return r<2?1==+t[this.propAllowOverlap]:(r>>2)%2}Yn(t){if(Array.isArray(t[0]))for(let e=0;e<t.length;e++)this.insertCollisionBox(t[e]);else this.insertCollisionBox(t)}Bn(t,e,i,n){let{fadingDuration:r,fadeInDelay:o,fadeOutDelay:s}=this.sceneConfig;de$2(r)&&(r=224),de$2(o)&&(o=600),de$2(s)&&(s=100);const{frameTimestamp:a}=this._n;let l=i[n],h=e?1:0;if(!l)return e&&t&&(i[n]=a+o),0;if(a<Math.abs(l)&&(!e&&l>0||e&&l<0)){const t=a-r;i[n]=l=e?t:-t}return a-Math.abs(l)<r?h=l>0?(a-l)/r:1-(a+l)/r:e?(l<0&&(i[n]=l=a+o),h=(a-l)/r):(l>0&&(i[n]=l=-(a+s)),h=1-(a+l)/r),(h<0||h>1)&&(h=ce$2(h,0,1)),h}qn(t){this.Kn||(this.Kn={});const{meshKey:e}=t.properties;if(!this.Kn[e]){const{frameTimestamp:t}=this._n;this.Kn[e]={timestamp:t}}return this.Kn[e]}Qn(t){if(!this.tr)return void(this.tr=t);const e=this.scene.getMeshes();if(e&&e.length){for(let i=0;i<e.length;i++){const n=this.qn(e[i]);n.timestamp<this.tr?delete e[i]._fading_timestamps:n.timestamp=t}this.tr=t}}$n(t,e){if(!t)return;const{frameTimestamp:i}=this._n;let{fadingDuration:n}=this.sceneConfig;de$2(n)&&(n=224),t[e]=-(i-n-1)}deleteMesh(t,e){if(t){if(Array.isArray(t))for(let e=0;e<t.length;e++){const i=t[e].properties.meshKey;this.On&&delete this.On.tags[i],this.Kn&&delete this.Kn[i]}else{const e=t.properties.meshKey;this.On&&delete this.On.tags[e],this.Kn&&delete this.Kn[e]}super.deleteMesh(t,e)}}delete(t){this.er&&(this.er.geometry.dispose(),this.ir.dispose(),this.er.dispose(),delete this.er,delete this.ir,delete this.nr),delete this.On,super.delete(t)}isCollides(t){const e=this.layer;return e.getMap().isOffscreen(t)?-1:+e.getCollisionIndex().collides(t)}insertCollisionBox(t){this.layer.getCollisionIndex().insertBox(t)}addCollisionDebugBox(t,e){if(t&&t.length)if(Array.isArray(t[0]))for(let i=0;i<t.length;i++){this.rr(t[i],e)}else this.rr(t,e)}rr(t,e){if(!t)return;const i=this.or=this.or||{aPosition:[],aVisible:[],indices:[]};if(this.getMap().isOffscreen(t))return;const n=i.aPosition.length/2;i.aPosition.push(t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]),i.aVisible.push(e,e,e,e),i.indices.push(n,n+1,n+1,n+2,n+2,n+3,n+3,n)}sr(){return!1!==this.sceneConfig.collision||this.Rn}updateCollision(t){super.updateCollision(t),this.zn(),this.ar(),this.lr&&this.lr.length&&(this.hr(),this.lr&&(this.setToRedraw(),this.scene.addMesh(this.lr))),(this.getMap().isZooming()||this.lr&&this.lr.length)&&(this.cr(),this.ur(this.scene.getMeshes()))}paint(t){const e=super.paint(t);return this.dr(t),!1===this.Tn&&this.setToRedraw(),e}callShader(t,e){this.callCurrentTileShader(t,e),this.shouldIgnoreBackground()||this.callBackgroundTileShader(t,e)}shouldIgnoreBackground(){return!this.getMap().isZooming()&&!this.lr}ar(){const t=this.getMap(),e=t.isZooming();if(!e&&this.Vn){const t=this.layer.getRenderer();this.lr=this.scene.getMeshes().filter((e=>!t.isForeground(e)&&!e.properties.isLinePlacement))}else e&&!this.Vn&&(this.pr=t.getResolution());if(e)this.mr&&(clearTimeout(this.mr),delete this.Gn,delete this.mr),this.Gn=this.pr&&t.getResolution()>this.pr;else if(this.Vn&&!this.mr){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;de$2(t)&&(t=100),de$2(e)&&(e=224),this.mr=setTimeout((()=>{delete this.Gn,delete this.mr}),t+e+1)}this.Vn=e}dr(t){if(!this.or||!this.layer.options.debugCollision)return;this.nr||this.yr();const{aPosition:e,aVisible:n,indices:r}=this.or;if(!this.er){const t=new Z$7({aPosition:[],aVisible:[]},[],0,{positionSize:2,primitive:"lines"});this.er=new de$4(t),this.gr=new pe$4,this.gr.addMesh(this.er)}const o=this.er.geometry;o.updateData("aPosition",new Float32Array(e)),o.updateData("aVisible",new Uint8Array(n)),o.setElements(r),this.nr.render(this.ir,{size:[this.canvas.width,this.canvas.height]},this.gr,this.getRenderFBO(t)),delete this.or}yr(){this.nr=new k$7(this.regl);const e=this.canvas;this.ir=new rt$6({vert:"attribute vec2 aPosition;\nattribute float aVisible;\nuniform vec2 size;\nvarying vec4 vColor;\nvoid main() {\n  vec2 c = (aPosition / size - .5) * 2. * vec2(1., -1.);\n  gl_Position = vec4(c, .0, 1.);\n  vColor = mix(vec4(1., .0, .0, 1.5) * .5, vec4(.0, 1., .0, 1.) * .4, aVisible);\n}",frag:"precision mediump float;\nvarying vec4 vColor;\nvoid main() {\n  gl_FragColor = vec4(vColor.rgb, .5);\n}",uniforms:["size"],extraCommandProps:{viewport:{x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1},depth:{enable:!1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}})}hr(){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;de$2(t)&&(t=100),de$2(e)&&(e=224);const i=this.layer.getRenderer(),n=i.getCurrentTileZoom(),r=i.getFrameTimestamp(),o=[];for(let s=0;s<this.lr.length;s++){const a=this.lr[s],l=a.properties.tile;!a.Wn&&i.isBackTile(l.id)&&(a.Wn=r);a.properties.level=l.z-n>0?2*(l.z-n)-1:2*(n-l.z),i.isForeground(a)||a.Wn&&r-a.Wn>t+e?delete a.Wn:o.push(a)}delete this.lr,o.length&&(this.lr=o)}isEnableCollision(){return this.layer.options.collision&&!1!==this.sceneConfig.collision}isEnableUniquePlacement(){return this.isEnableCollision()&&this.sceneConfig.uniquePlacement}isMeshUniquePlaced(t){return this.isMeshIterable(t)}cr(){if(!this.isEnableUniquePlacement())return;const t=this.scene.getMeshes(),e=(t,e,i,n)=>{const{start:r,end:o}=e[0],s=t.geometry.properties,a=s.elements;let l=s.uniquePlacements;if(l||(l=s.uniquePlacements=[]),void 0===l[n]){const e=this.getUniqueEntryKey(t,a[r],n);l[n]=e?{key:e,index:n,start:a[r],end:a[o-1]}:null}};for(let i=0;i<t.length;i++){const n=t[i];this.isMeshUniquePlaced(n)&&this.forEachBox(n,e)}}ur(t){if(!this.isEnableUniquePlacement())return;const e=this.getMap().getZoom();let i=!this.vr||this.br!==e;if(!i)for(let e=0;e<t.length;e++)if(!this.vr[t[e].properties.meshKey]){i=!0;break}if(!i)return;this.br=e,this.xr={},this.vr={},t=t.sort(pi$1);const n=this.getMap().getGLScale(),r={};for(let e=0;e<t.length;e++){const i=t[e];if(!i.geometry)continue;const{meshKey:o}=i.properties;this.vr[o]=1;const{uniquePlacements:s}=i.geometry.properties;if(s)for(let t=0;t<s.length;t++){if(!s[t])continue;const{key:e,index:o}=s[t],a=this.qn(i),l=fi$1(e,n),h=r[l];if(h){const t=h.length,e=h[t-3].properties.meshKey,n=h[t-2],r=h[t-1];this.xr[e]=this.xr[e]||{},this.xr[e][r]=1,this.wr(a,o,n,r),h.push(i,a,o)}else r[l]=[i,a,o]}}for(const t in r){const e=r[t];if(e.length<=6)continue;const i=e.length,n=e[i-2][e[i-1]];if(e[1][e[2]]!==n)for(let t=0;t<i-6;t+=3)e[t+1][e[t+2]]=n}}wr(t,e,i,n){if(void 0!==i[n])if(void 0===t[e])t[e]=i[n];else{let r=t[e];Math.abs(i[n])>Math.abs(r)?t[e]=i[n]:i[n]=t[e]}else void 0!==t[e]&&(i[n]=t[e])}Hn(t,e){return this.xr&&this.xr[t]&&this.xr[t][e]}Ar(t,e){const{symbolIndex:i}=t.properties,n=i.type||0;let r=t.properties._collidesBoxes;r||(r=t.properties._collidesBoxes=[]);let o=r[i.index];o||(o=t.properties._collidesBoxes=[]),o[n]||(o[n]=[]),o=o[n];const s=e/6;if(!o[s]){const t=[];o[s]={boxes:t,collision:{boxes:t}}}return o[s]}kr(t){let e=this._r;if(e||(e=this._r=[]),!e[t]){e[t]=[];for(let i=0;i<t;i++)e[t][i]={}}return e[t]}Sr(t){return!t||!t.geometry||!(!t.geometry.properties.glyphAtlas||!t.material.get("isHalo")||t.geometry.data.aTextHaloRadius&&t.geometry.properties.hasHalo)&&(!(!t.geometry.data.aTextHaloRadius||t.geometry.properties.hasHalo)||!this.getSymbol(t.geometry.properties.symbolIndex).textHaloRadius)}}function fi$1(t,e){return Math.round(t[0]/e/10)*Math.round(t[1]/e/10)*(t[2]?Math.round(t[2]/10):1)+"-"+t[3]}function pi$1(t,e){const i=e.properties.level-t.properties.level;return 0===i?t.properties.meshKey-e.properties.meshKey:i}var mi$1="#include <gl2_vert>\n#define SHADER_NAME MARKER\n#define RAD 0.0174532925\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aShape;\nattribute vec2 aTexCoord;\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_MARKER_WIDTH\nattribute float aMarkerWidth;\n#else\nuniform float markerWidth;\n#endif\n#ifdef HAS_MARKER_HEIGHT\nattribute float aMarkerHeight;\n#else\nuniform float markerHeight;\n#endif\n#ifdef HAS_MARKER_DX\nattribute float aMarkerDx;\n#else\nuniform float markerDx;\n#endif\n#ifdef HAS_MARKER_DY\nattribute float aMarkerDy;\n#else\nuniform float markerDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nattribute float aRotationAlign;\n#else\nuniform float rotateWithMap;\n#endif\nuniform float flipY;\n#ifdef HAS_ROTATION\nattribute float aRotation;\n#else\nuniform float markerRotation;\n#endif\n#ifdef HAS_PAD_OFFSET\nattribute float aPadOffsetX;\nattribute float aPadOffsetY;\n#endif\nuniform float cameraToCenterDistance;\nuniform mat4 projViewModelMatrix;\nuniform float markerPerspectiveRatio;\nuniform vec2 iconSize;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float mapPitch;\nuniform float mapRotation;\nuniform float zoomScale;\nuniform float tileRatio;\nuniform float layerScale;\n#include <vt_position_vert>\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vOpacity;\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_MARKER_WIDTH\nfloat d = aMarkerWidth;\n#else\nfloat d = markerWidth;\n#endif\n#ifdef HAS_MARKER_HEIGHT\nfloat e = aMarkerHeight;\n#else\nfloat e = markerHeight;\n#endif\n#ifdef HAS_MARKER_DX\nfloat f = aMarkerDx;\n#else\nfloat f = markerDx;\n#endif\n#ifdef HAS_MARKER_DY\nfloat h = aMarkerDy;\n#else\nfloat h = markerDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nfloat i = aPitchAlign;\n#else\nfloat i = pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nfloat j = aRotationAlign;\n#else\nfloat j = rotateWithMap;\n#endif\ngl_Position = projViewModelMatrix * vec4(c, 1.);\n  float k = gl_Position.w;\n  float l = (1. - cameraToCenterDistance / k) * markerPerspectiveRatio;\n  float m = clamp(.5 + .5 * (1. - l), .0, 4.);\n#ifdef HAS_ROTATION\nfloat n = aRotation / 9362. - mapRotation * j;\n#else\nfloat n = markerRotation - mapRotation * j;\n#endif\nif(i == 1.) {\n    n += mapRotation;\n  }\n  float o = sin(n);\n  float u = cos(n);\n  mat2 v = mat2(u, -1. * o, o, u);\n  vec2 A = (aShape / 10.0);\n  if(i == 1. && flipY == .0) {\n    A *= vec2(1., -1.);\n  }\n#ifdef HAS_PAD_OFFSET\nA = (A / iconSize * vec2(d, e) + vec2(aPadOffsetX - 1., aPadOffsetY)) * layerScale;\n#else\nA = A / iconSize * vec2(d, e) * layerScale;\n#endif\nA = v * A;\n  if(i == .0) {\n    vec2 B = A * 2. / canvasSize;\n    gl_Position.xy += B * m * k;\n  } else {\n    float C = k / cameraToCenterDistance;\n    vec2 B = A;\n    gl_Position = projViewModelMatrix * vec4(c + vec3(B, .0) * tileRatio / zoomScale * C * m, 1.);\n  }\n  gl_Position.xy += vec2(f, -h) * 2. / canvasSize * k;\n#ifndef PICKING_MODE\nvTexCoord = aTexCoord / texSize;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool D = aOpacity == 255.;\n#else\nbool D = true;\n#endif\nfbo_picking_setData(gl_Position.w, D);\n#endif\n}";const yi$1=[];function gi$1(t,e,i,n,r){return set$3(yi$1,e[0],e[1],e[2],1),transformMat4$1(yi$1,yi$1,i),t[2]=yi$1[3],scale$3(yi$1,yi$1,1/yi$1[3]),t[0]=(yi$1[0]+1)*n/2,t[1]=(1-yi$1[1])*r/2,t}const vi$1=[],bi$1=[],xi$1=[],wi$1=[],Ai$1=[],ki$1=[];function _i$1(t,e,i,r,o,s,l,c,u,d,f,p,m,y){const{tileRatio:g,tileResolution:v}=u,b=g/(v/d.getResolution())*(f/d.cameraToCenterDistance)*p;scale(i,i,b),scale(r,r,b),scale(o,o,b),scale(s,s,b),set$4(vi$1,i[0],i[1],m?i[2]/y:0),set$4(bi$1,r[0],r[1],m?r[2]/y:0),set$4(xi$1,o[0],o[1],m?o[2]/y:0),set$4(wi$1,s[0],s[1],m?s[2]/y:0),add$4(vi$1,vi$1,e),add$4(bi$1,bi$1,e),add$4(xi$1,xi$1,e),add$4(wi$1,wi$1,e),gi$1(i,vi$1,l,d.width,d.height),gi$1(r,bi$1,l,d.width,d.height),gi$1(o,xi$1,l,d.width,d.height),gi$1(s,wi$1,l,d.width,d.height),set(Ai$1,Math.min(i[0],r[0],o[0],s[0]),Math.min(i[1],r[1],o[1],s[1])),set(ki$1,Math.max(i[0],r[0],o[0],s[0]),Math.max(i[1],r[1],o[1],s[1])),set$3(t,Ai$1[0]+c[0],Ai$1[1]+c[1],ki$1[0]+c[0],ki$1[1]+c[1])}function Si$1(t,e,i,n,r,o,s,l){1!==l&&(scale(i,i,l),scale(n,n,l),scale(r,r,l),scale(o,o,l)),set(Ai$1,Math.min(i[0],n[0],r[0],o[0]),Math.min(i[1],n[1],r[1],o[1])),set(ki$1,Math.max(i[0],n[0],r[0],o[0]),Math.max(i[1],n[1],r[1],o[1])),set$3(t,e[0]+Ai$1[0]+s[0],e[1]+Ai$1[1]-s[1],e[0]+ki$1[0]+s[0],e[1]+ki$1[1]-s[1])}function Ti$1(t,e,i,n,r){e-=i*n,1===r&&(e+=i);const o=Math.sin(e),s=Math.cos(e);return set$8(t,s,-o,o,s)}const Mi$1=[],Pi$1=[],Ii$1=[],Oi$1=[],Ci$1=[],Ei$1=[],Fi$1=[],zi$1=[],ji$1=[1,-1],Di$1=[1,1];function Ri$1(t,e,i,r,o){const s=e.material.uniforms,a=o.cameraToCenterDistance,l=e.geometry.properties,c=this.getSymbol(l.symbolIndex),u=e.geometry.desc.positionSize,d=l.aAnchor,f=set$4(Mi$1,d[i*u],d[i*u+1],2===u?0:d[i*u+2]);let p=gi$1(Pi$1,f,r,o.width,o.height);const m=p[2];let y=1;s.markerPerspectiveRatio&&(y=ce$2(.5+.5*(1-(1-a/m)*s.markerPerspectiveRatio),0,4));const{aShape:g,aMarkerDx:v,aMarkerDy:b,aMarkerWidth:x,aMarkerHeight:w,aPitchAlign:A,aRotationAlign:k,aRotation:_}=l,M=A?A[i]:s.pitchWithMap,P=k?k[i]:s.rotateWithMap,I=set(zi$1,(v?v[i]:c.markerDx)||0,-((b?b[i]:c.markerDy)||0));let O=set(Oi$1,g[2*i]/10,g[2*i+1]/10),C=set(Ci$1,g[2*i+2]/10,g[2*i+3]/10),E=set(Ei$1,g[2*i+4]/10,g[2*i+5]/10),F=set(Fi$1,g[2*i+6]/10,g[2*i+7]/10);0===s.flipY&&1===M&&(multiply(O,O,ji$1),multiply(C,C,ji$1),multiply(E,E,ji$1),multiply(F,F,ji$1));let z=x?x[i]:c.markerWidth;de$2(z)&&(z=15);let j=w?w[i]:c.markerHeight;de$2(j)&&(j=15);const D=set(Di$1,z/24,j/24);mul(O,O,D),mul(C,C,D),mul(E,E,D),mul(F,F,D);let R=_?_[i]/9362:-(c.markerRotation||0)*Math.PI/180;const N=o.getBearing()*Math.PI/180;if(N*P||R){const t=Ti$1(Ii$1,R,N,P,M);O=transformMat2(O,O,t),C=transformMat2(C,C,t),E=transformMat2(E,E,t),F=transformMat2(F,F,t)}return 1===M?_i$1(t,f,O,C,E,F,r,I,s,o,m,y):(multiply(O,O,ji$1),multiply(C,C,ji$1),multiply(E,E,ji$1),multiply(F,F,ji$1),Si$1(t,p,O,C,E,F,I,y)),t}const Ni$1=[],Li$1=[],Hi$1=[],Vi$1=[],Ui$1=[],qi$1=[],Gi$1=[1,-1];function Wi$1(t,e,i,r,o,s,a,l,c){const u=r.material.uniforms,d=c.cameraToCenterDistance,f=r.geometry.properties,p=this.getSymbol(f.symbolIndex),m="line"===p.textPlacement&&!we$2(p),y=i[2];let g=1;u.textPerspectiveRatio&&(g=ce$2(.5+.5*(1-(1-d/y)*u.textPerspectiveRatio),0,4));const{aTextDx:v,aTextDy:b,aPitchAlign:x,aRotationAlign:w,aRotation:A}=r.geometry.properties,S=x?x[a]:u.pitchWithMap,T=w?w[a]:u.rotateWithMap,M=set(qi$1,(v?v[a]:p.textDx)||0,-((b?b[a]:p.textDy)||0));if(m){const{aOffset:r,aShape:o}=f,s=r.length!==o.length;let d,p,m,v;if(s?(d=set$4(Li$1,r[3*a]/10,r[3*a+1]/10,r[3*a+2]/10),p=set$4(Hi$1,r[3*a+3]/10,r[3*a+4]/10,r[3*a+5]/10),m=set$4(Vi$1,r[3*a+6]/10,r[3*a+7]/10,r[3*a+8]/10),v=set$4(Ui$1,r[3*a+9]/10,r[3*a+10]/10,r[3*a+11]/10)):(d=set(Li$1,r[2*a]/10,r[2*a+1]/10),p=set(Hi$1,r[2*a+2]/10,r[2*a+3]/10),m=set(Vi$1,r[2*a+4]/10,r[2*a+5]/10),v=set(Ui$1,r[2*a+6]/10,r[2*a+7]/10)),1===S){const i=B$6(c.getResolution(),c);_i$1(t,e,d,p,m,v,l,M,u,c,y,g,s,i)}else multiply(d,d,Gi$1),multiply(p,p,Gi$1),multiply(m,m,Gi$1),multiply(v,v,Gi$1),Si$1(t,i,d,p,m,v,M,g)}else{const{aShape:n}=f;let r=set(Li$1,n[2*a]/10,n[2*a+1]/10),s=set(Hi$1,n[2*a+2]/10,n[2*a+3]/10),d=set(Vi$1,n[2*a+4]/10,n[2*a+5]/10),v=set(Ui$1,n[2*a+6]/10,n[2*a+7]/10);0===u.flipY&&1===S&&(multiply(r,r,Gi$1),multiply(s,s,Gi$1),multiply(d,d,Gi$1),multiply(v,v,Gi$1));let b=A?-A[a]/9362:-(p.textRotation||0)*Math.PI/180;const x=m?0:c.getBearing()*Math.PI/180;if(b||x){const t=Ti$1(Ni$1,b,x,T,S);r=transformMat2(r,r,t),s=transformMat2(s,s,t),d=transformMat2(d,d,t),v=transformMat2(v,v,t)}const w=o/24;scale(r,r,w),scale(s,s,w),scale(d,d,w),scale(v,v,w),1===S?_i$1(t,e,r,s,d,v,l,M,u,c,y,g):Si$1(t,i,r,s,d,v,M,g)}return t[0]-=(s=s||0)+1,t[1]-=s+1,t[2]+=s+1,t[3]+=s+1,t}function Bi$1(t,e,i){const r=e.geometry.desc.positionSize,{aAnchor:o,aAltitude:s}=e.geometry.properties,a=i*r;return s?set$4(t,o[a],o[a+1],s[i]):3===r?Zo.unpackPosition(t,o[a],o[a+1],o[a+2]):set$4(t,o[a],o[a+1],0)}const $i$1={textFill:[0,0,0,1],textOpacity:1,textPitchAlignment:0,textRotationAlignment:0,textHaloRadius:0,textHaloFill:[1,1,1,1],textHaloBlur:0,textHaloOpacity:1,textPerspectiveRatio:0,textSize:14,textDx:0,textDy:0,textRotation:0};function Xi$1(t,e,n,r,o,s,a,l,h){const c=[];if(e.isDisposed()||0===e.data.aPosition.length)return c;const u=e.properties.glyphAtlas;if(!u)return c;if(0===r.textSize||0===r.textOpacity)return c;if(Te$2(e,r,s),!e.properties.aAnchor){Yi$1.call(this,e,a||h,l);const{aTextSize:t,aTextDx:i,aTextDy:n,aPitchAlign:r,aRotationAlign:o,aRotation:s,aOverlap:c,aAltitude:u}=e.data;if(t){const i=(_e$2+"aTextSize").trim();e.properties.aTextSize=e.properties[i]||new t.constructor(t)}if(i){const t=(_e$2+"aTextDx").trim();e.properties.aTextDx=e.properties[t]||new i.constructor(i)}if(n){const t=(_e$2+"aTextDy").trim();e.properties.aTextDy=e.properties[t]||new n.constructor(n)}if(r){const t=(_e$2+"aPitchAlign").trim();e.properties.aPitchAlign=e.properties[t]||new r.constructor(r)}if(o){const t=(_e$2+"aRotationAlign").trim();e.properties.aRotationAlign=e.properties[t]||new o.constructor(o)}if(s){const t=(_e$2+"aRotation").trim();e.properties.aRotation=e.properties[t]||new s.constructor(s)}if(c){const t=(_e$2+"aOverlap").trim();e.properties.aOverlap=e.properties[t]||new c.constructor(c)}if(u){const t=(_e$2+"aAltitude").trim();e.properties.aAltitude=e.properties[t]||new u.constructor(u)}}const d=Je$2(t,u,!1),f={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio,texture:d,texSize:[u.width,u.height]};Ji$1(e,f,o);let p=!1;o.textOpacity<1&&(p=!0),e.properties.memorySize=e.getMemorySize(),e.generateBuffers(t,{excludeElementsInVAO:!0});const m=new ee$3(f,$i$1),y=new de$4(e,m,{disableVAO:!0,transparent:p,castShadow:!1,picking:!0});if(y.setLocalTransform(n),f.isHalo&&(y.properties.isHalo=!0),a&&y.setDefines({ENABLE_COLLISION:1}),c.push(y),f.isHalo){const t={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio,texture:d,texSize:[u.width,u.height],isHalo:0};Ji$1(e,t,o);const r=new ee$3(t,$i$1),s=new de$4(e,r,{disableVAO:!0,transparent:p,castShadow:!1,picking:!0});Object.defineProperty(s.properties,"textSize",{enumerable:!0,get:function(){return t.textSize}}),a&&s.setDefines({ENABLE_COLLISION:1}),s.setLocalTransform(n),c.push(s)}return c.forEach((t=>{const i=t.defines||{};e.data.aTextFill&&(i.HAS_TEXT_FILL=1),e.data.aTextSize&&(i.HAS_TEXT_SIZE=1),e.data.aColorOpacity&&(i.HAS_OPACITY=1),e.data.aTextHaloFill&&t.material.uniforms.isHalo&&(i.HAS_TEXT_HALO_FILL=1),e.data.aTextHaloRadius&&t.material.uniforms.isHalo&&(i.HAS_TEXT_HALO_RADIUS=1),e.data.aTextHaloOpacity&&t.material.uniforms.isHalo&&(i.HAS_TEXT_HALO_OPACITY=1),e.data.aTextDx&&(i.HAS_TEXT_DX=1),e.data.aTextDy&&(i.HAS_TEXT_DY=1),e.data.aPitchAlign&&(i.HAS_PITCH_ALIGN=1),e.data.aRotationAlign&&(i.HAS_ROTATION_ALIGN=1),e.data.aRotation&&(i.HAS_ROTATION=1),e.data.aAltitude&&(i.HAS_ALTITUDE=1),e.properties.aOffset&&e.properties.aShape&&e.properties.aOffset.length!==e.properties.aShape.length&&(i.HAS_OFFSET_Z=1),t.setDefines(i),t.properties.symbolIndex=e.properties.symbolIndex})),c}function Yi$1(t,e,i){const n=this.getSymbol(t.properties.symbolIndex),r="line"===n.textPlacement&&!we$2(n),{aPosition:o,aShape:s}=t.data,a=o.length/t.desc.positionSize;if(t.properties.aPickingId=t.data.aPickingId,t.properties.aCount=t.data.aCount,delete t.data.aCount,(e||r)&&(t.properties.aAnchor=o,t.properties.aShape=s),t.properties.visElemts||(t.properties.elements=t.elements,t.properties.visElemts=new t.elements.constructor(t.elements.length)),r){const{aVertical:e,aSegment:i,aGlyphOffset:n,aPitchRotation:r}=t.data,o=!!r;t.properties.aGlyphOffset=n,t.properties.aPitchRotation=r,t.properties.aSegment=i,t.properties.aVertical=e,delete t.data.aSegment,delete t.data.aVertical,delete t.data.aGlyphOffset,delete t.data.aPitchRotation;const a=s.length/2*(o?3:2);t.data.aOffset={usage:"dynamic",data:new Int16Array(a)},t.properties.aOffset=new Int16Array(a)}if(e){t.data.aOpacity={usage:"dynamic",data:new Uint8Array(a)},t.properties.aOpacity=new Uint8Array(a),i&&(t.properties.aOpacity.fill(255,0),t.data.aOpacity.data.fill(255,0));const{aTextHaloRadius:e}=t.data;if(e&&!t.properties.aTextHaloRadius){const i=(_e$2+"aTextHaloRadius").trim();t.properties.aTextHaloRadius=t.properties[i]||new e.constructor(e)}}}function Ji$1(t,e,i){void 0===e.isHalo&&(e.isHalo=1),pe$2(e,"textOpacity",i,"textOpacity",$i$1.textOpacity),pe$2(e,"textFill",i,"textFill",$i$1.textFill,ge$2()),pe$2(e,"textHaloFill",i,"textHaloFill",$i$1.textHaloFill,ge$2()),pe$2(e,"textHaloBlur",i,"textHaloBlur",$i$1.textHaloBlur),pe$2(e,"textHaloRadius",i,"textHaloRadius",$i$1.textHaloRadius),pe$2(e,"textHaloOpacity",i,"textHaloOpacity",$i$1.textHaloOpacity),pe$2(e,"textPerspectiveRatio",i,"textPerspectiveRatio",$i$1.textPerspectiveRatio,(t=>"line"===i.textPlacement?1:t)),pe$2(e,"rotateWithMap",i,"textRotationAlignment",$i$1.textRotationAlignment,(t=>+("map"===t))),pe$2(e,"pitchWithMap",i,"textPitchAlignment",$i$1.textPitchAlignment,(t=>+("map"===t))),pe$2(e,"textSize",i,"textSize",$i$1.textSize),pe$2(e,"textDx",i,"textDx",$i$1.textDx),pe$2(e,"textDy",i,"textDy",$i$1.textDy),pe$2(e,"textRotation",i,"textRotation",$i$1.textRotation,(t=>t*Math.PI/180))}function Zi$1(t,e){const i=t.getRenderer().canvas;return{uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>i?i.width:1,height:()=>i?i.height:1},stencil:{enable:!1,mask:255,func:{cmp:"<",ref:(t,e)=>2*e.level+(e.isHalo||0)+1,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},depth:{enable:!0,range:e.depthRange||[0,1],func:e.depthFunc||"always",mask:!1},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}}function Ki$1(t,e){const i=interpolated(e.textFill),n=interpolated(e.textSize),r=interpolated(e.textHaloFill),o=interpolated(e.textHaloRadius),s=interpolated(e.textHaloOpacity),a=interpolated(e.textDx),l=interpolated(e.textDy),h=interpolated(e.textOpacity),c=piecewiseConstant(e.textPitchAlignment),u=piecewiseConstant(e.textRotationAlignment),d=interpolated(e.textRotation),f=piecewiseConstant(e.textAllowOverlapFn),g=piecewiseConstant(e.textIgnorePlacement),v={},b=new Int16Array(1),x=new Uint16Array(1);return[{attrName:"aTextFill",symbolName:"textFill",define:"HAS_TEXT_FILL",type:Uint8Array,width:4,evaluate:(e,n)=>{let r=i(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e,!0)),Array.isArray(r)||(r=v[r]=v[r]||color(r).unitArray()),r=ye$2(r),r}},{attrName:"aTextSize",symbolName:"textSize",define:"HAS_TEXT_SIZE",type:Uint8Array,width:1,evaluate:(e,i)=>{let r=n(t.getZoom(),e)||$i$1.textSize;return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e)),b[0]=r,b[0]}},{attrName:"aTextHaloFill",symbolName:"textHaloFill",define:"HAS_TEXT_HALO_FILL",type:Uint8Array,width:4,evaluate:e=>{let i=r(t.getZoom(),e);return Array.isArray(i)||(i=v[i]=v[i]||color(i).array()),i=ye$2(i),i}},{attrName:"aTextHaloRadius",symbolName:"textHaloRadius",define:"HAS_TEXT_HALO_RADIUS",type:Uint8Array,width:1,evaluate:e=>{const i=o(t.getZoom(),e);return b[0]=i,b[0]}},{attrName:"aTextHaloOpacity",symbolName:"textHaloOpacity",define:"HAS_TEXT_HALO_OPACITY",type:Uint8Array,width:1,evaluate:e=>{const i=s(t.getZoom(),e);return b[0]=i,b[0]}},{attrName:"aTextDx",symbolName:"textDx",define:"HAS_TEXT_DX",type:Uint8Array,width:1,evaluate:e=>{const i=a(t.getZoom(),e);return b[0]=i,b[0]}},{attrName:"aTextDy",symbolName:"textDy",define:"HAS_TEXT_DY",type:Uint8Array,width:1,evaluate:e=>{const i=l(t.getZoom(),e);return b[0]=i,b[0]}},{attrName:"aColorOpacity",symbolName:"textOpacity",define:"HAS_OPACITY",type:Uint8Array,width:1,evaluate:(e,i)=>{let n=h(t.getZoom(),e);return isFunctionDefinition(n)&&(n=this.evaluateInFnTypeConfig(n,i,t,e)),b[0]=255*n,b[0]}},{attrName:"aPitchAlign",symbolName:"textPitchAlignment",type:Uint8Array,width:1,define:"HAS_PITCH_ALIGN",evaluate:e=>+("map"===c(t.getZoom(),e))},{attrName:"aRotationAlign",symbolName:"textRotationAlignment",type:Uint8Array,width:1,define:"HAS_ROTATION_ALIGN",evaluate:e=>+("map"===u(t.getZoom(),e))},{attrName:"aRotation",symbolName:"textRotation",type:Uint16Array,width:1,define:"HAS_ROTATION",evaluate:e=>{const i=ue$2(d(t.getZoom(),e),0,360)*Math.PI/180;return x[0]=9362*i,x[0]}},{attrName:"aOverlap",symbolName:"textAllowOverlap",type:Uint8Array,width:1,evaluate:i=>{let n=f(t.getZoom(),i)||0,r=(g?g(t.getZoom(),i):e.textIgnorePlacement)||0;return n=1<<3+4*n,r=(g?2:0)+r,n+r}},{attrName:"aOverlap",symbolName:"textIgnorePlacement",type:Uint8Array,width:1,evaluate:i=>{let n=(f?f(t.getZoom(),i):e.textAllowOverlap)||0,r=g(t.getZoom(),i)||0;return n=(f?8:0)+4*n,r=1<<1+r,n+r}}]}const Qi$1=[],tn$1=[],en$1=[],nn$1=[];function rn$1(t,e,i,n,r,o,s){t=1===t?1:0;const a=this.getMap(),l=e.geometry.properties,h=this.getSymbol(l.symbolIndex),c="line"===h.textPlacement&&!we$2(h),{aTextSize:u,aTextHaloRadius:d,aShape:f}=l;let p=u?u[i[r]]:e.properties.textSize;null==p&&(p=$i$1.textSize);const m=d?d[i[r]]:e.properties.textHaloRadius,y=Bi$1(en$1,e,i[r]),g=gi$1(nn$1,y,s,a.width,a.height),v=n,{boxes:b,collision:x}=this.Ar(e,r);let w=0;if(c||1===e.material.uniforms.rotateWithMap||h.textRotation){let n=0;for(let o=r;o<r+6*v;o+=6){const r=b[w]=b[w]||[];w++;const l=Wi$1.call(this,r,y,g,e,p,m,i[o],s,a);if(!t){const e=this.isCollides(l);1===e?t=1:-1===e&&n++}}n===v&&(t=-1)}else{let n=i[r],l=f[2*n+1];for(let h=r;h<o;h+=6){const r=f[2*i[h]+1];if(l!==r||h===o-6){const c=i[h===o-6?h:h-6],u=Wi$1.call(this,Qi$1,y,g,e,p,m,n,s,a),d=Wi$1.call(this,tn$1,y,g,e,p,m,c,s,a),f=b[w]=b[w]||[];w++,f[0]=Math.min(u[0],d[0]),f[1]=Math.min(u[1],d[1]),f[2]=Math.max(u[2],d[2]),f[3]=Math.max(u[3],d[3]),n=i[h],l=r,!t&&this.isCollides(f)&&(t=1)}}}return x.collides=t,x}function on$1(t,e){const i=function(t,e){const{aPickingId:i,features:n}=t.geometry.properties,r=i[e];return(n&&n[r]&&n[r].feature).label}(t,e);return i?function(t,e,i){if(!i)return null;const n=t.localTransform,r=Bi$1(sn$1,t,e);set$3(an$1,r[0],r[1],r[2],1);const o=transformMat4$1(an$1,an$1,n);let s=0;for(let t=0;t<i.length;t++)s+=i.charCodeAt(t);return[Math.floor(o[0]),Math.floor(o[1]),Math.floor(o[2]),s]}(t,e,i):null}const sn$1=[],an$1=[];var ln$1="#define SHADER_NAME TEXT\n#define RAD 0.0174532925\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aShape;\nattribute vec2 aTexCoord;\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_TEXT_SIZE\nattribute float aTextSize;\n#else\nuniform float textSize;\n#endif\n#ifdef HAS_TEXT_DX\nattribute float aTextDx;\n#else\nuniform float textDx;\n#endif\n#ifdef HAS_TEXT_DY\nattribute float aTextDy;\n#else\nuniform float textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nattribute float aRotationAlign;\n#else\nuniform float rotateWithMap;\n#endif\nuniform float flipY;\n#if defined(HAS_ROTATION)\nattribute float aRotation;\n#else\nuniform float textRotation;\n#endif\nuniform float cameraToCenterDistance;\nuniform mat4 projViewModelMatrix;\nuniform float textPerspectiveRatio;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float glyphSize;\nuniform float mapPitch;\nuniform float mapRotation;\nuniform float zoomScale;\nuniform float tileRatio;\nuniform float layerScale;\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vGammaScale;\nvarying float vSize;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nattribute vec4 aTextFill;\nvarying vec4 vTextFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nattribute vec4 aTextHaloFill;\nvarying vec4 vTextHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nattribute float aTextHaloRadius;\nvarying float vTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nattribute float aTextHaloOpacity;\nvarying float vTextHaloOpacity;\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_TEXT_SIZE\nfloat d = aTextSize * layerScale;\n#else\nfloat d = textSize * layerScale;\n#endif\n#ifdef HAS_TEXT_DX\nfloat e = aTextDx;\n#else\nfloat e = textDx;\n#endif\n#ifdef HAS_TEXT_DY\nfloat f = aTextDy;\n#else\nfloat f = textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nfloat h = aPitchAlign;\n#else\nfloat h = pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nfloat i = aRotationAlign;\n#else\nfloat i = rotateWithMap;\n#endif\nvec2 j = aShape / 10.0;\n  if(h == 1. && flipY == .0) {\n    j = j * vec2(1., -1.);\n  }\n  vec2 k = aTexCoord;\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n  float l = gl_Position.w;\n  float m = (1. - cameraToCenterDistance / l) * textPerspectiveRatio;\n  float n = clamp(.5 + .5 * (1. - m), .0, 4.);\n#ifdef HAS_ROTATION\nfloat o = aRotation / 9362. - mapRotation * i;\n#else\nfloat o = textRotation - mapRotation * i;\n#endif\nif(h == 1.) {\n    \n#ifdef REVERSE_MAP_ROTATION_ON_PITCH\no += mapRotation;\n#else\no -= mapRotation;\n#endif\n  }\n  float u = sin(o);\n  float v = cos(o);\n  mat2 A = mat2(v, -1. * u, u, v);\n  j = A * (j / glyphSize * d);\n  float B = l / cameraToCenterDistance;\n  if(h == .0) {\n    vec2 C = j * 2. / canvasSize;\n    gl_Position.xy += C * n * l;\n  } else {\n    vec2 C = j;\n    gl_Position = projViewModelMatrix * vec4(c + vec3(C, .0) * tileRatio / zoomScale * B * n, 1.);\n  }\n  gl_Position.xy += vec2(e, -f) * 2. / canvasSize * l;\n#ifndef PICKING_MODE\nif(h == .0) {\n    vGammaScale = mix(1., B, textPerspectiveRatio);\n  } else {\n    vGammaScale = B + mapPitch / 4.;\n  }\n  vTexCoord = k / texSize;\n  vGammaScale = clamp(vGammaScale, .0, 1.);\n  vSize = d;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\n#ifdef HAS_TEXT_FILL\nvTextFill = aTextFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvTextHaloFill = aTextHaloFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvTextHaloRadius = aTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nvTextHaloOpacity = aTextHaloOpacity;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool D = aOpacity == 255.;\n#else\nbool D = true;\n#endif\nfbo_picking_setData(gl_Position.w, D);\n#endif\n}",hn$1="#define SHADER_NAME TEXT\n#define SDF_PX 8.0\n#define DEVICE_PIXEL_RATIO 1.0\n#define EDGE_GAMMA 0.105 / DEVICE_PIXEL_RATIO\nprecision mediump float;\nuniform sampler2D texture;\nuniform float textOpacity;\nuniform highp float gammaScale;\nuniform int isHalo;\nuniform highp float textHaloBlur;\n#ifdef HAS_TEXT_HALO_OPACITY\nvarying float vTextHaloOpacity;\n#else\nuniform float textHaloOpacity;\n#endif\nvarying vec2 vTexCoord;\nvarying float vSize;\nvarying float vGammaScale;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nvarying vec4 vTextFill;\n#else\nuniform vec4 textFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvarying vec4 vTextHaloFill;\n#else\nuniform vec4 textHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvarying float vTextHaloRadius;\n#else\nuniform highp float textHaloRadius;\n#endif\n#include <highlight_frag>\nvoid main() {\n  \n#ifdef HAS_TEXT_FILL\nvec4 c = vTextFill;\n#else\nvec4 c = textFill;\n#endif\nfloat d = vSize / 24.;\n  lowp vec4 e = c;\n  highp float f = EDGE_GAMMA / (d * gammaScale);\n  lowp float h = 185. / 256.;\n  if(isHalo == 1) {\n    \n#ifdef HAS_TEXT_HALO_FILL\nvec4 i = vTextHaloFill;\n#else\nvec4 i = textHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nfloat j = vTextHaloRadius;\n#else\nfloat j = textHaloRadius;\n#endif\ne = i;\n    f = (textHaloBlur * 1.19 / SDF_PX + EDGE_GAMMA) / (d * gammaScale);\n    h = (6. - j / d) / SDF_PX;\n#ifdef HAS_TEXT_HALO_OPACITY\nfloat k = vTextHaloOpacity / 255.;\n#else\nfloat k = textHaloOpacity;\n#endif\ne *= k * 1.25;\n  }\n  float l = texture2D(texture, vTexCoord).a;\n  highp float m = f * vGammaScale * .7;\n  float n = clamp(smoothstep(h - m, h + m, l), .0, 1.);\n  gl_FragColor = e * (n * textOpacity * vOpacity);\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}";const cn$1=new Uint16Array(1),un$1=new Int8Array(1);function fn$1(t,e){const i=interpolated(e.markerWidth),n=interpolated(e.markerHeight),r=interpolated(e.markerDx),o=interpolated(e.markerDy),s=interpolated(e.markerOpacity),a=interpolated(e.markerTextFit),l=piecewiseConstant(e.markerPitchAlignment),h=piecewiseConstant(e.markerRotationAlignment),c=interpolated(e.markerRotation),u=piecewiseConstant(e.markerAllowOverlapFn),d=piecewiseConstant(e.markerIgnorePlacement),f=new Int16Array(1),g=new Uint16Array(1);return[{attrName:"aMarkerWidth",symbolName:"markerWidth",type:Uint8Array,width:1,define:"HAS_MARKER_WIDTH",evaluate:(n,r,o,s)=>{const l=o[s],h=e.markerTextFit,c=a?a(t.getZoom(),n):h;if("both"===c||"width"===c)return l;let u=i(t.getZoom(),n);return isFunctionDefinition(u)&&(u=this.evaluateInFnTypeConfig(u,r,t,n)),f[0]=u,f[0]}},{attrName:"aMarkerHeight",symbolName:"markerHeight",type:Uint8Array,width:1,define:"HAS_MARKER_HEIGHT",evaluate:(i,r,o,s)=>{const l=o[s],h=e.markerTextFit,c=a?a(t.getZoom(),i):h;if("both"===c||"height"===c)return l;let u=n(t.getZoom(),i);return isFunctionDefinition(u)&&(u=this.evaluateInFnTypeConfig(u,r,t,i)),f[0]=u,f[0]}},{attrName:"aMarkerDx",symbolName:"markerDx",type:Uint8Array,width:1,define:"HAS_MARKER_DX",evaluate:(e,i)=>{let n=r(t.getZoom(),e);return isFunctionDefinition(n)&&(n=this.evaluateInFnTypeConfig(n,i,t,e)),f[0]=n,f[0]}},{attrName:"aMarkerDy",symbolName:"markerDy",type:Uint8Array,width:1,define:"HAS_MARKER_DY",evaluate:(e,i)=>{let n=o(t.getZoom(),e);return isFunctionDefinition(n)&&(n=this.evaluateInFnTypeConfig(n,i,t,e)),f[0]=n,f[0]}},{attrName:"aColorOpacity",symbolName:"markerOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,i)=>{let n=s(t.getZoom(),e);return isFunctionDefinition(n)&&(n=this.evaluateInFnTypeConfig(n,i,t,e)),f[0]=255*n,f[0]}},{attrName:"aPitchAlign",symbolName:"markerPitchAlignment",type:Uint8Array,width:1,define:"HAS_PITCH_ALIGN",evaluate:e=>+("map"===l(t.getZoom(),e))},{attrName:"aRotationAlign",symbolName:"markerRotationAlignment",type:Uint8Array,width:1,define:"HAS_ROTATION_ALIGN",evaluate:e=>+("map"===h(t.getZoom(),e))},{attrName:"aRotation",symbolName:"markerRotation",type:Uint16Array,width:1,define:"HAS_ROTATION",evaluate:e=>{const i=ue$2(c(t.getZoom(),e),0,360)*Math.PI/180;return g[0]=9362*i,g[0]}},{attrName:"aOverlap",symbolName:"markerAllowOverlap",type:Uint8Array,width:1,evaluate:i=>{let n=u(t.getZoom(),i)||0,r=(d?d(t.getZoom(),i):e.markerIgnorePlacement)||0;return n=1<<3+4*n,r=(d?2:0)+r,n+r}},{attrName:"aOverlap",symbolName:"markerIgnorePlacement",type:Uint8Array,width:1,evaluate:i=>{let n=(u?u(t.getZoom(),i):e.markerAllowOverlap)||0,r=d(t.getZoom(),i)||0;return n=(u?8:0)+4*n,r=2+r,n+r}}]}function pn$1(t,e,i,n){if(!i||!n||"none"===n)return;const r=function(t,e,i){let n=t.properties.textFitFn;isFunctionDefinition(i)&&(n=t.properties.textFitFn=piecewiseConstant(i));const r="none"!==i,o=[],s=t.getElements(),a=t.data.aPickingId;let l,h,c;e&&(l=e.getElements(),h=e.data.aPickingId,c=e.data.aCount);const u=t.properties.features;let d;if(e){let t=l[0];d={pickingId:h[t],start:0,end:6*c[t]}}let f=!1,m=!1,g=0;const v=[];for(let t=0;t<s.length;t+=6){const p=a[s[t]];if(!f&&d)for(;d.pickingId<p&&d.end<l.length;){const t=d.end,e=l[t];d.start=t,d.end=t+6*c[e],d.pickingId=h[e]}if(!f&&d&&d.pickingId<p&&(f=!0,!r)){if(!m)return[];for(let e=t;e<s.length;e+=6)o[g++]=[-1,-1];return o}const y=u[p]&&u[p].feature,b=y&&y.properties||{};b.$layer=y&&y.layer,b.$type=y&&y.type;const x=n?n(null,b):i;if(delete b.$layer,delete b.$type,d&&p===d.pickingId){o[g++]=[d.start,d.end];const t=d.end,e=l[t];d.start=t,d.end=t+6*c[e],d.pickingId=h[e],m=!0}else if(x&&"none"!==x)for(let e=t;e<t+6;e++)v.push(e);else o[g++]=[-1,-1]}if(v.length)if(v.length===s.length)t.setElements([]);else{const e=[];let i=0,n=v[i];for(let t=0;t<s.length;t++)t<n?e.push(s[t]):t===n&&(i++,n=v[i]);t.setElements(new s.constructor(e))}return m?o:[]}(e,i,n);if(e.getElements().length&&r.length&&(e.properties.labelIndex=r,r.length&&n&&"none"!==n&&i)){const n=function(t,e){const i=[],n=t.properties.labelIndex,{aShape:r}=e.data;let o=!1;for(let t=0;t<n.length;t++){const[s,a]=n[t];if(-1===s)i.push(0,0,0,0);else{o=!0;let t=1/0,n=1/0,l=-1/0,h=-1/0;const c=e.elements;for(let e=s;e<a;e++){const i=c[e],o=r[2*i],s=r[2*i+1];o<t&&(t=o),o>l&&(l=o),s<n&&(n=s),s>h&&(h=s)}i.push(t,n,l,h)}}return o?i:[]}(e,i);n.length&&(e.properties.labelShape=n,mn$1.call(this,t,e,i))}}function mn$1(t,e){const i=this.getSymbolDef(e.properties.symbolIndex),n=i.markerTextFit,r=e.properties;let o="both"===n||"width"===n,s="both"===n||"height"===n;if(isFunctionDefinition(i.markerTextFit)){let t=e.properties.textFitFn;t||(t=e.properties.textFitFn=interpolated(i.markerTextFit));const{features:n}=e.properties,a=e.properties.elements||e.elements,{aPickingId:l}=e.data,h=[],c=[];let u=!0;for(let e=0;e<a.length;e+=6){const i=n[l[a[e]]],r=i&&i.feature||{},o=r.properties||{};o.$layer=r.layer,o.$type=r.type;let s=t(null,o);isFunctionDefinition(s)&&(s=(o.textFitFn=o.textFitFn||interpolated(s))(null,o)),delete o.$layer,delete o.$type,"both"===s?(h.push(e/6),c.push(e/6)):"width"===s?(u=!1,h.push(e/6)):"height"===s&&(u=!1,c.push(e/6))}u?(r.fitIcons=h,o=!0,s=!0):(h.length&&(r.fitWidthIcons=h,o=!0),c.length&&(r.fitHeightIcons=c,s=!0))}r.aPickingId||(r.aPickingId=new e.data.aPickingId.constructor(e.data.aPickingId));const{aMarkerWidth:a,aMarkerHeight:l,aPickingId:h}=r,c=h.length;if(o)if(a){const t=e.data.aMarkerWidth;e.data.aMarkerWidth=new Uint16Array(t),r.aMarkerWidth=new Uint16Array(t);const i=(_e$2+"aMarkerWidth").trim();r[i]&&(r[i]=r.aMarkerWidth)}else{const t=this.getSymbol(e.properties.symbolIndex).markerWidth||0;r.aMarkerWidth=new Uint16Array(c),r.aMarkerWidth.fill(t),t&&(r.aMarkerWidth.dirty=!0),e.data.aMarkerWidth=new Uint16Array(c)}if(s)if(l){const t=e.data.aMarkerHeight;e.data.aMarkerHeight=new Uint16Array(t),r.aMarkerHeight=new Uint16Array(t);const i=(_e$2+"aMarkerHeight").trim();r[i]&&(r[i]=r.aMarkerHeight)}else{const t=this.getSymbol(e.properties.symbolIndex).markerHeight||0;r.aMarkerHeight=new Uint16Array(c),r.aMarkerHeight.fill(t),t&&(r.aMarkerHeight.dirty=!0),e.data.aMarkerHeight=new Uint16Array(c)}const u=this.getSymbolDef(e.properties.textGeo.properties.symbolIndex),d=interpolated(u.textSize);yn$1.call(this,t,e),(!isFunctionDefinition(u.textSize)||d.isZoomConstant&&d.isFeatureConstant)&&(r.isFitConstant=!0)}function yn$1(t,e){const i=e.properties.textGeo;if(!i)return;const n=i.properties,r=e.properties;if(r.isFitConstant||!r.labelShape||!r.labelShape.length)return;const o=this.getSymbolDef(e.properties.symbolIndex),s=this.getSymbolDef(i.properties.symbolIndex).textSize;let a;isFunctionDefinition(s)&&(a=n.Tr?n.Tr:n.Tr=interpolated(s));const l=o.markerTextFitPadding||[0,0,0,0];let h;isFunctionDefinition(l)&&(h=r.Mr?r.Mr:r.Mr=piecewiseConstant(l));const c=t.getZoom(),{fitIcons:u,fitWidthIcons:d,fitHeightIcons:f}=r,{aMarkerWidth:g,aMarkerHeight:v,labelShape:b}=r,x=r.elements||e.elements,{features:w,aPickingId:A}=r,k=(t,e,i,n)=>{const o=b[4*e],u=b[4*e+1],d=b[4*e+2],f=b[4*e+3];if(!(o||u||d||f))return;const x=A[t],k=w[x]&&w[x].feature,_=k&&k.properties||{};_.$layer=k&&k.layer,_.$type=k&&k.type;let S=a?a(c,_):s;isFunctionDefinition(S)&&(S=(_.textSizeFn=_.textSizeFn||interpolated(S))(c,_)),S/=24;let T,M,P=h?h(c,_):l;if(isFunctionDefinition(P)&&(P=(_.fitPaddingFn=_.fitPaddingFn||piecewiseConstant(P))(c,_)),P[0]===P[2]&&P[1]===P[3]||(T=r.aPadOffsetX,M=r.aPadOffsetY,T||(T=r.aPadOffsetX=new Int8Array(g.length),M=r.aPadOffsetY=new Int8Array(g.length))),delete _.$layer,delete _.$type,g&&i){const e=Math.abs((d-o)/10*S)+(P[1]+P[3]||0);if(cn$1[0]=e,g[t]!==cn$1[0]&&(be$2(g,cn$1[0],t,t+4),g.dirty=!0),T){const e=(P[1]+P[3])/2-P[3];un$1[0]=e,T[t]!==un$1[0]&&(be$2(T,e,t,t+4),T.dirty=!0)}}if(v&&n){const e=Math.abs((f-u)/10*S)+(P[0]+P[2]||0);if(cn$1[0]=e,v[t]!==cn$1[0]&&(be$2(v,cn$1[0],t,t+4),v.dirty=!0),M){const e=P[0]-(P[0]+P[2])/2;un$1[0]=e,M[t]!==un$1[0]&&(be$2(M,e,t,t+4),M.dirty=!0)}}};if(u||d||f){if(u)for(let t=0;t<u.length;t++){const e=u[t];k(x[6*e],e,!0,!0)}else if(d||f){if(d)for(let t=0;t<d.length;t++){const e=d[t];k(x[6*e],e,!0,!1)}if(f)for(let t=0;t<f.length;t++){const e=f[t];k(x[6*e],e,!1,!0)}}}else for(let t=0;t<x.length;t+=6){k(x[t],t/6,!0,!0)}const{aPadOffsetX:_,aPadOffsetY:S}=r;_&&(e.data.aPadOffsetX=_,e.data.aPadOffsetY=S)}const gn$1=function(t){const e=this.layer.getRenderer();return!this.Sr(t)&&e.isForeground(t)&&!!t.geometry.properties.iconAtlas&&!t.geometry.properties.isEmpty},vn$1=function(t){const e=this.layer.getRenderer();return!(this.Sr(t)||e.isForeground(t)||!t.geometry.properties.iconAtlas||t.geometry.properties.isEmpty)},bn$1=function(t){const e=this.layer.getRenderer();return!this.Sr(t)&&e.isForeground(t)&&!!t.geometry.properties.glyphAtlas},xn$1=function(t){const e=this.layer.getRenderer();return!this.Sr(t)&&!e.isForeground(t)&&!!t.geometry.properties.glyphAtlas},wn$1=[],An$1={colliides:-1};class kn$1 extends di$1{constructor(t,e,i,n,r){super(t,e,i,n,r),this.propAllowOverlap="markerAllowOverlap",this.propIgnorePlacement="markerIgnorePlacement",this.in={},this.isLabelCollides=rn$1.bind(this),this.Pr=gn$1.bind(this),this.Ir=vn$1.bind(this),this.Or=bn$1.bind(this),this.Cr=xn$1.bind(this),this.Er=[]}setTextShaderDefines(t){this.Fr=t}createFnTypeConfig(t,e){return{icon:fn$1.call(this,t,e),text:Ki$1.call(this,t,e)}}startFrame(...t){return this.Er.length=0,super.startFrame(...t)}createGeometry(t,e){return t&&t.empty&&(t.data={aPosition:new Uint8Array(t.data.aPosition),aPickingId:t.data.aPickingId}),super.createGeometry(t,e)}postCreateGeometry(t,e){const{geometry:i,symbolIndex:n}=t,r=this.getSymbolDef(n),o=this.getFnTypeConfig(n);if(this.zr(i))i.properties.iconAtlas?this.drawDebugAtlas(i.properties.iconAtlas):i.properties.isEmpty=!0,function(t,e,i){Te$2(t,e,i),function(t){const{aMarkerWidth:e,aMarkerHeight:i,aMarkerDx:n,aMarkerDy:r,aPitchAlign:o,aRotationAlign:s,aRotation:a,aOverlap:l}=t.data;if(e){const i=(_e$2+"aMarkerWidth").trim();t.properties.aMarkerWidth=t.properties[i]||new e.constructor(e)}if(i){const e=(_e$2+"aMarkerHeight").trim();t.properties.aMarkerHeight=t.properties[e]||new i.constructor(i)}if(n){const e=(_e$2+"aMarkerDx").trim();t.properties.aMarkerDx=t.properties[e]||new n.constructor(n)}if(r){const e=(_e$2+"aMarkerDy").trim();t.properties.aMarkerDy=t.properties[e]||new r.constructor(r)}if(o){const e=(_e$2+"aPitchAlign").trim();t.properties.aPitchAlign=t.properties[e]||new o.constructor(o)}if(s){const e=(_e$2+"aRotationAlign").trim();t.properties.aRotationAlign=t.properties[e]||new s.constructor(s)}if(a){const e=(_e$2+"aRotation").trim();t.properties.aRotation=t.properties[e]||new a.constructor(a)}if(l){const e=(_e$2+"aOverlap").trim();t.properties.aOverlap=t.properties[e]||new l.constructor(l)}}(t)}(i,r,o.icon);else if(this.jr(i)&&we$2(r)){const t=e[e.length-1];if(t){const{geometry:e,symbolIndex:o}=t;if(e&&o.index===n.index){const t=this.getMap(),n=r.markerTextFit;e.properties.textGeo=i,pn$1.call(this,t,e,i,n)}}}}Dr(t){if(!this.layer.options.collision)return;const{collideIds:e,elements:i,aCount:n}=t.properties,r=e,o={};if(!i)return void(t.properties.collideBoxIndex=o);let s=0,a=i[0],l=0,h=r[a],c=1;n&&(c=n[i[l]]);for(let t=0;t<=i.length;t+=6)a=i[t],r[a]===h&&t!==i.length||(o[h]=[l,t,(t-l)/(6*c),s++],h=r[a],l=t,n&&(c=n[i[l]]));t.properties.collideBoxIndex=o}createMesh(t,e,n,r){const o=this.isEnableCollision(),s=this.layer,{geometry:a,symbolIndex:l}=t;a.properties.symbolIndex=l;const h=this.getSymbolDef(l),c=this.getSymbol(l),u=this.getFnTypeConfig(l),d=[];if(this.zr(a)){const t=function(t,e,n,r,o,s,a,l,h){if(e.isDisposed()||0===e.data.aPosition.length)return null;const c=e.properties.iconAtlas;if(!c&&!e.properties.isEmpty)return null;const u={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio};
//!geometry.properties.aAnchor collision
if((a||h)&&!e.properties.aAnchor){const{aPosition:t,aShape:i}=e.data,n=e.data.aPosition.length/e.desc.positionSize,r=new Uint8Array(n);l&&r.fill(255,0),e.data.aOpacity={usage:"dynamic",data:r},e.properties.aOpacity=new Uint8Array(n),l&&e.properties.aOpacity.fill(255,0),e.properties.aAnchor=t,e.properties.aShape=i}e.properties.visElemts||(e.properties.elements=e.elements,e.properties.visElemts=new e.elements.constructor(e.elements.length)),pe$2(u,"markerOpacity",o,"markerOpacity",1),pe$2(u,"markerPerspectiveRatio",o,"markerPerspectiveRatio",o.markerTextFit?0:1),pe$2(u,"markerWidth",o,"markerWidth",15),pe$2(u,"markerHeight",o,"markerHeight",15),pe$2(u,"markerDx",o,"markerDx",0),pe$2(u,"markerDy",o,"markerDy",0),pe$2(u,"markerRotation",o,"markerRotation",0,(t=>t*Math.PI/180)),pe$2(u,"pitchWithMap",o,"markerPitchAlignment",0,(t=>"map"===t?1:0)),pe$2(u,"rotateWithMap",o,"markerRotationAlignment",0,(t=>"map"===t?1:0)),u.iconTex=c?Je$2(t,c,!1):null,u.texSize=c?[c.width,c.height]:[0,0],e.generateBuffers(t,{excludeElementsInVAO:!0});const d=new ee$3(u),f=new de$4(e,d,{disableVAO:!0,transparent:!0,castShadow:!1,picking:!0}),p={};return a&&(p.ENABLE_COLLISION=1),e.data.aMarkerWidth&&(p.HAS_MARKER_WIDTH=1),e.data.aMarkerHeight&&(p.HAS_MARKER_HEIGHT=1),e.data.aColorOpacity&&(p.HAS_OPACITY=1),e.data.aMarkerDx&&(p.HAS_MARKER_DX=1),e.data.aMarkerDy&&(p.HAS_MARKER_DY=1),e.data.aPitchAlign&&(p.HAS_PITCH_ALIGN=1),e.data.aRotationAlign&&(p.HAS_ROTATION_ALIGN=1),e.data.aRotation&&(p.HAS_ROTATION=1),e.data.aPadOffsetX&&(p.HAS_PAD_OFFSET=1),e.data.aAltitude&&(p.HAS_ALTITUDE=1),f.setDefines(p),f.setLocalTransform(n),f.properties.symbolIndex=e.properties.symbolIndex,f}(this.regl,a,e,0,c,0,s.options.collision,!o,this.isEnableUniquePlacement());t&&(delete t.geometry.properties.glyphAtlas,d.push(t))}else if(this.jr(a)){const t=Xi$1.call(this,this.regl,a,e,h,c,u.text,s.options.collision,!o,this.isEnableUniquePlacement());t.length&&(t.forEach((t=>{delete t.geometry.properties.iconAtlas})),d.push(...t))}return"line"===h.markerPlacement&&this.Rr(a,r),"line"!==h.markerPlacement&&"line"!==h.textPlacement||d.forEach((t=>t.properties.isLinePlacement=!0)),this.Dr(a),d}Rr(t,e){const{collideIds:i}=t.properties,n=new Uint16Array(i.length);if(this.zr(t)){let r=0;for(let t=0;t<i.length;t+=4)n.fill(r++,t,t+4);t.properties.collideIds=n,t.properties.uniqueCollideIds=ke$2(n),e.markerCollideMap={old:i,new:n}}else if(this.jr(t)){const{collideIds:i,aCount:n}=t.properties;if(!n)return;if(e.markerCollideMap){const{markerCollideMap:r}=e;let o=r.new[r.new.length-1],s=0,a=i[0],l=e.markerCollideMap.old.indexOf(a),h=n[0];for(let t=0;t<i.length;){const r=i[t];a!==r&&(a=r,l=e.markerCollideMap.old.indexOf(a),s=0);const c=-1===l?++o:e.markerCollideMap.new[l+4*s],u=t+4*h;i.fill(c,t,u),t+=4*h,s++,u<i.length&&(h=n[u])}t.properties.uniqueCollideIds=ke$2(i)}else{let e=0,r=n[0];for(let t=0;t<i.length;){const o=t+4*r;i.fill(e++,t,o),t+=4*r,o<i.length&&(r=n[o])}t.properties.uniqueCollideIds=ke$2(i)}}}addMesh(t){if(this.sr()&&t.length>0){const e=new oi$1(t);e.properties.uniqueCollideIds=t[0].geometry.properties.uniqueCollideIds,e.properties.meshKey=t[0].properties.meshKey,e.properties.level=t[0].properties.level,this.Er.push(e)}for(let e=0;e<t.length;e++){if(!this.isMeshIterable(t[e]))continue;const i=t[e].geometry,{symbolIndex:n}=i.properties;we$2(this.getSymbolDef(n))&&yn$1.call(this,this.getMap(),i)}const e=this.getMap().getZoom();for(let i=0;i<t.length;i++){if(!this.isMeshIterable(t[i]))continue;const n=t[i].geometry,{symbolIndex:r}=n.properties,o=this.getSymbolDef(r),s=this.getFnTypeConfig(r);Oe$2(this.regl,o,0===r.type?s.icon:s.text,t[i],e);const{aMarkerWidth:a,aMarkerHeight:l,aPadOffsetX:h,aPadOffsetY:c}=n.properties;a&&a.dirty&&(n.updateData("aMarkerWidth",a),a.dirty=!1),l&&l.dirty&&(n.updateData("aMarkerHeight",l),l.dirty=!1),h&&h.dirty&&(n.updateData("aPadOffsetX",h),h.dirty=!1),c&&c.dirty&&(n.updateData("aPadOffsetY",c),c.dirty=!1)}super.addMesh(...arguments)}updateCollision(t){if(!this.sr())return;super.updateCollision(t);const e=this.scene.getMeshes();e&&e.length?(this.Nr(t.timestamp),this.Er=[],this.Dn()):this.Dn()}callCurrentTileShader(t,e){this.shader.filter=e.sceneFilter?[this.Pr,e.sceneFilter]:this.Pr,this.callRenderer(this.shader,t,e),this.Lr.filter=e.sceneFilter?[this.Or,e.sceneFilter]:this.Or,this.callRenderer(this.Lr,t,e)}callBackgroundTileShader(t,e){this.shader.filter=e.sceneFilter?[this.Ir,e.sceneFilter]:this.Ir,this.callRenderer(this.shader,t,e),this.Lr.filter=e.sceneFilter?[this.Cr,e.sceneFilter]:this.Cr,this.callRenderer(this.Lr,t,e)}isMeshIterable(t){return t&&t.geometry&&!t.geometry.properties.isEmpty&&t.material&&!t.material.get("isHalo")&&this.isMeshVisible(t)&&!(this.shouldIgnoreBackground()&&!this.layer.getRenderer().isForeground(t))}Nr(){if(!this.sr())return;let t=this.Er;t&&t.length&&this.Hr(t)}Vr(t,e,i,n){return this.updateBoxCollisionFading(!0,t,e,i,n)}isEnableUniquePlacement(){return this.isEnableCollision()&&!0===this.sceneConfig.uniquePlacement}Hr(t){const e=this.layer.getRenderer();t=t.sort(_n$1);for(let i=0;i<t.length;i++){const n=t[i];if(!n||!n.meshes.length)continue;let r=!1;if(1===n.meshes.length)r=this.isMeshIterable(n.meshes[0]);else for(let t=0;t<n.meshes.length;t++)if(this.isMeshIterable(n.meshes[t])){r=!0;break}if(!r)continue;const o=e.isForeground(n.meshes[0]);if(this.shouldIgnoreBackground()&&!o)continue;const s=n.properties.meshKey;this.startMeshCollision(n),this.Ur(n),this.forEachBox(n,this.Vr),this.qr(n),this.endMeshCollision(s);for(let t=0;t<n.meshes.length;t++)this.Gr(n.meshes[t])}}Gr(t){const e=t&&t.geometry&&t.geometry.properties.aOpacity;e&&e.dirty&&(t.geometry.updateData("aOpacity",e),e.dirty=!1)}forEachBox(t,e){const i=t.properties.uniqueCollideIds;if(!i)return;const n={boxIndex:0},r=i.length;for(let o=0;o<r;o++)this.Wr(t,i[o],e,n)}Wr(t,e,i,n){const o=this.getMap(),{collideBoxIndex:s}=t.meshes[0].geometry.properties;if(!s||!s[e])return!1;const a=multiply$5(wn$1,o.projViewMatrix,t.meshes[0].localTransform);let l,h=!1;const c=t.meshes;let u=0;for(let t=0;t<c.length;t++){if(!this.isMeshIterable(c[t]))continue;const{collideBoxIndex:i}=c[t].geometry.properties;i[e]&&u++}if(!u)return!1;l=this.kr(u);let d=0;for(let t=0;t<c.length;t++){if(!this.isMeshIterable(c[t]))continue;h=!0;const{elements:n,aCount:r,collideBoxIndex:o}=c[t].geometry.properties,s=o[e];if(!s)continue;const[a,u,f]=s;let p=1;r&&(p=r[n[a]]);const m=a+0*p*6;l[d].mesh=c[t],l[d].start=m,l[d].end=u,l[d].boxCount=f,l[d].allElements=n,d++}return!!h&&(i.call(this,t,l,a,n.boxIndex++)&&this.Br(t,e),!0)}Ur(t){const e=t.meshes;for(let t=0;t<e.length;t++){const i=e[t],n=i&&i.geometry;n&&(n.properties.visElemts.count=0)}}Br(t,e){const i=t.meshes;for(let t=0;t<i.length;t++){const n=i[t];if(n.properties.isHalo)continue;const r=n&&n.geometry;if(!r||r.properties.isEmpty)continue;const{collideBoxIndex:o,elements:s,visElemts:a}=r.properties,l=o[e];if(!l)continue;const[h,c]=l;let u=a.count;for(let t=h;t<c;t++)a[u++]=s[t];a.count=u}}qr(t){const e=t.meshes;for(let t=0;t<e.length;t++){const i=e[t],n=i&&i.geometry;if(!n)continue;const{visElemts:r}=n.properties;n.setElements(r,r.count)}}isBoxCollides(t,e,i,n,r,o){if(this.jr(t.geometry))return rn$1.call(this,0,t,e,i,n,r,o);if(t.geometry.properties.isEmpty)return An$1;const s=this.getMap(),{boxes:a,collision:l}=this.Ar(t,n);let h=0,c=0,u=0;for(let i=n;i<r;i+=6){const n=a[u]=a[u]||[];u++;const r=Ri$1.call(this,n,t,e[i],o,s);if(!h){const t=this.isCollides(r);1===t?h=1:-1===t&&c++}}return c===i&&(h=-1),l.collides=h,l}deleteMesh(t,e){t&&(t instanceof oi$1&&(t=t.meshes),e&&(Array.isArray(t)?t.forEach((t=>{t&&t.material&&delete t.material.uniforms.iconTex})):t.material&&delete t.material.uniforms.iconTex),super.deleteMesh(t,e))}isBloom(t){const e=t&&t.material&&!de$2(t.material.get("markerOpacity")),i=this.getSymbol(t.properties.symbolIndex);return!!(e?i.markerBloom:i.textBloom)}init(){const e=this.canvas;this.renderer=new k$7(this.regl);const n={viewport:{x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},depth:{enable:!0,range:()=>this.sceneConfig.depthRange||[0,1],func:()=>this.sceneConfig.depthFunc||"always",mask:!!de$2(this.sceneConfig.depthMask)||this.sceneConfig.depthMask},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}};this.shader=new rt$6({vert:mi$1,frag:"#define SHADER_NAME MARKER\nprecision mediump float;\n#include <gl2_frag>\nuniform sampler2D iconTex;\nuniform lowp float markerOpacity;\nuniform lowp float blendSrcIsOne;\n#include <highlight_frag>\nvarying vec2 vTexCoord;\nvarying float vOpacity;\nvoid main() {\n  vec4 c = texture2D(iconTex, vTexCoord) * markerOpacity * vOpacity;\n  if(blendSrcIsOne == 1.) {\n    c *= c.a;\n  }\n  if(c.a < .05) {\n    discard;\n  }\n  glFragColor = c;\n  glFragColor = highlight_blendColor(glFragColor);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:n}),this.shader.version=300;const{uniforms:o,extraCommandProps:s}=Zi$1.call(this,this.layer,this.sceneConfig);if(this.Lr=new rt$6({vert:ln$1,frag:hn$1,uniforms:o,extraCommandProps:s,defines:this.Fr||{}}),this.pickingFBO){const t=new nr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+mi$1,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:n},this.pickingFBO);t.filter=t=>!!t.geometry.properties.iconAtlas;const e=new nr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+ln$1,uniforms:o,extraCommandProps:s},this.pickingFBO);e.filter=t=>!!t.geometry.properties.glyphAtlas,this.picking=[t,e]}}getUniformValues(t){const e=t.projViewMatrix,i=t.cameraToCenterDistance,n=[t.width,t.height];return{layerScale:this.layer.options.styleScale||1,mapPitch:t.getPitch()*Math.PI/180,mapRotation:t.getBearing()*Math.PI/180,projViewMatrix:e,cameraToCenterDistance:i,canvasSize:n,iconSize:[24,24],resolution:t.getResolution(),glyphSize:24,gammaScale:1,blendSrcIsOne:+!("one"!==this.sceneConfig.blendSrc)}}getUniqueEntryKey(t,e){if(!this.jr(t.geometry))return null;const{elements:i}=t.geometry.properties;return on$1(t,i[e])}zr(t){const{symbolIndex:e}=t.properties;return 0===e.type}jr(t){const{symbolIndex:e}=t.properties;return 1===e.type}}function _n$1(t,e){return t.properties.level-e.properties.level||t.properties.meshKey-e.properties.meshKey}var Sn$1=Tn$1;function Tn$1(t,e){this.x=t,this.y=e}Tn$1.prototype={clone:function(){return new Tn$1(this.x,this.y)},add:function(t){return this.clone().$r(t)},sub:function(t){return this.clone().Xr(t)},multByPoint:function(t){return this.clone().Yr(t)},divByPoint:function(t){return this.clone().Jr(t)},mult:function(t){return this.clone().Zr(t)},div:function(t){return this.clone().Kr(t)},rotate:function(t){return this.clone().Qr(t)},rotateAround:function(t,e){return this.clone().to(t,e)},matMult:function(t){return this.clone().eo(t)},unit:function(){return this.clone().io()},perp:function(){return this.clone().no()},round:function(){return this.clone().ro()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},eo:function(t){var i=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=i,this},$r:function(t){return this.x+=t.x,this.y+=t.y,this},Xr:function(t){return this.x-=t.x,this.y-=t.y,this},Zr:function(t){return this.x*=t,this.y*=t,this},Kr:function(t){return this.x/=t,this.y/=t,this},Yr:function(t){return this.x*=t.x,this.y*=t.y,this},Jr:function(t){return this.x/=t.x,this.y/=t.y,this},io:function(){return this.Kr(this.mag()),this},no:function(){var t=this.y;return this.y=this.x,this.x=-t,this},Qr:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},to:function(t,e){var i=Math.cos(t),n=Math.sin(t),o=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=o,this},ro:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Tn$1.convert=function(t){return t instanceof Tn$1?t:Array.isArray(t)?new Tn$1(t[0],t[1]):t};const Mn$1=[],Pn$1=[],In$1=[];function On$1(t,e,i,r,o,s,a,l){const{aGlyphOffset:c,aSegment:u,aTextDx:d,aTextDy:f,symbolIndex:p}=e.geometry.properties,m=this.getSymbol(p),v=set(In$1,(d?d[o]:m.textDx)||0,(f?f[o]:m.textDy)||0),b=set(Mn$1,c[2*o],c[2*o+1]),x=set$4(Pn$1,u[3*o],u[3*o+1],u[3*o+2]);return function(t,e,i,n,r,o,s,a,l,h,c,u){const d=n[0]*h,f=c?d-r:d+r;let p=f>0?1:-1,m=0;c&&(p*=-1,m=Math.PI),p<0&&(m+=Math.PI);const y=a+l,g=Math.abs(f);let v=p>0?s:s+1,b=Sn$1.convert(i),x=Sn$1.convert(i),w=0,A=0;for(;w+A<=g;){if(v+=p,v<a||v>=y)return null;x.x=b.x,x.y=b.y,b.x=e[3*v],b.y=e[3*v+1],w+=A,A=x.dist(b)/u}const k=(g-w)/A,_=b.sub(x),S=_.mult(k).$r(x);S.$r(_.io().no().Zr(o*p));const T=m+Math.atan2(b.y-x.y,b.x-x.x);return t[0]=(S.x-i[0])/u,t[1]=(S.y-i[1])/u,t[2]=T,t}(t,r,s,b,v[0],v[1],x[0],x[1],x[2],i/24,l,a)}const Cn$1=[],En$1=[];function Fn$1(t,e,i,r,o,s,a,l,c,u,d){const{aVertical:f}=i.geometry.properties,p=f[s];let m,y,g=On$1.call(this,Cn$1,i,r,o,s,l,c,!1);if(!g)return null;if(copy$4(t,g),g=On$1.call(this,En$1,i,r,o,a,l,c,!1),!g)return null;if(copy$4(e,g),d&&(transformMat2(Cn$1,Cn$1,d),transformMat2(En$1,En$1,d)),p){const t=Math.abs(En$1[1]-Cn$1[1]),e=Math.abs(En$1[0]-Cn$1[0])*u;y=Cn$1[0]>En$1[0]?1:0,t>e?(m=1,y=Cn$1[1]<En$1[1]?0:1):m=0}else m=0,y=Cn$1[0]>En$1[0]?1:0;return 2*y+m}var zn$1="#define SHADER_NAME TEXT_LINE\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aTexCoord;\n#ifdef HAS_OFFSET_Z\nattribute vec3 aOffset;\nuniform float altitudeScale;\n#else\nattribute vec2 aOffset;\n#endif\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_TEXT_SIZE\nattribute float aTextSize;\n#else\nuniform float textSize;\n#endif\n#ifdef HAS_TEXT_DX\nattribute float aTextDx;\n#else\nuniform float textDx;\n#endif\n#ifdef HAS_TEXT_DY\nattribute float aTextDy;\n#else\nuniform float textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\nuniform float zoomScale;\nuniform float cameraToCenterDistance;\nuniform mat4 projViewModelMatrix;\nuniform float textPerspectiveRatio;\nuniform float mapPitch;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float tileRatio;\nuniform float layerScale;\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vGammaScale;\nvarying float vSize;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nattribute vec4 aTextFill;\nvarying vec4 vTextFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nattribute vec4 aTextHaloFill;\nvarying vec4 vTextHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nattribute float aTextHaloRadius;\nvarying float vTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nattribute float aTextHaloOpacity;\nvarying float vTextHaloOpacity;\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_TEXT_DX\nfloat d = aTextDx;\n#else\nfloat d = textDx;\n#endif\n#ifdef HAS_TEXT_DY\nfloat e = aTextDy;\n#else\nfloat e = textDy;\n#endif\n#ifdef HAS_TEXT_SIZE\nfloat f = aTextSize * layerScale;\n#else\nfloat f = textSize * layerScale;\n#endif\n#ifdef HAS_PITCH_ALIGN\nfloat h = aPitchAlign;\n#else\nfloat h = pitchWithMap;\n#endif\ngl_Position = projViewModelMatrix * vec4(c, 1.);\n  float i = gl_Position.w;\n  float j = i / cameraToCenterDistance;\n  float k = (1. - cameraToCenterDistance / i) * textPerspectiveRatio;\n  float l = clamp(.5 + .5 * (1. - k), .0, 4.);\n#ifdef HAS_OFFSET_Z\nvec3 m = aOffset / 10.0;\n  m[2] /= altitudeScale;\n#else\nvec3 m = vec3(aOffset / 10.0, .0);\n#endif\nvec2 n = aTexCoord;\n  if(h == 1.) {\n    m.xy *= tileRatio / zoomScale * j * l;\n    gl_Position = projViewModelMatrix * vec4(c + m, 1.);\n  } else {\n    gl_Position.xy += m.xy * 2. / canvasSize * l * i;\n  }\n  gl_Position.xy += vec2(d, -e) * 2. / canvasSize * i;\n#ifndef PICKING_MODE\nif(h == 1.) {\n    vGammaScale = j + mapPitch / 4.;\n  } else {\n    vGammaScale = mix(1., j, textPerspectiveRatio);\n  }\n  vGammaScale = clamp(vGammaScale, .0, 1.);\n  vTexCoord = n / texSize;\n  vSize = f;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\n#ifdef HAS_TEXT_FILL\nvTextFill = aTextFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvTextHaloFill = aTextHaloFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvTextHaloRadius = aTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nvTextHaloOpacity = aTextHaloOpacity;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool o = aOpacity == 255.;\n#else\nbool o = true;\n#endif\nfbo_picking_setData(gl_Position.w, o);\n#endif\n}";const jn$1=function(t){const e=this.layer.getRenderer(),i=this.getSymbol(t.properties.symbolIndex);return!this.Sr(t)&&e.isTileNearCamera(t)&&"line"!==i.textPlacement},Dn$1=function(t){const e=this.layer.getRenderer(),i=this.getSymbol(t.properties.symbolIndex);return!this.Sr(t)&&!e.isForeground(t)&&"line"!==i.textPlacement},Rn$1=function(t){const e=this.layer.getRenderer(),i=this.getSymbol(t.properties.symbolIndex);return!this.Sr(t)&&e.isTileNearCamera(t)&&"line"===i.textPlacement},Nn$1=function(t){const e=this.layer.getRenderer(),i=this.getSymbol(t.properties.symbolIndex),n=t.properties.tile.z,r=e.getCurrentTileZoom();return!this.Sr(t)&&!e.isForeground(t)&&"line"===i.textPlacement&&n<r},Ln$1=[0,0,3],Hn$1=[],Vn$1=[],Un$1=[],qn$1=[],Gn$1=[],Wn$1=[],Bn$1=[],$n$1=[],Xn$1=[],Yn$1=[1,-1],Jn$1=new Int16Array(3),Zn$1=[],Kn$1=[],Qn$1=[],tr$2=[],er$2=[],ir$2=[],nr$2={},rr$2={},or$2={},sr$2=[];class ar$2 extends di$1{constructor(t,e,i,n,r){super(t,e,i,n,r),this.propAllowOverlap="textAllowOverlap",this.propIgnorePlacement="textIgnorePlacement",this.colorCache={},this.oo=jn$1.bind(this),this.so=Dn$1.bind(this),this.ao=Rn$1.bind(this),this.lo=Nn$1.bind(this),this.isLabelCollides=rn$1.bind(this),this.ho()}ho(){this.co=[];for(let t=0;t<this.symbolDef.length;t++){const e=this.symbolDef[t];if(sr$3.isExpression(e.textName)){const i=sr$3.createExpression(e.textName,"string");this.co[t]=(t,e)=>{let n;nr$2.zoom=t,rr$2.properties=e;try{n=i.evaluateWithoutErrorHandling(nr$2,rr$2,or$2,null,sr$2)}catch(t){n=null}return n}}else isFunctionDefinition(e.textName)&&(this.co[t]=interpolated(e.textName))}}updateSymbol(...t){const e=super.updateSymbol(...t);return this.ho(),e}shouldDeleteMeshOnUpdateSymbol(t){if(!Array.isArray(t))return(0===t.textHaloRadius||0===this.symbolDef[0].textHaloRadius)&&t.textHaloRadius!==this.symbolDef[0].textHaloRadius;for(let e=0;e<t.length;e++)if(t[e]&&(0===t[e].textHaloRadius||0===this.symbolDef[e].textHaloRadius)&&t[e].textHaloRadius!==this.symbolDef[e].textHaloRadius)return!0;return!1}createFnTypeConfig(t,e){return Ki$1(t,e)}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).textBloom}createGeometry(t,e,i){const n=t;if(!n.glyphAtlas)return null;const r=super.createGeometry(n);if(!r||!r.geometry)return null;const{geometry:o}=r;return o.properties.glyphAtlas&&this.drawDebugAtlas(o.properties.glyphAtlas),o&&n.lineVertex&&(o.properties.line=n.lineVertex,o.properties.line.id=i),r}createMesh(t,e){const i=this.isEnableCollision(),n=this.isEnableUniquePlacement(),{geometry:r,symbolIndex:o}=t;r.properties.symbolIndex=o;const s=this.getSymbol(o),a=this.getSymbolDef(o),l=this.getFnTypeConfig(o),h=Xi$1.call(this,this.regl,r,e,a,s,l,this.layer.options.collision,!i,n);return h.length&&("line"===s.textPlacement?this.uo=!0:this.do=!0),h}updateCollision(t){super.updateCollision(t);const e=this.scene.getMeshes();e&&e.length?(this.fo={},this.po(t.timestamp),this.Dn()):this.Dn()}callCurrentTileShader(t,e){this.shader.filter=e.sceneFilter?[this.oo,e.sceneFilter]:this.oo,this.callRenderer(this.shader,t,e),this.mo.filter=e.sceneFilter?[this.ao,e.sceneFilter]:this.ao,this.callRenderer(this.mo,t,e)}callBackgroundTileShader(t,e){this.shader.filter=e.sceneFilter?[this.so,e.sceneFilter]:this.so,this.callRenderer(this.shader,t,e),this.mo.filter=e.sceneFilter?[this.lo,e.sceneFilter]:this.lo,this.callRenderer(this.mo,t,e)}po(){let t=this.scene.getMeshes();if(!t||!t.length)return;const e=-this.getMap().getBearing()*Math.PI/180,i=fromRotation$4(Un$1,e),n=(t,e,i,n)=>{const{start:r,end:o,mesh:s,allElements:a}=e[0];if(this.updateBoxCollisionFading(!0,s,e,i,n)){let e=t.count;for(let i=r;i<o;i++)t[e++]=a[i];t.count=e}},r=this.sr(),o=this.layer.getRenderer();t=t.sort(hr$2);for(let e=0;e<t.length;e++){const s=t[e];if(!this.isMeshIterable(s))continue;if(!o.isTileNearCamera(s)){const{visElemts:t}=s.geometry.properties;t&&(t.count=0),s.geometry.setElements(t,0);continue}const a=s.geometry,l=this.getSymbol(s.properties.symbolIndex);s.properties.textHaloRadius=de$2(l.textHaloRadius)?$i$1.textHaloRadius:l.textHaloRadius;const h=s.properties.meshKey;if("line"===l.textPlacement){if(!a.properties.line)continue;r&&this.startMeshCollision(s),this.yo(s,i);const{aOffset:t,aOpacity:e}=a.properties;t.dirty&&(a.updateData("aOffset",t),t.dirty=!1),e&&e.dirty&&(a.updateData("aOpacity",e),e.dirty=!1),r&&this.endMeshCollision(h)}else if(r){this.startMeshCollision(s);const{elements:t,aOpacity:e,visElemts:i}=a.properties;i.count=0,this.forEachBox(s,((t,e,r,o,s)=>{n(i,e,r,o)})),e&&e.dirty&&a.updateData("aOpacity",e);const o=!i.count&&!a.count;i.count===t.length&&a.count===t.length||o||a.setElements(i,i.count),this.endMeshCollision(h)}}}isMeshIterable(t){return t.isValid()&&t.material&&!t.material.get("isHalo")&&!(this.shouldIgnoreBackground()&&!this.layer.getRenderer().isForeground(t))}isMeshUniquePlaced(t){return!!this.isMeshIterable(t)&&"line"!==this.getSymbol(t.properties.symbolIndex).textPlacement}getUniqueEntryKey(t,e){return on$1(t,e)}yo(t,e){const i=this.getMap(),n=t.geometry,o=n.properties;let s=o.line;if(!s)return;const a=1===t.material.uniforms.pitchWithMap,l=o.elements;if(!a){const e=multiply$5(Hn$1,i.projViewMatrix,t.localTransform),n=new Array(s.length);s=this.vo(n,s,e,i.width,i.height)}const h=this.sr(),c=n.properties.visElemts=n.properties.visElemts||new l.constructor(l.length);h&&(c.count=0),this.forEachBox(t,((t,i,n,r)=>{const{start:o,end:u}=i[0];let d=this.bo(t,l,o,u,s,n,a?e:null,r);if(h&&(d=this.updateBoxCollisionFading(d,t,i,n,r),d)){let t=c.count;for(let e=o;e<u;e++)c[t++]=l[e];c.count=t}})),!h||c.count===l.length&&n.count===c.count||n.setElements(c,c.count)}vo(t,e,i,n,r){const o=e.id+"-"+i.join();if(this.fo[o])return this.fo[o];const s=function(t,e,i,n,r){const o=[];for(let s=0;s<e.length;s+=3)set$3(o,e[s],e[s+1],e[s+2],1),gi$1(o,o,i,n,r),t[s]=o[0],t[s+1]=o[1],t[s+2]=e[s+2];return t}(t,e,i,n,r);return this.fo[o]=s,s}forEachBox(t,e){const i=this.getMap(),n=multiply$5(Hn$1,i.projViewMatrix,t.localTransform),{collideIds:o,aCount:s,features:a,elements:l}=t.geometry.properties,h=o,c=this.isEnableUniquePlacement(),u=this.kr(1);u[0].allElements=l,u[0].mesh=t;let d=0,f=l[0],p=0,m=h[f];for(let i=0;i<=l.length;i+=6)if(f=l[i],h[f]!==m||i===l.length){const r=a[m]&&a[m].feature;if(c&&this.isMeshUniquePlaced(t)&&r&&!r.label){const e=r.properties||{};e.$layer=r.layer,e.$type=r.type;const{symbolIndex:i}=t.properties,n=i&&this.co[i.index]?this.co[i.index](t.properties.z,e):this.getSymbol(t.properties.symbolIndex).textName,o=wr$3.resolveText(n,e);delete e.$layer,delete e.$type,r.label=o}const o=i,y=s[l[p]];for(let i=p;i<o;i+=6*y)u[0].start=i,u[0].end=i+6*y,u[0].boxCount=y,e.call(this,t,u,n,d++);m=h[f],p=i}}bo(t,e,i,o,s,l,u){const d=this.sr(),f=this.getMap(),p=t.geometry,m=p.desc.positionSize,{aShape:y,aOffset:g,aAnchor:v,aAltitude:b,aPitchRotation:x}=p.properties,w=p.properties.aTextSize,A=!u,k=e[i]*m;let _=qn$1;p.data.aAltitude?set$4(qn$1,v[k],v[k+1],b[e[i]]):Zo.unpackPosition(qn$1,v[k],v[k+1],v[k+2]);const S=gi$1(Gn$1,_,l,f.width,f.height);if(set$3(Wn$1,S[0],S[1],S[0],S[1]),f.isOffscreen(Wn$1))return d||lr$2(g,e,i,o),!1;A&&(_=S);const T=A?1:p.properties.tileExtent/this.layer.options.tileSize[0];let M=!0;const I=e[i],O=e[o-1],C=w?w[I]:t.properties.textSize,E=this.xo(t,C,s,I,O,_,T,u);if(null===E)return lr$2(g,e,i,o),!1;const F=O-I<=3,z=t.material.uniforms,j=1===z.pitchWithMap,D=Math.floor(E/2),R=E%2;for(let a=i;a<o;a+=6){const l=e[a];let u;if(u=D||a!==i||F?D||a!==o-6||F?On$1.call(this,Vn$1,t,C,s,l,_,T,D):ir$2:er$2,!u){M=!1,d||lr$2(g,e,i,o);break}let f=u[2];R&&(f-=Math.PI/2);const p=Ti$1(Bn$1,f,0,z.rotateWithMap,z.pitchWithMap),m=g.length>y.length;let v;if(m){set$4(tr$2,x[3*l],x[3*l+1],0);const t=normalize$4(tr$2,tr$2),e=-x[3*l+2];if(e){const i=setAxisAngle(Zn$1,t,e);fromTranslation$1(Kn$1,Ln$1),fromQuat(Qn$1,i),v=multiply$5(Qn$1,Qn$1,Kn$1)}}for(let t=0;t<4;t++){const e=2*(l+t);set($n$1,y[e]/10,y[e+1]/10),scale($n$1,$n$1,C/24),transformMat2($n$1,$n$1,p),j?(multiply($n$1,$n$1,Yn$1),add(Xn$1,$n$1,u),m&&(Xn$1[2]=0,v&&transformMat4$2(Xn$1,Xn$1,v))):(multiply(Xn$1,u,Yn$1),add(Xn$1,$n$1,Xn$1)),Jn$1[0]=10*Xn$1[0],Jn$1[1]=10*Xn$1[1],m&&(Jn$1[2]=10*Xn$1[2]);const i=(m?3:2)*(l+t);(g[i]!==Jn$1[0]||g[i+1]!==Jn$1[1]||m&&g[i+2]!==Jn$1[2])&&(g.dirty=!0,g[i]=Jn$1[0],g[i+1]=Jn$1[1],m&&(g[i+2]=Jn$1[2]))}}return M}xo(t,e,i,n,r,o,s,a){const l=r-n<=3,h=this.getMap();return l?0:Fn$1.call(this,er$2,ir$2,t,e,i,n,r,o,s,h.width/h.height,a)}isBoxCollides(t,e,i,n,r,o){return this.isLabelCollides(0,t,e,i,n,r,o)}deleteMesh(t,e){t&&(e&&(Array.isArray(t)?t.forEach((t=>{t&&t.material&&delete t.material.uniforms.texture})):t.material&&delete t.material.uniforms.texture),super.deleteMesh(t,e))}delete(){super.delete(),this.mo.dispose(),delete this.fo,this.wo&&this.wo.dispose()}needClearStencil(){return!0}init(){this.renderer=new k$7(this.regl);const{uniforms:e,extraCommandProps:n}=Zi$1.call(this,this.layer,this.sceneConfig);this.shader=new rt$6({vert:ln$1,frag:hn$1,uniforms:e,extraCommandProps:n});let r=n;if(this.layer.getRenderer().isEnableWorkAround("win-intel-gpu-crash")&&(r=he$2({},n),r.stencil=he$2({},n.stencil),r.stencil.enable=!0),this.mo=new rt$6({vert:zn$1,frag:hn$1,uniforms:e,extraCommandProps:r}),this.pickingFBO){const t=new nr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+ln$1,uniforms:e,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO);t.filter=t=>"line"!==this.getSymbol(t.properties.symbolIndex).textPlacement;const n=new nr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+zn$1,uniforms:e,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO);n.filter=t=>"line"===this.getSymbol(t.properties.symbolIndex).textPlacement,this.picking=[t,n]}}getUniformValues(t){const e=t.projViewMatrix,i=t.cameraToCenterDistance,n=[t.width,t.height],r=B$6(t.getResolution(),t);return{layerScale:this.layer.options.styleScale||1,mapPitch:t.getPitch()*Math.PI/180,mapRotation:t.getBearing()*Math.PI/180,projViewMatrix:e,viewMatrix:t.viewMatrix,cameraToCenterDistance:i,canvasSize:n,glyphSize:24,gammaScale:1*(this.layer.options.textGamma||1),resolution:t.getResolution(),altitudeScale:r}}}function lr$2(t,e,i,n){for(let r=i;r<n;r+=6){const i=e[r];for(let e=0;e<4;e++){const n=3*(i+e);(t[n]||t[n+1]||t[n+2])&&(t.dirty=!0,t[n]=0,t[n+1]=0,t[n+2]=0)}}}function hr$2(t,e){const i=t.properties.level-e.properties.level;return 0===i?t.properties.meshKey-e.properties.meshKey:i}var cr$2="#define SHADER_NAME NATIVE_POINT\n#include <gl2_vert>\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 projViewModelMatrix;\nuniform float markerSize;\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n  gl_PointSize = markerSize;\n#ifdef PICKING_MODE\nfbo_picking_setData(gl_Position.w, true);\n#endif\n}";const ur$2={markerFill:[0,0,0],markerOpacity:1,markerSize:10};class dr$2 extends Xe$2{getPrimitive(){return"points"}createMesh(t,e){const{geometry:n,symbolIndex:r,ref:o}=t,s=this.getSymbol(r);void 0===o&&n.generateBuffers(this.regl);const a={};pe$2(a,"markerOpacity",s,"markerOpacity",1),pe$2(a,"markerSize",s,"markerSize",10),pe$2(a,"markerFill",s,"markerFill","#000",ge$2(this.colorCache,3));const l=new ee$3(a,ur$2);l.createDefines=()=>"square"!==s.markerType?{USE_CIRCLE:1}:null,l.appendDefines=t=>("square"!==s.markerType&&(t.USE_CIRCLE=1),t);const h=new de$4(n,l,{castShadow:!1,picking:!0}),c={};return h.geometry.data.aAltitude&&(c.HAS_ALTITUDE=1),h.setDefines(c),h.setLocalTransform(e),h.properties.symbolIndex=r,h}init(){this.renderer=new k$7(this.regl);const e={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},n=this.layer.getRenderer().isEnableTileStencil&&this.layer.getRenderer().isEnableTileStencil(),o={vert:cr$2,frag:"#define SHADER_NAME NATIVE_POINT\nprecision mediump float;\n#include <gl2_frag>\n#ifdef USE_CIRCLE\n#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#define STANDARD_DERIVATIVES_ENABLED 1\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define STANDARD_DERIVATIVES_ENABLED 1\n#endif\n#endif\nuniform vec3 markerFill;\nuniform float markerOpacity;\nvoid main() {\n  float c = 1.;\n#ifdef USE_CIRCLE\nfloat r = .0, d = .0;\n  vec2 e = 2. * gl_PointCoord - 1.;\n  r = dot(e, e);\n  if(r > 1.) {\n    discard;\n  }\n#ifdef STANDARD_DERIVATIVES_ENABLED\nd = fwidth(r);\n  c = 1. - smoothstep(1. - d, 1. + d, r);\n#endif\n#endif\nglFragColor = vec4(markerFill, 1.) * markerOpacity * c;\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],defines:null,extraCommandProps:{viewport:e,stencil:{enable:!0,func:{cmp:()=>n?"=":"<=",ref:(t,e)=>n?e.stencilRef:e.level,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,mask:!1,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"always"},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"}}};this.shader=new rt$6(o),this.shader.version=300,this.pickingFBO&&(this.picking=[new nr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+cr$2,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO)])}getUniformValues(t){return{projViewMatrix:t.projViewMatrix}}}var fr$2="#define SHADER_NAME NATIVE_LINE\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 projViewModelMatrix;\n#ifndef PICKING_MODE\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n#ifndef PICKING_MODE\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#endif\n#else\nfbo_picking_setData(gl_Position.w, true);\n#endif\n}";class pr$2 extends Xe$2{constructor(t,e,i,n,r){if(super(t,e,i,n,r),this.primitive="lines",isFunctionDefinition(this.symbolDef.lineColor)){const t=e.getMap(),i=piecewiseConstant(this.symbolDef.lineColor);this.colorSymbol=e=>i(t.getZoom(),e)}}needPolygonOffset(){return!0}createMesh(t,e){const{geometry:n,symbolIndex:r,ref:o}=t,s=this.getSymbol(r),a=this.getMeshUniforms(n,s);void 0===o&&n.generateBuffers(this.regl);const l=new ee$3(a),h=new de$4(n,l,{castShadow:!1,picking:!0});h.setLocalTransform(e),h.properties.symbolIndex=r;const c={};return h.geometry.data.aAltitude&&(c.HAS_ALTITUDE=1),h.setDefines(c),h}getMeshUniforms(t,e){const i={};return pe$2(i,"lineColor",e,"lineColor","#000",ge$2(this.colorCache)),pe$2(i,"lineOpacity",e,"lineOpacity",1),i}init(){const t=this.layer.getRenderer().isEnableTileStencil();this.renderer=new k$7(this.regl);const o=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],a={vert:fr$2,frag:"#define SHADER_NAME NATIVE_LINE\nprecision mediump float;\nuniform float lineOpacity;\nuniform vec4 lineColor;\n#if defined(HAS_COLOR)\nvarying vec4 vColor;\n#endif\nvoid main() {\n  gl_FragColor = lineColor * lineOpacity;\n#if defined(HAS_COLOR)\ngl_FragColor *= vColor;\n#endif\n}",uniforms:o,defines:null,extraCommandProps:{viewport:{x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},stencil:{enable:!0,mask:255,func:{cmp:()=>t?"=":"<=",ref:(e,i)=>t?i.stencilRef:i.level,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}};this.shader=new rt$6(a),this.pickingFBO&&(this.picking=[new nr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+fr$2,uniforms:o,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO)])}getUniformValues(t){return{projViewMatrix:t.projViewMatrix}}getPrimitive(){return"lines"}}const mr$2=[1,1,1],yr$2=[1,1,1,1],gr$2=[0,0],vr$2=[];class br$2 extends We$2{supportRenderMode(t){return this.isAnimating()?"fxaa"===t||"fxaaAfterTaa"===t:"taa"===t||"fxaa"===t}isAnimating(){return!1}createMesh(t,e,{tilePoint:n,tileZoom:o}){if(!this.material)return this.setToRedraw(),null;const{geometry:s,symbolIndex:a}=t,l=new de$4(s,this.material);if(this.sceneConfig.animation){mr$2[2]=.01;const t=[];fromScaling(t,mr$2),multiply$5(t,e,t),e=t}const h=this.getSymbolDef(a),c=this.getFnTypeConfig(a);Te$2(s,h,c);const u=this.getShader(),d=u.getGeometryDefines?u.getGeometryDefines(s):{},f=this.getSymbol(a);if(s.data.aExtrude){d.IS_LINE_EXTRUSION=1;const{tileResolution:t,tileRatio:e}=s.properties,i=this.getMap();Object.defineProperty(l.uniforms,"linePixelScale",{enumerable:!0,get:function(){return e*i.getResolution()/t}}),pe$2(l.uniforms,"lineWidth",f,"lineWidth",4),pe$2(l.uniforms,"lineOpacity",f,"lineOpacity",1),pe$2(l.uniforms,"lineColor",f,"lineColor","#fff",ge$2(this.colorCache)),Object.defineProperty(l.uniforms,"lineHeight",{enumerable:!0,get:()=>{const t=this.dataConfig.defaultAltitude*(this.dataConfig.altitudeScale||1);return xe$2(t)?t:0}})}else pe$2(l.uniforms,"polygonFill",f,"polygonFill",yr$2,ge$2(this.colorCache)),pe$2(l.uniforms,"polygonOpacity",f,"polygonOpacity",1);if(s.data.aColor&&(d.HAS_COLOR=1),s.data.aLineWidth&&(d.HAS_LINE_WIDTH=1),s.data.aLineHeight&&(d.HAS_LINE_HEIGHT=1),s.data.aOpacity){const t=s.data.aOpacity;for(let e=0;e<t.length;e++)if(t[e]<255){s.properties.hasAlpha=!0;break}}s.generateBuffers(this.regl),l.setDefines(d),l.setLocalTransform(e),(s.properties.maxAltitude<=0||l.properties.level>=3)&&(l.castShadow=!1),l.setUniform("maxAltitude",l.geometry.properties.maxAltitude);const p=this.getMap(),m=p.getGLRes(),y=this.layer.getSpatialReference&&this.layer.getSpatialReference(),g=(y?y.getResolution(o):p.getResolution(o))/m;return Object.defineProperty(l.uniforms,"uvOrigin",{enumerable:!0,get:()=>{const t=this.getSymbol(a).material.uvScale||[1,1],e=this.dataConfig.dataUVScale||[1,1];return[t[0]*n[0]*g/(.5*e[0]),t[1]*n[1]*g/(.5*e[1])]}}),Object.defineProperty(l.uniforms,"uvOffset",{enumerable:!0,get:()=>{const t=this.getUVOffsetAnim(),e=this.getUVOffset(t);return this.material&&this.material.get("noiseTexture")&&(e[0]*=-1),e}}),Object.defineProperty(l.uniforms,"hasAlpha",{enumerable:!0,get:()=>{const t=this.getSymbol(a);return s.properties.hasAlpha||t.polygonOpacity<1||t.lineOpacity<1}}),l.properties.symbolIndex=a,l}getShadowMeshes(){if(!this.isVisible())return vr$2;this.shadowCount=this.scene.getMeshes().length;const t=this.scene.getMeshes().filter((t=>0===t.properties.level));for(let e=0;e<t.length;e++){const i=t[e];i.material!==this.material&&i.setMaterial(this.material)}return t}getUVOffsetAnim(){const t=this.getSymbols()[0];return t.material&&t.material.uvOffsetAnim}getUVOffset(t){const e=this.getSymbols()[0],i=e.material&&e.material.uvOffset||gr$2,n=this.layer.getRenderer().getFrameTimestamp(),r=[i[0],i[1]],o=!!e.material&&e.material.noiseTexture,s=o?5e5:1e3,a=o?256:1;return t&&t[0]&&(r[0]=n*t[0]%s/s*a),t&&t[1]&&(r[1]=n*t[1]%s/s*a),r}needPolygonOffset(){return this.Ao}startFrame(...t){return delete this.Ao,super.startFrame(...t)}addMesh(t,e){t.forEach((t=>{this.An(t,e)})),super.addMesh(...arguments)}An(t,e){if(null!==e){const i=t.localTransform;0===e&&(e=.01),mr$2[2]=e,fromScaling(i,mr$2),multiply$5(i,t.properties.tileTransform,i),t.setLocalTransform(i)}else t.setLocalTransform(t.properties.tileTransform);t.material!==this.material&&t.setMaterial(this.material),t.geometry.properties.maxAltitude<=0&&(this.Ao=!0),t.ssr=this.getSymbol(t.properties.symbolIndex).ssr?1:0}deleteMesh(t,e){if(t)if(this.scene.removeMesh(t),Array.isArray(t))for(let i=0;i<t.length;i++)e||t[i].geometry.dispose(),t[i].dispose();else e||t.geometry.dispose(),t.dispose()}updateDataConfig(t,e){return!("line-extrusion"===this.dataConfig.type&&!t.altitudeProperty&&!e.altitudeProperty)}createFnTypeConfig(t,e){const i=piecewiseConstant(e.polygonFill||e.lineColor),n=interpolated(e.polygonOpacity||e.lineOpacity),r=interpolated(e.lineWidth),o=new Uint8Array(1),s=new Uint16Array(1);return[{attrName:"aColor",type:Uint8Array,width:4,symbolName:e.polygonFill?"polygonFill":e.lineColor?"lineColor":"polygonFill",define:"HAS_COLOR",evaluate:e=>{let n=i(t.getZoom(),e);return Array.isArray(n)||(n=this.colorCache[n]=this.colorCache[n]||color(n).unitArray()),n=ye$2(n),n}},{attrName:"aOpacity",type:Uint8Array,width:1,symbolName:e.polygonOpacity?"polygonOpacity":e.lineOpacity?"lineOpacity":"polygonOpacity",evaluate:(e,i)=>{const r=n(t.getZoom(),e);return o[0]=255*r,o[0]<255&&(i.properties.hasAlpha=!0),o[0]}},{attrName:"aLineWidth",type:Uint8Array,width:1,symbolName:"lineWidth",define:"HAS_LINE_WIDTH",evaluate:e=>{const i=r(t.getZoom(),e);return s[0]=Math.round(2*i),s[0]}}]}getPolygonOffset(){return{enable:(t,e)=>0===e.maxAltitude,offset:super.getPolygonOffset()}}updateSymbol(t,e){const i=super.updateSymbol(t,e);return t.material&&this.ko(t.material),i}nn(t,e){return xr$2(t)!==xr$2(e)}}function xr$2(t){if(!t||!t.material)return!1;for(const e in t.material)if(e.indexOf("Texture")>0&&t.material[e])return!0;return!1}class wr$2 extends br$2{createGeometry(t){const e=t.data,n=this.getSymbols()[0];if(n.material&&n.material.extrusionOpacity){const t=new Uint8Array(e.aPosition.length/3);for(let i=0;i<e.aPosition.length;i+=3)t[i/3]=e.aPosition[i+2]>0?0:1;e.aExtrusionOpacity=t}const r=new Z$7(e,t.indices);return he$2(r.properties,t.properties),this.vn(r,t),{geometry:r,symbolIndex:{index:0}}}updateSceneConfig(t){let e;if(this.sceneConfig.cullFace!==t.cullFace&&(e=!0),he$2(this.sceneConfig,t),e){const t=this.getShaderConfig();this.shader.dispose(),this.shader=new st$6(t)}this.setToRedraw()}getShader(){return this.shader}delete(t){this.getMap().off("updatelights",this._o,this),super.delete(t),this.material.dispose()}init(){this.getMap().on("updatelights",this._o,this);this.renderer=new k$7(this.regl);const e=this.getShaderConfig();this.shader=new st$6(e),this.ko();const n={vert:this.getPickingVert(),uniforms:["projViewMatrix","modelMatrix","positionMatrix",{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:this.pickingViewport}};this.picking=[new nr$4(this.renderer,n,this.layer.getRenderer().pickingFBO)]}_o(){this.setToRedraw()}getShaderConfig(){const t=this.canvas;return{extraCommandProps:{cull:{enable:()=>void 0===this.sceneConfig.cullFace||!!this.sceneConfig.cullFace,face:()=>{let t=this.sceneConfig.cullFace;return!0===t&&(t="back"),t||"back"}},stencil:{enable:!0,func:{cmp:"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},polygonOffset:this.getPolygonOffset()}}}ko(){this.material&&this.material.dispose();const t=this.getSymbols()[0].material,e={};for(const i in t)Ae$2(t,i)&&(e[i]=t[i]);this.material=new ie$4(e)}getUniformValues(t,e){const i=t.viewMatrix,n=t.projMatrix,r=t.cameraPosition,o=this.So(),s=he$2({viewMatrix:i,projMatrix:n,cameraPosition:r,projViewMatrix:t.projViewMatrix},o);s.halton=e&&e.jitter?e.jitter:[0,0];const a=this.layer.getRenderer().canvas;return s.outSize=[a.width,a.height],s}getPickingVert(){return"\n            attribute vec3 aPosition;\n            uniform mat4 projViewModelMatrix;\n            uniform mat4 modelMatrix;\n            uniform mat4 positionMatrix;\n            //fbo pickingvert\n            #include <fbo_picking_vert>\n            #include <get_output>\n            void main()\n            {\n                mat4 localPositionMatrix = getPositionMatrix();\n                vec4 localPosition = getPosition(aPosition);\n\n                gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n                //gl_Positiondepth\n                fbo_picking_setData(gl_Position.w, true);\n            }\n        "}So(){const t=this.getMap().getLightManager(),e=t&&t.getAmbientLight()||{},i=t&&t.getDirectionalLight()||{};return{ambientColor:e.color||[.2,.2,.2],light0_diffuse:[...i.color||[.1,.1,.1],1],lightSpecular:i.specular||[.8,.8,.8],light0_viewDirection:i.direction||[1,1,-1]}}}const Ar$2=[1,1,1];class kr$1 extends We$2{constructor(t,e,i,n,r){if(super(t,e,i,n,r),isFunctionDefinition(this.symbolDef[0].lineColor)){const t=e.getMap(),i=piecewiseConstant(this.symbolDef.lineColor);this.colorSymbol=e=>i(t.getZoom(),e)}else this.colorSymbol=this.getSymbol({index:0}).lineColor||"#bbb"}createGeometry(t){const{data:e,indices:n}=t,r=new Z$7(e,n,0,{primitive:"lines"});return r.generateBuffers(this.regl),{geometry:r,symbolIndex:{index:0}}}createMesh(t,e){const{geometry:n}=t,o=new de$4(n);if(o.castShadow=!1,this.sceneConfig.animation){Ar$2[2]=.01;const t=[];fromScaling(t,Ar$2),multiply$5(t,e,t),e=t}return o.setLocalTransform(e),o.properties.symbolIndex={index:0},o}addMesh(t,e){if(!t.length)return this;let i;null!==e?(0===e&&(e=.01),i=t[0].localTransform,Ar$2[2]=e,fromScaling(i,Ar$2),multiply$5(i,t[0].properties.tileTransform,i)):i=t[0].properties.tileTransform;for(let e=0;e<t.length;e++)t[e].setLocalTransform(i);return this.scene.addMesh(t),this}init(){const t=this.regl;this.scene=new pe$4,this.renderer=new k$7(t);const e={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},n={vert:"\n    attribute vec3 aPosition;\n    attribute vec4 aColor;\n\n    uniform mat4 projViewModelMatrix;\n    uniform vec2 outSize;\n\n    varying vec4 vColor;\n\n    void main()\n    {\n        gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n        vColor = aColor / 255.0;\n    }\n",frag:"\n    #ifdef GL_ES\n        precision lowp float;\n    #endif\n\n    uniform float opacity;\n\n    varying vec4 vColor;\n\n    void main()\n    {\n        gl_FragColor = vColor * opacity;\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],extraCommandProps:{stencil:{enable:!0,func:{cmp:"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},viewport:e}};this.shader=new rt$6(n)}getUniformValues(t){const e=this.sceneConfig.opacity||.3,i=this.layer.getRenderer().canvas;return{projViewMatrix:t.projViewMatrix,outSize:[i.width,i.height],opacity:e}}}const{getPBRUniforms:_r$2}=ur$4.PBRUtils;class Sr$2 extends br$2{constructor(...t){super(...t),this.To=new ve$4,this.scene.sortFunction=this.sortByCommandKey}supportRenderMode(t){return this.getSymbols()[0].ssr?"fxaa"===t||"fxaaAfterTaa"===t:super.supportRenderMode(t)}isAnimating(){const t=this.Mo();if(t&&(t[0]||t[1]))return!0}needToRedraw(){const t=this.Mo();return!(!t||!t[0]&&!t[1])||super.needToRedraw()}Mo(){const t=this.getSymbols()[0];return t.material&&t.material.uvOffsetAnim}createGeometry(t){if(!t.data||!t.data.aPosition||!t.data.aPosition.length)return null;const e=new Z$7(t.data,t.indices,0,{uv0Attribute:"aTexCoord0"});return he$2(e.properties,t.properties),this.vn(e,t),{geometry:e,symbolIndex:{index:0}}}paint(t){const e=!!t.shadow;t.states&&t.states.includesChanged&&(this.shader.dispose(),delete this.shader,this.Po.dispose(),delete this.Po,this.bn(t));let i=!!t.ssr&&this.getSymbols()[0].ssr;const n=this.shader,r=n.shaderDefines;if(i){const e=he$2({},r,t.ssr.defines);n.shaderDefines=e}if(t.onlyUpdateDepthInTaa&&(this.shader=this.Po,!i&&this.Io&&(this.shader=n,this.setToRedraw(!0))),this.updateIBLDefines(n),super.paint(t),void 0!==this.shadowCount&&e){const t=this.scene.getMeshes().length;this.shadowCount!==t&&this.setToRedraw()}this.shader=n,i&&(n.shaderDefines=r),delete this.shadowCount;const o=this.Mo();if(o&&(o[0]||o[1]))this.material.set("uvOffset",[0,0]);else{const t=this.getUVOffset(o);this.material.set("uvOffset",t)}this.Io=i}updateSceneConfig(t){he$2(this.sceneConfig,t),this.setToRedraw()}delete(){super.delete(),this.disposeIBLTextures(),this.material.dispose(),this.Po&&(this.Po.dispose(),delete this.Po)}init(t){this.getMap().on("updatelights",this.Oo,this),this.createIBLTextures(),this.kn=this.kn||t;this.renderer=new k$7(this.regl),this.Co=this.Eo.bind(this),this.Fo=this.disposeCachedTexture.bind(this),this.zo=this.jo.bind(this),this.ko(),this.bn(t);const n={vert:"\n                attribute vec3 aPosition;\n                uniform mat4 projViewModelMatrix;\n                uniform mat4 positionMatrix;\n                //fbo pickingvert\n                #include <line_extrusion_vert>\n                #include <get_output>\n                #include <fbo_picking_vert>\n                void main() {\n                    mat4 localPositionMatrix = getPositionMatrix();\n                    #ifdef IS_LINE_EXTRUSION\n                        vec3 linePosition = getLineExtrudePosition(aPosition);\n                        vec4 localVertex = getPosition(linePosition);\n                    #else\n                        vec4 localVertex = getPosition(aPosition);\n                    #endif\n\n                    gl_Position = projViewModelMatrix * localPositionMatrix * localVertex;\n                    fbo_picking_setData(gl_Position.w, true);\n                }\n            ",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>multiply$5([],e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:this.pickingViewport,depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="}}};this.picking=[new nr$4(this.renderer,n,this.layer.getRenderer().pickingFBO)]}bn(t){const e={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},n={},r=[];r.push(...Rt$4.getUniformDeclares()),this.fillIncludes(n,r,t);const o={cull:{enable:()=>void 0===this.sceneConfig.cullFace||!!this.sceneConfig.cullFace,face:this.sceneConfig.cullFace||"back"},stencil:{enable:(t,e)=>void 0===e.hasAlpha||!!e.hasAlpha,func:{cmp:"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},viewport:e,depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:(t,e)=>void 0===e.hasAlpha||!!e.hasAlpha,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},polygonOffset:this.getPolygonOffset()},s={uniforms:r,defines:this.Do(n),extraCommandProps:o};this.shader=new ur$4.StandardShader(s),s.frag="\n            precision mediump float;\n            #include <gl2_frag>\n            void main() {\n                glFragColor = vec4(0.0);\n                #if __VERSION__ == 100\n                    gl_FragColor = glFragColor;\n                #endif\n            }\n        ",this.Po=new ur$4.StandardShader(s)}Eo({resources:t}){for(let e=0;e<t.length;e++)this.addCachedTexture(t[e].url,t[e].data);this.setToRedraw(!0)}jo(){this.setToRedraw(!0)}ko(t){const e=t||this.getSymbols()[0].material,n={};let r=!1;for(const t in e)if(Ae$2(e,t))if(t.indexOf("Texture")>0){let o=e[t];if(!o){n[t]=void 0;continue}const s="string"==typeof o?o:o.url,a=this.getCachedTexture(s);a?a.then?s===o?o={promise:a,wrap:"repeat"}:o.promise=a:s===o?o={data:a,wrap:"repeat"}:o.data=a:s===o&&(o={url:s,wrap:"repeat"}),o.flipY=!0,n[t]=new je$4(o,this.To),n[t].once("complete",this.Co),n[t].once("disposed",this.Fo),n[t].promise&&this.addCachedTexture(s,n[t].promise),r=!0}else n[t]=e[t];if(this.material){for(let t in n)this.material.set(t,n[t]);this.setToRedraw(!0)}else this.material=new ur$4.StandardMaterial(n),this.material.once("complete",this.zo);r||this.jo()}getShader(){return this.shader}getUniformValues(t,e){const{iblTexes:i,dfgLUT:n}=this.getIBLRes(),r=_r$2(t,i,n,e&&e.ssr,e&&e.jitter);return this.setIncludeUniformValues(r,e),r}Do(t){return this.hasIBL()?t.HAS_IBL_LIGHTING=1:delete t.HAS_IBL_LIGHTING,t}Oo(){if(!this.shader)return;const t=this.shader.shaderDefines;this.Do(t),this.shader.shaderDefines=t}}var Tr$2="#include <gl2_vert>\n#define EXTRUDE_SCALE 63.0\n#define EXTRUDE_MOD 64.0\n#define MAX_LINE_DISTANCE 65535.0\nuniform mat4 projViewModelMatrix;\nuniform vec2 centiMeterToLocal;\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec4 aTubeNormal;\n#ifdef HAS_LINE_WIDTH\nattribute float aLineWidth;\n#else\nuniform float lineWidth;\n#endif\n#include <vt_position_vert>\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#else\nuniform mat4 modelViewMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelMatrix;\n#if defined(HAS_PATTERN)\nuniform float resolution;\nuniform float tileResolution;\nuniform float tileRatio;\nattribute float aLinesofar;\nvarying highp float vLinesofar;\nattribute vec4 aTexInfo;\nvarying vec4 vTexInfo;\nvarying float vNormalY;\nvarying float vPatternHeight;\nattribute float aNormalDistance;\n#if defined(HAS_PATTERN_ANIM)\nattribute float aLinePatternAnimSpeed;\nvarying float vLinePatternAnimSpeed;\n#endif\n#if defined(HAS_PATTERN_GAP)\nattribute float aLinePatternGap;\nvarying float vLinePatternGap;\n#endif\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\nvarying vec3 vModelNormal;\nvarying vec4 vViewVertex;\nvarying vec3 vModelVertex;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <highlight_vert>\nvoid main() {\n  \n#ifdef HAS_LINE_WIDTH\nfloat c = aLineWidth;\n#else\nfloat c = lineWidth;\n#endif\nfloat d = c / 2.;\n  vec3 e = aTubeNormal.xyz / EXTRUDE_SCALE;\n  vec3 f = unpackVTPosition();\n  vec4 h = vec4(f, 1.);\n  h.xy += e.xy * d * centiMeterToLocal;\n  h.z += e.z * d;\n  gl_Position = projViewModelMatrix * h;\n#ifdef PICKING_MODE\nfbo_picking_setData(gl_Position.w, true);\n#else\nvViewVertex = modelViewMatrix * h;\n  vec3 i = normalize(e);\n  vModelNormal = modelNormalMatrix * i;\n  vModelVertex = (modelMatrix * h).xyz;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(h);\n#endif\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\n#ifdef HAS_PATTERN\nfloat j = tileResolution / resolution;\n  float k = aLinesofar - d * centiMeterToLocal.y * aNormalDistance / EXTRUDE_SCALE;\n  vLinesofar = k / tileRatio * j;\n  vTexInfo = vec4(aTexInfo.xy, aTexInfo.zw + 1.);\n  vPatternHeight = c * centiMeterToLocal.x / tileRatio * j;\n  vNormalY = aTubeNormal.w / EXTRUDE_SCALE;\n#if defined(HAS_PATTERN_ANIM)\nvLinePatternAnimSpeed = aLinePatternAnimSpeed / 127.;\n#endif\n#if defined(HAS_PATTERN_GAP)\nvLinePatternGap = aLinePatternGap / 10.0;\n#endif\n#endif\nhighlight_setVarying();\n#endif\n}";const{getPBRUniforms:Mr$2}=ur$4.PBRUtils;class Pr$1 extends Xe$2{needToRedraw(){return super.needToRedraw()||this.isAnimating()}supportRenderMode(t){return this.isAnimating()?"fxaa"===t||"fxaaAfterTaa"===t:"taa"===t||"fxaa"===t}isAnimating(){if(this.xn)return!0;const t=this.getSymbols();for(let e=0;e<t.length;e++)if(t[e].linePatternAnimSpeed)return!0;return!1}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).lineBloom}createMesh(t,e){if(!t.geometry)return null;const n=this.getMap(),{geometry:r,symbolIndex:o,ref:s}=t,a=this.getSymbolDef(o);void 0===s&&Te$2(r,a,this.getFnTypeConfig(o));const l=this.getSymbol(o),{tileResolution:h,tileRatio:c}=r.properties,u={tileResolution:h,tileRatio:c};pe$2(u,"lineColor",l,"lineColor","#fff",ge$2(this.colorCache)),pe$2(u,"linePatternGapColor",l,"linePatternGapColor",[1,1,1,1],ge$2(this.colorCache)),pe$2(u,"lineWidth",l,"lineWidth",2,(t=>K$6.getTubeSizeScale(this.dataConfig.metric)*t)),pe$2(u,"lineOpacity",l,"lineOpacity",1),pe$2(u,"linePatternAnimSpeed",l,"linePatternAnimSpeed",0),pe$2(u,"linePatternGap",l,"linePatternGap",0),pe$2(u,"metallicFactor",l,"metallicFactor",0),pe$2(u,"roughnessFactor",l,"roughnessFactor",.4),pe$2(u,"uvScale",l,"uvScale",[1,1]);const d=r.properties.iconAtlas,f=r.data.aPosition instanceof Int16Array;d&&(u.linePatternFile=Je$2(this.regl,d,!1),u.atlasSize=d?[d.width,d.height]:[0,0],u.flipY=f?-1:1,this.drawDebugAtlas(d)),void 0===s&&r.generateBuffers(this.regl);const p=new ur$4.StandardMaterial(u),m=new de$4(r,p,{castShadow:!1,picking:!0}),y=n.distanceToPointAtRes(100,100,r.properties.tileResolution)._multi(c/1e4).toArray();m.setUniform("centiMeterToLocal",y),m.setLocalTransform(e);const g={IS_LINE_EXTRUSION:1};return"square-tube"===this.dataConfig.type&&(g.IS_SQUARE_TUBE=1),d&&(g.HAS_PATTERN=1),m.properties.symbolIndex=o,r.data.aColor&&(g.HAS_COLOR=1),this.setMeshDefines(g,r,a),r.data.aAltitude&&(g.HAS_ALTITUDE=1),m.setDefines(g),m}setMeshDefines(t,e,i){e.data.aOpacity&&(t.HAS_OPACITY=1),e.data.aLineWidth&&(t.HAS_LINE_WIDTH=1),De$2(i.linePatternAnimSpeed)&&(t.HAS_PATTERN_ANIM=1),De$2(i.linePatternGap)&&(t.HAS_PATTERN_GAP=1)}paint(t){t.states&&t.states.includesChanged.shadow&&(this.shader.dispose(),this.createShader(t)),super.paint(t)}init(t){this.getMap().on("updatelights",this.Oo,this),this.createIBLTextures();if(this.renderer=new k$7(this.regl),this.createShader(t),this.pickingFBO){const t=[];this.picking=[new nr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+Tr$2,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}},{name:"modelNormalMatrix",type:"function",fn:(e,i)=>fromMat4$1(t,i.modelMatrix)}],extraCommandProps:this.getExtraCommandProps()},this.pickingFBO)]}}createShader(t){this.kn=t;const e=[],n={};this.fillIncludes(n,e,t),e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}),this.shader=new ur$4.StandardShader({vert:Tr$2,uniforms:e,defines:this.Do(n),extraCommandProps:this.getExtraCommandProps()})}getExtraCommandProps(){const t=this.canvas;return{viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},stencil:{enable:!0,func:{cmp:()=>"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},cull:{enable:()=>!!this.sceneConfig.cullFace,face:this.sceneConfig.cullFace||"back"},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:this.sceneConfig.depthMask||!0,func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}getUniformValues(t,e){const{iblTexes:i,dfgLUT:n}=this.getIBLRes(),r=Mr$2(t,i,n,null,e&&e.jitter),s=t.viewMatrix;return r.projViewMatrix=t.projViewMatrix,r.viewMatrix=s,r.resolution=t.getResolution(),r.currentTime=this.layer.getRenderer().getFrameTimestamp()||0,this.setIncludeUniformValues(r,e),r}createFnTypeConfig(t,e){const i=piecewiseConstant(e.lineColor),n=piecewiseConstant(e.aLinePatternAnimSpeed),r=piecewiseConstant(e.aLinePatternGap),o=this.createShapeFnTypeConfigs(t,e),s=new Int8Array(2);return[{attrName:"aColor",symbolName:"lineColor",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||color(r).unitArray()),r=ye$2(r),r}},{attrName:"aLinePattern",symbolName:"linePatternAnimSpeed",type:Int8Array,width:2,related:["linePatternGap"],define:"HAS_LINE_PATTERN",evaluate:(e,i,r,o)=>{let a=n(t.getZoom(),e);return de$2(a)&&(a=0),0!==a&&(i.properties.hasPatternAnim=1),s[0]=a/127,s[1]=r[o+1],s[0]}},{attrName:"aLinePattern",symbolName:"linePatternGap",type:Int8Array,width:2,related:["linePatternAnimSpeed"],define:"HAS_LINE_PATTERN",evaluate:(e,i,n,o)=>{let a=r(t.getZoom(),e);return de$2(a)&&(a=0),s[1]=10*a,s[0]=n[o],s[0]}}].concat(o)}createShapeFnTypeConfigs(t,e){const i=interpolated(e.lineWidth),n=interpolated(e.lineOpacity),r=new Uint16Array(1);return[{attrName:"aLineWidth",symbolName:"lineWidth",type:Uint8Array,width:1,define:"HAS_LINE_WIDTH",evaluate:(e,n)=>{let o=i(t.getZoom(),e);return isFunctionDefinition(o)&&(o=this.evaluateInFnTypeConfig(o,n,t,e)),r[0]=Math.round(2*o),r[0]}},{attrName:"aOpacity",symbolName:"lineOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,i)=>{let o=n(t.getZoom(),e);return isFunctionDefinition(o)&&(o=this.evaluateInFnTypeConfig(o,i,t,e)),r[0]=255*o,r[0]}}]}Do(t){return this.hasIBL()?t.HAS_IBL_LIGHTING=1:delete t.HAS_IBL_LIGHTING,t}Oo(){if(!this.shader)return;const t=this.shader.shaderDefines;this.Do(t),this.shader.shaderDefines=t}delete(){super.delete(),this.disposeIBLTextures(),this.shader&&(this.shader.dispose(),delete this.shader)}}const Ir$2=[],Or$2=[],Cr$2=[0,0,0],Er$2=[0,0,0],Fr$1=[1,1,1],zr$1=[],jr$1=[1,1,1,1],Dr$1=[],Rr$2=t=>class extends t{constructor(t,e,n,r,o){super(t,e,n,r,o),this.Ro=!1,this.scene.sortFunction=this.sortByCommandKey,this.No=[],this.Lo=new pn$3(t),this.Ho()}isAnimating(){const t=this.getSymbols();for(let e=0;e<t.length;e++)if(t[e]&&this.Vo[e]&&this.Uo(e))return!0;return!1}createGeometry(t,e){const{data:i,positionSize:n}=t;return{geometry:{properties:he$2({},t.properties),data:i,positionSize:n,features:e},symbolIndex:t.symbolIndex}}getFnTypeConfig(){return zr$1}createMesh(t,e,{tileTranslationMatrix:o,tileExtent:s}){if(!this.Ro)return null;const a=this.getMap(),{geometry:l}=t,{positionSize:h,features:c}=l,{aPosition:u}=l.data,d=u.length/h;if(0===d)return null;const f={instance_vectorA:new Float32Array(4*d),instance_vectorB:new Float32Array(4*d),instance_vectorC:new Float32Array(4*d),aPickingId:[]};this.qo(f,o,s,l.properties.z,u,h);const p={};for(const t in f)p[t]={buffer:this.regl.buffer({dimension:f[t].length/d,data:f[t]}),divisor:1};const m=[],y=this.getSymbols();for(let t=0;t<y.length;t++){const e=y[t],s=this.No[t];if(!s)continue;const{translation:l,rotation:h,scale:u,fixSizeOnZoom:g}=e,v=this.Go([],l,h,u);let b=0;s.forEach((t=>{const{geometry:i,nodeMatrix:n}=t,o=multiply$5(Dr$1,v,n),s=i.boundingBox.copy();s.transform(o);const a=this.Wo(s,e);a>b&&(b=a)}));const x=[0,0,b],w=s.map((s=>{const{geometry:l,nodeMatrix:h,materialInfo:u,skin:m,morphWeights:y,extraInfo:b}=s,w=new(this.getMaterialClazz(u))(u),A={},k=new he$4(p,d,l,w,{transparent:!1,picking:!0});m&&(k.setUniform("jointTexture",m.jointTexture),k.setUniform("jointTextureSize",m.jointTextureSize),k.setUniform("numJoints",m.numJoints),k.setUniform("skinAnimation",0),A.HAS_SKIN=1),y&&(k.setUniform("morphWeights",y),A.HAS_MORPH=1),k.setUniform("hasAlpha",b.alphaMode&&"BLEND"===b.alphaMode.toUpperCase()),pe$2(k.uniforms,"polygonFill",e,"polygonFill",jr$1,ge$2(this.colorCache)),pe$2(k.uniforms,"polygonOpacity",e,"polygonOpacity",1);const _=multiply$5([],v,h),S=[];return fromTranslation$1(S,x),multiply$5(_,S,_),k.setPositionMatrix((()=>{if(xe$2(g)){const t=a.getGLScale()/a.getGLScale(g);return set$4(Ir$2,t,t,t),fromScaling(S,Ir$2),multiply$5(S,S,_)}return _})),k.setLocalTransform(o),l.generateBuffers(this.regl,{excludeElementsInVAO:!0}),f.instance_color&&(A.HAS_INSTANCE_COLOR=1),k.properties.features=c,k.setDefines(A),k.properties.symbolIndex={index:t},k}));m.push(...w)}return m.insContext={instanceData:f,tileTranslationMatrix:o,tileExtent:s,aPosition:u,positionSize:h},m}Wo(t,e){const i=e.anchorZ||"bottom";let n=0;return"bottom"===i?n=-t.min[2]:"top"===i?n=-t.max[2]:"center"===i&&(n=-(t.min[2]+t.max[2])/2),n}addMesh(t){if(!t)return null;if(t[0].properties.level>2)return null;for(let e=0;e<t.length;e++){if(!t[e]||!t[e].geometry)continue;const i=this.Uo(t[e].properties.symbolIndex.index);t[e].setUniform("skinAnimation",+i)}return this.scene.addMesh(t),this}prepareRender(t){const e=this.getSymbols();let i=!1;for(let n=0;n<e.length;n++){const r=e[n];if(r&&this.Vo[n]&&(this.Uo(n)&&this.Vo[n])){i||(i=!0);let e=r.speed;const o=!!r.loop;de$2(e)&&(e=1),this.Vo[n].updateAnimation(t.timestamp,o,e)}}i&&this.setToRedraw(!0),super.prepareRender(t)}getShadowMeshes(){return this.isVisible()?(this.shadowCount=this.scene.getMeshes().length,this.scene.getMeshes().filter((t=>0===t.properties.level))):zr$1}Uo(t){const e=this.getSymbols()[t];return e&&e.animation&&this.Vo[t]&&this.Vo[t].hasSkinAnimation()}qo(t,e,i,o,s,a){function l(e,i,n,r){t[e][4*i]=n[r],t[e][4*i+1]=n[r+4],t[e][4*i+2]=n[r+8],t[e][4*i+3]=n[r+12]}const h=s.length/a,c=this.layer.getTileSize().width/i*this.layer.getRenderer().getTileGLScale(o),u=this.layer.getRenderer().getZScale(),d=[],f=[];for(let e=0;e<h;e++){fromTranslation$1(f,set$4(d,s[e*a]*c,-s[e*a+1]*c,2===a?0:s[e*a+2]*u)),l("instance_vectorA",e,f,0),l("instance_vectorB",e,f,1),l("instance_vectorC",e,f,2),t.aPickingId[e]=e}}getShaderConfig(){const t=super.getShaderConfig();return t.positionAttribute="POSITION",t.normalAttribute="NORMAL",t}init(t){super.init(t),this.Ho()}Ho(){if(this.Vo)return;this.Vo=[];const t=this.getSymbols();this.Bo=0;for(let e=0;e<t.length;e++){const i=t[e].url||"pyramid";this.Lo.loginGLTF(i);const n=this.Lo.getGLTF(i);if(n.then)n.then((i=>{if(!i.gltfPack)return this.Bo++,void(this.Bo>=t.length&&(this.Ro=!0,this.setToRedraw(!0)));const{gltfPack:n}=i;this.Vo[e]=[n],this.No[e]=n.getMeshesInfo(),this.Bo++,this.Bo>=t.length&&(this.Ro=!0),this.setToRedraw(!0)}));else{const{gltfPack:t}=n;t&&(this.Vo[e]=[t],this.No[e]=t.getMeshesInfo(),this.Bo++)}}this.Bo>=t.length&&(this.Ro=!0)}getPickingVert(){return"\n    attribute vec3 aPosition;\n    uniform mat4 projViewModelMatrix;\n    uniform mat4 modelMatrix;\n    uniform mat4 positionMatrix;\n    //fbo pickingvert\n    #include <fbo_picking_vert>\n    #include <get_output>\n    void main()\n    {\n        mat4 localPositionMatrix = getPositionMatrix();\n        vec4 localPosition = getPosition(aPosition);\n\n        gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n        //gl_Positiondepth\n        fbo_picking_setData(gl_Position.w, true);\n    }"}deleteMesh(t){if(t){this.scene.removeMesh(t);for(let e=0;e<t.length;e++)t[e].disposeInstanceData(),t[e].dispose()}}delete(){super.delete();const t=this.getSymbols();for(let e=0;e<t.length;e++){this.Lo.logoutGLTF(t[e].url||"pyramid")}}Go(t,e,i,o){const s=set$4(Ir$2,...e||Cr$2),a=i||Er$2,l=o||Fr$1;return fromRotationTranslationScale(t,fromEuler(Or$2,a[0],a[1],a[2]),s,l)}};class Nr$2 extends(Rr$2(wr$2)){getMaterialClazz(t){return t.diffuseFactor?le$4:ie$4}}class Lr$1 extends(Rr$2(Sr$2)){getMaterialClazz(t){return t.specularGlossinessTexture||t.diffuseTexture?ur$4.StandardSpecularGlossinessMaterial:ur$4.StandardMaterial}}const{getPBRUniforms:Hr$1}=ur$4.PBRUtils,Vr$1={color:[2.0303,2.028,2.028],direction:[0,-.2717,-1]},Ur$2={index:0},qr$1=[0,0,0];class Gr$1 extends Xe$2{supportRenderMode(t){return"fxaa"===t||"fxaaBeforeTaa"===t}needPolygonOffset(){return!0}needToRedraw(){return!!super.needToRedraw()||this.getSymbol(Ur$2).animation}createMesh(t,e){const{geometry:n}=t;n.generateBuffers(this.regl);const r=new de$4(n,null,{castShadow:!1,picking:!0});return r.properties.symbolIndex=Ur$2,r.setLocalTransform(e),r}callShader(t,e){super.callShader(t,e),this.transformWater();const i=this.$o(this.getMap(),e);this.renderer.render(this.Xo,i,this.Yo,this.getRenderFBO(e))}addMesh(t,e){this.An(t,e),super.addMesh(...arguments)}An(t){const e=this.getSymbol(Ur$2).ssr;for(let i=0;i<t.length;i++)t[i].ssr=e?1:0}paint(t){t.states&&t.states.includesChanged&&(this.shader.dispose(),this.Xo.dispose(),this.bn(t));const e=!!t.ssr&&this.getSymbol(Ur$2).ssr,i=this.Xo,n=i.shaderDefines;if(e){const e=he$2({},n,t.ssr.defines);i.shaderDefines=e}this.updateIBLDefines(i),this.Jo.ssr=e?1:0,super.paint(t),e&&(i.shaderDefines=n)}init(t){this.createIBLTextures();this.renderer=new k$7(this.regl),this.createGround(),this.bn(t),this.pickingFBO&&(this.picking=[new nr$4(this.renderer,{vert:Ye$2,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO)]),this.Zo()}Zo(){const t=this.regl;this.Ko=t.texture(2),this.Qo=[2,2];const e=this.getSymbol({index:0}),i=e.texWaveNormal,n=this.getCachedTexture(i),r=this;if(n)n.loading||(this.ts=this.es(t,n));else{const e=new Image;e.loading=!0,e.onload=function(){delete this.loading,r.ts=r.es(t,this),this.Qo=[this.width,this.height],r.setToRedraw()},e.onerror=()=>{console.error("invalid water wave normal texture:"+i)},this.addCachedTexture(i,e),e.src=i}const o=e.texWavePerturbation,s=this.getCachedTexture(o);if(s)s.loading||(this.ns=this.es(t,s));else{const e=new Image;e.loading=!0,e.onload=function(){delete this.loading,r.ns=r.es(t,this),this.Qo=[this.width,this.height],r.setToRedraw()},e.onerror=()=>{console.error("invalid water wave perturbation texture:"+o)},this.addCachedTexture(o,e),e.src=o}}es(t,e){return this.Ko?t.texture({width:this.Qo[0],height:this.Qo[1],mag:"linear",min:"linear mipmap linear",wrapS:"repeat",wrapT:"repeat",flipY:!0,data:e}):null}bn(t){const e=this.canvas,n=[],o=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}},{name:"modelViewNormalMatrix",type:"function",fn:(t,e)=>{const i=multiply$5([],e.viewMatrix,e.modelMatrix),n=invert$2(i,i);return fromMat4$1([],transpose(n,n))}},{name:"modelViewMatrix",type:"function",fn:(t,e)=>multiply$5([],e.viewMatrix,e.modelMatrix)},{name:"uEnvironmentTransform",type:"function",fn:(t,e)=>fromRotation$2(n,Math.PI*(e.environmentOrientation||0)/180)}],s={TIME_NOISE_TEXTURE_REPEAT:.3737};this.fillIncludes(s,o,t);const a={x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1};this.shader=new rt$6({vert:"\n                attribute vec3 aPosition;\n\n                uniform mat4 projViewModelMatrix;\n\n                void main() {\n                    gl_Position = projViewModelMatrix * vec4(aPosition, 1.);\n                }\n            ",frag:"\n    #define SHADER_NAME WATER_STENCIL\n    precision mediump float;\n    void main() {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const i=[];return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],extraCommandProps:{viewport:a,colorMask:[!1,!1,!1,!1],stencil:{enable:!0,mask:255,func:{cmp:"<=",ref:254,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}});const h={viewport:a,stencil:{enable:!0,mask:255,func:{cmp:"==",ref:254,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!1}};o.push(...Rt$4.getUniformDeclares()),this.Xo=new rt$6({vert:"#define SHADER_NAME WATER\nuniform mat4 modelMatrix;\nuniform mat4 projViewModelMatrix;\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform vec2 uvOffset;\nuniform vec2 noiseUvOffset;\nuniform vec2 uvScale;\nvarying vec2 vUv;\nvarying vec2 vNoiseUv;\nvarying vec3 vPos;\nvarying mat3 vTbnMatrix;\n#ifdef HAS_SSR\nuniform mat4 modelViewMatrix;\nvarying vec4 vViewVertex;\n#endif\n#include <highlight_vert>\nmat3 c(in vec3 d) {\n  vec3 t = normalize(cross(d, vec3(.0, 1., .0)));\n  vec3 e = normalize(cross(d, t));\n  return mat3(t, e, d);\n}\n#if defined(HAS_SHADOWING)\n#include <vsm_shadow_vert>\n#endif\nconst vec3 f = vec3(0., 0., 1.);\nvoid main(void) {\n  vec4 h = vec4(aPosition, 1.);\n  vec4 i = modelMatrix * h;\n  vPos = i.xyz;\n  vTbnMatrix = c(f);\n  gl_Position = projViewModelMatrix * h;\n  vUv = aTexCoord * uvScale + uvOffset;\n  vNoiseUv = aTexCoord * uvScale * TIME_NOISE_TEXTURE_REPEAT + noiseUvOffset;\n#ifdef HAS_SSR\nvec4 j = modelViewMatrix * h;\n  vViewVertex = j;\n#endif\n#if defined(HAS_SHADOWING)\nshadow_computeShadowPars(h);\n#endif\nhighlight_setVarying();\n}",frag:"#define SHADER_NAME WATER\nprecision highp float;\nprecision highp sampler2D;\n#include <hsv_frag>\nuniform vec3 hsv;\nuniform float contrast;\n#if defined(HAS_SHADOWING)\n#include <vsm_shadow_frag>\n#endif\n#include <highlight_frag>\n#if defined(HAS_IBL_LIGHTING)\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform sampler2D brdfLUT;\nuniform float rgbmRange;\nuniform mat3 uEnvironmentTransform;\nuniform vec3 diffuseSPH[9];\nvec3 c(const in vec3 d) {\n  vec3 e = uEnvironmentTransform * d;\n  float x = e.x;\n  float y = e.y;\n  float z = e.z;\n  vec3 f = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    f = hsv_apply(f, hdrHSV);\n  }\n  return max(f, vec3(.0));\n}\nvec3 h(const in vec3 i, const in float j, const in float k, const in float l) {\n  vec4 rgba = texture2D(brdfLUT, vec2(k, j));\n  float b = (rgba[3] * 65280.0 + rgba[2] * 255.);\n  float a = (rgba[1] * 65280.0 + rgba[0] * 255.);\n  const float m = 1. / 65535.;\n  return (i * a + b * l) * m;\n}\n#else\nuniform vec3 ambientColor;\n#endif\nstruct PBRShadingWater {\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float VdotH;\n  float LdotH;\n  float VdotN;\n};\nvec3 o(const in vec4 u, const in float v) {\n  if(v <= .0)\n    return u.rgb;\n  return v * u.rgb * u.a;\n}\n#ifdef HAS_SSR\nvarying vec4 vViewVertex;\nuniform mat3 modelViewNormalMatrix;\nuniform sampler2D TextureDepth;\nuniform highp vec2 outSize;\nuniform float ssrFactor;\nuniform float ssrQuality;\nuniform sampler2D TextureReflected;\nuniform highp mat4 projMatrix;\nuniform mat4 invProjMatrix;\nuniform vec4 outputFovInfo[2];\nuniform mat4 reprojViewProjMatrix;\nuniform vec2 cameraNearFar;\nfloat A(const in vec4 B) {\n  return B.r + B.g / 255.;\n}\nfloat C(const in vec2 D, const in float E) {\n  vec3 F = vec3(.06711056, .00583715, 52.9829189);\n  return fract(F.z * fract(dot(D.xy + E * vec2(47., 17.) * .695, F.xy))) * .5;\n}\nvec3 G(const in float H, const in float I, const in vec2 J) {\n  float K = min(I - .01, H);\n  float L = floor(K);\n  float M = min(I, L + 1.);\n  float N = pow(2., M);\n  vec2 O = 2. * N / J;\n  if(K - L > .5)\n    N *= 2.;\n  return vec3(O, N);\n}\nvec2 P(const in vec2 Q, const in vec3 R) {\n  vec2 S = max(R.xy, min(1. - R.xy, Q));\n  return vec2(2. * S.x, R.z - 1. - S.y) / R.z;\n}\nvec3 T(const in mat4 U, const in vec3 V) {\n  vec4 W = U * vec4(V, 1.);\n  return vec3(.5 + .5 * W.xy / W.w, W.w);\n}\nvec3 X(const in float Y, const in vec2 S) {\n  return texture2D(TextureReflected, S).rgb;\n}\nfloat Z(float ba) {\n  highp mat4 U = projMatrix;\n  highp float z = ba * 2. - 1.;\n  return -U[3].z / (z + U[2].z);\n}\nfloat bb(const vec2 S) {\n  float ba = A(texture2D(TextureDepth, S));\n  return ba;\n}\nvec3 bc(const in float E, const in vec3 bd, const in vec3 be, const in vec3 bf, const in vec3 bg, const in float bh) {\n  vec2 bi;\n  bi.x = C(gl_FragCoord.yx, E);\n  bi.y = fract(bi.x * 52.9829189);\n  bi.y = mix(bi.y, 1., .7);\n  float bj = 2. * 3.14159 * bi.x;\n  float bk = pow(max(bi.y, .000001), bh / (2. - bh));\n  float bl = sqrt(1. - bk * bk);\n  vec3 bm = vec3(bl * cos(bj), bl * sin(bj), bk);\n  bm = bm.x * bd + bm.y * be + bm.z * bf;\n  return normalize((2. * dot(bg, bm)) * bm - bg);\n}\nfloat bn(const in float E) {\n  return (C(gl_FragCoord.xy, E) - .5);\n}\nvec3 bo(const in vec3 bp, const in float bq, const in vec3 br) {\n  vec3 bs = T(projMatrix, vViewVertex.xyz + br * bq);\n  bs.z = 1. / bs.z;\n  bs -= bp;\n  float bt = min(1., .99 * (1. - bp.x) / max(1e-5, bs.x));\n  float bu = min(1., .99 * (1. - bp.y) / max(1e-5, bs.y));\n  float bv = min(1., .99 * bp.x / max(1e-5, -bs.x));\n  float bw = min(1., .99 * bp.y / max(1e-5, -bs.y));\n  return bs * min(bt, bu) * min(bv, bw);\n}\nfloat bx(const in vec3 bp, const in vec3 bs, inout float by, inout float bz) {\n  float bA = (bz + by) * .5;\n  vec3 bB = bp + bs * bA;\n  float z = bb(bB.xy);\n  float ba = Z(z);\n  float bC = -1. / bB.z;\n  by = ba > bC ? by : bA;\n  bz = ba > bC ? bA : bz;\n  return bA;\n}\nvec4 bD(const in vec3 bp, const in float bq, in float bE, const in vec3 br, const in float j, const in float E) {\n  const int bF = 20;\n  float bG = 1. / float(bF);\n  bE *= bG;\n  vec3 bs = bo(bp, bq, br);\n  float bH = bG;\n  vec3 bI = vec3(.0, bH, 1.);\n  vec3 bB;\n  float z, ba, bC, bJ, bK, bL;\n  bool bM;\n  float bN = 1.;\n  float bA;\n  for(int bO = 0; bO < bF; bO++) {\n    bB = bp + bs * bI.y;\n    z = bb(bB.xy);\n    ba = Z(z);\n    bC = -1. / bB.z;\n    bJ = bC - ba;\n    bJ *= clamp(sign(abs(bJ) - bq * bG * bG), .0, 1.);\n    bM = abs(bJ + bE) < bE;\n    bK = clamp(bI.x / (bI.x - bJ), .0, 1.);\n    bL = bM ? bI.y + bK * bG - bG : 1.;\n    bI.z = min(bI.z, bL);\n    bI.x = bJ;\n    if(bM) {\n      float by = bI.y - bG;\n      float bz = bI.y;\n      bA = bx(bp, bs, by, bz);\n      bA = bx(bp, bs, by, bz);\n      bA = bx(bp, bs, by, bz);\n      bN = bA;\n      break;\n    }\n    bI.y += bG;\n  }\n  return vec4(bp + bs * bN, 1. - bN);\n}\nvec3 bP(in vec4 bQ, const in float bR, const in vec3 bS, const in vec3 bT, const in float j) {\n  vec4 bU = mix(outputFovInfo[0], outputFovInfo[1], bQ.x);\n  bQ.xyz = vec3(mix(bU.xy, bU.zw, bQ.y), 1.) * -1. / bQ.z;\n  bQ.xyz = (reprojViewProjMatrix * vec4(bQ.xyz, 1.)).xyw;\n  bQ.xy /= bQ.z;\n  float bV = clamp(6. - 6. * max(abs(bQ.x), abs(bQ.y)), .0, 1.);\n  bQ.xy = .5 + .5 * bQ.xy;\n  return vec3(bQ.xy, 1.);\n}\nvec3 ssr(const in vec3 bS, const in vec3 bT, const in float j, const in vec3 d, const in vec3 bg) {\n  float bW = .0;\n  vec4 f = vec4(.0);\n  float bh = j * j;\n  bh = bh * bh;\n  vec3 bX = abs(d.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 bd = normalize(cross(bX, d));\n  vec3 be = cross(d, bd);\n  float bR = ssrFactor * clamp(-4. * dot(bg, d) + 3.8, .0, 1.);\n  bR *= clamp(4.7 - j * 5., .0, 1.);\n  vec3 bp = T(projMatrix, vViewVertex.xyz);\n  bp.z = 1. / bp.z;\n  vec3 br = bc(bW, bd, be, d, bg, bh);\n  float bq = mix(cameraNearFar.y + vViewVertex.z, -vViewVertex.z - cameraNearFar.x, br.z * .5 + .5);\n  float bE = .5 * bq;\n  vec4 bQ;\n  if(dot(br, d) > .001 && bR > .0) {\n    bQ = bD(bp, bq, bE, br, j, bW);\n    if(bQ.w > .0)\n      return bP(bQ, bR, bS, bT, j);\n    \n  }\n  return vec3(.0);\n}\n#endif\nconst vec3 bY = vec3(0., 0., 1.);\nuniform mat4 viewMatrix;\nuniform sampler2D normalTexture;\nuniform sampler2D heightTexture;\nuniform vec4 waveParams;\nuniform vec2 waterDir;\nuniform vec4 waterBaseColor;\nuniform vec3 lightDirection;\nuniform vec3 lightColor;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vUv;\nvarying vec2 vNoiseUv;\nvarying vec3 vPos;\nvarying mat3 vTbnMatrix;\nfloat bZ(vec3 e, float ca) {\n  float cb = max(.015, ca);\n  return max((e.x + e.y) * .3303545 / cb + .3303545, .0);\n}\nconst vec2 cc = vec2(6. / 25., 5. / 24.);\nvec2 cd(sampler2D ce, vec2 S) {\n  return 2. * texture2D(ce, S).rg - 1.;\n}\nfloat cf(vec2 S) {\n  return texture2D(heightTexture, S).b;\n}\nvec3 cg(sampler2D ce, vec2 S) {\n  return 2. * texture2D(ce, S).rgb - 1.;\n}\nfloat ch(vec2 S, float ci) {\n  return fract(ci);\n}\nfloat cj(vec2 S, float ci) {\n  float ck = ch(S, ci);\n  return 1. - abs(1. - 2. * ck);\n}\nvec3 cl(sampler2D cm, vec2 S, float ci, float cn) {\n  float co = waveParams[2];\n  float cp = waveParams[3];\n  vec2 cq = cd(cm, S) * co;\n  float ck = ch(S, ci + cn);\n  float cr = cj(S, ci + cn);\n  vec2 f = S;\n  f -= cq * (ck + cp);\n  f += cn;\n  f += (ci - ck) * cc;\n  return vec3(f, cr);\n}\nconst float cs = 7.77;\nvec3 ct(sampler2D cu, sampler2D cv, vec2 cw, vec2 cx, float ci) {\n  float ca = waveParams[0];\n  vec2 cy = ci * -cx;\n  float cz = cf(vNoiseUv) * cs;\n  vec3 cA = cl(cv, cw + cy, ci + cz, .0);\n  vec3 cB = cl(cv, cw + cy, ci + cz, .5);\n  vec3 cC = cg(cu, cA.xy) * cA.z;\n  vec3 cD = cg(cu, cB.xy) * cB.z;\n  vec3 cE = normalize(cC + cD);\n  cE.xy *= ca;\n  cE.z = sqrt(1. - dot(cE.xy, cE.xy));\n  return cE;\n}\nvec4 cF(vec2 cw, float cG) {\n  float cH = waveParams[1];\n  vec3 d = ct(normalTexture, heightTexture, cw * cH, waterDir, cG);\n  float cI = bZ(d, waveParams[0]);\n  return vec4(d, cI);\n}\nconst float cJ = 3.141592653589793;\nconst float cK = 1. / cJ;\nconst float cL = .3183098861837907;\nconst float cM = 1.570796326794897;\nconst float cN = .4;\nfloat cO = 2.2;\nvec3 cP(float cQ, vec3 cR, float l) {\n  return cR + (l - cR) * pow(1. - cQ, 5.);\n}\nfloat cS(float cT, float j) {\n  float cU = j * j;\n  float cV = cT * cT;\n  float cW = pow((cV * (cU - 1.) + 1.), cO) * cJ;\n  return cU / cW;\n}\nfloat cX(float cY) {\n  return .25 / (cY * cY);\n}\nvec3 cZ(const vec3 x) {\n  return (x * (2.51 * x + .03)) / (x * (2.43 * x + .59) + .14);\n}\nconst float da = 2.2;\nconst float db = .4545454545;\nvec4 dc(vec4 u) {\n  return vec4(pow(u.rgb, vec3(db)), u.w);\n}\nvec3 dd(vec3 u) {\n  return pow(u, vec3(da));\n}\nconst vec3 de = vec3(.02, 1., 5.);\nconst vec2 df = vec2(.02, .1);\nconst float j = .06;\nconst float dg = 1.7;\nconst vec3 dh = vec3(0, .6, .9);\nconst vec3 di = vec3(.72, .92, 1.);\nconst float dj = .65;\nconst float dk = 300000.0;\nconst float dl = 500000.0;\nconst float dm = .775;\nconst float dn = .8;\nPBRShadingWater dp;\nvec3 dq(in PBRShadingWater dr, float j, vec3 ds, float dt) {\n  vec3 du = cP(dr.VdotH, ds, dt);\n  float dv = cS(dr.NdotH, j);\n  float dw = cX(dr.LdotH);\n  float dx = mix(j + .045, j + .385, 1. - dr.VdotH);\n  float dy = 1.2;\n  float dz = cS(dr.NdotH, dx) * dy;\n  return ((dv + dz) * dw) * du;\n}\nvec3 dA(float dg, float dB, vec3 dh, float dC) {\n  return dg * (.075 * dh * pow(dB, 4.) + 50. * pow(dB, 23.)) * dC;\n}\nvec3 dD(in float bk, in vec3 dE, in vec3 dF) {\n  float dG = pow((1. - bk), de[2]);\n  return mix(dF, dE, dG);\n}\nvec3 dH(in vec3 e, in vec3 dI, in float dJ, in float j) {\n  \n#ifdef HAS_IBL_LIGHTING\nvec3 dK = reflect(-dI, e);\n  vec4 dL = textureCube(prefilterMap, uEnvironmentTransform * dK);\n  float dM = clamp(1. + dot(dK, e), .0, 1.);\n  dL *= dM * dM;\n  vec3 i = o(dL, rgbmRange);\n  vec3 dN = c(e);\n  float l = clamp(50.0 * waterBaseColor.g, .0, 1.);\n  vec3 dO = h(waterBaseColor.rgb, j, dot(e, dI), l);\n  return i * dO + dN;\n#else\nvec3 dP = dd(di);\n  vec3 dQ = dd(dh);\n  vec3 di = dD(dJ, dP, dQ);\n  return di;\n#endif\n}\nvec3 dR(in vec3 e, in vec3 dI, in vec3 dS, vec3 u, in vec3 dT, in vec3 dU, in float dV, float dW, vec3 dX) {\n  float dY = 0.;\n  vec3 dZ = dd(u);\n  vec3 bm = normalize(dS + dI);\n  dp.NdotL = clamp(dot(e, dS), .0, 1.);\n  dp.NdotV = clamp(dot(e, dI), .001, 1.);\n  dp.VdotN = clamp(dot(dI, e), .001, 1.);\n  dp.NdotH = clamp(dot(e, bm), .0, 1.);\n  dp.VdotH = clamp(dot(dI, bm), .0, 1.);\n  dp.LdotH = clamp(dot(dS, bm), .0, 1.);\n  float dJ = max(dot(dU, dI), .0);\n  vec3 di = dH(e, dI, dJ, j);\n  float ea = max(dot(dU, dS), .0);\n  float eb = .1 + ea * .9;\n  di *= eb;\n  float ec = clamp(dV, .8, 1.);\n  vec3 ed = cP(dp.VdotN, vec3(de[0]), de[1]);\n  vec3 ee = ed * di * ec;\n  vec3 ef = dZ * mix(di, ea * dT * cK, 2. / 3.) * ec;\n  vec3 i = vec3(.0);\n  if(dJ > .0 && ea > .0) {\n    vec3 eg = dq(dp, j, vec3(df[0]), df[1]);\n    vec3 eh = dT * cK * dV;\n    i = dp.NdotL * eh * eg;\n  }\n  vec3 cI = vec3(.0);\n  if(dJ > .0) {\n    cI = dA(dg, dW, dh, eb);\n  }\n  vec3 ei = vec3(.0);\n#ifdef HAS_SSR\nfloat ej = smoothstep(dl, dk, -dX.z);\n  mat4 ek = viewMatrix;\n  vec4 el = vec4(dX.xyz, 1.);\n  vec3 em = normalize(el.xyz);\n  vec4 en = ek * vec4(e, .0);\n  vec3 eo = normalize(en.xyz);\n  vec4 ep = ek * vec4(dU, .0);\n  float eq = pow(max(dot(-em, ep.xyz), .0), cN);\n  vec3 er = mix(ep.xyz, eo, eq);\n  vec3 es = ssr(vec3(.0), vec3(1.), j, normalize(er), -normalize(vViewVertex.xyz));\n  if(es.z > .0) {\n    vec2 et = smoothstep(.3, .6, abs(vec2(.5) - es.xy));\n    dY = dm * clamp(1. - 1.3 * et.y, .0, 1.) * ej;\n    vec3 eu = X(.0, es.xy);\n    ei = dd(eu) * dY * ed.y * dj;\n  }\n#endif\nfloat ev = mix(dn, dn * .5, dY);\n  return cZ((1. - dY) * ee + ei + ef * ev + i + cI);\n}\nvoid main() {\n  vec3 dU = bY;\n  vec4 ew = cF(vUv, timeElapsed);\n  vec3 e = normalize(vTbnMatrix * ew.xyz);\n  vec3 dI = -normalize(vPos - camPos);\n  vec3 dS = normalize(-lightDirection);\n#if defined(HAS_SHADOWING)\nfloat dV = shadow_computeShadow();\n#else\nfloat dV = 1.;\n#endif\nvec4 ex = viewMatrix * vec4(vPos, 1.);\n  vec4 ey = vec4(dR(e, dI, dS, waterBaseColor.rgb, lightColor, dU, dV, ew.w, ex.xyz), waterBaseColor.a);\n  gl_FragColor = dc(ey);\n  if(contrast != 1.) {\n    gl_FragColor = contrastMatrix(contrast) * gl_FragColor;\n  }\n  if(length(hsv) > .0) {\n    gl_FragColor = hsv_apply(gl_FragColor, hsv);\n  }\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}",defines:s,uniforms:o,extraCommandProps:h})}needClearStencil(){return!0}getUniformValues(t){return{projViewMatrix:t.projViewMatrix}}$o(t,e){const{iblTexes:i,dfgLUT:n}=this.getIBLRes(),r=Hr$1(t,i,n,e&&e.ssr,e&&e.jitter),o=t.getLightManager();let s=o&&o.getDirectionalLight()||{};const l=o&&o.getAmbientLight()||{},h=this.getSymbol(Ur$2),c=this.rs=this.rs||[],u=this.os=this.os||[];return set$3(u,.09,h.uvScale||3,.03,-.5),he$2(r,{ambientColor:l.color||[.2,.2,.2],viewMatrix:t.viewMatrix,lightDirection:s.direction||Vr$1.direction,lightColor:s.color||Vr$1.color,camPos:t.cameraPosition,timeElapsed:h.animation?(this.layer.getRenderer().getFrameTimestamp()||0)/(1/(h.waterSpeed||1)*1e4):0,normalTexture:this.ts||this.Ko,heightTexture:this.ns||this.Ko,waveParams:u,waterDir:Wr$1(c,h.waterDirection||0),waterBaseColor:h.waterBaseColor||[.1451,.2588,.4863,1],contrast:h.contrast||1,hsv:h.hsv||qr$1}),this.setIncludeUniformValues(r,e),e&&e.ssr&&e.ssr.renderUniforms&&he$2(r,e.ssr.renderUniforms),r}delete(){super.delete(),this.Ko&&(this.Ko.destroy(),delete this.Ko),this.ts&&this.ts.destroy(),this.ns&&this.ns.destroy(),this.shader&&this.shader.dispose(),this.Xo&&this.Xo.dispose(),this.Jo&&(this.Jo.geometry.dispose(),this.Jo.material&&this.Jo.material.dispose(),this.Jo.dispose(),delete this.Jo),this.disposeIBLTextures()}createGround(){const t=new Xe$4;t.data.aTexCoord=new Uint8Array([0,1,1,1,0,0,1,0]),t.generateBuffers(this.renderer.regl),this.Jo=new de$4(t,null,{castShadow:!1}),this.Yo=new pe$4([this.Jo])}transformWater(){const t=this.getMap(),e=y$5.getGroundTransform(this.Jo.localTransform,t);this.Jo.setLocalTransform(e);const i=t._get2DExtentAtRes(t.getGLRes()),n=i.getWidth(),r=i.getHeight(),s=t.cameraLookAt,h=this.Qo,c=(s[0]-n)/h[0],u=(s[1]+r)/h[1],d=c%1,f=u%1,p=.3737*c%1,m=.3737*u%1,y=i.getWidth()/h[0]*2,g=i.getHeight()/h[1]*2;this.Jo.setUniform("uvOffset",[d,f]),this.Jo.setUniform("noiseUvOffset",[p,m]),this.Jo.setUniform("uvScale",[y,-g])}}function Wr$1(t,e){return e=Math.PI*e/180,t[0]=Math.sin(e),t[1]=Math.cos(e),t}const Br$1=ae$2("fill",Ke$2);Br$1.registerAt(vt$2);const $r$1=ae$2("line",ti$1);$r$1.registerAt(vt$2);const Xr$1=ae$2("line-gradient",ei$1);Xr$1.registerAt(vt$2);const Yr$1=ae$2("icon",kn$1);Yr$1.registerAt(vt$2);const Jr$1=ae$2("text",ar$2);Jr$1.registerAt(vt$2);const Zr$1=ae$2("native-line",pr$2);Zr$1.registerAt(vt$2),ae$2("native-point",dr$2).registerAt(vt$2);const Kr$1=ae$2("phong",wr$2);Kr$1.registerAt(vt$2);const Qr$1=ae$2("wireframe",kr$1);Qr$1.registerAt(vt$2);const to$1=ae$2("lit",Sr$2);to$1.registerAt(vt$2);const eo$1=ae$2("tube",Pr$1);eo$1.registerAt(vt$2);const io$1=ae$2("gltf-phong",Nr$2);io$1.registerAt(vt$2);const no$1=ae$2("gltf-lit",Lr$1);no$1.registerAt(vt$2);const ro$1=ae$2("heatmap",class extends Xe$2{createFnTypeConfig(t,e){const i=interpolated(e.heatWeight),n=new Int16Array(1);return[{attrName:"aWeight",symbolName:"heatWeight",type:Uint8Array,size:1,evaluate:e=>{const r=i(t.getZoom(),e);return n[0]=r,n[0]}}]}createMesh(t,e){const{geometry:n,symbolIndex:r,ref:o}=t;void 0===o&&Te$2(n,this.getSymbolDef(r),this.getFnTypeConfig(r));const s=this.getSymbol(r),a={tileRatio:n.properties.tileRatio,dataResolution:n.properties.tileResolution};pe$2(a,"heatmapIntensity",s,"heatmapIntensity",1),pe$2(a,"heatmapRadius",s,"heatmapRadius",6),pe$2(a,"heatmapWeight",s,"heatmapWeight",1),pe$2(a,"heatmapOpacity",s,"heatmapOpacity",1),n.generateBuffers(this.regl);const l=new ee$3(a),h=new de$4(n,l,{transparent:!0,castShadow:!1,picking:!0}),c={};return n.data.aWeight&&(c.HAS_HEAT_WEIGHT=1),h.setDefines(c),h.setLocalTransform(e),h.properties.symbolIndex=r,h}callRenderer(t,e,i){const n=this.getRenderFBO(i);this.ss.render(this.scene,e,n)}getUniformValues(t){const e=this.getSymbol({index:0}),{projViewMatrix:i}=t;return{glScale:1/t.getGLScale(),resolution:t.getResolution(),projViewMatrix:i,heatmapOpacity:e.heatmapOpacity}}getHeatmapMeshes(){return this.scene.getMeshes()}delete(){super.delete(...arguments),this.ss.dispose(),delete this.ss}init(){this.renderer=new k$7(this.regl);const e=this.layer.getRenderer().isEnableTileStencil(),n={enable:!0,mask:255,func:{cmp:()=>e?"=":"<=",ref:(t,i)=>e?i.stencilRef:i.level,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},r=this.getPolygonOffset(),o=this.getSymbols()[0];this.ss=new Ft$4(this.regl,this.sceneConfig,this.layer,o.heatmapColor,n,r)}});ro$1.registerAt(vt$2);const oo$1=ae$2("water",Gr$1);if(oo$1.registerAt(vt$2),It$2.registerPainter("lit",Sr$2),It$2.registerPainter("icon",kn$1),It$2.registerPainter("fill",Ke$2),It$2.registerPainter("line",ti$1),It$2.registerPainter("line-gradient",ei$1),It$2.registerPainter("water",Gr$1),It$2.registerPainter("tube",Pr$1),We$4.register("vt_position_vert","#ifdef HAS_ALTITUDE\n    vec3 unpackVTPosition() {\n        return vec3(aPosition, aAltitude);\n    }\n#else\n    float position_modValue = 16384.0;\n    float position_delta = 0.00001;\n    vec3 unpackVTPosition() {\n        float z = aPosition.z;\n        vec2 pos = sign(aPosition.xy + position_delta) * mod(abs(aPosition.xy), position_modValue);\n        vec2 highs = floor(abs(aPosition.xy) / position_modValue);\n        float altitude = sign(z + position_delta) * (highs.x * 2.0 + highs.y) * pow(2.0, 15.0) + z;\n        return vec3(pos, altitude);\n    }\n#endif"),vt$2.VERSION="0.74.2",It$2.VERSION="0.74.2",create$5(),transcoders){const i=t__namespace.Map.VERSION;if(i.indexOf("1.0.0-beta")>=0||i.indexOf("1.0.0-alpha")>=0){const i=transcoders.inject(D$5);t__namespace.registerWorkerAdapter("@maptalks/vt",i)}else t__namespace.registerWorkerAdapter("@maptalks/vt",(function(){return transcoders.inject(D$5)}))}else t__namespace.registerWorkerAdapter("@maptalks/vt",D$5);"undefined"!=typeof console&&console.log("@maptalks/vt v0.74.2");for(
/*!
	* Contains code from THREE.js
	* MIT License
	* https://github.com/mrdoob/three.js
	*/
var planes$1=[],i$2=0;i$2<6;i$2++)planes$1[i$2]=[];var p$6=[];function intersectsBox$1(matrix,box,mask){setPlanes$1(matrix);for(var i=0;i<6;i++)if(!mask||"0"!==mask.charAt(i)){var plane=planes$1[i];if(p$6[0]=plane[0]>0?box[1][0]:box[0][0],p$6[1]=plane[1]>0?box[1][1]:box[0][1],p$6[2]=plane[2]>0?box[1][2]:box[0][2],distanceToPoint$1(plane,p$6)<0)return!1}return!0}function intersectsPlane(plane,box){var center=box,halfAxes=box,normalX=plane[0],normalY=plane[1],normalZ=plane[2],radEffective=Math.abs(normalX*halfAxes[3]+normalY*halfAxes[6]+normalZ*halfAxes[9])+Math.abs(normalX*halfAxes[4]+normalY*halfAxes[7]+normalZ*halfAxes[10])+Math.abs(normalX*halfAxes[5]+normalY*halfAxes[8]+normalZ*halfAxes[11]),distanceToPlane=distanceToPoint$1(plane,center);return!(distanceToPlane<=-radEffective)}function setPlanes$1(m){var me0=m[0],me1=m[1],me2=m[2],me3=m[3],me4=m[4],me5=m[5],me6=m[6],me7=m[7],me8=m[8],me9=m[9],me10=m[10],me11=m[11],me12=m[12],me13=m[13],me14=m[14],me15=m[15];setComponents$1(planes$1[0],me3-me0,me7-me4,me11-me8,me15-me12),setComponents$1(planes$1[1],me3+me0,me7+me4,me11+me8,me15+me12),setComponents$1(planes$1[2],me3+me1,me7+me5,me11+me9,me15+me13),setComponents$1(planes$1[3],me3-me1,me7-me5,me11-me9,me15-me13),setComponents$1(planes$1[4],me3-me2,me7-me6,me11-me10,me15-me14),setComponents$1(planes$1[5],me3+me2,me7+me6,me11+me10,me15+me14)}function setComponents$1(out,x,y,z,w){var inverseNormalLength=1/Math.sqrt(x*x+y*y+z*z);return out[0]=x*inverseNormalLength,out[1]=y*inverseNormalLength,out[2]=z*inverseNormalLength,out[3]=w*inverseNormalLength,out}function distanceToPoint$1(plane,p){return plane[0]*p[0]+plane[1]*p[1]+plane[2]*p[2]+plane[3]}
/*!
	 * @maptalks/3dtiles v0.18.2
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.org
	 */const m$4='function(t){var e=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function s(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],f=e[6],u=e[7],l=e[8],E=e[9],_=e[10],A=e[11],h=e[12],T=e[13],R=e[14],y=e[15],I=r[0],N=r[1],U=r[2],S=r[3];return t[0]=I*n+N*a+U*l+S*h,t[1]=I*i+N*c+U*E+S*T,t[2]=I*s+N*f+U*_+S*R,t[3]=I*o+N*u+U*A+S*y,I=r[4],N=r[5],U=r[6],S=r[7],t[4]=I*n+N*a+U*l+S*h,t[5]=I*i+N*c+U*E+S*T,t[6]=I*s+N*f+U*_+S*R,t[7]=I*o+N*u+U*A+S*y,I=r[8],N=r[9],U=r[10],S=r[11],t[8]=I*n+N*a+U*l+S*h,t[9]=I*i+N*c+U*E+S*T,t[10]=I*s+N*f+U*_+S*R,t[11]=I*o+N*u+U*A+S*y,I=r[12],N=r[13],U=r[14],S=r[15],t[12]=I*n+N*a+U*l+S*h,t[13]=I*i+N*c+U*E+S*T,t[14]=I*s+N*f+U*_+S*R,t[15]=I*o+N*u+U*A+S*y,t}function a(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function c(){var t=new r(3);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function f(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function u(t,e,n){var i=new r(3);return i[0]=t,i[1]=e,i[2]=n,i}function l(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function E(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function _(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function A(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function h(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function T(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function R(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)}function y(t,e){var r=e[0],n=e[1],i=e[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function I(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function N(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[0],a=r[1],c=r[2];return t[0]=i*c-s*a,t[1]=s*o-n*c,t[2]=n*a-i*o,t}function U(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[3]*n+r[7]*i+r[11]*s+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/o,t[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/o,t}var S=A,d=h,m=f;function O(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function M(){var t=new r(4);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function F(t,r,n,i){var s=r[0],o=r[1],a=r[2],c=r[3],f=n[0],u=n[1],l=n[2],E=n[3],_=void 0,A=void 0,h=void 0,T=void 0,R=void 0;return(A=s*f+o*u+a*l+c*E)<0&&(A=-A,f=-f,u=-u,l=-l,E=-E),1-A>e?(_=Math.acos(A),h=Math.sin(_),T=Math.sin((1-i)*_)/h,R=Math.sin(i*_)/h):(T=1-i,R=i),t[0]=T*s+R*f,t[1]=T*o+R*u,t[2]=T*a+R*l,t[3]=T*c+R*E,t}c(),function(){var t,e=(t=new r(4),r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var C,b=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};c(),u(1,0,0),u(0,1,0),M(),M(),C=new r(9),r!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1;\n/*!\n   * @maptalks/gltf-loader v0.27.1\n   * LICENSE : UNLICENSED\n   * (c) 2016-2022 maptalks.org\n   */\nlet p=0;function w(t){return null==t}function D(t){return!w(t)}function B(t){for(let e=1;e<arguments.length;e++){const r=arguments[e];for(const e in r)t[e]=r[e]}return t}function L(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView\'s component type: "+t)}function P(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function g(t){const e=function(t){return"undefined"!=typeof self?self.atob(t):window.atob(t)}(t.substring(t.indexOf(",")+1)),r=e.length,n=new Uint8Array(r);for(let t=0;t<r;t++)n[t]=e.charCodeAt(t);return n.buffer}const G=[],v=[],X=[],H=[0,0,0],x=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),V=[1,1,1];function k(t,e,r,n,i,s,o){const a=L(o);if((0===i||i===n*a.BYTES_PER_ELEMENT)&&s%a.BYTES_PER_ELEMENT==0){const i=new a(e,s,r*n);return t.set(i),t}0===i&&(i=n*a.BYTES_PER_ELEMENT);const c=new Uint8Array(n*a.BYTES_PER_ELEMENT);for(let o=0;o<r;o++){let r=null;const f=new Uint8Array(e,i*o+s,n*a.BYTES_PER_ELEMENT);c.set(f),r=new a(c.buffer,0,n);for(let e=0;e<n;e++)t[o*n+e]=r[e]}return t}const Z="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function Y(t,e,r){const n=new Uint8Array(t,e,r);return Z.decode(n)}const K={get:function(t,e={}){e||(e={});const r=new AbortController,n=r.signal,i=B({},e);i.signal=n,i.method||(i.method="GET");const s=fetch(t,i).then((t=>{const r=this.t(t,e.responseType);return r.message?r:r.then((r=>"arraybuffer"===e.responseType?{data:r,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:r)).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}))})).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}));return s.xhr=r,s},t:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={})=>(e||(e={}),e.responseType="arraybuffer",K.get(t,e)),getJSON:function(t,e={}){return e&&e.jsonp?K.jsonp(t):((e=e||{}).responseType="json",K.get(t,e))},jsonp:function(t){const e="_maptalks_jsonp_"+p++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let r=document.createElement("script");return r.type="text/javascript",r.src=t,new Promise((t=>{window[e]=function(n){document.getElementsByTagName("head")[0].removeChild(r),r=null,delete window[e],t(n)},document.getElementsByTagName("head")[0].appendChild(r)}))}};class z{constructor(t,e,r){this.i=t,this.decoders=e,this.o=r,this.images={},this.u={}}requestImageFromBufferURI(t,e,r){if(this.buffers[t.id]){const n=this.buffers[t.id],i=this.l(e,n);return this.getImageByBuffer(i,r)}if(this.u[t.id])return this.u[t.id].then((()=>{const n=this.buffers[t.id],i=this.l(e,n);return this.getImageByBuffer(i,r)}));if(P(t.uri)){const n=this.buffers[t.id]=g(t.uri),i=this.l(e,n);return this.getImageByBuffer(i,r)}return this.u[t.id]=K.getArrayBuffer(t.uri,null).then((n=>{const i=this.buffers[t.id]=n.data,s=this.l(e,i);return this.getImageByBuffer(s,r)}))}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const r=this.decoders;if(r[e.mimeType])return r[e.mimeType](t,{supportedFormats:this.o});if("image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType)return console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null);{const r=new Blob([t],{type:e.mimeType}),n=URL.createObjectURL(r);return this._(e.id,n)}}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this.u[t.id]?this.u[t.id].then((()=>this.images[t.id])):this.u[t.id]=this._(t.id,e)}_(t,e){return new Promise(((r,n)=>{this.i(e,((i,s)=>{i?n(i):(URL.revokeObjectURL(e),this.images[t]=s,r(this.images[t]))}))}))}}const W=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16];class j{constructor(t,e,r){this.rootPath=t,this.gltf=e,this.A=!1,this.glbBuffer=r,this.buffers={},this.requests={},this.accessors={},this.h()}T(t,e){const r=this.gltf,n=r.accessors[e];if(void 0===n.bufferView)return this.accessors[n.id]=this.I(t,e,null,0),Promise.resolve(this.accessors[n.id]);if(n&&this.accessors[n.id])return Promise.resolve(this.accessors[n.id]);const i=r.bufferViews[n.bufferView];return this.N(i).then((r=>{const{buffer:i,byteOffset:s}=r;return this.accessors[n.id]=this.I(t,e,i,s)}))}N(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id]){const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}if(this.requests[e.id])return this.requests[e.id].then((()=>{const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}));if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(P(e.uri)){const t=this.buffers[e.id]=g(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const r=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||r?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=K.getArrayBuffer(t,null).then((n=>(r&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=n.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}I(t,e,r,n=0){const i=this.gltf,s=i.accessors[e],o=void 0!==s.bufferView?i.bufferViews[s.bufferView]:{},a=(o.byteOffset||0)+n,c=this.U(s.type),f=L(s.componentType),u=o.byteStride||0,l={array:void 0,name:t,accessorName:e,byteLength:s.count*c*f.BYTES_PER_ELEMENT,componentType:s.componentType,count:s.count,type:s.type,itemSize:c};if(s.min&&(l.min=s.min),s.max&&(l.max=s.max),r)if(this.A)l.byteStride=u,l.byteOffset=a+(s.byteOffset||0),!u||u===c*f.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(l.array=this.S(r,s.count,c,a+(s.byteOffset||0),f),l.array.buffer.byteLength===l.byteLength&&(l.byteOffset=0)):l.array=new Uint8Array(r,a,o.byteLength);else if(s.interleaved){l.byteStride=0,l.byteOffset=0;const t=new f(s.count*c);l.array=k(t,r,s.count,c,u,a+(s.byteOffset||0),s.componentType)}else l.byteStride=0,l.array=this.S(r,s.count,c,a+(s.byteOffset||0),f),l.byteOffset=l.array.byteOffset;else{l.array=new f(s.count);const t=l.min||l.max;t&&(l.array[0]=t[0],l.array[1]=t[1],l.array[2]=t[2])}return l}h(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let r=0;r<t.length;r++)e!==r&&t[e].bufferView===t[r].bufferView&&(t[e].interleaved=t[r].interleaved=!0);else for(const e in t)for(const r in t)e!==r&&t[e].bufferView===t[r].bufferView&&(t[e].interleaved=t[r].interleaved=!0)}S(t,e,r,n,i){return n%i.BYTES_PER_ELEMENT!=0&&(t=t.slice(n,n+e*r*i.BYTES_PER_ELEMENT),n=0),new i(t,n,r*e)}U(t){const e=W.indexOf(t);return W[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,r=e.map((t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:r}=e;return this.N(e).then((n=>{const{buffer:i,byteOffset:s}=n,o=Y(i,s+(e.byteOffset||0),r);return t.content=o,t}))}if(t.uri){if(P(t.uri)){const e=g(t.uri),r=Y(e,0,e.byteLength);return t.content=r,Promise.resolve(t)}{const e=this.rootPath+"/"+t.uri;return K.get(e).then((e=>(t.content=e,t)))}}return Promise.resolve(t)}));return Promise.all(r).then((()=>t))}}class q extends z{constructor(t,e,r,n,i,s){super(n,i,s),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=r,this.accessor=new j(t,e,r)}iterate(t,e){const r=this.gltf[e];if(!r)return;let n=0;for(const e in r)t(e,r[e],n++)}createNode(t){const e={};if(D(t.name)&&(e.name=t.name),D(t.children)&&(e.children=t.children),D(t.jointName)&&(e.jointName=t.jointName),D(t.matrix)&&(e.matrix=t.matrix),D(t.rotation)&&(e.rotation=t.rotation),D(t.scale)&&(e.scale=t.scale),D(t.translation)&&(e.translation=t.translation),D(t.extras)&&(e.extras=t.extras),D(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const r=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(G,e.translation||H),n=function(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r+r,a=n+n,c=i+i,f=r*o,u=n*o,l=n*a,E=i*o,_=i*a,A=i*c,h=s*o,T=s*a,R=s*c;return t[0]=1-l-A,t[1]=u+R,t[2]=E-T,t[3]=0,t[4]=u-R,t[5]=1-f-A,t[6]=_+h,t[7]=0,t[8]=E+T,t[9]=_-h,t[10]=1-f-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(v,e.rotation||x),i=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(X,e.scale||V);return o(i,n,i),o(t,r,i)}return s(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}m(t){const e={};for(const r in t){const n=t[r];let i,s;n.instanceTechnique&&n.instanceTechnique.values?(i=n.instanceTechnique,s=i.values.diffuse):(i=n,s=i.values.tex||i.values.diffuseTex||i.values.diffuse);const o={baseColorTexture:{index:s}};n.name&&(o.name=n.name),n.extensions&&(o.extensions=n.extensions),n.extras&&(o.extras=n.extras),e[r]=o}return e}O(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const r=this.gltf.bufferViews[e.bufferView],n=(r.byteOffset||0)+this.glbBuffer.byteOffset,i=r.byteLength,s=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,n,i);return this.getImageByBuffer(s,t)}return this.requestExternalImage(t)}M(t){const e=this.gltf.textures[t];if(!e)return null;const r=this.gltf.images[e.source];return this.O(r).then((t=>{const n=this.gltf.samplers[e.sampler];return{image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:r.mimeType,name:r.name,extras:r.extras},sampler:n}}))}getBaseColorTexture(t){const e=this.gltf.materials[t];let r,n;if(e.instanceTechnique&&e.instanceTechnique.values?(r=e.instanceTechnique,n=r.values.diffuse):(r=e,n=r.values.tex||r.values.diffuseTex||r.values.diffuse),void 0===n||void 0===this.gltf.textures)return null;const i=this.gltf.textures[n];if(!i)return null;const s=this.gltf.samplers[i.sampler];return{format:i.format||6408,internalFormat:i.internalFormat||6408,type:i.type||5121,sampler:s,source:this.gltf.images[i.source]}}getMaterial(){return null}getAnimations(){return null}}class $ extends z{constructor(t,e,r,n,i,s){super(n,i,s),this.rootPath=t,this.gltf=e,this.glbBuffer=r,this.buffers={},this.requests={},this.accessor=new j(t,e,r)}iterate(t,e){const r=this.gltf[e];if(r)for(let e=0;e<r.length;e++)t(e,r[e],e)}createNode(t){const e={};return B(e,t),!D(t.weights)&&this.gltf.meshes&&D(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}M(t){const e=this.gltf.textures[t];if(!e)return null;const r=this.gltf.images[e.source];return this.O(r).then((t=>{if(!t)return null;const n={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:r.mimeType,name:r.name,extensions:r.extensions,extras:r.extras}};B(n,e);const i=D(e.sampler)?this.gltf.samplers[e.sampler]:void 0;return i&&(n.sampler=i),t.format&&(n.format=t.format),n}))}O(t){if(!D(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],r=this.gltf.buffers[e.buffer];if(r.uri)return this.requestImageFromBufferURI(r,e,t);if(this.glbBuffer)return this.F(e,t)}return null}F(t,e){const r=this.l(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(r,e)}l(t,e,r){r=r||0;const n=t.byteOffset+r,i=t.byteLength;return new Uint8Array(e,n,i)}C(t,e){const r=new Array(t.byteLength);for(let e=0;e<t.byteLength;e++)r[e]=String.fromCharCode(t[e]);return r.join(""),"data:"+(e=e||"image/png")+";base64,"+function(t){return"undefined"!=typeof self?self.btoa(t):window.btoa(t)}(unescape(encodeURIComponent(r)))}getAnimations(t){const e=[];return t.forEach((t=>{e.push(this.getSamplers(t.samplers))})),Promise.all(e).then((e=>{for(let r=0;r<e.length;r++)t[r].samplers=e[r];return t}))}getSamplers(t){const e=[];for(let r=0;r<t.length;r++)(D(t[r].input)||D(t[r].output))&&(e.push(this.accessor.T("input",t[r].input)),e.push(this.accessor.T("output",t[r].output)));return Promise.all(e).then((e=>{for(let r=0;r<e.length/2;r++)t[r].input=e[2*r],t[r].output=e[2*r+1],t[r].interpolation||(t[r].interpolation="LINEAR");return t}))}}const J="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class Q{static read(t,e=0,r=0){r||(r=t.byteLength);const n=new DataView(t,e,r),i=n.getUint32(4,!0);if(1===i)return Q.readV1(n,e);if(2===i)return Q.readV2(t,e);throw new Error("Unsupported glb version : "+i)}static readV1(t,e){const r=t.getUint32(8,!0),n=t.getUint32(12,!0);if(r!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb\'s byte length.");const i=tt(t.buffer,20+e,n);return{json:JSON.parse(i),glbBuffer:{byteOffset:20+e+n,buffer:t.buffer,byteLength:r}}}static readV2(t,e){let r,n,i;const s=new DataView(t,e+12);let o=0;for(;o<s.byteLength;){const a=s.getUint32(o,!0);o+=4;const c=s.getUint32(o,!0);if(o+=4,1313821514===c)r=tt(t,e+12+o,a);else if(5130562===c){i=e+12+o,n=a;break}o+=a}return{json:JSON.parse(r),glbBuffer:{byteOffset:i,buffer:t,byteLength:n}}}}function tt(t,e,r){if(J){const n=new Uint8Array(t,e,r);return J.decode(n)}return function(t){const e=t.length;let r="";for(let n=0;n<e;){let i=t[n++];if(128&i){let r=et[i>>3&7];if(!(64&i)||!r||n+r>e)return null;for(i&=63>>r;r>0;r-=1){const e=t[n++];if(128!=(192&e))return null;i=i<<6|63&e}}r+=String.fromCharCode(i)}return r}(new Uint8Array(t,e,r))}const et=[1,1,1,1,2,2,3,0],rt=[0,0,0],nt=[0,0,0,1],it=[1,1,1],st={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},ot={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},at={p(t,e,r,n,i,s,o,a){const c=D(t)?e.animations:[e.animations[0]],f={};for(let e=0;e<c.length;e++){const u=c[e],E=u.name||e;if(D(t)&&E!==t)continue;const _=u.channelsMap[r];if(_)for(let t=0;t<_.length;t++){const e=_[t];"translation"===e.target.path?(this.D(i,u.samplers[e.sampler],n,1),f.translation=l(rt,i)):"rotation"===e.target.path?(this.B(s,u.samplers[e.sampler],n,1),f.rotation=b(nt,s)):"scale"===e.target.path?(this.D(o,u.samplers[e.sampler],n,1),f.scale=l(it,o)):"weights"===e.target.path&&a&&(this.D(a,u.samplers[e.sampler],n,a.length),f.weights=a)}}return f},D(t,e,r,n){switch(e.interpolation){case"LINEAR":{const i=this.L(ot,e,r,1*n);i&&(t=function(t,e,r,n){for(let i=0;i<t.length;i++)t[i]=e[i]+n*(r[i]-e[i]);return t}(t,i.PREVIOUS,i.NEXT,i.INTERPOLATION));break}case"STEP":{const i=this.L(ot,e,r,1*n);i&&(t=function(t,e){for(let r=0;r<t.length;r++)t[r]=e[r];return t}(t,...i.PREVIOUS));break}case"CUBICSPLINE":{const i=this.L(ot,e,r,3*n);i&&(t=this.P(t,i,e.input.array,3*n));break}}return t},B(t,e,r){switch(e.interpolation){case"LINEAR":{const n=this.L(ot,e,r,1);n&&F(t,n.PREVIOUS,n.NEXT,n.INTERPOLATION);break}case"STEP":{const n=this.L(ot,e,r,1);n&&(t=O(t,...n.PREVIOUS));break}case"CUBICSPLINE":{const n=this.L(ot,e,r,3);if(n){for(let t=0;t<n.PREVIOUS.length;t++)n.PREVIOUS[t]=Math.acos(n.PREVIOUS[t]),n.NEXT[t]=Math.acos(n.NEXT[t]);t=this.P(t,n,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},G(t,e){const r=t.length;let n,i,s,o=0,a=r-1,c=Math.floor((o+a)/2);for(;o<=r-1&&a>=0;){if(o===a)return null;if(t[c]<=e&&e<=t[c+1]){const r=t[c];return n=c,i=c+1,s=(e-r)/(t[c+1]-r),{preIndx:n,nextIndex:i,interpolation:s}}e<t[c]?(a=c,c=Math.floor((o+a)/2)):t[c+1]<e&&(o=c,c=Math.floor((o+a)/2))}return null},L(t,e,r,n){const i=e.input.array,s=e.output.array,o=e.output.itemSize;(r<i[0]||r>i[i.length-1])&&(r=Math.max(i[0],Math.min(i[i.length-1],r))),r===i[i.length-1]&&(r=i[0]);const a=this.G(i,r);if(!a||!a.nextIndex)return null;const{preIndx:c,nextIndex:f,interpolation:u}=a;t.PREINDEX=c,t.NEXTINDEX=f,t.INTERPOLATION=u;const l=o*n;return t.PREVIOUS=s.subarray(t.PREINDEX*l,(t.PREINDEX+1)*l),t.NEXT=s.subarray(t.NEXTINDEX*l,(t.NEXTINDEX+1)*l),t},P(t,e,r,n){const i=e.INTERPOLATION,s=r[e.PREINDEX],o=r[e.NEXTINDEX];for(let r=0;r<3;r++){const a=e.PREVIOUS[n+r],c=(o-s)*e.PREVIOUS[2*n+r],f=e.NEXT[3+r],u=(o-s)*e.NEXT[r],l=(2*Math.pow(i,3)-3*Math.pow(i,2)+1)*a+(Math.pow(i,3)-2*Math.pow(i,2)+i)*c+(2*-Math.pow(i,3)+3*Math.pow(i,2))*f+(Math.pow(i,3)-Math.pow(i,2))*u;t[r]=l}return t},getAnimationClip(t,e,r,n){const i=t.nodes[e]&&t.nodes[e].weights;return E(rt,...st.TRANSLATION),O(nt,...st.ROTATION),E(it,...st.SCALE),this.p(n,t,e,r,rt,nt,it,i)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach(((e,r)=>{let n=-1/0,i=1/0;const s=e.channels;for(let t=0;t<s.length;t++){const r=s[t],o=e.samplers[r.sampler].input.array;o[o.length-1]>n&&(n=o[o.length-1]),o[0]<i&&(i=o[0])}const o=e.name||r;t.timeSpan[o]={max:n,min:i}})),t.timeSpan},getTimeSpanByName(t,e){const r=this.getTimeSpan(t);return r?D(e)?r[e]:r[Object.keys(r)[0]]:null}};let ct=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(_e){}t&&"undefined"!=typeof createImageBitmap&&(ct=!0)}const ft="undefined"==typeof document?null:document.createElement("canvas");class ut{constructor(t,e,r){if(this.options=r||{},this.options.decoders||(this.options.decoders={}),e.buffer instanceof ArrayBuffer){const{json:r,glbBuffer:n}=Q.read(e.buffer,e.byteOffset,e.byteLength);this.v(t,r,n)}else this.v(t,e);this.X=new j(this.rootPath,this.gltf,this.glbBuffer),this.H()}H(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders.ktx2)throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded")}}V(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this.X.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then((e=>(t.KHR_techniques_webgl=e,t))):Promise.resolve(t)}load(t){t=t||{};const e=this.k(t),r=this.Z(),n=this.Y(),i=this.V();return Promise.all([e,r,n,i]).then((t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0])))}createChannelsMap(t){const e=t.animations;if(e)for(let t=0;t<e.length;t++){const r=e[t];r.channelsMap={};for(let t=0;t<r.channels.length;t++){const e=r.channels[t];r.channelsMap[e.target.node]||(r.channelsMap[e.target.node]=[]),r.channelsMap[e.target.node].push(e)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:r}=this.gltf;for(let r=0;r<e.length;r++)e[r].uri&&e[r].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[r].uri});for(let e=0;e<r.length;e++)r[e].uri&&r[e].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:r[e].uri})}return t}static getAnimationClip(t,e,r,n){return at.getAnimationClip(t,e,r,n)}static getAnimationTimeSpan(t,e){return at.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return L(t)}static readInterleavedArray(t,e,r,n,i,s,o){return k(t,e,r,n,i,s,o)}v(t,e,r){this.gltf=e,this.glbBuffer=r,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=ct?At.bind(this):this.options.requestImage||lt,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new $(t,e,r,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate(((t,e,r)=>{e.id="buffer_"+r}),"buffers"),this.adapter.iterate(((t,e,r)=>{e.id="image_"+r}),"images"),this.adapter.iterate(((t,e,r)=>{e.id="accessor_"+r}),"accessors")):(this.adapter=new q(t,e,r,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate(((t,e,r)=>{e.id="accessor_"+r}),"accessors"),this.adapter.iterate(((t,e,r)=>{e.id="image_"+r}),"images"))}K(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(r=t.children[0])&&isFinite(r)||function(t){return!w(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}(t.children[0])))return t;const n=t.children.map((t=>{const r=e[t];return r.nodeIndex=t,this.K(r,e)}));t.children=n}var r;return t}k(t){return this.W(t).then((t=>{const e=this.scenes=[];let r;for(const e in t)t[e]=this.K(t[e],t),t[e].nodeIndex=Number(e)?Number(e):e;this.adapter.iterate(((n,i,s)=>{const o={};i.name&&(o.name=i.name),i.nodes&&(o.nodes=i.nodes.map((e=>t[e]))),this.gltf.scene===n&&(r=s),e.push(o)}),"scenes");const n={asset:this.gltf.asset,scene:r,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins};if(this.gltf.extensions&&(n.extensions=this.gltf.extensions),1===this.version){const t=this.adapter.m(this.gltf.materials);n.materials=t}return n}))}W(t){return this.j(t).then((()=>{const t=this.nodes={};return this.adapter.iterate(((e,r)=>{const n=this.adapter.createNode(r,this.meshes,this.skins);t[e]=n}),"nodes"),t}))}q(){this.skins=[];const t=[];return this.adapter.iterate(((e,r,n)=>{t.push(this.$(r).then((t=>{t.index=n,this.skins.push(t)})))}),"skins"),t}$(t){const e=t.inverseBindMatrices;return this.adapter.accessor.T("inverseBindMatrices",e).then((e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t)))}Z(){const t=this.gltf.animations;return D(t)?this.adapter.getAnimations(t):null}j(t){this.meshes={};let e=[];return this.adapter.iterate(((r,n,i)=>{e.push(this.J(n,t).then((t=>{t.index=i,this.meshes[r]=t})))}),"meshes"),e=e.concat(this.q()),Promise.all(e)}J(t,e){const r=t.primitives.map((t=>this.tt(t,e))).filter((t=>!!t));return Promise.all(r).then((e=>{const r={};return B(r,t),r.primitives=e,r}))}Y(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const r in t)e.push(this.adapter.M(r));return Promise.all(e).then((e=>{if(this.transferables)for(let t=0;t<e.length;t++){const r=e[t].image.array;if(e[t]&&r){let t;t=r instanceof ImageBitmap?r:r.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const r={},n=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(r[n[t]]=e[t]);return r}return e}))}tt(t,e){let r;const n=[],i=t.extensions;if(D(t.targets))for(let e=0;e<t.targets.length;e++){const r=t.targets[e];for(const t in r){const i=this.adapter.accessor.T(`morphTargets_${t}_${e}`,r[t]);i&&n.push(i)}}if(i&&i.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:s,attributes:o}=i.KHR_draco_mesh_compression,a=this.gltf.bufferViews[s],c=this.X.N(a).then((r=>{const{buffer:n,byteOffset:i}=r;let{byteOffset:s,byteLength:c}=a;s||(s=0);const f=new DataView(n,i+s,c),u={attributes:o,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform};return t(f,u).then((t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e}))}));n.push(c),r=Promise.all(n)}else{const e=t.attributes;for(const t in e){const r=this.adapter.accessor.T(t,e[t]);r&&n.push(r)}if(D(t.indices)){const e=this.adapter.accessor.T("indices",t.indices);e&&n.push(e)}r=Promise.all(n)}return r.then((e=>{if(i&&i.KHR_draco_mesh_compression){const r=t.targets?t.targets.length:0;e[r]=e[r].concat(e.slice(0,r)),e=e[r]}let r,n;const s={attributes:e.reduce(((t,e)=>{if("indices"===e.name)r=e;else if(e.name.indexOf("morphTargets_")>-1)n=n||{},n[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0],{itemSize:n,array:i}=e,s=i.length/n;for(let e=0;e<s;e++)for(let s=0;s<n;s++){const o=e*n+s;i[o]<t[s]&&(t[s]=i[o]),i[o]>r[s]&&(r[s]=i[o])}if(e.quantization){const n=e.quantization,i=n.range/(1<<n.quantizationBits),s=n.minValues;T(t,t,i),_(t,t,s),T(r,r,i),_(r,r,s)}e.min=t,e.max=r}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t}),{}),material:t.material};return r&&(s.indices=r),n&&(s.morphTargets=n),s.mode=D(t.mode)?t.mode:4,D(t.extras)&&(s.extras=t.extras),s}))}}function lt(t,e){const r=new Image;r.crossOrigin="",r.onload=()=>{if(!ft)return void e(new Error("There is no canvas to draw image!"));ft.width=r.width,ft.height=r.height;const t=ft.getContext("2d");t.drawImage(r,0,0,r.width,r.height);const n=t.getImageData(0,0,r.width,r.height),i={width:r.width,height:r.height,data:new Uint8Array(n.data)};e(null,i)},r.onerror=function(t){e(t)},r.src=t}let Et,_t;function At(t,e){Et||(Et=new OffscreenCanvas(2,2),_t=Et.getContext("2d")),fetch(t).then((t=>t.arrayBuffer())).then((t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)})).then((t=>{let{width:r,height:n}=t;ht(r)||(r=Tt(r)),ht(n)||(n=Tt(n));const i=this.options.maxTextureSize;i&&(r=Math.min(i,r),n=Math.min(i,n)),Et.width=r,Et.height=n,_t.drawImage(t,0,0,r,n),t.close();const s=_t.getImageData(0,0,r,n);e(null,{width:r,height:n,data:new Uint8Array(s.data)})})).catch((t=>{console.warn(t),e(t)}))}function ht(t){return 0==(t&t-1)&&0!==t}function Tt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Rt(t){return"object"==typeof t&&!!t}function yt(t){return t*Math.PI/180}function It(t){return t/Math.PI*180}function Nt(t){return Math.sign?Math.sign(t):0===(t=+t)||isNaN(t)?Number(t):t>0?1:-1}const Ut=[1,1,1,1,2,2,3,0];function St(t){const e=t.length;let r="";for(let n=0;n<e;){let i=t[n++];if(128&i){let r=Ut[i>>3&7];if(!(64&i)||!r||n+r>e)return null;for(i&=63>>r;r>0;r-=1){const e=t[n++];if(128!=(192&e))return null;i=i<<6|63&e}}r+=String.fromCharCode(i)}return r}const dt=new Array(3),mt=new Array(3),Ot=[40680631590769,40680631590769,40408299984661.445];const Mt=[1/6378137,1/6378137,1/6356752.314245179],Ft=[1/40680631590769,1/40680631590769,1/40408299984661.445],Ct=new Array(3),bt=new Array(3),pt=new Array(3);function wt(t,e){const r=Ft,n=function(t,e,r,n,i){const s=e[0],o=e[1],a=e[2],c=r[0],f=r[1],u=r[2],l=s*s*c*c,E=o*o*f*f,_=a*a*u*u,A=l+E+_,h=Math.sqrt(1/A),R=T(Dt,e,h);if(A<i)return isFinite(h)?R:void 0;const y=n[0],I=n[1],N=n[2],U=Bt;U[0]=R[0]*y*2,U[1]=R[1]*I*2,U[2]=R[2]*N*2;let S,d,m,O,M,F,C,b,p,w,D,B=(1-h)*Lt(e)/(.5*Lt(U)),L=0;do{B-=L,m=1/(1+B*y),O=1/(1+B*I),M=1/(1+B*N),F=m*m,C=O*O,b=M*M,p=F*m,w=C*O,D=b*M,S=l*F+E*C+_*b-1,d=l*p*y+E*w*I+_*D*N;L=S/(-2*d)}while(Math.abs(S)>1e-12);return t[0]=s*m,t[1]=o*O,t[2]=a*M,t}(Ct,e,Mt,r,.1);let i=d(bt,n,r);i=Pt(i,i);const s=S(pt,e,n),o=Math.atan2(i[1],i[0]),a=Math.asin(i[2]),c=Nt(I(s,e))*Lt(s);return t[0]=It(o),t[1]=It(a),t[2]=c,t}const Dt=new Array(3),Bt=new Array(3);function Lt(t){return f(t)}function Pt(t,e){const r=e[0],n=e[1],i=e[2];let s=r*r+n*n+i*i;return s>0&&(s=Math.sqrt(s),t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s),t}function gt(t,e,r,n){r=r||0,n=n||r;var i=Math.abs(t-e);return i<=n||i<=r*Math.max(Math.abs(t),Math.abs(e))}function Gt(t,e){let r="";for(let n=0;n<4;n++){const i=t.getUint8(e+n);r+=String.fromCharCode(i)}return r}const vt="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function Xt(t,e,r){const n=new Uint8Array(t,e,r);return vt?JSON.parse(vt.decode(n)):JSON.parse(St(n))}function Ht(t,e,r){const n=new Uint8Array(t,e,r);return vt?JSON.parse(vt.decode(n)):JSON.parse(St(n))}function xt(t,e,r){return{offset:e,byteLength:r}}function Vt(t,e,r,n){const{byteOffset:i,componentType:s,type:o}=t,{ctor:a,type:c}=function(t){return Yt[t]}(s||"UNSIGNED_SHORT"),f=function(t){if(!t)return 1;return Zt[t]}(o);return{byteStride:0,byteOffset:i+r,itemSize:f,count:n*f,componentType:c,array:new a(e,r+i,n*f)}}function kt(t,e,r,n){const i=Vt(t,e,r,n);return i.array.buffer.byteLength!==e.byteLength&&(i.array=i.array.slice()),i}const Zt={"SCALAR":1,"VEC2":2,"VEC3":3,"VEC4":4};const Yt={"BYTE":{ctor:Int8Array,type:5120,name:"Int8Array"},"UNSIGNED_BYTE":{ctor:Uint8Array,type:5121,name:"Uint8Array"},"SHORT":{ctor:Int16Array,type:5122,name:"Int16Array"},"UNSIGNED_SHORT":{ctor:Uint16Array,type:5123,name:"Uint16Array"},"INT":{ctor:Int32Array,type:5124,name:"Int32Array"},"UNSIGNED_INT":{ctor:Uint32Array,type:5125,name:"Uint32Array"},"FLOAT":{ctor:Float32Array,type:5126,name:"Float32Array"},"DOUBLE":{ctor:Float64Array,type:5126,name:"Float64Array"}};function Kt(t){for(let e in Yt)if(t===Yt[e].ctor)return Yt[e].type;throw new Error("unrecognized ctor:"+t)}function zt(t,e,r,n){const i=t,s=e.length/3;for(let t=0;t<s;t++)i[3*t]=e[3*t]/65535*n[0]+r[0],i[3*t+1]=e[3*t+1]/65535*n[1]+r[1],i[3*t+2]=e[3*t+2]/65535*n[2]+r[2];return i}function Wt(t,e,r){let n=t.getUint32(12,!0),i=t.getUint32(16,!0),s=t.getUint32(20,!0),o=t.getUint32(24,!0);const a=t.buffer;let c,f,u={},l={};n>0&&(u=Xt(a,e,n),e+=n),i>0&&(c=function(t,e,r){return{offset:e,byteLength:r}}(0,e,i),e+=i),s>0&&(l=Ht(a,e,s),e+=s);const E=xt(0,e,o);return f=a.slice(E.offset,E.offset+E.byteLength),r.push(f),{featureTable:u,featureTableBin:c,batchTable:l,batchTableBin:f}}var jt={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},qt={},$t={east:[],north:[],up:[],west:[],south:[],down:[]},Jt=[],Qt=[],te=[];const ee=[0,0,0];const re=(oe={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}}[ne="east"][ie="north"],qt[ae=ne+ie]?se=qt[ae]:(se=function(t,r,n){if(function(t,r){var n=t[0],i=t[1],s=t[2],o=r[0],a=r[1],c=r[2];return Math.abs(n-o)<=e*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=e*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-c)<=e*Math.max(1,Math.abs(s),Math.abs(c))}(t,ee))l(Jt,jt[ne]),l(Qt,jt[ie]),l(te,jt[oe]);else if(gt(t[0],0,1e-14)&&gt(t[1],0,1e-14)){var i=Nt(t[2]);l(Jt,jt[ne]),"east"!==ne&&"west"!==ne&&T(Jt,Jt,i),l(Qt,jt[ie]),"east"!==ie&&"west"!==ie&&T(Qt,Qt,i),l(te,jt[oe]),"east"!==oe&&"west"!==oe&&T(te,te,i)}else{!function(t,e){h(e,t,Ft),y(e,e)}(t,$t.up);var s=$t.up,o=$t.east;o[0]=-t[1],o[1]=t[0],o[2]=0,y($t.east,o),N($t.north,s,o),T($t.down,$t.up,-1),T($t.west,$t.east,-1),T($t.south,$t.north,-1),Jt=$t[ne],Qt=$t[ie],te=$t[oe]}return n[0]=Jt[0],n[1]=Jt[1],n[2]=Jt[2],n[3]=0,n[4]=Qt[0],n[5]=Qt[1],n[6]=Qt[2],n[7]=0,n[8]=te[0],n[9]=te[1],n[10]=te[2],n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},qt[ae]=se),se);var ne,ie,se,oe,ae;const ce={5120:Int8Array,5122:Int16Array,5124:Int32Array,5121:Uint8Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function fe(t){for(let e in ce)if(t===ce[e])return+e;throw new Error("unrecognized ctor:"+t)}function ue(t){return 1===t?"FLOAT":"VEC"+t}\n/*!\n   * @maptalks/gl v0.68.1\n   * LICENSE : UNLICENSED\n   * (c) 2016-2022 maptalks.com\n   */const le=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof undefined)return global;throw new Error("unable to locate global object")},Ee=le(),_e=Ee.gl_trans__coders=Ee.gl_trans__coders||{};_e.inject=function(t){const e=t.toString(),r=e.indexOf("{")+1,n=e.substring(0,r),i=Ee.gl_trans__coders=Ee.gl_trans__coders||{};let s=`${n}\\n    const _____getGlobal = ${le.toString()};\\n    const g___lobals = _____getGlobal()\\n    const tran_____scoders = g___lobals[\'gl_trans__coders\'] = g___lobals[\'gl_trans__coders\'] || {};`;for(const t in i)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(s+=\'tran_____scoders["\'+t+\'"] =\'+i[t].toString()+"\\n;");return s+="\\n"+e.substring(n.length),s},_e.registerTranscoder=function(t,e){_e[t]=e},_e.getTranscoder=function(t){return _e[t]};class Ae{constructor(t,e,r){this.i=t,this.et=e||ut,this.o=r,this.rt={"image/crn":_e.crn&&_e.crn(),"image/ktx2":_e.ktx2&&_e.ktx2(),"image/cttf":_e.ktx2&&_e.ktx2(),"draco":_e.draco&&_e.draco()}}static createEmptyB3DM(){return{featureTable:null,batchTable:null,gltf:{}}}load(t,e,r=0,n=0,i){return e?(n||(n=e.byteLength),this.nt(t,e,r,n,i)):K.getArrayBuffer(t,{}).then((e=>{const i=e.data;return n||(n=i.byteLength),this.nt(t,i,r,n)}))}nt(t,e,r,n,i){const s=i&&i.maxTextureSize,o=this.it(e,r,n,t);if(o.error)return Promise.resolve(o);const a=t.substring(0,t.lastIndexOf("/")),c=new this.et(a,o.glb,{transferable:!0,requestImage:this.i,decoders:this.rt,supportedFormats:this.o,maxTextureSize:s});return c.load({skipAttributeTransform:!1}).then((e=>{e.url=`${t}-${r}-${n}`;const i=c.transferables;for(let t=0;t<o.transferables.length;t++)i.indexOf(o.transferables[t])<0&&i.push(o.transferables[t]);return{magic:"b3dm",count:o.count,transferables:i,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,gltf:e}}))}it(t,e,r,n){const i=new DataView(t,e,r),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported b3dm version: "+s+", url:"+n;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in b3dm header is inconsistent with b3dm\'s byte length, url: "+n;return console.warn(t),{error:t}}let o,a=i.getUint32(12,!0),c=i.getUint32(16,!0),f=i.getUint32(20,!0),u=i.getUint32(24,!0),l=28+e;f>=570425344?(l-=8,o=a,f=c,u=0,a=0,c=0):u>=570425344&&(l-=4,o=f,f=a,u=c,a=0,c=0);const E=[t];let _,A,h;if(a>0?(_=Xt(t,l,a),l+=a,o=_.BATCH_LENGTH):_={"BATCH_LENGTH":o},c>0&&(l+=c),f>0&&(A=Ht(t,l,f),l+=f,u>0)){const e=xt(0,l,u);h=t.slice(e.offset,e.offset+e.byteLength),l+=u,E.push(h)}const T=_.BATCH_LENGTH,R={};if(_&&_.BATCH_ID){R.BATCH_ID=kt(_.BATCH_ID,t,undefined.offset,T);const e=R.BATCH_ID.array&&R.BATCH_ID.array.buffer;e&&E.indexOf(e)<0&&E.push(e)}return{count:o,transferables:E,featureTable:_,batchTable:A,batchTableBin:h,b3dm:R,glb:{buffer:t,byteOffset:l,byteLength:i.byteLength+i.byteOffset-l}}}st(){return null}}class he{constructor(t,e,r,n){this.i=t,this.et=e||ut,this.o=r,this.rt={"image/crn":_e.crn&&_e.crn(),"image/ktx2":_e.ktx2&&_e.ktx2(),"image/cttf":_e.ktx2&&_e.ktx2(),"draco":_e.draco&&_e.draco()},this.ot=n}load(t,e,r=0,n=0,i){return e?(n||(n=e.byteLength),this.nt(t,e,r,n,i)):K.getArrayBuffer(t,{}).then((e=>{const i=e.data;return n||(n=i.byteLength),this.nt(t,i,r,n)}))}nt(t,e,r,n,i){return this.ct(t,e,r,n,i).then((({gltf:i,transferables:s})=>{const o=this.ft(e,r,n,t);if(o.error)return Promise.resolve(o);for(let t=0;t<s.length;t++)-1===o.transferables.indexOf(s[t])&&o.transferables.push(s[t]);return delete i.transferables,Promise.resolve({magic:"i3dm",count:o.count,transferables:o.transferables,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,i3dm:o.i3dm,gltf:i})}))}ct(t,e,r,n,i){const s=i&&i.maxTextureSize,o={transferable:!0,requestImage:this.i,decoders:this.rt,supportedFormats:this.o,maxTextureSize:s},a=new DataView(e,r,n),c=32+a.getUint32(12,!0)+a.getUint32(16,!0)+a.getUint32(20,!0)+a.getUint32(24,!0);if(0===a.getUint32(28,!0)){let n=St(new Uint8Array(e,c+r,a.byteLength-c));-1==n.indexOf("://")&&(n=t.substring(0,t.lastIndexOf("/"))+"/"+n);return n.indexOf(".glb")>0?K.getArrayBuffer(n,{}).then((t=>this.ut(n,{buffer:t.data,byteOffset:0},o))):K.getJSON(n,{}).then((t=>this.ut(n,t,o)))}{const n={buffer:e,byteOffset:c+r,byteLength:a.byteLength-c};return this.ut(t,n,o)}}ut(t,e,r){const n=t.substring(0,t.lastIndexOf("/")),i=new this.et(n,e,r);return i.load({skipAttributeTransform:!0}).then((r=>{let n=0,s=0;return e.buffer&&(n=e.byteOffset||0,s=e.byteLength||0),r.url=`${t}-${n}-${s}`,{transferables:i.transferables,gltf:r}}))}ft(t,e,r,n){const i=new DataView(t,e,r),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported pnts version: "+s+", url:"+n;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in pnts header is inconsistent with pnts\'s byte length, url: "+n;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:f,batchTableBin:u}=Wt(i,32+e,o),l={},E=a.INSTANCES_LENGTH;if(a.POSITION){const{byteOffset:e}=a.POSITION;l.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:E,componentType:5126,array:new Float32Array(t,e+c.offset,3*E).slice()},o.push(l.POSITION.array.buffer)}else if(a.POSITION_QUANTIZED){const e=a.QUANTIZED_VOLUME_OFFSET,r=a.QUANTIZED_VOLUME_SCALE,{byteOffset:n}=a.POSITION_QUANTIZED;l.POSITION={byteStride:12,byteOffset:0,itemSize:3,count:E,componentType:5126,array:this.lt(new Uint16Array(t,n+c.offset,3*E),e,r)},o.push(l.POSITION.array.buffer)}if(a.BATCH_ID){l.BATCH_ID=kt(a.BATCH_ID,t,c.offset,E);const e=l.BATCH_ID.array&&l.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}if(a.NORMAL_UP){let{byteOffset:e}=a.NORMAL_UP;l.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:E,componentType:5126,array:new Float32Array(t,e+c.offset,3*E).slice()},o.push(l.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT.byteOffset,l.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:E,componentType:5126,array:new Float32Array(t,e+c.offset,3*E).slice()},o.push(l.NORMAL_RIGHT.array.buffer)}else if(a.NORMAL_UP_OCT32P){let{byteOffset:e}=a.NORMAL_UP_OCT32P;l.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:E,componentType:5126,array:this.Et(new Uint16Array(t,e+c.offset,2*E))},o.push(l.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT_OCT32P.byteOffset,l.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:E,componentType:5126,array:this.Et(new Uint16Array(t,e+c.offset,2*E))},o.push(l.NORMAL_RIGHT.array.buffer)}if(a.SCALE){const{byteOffset:e}=a.SCALE;l.SCALE={byteStride:0,byteOffset:0,itemSize:1,count:E,componentType:5126,array:new Float32Array(t,e+c.offset,E).slice()},o.push(l.SCALE.array.buffer)}else if(a.SCALE_NON_UNIFORM){const{byteOffset:e}=a.SCALE_NON_UNIFORM;l.SCALE_NON_UNIFORM={byteStride:0,byteOffset:0,itemSize:3,count:E,componentType:5126,array:new Float32Array(t,e+c.offset,3*E).slice()},o.push(l.SCALE_NON_UNIFORM.array.buffer)}return{count:E,batchTable:f,batchTableBin:u,featureTable:a,i3dm:l,transferables:o}}Et(t){const e=t.length/2,r=new Float32Array(3*e),n=[];for(let i=0;i<e;i++)Te(n,t[2*i],t[2*i+1],65535),r[3*i]=n[0],r[3*i+1]=n[1],r[3*i+2]=n[2];return r}lt(t,e,r){return zt(new Float32Array(t.length),t,e,r)}st(){return null}}function Te(t,e,r,n){if(t[0]=Re(e,n),t[1]=Re(r,n),t[2]=1-(Math.abs(t[0])+Math.abs(t[1])),t[2]<0){const e=t[0];t[0]=(1-Math.abs(t[1]))*ye(e),t[1]=(1-Math.abs(e))*ye(t[1])}return y(t,t)}function Re(t,e){return e=function(t,e){if(null!=t)return t;return e}(e,255),function(t,e,r){return t<e?e:t>r?r:t}(t,0,e)/e*2-1}function ye(t){return t<0?-1:1}class Ie{constructor(){}load(t,e,r=0,n=0){return e?(n||(n=e.byteLength),this.nt(t,e,r,n)):K.getArrayBuffer(t,{}).then((e=>{const i=e.data;return n||(n=i.byteLength),this.nt(t,i,r,n)}))}nt(t,e,r,n){return this._t(e,r,n,t).then((t=>t.error?t:{magic:"pnts",count:t.count,transferables:t.transferables,featureTable:t.featureTable,batchTable:t.batchTable,batchTableBin:t.batchTableBin,pnts:t.pnts}))}_t(t,e,r,n){const i=new DataView(t,e,r),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported pnts version: "+s+", url:"+n;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in pnts header is inconsistent with pnts\'s byte length, url: "+n;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:f,batchTableBin:u}=Wt(i,e+28,o),l=a.QUANTIZED_VOLUME_OFFSET,E=a.QUANTIZED_VOLUME_SCALE,_=a.POINTS_LENGTH;let A,h={};if(a.extensions&&a.extensions["3DTILES_draco_point_compression"]){h=a.extensions["3DTILES_draco_point_compression"],A=new DataView(t,h.byteOffset+c.offset,h.byteLength);const e={attributes:h.properties,useUniqueIDs:!1};return this.At||(this.At=_e.draco()),this.At(A,e).then((e=>{const r=e.attributes;!a.POSITION&&!a.POSITION_QUANTIZED||r.POSITION||r.POSITION_QUANTIZED||(r.POSITION=a.POSITION,r.POSITION_QUANTIZED=a.POSITION_QUANTIZED),!(a.RGB||a.RGBA||a.RGB565)||r.RGB||r.RGBA||r.RGB565||(r.RGB=a.RGB,r.RGBA=a.RGBA,r.RGB565=a.RGB565),!a.NORMAL&&!a.NORMAL_OCT16P||r.NORMAL||r.NORMAL_OCT16P||(r.NORMAL=a.NORMAL,r.NORMAL_OCT16P=a.NORMAL_OCT16P);const n=this.ht(t,e.attributes,c.offset,_,o,l,E);if(e.attributes.BATCH_ID){const t=e.attributes.BATCH_ID.array;n.BATCH_ID={byteStride:0,byteOffset:0,itemSize:1,count:t.length,componentType:Kt(t.constructor),array:t},o.push(t.buffer)}else if(a.BATCH_ID||Object.keys(f).length){a.BATCH_ID?n.BATCH_ID=kt(a.BATCH_ID,t,c.offset,_):n.BATCH_ID=Ne(_);const e=n.BATCH_ID.array&&n.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return{count:_,batchTable:f,batchTableBin:u,featureTable:a,pnts:n,transferables:o}}))}const T=this.ht(t,a,c.offset,_,o,l,E);if(a.BATCH_ID||Object.keys(f).length){a.BATCH_ID?T.BATCH_ID=kt(a.BATCH_ID,t,c.offset,_):T.BATCH_ID=Ne(_);const e=T.BATCH_ID.array&&T.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return Promise.resolve({count:_,batchTable:f,batchTableBin:u,featureTable:a,pnts:T,transferables:o})}ht(t,e,r,n,i,s,o){const a={};if(e.POSITION){let{byteOffset:s,array:o}=e.POSITION;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+3*n*4);o=new Float32Array(e)}a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:o},i.push(o.buffer)}else if(e.POSITION_QUANTIZED){let{byteOffset:c,array:f}=e.POSITION_QUANTIZED;c=c||0;const u=f?0:r;a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:this.lt(f||new Uint16Array(t,c+u,3*n),s,o)},i.push(a.POSITION.array.buffer)}if(e.RGBA){let{byteOffset:s,array:o}=e.RGBA;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+4*n);o=new Uint8Array(e)}a.RGBA={byteStride:0,byteOffset:0,itemSize:4,count:n,componentType:5121,array:o},i.push(o.buffer)}else if(e.RGB){let{byteOffset:s,array:o}=e.RGB;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+3*n);o=new Uint8Array(e)}a.RGB={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5121,array:o},i.push(o.buffer)}else if(e.RGB565){let{byteOffset:s,array:o}=e.RGB565;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+2*n);o=new Uint16Array(e)}a.RGB565={byteStride:0,byteOffset:0,itemSize:1,count:n,componentType:5123,array:o},i.push(o.buffer)}if(e.NORMAL){let{byteOffset:s,array:o}=e.NORMAL;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+3*n*4);o=new Float32Array(e)}a.NORMAL={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:o},i.push(o.buffer)}else if(e.NORMAL_OCT16P){let{byteOffset:s,array:o}=e.NORMAL_OCT16P;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+2*n);o=new Uint8Array(e)}a.NORMAL_OCT16P={byteStride:0,byteOffset:0,itemSize:2,count:n,componentType:5121,array:o},i.push(o.buffer)}return a}lt(t,e,r){return zt(new Float32Array(t.length),t,e,r)}st(){return null}}function Ne(t){const e=(r=t)<256?Uint8Array:r<65536?Uint16Array:Uint32Array;var r;const n=new e(t);for(let e=0;e<t;e++)n[e]=e;return{byteStride:0,byteOffset:0,itemSize:1,count:t,componentType:Kt(e),array:n}}class Ue{constructor(t,e){this.i=t,this.et=e||ut}load(t,e,r=0,n=0,i){return e?this.nt(t,e,r,n,i):K.getArrayBuffer(t,{}).then((e=>{const i=e.data;return this.nt(t,i,r,n)}))}nt(t,e,r,n,i){n||(n=e.byteLength);const s=this.Tt(e,t,r,n),o=[];for(let r=0;r<s.length;r++){let n;if("b3dm"===s[r].magic)n=new Ae(this.i,this.et);else if("i3dm"===s[r].magic)n=new he(this.i,this.et);else if("pnts"===s[r].magic)n=new Ie;else{if("cmpt"!==s[r].magic){console.warn("Unsupported magic in CMPT tile:",s[r].magic);continue}n=new Ue(this.i,this.et)}o.push(n.load(t,e,s[r].offset,s[r].byteLength,i).then((t=>t)))}return Promise.all(o).then((t=>({magic:"cmpt",tiles:t})))}Tt(t,e,r,n){const i=new DataView(t,r,n),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported cmpt version: "+s+", url:"+e;return console.warn(t),{error:t}}if(16===i.byteLength)return[];const o=[],a=i.getUint32(12,!0);let c=16;for(let e=0;e<a;e++){const e=Gt(i,c),n=i.getUint32(c+8,!0);o.push({magic:e,buffer:t,offset:c+r,byteLength:n}),c+=n}return o}}function Se(t,e){if(t.scenes&&t.scenes.length)for(let r=0,n=t.scenes.length;r<n;r++){const n=t.scenes[r].nodes;for(let r=0,i=n.length;r<i;r++){const i=[];de(n[r],i,t,e)}}}function de(t,e,r,n){if(t.matrix&&e.push(t.matrix),t.children&&t.children.length)for(let i=0,s=t.children.length;i<s;i++)de(t.children[i],e,r,n);if(void 0!==t.mesh){const i=t.mesh,s=r.meshes[i];if(s){const t=e.slice(0),o=s.primitives;for(let e=0,s=o.length;e<s;e++){const s=o[e];s&&(s.matrices=t,n(s,i,e,r))}}}}function me(t,e){let{componentType:r,byteOffset:n,byteStride:i,count:s,itemSize:o}=t;const a=t.array.buffer,c=r?ut.getTypedArrayCtor(r):t.array.constructor;if(n=void 0===n?t.array.byteOffset:n,i=i||0,s=s||t.array.length/o,(!i||i===o*c.BYTES_PER_ELEMENT)&&n%c.BYTES_PER_ELEMENT==0){const t=new c(a,n,s*o);for(let r=0;r<s*o;r+=o){e(new c(t.buffer,n+r*c.BYTES_PER_ELEMENT,o),r/o)}return}const f=new Uint8Array(o*c.BYTES_PER_ELEMENT);i||(i=o*c.BYTES_PER_ELEMENT);for(let t=0;t<s;t++){const r=new Uint8Array(a,i*t+n,o*c.BYTES_PER_ELEMENT);f.set(r);e(new c(f.buffer),t),r.set(f)}}const Oe=[],Me=[];function Fe(t){const e={asset:{version:"1.0",gltfUpAxis:"Z",s3mType:t.dataType},geometricError:0,root:{boundingVolume:{},content:{uri:""},transform:[],geometricError:0,refine:"REPLACE",children:[]}},r=t.position.x,n=t.position.y,s=t.position.z,o=function(t,e,r,n){const i=Ot,s=Math.cos(r);dt[0]=s*Math.cos(e),dt[1]=s*Math.sin(e),dt[2]=Math.sin(r),Pt(dt,dt),h(mt,i,dt);const o=Math.sqrt(I(dt,mt));var a,c,f;return c=mt,f=o,(a=mt)[0]=c[0]/f,a[1]=c[1]/f,a[2]=c[2]/f,T(dt,dt,n),_(t,mt,dt)}([],yt(r),yt(n),s),a=re(o,null,[]);e.root.transform=i([],a);const c=[];for(let r=0,n=t.tiles.length;r<n;r++)if(t.tiles[r].boundingbox){const n=t.tiles[r].boundingbox;E(Oe,n.min.x,n.min.y,n.min.z),E(Me,n.max.x,n.max.y,n.max.z);const i={center:[0,0,0],radius:0};Ce(Oe,Me,i),e.root.children.push({boundingVolume:{sphere:[...i.center,i.radius]},content:{uri:t.tiles[r].url},geometricError:70,refine:"REPLACE"}),c.push(i)}else if(t.tiles[r].boundingsphere){const{boundingsphere:n}=t.tiles[r],i={center:[n.center.x,n.center.y,n.center.z],radius:n.radius};e.root.children.push({boundingVolume:{sphere:[...i.center,i.radius]},content:{uri:t.tiles[r].url},geometricError:70,refine:"REPLACE"}),c.push(i)}const f=function(t,e){if(0===t.length)return e;const r=t.length;if(1===r)return function(t,e){return l(e.center,t.center),e.radius=t.radius,e}(t[0],e);if(2===r)return function(t,e,r){const n=t.center,i=t.radius,s=e.center,o=e.radius,a=A(pe,s,n),c=Ye(a);if(i>=c+o)return t.clone(r),r;if(o>=c+i)return e.clone(r),r;const f=.5*(i+c+o),u=T(we,a,(-i+f)/c);return _(u,u,n),l(r.center,u),r.radius=f,r}(t[0],t[1],e);const n=[];for(let e=0;e<r;e++)n.push(t[e].center);const i=(e=function(t,e){if(0===t.length)return e.center=E(e.center,0,0,0),e.radius=0,e;const r=l(ve,t[0]),n=l(De,r),i=l(Be,r),s=l(Le,r),o=l(Pe,r),a=l(ge,r),c=l(Ge,r),f=t.length;for(let e=1;e<f;e++){l(r,t[e]);const f=r[0],u=r[1],E=r[2];f<n[0]&&l(n,r),f>o[0]&&l(o,r),u<i[1]&&l(i,r),u>a[1]&&l(a,r),E<s[2]&&l(s,r),E>c[2]&&l(c,r)}const u=Ze(A(Xe,o,n)),_=Ze(A(Xe,a,i)),h=Ze(A(Xe,c,s));let T=n,R=o,y=u;_>y&&(y=_,T=i,R=a);h>y&&(y=h,T=s,R=c);const I=He;I[0]=.5*(T[0]+R[0]),I[1]=.5*(T[1]+R[1]),I[2]=.5*(T[2]+R[2]);let N=Ze(A(Xe,R,I)),U=Math.sqrt(N);const S=xe;S[0]=n[0],S[1]=i[1],S[2]=s[2];const d=Ve;d[0]=o[0],d[1]=a[1],d[2]=c[2];const m=be(S,d,ke);let O=0;for(let e=0;e<f;e++){l(r,t[e]);const n=Ye(A(Xe,r,m));n>O&&(O=n);const i=Ze(A(Xe,r,I));if(i>N){const t=Math.sqrt(i);U=.5*(U+t),N=U*U;const e=t-U;I[0]=(U*I[0]+e*r[0])/t,I[1]=(U*I[1]+e*r[1])/t,I[2]=(U*I[2]+e*r[2])/t}}U<O?(l(e.center,I),e.radius=U):(l(e.center,m),e.radius=O);return e}(n,e)).center;let s=e.radius;for(let e=0;e<r;e++){const r=t[e];s=Math.max(s,R(i,r.center)+r.radius)}return e.radius=s,e}(c,{center:[0,0,0],radius:0});return e.root.boundingVolume.sphere=[...f.center,f.radius],e}function Ce(t,e,r){var n=be(t,e,r.center);return r.radius=R(n,e),r}function be(t,e,r){return r[0]=.5*(t[0]+e[0]),r[1]=.5*(t[1]+e[1]),r[2]=.5*(t[2]+e[2]),r}const pe=[],we=[];const De=[],Be=[],Le=[],Pe=[],ge=[],Ge=[],ve=[],Xe=[],He=[],xe=[],Ve=[],ke=[];function Ze(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function Ye(t){return Math.hypot(t[0],t[1],t[2])}\n/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Ke(t){let e=t.length;for(;--e>=0;)t[e]=0}const ze=256,We=286,je=30,qe=15,$e=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Je=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Qe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),tr=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),er=new Array(576);Ke(er);const rr=new Array(60);Ke(rr);const nr=new Array(512);Ke(nr);const ir=new Array(256);Ke(ir);const sr=new Array(29);Ke(sr);const or=new Array(je);function ar(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}let cr,fr,ur;function lr(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}Ke(or);const Er=t=>t<256?nr[t]:nr[256+(t>>>7)],_r=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Ar=(t,e,r)=>{t.bi_valid>16-r?(t.bi_buf|=e<<t.bi_valid&65535,_r(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=r-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},hr=(t,e,r)=>{Ar(t,r[2*e],r[2*e+1])},Tr=(t,e)=>{let r=0;do{r|=1&t,t>>>=1,r<<=1}while(--e>0);return r>>>1},Rr=(t,e,r)=>{const n=new Array(16);let i,s,o=0;for(i=1;i<=qe;i++)n[i]=o=o+r[i-1]<<1;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=Tr(n[e]++,e))}},yr=t=>{let e;for(e=0;e<We;e++)t.dyn_ltree[2*e]=0;for(e=0;e<je;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},Ir=t=>{t.bi_valid>8?_r(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Nr=(t,e,r,n)=>{const i=2*e,s=2*r;return t[i]<t[s]||t[i]===t[s]&&n[e]<=n[r]},Ur=(t,e,r)=>{const n=t.heap[r];let i=r<<1;for(;i<=t.heap_len&&(i<t.heap_len&&Nr(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Nr(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n},Sr=(t,e,r)=>{let n,i,s,o,a=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*a]<<8|t.pending_buf[t.d_buf+2*a+1],i=t.pending_buf[t.l_buf+a],a++,0===n?hr(t,i,e):(s=ir[i],hr(t,s+ze+1,e),o=$e[s],0!==o&&(i-=sr[s],Ar(t,i,o)),n--,s=Er(n),hr(t,s,r),o=Je[s],0!==o&&(n-=or[s],Ar(t,n,o)))}while(a<t.last_lit);hr(t,256,e)},dr=(t,e)=>{const r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,c,f=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<s;o++)0!==r[2*o]?(t.heap[++t.heap_len]=f=o,t.depth[o]=0):r[2*o+1]=0;for(;t.heap_len<2;)c=t.heap[++t.heap_len]=f<2?++f:0,r[2*c]=1,t.depth[c]=0,t.opt_len--,i&&(t.static_len-=n[2*c+1]);for(e.max_code=f,o=t.heap_len>>1;o>=1;o--)Ur(t,r,o);c=s;do{o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Ur(t,r,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,r[2*c]=r[2*o]+r[2*a],t.depth[c]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,r[2*o+1]=r[2*a+1]=c,t.heap[1]=c++,Ur(t,r,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const r=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let f,u,l,E,_,A,h=0;for(E=0;E<=qe;E++)t.bl_count[E]=0;for(r[2*t.heap[t.heap_max]+1]=0,f=t.heap_max+1;f<573;f++)u=t.heap[f],E=r[2*r[2*u+1]+1]+1,E>c&&(E=c,h++),r[2*u+1]=E,u>n||(t.bl_count[E]++,_=0,u>=a&&(_=o[u-a]),A=r[2*u],t.opt_len+=A*(E+_),s&&(t.static_len+=A*(i[2*u+1]+_)));if(0!==h){do{for(E=c-1;0===t.bl_count[E];)E--;t.bl_count[E]--,t.bl_count[E+1]+=2,t.bl_count[c]--,h-=2}while(h>0);for(E=c;0!==E;E--)for(u=t.bl_count[E];0!==u;)l=t.heap[--f],l>n||(r[2*l+1]!==E&&(t.opt_len+=(E-r[2*l+1])*r[2*l],r[2*l+1]=E),u--)}})(t,e),Rr(r,f,t.bl_count)},mr=(t,e,r)=>{let n,i,s=-1,o=e[1],a=0,c=7,f=4;for(0===o&&(c=138,f=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=e[2*(n+1)+1],++a<c&&i===o||(a<f?t.bl_tree[2*i]+=a:0!==i?(i!==s&&t.bl_tree[2*i]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,s=i,0===o?(c=138,f=3):i===o?(c=6,f=3):(c=7,f=4))},Or=(t,e,r)=>{let n,i,s=-1,o=e[1],a=0,c=7,f=4;for(0===o&&(c=138,f=3),n=0;n<=r;n++)if(i=o,o=e[2*(n+1)+1],!(++a<c&&i===o)){if(a<f)do{hr(t,i,t.bl_tree)}while(0!=--a);else 0!==i?(i!==s&&(hr(t,i,t.bl_tree),a--),hr(t,16,t.bl_tree),Ar(t,a-3,2)):a<=10?(hr(t,17,t.bl_tree),Ar(t,a-3,3)):(hr(t,18,t.bl_tree),Ar(t,a-11,7));a=0,s=i,0===o?(c=138,f=3):i===o?(c=6,f=3):(c=7,f=4)}};let Mr=!1;const Fr=(t,e,r,n)=>{Ar(t,0+(n?1:0),3),((t,e,r,n)=>{Ir(t),n&&(_r(t,r),_r(t,~r)),t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r})(t,e,r,!0)};var Cr=t=>{Mr||((()=>{let t,e,r,n,i;const s=new Array(16);for(r=0,n=0;n<28;n++)for(sr[n]=r,t=0;t<1<<$e[n];t++)ir[r++]=n;for(ir[r-1]=n,i=0,n=0;n<16;n++)for(or[n]=i,t=0;t<1<<Je[n];t++)nr[i++]=n;for(i>>=7;n<je;n++)for(or[n]=i<<7,t=0;t<1<<Je[n]-7;t++)nr[256+i++]=n;for(e=0;e<=qe;e++)s[e]=0;for(t=0;t<=143;)er[2*t+1]=8,t++,s[8]++;for(;t<=255;)er[2*t+1]=9,t++,s[9]++;for(;t<=279;)er[2*t+1]=7,t++,s[7]++;for(;t<=287;)er[2*t+1]=8,t++,s[8]++;for(Rr(er,287,s),t=0;t<je;t++)rr[2*t+1]=5,rr[2*t]=Tr(t,5);cr=new ar(er,$e,257,We,qe),fr=new ar(rr,Je,0,je,qe),ur=new ar(new Array(0),Qe,0,19,7)})(),Mr=!0),t.l_desc=new lr(t.dyn_ltree,cr),t.d_desc=new lr(t.dyn_dtree,fr),t.bl_desc=new lr(t.bl_tree,ur),t.bi_buf=0,t.bi_valid=0,yr(t)},br=(t,e,r,n)=>{let i,s,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<ze;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),dr(t,t.l_desc),dr(t,t.d_desc),o=(t=>{let e;for(mr(t,t.dyn_ltree,t.l_desc.max_code),mr(t,t.dyn_dtree,t.d_desc.max_code),dr(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*tr[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==e?Fr(t,e,r,n):4===t.strategy||s===i?(Ar(t,2+(n?1:0),3),Sr(t,er,rr)):(Ar(t,4+(n?1:0),3),((t,e,r,n)=>{let i;for(Ar(t,e-257,5),Ar(t,r-1,5),Ar(t,n-4,4),i=0;i<n;i++)Ar(t,t.bl_tree[2*tr[i]+1],3);Or(t,t.dyn_ltree,e-1),Or(t,t.dyn_dtree,r-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),Sr(t,t.dyn_ltree,t.dyn_dtree)),yr(t),n&&Ir(t)},pr={Rt:Cr,yt:Fr,It:br,Nt:(t,e,r)=>(t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(ir[r]+ze+1)]++,t.dyn_dtree[2*Er(e)]++),t.last_lit===t.lit_bufsize-1),Ut:t=>{Ar(t,2,3),hr(t,256,er),(t=>{16===t.bi_valid?(_r(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var wr=(t,e,r,n)=>{let i=65535&t|0,s=t>>>16&65535|0,o=0;for(;0!==r;){o=r>2e3?2e3:r,r-=o;do{i=i+e[n++]|0,s=s+i|0}while(--o);i%=65521,s%=65521}return i|s<<16|0};const Dr=new Uint32Array((()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e})());var Br=(t,e,r,n)=>{const i=Dr,s=n+r;t^=-1;for(let r=n;r<s;r++)t=t>>>8^i[255&(t^e[r])];return-1^t},Lr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Pr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{Rt:gr,yt:Gr,It:vr,Nt:Xr,Ut:Hr}=pr,{Z_NO_FLUSH:xr,Z_PARTIAL_FLUSH:Vr,Z_FULL_FLUSH:kr,Z_FINISH:Zr,Z_BLOCK:Yr,Z_OK:Kr,Z_STREAM_END:zr,Z_STREAM_ERROR:Wr,Z_DATA_ERROR:jr,Z_BUF_ERROR:qr,Z_DEFAULT_COMPRESSION:$r,Z_FILTERED:Jr,Z_HUFFMAN_ONLY:Qr,Z_RLE:tn,Z_FIXED:en,Z_DEFAULT_STRATEGY:rn,Z_UNKNOWN:nn,Z_DEFLATED:sn}=Pr,on=258,an=262,cn=103,fn=113,un=666,ln=(t,e)=>(t.msg=Lr[e],e),En=t=>(t<<1)-(t>4?9:0),_n=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let An=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask;const hn=t=>{const e=t.state;let r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))},Tn=(t,e)=>{vr(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,hn(t.strm)},Rn=(t,e)=>{t.pending_buf[t.pending++]=e},yn=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},In=(t,e,r,n)=>{let i=t.avail_in;return i>n&&(i=n),0===i?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),r),1===t.state.wrap?t.adler=wr(t.adler,e,i,r):2===t.state.wrap&&(t.adler=Br(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)},Nn=(t,e)=>{let r,n,i=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-an?t.strstart-(t.w_size-an):0,f=t.window,u=t.w_mask,l=t.prev,E=t.strstart+on;let _=f[s+o-1],A=f[s+o];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do{if(r=e,f[r+o]===A&&f[r+o-1]===_&&f[r]===f[s]&&f[++r]===f[s+1]){s+=2,r++;do{}while(f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&s<E);if(n=on-(E-s),s=E-on,n>o){if(t.match_start=e,o=n,n>=a)break;_=f[s+o-1],A=f[s+o]}}}while((e=l[e&u])>c&&0!=--i);return o<=t.lookahead?o:t.lookahead},Un=t=>{const e=t.w_size;let r,n,i,s,o;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-an)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,n=t.hash_size,r=n;do{i=t.head[--r],t.head[r]=i>=e?i-e:0}while(--n);n=e,r=n;do{i=t.prev[--r],t.prev[r]=i>=e?i-e:0}while(--n);s+=e}if(0===t.strm.avail_in)break;if(n=In(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=n,t.lookahead+t.insert>=3)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=An(t,t.ins_h,t.window[o+1]);t.insert&&(t.ins_h=An(t,t.ins_h,t.window[o+3-1]),t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<an&&0!==t.strm.avail_in)},Sn=(t,e)=>{let r,n;for(;;){if(t.lookahead<an){if(Un(t),t.lookahead<an&&e===xr)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=An(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-an&&(t.match_length=Nn(t,r)),t.match_length>=3)if(n=Xr(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=An(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=An(t,t.ins_h,t.window[t.strstart+1]);else n=Xr(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(Tn(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Zr?(Tn(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Tn(t,!1),0===t.strm.avail_out)?1:2},dn=(t,e)=>{let r,n,i;for(;;){if(t.lookahead<an){if(Un(t),t.lookahead<an&&e===xr)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=An(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-an&&(t.match_length=Nn(t,r),t.match_length<=5&&(t.strategy===Jr||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,n=Xr(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=An(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(Tn(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(n=Xr(t,0,t.window[t.strstart-1]),n&&Tn(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=Xr(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Zr?(Tn(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Tn(t,!1),0===t.strm.avail_out)?1:2};function mn(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}const On=[new mn(0,0,0,0,((t,e)=>{let r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Un(t),0===t.lookahead&&e===xr)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,Tn(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-an&&(Tn(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Zr?(Tn(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(Tn(t,!1),t.strm.avail_out),1)})),new mn(4,4,8,4,Sn),new mn(4,5,16,8,Sn),new mn(4,6,32,32,Sn),new mn(4,4,16,16,dn),new mn(8,16,32,32,dn),new mn(8,16,128,128,dn),new mn(8,32,128,256,dn),new mn(32,128,258,1024,dn),new mn(32,258,258,4096,dn)];function Mn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=sn,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),_n(this.dyn_ltree),_n(this.dyn_dtree),_n(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),_n(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),_n(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Fn=t=>{if(!t||!t.state)return ln(t,Wr);t.total_in=t.total_out=0,t.data_type=nn;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:fn,t.adler=2===e.wrap?0:1,e.last_flush=xr,gr(e),Kr},Cn=t=>{const e=Fn(t);var r;return e===Kr&&((r=t.state).window_size=2*r.w_size,_n(r.head),r.max_lazy_match=On[r.level].max_lazy,r.good_match=On[r.level].good_length,r.nice_match=On[r.level].nice_length,r.max_chain_length=On[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),e},bn=(t,e,r,n,i,s)=>{if(!t)return Wr;let o=1;if(e===$r&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),i<1||i>9||r!==sn||n<8||n>15||e<0||e>9||s<0||s>en)return ln(t,Wr);8===n&&(n=9);const a=new Mn;return t.state=a,a.strm=t,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=e,a.strategy=s,a.method=r,Cn(t)};var pn=(t,e)=>{let r=e.length;if(!t||!t.state)return Wr;const n=t.state,i=n.wrap;if(2===i||1===i&&42!==n.status||n.lookahead)return Wr;if(1===i&&(t.adler=wr(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){0===i&&(_n(n.head),n.strstart=0,n.block_start=0,n.insert=0);let t=new Uint8Array(n.w_size);t.set(e.subarray(r-n.w_size,r),0),e=t,r=n.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Un(n);n.lookahead>=3;){let t=n.strstart,e=n.lookahead-2;do{n.ins_h=An(n,n.ins_h,n.window[t+3-1]),n.prev[t&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=t,t++}while(--e);n.strstart=t,n.lookahead=2,Un(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,n.wrap=i,Kr},wn={deflateInit:(t,e)=>bn(t,e,sn,15,8,rn),deflateInit2:bn,deflateReset:Cn,deflateResetKeep:Fn,deflateSetHeader:(t,e)=>t&&t.state?2!==t.state.wrap?Wr:(t.state.gzhead=e,Kr):Wr,deflate:(t,e)=>{let r,n;if(!t||!t.state||e>Yr||e<0)return t?ln(t,Wr):Wr;const i=t.state;if(!t.output||!t.input&&0!==t.avail_in||i.status===un&&e!==Zr)return ln(t,0===t.avail_out?qr:Wr);i.strm=t;const s=i.last_flush;if(i.last_flush=e,42===i.status)if(2===i.wrap)t.adler=0,Rn(i,31),Rn(i,139),Rn(i,8),i.gzhead?(Rn(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Rn(i,255&i.gzhead.time),Rn(i,i.gzhead.time>>8&255),Rn(i,i.gzhead.time>>16&255),Rn(i,i.gzhead.time>>24&255),Rn(i,9===i.level?2:i.strategy>=Qr||i.level<2?4:0),Rn(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Rn(i,255&i.gzhead.extra.length),Rn(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=Br(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(Rn(i,0),Rn(i,0),Rn(i,0),Rn(i,0),Rn(i,0),Rn(i,9===i.level?2:i.strategy>=Qr||i.level<2?4:0),Rn(i,3),i.status=fn);else{let e=sn+(i.w_bits-8<<4)<<8,r=-1;r=i.strategy>=Qr||i.level<2?0:i.level<6?1:6===i.level?2:3,e|=r<<6,0!==i.strstart&&(e|=32),e+=31-e%31,i.status=fn,yn(i,e),0!==i.strstart&&(yn(i,t.adler>>>16),yn(i,65535&t.adler)),t.adler=1}if(69===i.status)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>r&&(t.adler=Br(t.adler,i.pending_buf,i.pending-r,r)),hn(t),r=i.pending,i.pending!==i.pending_buf_size));)Rn(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(t.adler=Br(t.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=Br(t.adler,i.pending_buf,i.pending-r,r)),hn(t),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}n=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Rn(i,n)}while(0!==n);i.gzhead.hcrc&&i.pending>r&&(t.adler=Br(t.adler,i.pending_buf,i.pending-r,r)),0===n&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=Br(t.adler,i.pending_buf,i.pending-r,r)),hn(t),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}n=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Rn(i,n)}while(0!==n);i.gzhead.hcrc&&i.pending>r&&(t.adler=Br(t.adler,i.pending_buf,i.pending-r,r)),0===n&&(i.status=cn)}else i.status=cn;if(i.status===cn&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&hn(t),i.pending+2<=i.pending_buf_size&&(Rn(i,255&t.adler),Rn(i,t.adler>>8&255),t.adler=0,i.status=fn)):i.status=fn),0!==i.pending){if(hn(t),0===t.avail_out)return i.last_flush=-1,Kr}else if(0===t.avail_in&&En(e)<=En(s)&&e!==Zr)return ln(t,qr);if(i.status===un&&0!==t.avail_in)return ln(t,qr);if(0!==t.avail_in||0!==i.lookahead||e!==xr&&i.status!==un){let r=i.strategy===Qr?((t,e)=>{let r;for(;;){if(0===t.lookahead&&(Un(t),0===t.lookahead)){if(e===xr)return 1;break}if(t.match_length=0,r=Xr(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(Tn(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Zr?(Tn(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Tn(t,!1),0===t.strm.avail_out)?1:2})(i,e):i.strategy===tn?((t,e)=>{let r,n,i,s;const o=t.window;for(;;){if(t.lookahead<=on){if(Un(t),t.lookahead<=on&&e===xr)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(i=t.strstart-1,n=o[i],n===o[++i]&&n===o[++i]&&n===o[++i])){s=t.strstart+on;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<s);t.match_length=on-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(r=Xr(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=Xr(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(Tn(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Zr?(Tn(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Tn(t,!1),0===t.strm.avail_out)?1:2})(i,e):On[i.level].func(i,e);if(3!==r&&4!==r||(i.status=un),1===r||3===r)return 0===t.avail_out&&(i.last_flush=-1),Kr;if(2===r&&(e===Vr?Hr(i):e!==Yr&&(Gr(i,0,0,!1),e===kr&&(_n(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),hn(t),0===t.avail_out))return i.last_flush=-1,Kr}return e!==Zr?Kr:i.wrap<=0?zr:(2===i.wrap?(Rn(i,255&t.adler),Rn(i,t.adler>>8&255),Rn(i,t.adler>>16&255),Rn(i,t.adler>>24&255),Rn(i,255&t.total_in),Rn(i,t.total_in>>8&255),Rn(i,t.total_in>>16&255),Rn(i,t.total_in>>24&255)):(yn(i,t.adler>>>16),yn(i,65535&t.adler)),hn(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?Kr:zr)},deflateEnd:t=>{if(!t||!t.state)return Wr;const e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&e!==cn&&e!==fn&&e!==un?ln(t,Wr):(t.state=null,e===fn?ln(t,jr):Kr)},deflateSetDictionary:pn,deflateInfo:"pako deflate (from Nodeca project)"};const Dn=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Bn=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const e in r)Dn(r,e)&&(t[e]=r[e])}}return t},Ln=t=>{let e=0;for(let r=0,n=t.length;r<n;r++)e+=t[r].length;const r=new Uint8Array(e);for(let e=0,n=0,i=t.length;e<i;e++){let i=t[e];r.set(i,n),n+=i.length}return r};let Pn=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Pn=!1}const gn=new Uint8Array(256);for(let t=0;t<256;t++)gn[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;gn[254]=gn[254]=1;var Gn=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,r,n,i,s,o=t.length,a=0;for(i=0;i<o;i++)r=t.charCodeAt(i),55296==(64512&r)&&i+1<o&&(n=t.charCodeAt(i+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),a+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)r=t.charCodeAt(i),55296==(64512&r)&&i+1<o&&(n=t.charCodeAt(i+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?e[s++]=r:r<2048?(e[s++]=192|r>>>6,e[s++]=128|63&r):r<65536?(e[s++]=224|r>>>12,e[s++]=128|r>>>6&63,e[s++]=128|63&r):(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63,e[s++]=128|r>>>6&63,e[s++]=128|63&r);return e},vn=(t,e)=>{const r=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let n,i;const s=new Array(2*r);for(i=0,n=0;n<r;){let e=t[n++];if(e<128){s[i++]=e;continue}let o=gn[e];if(o>4)s[i++]=65533,n+=o-1;else{for(e&=2===o?31:3===o?15:7;o>1&&n<r;)e=e<<6|63&t[n++],o--;o>1?s[i++]=65533:e<65536?s[i++]=e:(e-=65536,s[i++]=55296|e>>10&1023,s[i++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Pn)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r})(s,i)},Xn=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let r=e-1;for(;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?e:r+gn[t[r]]>e?r:e};var Hn=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const xn=Object.prototype.toString,{Z_NO_FLUSH:Vn,Z_SYNC_FLUSH:kn,Z_FULL_FLUSH:Zn,Z_FINISH:Yn,Z_OK:Kn,Z_STREAM_END:zn,Z_DEFAULT_COMPRESSION:Wn,Z_DEFAULT_STRATEGY:jn,Z_DEFLATED:qn}=Pr;function $n(t){this.options=Bn({level:Wn,method:qn,chunkSize:16384,windowBits:15,memLevel:8,strategy:jn},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hn,this.strm.avail_out=0;let r=wn.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Kn)throw new Error(Lr[r]);if(e.header&&wn.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?Gn(e.dictionary):"[object ArrayBuffer]"===xn.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,r=wn.deflateSetDictionary(this.strm,t),r!==Kn)throw new Error(Lr[r]);this.St=!0}}function Jn(t,e){const r=new $n(e);if(r.push(t,!0),r.err)throw r.msg||Lr[r.err];return r.result}$n.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=e===~~e?e:!0===e?Yn:Vn,"string"==typeof t?r.input=Gn(t):"[object ArrayBuffer]"===xn.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(s===kn||s===Zn)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(i=wn.deflate(r,s),i===zn)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=wn.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Kn;if(0!==r.avail_out){if(s>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},$n.prototype.onData=function(t){this.chunks.push(t)},$n.prototype.onEnd=function(t){t===Kn&&(this.result=Ln(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Qn={Deflate:$n,deflate:Jn,deflateRaw:function(t,e){return(e=e||{}).raw=!0,Jn(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,Jn(t,e)},constants:Pr};var ti=function(t,e){let r,n,i,s,o,a,c,f,u,l,E,_,A,h,T,R,y,I,N,U,S,d,m,O;const M=t.state;r=t.next_in,m=t.input,n=r+(t.avail_in-5),i=t.next_out,O=t.output,s=i-(e-t.avail_out),o=i+(t.avail_out-257),a=M.dmax,c=M.wsize,f=M.whave,u=M.wnext,l=M.window,E=M.hold,_=M.bits,A=M.lencode,h=M.distcode,T=(1<<M.lenbits)-1,R=(1<<M.distbits)-1;t:do{_<15&&(E+=m[r++]<<_,_+=8,E+=m[r++]<<_,_+=8),y=A[E&T];e:for(;;){if(I=y>>>24,E>>>=I,_-=I,I=y>>>16&255,0===I)O[i++]=65535&y;else{if(!(16&I)){if(0==(64&I)){y=A[(65535&y)+(E&(1<<I)-1)];continue e}if(32&I){M.mode=12;break t}t.msg="invalid literal/length code",M.mode=30;break t}N=65535&y,I&=15,I&&(_<I&&(E+=m[r++]<<_,_+=8),N+=E&(1<<I)-1,E>>>=I,_-=I),_<15&&(E+=m[r++]<<_,_+=8,E+=m[r++]<<_,_+=8),y=h[E&R];r:for(;;){if(I=y>>>24,E>>>=I,_-=I,I=y>>>16&255,!(16&I)){if(0==(64&I)){y=h[(65535&y)+(E&(1<<I)-1)];continue r}t.msg="invalid distance code",M.mode=30;break t}if(U=65535&y,I&=15,_<I&&(E+=m[r++]<<_,_+=8,_<I&&(E+=m[r++]<<_,_+=8)),U+=E&(1<<I)-1,U>a){t.msg="invalid distance too far back",M.mode=30;break t}if(E>>>=I,_-=I,I=i-s,U>I){if(I=U-I,I>f&&M.sane){t.msg="invalid distance too far back",M.mode=30;break t}if(S=0,d=l,0===u){if(S+=c-I,I<N){N-=I;do{O[i++]=l[S++]}while(--I);S=i-U,d=O}}else if(u<I){if(S+=c+u-I,I-=u,I<N){N-=I;do{O[i++]=l[S++]}while(--I);if(S=0,u<N){I=u,N-=I;do{O[i++]=l[S++]}while(--I);S=i-U,d=O}}}else if(S+=u-I,I<N){N-=I;do{O[i++]=l[S++]}while(--I);S=i-U,d=O}for(;N>2;)O[i++]=d[S++],O[i++]=d[S++],O[i++]=d[S++],N-=3;N&&(O[i++]=d[S++],N>1&&(O[i++]=d[S++]))}else{S=i-U;do{O[i++]=O[S++],O[i++]=O[S++],O[i++]=O[S++],N-=3}while(N>2);N&&(O[i++]=O[S++],N>1&&(O[i++]=O[S++]))}break}}break}}while(r<n&&i<o);N=_>>3,r-=N,_-=N<<3,E&=(1<<_)-1,t.next_in=r,t.next_out=i,t.avail_in=r<n?n-r+5:5-(r-n),t.avail_out=i<o?o-i+257:257-(i-o),M.hold=E,M.bits=_};const ei=15,ri=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ni=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ii=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),si=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var oi=(t,e,r,n,i,s,o,a)=>{const c=a.bits;let f,u,l,E,_,A,h=0,T=0,R=0,y=0,I=0,N=0,U=0,S=0,d=0,m=0,O=null,M=0;const F=new Uint16Array(16),C=new Uint16Array(16);let b,p,w,D=null,B=0;for(h=0;h<=ei;h++)F[h]=0;for(T=0;T<n;T++)F[e[r+T]]++;for(I=c,y=ei;y>=1&&0===F[y];y--);if(I>y&&(I=y),0===y)return i[s++]=20971520,i[s++]=20971520,a.bits=1,0;for(R=1;R<y&&0===F[R];R++);for(I<R&&(I=R),S=1,h=1;h<=ei;h++)if(S<<=1,S-=F[h],S<0)return-1;if(S>0&&(0===t||1!==y))return-1;for(C[1]=0,h=1;h<ei;h++)C[h+1]=C[h]+F[h];for(T=0;T<n;T++)0!==e[r+T]&&(o[C[e[r+T]]++]=T);if(0===t?(O=D=o,A=19):1===t?(O=ri,M-=257,D=ni,B-=257,A=256):(O=ii,D=si,A=-1),m=0,T=0,h=R,_=s,N=I,U=0,l=-1,d=1<<I,E=d-1,1===t&&d>852||2===t&&d>592)return 1;for(;;){b=h-U,o[T]<A?(p=0,w=o[T]):o[T]>A?(p=D[B+o[T]],w=O[M+o[T]]):(p=96,w=0),f=1<<h-U,u=1<<N,R=u;do{u-=f,i[_+(m>>U)+u]=b<<24|p<<16|w|0}while(0!==u);for(f=1<<h-1;m&f;)f>>=1;if(0!==f?(m&=f-1,m+=f):m=0,T++,0==--F[h]){if(h===y)break;h=e[r+o[T]]}if(h>I&&(m&E)!==l){for(0===U&&(U=I),_+=R,N=h-U,S=1<<N;N+U<y&&(S-=F[N+U],!(S<=0));)N++,S<<=1;if(d+=1<<N,1===t&&d>852||2===t&&d>592)return 1;l=m&E,i[l]=I<<24|N<<16|_-s|0}}return 0!==m&&(i[_+m]=h-U<<24|64<<16|0),a.bits=I,0};const{Z_FINISH:ai,Z_BLOCK:ci,Z_TREES:fi,Z_OK:ui,Z_STREAM_END:li,Z_NEED_DICT:Ei,Z_STREAM_ERROR:_i,Z_DATA_ERROR:Ai,Z_MEM_ERROR:hi,Z_BUF_ERROR:Ti,Z_DEFLATED:Ri}=Pr,yi=12,Ii=30,Ni=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Ui(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Si=t=>{if(!t||!t.state)return _i;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,ui},di=t=>{if(!t||!t.state)return _i;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Si(t)},mi=(t,e)=>{let r;if(!t||!t.state)return _i;const n=t.state;return e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?_i:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,di(t))},Oi=(t,e)=>{if(!t)return _i;const r=new Ui;t.state=r,r.window=null;const n=mi(t,e);return n!==ui&&(t.state=null),n};let Mi,Fi,Ci=!0;const bi=t=>{if(Ci){Mi=new Int32Array(512),Fi=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(oi(1,t.lens,0,288,Mi,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;oi(2,t.lens,0,32,Fi,0,t.work,{bits:5}),Ci=!1}t.lencode=Mi,t.lenbits=9,t.distcode=Fi,t.distbits=5},pi=(t,e,r,n)=>{let i;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>n&&(i=n),s.window.set(e.subarray(r-n,r-n+i),s.wnext),(n-=i)?(s.window.set(e.subarray(r-n,r),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var wi=(t,e)=>{let r,n,i,s,o,a,c,f,u,l,E,_,A,h,T,R,y,I,N,U,S,d,m=0;const O=new Uint8Array(4);let M,F;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return _i;r=t.state,r.mode===yi&&(r.mode=13),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,n=t.input,a=t.avail_in,f=r.hold,u=r.bits,l=a,E=c,d=ui;t:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;u<16;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}if(2&r.wrap&&35615===f){r.check=0,O[0]=255&f,O[1]=f>>>8&255,r.check=Br(r.check,O,2,0),f=0,u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&f)<<8)+(f>>8))%31){t.msg="incorrect header check",r.mode=Ii;break}if((15&f)!==Ri){t.msg="unknown compression method",r.mode=Ii;break}if(f>>>=4,u-=4,S=8+(15&f),0===r.wbits)r.wbits=S;else if(S>r.wbits){t.msg="invalid window size",r.mode=Ii;break}r.dmax=1<<r.wbits,t.adler=r.check=1,r.mode=512&f?10:yi,f=0,u=0;break;case 2:for(;u<16;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}if(r.flags=f,(255&r.flags)!==Ri){t.msg="unknown compression method",r.mode=Ii;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=Ii;break}r.head&&(r.head.text=f>>8&1),512&r.flags&&(O[0]=255&f,O[1]=f>>>8&255,r.check=Br(r.check,O,2,0)),f=0,u=0,r.mode=3;case 3:for(;u<32;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}r.head&&(r.head.time=f),512&r.flags&&(O[0]=255&f,O[1]=f>>>8&255,O[2]=f>>>16&255,O[3]=f>>>24&255,r.check=Br(r.check,O,4,0)),f=0,u=0,r.mode=4;case 4:for(;u<16;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}r.head&&(r.head.xflags=255&f,r.head.os=f>>8),512&r.flags&&(O[0]=255&f,O[1]=f>>>8&255,r.check=Br(r.check,O,2,0)),f=0,u=0,r.mode=5;case 5:if(1024&r.flags){for(;u<16;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}r.length=f,r.head&&(r.head.extra_len=f),512&r.flags&&(O[0]=255&f,O[1]=f>>>8&255,r.check=Br(r.check,O,2,0)),f=0,u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(_=r.length,_>a&&(_=a),_&&(r.head&&(S=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(s,s+_),S)),512&r.flags&&(r.check=Br(r.check,n,_,s)),a-=_,s+=_,r.length-=_),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===a)break t;_=0;do{S=n[s+_++],r.head&&S&&r.length<65536&&(r.head.name+=String.fromCharCode(S))}while(S&&_<a);if(512&r.flags&&(r.check=Br(r.check,n,_,s)),a-=_,s+=_,S)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===a)break t;_=0;do{S=n[s+_++],r.head&&S&&r.length<65536&&(r.head.comment+=String.fromCharCode(S))}while(S&&_<a);if(512&r.flags&&(r.check=Br(r.check,n,_,s)),a-=_,s+=_,S)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;u<16;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}if(f!==(65535&r.check)){t.msg="header crc mismatch",r.mode=Ii;break}f=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=yi;break;case 10:for(;u<32;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}t.adler=r.check=Ni(f),f=0,u=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,r.hold=f,r.bits=u,Ei;t.adler=r.check=1,r.mode=yi;case yi:if(e===ci||e===fi)break t;case 13:if(r.last){f>>>=7&u,u-=7&u,r.mode=27;break}for(;u<3;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}switch(r.last=1&f,f>>>=1,u-=1,3&f){case 0:r.mode=14;break;case 1:if(bi(r),r.mode=20,e===fi){f>>>=2,u-=2;break t}break;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=Ii}f>>>=2,u-=2;break;case 14:for(f>>>=7&u,u-=7&u;u<32;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}if((65535&f)!=(f>>>16^65535)){t.msg="invalid stored block lengths",r.mode=Ii;break}if(r.length=65535&f,f=0,u=0,r.mode=15,e===fi)break t;case 15:r.mode=16;case 16:if(_=r.length,_){if(_>a&&(_=a),_>c&&(_=c),0===_)break t;i.set(n.subarray(s,s+_),o),a-=_,s+=_,c-=_,o+=_,r.length-=_;break}r.mode=yi;break;case 17:for(;u<14;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}if(r.nlen=257+(31&f),f>>>=5,u-=5,r.ndist=1+(31&f),f>>>=5,u-=5,r.ncode=4+(15&f),f>>>=4,u-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=Ii;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;u<3;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}r.lens[C[r.have++]]=7&f,f>>>=3,u-=3}for(;r.have<19;)r.lens[C[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,M={bits:r.lenbits},d=oi(0,r.lens,0,19,r.lencode,0,r.work,M),r.lenbits=M.bits,d){t.msg="invalid code lengths set",r.mode=Ii;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;m=r.lencode[f&(1<<r.lenbits)-1],T=m>>>24,R=m>>>16&255,y=65535&m,!(T<=u);){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}if(y<16)f>>>=T,u-=T,r.lens[r.have++]=y;else{if(16===y){for(F=T+2;u<F;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}if(f>>>=T,u-=T,0===r.have){t.msg="invalid bit length repeat",r.mode=Ii;break}S=r.lens[r.have-1],_=3+(3&f),f>>>=2,u-=2}else if(17===y){for(F=T+3;u<F;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}f>>>=T,u-=T,S=0,_=3+(7&f),f>>>=3,u-=3}else{for(F=T+7;u<F;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}f>>>=T,u-=T,S=0,_=11+(127&f),f>>>=7,u-=7}if(r.have+_>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=Ii;break}for(;_--;)r.lens[r.have++]=S}}if(r.mode===Ii)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=Ii;break}if(r.lenbits=9,M={bits:r.lenbits},d=oi(1,r.lens,0,r.nlen,r.lencode,0,r.work,M),r.lenbits=M.bits,d){t.msg="invalid literal/lengths set",r.mode=Ii;break}if(r.distbits=6,r.distcode=r.distdyn,M={bits:r.distbits},d=oi(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,M),r.distbits=M.bits,d){t.msg="invalid distances set",r.mode=Ii;break}if(r.mode=20,e===fi)break t;case 20:r.mode=21;case 21:if(a>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,r.hold=f,r.bits=u,ti(t,E),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,n=t.input,a=t.avail_in,f=r.hold,u=r.bits,r.mode===yi&&(r.back=-1);break}for(r.back=0;m=r.lencode[f&(1<<r.lenbits)-1],T=m>>>24,R=m>>>16&255,y=65535&m,!(T<=u);){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}if(R&&0==(240&R)){for(I=T,N=R,U=y;m=r.lencode[U+((f&(1<<I+N)-1)>>I)],T=m>>>24,R=m>>>16&255,y=65535&m,!(I+T<=u);){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}f>>>=I,u-=I,r.back+=I}if(f>>>=T,u-=T,r.back+=T,r.length=y,0===R){r.mode=26;break}if(32&R){r.back=-1,r.mode=yi;break}if(64&R){t.msg="invalid literal/length code",r.mode=Ii;break}r.extra=15&R,r.mode=22;case 22:if(r.extra){for(F=r.extra;u<F;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}r.length+=f&(1<<r.extra)-1,f>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;m=r.distcode[f&(1<<r.distbits)-1],T=m>>>24,R=m>>>16&255,y=65535&m,!(T<=u);){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}if(0==(240&R)){for(I=T,N=R,U=y;m=r.distcode[U+((f&(1<<I+N)-1)>>I)],T=m>>>24,R=m>>>16&255,y=65535&m,!(I+T<=u);){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}f>>>=I,u-=I,r.back+=I}if(f>>>=T,u-=T,r.back+=T,64&R){t.msg="invalid distance code",r.mode=Ii;break}r.offset=y,r.extra=15&R,r.mode=24;case 24:if(r.extra){for(F=r.extra;u<F;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}r.offset+=f&(1<<r.extra)-1,f>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=Ii;break}r.mode=25;case 25:if(0===c)break t;if(_=E-c,r.offset>_){if(_=r.offset-_,_>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=Ii;break}_>r.wnext?(_-=r.wnext,A=r.wsize-_):A=r.wnext-_,_>r.length&&(_=r.length),h=r.window}else h=i,A=o-r.offset,_=r.length;_>c&&(_=c),c-=_,r.length-=_;do{i[o++]=h[A++]}while(--_);0===r.length&&(r.mode=21);break;case 26:if(0===c)break t;i[o++]=r.length,c--,r.mode=21;break;case 27:if(r.wrap){for(;u<32;){if(0===a)break t;a--,f|=n[s++]<<u,u+=8}if(E-=c,t.total_out+=E,r.total+=E,E&&(t.adler=r.check=r.flags?Br(r.check,i,E,o-E):wr(r.check,i,E,o-E)),E=c,(r.flags?f:Ni(f))!==r.check){t.msg="incorrect data check",r.mode=Ii;break}f=0,u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;u<32;){if(0===a)break t;a--,f+=n[s++]<<u,u+=8}if(f!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=Ii;break}f=0,u=0}r.mode=29;case 29:d=li;break t;case Ii:d=Ai;break t;case 31:return hi;default:return _i}return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,r.hold=f,r.bits=u,(r.wsize||E!==t.avail_out&&r.mode<Ii&&(r.mode<27||e!==ai))&&pi(t,t.output,t.next_out,E-t.avail_out),l-=t.avail_in,E-=t.avail_out,t.total_in+=l,t.total_out+=E,r.total+=E,r.wrap&&E&&(t.adler=r.check=r.flags?Br(r.check,i,E,t.next_out-E):wr(r.check,i,E,t.next_out-E)),t.data_type=r.bits+(r.last?64:0)+(r.mode===yi?128:0)+(20===r.mode||15===r.mode?256:0),(0===l&&0===E||e===ai)&&d===ui&&(d=Ti),d},Di={inflateReset:di,inflateReset2:mi,inflateResetKeep:Si,inflateInit:t=>Oi(t,15),inflateInit2:Oi,inflate:wi,inflateEnd:t=>{if(!t||!t.state)return _i;let e=t.state;return e.window&&(e.window=null),t.state=null,ui},inflateGetHeader:(t,e)=>{if(!t||!t.state)return _i;const r=t.state;return 0==(2&r.wrap)?_i:(r.head=e,e.done=!1,ui)},inflateSetDictionary:(t,e)=>{const r=e.length;let n,i,s;return t&&t.state?(n=t.state,0!==n.wrap&&11!==n.mode?_i:11===n.mode&&(i=1,i=wr(i,e,r,0),i!==n.check)?Ai:(s=pi(t,e,r,r),s?(n.mode=31,hi):(n.havedict=1,ui))):_i},inflateInfo:"pako inflate (from Nodeca project)"};var Bi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Li=Object.prototype.toString,{Z_NO_FLUSH:Pi,Z_FINISH:gi,Z_OK:Gi,Z_STREAM_END:vi,Z_NEED_DICT:Xi,Z_STREAM_ERROR:Hi,Z_DATA_ERROR:xi,Z_MEM_ERROR:Vi}=Pr;function ki(t){this.options=Bn({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hn,this.strm.avail_out=0;let r=Di.inflateInit2(this.strm,e.windowBits);if(r!==Gi)throw new Error(Lr[r]);if(this.header=new Bi,Di.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Gn(e.dictionary):"[object ArrayBuffer]"===Li.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=Di.inflateSetDictionary(this.strm,e.dictionary),r!==Gi)))throw new Error(Lr[r])}function Zi(t,e){const r=new ki(e);if(r.push(t),r.err)throw r.msg||Lr[r.err];return r.result}ki.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=e===~~e?e:!0===e?gi:Pi,"[object ArrayBuffer]"===Li.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),s=Di.inflate(r,o),s===Xi&&i&&(s=Di.inflateSetDictionary(r,i),s===Gi?s=Di.inflate(r,o):s===xi&&(s=Xi));r.avail_in>0&&s===vi&&r.state.wrap>0&&0!==t[r.next_in];)Di.inflateReset(r),s=Di.inflate(r,o);switch(s){case Hi:case xi:case Xi:case Vi:return this.onEnd(s),this.ended=!0,!1}if(a=r.avail_out,r.next_out&&(0===r.avail_out||s===vi))if("string"===this.options.to){let t=Xn(r.output,r.next_out),e=r.next_out-t,i=vn(r.output,t);r.next_out=e,r.avail_out=n-e,e&&r.output.set(r.output.subarray(t,t+e),0),this.onData(i)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(s!==Gi||0!==a){if(s===vi)return s=Di.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},ki.prototype.onData=function(t){this.chunks.push(t)},ki.prototype.onEnd=function(t){t===Gi&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ln(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Yi={Inflate:ki,inflate:Zi,inflateRaw:function(t,e){return(e=e||{}).raw=!0,Zi(t,e)},ungzip:Zi,constants:Pr};const{Deflate:Ki,deflate:zi,deflateRaw:Wi,gzip:ji}=Qn,{Inflate:qi,inflate:$i,inflateRaw:Ji,ungzip:Qi}=Yi;var ts={Deflate:Ki,deflate:zi,deflateRaw:Wi,gzip:ji,Inflate:qi,inflate:$i,inflateRaw:Ji,ungzip:Qi,constants:Pr},es=5,rs=11,ns=13,is=14;function ss(t,e,r,n){var i=t|e<<8,s=i>>11&31,o=i>>5&63,a=31&i;return r[n+0]=s<<3|s>>2,r[n+1]=o<<2|o>>4,r[n+2]=a<<3|a>>2,r[n+3]=255,i}var os=new Uint8Array(16),as=new Uint8Array(16);function cs(t,e,r,n){var i=0;0!=(6&n)&&(i=8),function(t,e,r,n){for(var i=ss(e[r+0],e[r+1],os,0),s=ss(e[r+2],e[r+3],os,4),o=0;o<3;o++){var a=os[o],c=os[4+o];n&&i<=s?(os[8+o]=(a+c)/2,os[12+o]=0):(os[8+o]=(2*a+c)/3,os[12+o]=(a+2*c)/3)}for(os[11]=255,os[15]=n&&i<=s?0:255,o=0;o<4;++o){var f=e[r+4+o];as[4*o+0]=3&f,as[4*o+1]=f>>2&3,as[4*o+2]=f>>4&3,as[4*o+3]=f>>6&3}for(o=0;o<16;++o)for(var u=4*as[o],l=0;l<4;++l)t[4*o+l]=os[u+l]}(t,e,r+i,0!=(1&n)),0!=(2&n)?function(t,e,r){for(var n=0;n<8;++n){var i=bytes[r+n],s=15&i,o=240&i;t[8*n+3]=s|s<<4,t[8*n+7]=o|o>>4}}(t,0,r):0!=(4&n)&&function(t,e,r){var n=e[r+0],i=e[r+1];if(os[0]=n,os[1]=i,n<=i){for(var s=1;s<5;++s)os[1+s]=((5-s)*n+s*i)/5;os[6]=0,os[7]=255}else for(s=1;s<7;++s)os[1+s]=((7-s)*n+s*i)/7;r+=2;var o=0;for(s=0;s<2;++s){for(var a=0,c=0;c<3;++c)a|=e[r++]<<8*c;for(c=0;c<8;++c){var f=a>>3*c&7;as[o++]=f}}for(s=0;s<16;++s)t[4*s+3]=os[as[s]]}(t,e,r)}var fs=new Uint16Array(4);\n/*! @brief Decompresses an image in memory.\n\n   @param rgba\t\tStorage for the decompressed pixels.\n   @param width\tThe width of the source image.\n   @param height\tThe height of the source image.\n   @param blocks\tThe compressed DXT blocks.\n   @param flags\tCompression flags.\n\n   The decompressed pixels will be written as a contiguous array of width*height\n   16 rgba values, with each component as 1 byte each. In memory this is:\n\n   { r1, g1, b1, a1, .... , rn, gn, bn, an } for n = width*height\n\n   The flags parameter should specify either kDxt1, kDxt3 or kDxt5 compression,\n   however, DXT1 will be used by default if none is specified. All other flags\n   are ignored.\n\n   Internally this function calls squish::Decompress for each block.\n   */\nvar us=new Uint8Array(64);function ls(t){}function Es(){}ls.decode=function(t,e,r,n,i){if(null!=t&&null!=n&&0!=r&&0!=e){var s=0;1&(s=i>11||5===i?4:33)&&32&s?function(t,e,r,n){for(var i=t,s=0,o=0,a=0,c=0,f=0,u=0,l=0,E=0,_=0,A=e/4,h=r/4,T=0;T<h;T++)for(var R=0;R<A;R++)a=4*((h-T)*A+R),fs[0]=n[a],fs[1]=n[a+1],c=31&fs[0],f=2016&fs[0],u=63488&fs[0],l=31&fs[1],E=2016&fs[1],_=63488&fs[1],fs[2]=5*c+3*l>>3|5*f+3*E>>3&2016|5*u+3*_>>3&63488,fs[3]=5*l+3*c>>3|5*E+3*f>>3&2016|5*_+3*u>>3&63488,s=n[a+2],i[o=4*T*e+4*R]=fs[3&s],i[o+1]=fs[s>>2&3],i[o+2]=fs[s>>4&3],i[o+3]=fs[s>>6&3],i[o+=e]=fs[s>>8&3],i[o+1]=fs[s>>10&3],i[o+2]=fs[s>>12&3],i[o+3]=fs[s>>14],s=n[a+3],i[o+=e]=fs[3&s],i[o+1]=fs[s>>2&3],i[o+2]=fs[s>>4&3],i[o+3]=fs[s>>6&3],i[o+=e]=fs[s>>8&3],i[o+1]=fs[s>>10&3],i[o+2]=fs[s>>12&3],i[o+3]=fs[s>>14]}(t,e,r,n):function(t,e,r,n,i,s){for(var o=0!=(1&i)?8:16,a=0,c=0;c<r;c+=4)for(var f=0;f<e;f+=4){cs(us,n,a,i);for(var u=0,l=0;l<4;++l)for(var E=0;E<4;++E){var _=f+E,A=c+l;if(_<e&&A<r){var h=4*(e*(r-A)+_);if(s===ns||s===is)t[h+2]=us[u++],t[h+1]=us[u++],t[h+0]=us[u++],t[h+3]=us[u++];else for(var T=0;T<4;++T)t[h++]=us[u++]}else u+=4}a+=o}}(t,e,r,n,s,i)}},Es.s3tc=!0,Es.pvrtc=!1,Es.etc1=!1;let _s=1,As=2;const hs=10,Ts=11,Rs=1,ys=2,Is=16,Ns=32;function Us(t,e,r){r=t.byteLength;return t=t.subarray(0,0+r),new TextDecoder("utf-8").decode(t)}function Ss(t,e,r){let n=e.getUint32(r,!0);return r+=Uint32Array.BYTES_PER_ELEMENT,{string:Us(new Uint8Array(t,r,n)),bytesOffset:r+=n}}function ds(t,e,r,n){let i={},s=[],o=new Array(16);for(let t=0;t<16;t++)o[t]=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT;i.matrix=o,i.skeletonNames=s;let a=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let n=0;n<a;n++){let n=Ss(t,e,r);s.push(n.string),r=n.bytesOffset}return n.push(i),r}function ms(t,e,r,n){let i={};i.rangeList=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,i.rangeMode=e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT;let s={};s.x=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,s.y=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,s.z=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT;let o=e.getFloat64(r,!0);r+=Float64Array.BYTES_PER_ELEMENT,i.boundingSphere={center:s,radius:o};let a=Ss(t,e,r),c=a.string;r=a.bytesOffset;let f=c.indexOf("Geometry");if(-1!==f){let t=c.substring(f);c=c.replace(t,"")}i.childTile=c,i.geodes=[];let u=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let n=0;n<u;n++)r=ds(t,e,r,i.geodes);return n.push(i),r}function Os(t,e,r,n){let i=e.getUint32(r,!0);if(n.verticesCount=i,(r+=Uint32Array.BYTES_PER_ELEMENT)<=0)return r;let s=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;let o=e.getUint16(r,!0);o=s*Float32Array.BYTES_PER_ELEMENT,r+=Uint16Array.BYTES_PER_ELEMENT;let a=i*s*Float32Array.BYTES_PER_ELEMENT,c=new Uint8Array(t,r,a);r+=a;let f=n.vertexAttributes,u=n.attrLocation;return u.aPosition=f.length,f.push({index:u.aPosition,typedArray:c,componentsPerAttribute:s,componentDatatype:5126,offsetInBytes:0,strideInBytes:o,normalize:!1}),r}function Ms(t,e,r,n){let i=e.getUint32(r,!0);if(r+=Uint32Array.BYTES_PER_ELEMENT,i<=0)return r;let s=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;let o=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;let a=i*s*Float32Array.BYTES_PER_ELEMENT,c=new Uint8Array(t,r,a);r+=a;let f=n.vertexAttributes,u=n.attrLocation;return u.aNormal=f.length,f.push({index:u.aNormal,typedArray:c,componentsPerAttribute:s,componentDatatype:5126,offsetInBytes:0,strideInBytes:o,normalize:!1}),r}function Fs(t,e,r,n){let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let s,o=n.verticesCount;if(i>0){e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT,r+=2*Uint8Array.BYTES_PER_ELEMENT;let n=i*Uint8Array.BYTES_PER_ELEMENT*4;s=new Uint8Array(t,r,n).slice(0,n),r+=n}else{s=new Uint8Array(4*o);for(let t=0;t<o;t++)s[4*t]=255,s[4*t+1]=255,s[4*t+2]=255,s[4*t+3]=255}let a=n.vertexAttributes,c=n.attrLocation;return c.aColor=a.length,a.push({index:c.aColor,typedArray:s,componentsPerAttribute:4,componentDatatype:5121,offsetInBytes:0,strideInBytes:4,normalize:!0}),n.vertexColor=s,r}function Cs(t,e,r,n){let i=e.getUint32(r,!0);if(r+=Uint32Array.BYTES_PER_ELEMENT,i<=0)return r;e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT,r+=2*Uint8Array.BYTES_PER_ELEMENT;let s=i*Uint8Array.BYTES_PER_ELEMENT*4,o=new Uint8Array(t,r,s);r+=s;let a=n.vertexAttributes,c=n.attrLocation;return c.aSecondColor=a.length,a.push({index:c.aSecondColor,typedArray:o,componentsPerAttribute:4,componentDatatype:5121,offsetInBytes:0,strideInBytes:4,normalize:!0}),r}function bs(t,e,r,n){let i=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,r+=Uint16Array.BYTES_PER_ELEMENT;for(let s=0;s<i;s++){let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let o=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT;let a=i*o*Float32Array.BYTES_PER_ELEMENT,c=new Uint8Array(t,r,a);r+=a;let f="aTexCoord"+s,u=n.vertexAttributes,l=n.attrLocation;l[f]=u.length,u.push({index:l[f],typedArray:c,componentsPerAttribute:o,componentDatatype:5126,offsetInBytes:0,strideInBytes:o*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}return r}function ps(t,e,r,n){let i=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,r+=Uint16Array.BYTES_PER_ELEMENT;let s=n.vertexAttributes,o=n.attrLocation;for(let a=0;a<i;a++){let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let a=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT;let c=i*a*Float32Array.BYTES_PER_ELEMENT;if(17===a){let e=new Uint8Array(t,r,c);n.instanceCount=i,n.instanceMode=a,n.instanceBuffer=e,n.instanceIndex=1;let f,u=a*i*4,l=e.slice(0,u);n.vertexColorInstance=l,17===a?(f=17*Float32Array.BYTES_PER_ELEMENT,o.uv2=s.length,s.push({index:o.uv2,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:0,strideInBytes:f,instanceDivisor:1}),o.uv3=s.length,s.push({index:o.uv3,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1}),o.uv4=s.length,s.push({index:o.uv4,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1}),o.secondary_colour=s.length,s.push({index:o.secondary_colour,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1}),o.uv6=s.length,s.push({index:o.uv6,componentsPerAttribute:4,componentDatatype:5121,normalize:!0,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1})):29===a&&(f=29*Float32Array.BYTES_PER_ELEMENT,o.uv1=s.length,s.push({index:o.uv1,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:0,strideInBytes:f,instanceDivisor:1,byteLength:c}),o.uv2=s.length,s.push({index:o.uv2,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1}),o.uv3=s.length,s.push({index:o.uv3,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1}),o.uv4=s.length,s.push({index:o.uv4,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1}),o.uv5=s.length,s.push({index:o.uv5,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1}),o.uv6=s.length,s.push({index:o.uv6,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1}),o.uv7=s.length,s.push({index:o.uv7,componentsPerAttribute:3,componentDatatype:5126,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1}),o.secondary_colour=s.length,s.push({index:o.secondary_colour,componentsPerAttribute:4,componentDatatype:5121,normalize:!0,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1}),o.uv9=s.length,s.push({index:o.uv9,componentsPerAttribute:4,componentDatatype:5121,normalize:!0,offsetInBytes:28*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f,instanceDivisor:1}))}else{let t=i*a;n.instanceBounds=new Float32Array(t);for(let i=0;i<t;i++)n.instanceBounds[i]=e.getFloat32(r+i*Float32Array.BYTES_PER_ELEMENT,!0)}r+=c}return r}function ws(t,e,r,n){return r=ps(t,e,r=bs(t,e,r=Cs(t,e,r=Fs(t,e,r=Ms(t,e,r=Os(t,e,r,n),n),n),n),n),n)}function Ds(t,e,r,n){let i=e.getUint32(r,!0);return n.compressOptions=i,r+=Uint32Array.BYTES_PER_ELEMENT,r=(i&Rs)===Rs?function(t,e,r,n){let i=e.getUint32(r,!0);if(n.verticesCount=i,(r+=Uint32Array.BYTES_PER_ELEMENT)<=0)return r;let s=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;let o=e.getUint16(r,!0);o=s*Int16Array.BYTES_PER_ELEMENT,r+=Uint16Array.BYTES_PER_ELEMENT;let a=e.getFloat32(r,!0);r+=Float32Array.BYTES_PER_ELEMENT;let c={};c.x=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,c.y=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,c.z=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,c.w=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,n.vertCompressConstant=a,n.minVerticesValue=c;let f=i*s*Int16Array.BYTES_PER_ELEMENT,u=new Uint8Array(t,r,f);r+=f;let l=n.vertexAttributes,E=n.attrLocation;return E.aPosition=l.length,l.push({index:E.aPosition,typedArray:u,componentsPerAttribute:s,componentDatatype:5122,offsetInBytes:0,strideInBytes:o,normalize:!1}),r}(t,e,r,n):Os(t,e,r,n),r=(i&ys)===ys?function(t,e,r,n){let i=e.getUint32(r,!0);if(r+=Uint32Array.BYTES_PER_ELEMENT,i<=0)return r;e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT;let s=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;let o=2*i*Int16Array.BYTES_PER_ELEMENT,a=new Uint8Array(t,r,o);r+=o;let c=n.vertexAttributes,f=n.attrLocation;return f.aNormal=c.length,c.push({index:f.aNormal,typedArray:a,componentsPerAttribute:2,componentDatatype:5122,offsetInBytes:0,strideInBytes:s,normalize:!1}),r}(t,e,r,n):Ms(t,e,r,n),r=Cs(t,e,r=Fs(t,e,r,n),n),r=(i&Is)===Is?function(t,e,r,n){n.texCoordCompressConstant=[],n.minTexCoordValue=[];let i=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,r+=Uint16Array.BYTES_PER_ELEMENT;for(let s=0;s<i;s++){let i=e.getUint8(r,!0);r+=Uint8Array.BYTES_PER_ELEMENT,r+=3*Uint8Array.BYTES_PER_ELEMENT;let o=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let a=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT;let c=e.getFloat32(r,!0);r+=Float32Array.BYTES_PER_ELEMENT,n.texCoordCompressConstant.push(c);let f={};f.x=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,f.y=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,f.z=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,f.w=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,n.minTexCoordValue.push(f);let u=o*a*Int16Array.BYTES_PER_ELEMENT,l=new Uint8Array(t,r,u),E=(r+=u)%4;0!==E&&(r+=4-E);let _="aTexCoord"+s,A=n.vertexAttributes,h=n.attrLocation;if(h[_]=A.length,A.push({index:h[_],typedArray:l,componentsPerAttribute:a,componentDatatype:5122,offsetInBytes:0,strideInBytes:a*Int16Array.BYTES_PER_ELEMENT,normalize:!1}),i){u=o*Float32Array.BYTES_PER_ELEMENT;let e=new Uint8Array(t,r,u);r+=u,n.texCoordZMatrix=!0,_="aTexCoordZ"+s,h[_]=A.length,A.push({index:h[_],typedArray:e,componentsPerAttribute:1,componentDatatype:5126,offsetInBytes:0,strideInBytes:Float32Array.BYTES_PER_ELEMENT,normalize:!1})}}return r}(t,e,r,n):bs(t,e,r,n),(i&Ns)===Ns&&(n.textureCoordIsW=!0),r=ps(t,e,r,n)}function Bs(t,e,r,n){let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let s=0;s<i;s++){let i={},s=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let o=e.getUint8(r,!0);r+=Uint8Array.BYTES_PER_ELEMENT,e.getUint8(r,!0),r+=Uint8Array.BYTES_PER_ELEMENT;let a=e.getUint8(r,!0);if(r+=Uint8Array.BYTES_PER_ELEMENT,r+=Uint8Array.BYTES_PER_ELEMENT,s>0){let e,n=null;1===o||3===o?(e=s*Uint32Array.BYTES_PER_ELEMENT,n=new Uint8Array(t,r,e)):(e=s*Uint16Array.BYTES_PER_ELEMENT,n=new Uint8Array(t,r,e),s%2!=0&&(e+=2)),i.indicesTypedArray=n,r+=e}i.indicesCount=s,i.indexType=o,i.primitiveType=a;let c=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let n=0;n<c;n++){let n=Ss(t,e,r),s=n.string;r=n.bytesOffset,i.materialCode=s}if(0!==r%4){r+=4-r%4}n.push(i)}return r}let Ls={red:0,green:0,blue:0,alpha:0};function Ps(t,e,r){let n=t.vertexAttributes,i=t.attrLocation,s=n.length;i[1===r?"instanceId":"batchId"]=s,n.push({index:s,typedArray:e,componentsPerAttribute:1,componentDatatype:5126,offsetInBytes:0,strideInBytes:0,instanceDivisor:r})}Es.parseBuffer=function(t){let e=0,r={version:void 0,groupNode:void 0,geoPackage:{},matrials:void 0,texturePackage:{}},n=new DataView(t);r.version=n.getFloat32(e,!0),e+=Float32Array.BYTES_PER_ELEMENT,r.version>=2&&(n.getUint32(e,!0),e+=Uint32Array.BYTES_PER_ELEMENT),n.getUint32(e,!0),e+=Uint32Array.BYTES_PER_ELEMENT;let i=function(t,e){let r=new Uint8Array(t,e);return ts.inflate(r).buffer}(t,e);n=new DataView(i),e=0;let s=n.getUint32(e,!0);return e+=Uint32Array.BYTES_PER_ELEMENT,e=function(t,e,r,n){let i={},s=[];e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;let o=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let n=0;n<o;n++)r=ms(t,e,r,s);i.pageLods=s;let a=r%4;return 0!==a&&(r+=4-a),n.groupNode=i,r}(i,n,e,r),e=function(t,e,r,n){e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let s=0;s<i;s++){let i=Ss(t,e,r),s=i.string,o=(r=i.bytesOffset)%4;0!==o&&(r+=4-o);let a=e.getUint32(r,!0);r+=Int32Array.BYTES_PER_ELEMENT;let c={vertexAttributes:[],attrLocation:{},instanceCount:0,instanceMode:0,instanceIndex:-1};a===_s?r=ws(t,e,r,c):a===As&&(r=Ds(t,e,r,c));let f,u=[];r=Bs(t,e,r,u),2===u.length&&13===u[1].primitiveType&&u[1].indicesCount>=3&&(f=S3MEdgeProcessor.createEdgeDataByIndices(c,u[1])),n[s]={vertexPackage:c,arrIndexPackage:u,edgeGeometry:f}}return r+=e.getUint32(r,!0),r+Uint32Array.BYTES_PER_ELEMENT}(i,n,e,r.geoPackage),e=function(t,e,r,n){e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let s=0;s<i;s++){let i=Ss(t,e,r),s=i.string,o=(r=i.bytesOffset)%4;0!==o&&(r+=4-o),e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;let a=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let c=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let f=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let u=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let l=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let E=new Uint8Array(t,r,u);r+=u;let _=l===hs||l===Ts?33776:33779;if(22===f&&(_=36196),!Es.s3tc&&(33776===_||33779===_)){let t=new Uint8Array(a*c*4);ls.decode(t,a,c,E,l),E=t,f=0,_=l===hs||l===hs?273:4369}n[s]={id:s,width:a,height:c,compressType:f,nFormat:l,internalFormat:_,arrayBufferView:E}}return r}(i,n,e,r.texturePackage),e=function(t,e,r,n){let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let s=Us(new Uint8Array(t,r,i));return r+=i,n.materials=JSON.parse(s),r}(i,n,e,r),function(t,e,r,n,i,s){if(1==(1&n)){e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;let n=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let o=0;o<n;o++){let n=Ss(t,e,r),o=n.string;r=n.bytesOffset;let a=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let c={};if(i[o].pickInfo=c,-1==i[o].vertexPackage.instanceIndex){let t=new Float32Array(i[o].vertexPackage.verticesCount);for(let n=0;n<a;n++){let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let s=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let o=[];for(let i=0;i<s;i++){let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let s=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT,t.fill(n,i,i+s),o.push({vertexColorOffset:i,vertexColorCount:s,batchId:n})}c[i]=o}Ps(i[o].vertexPackage,t,void 0)}else{let t=i[o].vertexPackage.instanceCount,n=i[o].vertexPackage.instanceBuffer,f=i[o].vertexPackage.instanceMode,u=new Float32Array(t),l=[];for(let t=0;t<a;t++){let t=e.getUint32(r,!0);l.push(t),r+=Uint32Array.BYTES_PER_ELEMENT;let n=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let t=0;t<n;t++)e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT,3===s&&(e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT)}let E=17===f?16:28;E*=Float32Array.BYTES_PER_ELEMENT;for(let e=0;e<t;e++){u[e]=e;let t=e*f*Float32Array.BYTES_PER_ELEMENT+E;Cesium.Color.unpack(n,t,Ls);let r=2===s?l[e]:Ls.red+256*Ls.green+65536*Ls.blue;void 0===c[r]&&(c[r]={vertexColorCount:1,instanceIds:[],vertexColorOffset:e}),c[r].instanceIds.push(e)}Ps(i[o].vertexPackage,u,1)}}}}(i,n,e,s,r.geoPackage,r.version),r};class gs{constructor(t,e,{width:r,height:n,colorDepth:i,format:s}){if(this.format=s,this.offset=e,this.depth=i,this.stride=\n/*!\n   * decode-bmp\n   * https://github.com/LinusU/decode-bmp\n   * MIT License\n   */\nfunction(t){const e=t%4;return e?t+4-e:t}(r*this.depth/8),this.size=this.stride*n,this.data=t.subarray(this.offset,this.offset+this.size),this.size!==this.data.byteLength)throw new Error("Truncated bitmap data")}get(t,e,r){const n=this.format.indexOf(r);if(1===this.depth){return(this.data[e*this.stride+(t/8|0)]&1<<7-t%8*1)>>7-t%8*1}if(2===this.depth){return(this.data[e*this.stride+(t/4|0)]&3<<6-t%4*2)>>>6-t%4*2}if(4===this.depth){return(this.data[e*this.stride+(t/2|0)]&15<<4-t%2*4)>>>4-t%2*4}return this.data[e*this.stride+t*(this.depth/8)+n]}}function Gs(t,e,r,n,{width:i=0,height:s=0,icon:o=!1}={}){const a=new DataView(e,r,n);let c,f,u,l,E;o?(c=a.getUint32(0,!0),f=a.getUint32(4,!0)/1|0,u=a.getUint32(8,!0)/2|0,l=a.getUint16(14,!0),E=a.getUint32(32,!0)):(!function(t){if(19778!==t)throw new Error(`Invalid magic byte 0x${t.toString(16)}`)}(a.getUint16(0,!0)),c=14+a.getUint32(14,!0),f=a.getUint32(18,!0),u=a.getUint32(22,!0),l=a.getUint16(28,!0),E=a.getUint32(46,!0)),0===E&&l<=8&&(E=1<<l);const _=0===f?i:f,A=0===u?s:u,h=new Uint8Array(a.buffer,a.byteOffset+c,a.byteLength-c),T=t.byteLength===_*A*4,R=E?function(t,e,r,{width:n,height:i,colorDepth:s,colorCount:o,icon:a}){if(8!==s&&4!==s&&2!==s&&1!==s)throw new Error(`A color depth of ${s} is not supported`);const c=new gs(r,0,{width:o,height:1,colorDepth:32,format:"BGRA"}),f=new gs(r,c.offset+c.size,{width:n,height:i,colorDepth:s,format:"C"}),u=a?new gs(r,f.offset+f.size,{width:n,height:i,colorDepth:1,format:"A"}):null,l=t;let E=0;for(let t=0;t<i;t++)for(let r=0;r<n;r++){const n=f.get(r,i-t-1,"C");l[E++]=c.get(n,0,"R"),l[E++]=c.get(n,0,"G"),l[E++]=c.get(n,0,"B"),e&&(l[E++]=u&&u.get(r,i-t-1,"A")?0:255)}return l}(t,T,h,{width:_,height:A,colorDepth:l,colorCount:E,icon:o}):function(t,e,r,{width:n,height:i,colorDepth:s,icon:o}){if(32!==s&&24!==s)throw new Error(`A color depth of ${s} is not supported`);const a=new gs(r,0,{width:n,height:i,colorDepth:s,format:"BGRA"}),c=24===s&&o?new gs(r,a.offset+a.size,{width:n,height:i,colorDepth:1,format:"A"}):null,f=t;let u=0;for(let t=0;t<i;t++)for(let r=0;r<n;r++)f[u++]=a.get(r,i-t-1,"R"),f[u++]=a.get(r,i-t-1,"G"),f[u++]=a.get(r,i-t-1,"B"),e&&(f[u++]=32===s?a.get(r,i-t-1,"A"):c&&c.get(r,i-t-1,"A")?0:255);return f}(t,T,h,{width:_,height:A,colorDepth:l,icon:o});return R}var vs=Object.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_WEBGL:37808,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_BPTC_UNORM:36492,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047}),Xs={UNSIGNED_BYTE:vs.UNSIGNED_BYTE,UNSIGNED_SHORT:vs.UNSIGNED_SHORT,UNSIGNED_INT:vs.UNSIGNED_INT,FLOAT:vs.FLOAT,HALF_FLOAT:vs.HALF_FLOAT_OES,UNSIGNED_INT_24_8:vs.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:vs.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:vs.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:vs.UNSIGNED_SHORT_5_6_5,toWebGLConstant:function(t,e){switch(t){case Xs.UNSIGNED_BYTE:return vs.UNSIGNED_BYTE;case Xs.UNSIGNED_SHORT:return vs.UNSIGNED_SHORT;case Xs.UNSIGNED_INT:return vs.UNSIGNED_INT;case Xs.FLOAT:return vs.FLOAT;case Xs.HALF_FLOAT:return e.webgl2?vs.HALF_FLOAT:vs.HALF_FLOAT_OES;case Xs.UNSIGNED_INT_24_8:return vs.UNSIGNED_INT_24_8;case Xs.UNSIGNED_SHORT_4_4_4_4:return vs.UNSIGNED_SHORT_4_4_4_4;case Xs.UNSIGNED_SHORT_5_5_5_1:return vs.UNSIGNED_SHORT_5_5_5_1;case Xs.UNSIGNED_SHORT_5_6_5:return Xs.UNSIGNED_SHORT_5_6_5}},isPacked:function(t){return t===Xs.UNSIGNED_INT_24_8||t===Xs.UNSIGNED_SHORT_4_4_4_4||t===Xs.UNSIGNED_SHORT_5_5_5_1||t===Xs.UNSIGNED_SHORT_5_6_5},sizeInBytes:function(t){switch(t){case Xs.UNSIGNED_BYTE:return 1;case Xs.UNSIGNED_SHORT:case Xs.UNSIGNED_SHORT_4_4_4_4:case Xs.UNSIGNED_SHORT_5_5_5_1:case Xs.UNSIGNED_SHORT_5_6_5:case Xs.HALF_FLOAT:return 2;case Xs.UNSIGNED_INT:case Xs.FLOAT:case Xs.UNSIGNED_INT_24_8:return 4}},validate:function(t){return t===Xs.UNSIGNED_BYTE||t===Xs.UNSIGNED_SHORT||t===Xs.UNSIGNED_INT||t===Xs.FLOAT||t===Xs.HALF_FLOAT||t===Xs.UNSIGNED_INT_24_8||t===Xs.UNSIGNED_SHORT_4_4_4_4||t===Xs.UNSIGNED_SHORT_5_5_5_1||t===Xs.UNSIGNED_SHORT_5_6_5}},Hs=Object.freeze(Xs),xs={DEPTH_COMPONENT:vs.DEPTH_COMPONENT,DEPTH_STENCIL:vs.DEPTH_STENCIL,ALPHA:vs.ALPHA,RGB:vs.RGB,RGBA:vs.RGBA,LUMINANCE:vs.LUMINANCE,LUMINANCE_ALPHA:vs.LUMINANCE_ALPHA,RGB_DXT1:vs.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:vs.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:vs.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:vs.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:vs.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:vs.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:vs.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:vs.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGBA_ASTC:vs.COMPRESSED_RGBA_ASTC_4x4_WEBGL,RGB_ETC1:vs.COMPRESSED_RGB_ETC1_WEBGL,RGB8_ETC2:vs.COMPRESSED_RGB8_ETC2,RGBA8_ETC2_EAC:vs.COMPRESSED_RGBA8_ETC2_EAC,RGBA_BC7:vs.COMPRESSED_RGBA_BPTC_UNORM,componentsLength:function(t){switch(t){case xs.RGB:return 3;case xs.RGBA:return 4;case xs.LUMINANCE_ALPHA:return 2;case xs.ALPHA:case xs.LUMINANCE:default:return 1}},validate:function(t){return t===xs.DEPTH_COMPONENT||t===xs.DEPTH_STENCIL||t===xs.ALPHA||t===xs.RGB||t===xs.RGBA||t===xs.LUMINANCE||t===xs.LUMINANCE_ALPHA||t===xs.RGB_DXT1||t===xs.RGBA_DXT1||t===xs.RGBA_DXT3||t===xs.RGBA_DXT5||t===xs.RGB_PVRTC_4BPPV1||t===xs.RGB_PVRTC_2BPPV1||t===xs.RGBA_PVRTC_4BPPV1||t===xs.RGBA_PVRTC_2BPPV1||t===xs.RGBA_ASTC||t===xs.RGB_ETC1||t===xs.RGB8_ETC2||t===xs.RGBA8_ETC2_EAC||t===xs.RGBA_BC7},isColorFormat:function(t){return t===xs.ALPHA||t===xs.RGB||t===xs.RGBA||t===xs.LUMINANCE||t===xs.LUMINANCE_ALPHA},isDepthFormat:function(t){return t===xs.DEPTH_COMPONENT||t===xs.DEPTH_STENCIL},isCompressedFormat:function(t){return t===xs.RGB_DXT1||t===xs.RGBA_DXT1||t===xs.RGBA_DXT3||t===xs.RGBA_DXT5||t===xs.RGB_PVRTC_4BPPV1||t===xs.RGB_PVRTC_2BPPV1||t===xs.RGBA_PVRTC_4BPPV1||t===xs.RGBA_PVRTC_2BPPV1||t===xs.RGBA_ASTC||t===xs.RGB_ETC1||t===xs.RGB8_ETC2||t===xs.RGBA8_ETC2_EAC||t===xs.RGBA_BC7},isDXTFormat:function(t){return t===xs.RGB_DXT1||t===xs.RGBA_DXT1||t===xs.RGBA_DXT3||t===xs.RGBA_DXT5},isPVRTCFormat:function(t){return t===xs.RGB_PVRTC_4BPPV1||t===xs.RGB_PVRTC_2BPPV1||t===xs.RGBA_PVRTC_4BPPV1||t===xs.RGBA_PVRTC_2BPPV1},isASTCFormat:function(t){return t===xs.RGBA_ASTC},isETC1Format:function(t){return t===xs.RGB_ETC1},isETC2Format:function(t){return t===xs.RGB8_ETC2||t===xs.RGBA8_ETC2_EAC},isBC7Format:function(t){return t===xs.RGBA_BC7},compressedTextureSizeInBytes:function(t,e,r){switch(t){case xs.RGB_DXT1:case xs.RGBA_DXT1:case xs.RGB_ETC1:case xs.RGB8_ETC2:return Math.floor((e+3)/4)*Math.floor((r+3)/4)*8;case xs.RGBA_DXT3:case xs.RGBA_DXT5:case xs.RGBA_ASTC:case xs.RGBA8_ETC2_EAC:return Math.floor((e+3)/4)*Math.floor((r+3)/4)*16;case xs.RGB_PVRTC_4BPPV1:case xs.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(e,8)*Math.max(r,8)*4+7)/8);case xs.RGB_PVRTC_2BPPV1:case xs.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(e,16)*Math.max(r,8)*2+7)/8);case xs.RGBA_BC7:return Math.ceil(e/4)*Math.ceil(r/4)*16;default:return 0}},textureSizeInBytes:function(t,e,r,n){var i=xs.componentsLength(t);return Hs.isPacked(e)&&(i=1),i*Hs.sizeInBytes(e)*r*n},alignmentInBytes:function(t,e,r){var n=xs.textureSizeInBytes(t,e,r,1)%4;return 0===n?4:2===n?2:1},createTypedArray:function(t,e,r,n){var i=Hs.sizeInBytes(e);return new(i===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:i===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:i===Float32Array.BYTES_PER_ELEMENT&&e===Hs.FLOAT?Float32Array:Uint32Array)(xs.componentsLength(t)*r*n)},flipY:function(t,e,r,n,i){if(1===i)return t;for(var s=xs.createTypedArray(e,r,n,i),o=xs.componentsLength(e),a=n*o,c=0;c<i;++c)for(var f=c*n*o,u=(i-c-1)*n*o,l=0;l<a;++l)s[u+l]=t[f+l];return s},toInternalFormat:function(t,e,r){if(!r.webgl2)return t;if(t===xs.DEPTH_STENCIL)return vs.DEPTH24_STENCIL8;if(t===xs.DEPTH_COMPONENT){if(e===Hs.UNSIGNED_SHORT)return vs.DEPTH_COMPONENT16;if(e===Hs.UNSIGNED_INT)return vs.DEPTH_COMPONENT24}if(e===Hs.FLOAT)switch(t){case xs.RGBA:return vs.RGBA32F;case xs.RGB:return vs.RGB32F;case xs.RG:return vs.RG32F;case xs.R:return vs.R32F}if(e===Hs.HALF_FLOAT)switch(t){case xs.RGBA:return vs.RGBA16F;case xs.RGB:return vs.RGB16F;case xs.RG:return vs.RG16F;case xs.R:return vs.R16F}return t}},Vs=Object.freeze(xs);function ks(t,e,r,n,i,s){const o=function(t,e,r,n){let i=t.length,s=r,o=n,a=0;for(;s>0&&o>0;){if(a+=Vs.compressedTextureSizeInBytes(e,s,o),s>>=1,o>>=1,0===s&&0===o)break;s=Math.max(s,1),o=Math.max(o,1)}return a===i}(t,r,i,s);if(!o)return null;const a=6410===r||4369===r;let c=0,f=i,u=s;const l=[];do{let n=Vs.compressedTextureSizeInBytes(r,f,u),i=new Uint8Array(t.buffer,e+c,n);l.push(i),f=Math.max(f>>1,1),u=Math.max(u>>1,1),c+=n}while(c<t.byteLength&&o);return{flipY:a,mipmap:l}}function Zs(t,e){for(var r,n,i,s=t.bytesOffset,o=Es.parseBuffer(t.buffer,s),a=o.geoPackage,c=o.groupNode.pageLods,f=[],u=[],l=[],E=[],_=[],A=[],h=[],T=c[0].geodes[0].matrix,R={},y=0;y<o.materials.material.length;y++)R[o.materials.material[y].material.id]=o.materials.material[y].material;var I=Number.MAX_VALUE,N=Number.MAX_VALUE,U=Number.MAX_VALUE,S=Number.MIN_VALUE,d=Number.MIN_VALUE,m=Number.MIN_VALUE;for(var O in a){var M=a[O].vertexPackage;r=M.verticesCount;var F=M.vertexAttributes[0].typedArray.buffer,C=M.vertexAttributes[0].typedArray.byteOffset,b=M.vertexAttributes[0].componentsPerAttribute;i=new Float32Array(F,M.vertexAttributes[0].offsetInBytes+C,r*b);for(let t=0;t<r;t++){var p=i[t*b],w=i[t*b+1],D=i[t*b+2];I=Math.min(I,p),N=Math.min(N,w),U=Math.min(U,D),S=Math.max(S,p),d=Math.max(d,w),m=Math.max(m,D)}f.push(i),ho("aTexCoord0",M,F,r,l),ho("batchId",M,F,r,_),M.vertexColor?E.push(M.vertexColor):E.push(void 0);var B=a[O].arrIndexPackage[0].indicesTypedArray,L=B.byteLength/a[O].arrIndexPackage[0].indicesCount;n=new(4===L?Uint32Array:2===L?Uint16Array:Uint8Array)(B.buffer,(a[O].arrIndexPackage[0].bytesOffset||0)+B.byteOffset,a[O].arrIndexPackage[0].indicesCount),u.push(n),n.length,h.push(r);var P=a[O].arrIndexPackage[0].materialCode;A.push(R[P])}var g=[I,N,U],G=[S,d,m];const v=function(t,e,r,n,i,s,o,a,c,f,u,l,E,_,A){let h=0;for(const t in a)a[t].width*a[t].height*4>h&&(h=a[t].width*a[t].height*4);(!Ks||h>Ks)&&(Ys=new Uint8ClampedArray(h+122),Ks=h);const T=[],R={magFilter:9729,minFilter:9729,wrapS:10497,wrapT:10497},y={},I={},N=[],U=[],S=[];for(let c=0;c<r.length;c++){const h=e[c],d=t[c],m=r[c],O=i&&i[c]&&i[c],M=n&&n[c]&&n[c],F=s&&s[c]&&s[c],C=o&&o[c]&&o[c],b={POSITION:{array:m,componentType:5126,count:d,byteOffset:m.byteOffset,byteStride:0,byteLength:m.byteLength,type:ue(m.length/d),itemSize:m.length/d,name:"POSITION",min:f,max:u}};N.indexOf(m.buffer)<0&&N.push(m.buffer),O&&To(b,"TEXCOORD_0",O,d,N),M&&To(b,"NORMAL",M,d,N),F&&To(b,"COLOR_0",F,d,N),C&&To(b,"_BATCHID",C,d,N);const p={attributes:b,material:c,indices:{array:h.slice(),itemSize:1,byteLength:h.byteLength,byteOffset:0,byteStride:0,name:h,count:h.length,componentType:5123},mode:4};N.push(p.indices.array.buffer);const w={primitives:[p],index:c};I[c]=w;const D={mesh:c,nodeIndex:c,matrix:A};y[c]=D,U.push({nodes:[D]});const B=E[c],L={uFillForeColor:[1,1,1,1]};let P=B.ambient;L.ambientColor=[P.r,P.g,P.b,P.a];let g=B.diffuse;L.uDiffuseColor=[g.r,g.g,g.b,g.a];let G=B.specular;L.specularColor=[G.r,G.g,G.b,G.a],L.shininess=B.shininess,L.bTransparentSorting=B.transparentsorting;let v=B.textureunitstates;if(v.length){L.uTexMatrix=v[0].textureunitstate.texmodmatrix;const t=a[v[0].textureunitstate.id];if(L.uTexture0Width=t.width,v[1]){const t=a[v[1].textureunitstate.id];L.uTexture1Width=t.width}}S.push({pbrMetallicRoughness:{baseColorFactor:[.8,.8,.8,1],metallicFactor:0,roughnessFactor:.5},extensions:{KHR_techniques_webgl:{technique:0,values:L}}}),T.push(js(c,E,l,a,_).then((t=>{if(!t)return null;const{array:e,mipmap:r,width:n,height:i,format:s,flipY:o}=t;if(e&&N.indexOf(e.buffer)<0&&N.push(e.buffer),r)for(let t=0;t<r.length;t++)e&&N.indexOf(r[t].buffer)<0&&N.push(r[t].buffer);let a=R;return r&&(a={magFilter:R.magFilter,minFilter:9987,wrapS:R.wrapS,wrapT:R.wrapT}),{materialIndex:c,image:{mipmap:r,array:e,flipY:!!o,width:n,height:i,mimeType:"image/bmp"},sampler:a,format:s,source:c}})))}return Promise.all(T).then((t=>{t=t.filter((t=>!!t));for(let e=0;e<t.length;e++){const{materialIndex:r}=t[e];let n="uTexture";S[r].extensions.KHR_techniques_webgl.values.uTexture&&(n="uTexture2"),S[r].extensions.KHR_techniques_webgl.values[n]={"index":e,"texCoord":r},delete t[e].materialIndex}return{transferables:N,gltf:{"asset":{"generator":"S3M","version":"2.0"},"scene":0,"scenes":U,"nodes":y,"meshes":I,"materials":S,"skins":[],"animations":null,"textures":t,"transferables":[{},{},{},{},{}]}}}))}(h,u,f,null,l,E,_,o.texturePackage,0,g,G,[],A,e,T);return v.then((({gltf:t,transferables:e})=>({gltf:t,featureTable:{"BATCH_LENGTH":0},transferables:e,pageLods:c})))}Es.multiplyByPoint=function(t,e,r){var n=e.x,i=e.y,s=e.z,o=t[0]*n+t[4]*i+t[8]*s+t[12],a=t[1]*n+t[5]*i+t[9]*s+t[13],c=t[2]*n+t[6]*i+t[10]*s+t[14];return r.x=o,r.y=a,r.z=c,r};let Ys,Ks=0;let zs=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(ln){}t&&"undefined"!=typeof createImageBitmap&&(zs=!0)}const Ws={};function js(t,e,r,n,i){const s=Ys;return new Promise((function(r){!function(t){if(e[t].textureunitstates[0]){var o=e[t].textureunitstates[0].textureunitstate.id,a=n[o],c=a.arrayBufferView,f=a.nFormat,u=a.internalFormat;if(function(t){return t===ro||t===no||t===io||t===so||t===oo||t===ao||t===co||t===fo||t===uo||t===lo||t===Eo||t===_o||t===Ao}(u)&&a.width===a.height){const t=ks(c,c.byteOffset,u,0,a.width,a.height);if(t){const{mipmap:e,flipY:n}=t;return void r({format:u,mipmap:e,flipY:n,width:a.width,height:a.height})}}let l;l=f>rs||f===es?122+a.width*a.height*4:61+a.width*a.height,ls.decode(s.subarray(122),a.width,a.height,c,f),function(t,e,r){var n=r*(4*e+e%4),i=n+o,s=new DataView(t),o=0;s.setUint16(o,19778,!0),o+=2,s.setUint32(o,i,!0),o+=4,s.setUint32(o,0,!0),o+=4,s.setUint32(o,122,!0),o+=4,s.setUint32(o,108,!0),o+=4,s.setUint32(o,e,!0),o+=4,s.setUint32(o,r,!0),o+=4,s.setUint16(o,1,!0),o+=2,s.setUint16(o,32,!0),o+=2,s.setUint32(o,this.compress,!0),o+=4,s.setUint32(o,n,!0),o+=4,s.setUint32(o,2835,!0),o+=4,s.setUint32(o,2835,!0),o+=4,s.setUint8(o,0,!0),o+=4,s.setUint32(o,0,!0),o+=4,s.setUint32(o,16711680,!0),o+=4,s.setUint32(o,65280,!0),o+=4,s.setUint32(o,255,!0),o+=4,s.setUint32(o,4278190080,!0),o+=4,s.setUint32(o,1466527264,!0),o+=4}(s.buffer,a.width,a.height);let{width:E,height:_}=a;qs(E)||(E=$s(E)),qs(_)||(_=$s(_));const A=i;let h;A&&(E=Math.min(A,E),_=Math.min(A,_));let T=6408;const R=a.width*a.height*4;!zs||E===a.width&&_===a.height?(h=new Uint8Array(3*R/4),T=6407):(Ws[R]||(Ws[R]=new Uint8Array(R)),h=Ws[R]),h=Gs(h,s.buffer,0,l),!zs||E===a.width&&_===a.height||(h=function(t,e,r,n,i){Js||(Js=new OffscreenCanvas(2,2),Qs=Js.getContext("2d"),to=new OffscreenCanvas(2,2),eo=to.getContext("2d"));const s=new ImageData(new Uint8ClampedArray(t.buffer),e,r);return Js.width=e,Js.height=r,Qs.putImageData(s,0,0),to.width=n,to.height=i,eo.drawImage(Js,0,0,n,i),eo.getImageData(0,0,n,i).data}(h,a.width,a.height,E,_)),h.buffer===(Ws[R]&&Ws[R].buffer)&&(h=new Uint8Array(h)),r({array:h,width:E,height:_,format:T})}else r(null)}(t)}))}function qs(t){return 0==(t&t-1)&&0!==t}function $s(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}let Js,Qs,to,eo;const ro=33776,no=33777,io=33778,so=33779,oo=35840,ao=35841,co=35842,fo=35843,uo=37808,lo=36196,Eo=37492,_o=37496,Ao=36492;function ho(t,e,r,n,i){var s,o=e.attrLocation[t];if(o){const t=e.vertexAttributes[o];if(t.typedArray.buffer!==r)i.push(t.typedArray);else{var a=t.componentsPerAttribute;var c=new(s=t.componentDatatype,ce[s])(r,t.offsetInBytes+t.typedArray.byteOffset,n*a);i.push(c)}}else i.push(void 0)}function To(t,e,r,n,i){t[e]={array:r,componentType:fe(r.constructor),count:n,byteOffset:r.byteOffset,byteStride:0,byteLength:r.byteLength,type:ue(r.length/n),itemSize:r.length/n,name:e},i.indexOf(r.buffer)<0&&i.push(r.buffer)}var Ro=So("DXT1"),yo=So("DXT3"),Io=So("DXT5"),No=So("DX10"),Uo=function(t){var e,r,n=new Int32Array(t,0,31);if(542327876!==n[0])throw new Error("Invalid magic number in DDS header");if(4&!n[20])throw new Error("Unsupported format, must contain a FourCC code");var i=n[21];switch(i){case Ro:e=8,r="dxt1";break;case yo:e=16,r="dxt3";break;case Io:e=16,r="dxt5";break;case 116:r="rgba32f";break;case No:var s=new Uint32Array(t.slice(128,148));r=s[0];var o=s[1];if(s[2],s[3],s[4],3!==o||2!==r)throw new Error("Unsupported DX10 texture format "+r);r="rgba32f";break;default:throw new Error("Unsupported FourCC code: "+(a=i,String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)))}var a;var c=n[2],f=1;131072&c&&(f=Math.max(1,n[7]));var u=!1;512&n[28]&&(u=!0);var l,E=n[4],_=n[3],A=n[1]+4,h=E,T=_,R=[];i===No&&(A+=20);if(u)for(var y=0;y<6;y++){if("rgba32f"!==r)throw new Error("Only RGBA32f cubemaps are supported");E=h,_=T;for(var I=Math.log(E)/Math.log(2)+1,N=0;N<I;N++)l=E*_*16,R.push({offset:A,length:l,shape:[E,_]}),N<f&&(A+=l),E=Math.floor(E/2),_=Math.floor(_/2)}else for(N=0;N<f;N++)l=Math.max(4,E)/4*Math.max(4,_)/4*e,R.push({offset:A,length:l,shape:[E,_]}),A+=l,E=Math.floor(E/2),_=Math.floor(_/2);return{shape:[h,T],images:R,format:r,flags:c,cubemap:u}};function So(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}const mo=Math.PI/180,Oo=6378137*Math.PI/180,Mo=85.0511287798;function Fo(t,e,r){if("EPSG:3857"===r)return function(t,e){const r=Mo,n=e[0],i=Math.max(Math.min(r,e[1]),-r);let s;s=0===i?0:Math.log(Math.tan((90+i)*mo/2))/mo;return t[0]=n*Oo,t[1]=s*Oo,t}(t,e);if("EPSG:4326"===r||"EPSG:4490"===r||"identity"===r)return Co(t,e);if("baidu"===r)return Co(t,e);throw new Error("unsupported projection:"+r)}function Co(t,e){return t[0]=e[0],t[1]=e[1],t}const bo=s([]),po=_e.draco&&_e.draco(),wo=_e.ktx2&&_e.ktx2(),Do={"pbrMetallicRoughness":{"baseColorFactor":[.5,.5,.5,1],"metallicFactor":0,"roughnessFactor":.5}},Bo={"position":{name:"POSITION",accessor:{"componentType":5126,"type":"VEC3"}},"normal":{name:"NORMAL",accessor:{"componentType":5126,"type":"VEC3"}},"uv0":{name:"TEXCOORD_0",accessor:{"componentType":5126,"type":"VEC2"}},"color":{name:"COLOR_0",accessor:{"componentType":5121,"type":"VEC4"}},"uv-region":{name:"uvRegion",accessor:{"componentType":5123,"type":"VEC4"}},"feature-index":{name:"_BATCHID",accessor:{"componentType":5125,"type":"SCALAR"}},"faceRange":{name:"faceRange",accessor:{"componentType":5125,"type":"VEC2"}}};function Lo(t,e,r,n){const i=[],o=[],a=[];for(let e=0;e<t.meshes.length;e++){const{geometry:r,material:n}=t.meshes[e];let s=K.getArrayBuffer(r.url);s.xhr.url=r.url,a.push(s.xhr);const c=s.then((t=>({buffer:t})));i.push(c);const f=[];if(Vo(n,f),f.length){const t=f.map((t=>{const e=K.getArrayBuffer(t.url);return e.xhr.url=t.url,a.push(e.xhr),e.then((e=>e&&e.status?null:{buffer:e,mimeType:t.mimeType,format:t.format}))}));i.push(...t)}o[e]=f.length}const c=Promise.all(i).then((i=>{for(let t=0;t<i.length;t++)if(!i[t]||!i[t].buffer)return Promise.resolve(null);const a=[];let c=0;for(let t=0;t<o.length;t++){const e=o[t];a.push({geoBuffer:{data:i[c].buffer.data},textureBuffers:i.slice(c+1,e+c+1).map((t=>({data:t.buffer.data,mimeType:t.mimeType,format:t.format})))}),c+=1+e}const f=function(t,e,r,n,i){const o={asset:{generator:"i3s",version:"2.0"},extensions:{},scene:0,scenes:[{nodes:[]}],nodes:{},meshes:{},materials:[],skins:[],animations:null,textures:[],transferables:[]},a=[];for(let c=0;c<t.meshes.length;c++){let f,{geometry:u,material:l}=t.meshes[c];const E=e[c].geoBuffer.data;if(!E)continue;f=Wo(E)?go(o,c,u,E,t.transform,t.center,i):vo(o,c,u,E,t.transform,t.center,i),a.push(f),o.nodes[c]={mesh:c,nodeIndex:c,matrix:s([])},o.scenes[0].nodes[c]=o.nodes[c],l||(l=Do);const _=Ho(c,o,l,e[c].textureBuffers,r,n);a.push(_)}return Promise.all(a).then((()=>({gltf:o,featureTable:{BATCH_LENGTH:0},transferables:o.transferables})))}(t,a,e,n,r);return f}));return c.xhr=a,c}const Po={"magFilter":9728,"minFilter":9728,"wrapR":33071,"wrapS":33071,"wrapT":33071};function go(t,e,r,n,i,s,o){const a=r.info.compressedAttributes.attributes.reduce(((t,e,r)=>{const n=Bo[e];if(!n)return t;return t[n.name||e]=r,t}),{});return po(n,{attributes:a,metadatas:{"POSITION":[{name:"i3s-scale_x",type:"double"},{name:"i3s-scale_y",type:"double"}]},useUniqueIDs:!1,skipAttributeTransform:!1}).then((r=>Xo(r,t,e,i,s,o)))}var Go={position:function(t,e,r){const n=3*t.vertexCount,i=new Float32Array(e,r,n);return t.position={array:i,componentType:5126,itemSize:3,count:n/3,meta:{"i3s-scale_x":1,"i3s-scale_y":1},type:"VEC3"},r+=4*n},normal:function(t,e,r){var n=3*t.vertexCount;const i=new Float32Array(e,r,n);return t.normal={array:i,componentType:5126,itemSize:3,count:n/3,type:"VEC3"},r+=4*n},uv0:function(t,e,r){var n=2*t.vertexCount;const i=new Float32Array(e,r,n);return t.uv0={array:i,componentType:5126,itemSize:2,count:n/2,type:"VEC2"},r+=4*n},color:function(t,e,r){var n=4*t.vertexCount;const i=new Uint8Array(e,r,n);return t.color={array:i,componentType:5121,itemSize:4,count:n/4,type:"VEC4"},r+=n},featureId:function(t,e,r){return r+=8*t.featureCount},id:function(t,e,r){return r+=8*t.featureCount},faceRange:function(t,e,r){var n=2*t.featureCount;const i=new Uint32Array(e,r,n);return t.faceRange={array:i,componentType:5125,itemSize:2,count:n/2,type:"VEC2"},r+=4*n},uvRegion:function(t,e,r){var n=4*t.vertexCount;const i=new Uint16Array(e,r,n);return t["uv-region"]={array:i,componentType:5123,itemSize:4,count:n/4,type:"VEC4"},r+=2*n},region:function(t,e,r){var n=4*t.vertexCount;const i=new Uint16Array(e,r,n);return t["uv-region"]={array:i,componentType:5123,itemSize:4,count:n/4,type:"VEC4"},r+=2*n}};function vo(t,e,r,n,i,s,o){const a={vertexCount:0},c=new DataView(n);try{var f=0;a.vertexCount=c.getUint32(f,1),f+=4,a.featureCount=c.getUint32(f,1),f+=4;const t=r.info.ordering?null:r.info;if(t){const e=[];for(const r in t)"offset"!==r&&""!==r&&e.push(r);for(var u=0;u<e.length;u++)Go[e[u]]?f=Go[e[u]](a,n,f):console.error("Unknown decoder for",e[u])}else{const t=r.info;let e=t.ordering,i=t.featureAttributeOrder;const s=null;s&&s.geometryData&&s.geometryData[0]&&s.geometryData[0].params;for(var l=0;l<e.length;l++){var E=Go[e[l]];E||console.log(e[l]),f=E(a,n,f)}for(var _=0;_<i.length;_++){var A=Go[i[_]];A||console.log(i[_]),f=A(a,n,f)}}}catch(t){console.warn(t)}a.scale_x=1,a.scale_y=1;const h={};for(const t in a){const e=Bo[t]&&Bo[t].name;e&&(h[e]=a[t])}if(a.faceRange){const t=a.faceRange.array,e=t.length/2,r=(T=e)<=255?Uint8Array:T<=65535?Uint16Array:Uint32Array,n=new r(h.POSITION.array.length/3);for(let e=0;e<t.length-1;e+=2){const r=e/2,i=t[e],s=t[e+1];for(let t=i;t<=s;t++)n[3*t]=r,n[3*t+1]=r,n[3*t+2]=r}h._BATCHID={componentType:fe(r),array:n,itemSize:1,count:n.length,type:"SCALAR"}}var T;return Xo({attributes:h},t,e,i,s,o)}function Xo(t,e,r,n,i,s){const o={attributes:t.attributes,material:r,indices:t.indices,mode:4};!function(t){const e=t.array,r=t.meta&&t.meta["i3s-scale_x"],n=t.meta&&t.meta["i3s-scale_y"];if(r&&n&&(1!==r||1!==n))for(let t=0;t<e.length;t+=3)e[t]*=r.value,e[t+1]*=n.value}(t.attributes.POSITION);const c=function(t,e,r,n){const i=r;let s,o=[0,0,0,1],c=[0,0];const f=Fo([],r,n);f[2]=r[2];const u=e&&a(bo,e);return me(t,(t=>(o[0]=t[0],o[1]=t[1],o[2]=t[2],u||(o=U(o,o,e)),i&&_(o,o,i),Fo(c,o,n),s=o[2],t[0]=c[0]-f[0],t[1]=c[1]-f[1],t[2]=s-f[2],t))),f}(t.attributes.POSITION,n,i,s);e.meshes[r]={primitives:[o],index:r},e.extensions.MAPTALKS_RTC={projCenter:c},e.extensions.CESIUM_RTC={rtcCoord:i};for(const r in t.attributes)zo(e.transferables,t.attributes[r].array.buffer);return t.indices&&zo(e.transferables,t.indices.array.buffer),o}function Ho(t,e,r,n,i,s){const o=n.map((t=>function(t,e,r,n,i){if("dds"===e){const e=Uo(t),n=e.images.map((e=>new Uint8Array(t,e.offset,e.length))),i="dxt1"===e.format?33777:33779;return Promise.resolve({image:{mipmap:n,width:e.shape[0],height:e.shape[1],mimeType:r},sampler:Po,format:i})}if("png"===e||"jpg"===e)return function(t,e){ko||(ko=new OffscreenCanvas(2,2),Zo=ko.getContext("2d"));const r=new Blob([new Uint8Array(t)]);return createImageBitmap(r).then((t=>{let{width:r,height:n}=t;Yo(r)||(r=Ko(r)),Yo(n)||(n=Ko(n));const i=e;i&&(r=Math.min(i,r),n=Math.min(i,n)),ko.width=r,ko.height=n,Zo.drawImage(t,0,0,r,n),t.close();const s=Zo.getImageData(0,0,r,n);return{width:r,height:n,array:new Uint8Array(s.data)}})).catch((()=>({width:2,height:2,array:new Uint8Array(4)})))}(t,i).then((t=>{t.mimeType=r;return{image:t,sampler:Po,format:6408}}));if("ktx2"===e)return wo(t,n).then((t=>(t.mimeType=r,{image:t,sampler:Po,format:t.format})))}(t.data,t.format,t.mimeType,i,s).then((t=>{if(t.image)if(t.image.array)zo(e.transferables,t.image.array.buffer);else if(t.image.mipmap)for(let r=0;r<t.image.mipmap.length;r++)zo(e.transferables,t.image.mipmap[r].buffer);return t}))));return Promise.all(o).then((n=>{xo(t,e,r,n)}))}function xo(t,e,r,n){const i=JSON.parse(JSON.stringify(r)),s=e.textures;n.ptr||(n.ptr=0);for(const t in r)r[t]&&r[t].url?(s.push(n[n.ptr++]),i[t]={index:s.length-1},void 0!==r[t].factor&&(i[t].scale=r[t].factor)):Rt(r[t])&&(i[t]=xo(-1,e,r[t],n));return t>=0&&(e.materials[t]=i),i}function Vo(t,e){for(const r in t)t[r]&&t[r].url?e.push({url:t[r].url,mimeType:t[r].mimeType,format:t[r].format}):Rt(t[r])&&Vo(t[r],e)}let ko,Zo;function Yo(t){return 0==(t&t-1)&&0!==t}function Ko(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function zo(t,e){e&&(t.indexOf(e)>=0||t.push(e))}function Wo(t){const e=new Uint8Array(t,0,5);return e[0]==="D".charCodeAt()&&e[1]==="R".charCodeAt()&&e[2]==="A".charCodeAt()&&e[3]==="C".charCodeAt()&&e[4]==="O".charCodeAt()}const jo=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],qo=[0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1],$o="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;let Jo,Qo,ta=!1;if("undefined"!=typeof OffscreenCanvas){try{Qo=new OffscreenCanvas(2,2).getContext("2d")}catch(ln){}Qo&&"undefined"!=typeof createImageBitmap&&(ta=!0)}const ea=s([]),ra=[0,0,0],na=[],ia=[],sa=[],oa=[];class aa{constructor(t,e,r,n){this.id=t,this.options=e,this.dt=this.requestImage.bind(this),this.Ot=r,this.Mt={},n(null,{},[])}Ft(t){this.Ct||(this.bt=new Ie,this.Ct=new Ae(this.dt,ut,t),this.wt=new he(this.dt,ut,t))}requestImage(t,e){ta?fetch(t).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((t=>{Jo.width=t.width,Jo.height=t.height,Qo.drawImage(t,0,0);const r=Qo.getImageData(0,0,Jo.width,Jo.height);e(null,{width:t.width,height:t.height,data:new Uint8Array(r.data)})})):this.Ot("requestImage",{url:t},null,e)}loadTile(t,e){this.Ft(t.supportedFormats);const r=t.url,n=t.arraybuffer;if(function(t){return t.indexOf("i3s:")>=0}(r)){const n=t.i3sInfo,i=this.options.services[t.rootIdx].maxTextureSize||1024,s=Lo(n,t.supportedFormats,this.options.projection,i);return s.then((t=>{if(delete this.Mt[r],!t)return void e({status:404,url:r,i3sInfo:n});if(!Object.keys(t.gltf.meshes).length)return void e({status:404,url:r,i3sInfo:n});t.gltf.url=r;const{transferables:i}=t;t.magic="b3dm",e(null,t,i)})),void(this.Mt[r]=s.xhr)}if(n){delete this.Mt[r];const i=new DataView(n),s=Gt(i,0);if("{"===s[0]||" "===s[0]||"<"===s[0]){const i=function(t,e,r){if($o){const n=new Uint8Array(t,e,r);return $o.decode(n)}return St(new Uint8Array(t,e,r))}(n,0,n.byteLength),s=JSON.parse(i);this.Dt(t.rootIdx,s,n,r,e)}else{const o=i.getFloat32(0,!0);1===o||2===o?this.Bt(n,r,t,e):this.Lt(n,r,t,s,e)}}else{const n=this.options.services[t.rootIdx];let i=n.urlParams;i&&(i=(r.indexOf("?")>0?"&":"?")+i);let s=K.getArrayBuffer(r+(i||""),n.fetchOptions);const o=s.xhr;s=s.then((n=>{delete this.Mt[r],n&&n.status?e(n):(t.arraybuffer=n&&n.data,this.loadTile(t,e))})).catch((t=>{delete this.Mt[r],e(t)})),this.Mt[r]=o}}Lt(t,e,r,n,i){const s=this.options.services[r.rootIdx];if("b3dm"===n){this.Ct.load(e,t,0,0,{maxTextureSize:s.maxTextureSize||1024}).then((t=>{if(t.error)return void i(t);const{content:e,transferables:n}=this.Pt(t,r);i(null,e,n)})).catch((t=>{i(t)}))}else if("pnts"===n){const n=r.transform;this.bt.load(e,t).then((t=>{const{content:e,transferables:s}=this.gt(t,n,r.rootIdx);i(null,e,s)}))}else if("i3dm"===n){const n=r.transform;this.wt.load(e,t,0,0,{maxTextureSize:s.maxTextureSize||1024}).then((t=>{const{content:e,transferables:s}=this.gt(t,n,r.rootIdx);i(null,e,s)}))}else if("cmpt"===n){new Ue(this.dt,ut).load(e,t,0,0,{maxTextureSize:s.maxTextureSize||1024}).then((t=>{const{content:e,transferables:n}=this.Gt(t,r);i(null,e,n)})).catch((t=>{i(t)}))}}Bt(t,e,r,n){Zs({buffer:t,bytesOffset:0},this.options.services[r.rootIdx].maxTextureSize||1024).then((t=>{t.gltf.url=e;const{content:i,transferables:s}=this.Pt(t,r);if(i.magic="b3dm",t.pageLods){const e=this.vt(t.pageLods);e.length&&(i.children=e)}n(null,i,s)}))}vt(t){const e=[];for(let r=0;r<t.length;r++){const n=t[r];if(!n.childTile)continue;const i={boundingVolume:{sphere:[n.boundingSphere.center.x,n.boundingSphere.center.y,n.boundingSphere.center.z,n.boundingSphere.radius]},content:{uri:n.childTile},geometricError:n.boundingSphere.radius/n.rangeList*16,refine:"REPLACE"};e.push(i)}return e}Dt(t,e,r,n,i){return e.dataType&&e.position?void i(null,Fe(e)):(e.capabilities,void i(null,e))}Gt(t,e){const{tiles:r}=t,n={magic:"cmpt",content:[]},i=[];for(let t=0;t<r.length;t++){const{magic:s}=r[t];if("b3dm"===s){const{content:s,transferables:o}=this.Pt(r[t],e);ua(i,o),n.content.push(s)}else if("i3dm"===s||"pnts"===s){const{transform:s,rootIdx:o}=e,{content:a,transferables:c}=this.gt(r[t],s,o);ua(i,c),n.content.push(a)}else if("cmpt"===s){const{content:s,transferables:o}=this.Gt(r[t],e);ua(i,o),n.content.push(s)}}return{content:n,transferables:i}}Pt(t,e){const{gltf:r,transferables:n,featureTable:i}=t,s=function(t){if(!t||!t.meshes)return!1;const e="visited";let r=1;const n=[];for(const i in t.meshes){const s=t.meshes[i],{primitives:o}=s;if(o)for(let t=0;t<o.length;t++){const i=o[t].attributes&&o[t].attributes.POSITION;if(!i||!i.array)continue;i.array.buffer[e]||(i.array.buffer[e]=r++);const s=r-1+"-"+(i.byteOffset||0);if(n.indexOf(s)>=0)return!0;n.push(s)}}return!1}(r);return this.Xt(t.gltf),t.gltf.asset||(t.gltf.asset={}),s?(t.gltf.asset.sharePosition=!0,this.Ht(r,i,e.upAxis,e.transform)):this.xt(r,i,e.upAxis,e.transform),delete t.transferables,{content:t,transferables:n}}gt(t,e,r){const{featureTable:i}=t,s=t.pnts||t.i3dm;let o=i&&i.RTC_CENTER||[0,0,0];if(i.EAST_NORTH_UP&&!s.NORMAL_UP&&!s.NORMAL_UP_OCT32P){const e=new Float32Array(3*s.POSITION.array.length),r=[],i=[],a=[];me(s.POSITION,((t,s)=>{_(a,t,o),re(a,null,r),n(i,r);!function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(e.subarray(9*s,9*(s+1)),i)})),s.INSTANCE_ROTATION={byteStride:0,byteOffset:0,itemSize:9,componentType:5126,array:e},t.transferables.push(e.buffer)}const a={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};ca(s.POSITION.array,3,o,ea,a);const c=fa(a),f=l([],c),u=[1/0,1/0,1/0],E=[-1/0,-1/0,-1/0];me(s.POSITION,(t=>{t[0]=t[0]+o[0]-f[0],t[1]=t[1]+o[1]-f[1],t[2]=t[2]+o[2]-f[2],t[0]<u[0]&&(u[0]=t[0]),t[1]<u[1]&&(u[1]=t[1]),t[2]<u[2]&&(u[2]=t[2]),t[0]>E[0]&&(E[0]=t[0]),t[1]>E[1]&&(E[1]=t[1]),t[2]>E[2]&&(E[2]=t[2])})),s.POSITION.min=u,s.POSITION.max=E,e&&U(c,c,e);const A=this.Vt(c);t.rtcCenter=f,t.rtcCoord=A,t.rootIdx=r;const h=t.transferables;return delete t.transferables,{content:t,transferables:h}}Xt(t){if(!Array.isArray(t.textures))return;const e=t.textures;for(let t=0;t<e.length;t++){const r=e[t].image&&e[t].image.array;if(r&&r.length){const n=r[0],i=r[1],s=r[2],o=r[3];let a=!0;for(let t=4;t<r.length;t+=4)if(r[t]!==n||r[t+1]!==i||r[t+2]!==s||r[t+3]!==o){a=!1;break}a&&(e[t].image.color=[n/255,i/255,s/255,o/255],delete e[t].image.array)}}}abortTileLoading(t,e){const r=this.Mt[t.url];if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t].abort();else r&&r.abort&&r.abort();delete this.Mt[t.url],e(null)}kt(t,e,r,n){let i=e&&e.RTC_CENTER||t.extensions&&t.extensions.CESIUM_RTC&&t.extensions.CESIUM_RTC.center,a=jo;"X"===(r=r&&r.toUpperCase())?a=qo:"Z"===r&&(a=ea),t.extensions=t.extensions||{},t.extensions.CESIUM_RTC||(t.extensions.CESIUM_RTC={}),i&&(t.extensions.CESIUM_RTC.center=i),t.extensions.MAPTALKS_RTC={};const c={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};Se(t,(t=>{if(!(t.attributes&&t.attributes.POSITION))return;const e=s(na);if(t.matrices)for(let r=t.matrices.length-1;r>=0;r--)o(e,e,t.matrices[r]);const r=t.attributes.POSITION.array,f=t.attributes.POSITION.itemSize;o(e,a,e),n&&o(e,n,e),ca(r,f,i||ra,e,c)}));const f=fa(c);return{rtcCenter:i,modelCenter:f,upAxisTransform:a}}Ht(t,e,r,n){const{modelCenter:i,upAxisTransform:a,rtcCenter:c}=this.kt(t,e,r),f=l([],i);n&&U(i,i,n),t.extensions.CESIUM_RTC.rtcCoord=this.Vt(i),c||(Se(t,(t=>{if(t.attributes&&t.attributes.POSITION){const e=t.attributes.POSITION;if(e.array.buffer.projected&&e.array.buffer.projected[e.byteOffset])return;const r=s(na);if(t.matrices)for(let e=t.matrices.length-1;e>=0;e--)o(r,r,t.matrices[e]);o(r,a,r);const n=function(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],f=e[7],u=e[8],l=e[9],E=e[10],_=e[11],A=e[12],h=e[13],T=e[14],R=e[15],y=r*a-n*o,I=r*c-i*o,N=r*f-s*o,U=n*c-i*a,S=n*f-s*a,d=i*f-s*c,m=u*h-l*A,O=u*T-E*A,M=u*R-_*A,F=l*T-E*h,C=l*R-_*h,b=E*R-_*T,p=y*b-I*C+N*F+U*M-S*O+d*m;return p?(p=1/p,t[0]=(a*b-c*C+f*F)*p,t[1]=(i*C-n*b-s*F)*p,t[2]=(h*d-T*S+R*U)*p,t[3]=(E*S-l*d-_*U)*p,t[4]=(c*M-o*b-f*O)*p,t[5]=(r*b-i*M+s*O)*p,t[6]=(T*N-A*d-R*I)*p,t[7]=(u*d-E*N+_*I)*p,t[8]=(o*C-a*M+f*m)*p,t[9]=(n*M-r*C-s*m)*p,t[10]=(A*S-h*N+R*y)*p,t[11]=(l*N-u*S-_*y)*p,t[12]=(a*O-o*F-c*m)*p,t[13]=(r*F-n*O+i*m)*p,t[14]=(h*I-A*U-T*y)*p,t[15]=(u*U-l*I+E*y)*p,t):null}(ia,r),i=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];me(e,(t=>{U(t,t,r),t[0]=t[0]-f[0],t[1]=t[1]-f[1],t[2]=t[2]-f[2],U(t,t,n),t[0]<i[0]&&(i[0]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[2]<i[2]&&(i[2]=t[2]),t[0]>c[0]&&(c[0]=t[0]),t[1]>c[1]&&(c[1]=t[1]),t[2]>c[2]&&(c[2]=t[2])})),e.min=i,e.max=c,e.array.buffer.projected||(e.array.buffer.projected={}),e.array.buffer.projected[e.byteOffset]=1}})),t.extensions.CESIUM_RTC.center=f)}xt(t,e,r,n){const{modelCenter:i,rtcCenter:s}=this.kt(t,e,r,n),o=this.Zt(i);t.extensions.MAPTALKS_RTC.projCenter=o,t.extensions.CESIUM_RTC.rtcCoord=this.Vt(i),Se(t,(e=>{e.attributes&&e.attributes.POSITION&&(e.attributes.NORMAL&&this.Yt(e.attributes.NORMAL,e.matrices,r),e.attributes.TANGENT&&this.Yt(e.attributes.TANGENT,e.matrices,r),this.Kt(e.attributes.POSITION,e.matrices,s,t.extensions.MAPTALKS_RTC,r,n))}));for(const e in t.nodes){t.nodes[e].matrix=ea}}Zt(t){0===m(t)?E(sa,0,0,-6378137):wt(sa,t);const e=this.options.projection;Fo(oa,sa,e);const r=sa[2],n=[];return n[0]=oa[0],n[1]=oa[1],n[2]=r,n}Yt(t,e,r){let s;s="Y"===r?jo:"X"===r?qo:ea;const c=i([],s);for(let t=e.length-1;t>=0;t--)o(c,s,e[t]);if(a(c,ea))return;const f=n([],c),u=[];me(t,(t=>(function(t,e,r){var n=e[0],i=e[1],s=e[2];t[0]=n*r[0]+i*r[3]+s*r[6],t[1]=n*r[1]+i*r[4]+s*r[7],t[2]=n*r[2]+i*r[5]+s*r[8]}(u,t,f),y(u,u),l(t,u),u)))}Kt(t,e,r,n,i,c){if(t.array.buffer.projected&&t.array.buffer.projected[t.byteOffset])return;const f=s([]);for(let t=e.length-1;t>=0;t--)o(f,f,e[t]);const u=this.options.projection;i=i&&i.toUpperCase();const l=r;let A=null;"Y"===i?A=jo:"X"===i&&(A=qo);let h,T=[0,0,0,1],R=[0,0,0],y=[0,0];const I=n.projCenter,N=c&&a(ea,c),S=t.min=t.min||[],d=t.max=t.max||[];return E(S,1/0,1/0,1/0),E(d,-1/0,-1/0,-1/0),me(t,(t=>(T[0]=t[0],T[1]=t[1],T[2]=t[2],T=U(T,T,f),A&&(T=U(T,T,A)),l&&_(T,T,l),c&&!N&&(T=U(T,T,c)),0===m(T)?E(R,0,0,-6378137):wt(R,T),Fo(y,R,u),h=R[2],t[0]=y[0]-I[0],t[1]=y[1]-I[1],t[2]=h-I[2],t[0]<S[0]&&(S[0]=t[0]),t[1]<S[1]&&(S[1]=t[1]),t[2]<S[2]&&(S[2]=t[2]),t[0]>d[0]&&(d[0]=t[0]),t[1]>d[1]&&(d[1]=t[1]),t[2]>d[2]&&(d[2]=t[2]),t))),t.array.buffer.projected||(t.array.buffer.projected={}),t.array.buffer.projected[t.byteOffset]=1,{projCenter:I}}Vt(t){return 0===m(t)?E([],0,0,-6378137):wt([],t)}onRemove(){}}function ca(t,e,r,n,i){const s=[];for(let o=0,a=t.length;o<a;o+=e){const{xmin:a,ymin:c,xmax:f,ymax:u,hmin:l,hmax:A}=i;E(s,t[o],t[o+1],t[o+2]),U(s,s,n);const h=_(s,r,s);h[0]<a&&(i.xmin=h[0]),h[0]>f&&(i.xmax=h[0]),h[1]<c&&(i.ymin=h[1]),h[1]>u&&(i.ymax=h[1]),e>2&&(h[2]<l&&(i.hmin=h[2]),h[2]>A&&(i.hmax=h[2]))}}function fa(t){const{xmax:e,ymax:r,xmin:n,ymin:i,hmin:s,hmax:o}=t,a=[(n+e)/2,(i+r)/2,(s+o)/2];return e===-1/0&&(a[0]=0),r===-1/0&&(a[1]=0),o===-1/0&&(a[2]=0),isNaN(a[2])&&(a[2]=0),a}function ua(t,e){for(let r=0;r<e.length;r++)t.indexOf(e[r])<0&&t.push(e[r])}let la=0;class Ea{constructor(t){this.workerId=t,this.workers={},this.zt={}}addLayer({actorId:t,mapId:e,layerId:r,params:n},i){if(this.Wt(e,r))return;const s=this.jt(e,r),o=n.options,a=this.send.bind(this,t);this.workers[s]=new aa(r,o,a,i)}removeLayer({mapId:t,layerId:e},r){const n=this.Wt(t,e),i=this.jt(t,e);delete this.workers[i],n&&n.onRemove(r)}loadTile({mapId:t,layerId:e,params:r},n){const i=this.Wt(t,e);i&&i.loadTile(r,n)}abortTileLoading({mapId:t,layerId:e,params:r},n){const i=this.Wt(t,e);i&&i.abortTileLoading(r,n)}receive(t){const e=t.callback,r=this.zt[e];delete this.zt[e],r&&t.error?r(new Error(t.error)):r&&r(null,t.data)}send(t,e,r,n,i){const s=i?`${t}-${la++}`:null;i&&(this.zt[s]=i),postMessage({type:"<request>",workerId:this.workerId,actorId:t,command:e,params:r,callback:String(s)},n||[])}jt(t,e){return`${t}-${e}`}Wt(t,e){const r=this.jt(t,e);return this.workers[r]}}t.initialize=function(){},t.onmessage=function(t,e){const r=t.data;this.dispatcher||(this.dispatcher=new Ea(t.workerId)),"<response>"===t.type?this.dispatcher.workerId===t.workerId&&this.dispatcher.receive(t):this.dispatcher[r.command]({actorId:r.actorId,mapId:r.mapId,layerId:r.layerId,params:r.params},((t,r,n)=>{t instanceof Error&&(t={message:t.message}),e(t,r,n)}))},Object.defineProperty(t,"qt",{value:!0})}';function A$3(t){return null==t}function p$5(t){for(let e=1;e<arguments.length;e++){const r=arguments[e];for(const e in r)t[e]=r[e]}return t}function y$4(t){return null!=t&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function R$5(t){return"object"==typeof t&&!!t}function g$3(t){return t*Math.PI/180}function b$5(t){return t/Math.PI*180}function I$4(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}function N$5(t){return Math.sign?Math.sign(t):0==(t=+t)||isNaN(t)?Number(t):t>0?1:-1}const S$5=[1,1,1,1,2,2,3,0];function O$5(t){const e=t.length;let r="";for(let n=0;n<e;){let i=t[n++];if(128&i){let r=S$5[i>>3&7];if(!(64&i)||!r||n+r>e)return null;for(i&=63>>r;r>0;r-=1){const e=t[n++];if(128!=(192&e))return null;i=i<<6|63&e}}r+=String.fromCharCode(i)}return r}function x$5(t,e,r){return t[3*r]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2],t}function w$5(t){return t.flat?t.flat(1/0):t.reduce(((t,e)=>t.concat(e)),[])}function M$4(t){return t<256?Uint8Array:t<65536?Uint16Array:Uint32Array}function C$4(t){return 0===t.indexOf("data:")}function v$4(t){const e=t.indexOf("base64,"),r=t.substring(e+7),n=window.atob(r),i=n.length,s=new Uint8Array(i);for(let t=0;t<i;t++)s[t]=n.charCodeAt(t);return s.buffer}function U$3(t){for(let e=1;e<arguments.length;e++){const r=arguments[e];if(r)for(let e=0,n=r.length;e<n;e++)t.push(r[e])}return t.length}var B$5=Object.freeze({__proto__:null,isNil:A$3,extend:p$5,isFunction:y$4,isObject:R$5,toRadian:g$3,toDegree:b$5,getAbsoluteURL:I$4,sign:N$5,stringFromUTF8Array:O$5,setColumn3:x$5,flatArr:w$5,getBatchIdArrayType:M$4,isBase64:C$4,base64URLToArrayBuffer:v$4,pushIn:U$3});const L$4="undefined"==typeof document?null:document.createElement("canvas");class P$5 extends t__namespace.worker.Actor{constructor(t,e){super(t),this.mapId=e}initialize(t){t(null)}loadTile(t,e,r){let n=null;e&&e.arraybuffer&&(n=[e.arraybuffer]);this.send({mapId:this.mapId,layerId:t,command:"loadTile",params:e},n,r)}abortTileLoading(t,e,r){this.broadcast({mapId:this.mapId,layerId:t,command:"abortTileLoading",params:{url:e}},null,r)}addLayer(t,e,r){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{options:e}},null,r)}removeLayer(t,e){this.broadcast({mapId:this.mapId,layerId:t,command:"removeLayer"},null,e)}requestImage({url:t},e){const r=new Image;r.onload=()=>{if(!this.isActive())return;if(!L$4)return void e(new Error("There is no canvas to draw image!"));const t=function(t){if(D$4(t.width)&&D$4(t.height))return t;let e=t.width,r=t.height;D$4(e)||(e=F$4(e)),D$4(r)||(r=F$4(r));const n=document.createElement("canvas");n.width=e,n.height=r,n.getContext("2d").drawImage(t,0,0,e,r);const i=t.src,s=i.lastIndexOf("/")+1,o=i.substring(s);return console.warn(`Texture(${o})'s size is not power of two, resize from (${t.width}, ${t.height}) to (${e}, ${r})`),n}(r);L$4.width=t.width,L$4.height=t.height;const n=L$4.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),s={width:t.width,height:t.height,data:new Uint8Array(i.data)};e(null,s,[s.data.buffer])},r.onerror=function(t){e(t)},r.src=t}}function D$4(t){return 0==(t&t-1)&&0!==t}function F$4(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}class G$3{constructor(t,e){this.max=t,this.currentSize=0,this.onRemove=e,this.reset()}reset(){if(this.data){const t=this.data.values();for(const e of t)this.onRemove(e)}return this.data=new Map,this.currentSize=0,this}clear(){this.reset(),delete this.onRemove}add(t,e){if(!e)return this;if(e.node&&e.node.memorySize&&(this.currentSize+=e.node.memorySize),this.has(t)){const r=this.data.get(t);r&&r.node&&r.node.memorySize&&(this.currentSize-=r.node.memorySize),this.data.delete(t),this.data.set(t,e)}else this.data.set(t,e);return this}shrink(){if(this.currentSize>this.max){const t=this.data.keys();let e=t.next();for(;this.currentSize>this.max&&void 0!==e.value;){if(!this.data.get(e.value).current){const t=this.getAndRemove(e.value);t&&this.onRemove(t)}e=t.next()}}}has(t){return this.data.has(t)}keys(){const t=new Array(this.data.size);let e=0;const r=this.data.keys();for(let n of r)t[e++]=n;return t}getAndRemove(t){if(!this.has(t))return null;const e=this.data.get(t);return e.node&&e.node.memorySize&&(this.currentSize-=e.node.memorySize),this.data.delete(t),e}get(t){if(!this.has(t))return null;const e=this.data.get(t);return this.data.delete(t),this.data.set(t,e),e}remove(t){if(!this.has(t))return this;const e=this.data.get(t);return e.node&&e.node.memorySize&&(this.currentSize-=e.node.memorySize),this.data.delete(t),this.onRemove(e),this}setMaxSize(t){return this.max=t,this.shrink(),this}getMemorySize(){let t=0;const e=this.data.values();for(const r of e){const e=r&&r.node;e&&e.memorySize&&(t+=e.memorySize)}return t}markAll(t){const e=this.data.values();for(const r of e)r.current=t}}function k$4(t,e){if(t.scenes&&t.scenes.length)for(let r=0,n=t.scenes.length;r<n;r++){const n=t.scenes[r].nodes;for(let r=0,i=n.length;r<i;r++){H$4(n[r],[],t,e)}}}function H$4(t,e,r,n){if(t.matrix&&e.push(t.matrix),t.children&&t.children.length)for(let i=0,s=t.children.length;i<s;i++)H$4(t.children[i],e,r,n);if(void 0!==t.mesh){const i=t.mesh,s=r.meshes[i];if(s){const t=e.slice(0),o=s.primitives;for(let e=0,s=o.length;e<s;e++){const s=o[e];s&&(s.matrices=t,n(s,i,e,r))}}}}function z$3(t,e,r){let{componentType:n,byteOffset:i,byteStride:s,itemSize:o}=e;const a=e.array.buffer,c=n?k$8.getTypedArrayCtor(n):e.array.constructor;if(i=void 0===i?e.array.byteOffset:i,s=s||0,!s||s===o*c.BYTES_PER_ELEMENT&&i%c.BYTES_PER_ELEMENT==0){const e=new c(a,i+r*o*c.BYTES_PER_ELEMENT,o);return t.set(e),t}s||(s=o*c.BYTES_PER_ELEMENT);const l=new Uint8Array(a,s*r+i,o*c.BYTES_PER_ELEMENT);return new Uint8Array(t.buffer).set(l),t}function V$4(t,e,r,n){t[4*e]=r[n],t[4*e+1]=r[n+4],t[4*e+2]=r[n+8],t[4*e+3]=r[n+12]}const X$3=new Array(3),Y$2=new Array(3),Z$3=[40680631590769,40680631590769,40408299984661.445];function K$4(t,e,r,n){const i=Z$3,s=Math.cos(r);X$3[0]=s*Math.cos(e),X$3[1]=s*Math.sin(e),X$3[2]=Math.sin(r),nt$2(X$3,X$3),multiply$4(Y$2,i,X$3);const o=Math.sqrt(dot$4(X$3,Y$2));var a,c,l;return(a=Y$2)[0]=(c=Y$2)[0]/(l=o),a[1]=c[1]/l,a[2]=c[2]/l,scale$4(X$3,X$3,n),add$4(t,Y$2,X$3)}const W$3=[1/6378137,1/6378137,1/6356752.314245179],j$3=[1/40680631590769,1/40680631590769,1/40408299984661.445],q$3=new Array(3),$$3=new Array(3),J$3=new Array(3);function Q$3(t,e){const r=j$3,n=function(t,e,r,n,i){const s=e[0],o=e[1],a=e[2],c=r[0],l=r[1],f=r[2],u=s*s*c*c,h=o*o*l*l,_=a*a*f*f,E=u+h+_,T=Math.sqrt(1/E),m=scale$4(tt$2,e,T);if(E<.1)return isFinite(T)?m:void 0;const A=n[0],p=n[1],y=n[2],R=et$2;R[0]=m[0]*A*2,R[1]=m[1]*p*2,R[2]=m[2]*y*2;let g,b,I,N,S,O,x,w,M,C,v,U=(1-T)*rt$2(e)/(.5*rt$2(R)),B=0;do{U-=B,I=1/(1+U*A),N=1/(1+U*p),S=1/(1+U*y),O=I*I,x=N*N,w=S*S,M=O*I,C=x*N,v=w*S,g=u*O+h*x+_*w-1,b=u*M*A+h*C*p+_*v*y,B=g/(-2*b)}while(Math.abs(g)>1e-12);return t[0]=s*I,t[1]=o*N,t[2]=a*S,t}(q$3,e,W$3,r);let i=mul$4($$3,n,r);i=nt$2(i,i);const s=sub$2(J$3,e,n),o=Math.atan2(i[1],i[0]),a=Math.asin(i[2]),c=N$5(dot$4(s,e))*rt$2(s);return t[0]=b$5(o),t[1]=b$5(a),t[2]=c,t}const tt$2=new Array(3),et$2=new Array(3);function rt$2(t){return length$4(t)}function nt$2(t,e){const r=e[0],n=e[1],i=e[2];let s=r*r+n*n+i*i;return s>0&&(s=Math.sqrt(s),t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s),t}function it$2(t,e){return multiply$4(e,t,j$3),normalize$4(e,e)}function st$2(t,e){var r=t[0],n=t[1],i=Math.cos(n),s=i*Math.cos(r),o=i*Math.sin(r),a=Math.sin(n);return e.x=s,e.y=o,e.z=a,normalize$4(e,e)}var ot$2=Object.freeze({__proto__:null,radianToCartesian3:K$4,cartesian3ToDegree:Q$3,normalizeCartesian:nt$2,geodeticSurfaceNormal:it$2,geodeticSurfaceNormalCartographic:st$2});function at$2(t,e,r,n){r=r||0,n=n||r;var i=Math.abs(t-e);return i<=n||i<=r*Math.max(Math.abs(t),Math.abs(e))}function ct$2(t,e){let r="";for(let n=0;n<4;n++){const i=t.getUint8(e+n);r+=String.fromCharCode(i)}return r}const lt$2="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function ft$2(t,e,r){const n=new Uint8Array(t,e,r);return lt$2?JSON.parse(lt$2.decode(n)):JSON.parse(O$5(n))}function ut$2(t,e,r){const n=new Uint8Array(t,e,r);return lt$2?JSON.parse(lt$2.decode(n)):JSON.parse(O$5(n))}function ht$2(t,e,r){return{offset:e,byteLength:r}}function _t$1(t,e,r,n){const{byteOffset:i,componentType:s,type:o}=t,{ctor:a,type:c}=pt$2(s||"UNSIGNED_SHORT"),l=mt$2(o);return{byteStride:0,byteOffset:i+r,itemSize:l,count:n*l,componentType:c,array:new a(e,r+i,n*l)}}function dt$2(t,e,r,n){const i=_t$1(t,e,r,n);return i.array.buffer.byteLength!==e.byteLength&&(i.array=i.array.slice()),i}function Et$1(t,e,r,n){const{byteOffset:i,componentType:s,type:o}=t,{ctor:a}=pt$2(s||"UNSIGNED_SHORT"),c=mt$2(o),l=new a(e,i,r*c);return 1===c?l[n]:l.subarray(n*c,n*c+c)}const Tt$1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4};function mt$2(t){return t?Tt$1[t]:1}const At$1={BYTE:{ctor:Int8Array,type:5120,name:"Int8Array"},UNSIGNED_BYTE:{ctor:Uint8Array,type:5121,name:"Uint8Array"},SHORT:{ctor:Int16Array,type:5122,name:"Int16Array"},UNSIGNED_SHORT:{ctor:Uint16Array,type:5123,name:"Uint16Array"},INT:{ctor:Int32Array,type:5124,name:"Int32Array"},UNSIGNED_INT:{ctor:Uint32Array,type:5125,name:"Uint32Array"},FLOAT:{ctor:Float32Array,type:5126,name:"Float32Array"},DOUBLE:{ctor:Float64Array,type:5126,name:"Float64Array"}};function pt$2(t){return At$1[t]}function yt$1(t){for(let e in At$1)if(t===At$1[e].ctor)return At$1[e].type;throw new Error("unrecognized ctor:"+t)}function Rt$1(t,e,r,n){const i=t,s=e.length/3;for(let t=0;t<s;t++)i[3*t]=e[3*t]/65535*n[0]+r[0],i[3*t+1]=e[3*t+1]/65535*n[1]+r[1],i[3*t+2]=e[3*t+2]/65535*n[2]+r[2];return i}function gt$2(t,e,r){let n=t.getUint32(12,!0),i=t.getUint32(16,!0),s=t.getUint32(20,!0),o=t.getUint32(24,!0);const a=t.buffer;let c,l,f={},u={};n>0&&(f=ft$2(a,e,n),e+=n),i>0&&(c=function(t,e,r){return{offset:e,byteLength:r}}(0,e,i),e+=i),s>0&&(u=ut$2(a,e,s),e+=s);const h=ht$2(0,e,o);return l=a.slice(h.offset,h.offset+h.byteLength),r.push(l),{featureTable:f,featureTableBin:c,batchTable:u,batchTableBin:l}}var bt$1={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},It$1={},Nt$1={east:[],north:[],up:[],west:[],south:[],down:[]},St$1=[],Ot$1=[],xt$1=[];const wt$1=[0,0,0];function Mt$1(t,e,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=t[15],r}const Ct$1=(Lt$1={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}}["east"]["north"],It$1["eastnorth"]?Bt$1=It$1.eastnorth:(Bt$1=function(t,e,r){if(equals$5(t,wt$1))copy$4(St$1,bt$1.east),copy$4(Ot$1,bt$1.north),copy$4(xt$1,bt$1[Lt$1]);else if(at$2(t[0],0,1e-14)&&at$2(t[1],0,1e-14)){var n=N$5(t[2]);copy$4(St$1,bt$1.east),copy$4(Ot$1,bt$1.north),scale$4(Ot$1,Ot$1,n),copy$4(xt$1,bt$1[Lt$1]),"east"!==Lt$1&&"west"!==Lt$1&&scale$4(xt$1,xt$1,n)}else{it$2(t,Nt$1.up);var i=Nt$1.up,s=Nt$1.east;s[0]=-t[1],s[1]=t[0],s[2]=0,normalize$4(Nt$1.east,s),cross$1(Nt$1.north,i,s),scale$4(Nt$1.down,Nt$1.up,-1),scale$4(Nt$1.west,Nt$1.east,-1),scale$4(Nt$1.south,Nt$1.north,-1),St$1=Nt$1.east,Ot$1=Nt$1.north,xt$1=Nt$1[Lt$1]}return r[0]=St$1[0],r[1]=St$1[1],r[2]=St$1[2],r[3]=0,r[4]=Ot$1[0],r[5]=Ot$1[1],r[6]=Ot$1[2],r[7]=0,r[8]=xt$1[0],r[9]=xt$1[1],r[10]=xt$1[2],r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},It$1.eastnorth=Bt$1),Bt$1);var Bt$1,Lt$1;const Dt$1=[],Ft$1=[],Gt$1=[],kt$1=[],Ht$1=[],zt$1=[],Vt$1=[],Xt$1={x:0,y:0},Yt$1={x:0,y:0},Zt$1=Math.PI/180,Kt$1={programs:[{attributes:["aPosition","instanceId","batchId","aTexCoord0","aTexCoord1","aNormal","aColor","uv2","uv3","uv4","secondary_colour","uv6"],fragmentShader:1,vertexShader:0}],shaders:[{type:35633,content:"#include <gl2_vert>\n\nuniform mat4 czm_modelViewProjection;\n\nuniform mat4 czm_modelView;\n\nuniform mat3 czm_normal;\n\n\n\nattribute vec4 aPosition;\n\n\n\n#ifdef VertexColor\n\n    attribute vec4 aColor;\n\n#endif\n\n#ifdef VertexNormal\n\n    attribute vec3 aNormal;\n\n#endif\n\n#ifdef Instance\n\n    attribute float instanceId;\n\n#else\n\n    attribute float batchId;\n\n#endif\n\n\n\n#ifdef TexCoord\n\n    attribute vec4 aTexCoord0;\n\n    varying vec4 vTexCoord;\n\n    uniform mat4 uTexMatrix;\n\n#ifdef COMPUTE_TEXCOORD\n\n    uniform float uTexture0Width;\n\n    varying vec4 vTexMatrix;\n\n    varying vec4 vTexCoordTransform;\n\n    varying vec2 vIsRGBA;\n\n#endif\n\n#endif\n\n\n\n#ifdef TexCoord2\n\n    attribute vec4 aTexCoord1;\n\n    uniform float uTexture1Width;\n\n    varying vec4 vTexMatrix2;\n\n#endif\n\n#ifdef InstanceBim\n\n    attribute vec4 uv2;\n\n    attribute vec4 uv3;\n\n    attribute vec4 uv4;\n\n    attribute vec4 secondary_colour;\n\n    attribute vec4 uv6;\n\n#endif\n\n\n\n    uniform vec4 uFillForeColor;\n\n    uniform vec4 uSelectedColor;\n\n    varying vec4 vSecondColor;\n\n    varying vec4 vPositionMC;\n\n    varying vec3 vPositionEC;\n\n#ifdef VertexNormal\n\n    varying vec3 vNormalEC;\n\n#endif\n\n    varying vec4 vColor;\n\n\n\n    const float SHIFT_LEFT8 = 256.0;\n\n    const float SHIFT_RIGHT8 = 1.0 / 256.0;\n\n    const float SHIFT_RIGHT4 = 1.0 / 16.0;\n\n    const float SHIFT_LEFT4 = 16.0;\n\n    void getTextureMatrixFromZValue(in float nZ, inout float XTran, inout float YTran, inout float scale, inout float isRGBA)\n\n    {\n\n        if(nZ <= 0.0)\n\n        {\n\n            return;\n\n        }\n\n        float nDel8 = floor(nZ * SHIFT_RIGHT8);\n\n        float nDel16 = floor(nDel8 * SHIFT_RIGHT8);\n\n        float nDel20 = floor(nDel16 * SHIFT_RIGHT4);\n\n        isRGBA = floor(nDel20);\n\n        YTran = nZ - nDel8 * SHIFT_LEFT8;\n\n        XTran = nDel8 - nDel16 * SHIFT_LEFT8;\n\n        float nLevel = nDel16 - nDel20 * SHIFT_LEFT4;\n\n        scale = 1.0 / pow(2.0, nLevel);\n\n    }\n\n\n\n    void operation(vec4 operationType, vec4 color, vec4 selectedColor, inout vec4 vertexColor)\n\n    {\n\n        float right_2 = operationType.x * 0.5;\n\n        float right_4 = right_2 * 0.5;\n\n        float right_8 = right_4 * 0.5;\n\n        float right_16 = right_8 * 0.5;\n\n        float isSetColor = fract(right_2);\n\n        if(isSetColor > 0.1)\n\n        {\n\n            vertexColor *= color;\n\n        }\n\n        float isPicked = fract(floor(right_2)* 0.5);\n\n        if(isPicked > 0.1)\n\n        {\n\n            vertexColor *= selectedColor;\n\n        }\n\n        float isHide = fract(floor(right_4)* 0.5);\n\n        if(isHide > 0.1)\n\n        {\n\n            vertexColor.a = 0.0;\n\n        }\n\n    }\n\n\n\n    void main()\n\n    {\n\n    #ifdef TexCoord\n\n        vTexCoord.xy = aTexCoord0.xy;\n\n    #ifdef COMPUTE_TEXCOORD\n\n        vTexMatrix = vec4(0.0,0.0,1.0,0.0);\n\n        vIsRGBA.x = 0.0;\n\n        vTexCoordTransform.x = aTexCoord0.z;\n\n        if(vTexCoordTransform.x < -90000.0)\n\n        {\n\n            vTexMatrix.z = -1.0;\n\n        }\n\n        getTextureMatrixFromZValue(floor(vTexCoordTransform.x), vTexMatrix.x, vTexMatrix.y, vTexMatrix.z, vIsRGBA.x);\n\n        vTexMatrix.w = log2(uTexture0Width * vTexMatrix.z);\n\n    #endif\n\n    #endif\n\n\n\n    #ifdef TexCoord2\n\n        vTexCoord.zw = aTexCoord1.xy;\n\n        vTexMatrix2 = vec4(0.0,0.0,1.0,0.0);\n\n        vIsRGBA.y = 0.0;\n\n        vTexCoordTransform.y = aTexCoord1.z;\n\n        if(vTexCoordTransform.y < -90000.0)\n\n        {\n\n            vTexMatrix2.z = -1.0;\n\n        }\n\n        getTextureMatrixFromZValue(floor(vTexCoordTransform.y), vTexMatrix2.x, vTexMatrix2.y, vTexMatrix2.z, vIsRGBA.y);\n\n        vTexMatrix2.w = log2(uTexture1Width * vTexMatrix.z);\n\n    #endif\n\n\n\n    vec4 vertexPos = aPosition;\n\n    vec4 vertexColor = uFillForeColor;\n\n#ifdef VertexColor\n\n    vertexColor *= aColor / 255.0;\n\n#endif\n\n#ifdef VertexNormal\n\n    vec3 normal = aNormal;\n\n#endif\n\n    #ifdef InstanceBim\n\n        mat4 worldMatrix;\n\n        worldMatrix[0] = uv2;\n\n        worldMatrix[1] = uv3;\n\n        worldMatrix[2] = uv4;\n\n        worldMatrix[3] = vec4(0, 0, 0, 1);\n\n        vertexPos = vec4(vertexPos.xyz,1.0) * worldMatrix;\n\n        vertexColor *= secondary_colour;\n\n    #endif\n\n\n\n\n\n    #ifdef Instance\n\n        float index = instanceId;\n\n    #else\n\n        float index = batchId;\n\n    #endif\n\n        vec4 positionMC = vec4(vertexPos.xyz, 1.0);\n\n        vColor = vertexColor;\n\n    #ifdef VertexNormal\n\n        vNormalEC = czm_normal * normal;\n\n    #endif\n\n        vPositionMC = positionMC;\n\n        vPositionEC = (czm_modelView * positionMC).xyz;\n\n        gl_Position = czm_modelViewProjection * vec4(vertexPos.xyz, 1.0);\n\n    }\n\n"},{type:35632,content:"#ifdef GL_OES_standard_derivatives\n\n    #extension GL_OES_standard_derivatives : enable\n\n    #define support_standard_derivatives 1\n\n#endif\n\n#ifdef GL_EXT_shader_texture_lod\n\n    #extension GL_EXT_shader_texture_lod : enable\n\n    #define support_shader_texture_lod 1\n\n#endif\n\n\n\nprecision highp float;\n\n\n\n#include <gl2_frag>\n\n\n\n#if __VERSION__ == 300\n\n    #define support_standard_derivatives 1\n\n    #define support_shader_texture_lod 1\n\n#endif\n\n\n\n    uniform vec3 czm_lightDirectionEC;\n\n    uniform vec4 uDiffuseColor;\n\n#ifdef TexCoord\n\n    varying vec4 vTexCoord;\n\n#ifdef COMPUTE_TEXCOORD\n\n    uniform sampler2D uTexture;\n\n    uniform highp float uTexture0Width;\n\n    varying vec4 vTexCoordTransform;\n\n    varying vec4 vTexMatrix;\n\n    varying vec2 vIsRGBA;\n\n#endif\n\n#endif\n\n\n\n    varying vec4 vColor;\n\n    varying vec4 vPositionMC;\n\n    varying vec3 vPositionEC;\n\n#ifdef VertexNormal\n\n    varying vec3 vNormalEC;\n\n#endif\n\n#ifdef TexCoord2\n\n    uniform sampler2D uTexture2;\n\n    uniform float uTexture1Width;\n\n    varying vec4 vTexMatrix2;\n\n#endif\n\n#ifdef COMPUTE_TEXCOORD\n\n    void calculateMipLevel(in vec2 inTexCoord, in float vecTile, in float fMaxMip, inout float mipLevel)\n\n    {\n\n        vec2 dx = dFdx(inTexCoord * vecTile);\n\n        vec2 dy = dFdy(inTexCoord * vecTile);\n\n        float dotX = dot(dx, dx);\n\n        float dotY = dot(dy, dy);\n\n        float dMax = max(dotX, dotY);\n\n        float dMin = min(dotX, dotY);\n\n        float offset = (dMax - dMin) / (dMax + dMin);\n\n        offset = clamp(offset, 0.0, 1.0);\n\n        float d = dMax * (1.0 - offset) + dMin * offset;\n\n        mipLevel = 0.5 * log2(d);\n\n        mipLevel = clamp(mipLevel, 0.0, fMaxMip - 1.62);\n\n    }\n\n\n\n    void calculateTexCoord(in vec3 inTexCoord, in float scale, in float XTran, in float YTran, in float fTile, in float mipLevel, inout vec2 outTexCoord)\n\n    {\n\n        if(inTexCoord.z < -9000.0)\n\n        {\n\n            outTexCoord = inTexCoord.xy;\n\n        }\n\n        else\n\n        {\n\n            vec2 fTexCoord = fract(inTexCoord.xy);\n\n            float offset = 1.0 * pow(2.0, mipLevel) / fTile;\n\n            fTexCoord = clamp(fTexCoord, offset, 1.0 - offset);\n\n            outTexCoord.x = (fTexCoord.x + XTran) * scale;\n\n            outTexCoord.y = (fTexCoord.y + YTran) * scale;\n\n        }\n\n    }\n\n\n\n    vec4 getTexColorForS3M(sampler2D curTexture, vec3 oriTexCoord, float texTileWidth, float fMaxMipLev, float fTexCoordScale, vec2 vecTexCoordTranslate, float isRGBA)\n\n    {\n\n        vec4 color = vec4(1.0);\n\n        float mipLevel = 0.0;\n\n    #ifdef support_standard_derivatives\n\n        calculateMipLevel(oriTexCoord.xy, texTileWidth, fMaxMipLev, mipLevel);\n\n    #endif\n\n        vec2 realTexCoord;\n\n        calculateTexCoord(oriTexCoord, fTexCoordScale, vecTexCoordTranslate.x, vecTexCoordTranslate.y, texTileWidth, mipLevel, realTexCoord);\n\n        if(isRGBA > 0.5)\n\n        {\n\n            vec2 rgbTexCoord;\n\n            rgbTexCoord.x = (realTexCoord.x + vecTexCoordTranslate.x * fTexCoordScale) * 0.5;\n\n            rgbTexCoord.y = (realTexCoord.y + vecTexCoordTranslate.y * fTexCoordScale) * 0.5;\n\n            color = texture2D(curTexture, rgbTexCoord.xy, -10.0);\n\n            vec2 vecAlphaTexCoord;\n\n            vecAlphaTexCoord.x = rgbTexCoord.x;\n\n            vecAlphaTexCoord.y = rgbTexCoord.y + fTexCoordScale * 0.5;\n\n            color.a = texture2D(curTexture, vecAlphaTexCoord.xy, -10.0).r;\n\n        }\n\n        else\n\n        {\n\n            if(oriTexCoord.z < -9000.0)\n\n            {\n\n                color = texture2D(curTexture, realTexCoord.xy);\n\n            }\n\n            else\n\n            {\n\n                #ifdef support_shader_texture_lod\n\n                    color = texture2DLodEXT(curTexture, realTexCoord.xy, mipLevel);\n\n                #else\n\n                    color = texture2D(curTexture, realTexCoord.xy, mipLevel);\n\n                #endif\n\n            }\n\n        }\n\n\n\n        return color;\n\n    }\n\n\n\n    vec4 getTextureColor()\n\n    {\n\n        if(vTexMatrix.z < 0.0)\n\n        {\n\n            return vec4(1.0);\n\n        }\n\n        float texTileWidth0 = vTexMatrix.z * uTexture0Width;\n\n        vec3 realTexCoord = vec3(vTexCoord.xy, vTexCoordTransform.x);\n\n        vec4 FColor = getTexColorForS3M(uTexture, realTexCoord, texTileWidth0, vTexMatrix.w, vTexMatrix.z, vTexMatrix.xy, vIsRGBA.x);\n\n    #ifdef TexCoord2\n\n        float texTileWidth1 = vTexMatrix2.z * uTexture1Width;\n\n        realTexCoord = vec3(vTexCoord.zw, vTexCoordTransform.y);\n\n        vec4 SColor = getTexColorForS3M(uTexture2, realTexCoord, texTileWidth1, vTexMatrix2.w, vTexMatrix2.z, vTexMatrix2.xy, vIsRGBA.y);\n\n        SColor.r = clamp(SColor.r, 0.0, 1.0);\n\n        SColor.g = clamp(SColor.g, 0.0, 1.0);\n\n        SColor.b = clamp(SColor.b, 0.0, 1.0);\n\n        return FColor * SColor;\n\n    #else\n\n        return FColor;\n\n    #endif\n\n    }\n\n#endif\n\n    vec4 SRGBtoLINEAR4(vec4 srgbIn)\n\n    {\n\n    #ifndef HDR\n\n        vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));\n\n        return vec4(linearOut, srgbIn.a);\n\n    #else\n\n        return srgbIn;\n\n    #endif\n\n    }\n\n    vec3 LINEARtoSRGB(vec3 linearIn)\n\n    {\n\n    #ifndef HDR\n\n        return pow(linearIn, vec3(1.0/2.2));\n\n    #else\n\n        return linearIn;\n\n    #endif\n\n    }\n\n\n\n    vec3 computeNormal(in vec3 oriVertex)\n\n    {\n\n        vec3 normal = cross(vec3(dFdx(oriVertex.x), dFdx(oriVertex.y), dFdx(oriVertex.z)), vec3(dFdy(oriVertex.x), dFdy(oriVertex.y), dFdy(oriVertex.z)));\n\n        normal = normalize(normal);\n\n        return normal;\n\n    }\n\n\n\n    void main()\n\n    {\n\n        if(vColor.a < 0.1)\n\n        {\n\n            discard;\n\n        }\n\n        vec4 baseColorWithAlpha = vColor;\n\n    #ifdef COMPUTE_TEXCOORD\n\n        baseColorWithAlpha *= SRGBtoLINEAR4(getTextureColor());\n\n    #endif\n\n\n\n        if(baseColorWithAlpha.a < 0.1)\n\n        {\n\n            discard;\n\n        }\n\n        vec3 normal = vec3(0.0);\n\n    #ifdef VertexNormal\n\n        normal = normalize(vNormalEC);\n\n    #endif\n\n        normal = length(normal) > 0.1 ? normal : computeNormal(vPositionMC.xyz);\n\n        vec3 color = baseColorWithAlpha.rgb;\n\n        vec3 dirVectorEC = normalize(czm_lightDirectionEC);\n\n        float dotProduct = dot( normal, dirVectorEC );\n\n        float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n        dirDiffuseWeight = dirDiffuseWeight * 0.5 + 0.5;\n\n        color += color * uDiffuseColor.rgb * dirDiffuseWeight;\n\n    #ifdef TexCoord\n\n        color = LINEARtoSRGB(color);\n\n    #endif\n\n        glFragColor = vec4(color, baseColorWithAlpha.a);\n\n#if __VERSION__ == 100\n\n    gl_FragColor = glFragColor;\n\n#endif\n\n    }\n\n"}],techniques:[{attributes:{aPosition:{semantic:"POSITION",type:35666},instanceId:{semantic:"instanceId",type:5126},batchId:{semantic:"_BATCHID",type:5126},aTexCoord0:{semantic:"TEXCOORD_0",type:35664},aTexCoord1:{semantic:"aTexCoord1",type:35666},aNormal:{semantic:"aNormal",type:35665},aColor:{semantic:"COLOR_0",type:35666},uv2:{semantic:"uv2",type:35666},uv3:{semantic:"uv3",type:35666},uv4:{semantic:"uv4",type:35666},secondary_colour:{semantic:"secondary_colour",type:35666},uv6:{semantic:"uv6",type:35666}},program:0,uniforms:{czm_modelView:{type:35676,semantic:"MODELVIEW"},czm_normal:{type:35675,semantic:"MODELINVERSETRANSPOSE"},czm_modelViewProjection:{type:35676,semantic:"MODELVIEWPROJECTION"},uTexMatrix:{type:35676},uTexture0Width:{type:5126},uFillForeColor:{type:35666},uSelectedColor:{type:35666},uDiffuseColor:{type:35666},uTexture:{type:35678},uTexture2:{type:35678},uTexture1Width:{type:5126}}}]},{getTextureMagFilter:Wt$1,getTextureMinFilter:jt$1,getTextureWrap:qt$1,getMaterialType:$t$1,getMaterialFormat:Jt$1,getPrimitive:Qt$1,getUniqueREGLBuffer:te$1}=Ue$4,ee$1=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],re$1=[0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1],{loginIBLResOnCanvas:ne$1,logoutIBLResOnCanvas:ie$1,getIBLResOnCanvas:se$1,getPBRUniforms:oe$1}=ur$4.PBRUtils,ae$1={factor:0,units:0},ce$1={specularStrength:0,materialShininess:1},le$1=[1,1,1],fe$1=identity$2([]),ue$1=t=>t.material instanceof ie$4,he$1=t=>t.material instanceof ur$4.StandardMaterial,_e$1=[!0,!0,!0,!0],de$1=[],Ee$1=new t__namespace.Coordinate(0,0),Te$1=new t__namespace.Point(0,0),me$1=[],Ae$1=[],pe$1=[],ye$1=[],Re$1={POSITION:"POSITION",NORMAL:"NORMAL",TEXCOORD_0:"TEXCOORD_0",TEXCOORD_1:"TEXCOORD_1",COLOR_0:"COLOR_0",TANGENT:"TANGENT",_BATCHID:"_BATCHID"};class ge$1{constructor(e,n){this.t=n,this.i=n.getRenderer().canvas,this.pickingFBO=n.getRenderer().pickingFBO,this.o=new t__namespace.SpatialReference,this.l=e,this.u=new k$7(e),this.h={},this._={},this.T={},this.m={},this.A={},this.p={},this.R={},this.g=new pe$4,this.I=new pe$4,this.N=new pe$4,this.S=new pe$4,this.O=new ve$4(e.texture(2)),this.M=this.C.bind(this),this.v=new ie$4({baseColorFactor:[1,1,1,1]}),this.U(),this.B=new lr$4(this.l,this.L(),this.O);const i=this.getMap();i.altitudeToPoint&&(this.P=i.altitudeToPoint(100,i.getGLRes())/100)}getI3DMMeshes(){return this.A}getPNTSMeshes(){return this.m}getB3DMMeshes(){return this.T}getPaintedMeshes(){return this.D}getMap(){return this.t.getMap()}paint(t,e,r,n){const i=this.getMap();if(!t.length||!i)return;const s=this.F(),o=i.projViewMatrix,a=this.t.options.services,c=[],f=[];let u=[];const h=[],_=[];for(let r=0,n=t.length;r<n;r++){const n=t[r].data.node;let i=this.G(n);if(!i)continue;this.p[n.id]&&(i=this.p[n.id],i=w$5(i));let d=a[n.k].polygonOffset||ae$1;y$4(d)&&(d=d());const E=a[n.k].ambientLight;Array.isArray(i)||(c[0]=i,i=c);for(let a=0,c=i.length;a<c;a++){if(i[a].getBoundingBox&&!intersectsBox$1(o,i[a].getBoundingBox()))continue;const c=i[a].properties.magic;"b3dm"===c?u.push(i[a]):"pnts"===c?h.push(i[a]):"i3dm"===c&&_.push(i[a]),i[a].properties.level=t[r].selectionDepth,i[a].properties.polygonOffset=d,Object.prototype.hasOwnProperty.call(i[a].uniforms,"ambientColor")||Object.defineProperty(i[a].uniforms,"ambientColor",{enumerable:!0,get:function(){return E||s.ambientColor}}),i[a].H=n,e[n.id]||f.push(i[a])}}let d=0;const E=this.B.getExcludeFilter();d+=this.V(this.X,s,[r,ue$1,E],n,f,u,_),d+=this.V(this.Y,s,[r,he$1,E],n,f,u,_),this.B.forEachShader(((t,e,i)=>{const s=this.F(i);d+=this.V(t,s,[r,e],n,f,u,_)})),this.I.setMeshes(h);const T=this.Z();return d+=this.u.render(this.K,T,this.I,n&&n.fbo),this.D={pntsMeshes:h,i3dmMeshes:_,b3dmMeshes:u},d}V(t,e,r,n,i,s,o){t.filter=r.filter((t=>!!t)),e.debug=!1,this.g.setMeshes(i),e.stencilEnable=!1,e.debug=!1,e.cullFace="back",e.colorMask=_e$1;let a=0;return this.g.setMeshes(s),a+=this.u.render(t,e,this.g,n&&n.fbo),e.stencilEnable=!1,this.N.setMeshes(o),a+=this.u.render(t,e,this.N,n&&n.fbo),a}W(t,e){return e.H.j-t.H.j}paintRegion(t,e,r,n,i){const s=this.getMap();if(!t.length&&!e.length)return;const o=s.projViewMatrix,a=[];for(let r=0,n=(t=t.concat(e)).length;r<n;r++){const n=this.q(t[r].node);n&&(n.getBoundingBox&&!intersectsBox$1(o,n.getBoundingBox())||a.push(n))}this.$.filter=n,this.S.setMeshes(a);const c=this.J(r);this.u.render(this.$,c,this.S,i&&i.fbo)}deleteTile(t){this.tt(t.node.id)}tt(t){const e=this._[t];e&&(e.geometry.dispose(),e.dispose(),delete this._[t]);let r=this.T[t]||this.m[t]||this.A[t]||this.p[t]||this.h[t];this.p[t]?this.et(t):r&&(this.rt(r),delete this.T[t],delete this.m[t],delete this.A[t],delete this.h[t])}et(t){let e=this.p[t];e=w$5(e);for(let t=0;t<e.length;t++){const{id:r}=e[t].properties;this.tt(r)}delete this.p[t]}rt(t){if(Array.isArray(t))for(let e=0,r=t.length;e<r;e++)this.rt(t[e]);else{const e=t.geometry.properties.url;if(e){const t=this.R[e];t&&(t.refCount--,t.refCount<=0&&(t.geometry.dispose(),t.material.dispose(),delete this.R[e]))}else t.geometry.dispose(),t.material&&t.material.dispose();t.dispose()}}remove(){const t=this.t;ie$1(t.getRenderer().canvas,t.getMap());for(const t in this.p)this.et(t);this.p={};for(const t in this.T)this.tt(t);this.T={};for(const t in this.m)this.tt(t);this.m={};for(const t in this.A)this.tt(t);this.A={};for(const t in this.h)this.tt(t);this.h={};for(const t in this._)this.tt(t);this._={},this.X&&(this.X.dispose(),delete this.X),this.Y&&(this.Y.dispose(),delete this.Y),this.K&&(this.K.dispose(),delete this.K),this.$&&(this.$.dispose(),delete this.$),this.B.dispose(),this.picking&&this.picking.dispose()}q(e){if(!e.boundingVolume||!e.boundingVolume.region)return null;if(this._[e.id])return this._[e.id];const i=e.boundingVolume.region;let s=new t__namespace.Coordinate(b$5(i[0]),b$5(i[1])),o=new t__namespace.Coordinate(b$5(i[2]),b$5(i[3]));s=this.nt(s),o=this.nt(o);const a=s.add(o).it(.5);s._sub(a),o._sub(a);const c=this.st(i[4],i[5]),l=c.x,f=c.y,h=new Z$7({aPosition:[s.x,s.y,f,o.x,s.y,f,o.x,o.y,f,s.x,o.y,f,s.x,s.y,l,o.x,s.y,l,o.x,o.y,l,s.x,o.y,l]},[0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4],0,{primitive:"lines"});h.generateBuffers(this.l);const _=new de$4(h),d=identity$2([]);return _.setLocalTransform(translate$1(d,d,[a.x,a.y,0])),this._[e.id]=_,_}G(t){return this.T[t.id]||this.m[t.id]||this.A[t.id]||this.p[t.id]}has(t){return this.G(t)||this.h[t.id]}createPntsMesh(t,e,i,s){if(this.m[e]){const t=this.m[e];return console.warn(`pnts mesh with id(${e}) was already created.`),s(null,{id:e,mesh:t}),t}const{pnts:o,featureTable:a,rootIdx:c}=t,l=a.POINTS_LENGTH,f=new Z$7(o,null,l,{primitive:"points",positionAttribute:"POSITION"});f.generateBuffers(this.l);const u={};o.POSITION?u.HAS_POSITION=1:o.POSITION_QUANTIZED&&(u.HAS_POSITION_QUANTIZED=1),o.RGB?u.HAS_RGB=1:o.RGBA?u.HAS_RGBA=1:o.RGB565&&(u.HAS_RGB565=1),(o.NORMAL||o.NORMAL_OCT16P)&&(u.HAS_NORMAL=1,o.NORMAL_OCT16P&&(u.HAS_NORMAL_OCT16P=1)),t.featureTable.CONSTANT_RGBA&&(t.featureTable.CONSTANT_RGBA=t.featureTable.CONSTANT_RGBA.map((t=>t/255)));const{rtcCenter:h,rtcCoord:_}=t,d=this.ot(pe$1,_),E=this.ct([],i,h,_);multiply$5(E,E,d);const T=this.t.options.services[c],m=new de$4(f);return m.properties.magic="pnts",m.properties.id=e,m.properties.count=l,m.properties.batchTable=t.batchTable,m.properties.batchTableBin=t.batchTableBin,m.setDefines(u),Object.defineProperty(m.uniforms,"pointColor",{enumerable:!0,get:function(){return t.featureTable.CONSTANT_RGBA?t.featureTable.CONSTANT_RGBA:T&&T.pointColor||[1,1,1,1]}}),Object.defineProperty(m.uniforms,"pointSize",{enumerable:!0,get:function(){return T&&T.pointSize||2}}),Object.defineProperty(m.uniforms,"pointOpacity",{enumerable:!0,get:function(){return T&&T.pointOpacity||1}}),m.setLocalTransform(E),this.m[e]=m,s(null,{id:e,mesh:[m]}),[m]}createI3DMMesh(t,e,s,o){if(this.A[e]){const t=this.A[e];return console.warn(`i3dm mesh with id(${e}) was already created.`),this.h[e]||o(null,{id:e,mesh:t}),t}const c=this.lt(s.ft),{i3dm:l,featureTable:f,gltf:u,batchTable:_,batchTableBin:d,count:E}=t,T=f.INSTANCES_LENGTH,{rtcCenter:m,rtcCoord:A}=t,p=this.ot(pe$1,A),y=this.ct(ye$1,s,m,A);multiply$5(p,y,p);const{POSITION:R,NORMAL_UP:g,NORMAL_RIGHT:b,SCALE:I,SCALE_NON_UNIFORM:N,INSTANCE_ROTATION:S}=l,O={instance_vectorA:new Float32Array(4*T),instance_vectorB:new Float32Array(4*T),instance_vectorC:new Float32Array(4*T)},w=new Float32Array(3),M=new Float32Array(3),C=[],v=new Float32Array(1),U=new Float32Array(3),B=[],L=[],P=[],D=[],F=new Float32Array(9);!function(t,e){let{componentType:r,byteOffset:n,byteStride:i,count:s,itemSize:o}=t;const a=t.array.buffer,c=r?k$8.getTypedArrayCtor(r):t.array.constructor;if(n=void 0===n?t.array.byteOffset:n,i=i||0,s=s||t.array.length/o,(!i||i===o*c.BYTES_PER_ELEMENT)&&n%c.BYTES_PER_ELEMENT==0){const t=new c(a,n,s*o);for(let r=0;r<s*o;r+=o)e(new c(t.buffer,n+r*c.BYTES_PER_ELEMENT,o),r/o);return}const l=new Uint8Array(o*c.BYTES_PER_ELEMENT);i||(i=o*c.BYTES_PER_ELEMENT);for(let t=0;t<s;t++){const r=new Uint8Array(a,i*t+n,o*c.BYTES_PER_ELEMENT);l.set(r),e(new c(l.buffer),t),r.set(l)}}(R,((t,e)=>{g?(z$3(M,b,e),z$3(w,g,e),cross$1(C,M,w),normalize$4(C,C),x$5(B,M,0),x$5(B,w,1),x$5(B,C,2),fromMat3(L,B)):S?(z$3(F,S,e),fromMat3(L,F)):identity$1(L),I?(z$3(v,I,e),set$4(P,v[0],v[0],v[0])):N?(z$3(U,N,e),set$4(P,...U)):set$4(P,1,1,1),fromRotationTranslationScale(D,L,t,P),V$4(O.instance_vectorA,e,D,0),V$4(O.instance_vectorB,e,D,1),V$4(O.instance_vectorC,e,D,2)}));const G={};for(const t in O)G[t]={buffer:this.l.buffer({dimension:O[t].length/T,data:O[t]}),divisor:1};const H=this.t.options.services[s.k].shader||"phong";let X=0,Y=!0;const Z=[];return k$4(u,((t,i,o,a)=>{let{geometry:l,material:f}=this.ut(t,i,o,a,s,!0,H);f&&!f.isReady()&&(Y=!1,X++);const u=new he$4(G,T,l,f);u.properties.magic="i3dm",u.properties.id=e,u.properties.count=E,u.properties.batchTable=_,u.properties.batchTableBin=d;const h=this.ht(t,l,f,s.k,a),m=identity$2([]);if(t.matrices&&t.matrices.length)for(let e=0;e<t.matrices.length;e++)multiply$5(m,m,t.matrices[e]);multiply$5(m,c,m),u.setPositionMatrix(m),u.setLocalTransform(copy$5([],p)),u.setDefines(h),u.properties.polygonOffset={offset:0,factor:0},Z.push(u)})),Y?(this.A[e]=Z,o(null,{id:e,mesh:Z})):(this.h[e]={meshes:Z,count:X},Z._t=o),Z}createB3DMMesh(e,i,s,o){if(this.T[i]||this.h[i]){const t=this.T[i];return console.warn(`mesh with id(${i}) was already created.`),this.h[i]||o(null,{id:i,mesh:t}),t}let a;if(s.maxExtent){const e=new t__namespace.Extent(s.maxExtent).convertTo((t=>this._pointToPrj(t)));a=[e.xmin,e.ymin,e.xmax,e.ymax]}const c=e.gltf,{projCenter:l}=c.extensions.MAPTALKS_RTC,{rtcCoord:f,center:u}=c.extensions.CESIUM_RTC,h=this.lt(s.ft);let _;_=c.asset&&c.asset.sharePosition?this.ot(pe$1,f):this.dt(pe$1,f,l,s.k);const d=this.t.options.services[s.k].shader||"phong",E=[];let T=0,m=!0;return k$4(c,((t,o,c,l)=>{let{geometry:A,material:p}=this.ut(t,o,c,l,s,!1,d);p&&!p.isReady()&&(m=!1,T++);const y=new de$4(A,p);y.properties.magic="b3dm",y.properties.id=i,y.properties.batchTable=e.batchTable,y.properties.batchTableBin=e.batchTableBin,y.properties.count=e.featureTable.BATCH_LENGTH;const R=this.ht(t,A,p,s.k,l);y.setDefines(R),a&&(R.USE_MAX_EXTENT=1,y.setUniform("maxPrjExtent",a));let g=identity$2([]);if(l.asset.sharePosition&&t.matrices&&t.matrices.length)for(let e=0;e<t.matrices.length;e++)multiply$5(g,g,t.matrices[e]);if(l.asset.sharePosition){const t=this.ct(ye$1,s,u,f);multiply$5(g,h,g),multiply$5(g,_,g),multiply$5(g,t,g)}else multiply$5(g,_,g);y.setLocalTransform(g),E.push(y)})),m?(this.T[i]=E,o(null,{id:i,mesh:E})):(this.h[i]={meshes:E,count:T},E._t=o),E}ct(e,r,s,o){const a=this.getMap(),c=this.t.options.services[r.k].heightOffset||0,l=new t__namespace.Coordinate(o);let f;f=a.altitudeToPoint?this.P:a.distanceToPointAtRes(100,100,a.getGLRes(),l).y/100;let u=r.matrix?copy$5(e,r.matrix):identity$2(e);s&&Mt$1(u,transformMat4$2(de$1,s,u),u);const h=function(t,e,r,n,i,s,o){e=copy$4(Dt$1,e);const a=K$4(Dt$1,e[0]*Zt$1,e[1]*Zt$1,e[2]),c=getTranslation$1(Ft$1,r),l=n.ellipsoid;var f;f=0===len$4(c)?set$4(Gt$1,0,0,-6378137):Q$3(Gt$1,c),Xt$1.x=f[0],Xt$1.y=f[1];const u=n.project(Xt$1,Yt$1);kt$1[0]=u.x/i,kt$1[1]=u.y/i,kt$1[2]=(f[2]+o)*s;const h=Ct$1(a,l,Ht$1),_=function(t,e,r){var n=t[0],i=t[1],s=t[2],o=t[4],a=t[5],c=t[6],l=t[8],f=t[9],u=t[10],h=e[0],_=e[1],d=e[2],E=e[3],T=e[4],m=e[5],A=e[6],p=e[7],y=e[8],g=i*h+a*_+f*d,b=s*h+c*_+u*d,I=n*E+o*T+l*m,N=i*E+a*T+f*m,S=s*E+c*T+u*m,O=n*A+o*p+l*y,x=i*A+a*p+f*y,w=s*A+c*p+u*y;return r[0]=n*h+o*_+l*d,r[1]=g,r[2]=b,r[3]=0,r[4]=I,r[5]=N,r[6]=S,r[7]=0,r[8]=O,r[9]=x,r[10]=w,r[11]=0,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}(invert$2(zt$1,h),fromMat4$1(Vt$1,r),t);return Mt$1(t,kt$1,_),t}(u,o,u,a.getProjection(),a.getGLRes(),f,c),_=function(t,e){return set$4(t,e[12],e[13],e[14]),t}(Ae$1,h);let m=this.t.options.offset;return y$4(m)&&(m=m(this.t.Et(r.id).center)),set$4(me$1,m[0],m[1],0),sub$2(_,_,me$1),Mt$1(h,_,h),h}createCMPTMesh(t,e,r,n){if(this.p[e]){const t=this.p[e];return console.warn(`mesh with id(${e}) was already created.`),n(null,{id:e,mesh:t}),t}const{content:i}=t,s=[];for(let t=0;t<i.length;t++){const{magic:n}=i[t],o=e+"."+t;"b3dm"===n?this.createB3DMMesh(i[t],o,r,((t,{mesh:e})=>{s.push(e)})):"i3dm"===n?this.createI3DMMesh(i[t],o,r,((t,{mesh:e})=>{s.push(e)})):"pnts"===n?this.createPntsMesh(i[t],o,r,((t,{mesh:e})=>{s.push(e)})):"cmpt"===n&&this.createCMPTMesh(i[t],o,r,((t,{mesh:e})=>{s.push(e)}))}return this.p[e]=s,n(null,{id:e,mesh:s}),s}ht(t,e,r,n,i){const s=("phong"===(this.t.options.services[n].shader||"phong")?this.X:this.Y).getGeometryDefines(e);return i.asset&&"S3M"===i.asset.generator&&this.Tt(s,e,i),e.data.uvRegion&&(s.HAS_I3S_UVREGION=1),s}Tt(t,e,r){e.data.aNormal&&(t.VertexNormal=1),e.data.instanceId&&(t.Instance=1),e.data.aTexCoord0&&(t.TexCoord=1),e.data.aColor&&(t.VertexColor=1),e.data.aTexCoord1&&(t.TexCoord2=1),e.data.uv2&&(t.InstanceBim=1),e.data.aTexCoord0&&r.textures.length&&(t.COMPUTE_TEXCOORD=1)}ut(t,e,r,n,i,s,o){let a=!1;n.asset&&"S3M"===n.asset.generator&&(a=!0,n.extensions=n.extensions||{},n.extensions.KHR_techniques_webgl=Kt$1);const c=n.url+"-"+e+"-"+r;if(this.R[c])return this.R[c].refCount++,this.R[c];let l,f;const u=n.materials[t.material];if(n.extensions&&n.extensions.KHR_techniques_webgl&&u.extensions&&u.extensions.KHR_techniques_webgl){const e=this.At(t,n,s,a);l=e.material,f=e.geometry,this.t.options.services[i.k].fillEmptyDataInMissingAttribute&&(f.desc.fillEmptyDataInMissingAttribute=!0)}else{f=this.yt(t,s,Re$1);l=this.Rt(t.material,n,o,this.t.options.services[i.k].material||ce$1)}l&&!l.isReady()?l.gt=i.id:l||(l=this.v);const h={refCount:1,geometry:f,material:l};return f.properties.url=c,this.R[c]=h,h}At(t,e,r,n){const{geometry:i,material:s}=this.B.createMesh(t,e,r,n);return{geometry:i,material:s}}yt(t,e,n){const i=t.attributes;if(i.COLOR_0){const t=i.COLOR_0.array||i.COLOR_0;if(t instanceof Float32Array){const e=new Uint8Array(t.length);for(let r=0;r<e.length;r++)e[r]=Math.round(255*t[r]);i.COLOR_0.array?(i.COLOR_0.array=e,i.COLOR_0.componentType=5121):i.COLOR_0=e}}const s={};for(const t in i){const e=te$1(this.l,i[t],{dimension:i[t].itemSize}),r=n[t]||t;s[r]={buffer:e},i[t].quantization&&(s[r].quantization=i[t].quantization),r===n.POSITION&&(s[r].array=i[t].array,s[r].min=i[t].min,s[r].max=i[t].max)}delete t.attributes;const o=new Z$7(s,t.indices?t.indices.array?t.indices.array.slice():t.indices:null,0,{positionAttribute:n.POSITION,normalAttribute:n.NORMAL,uv0Attribute:n.TEXCOORD_0,uv1Attribute:n.TEXCOORD_1,color0Attribute:n.COLOR_0,tangentAttribute:n.TANGENT,pickingIdAttribute:n._BATCHID,primitive:void 0===t.mode?"triangles":Qt$1(t.mode)});return o.generateBuffers(this.l,{excludeElementsInVAO:e}),o}dt(t,e,r,s){const o=identity$2(t),a=this.getMap();Ee$1.x=r[0],Ee$1.y=r[1];const c=this._prjToPoint(Ee$1),l=this.bt(),f=1/(a.getGLZoom?a.getResolution(a.getGLZoom()):a.getGLRes());let u;Ee$1.x=e[0],Ee$1.y=e[1],u=a.altitudeToPoint?this.P:a.distanceToPointAtRes(100,100,a.getGLRes(),Ee$1).y/100;let h=this.t.options.offset;y$4(h)&&(h=h(Ee$1));return set$4(Ae$1,c.x-h[0],c.y-h[1],u*r[2]+u*(this.t.options.services[s].heightOffset||0)),translate$1(o,o,Ae$1),set$4(l,f,f,u),scale$5(o,o,l),o}ot(t,e){const r=identity$2(t),s=this.getMap(),o=this.bt();Ee$1.x=e[0],Ee$1.y=e[1];const a=s.distanceToPointAtRes(100,100,s.getGLRes(),Ee$1);let c;return c=s.altitudeToPoint?this.P:a.y/100,set$4(o,a.x/100*1.01,a.y/100*1.01,c),scale$5(r,r,o),r}U(){const t={x:0,y:0,width:()=>this.i?this.i.width:1,height:()=>this.i?this.i.height:1};this.$=new rt$6({vert:"attribute vec3 aPosition;\n\n\n\nuniform mat4 projViewModelMatrix;\n\n\n\nvoid main() {\n\n    gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n\n}\n\n",frag:"precision mediump float;\nuniform vec3 color;\nvoid main() {\n    gl_FragColor = vec4(color, 1.0);\n}\n",uniforms:["color",{name:"projViewModelMatrix",type:"function",fn:(t,e)=>multiply$5([],e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:t}});const e=[],i=[];this.K=new rt$6({vert:"const float SHIFT_RIGHT_11 = 1.0 / 2048.0;\n\nconst float SHIFT_RIGHT_5 = 1.0 / 32.0;\n\nconst float SHIFT_LEFT_11 = 2048.0;\n\nconst float SHIFT_LEFT_5 = 32.0;\n\nconst float NORMALIZE_6 = 1.0 / 64.0;\n\nconst float NORMALIZE_5 = 1.0 / 32.0;\n\n\n\n#ifdef HAS_POSITION\n\n    attribute vec3 POSITION;\n\n#endif\n\n\n\n#if defined(HAS_RGB)\n\n    attribute vec3 RGB;\n\n#elif defined(HAS_RGBA)\n\n    attribute vec4 RGBA;\n\n#elif defined(HAS_RGB565)\n\n    attribute float RGB565;\n\n#endif\n\n\n\nuniform vec4 pointColor;\n\nuniform float pointSize;\n\n\n\nuniform mat4 projViewModelMatrix;\n\nuniform float pointOpacity;\n\n\n\nvarying vec4 vColor;\n\n\n\n#ifdef HAS_NORMAL\n\n    #ifdef HAS_NORMAL_OCT16P\n\n        attribute vec2 NORMAL_OCT16P;\n\n        float signNotZero(float value) {\n\n            return value >= 0.0 ? 1.0 : -1.0;\n\n        }\n\n        vec2 signNotZero(vec2 value) {\n\n            return vec2(signNotZero(value.x), signNotZero(value.y));\n\n        }\n\n        vec3 octDecode(vec2 encoded, float range) {\n\n            if (encoded.x == 0.0 && encoded.y == 0.0) {\n\n                return vec3(0.0, 0.0, 0.0);\n\n            }\n\n            encoded = encoded / range * 2.0 - 1.0;\n\n            vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n\n            if (v.z < 0.0) {\n\n                v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\n\n            }\n\n            return normalize(v);\n\n        }\n\n        vec3 octDecode(vec2 encoded) {\n\n            return octDecode(encoded, 255.0);\n\n        }\n\n    #else\n\n        attribute vec3 NORMAL;\n\n    #endif\n\n    uniform vec3 lightDir;\n\n    uniform mat3 modelNormalMatrix;\n\n    uniform mat4 positionMatrix;\n\n    float getLambertDiffuse(vec3 lightDir, vec3 normal) {\n\n        return max(dot(-lightDir, normal), 0.0);\n\n    }\n\n#endif\n\n\n\nvoid main() {\n\n    #if defined(HAS_RGB)\n\n        vColor = vec4(RGB / 255.0, 1.0) * pointOpacity;\n\n    #elif defined(HAS_RGBA)\n\n        vColor = RGBA / 255.0 * pointOpacity;\n\n    #elif defined(HAS_RGB565)\n\n        float compressed = RGB565;\n\n        float r = floor(compressed * SHIFT_RIGHT_11);\n\n        compressed -= r * SHIFT_LEFT_11;\n\n        float g = floor(compressed * SHIFT_RIGHT_5);\n\n        compressed -= g * SHIFT_LEFT_5;\n\n        float b = compressed;\n\n        vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5);\n\n        vColor = vec4(rgb, 1.0);\n\n    #else\n\n        vColor = pointColor;\n\n    #endif\n\n\n\n    #ifdef HAS_POSITION\n\n        vec3 localPos = POSITION;\n\n    #endif\n\n\n\n    #ifdef HAS_NORMAL\n\n        mat3 positionNormalMatrix = mat3(positionMatrix);\n\n        mat3 normalMatrix = modelNormalMatrix * positionNormalMatrix;\n\n        #ifdef HAS_NORMAL_OCT16P\n\n            vec3 localNormal = octDecode(NORMAL_OCT16P);\n\n        #else\n\n            vec3 localNormal = NORMAL;\n\n        #endif\n\n        vec3 normal = normalize(normalMatrix * localNormal);\n\n        float colorStrength = getLambertDiffuse(lightDir, normal);\n\n        colorStrength = max(colorStrength, 0.5);\n\n        vColor *= colorStrength;\n\n    #endif\n\n\n\n    gl_Position = projViewModelMatrix * vec4(localPos, 1.0);\n\n    gl_PointSize = pointSize;\n\n}\n\n",frag:"#define SHADER_NAME PNTS\n\nprecision mediump float;\n\n\n\nvarying vec4 vColor;\n\n\n\nvoid main() {\n\n    gl_FragColor = vColor;\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>multiply$5(i,e.projViewMatrix,e.modelMatrix)},{name:"modelNormalMatrix",type:"function",fn:(t,r)=>fromMat4$1(e,r.modelMatrix)}],extraCommandProps:{viewport:t,blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},depth:{enable:!0,range:[0,1],func:"<"}}});const o=this.L();this.X=new st$6({extraCommandProps:o}),this.Y=new ur$4.StandardShader({extraCommandProps:o});const a=this.t;ne$1(a.getRenderer().canvas,this.l,a.getMap()),this.picking=new nr$4(this.u,{vert:this.Y.vert,extraCommandProps:o,uniforms:this.Y.uniforms,defines:{PICKING_MODE:1,ENABLE_PICKING:1,HAS_PICKING_ID:1}},this.pickingFBO)}L(){return{viewport:{x:0,y:0,width:()=>this.i?this.i.width:1,height:()=>this.i?this.i.height:1},colorMask:(t,e)=>e.colorMask||_e$1,cull:{enable:!0,face:(t,e)=>e.cullFace||"back"},stencil:{enable:(t,e)=>!0===e.stencilEnable,func:{cmp:">=",ref:(t,e)=>e.meshProperties.level},opFront:{fail:"keep",zfail:"keep",zpass:"replace"},opBack:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},polygonOffset:{enable:!0,offset:(t,e)=>e.meshProperties.polygonOffset}}}J(t){return{projViewMatrix:this.getMap().projViewMatrix,color:t&&t.color||[0,1,0]}}Z(t){const e=this.getMap(),r=e.getLightManager(),n=(r&&r.getDirectionalLight()||{}).direction||[1,1,-1];return{projViewMatrix:e.projViewMatrix,pointOpacity:t&&t.pointOpacity||1,lightDir:normalize$4(n,n)}}F(){const t=this.getMap(),e=this.t.getRenderer().canvas,{iblTexes:r,dfgLUT:n}=se$1(e),i=oe$1(t,r,n);return p$5(i,{czm_lightDirectionEC:i.light0_viewDirection,lightSpecular:[1,1,1],viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,outSize:[e.width,e.height],polygonFill:[1,1,1,1],polygonOpacity:1}),i}Rt(t,e,n,i){const s=e.materials[t];if(!s||!s.baseColorTexture&&!s.pbrMetallicRoughness)return null;const a=p$5({},i);if(s.baseColorTexture){const t=e.textures[s.baseColorTexture.index];let r;t&&!t.image.color&&(r=this.It(t)),a.baseColorFactor=t&&t.image.color||s.baseColorFactor||[1,1,1,1],r&&(a.baseColorTexture=r)}else{if(s.normalTexture){const t=this.It(e.textures[s.normalTexture.index]),r=s.normalTexture.scale||1;a.normalTexture=t,a.normalMapFactor=r}if(s.occlusionTexture){const t=this.It(e.textures[s.occlusionTexture.index]),r=s.occlusionTexture.strength||1;a.occlusionTexture=t,a.occlusionFactor=r}if(s.emissiveTexture){const t=this.It(e.textures[s.emissiveTexture.index]);a.emissiveTexture=t}const t=s.pbrMetallicRoughness;if(t){if(t.baseColorFactor&&(a.baseColorFactor=t.baseColorFactor),t.baseColorTexture&&void 0!==t.baseColorTexture.index){const r=e.textures[t.baseColorTexture.index];r.image&&r.image.color?a.baseColorFactor=a.baseColorFactor?multiply$3(a.baseColorFactor,a.baseColorFactor,r.image.color):r.image.color:(a.baseColorTexture=this.It(r),a.baseColorTexture.getREGLTexture(this.l))}if(A$3(t.metallicFactor)||(a.metallicFactor=t.metallicFactor),A$3(t.roughnessFactor)||(a.roughnessFactor=t.roughnessFactor),s.metallicRoughnessTexture){const t=this.It(e.textures[s.metallicRoughnessTexture.index]);a.metallicRoughnessTexture=t}}}if(s.s3mMaterial)return new ee$3(a);let c=new ur$4.StandardMaterial(a);return"phong"===n&&(c=ie$4.convertFrom(c)),c.once("complete",this.M),c}It(t){const e={type:t.type?$t$1(t.type):"uint8",format:t.format?Jt$1(t.format):"rgba",flipY:!!t.flipY},n=t.image;n.array?e.data=n.array:n.mipmap&&(e.mipmap=n.mipmap),e.width=n.width,e.height=n.height;const i=t.sampler||t.texture.sampler;return i&&(i.magFilter&&(e.mag=Wt$1(i.magFilter)),i.minFilter&&(e.min=jt$1(i.minFilter)),i.wrapS&&(e.wrapS=qt$1(i.wrapS)),i.wrapT&&(e.wrapT=qt$1(i.wrapT))),new je$4(e,this.O)}Nt(t){const e=t.image,r=window.URL||window.webkitURL,n=new Blob([e.array],{type:e.mimeType});return r.createObjectURL(n)}C({target:t}){const e=t.gt,r=this.h[e];if(r.count--,!r.count){const t=r.meshes;this.T[e]=t,delete this.h[e];const n=t._t;delete t._t,n(null,{mesh:r.meshes,id:e})}}bt(){return le$1}nt(t){return this.t.nt(t)}st(t,e){const r=this.getMap();return r.getGLZoom?r.distanceToPoint(t,e,r.getGLZoom()):r.distanceToPointAtRes(t,e,r.getGLRes())}_pointToPrj(t){const e=this.getMap();return e.getGLZoom?e._pointToPrj(t,e.getGLZoom()):e._pointToPrjAtRes(t,e.getGLRes())}_prjToPoint(t){const e=this.getMap();return e.getGLZoom?e._prjToPoint(t,e.getGLZoom()):e._prjToPointAtRes(t,e.getGLRes(),Te$1)}lt(t){return"Y"===t?ee$1:"X"===t?re$1:fe$1}pick(t,e,r=3){const n=this.t;if(!n||!n.options.picking)return[];if(!this.pickingFBO||!this.picking)return[];const i=this.getMap(),s=this.F(),o=this.picking;o.render(this.g.getMeshes(),s,!0);let a={};o.getRenderedMeshes().length&&(a=o.pick(t,e,r,s,{viewMatrix:i.viewMatrix,projMatrix:i.projMatrix,returnPoint:n.options.pickingPoint}));const{meshId:c,pickingId:l,point:f}=a,u=(0===c||c)&&o.getMeshAt(c);if(!u||!u.geometry)return[];const h=u.properties;f&&f.length&&(f[0]=Math.round(1e5*f[0])/1e5,f[1]=Math.round(1e5*f[1])/1e5,f[2]=Math.round(1e5*f[2])/1e5);const _={batchId:l};if(h&&h.batchTable){const{batchTable:t,batchTableBin:e,count:r}=h,n=l;for(const i in t)_[i]=void 0!==t[i].byteOffset?Et$1(t[i],e,r,n):t[i][n]}return[{data:_,point:f}]}}
/*!
	 * @maptalks/gl v0.68.1
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.com
	 */const be$1=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},Ie$1=be$1(),Ne$1=Ie$1.gl_trans__coders=Ie$1.gl_trans__coders||{};function Se$1(t,e){if(e)for(let r=0;r<e.length;r++)t[e[r].id||e[r].index]=e[r]}Ne$1.inject=function(t){const e=t.toString(),r=e.indexOf("{")+1,n=e.substring(0,r),i=Ie$1.gl_trans__coders=Ie$1.gl_trans__coders||{};let s=`${n}\n    const _____getGlobal = ${be$1.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const t in i)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(s+='tran_____scoders["'+t+'"] ='+i[t].toString()+"\n;");return s+="\n"+e.substring(n.length),s},Ne$1.registerTranscoder=function(t,e){Ne$1[t]=e},Ne$1.getTranscoder=function(t){return Ne$1[t]};const Oe$1=[];class xe$1{constructor(t,e,r,n){this.St=t,this.k=e,this.Ot=n,this.xt=r.version,t.indexOf("i3s:tileset:")<0?(this.wt=this.xt<=1.6?"root":0,r.version=this.xt):(this.wt=t.substring("i3s:tileset:".length),this.xt>1.6&&(this.wt=parseInt(this.wt))),this.St=t,this.Mt=r}load(){const t=this.Mt,e=t.layerScene.baseUrl;if(this.xt<=1.6)return t[this.wt]&&t[this.wt].lodSelection?(this.Ct=t[this.wt],this.vt()):new Promise((r=>{let n=e+"/nodes/"+this.wt;t.layerScene.eslpk&&(n+="/3dNodeIndexDocument.json"),this.Ot(this.k,n,(()=>{this.Ct=t[this.wt],r(this.vt())}))}));if(this.xt>=1.7){if(t[this.wt])return this.Ct=t[this.wt],this.vt();const r=Math.floor(this.wt/t.nodesPerPage);return new Promise((n=>{let i=e+"/nodepages/"+r;t.layerScene.eslpk&&(i+=".json"),this.Ot(this.k,i,(()=>{this.Ct=t[this.wt],n(this.vt())}))}))}return null}getTileset(){return this.Ut}getChildrenURL(){return this.Bt}vt(){const t=this.Mt,e=t.layerScene.baseUrl,r=this.Ct.children,n=[],i={};if(r)for(let s=0;s<r.length;s++)if(this.xt<=1.6){const o=r[s].id;if(t[o])continue;const a=o;i[a]||(i[a]=new Promise((r=>{let n=e+"/nodes/"+a;t.layerScene.eslpk&&(n+="/3dNodeIndexDocument.json"),this.Ot(this.k,n,(()=>{r()}))})),n.push(i[a]))}else{const o=r[s];if(t[o])continue;const a=Math.floor(o/t.nodesPerPage);i[a]||(i[a]=new Promise((r=>{let n=e+"/nodepages/"+a;t.layerScene.eslpk&&(n+=".json"),this.Ot(this.k,n,(()=>{r()}))})),n.push(i[a]))}return n.length?Promise.all(n).then((()=>this.Lt())):this.Lt()}Lt(){return Promise.resolve(this.Pt())}Dt(t){Se$1(this.Mt,t)}Pt(){return{asset:{i3s:!0,version:"1.0",gltfUpAxis:"Z"},geometricError:Number.MAX_VALUE,root:this.Ft(this.Ct,!0)}}Ft(t){const e=this.xt,r=this.Mt,n=t;var i,s=n.obb,o=n.mbs,a={};if(o)i=we$1([],o[0],o[1],o[2]),a.sphere=[...i,o[3]];else if(s){const t=function(t,e,r){const n=fromQuat$1([],r);return n[0]=n[0]*e[0],n[1]=n[1]*e[0],n[2]=n[2]*e[0],n[3]=n[3]*e[1],n[4]=n[4]*e[1],n[5]=n[5]*e[1],n[6]=n[6]*e[2],n[7]=n[7]*e[2],n[8]=n[8]*e[2],[...t,...n]}(i=we$1([],s.center[0],s.center[1],s.center[2]),s.halfSize,s.quaternion);set$4(Oe$1,t[3]+t[6]+t[9],t[4]+t[7]+t[10],t[5]+t[8]+t[11]);const o=len$4(Oe$1);a.sphere=[...i,o]}var c=1/0,l=0;if(n.mbs?l=n.mbs[3]:n.obb&&(l=Math.max(Math.max(n.obb.halfSize[0],n.obb.halfSize[1]),n.obb.halfSize[2])),void 0!==n.lodThreshold)"maxScreenThresholdSQ"===r.lodSelectionMetricType?c=l/(Math.sqrt(n.lodThreshold)/(.25*Math.PI)):console.error("Unsupported lodSelectionMetricType in Layer");else if(void 0!==n.lodSelection)for(var f=0;f<n.lodSelection.length;f++)"maxScreenThreshold"===n.lodSelection[f].metricType&&(c=l/n.lodSelection[f].maxError);(c===1/0||isNaN(c))&&(c=1e5);var u=16*c;const h=identity$2([]),_=n.children;var m;if(_){m=[];const t=this.Mt;for(let r=0;r<_.length;r++){const n=e<=1.6?_[r].id:_[r];if(!t[n]){m=null;break}m.push(this.Ft(t[n]))}}var A={refine:"REPLACE",boundingVolume:a,transform:h,geometricError:u};return e<=1.6?t.lodSelection?t.geometryData&&(A.content={uri:"i3s:mesh:"+(t.id||t.index)}):A.content={uri:"i3s:tileset:"+(t.id||t.index)}:_&&_.length&&!m?A.content={uri:"i3s:tileset:"+(t.id||t.index)}:n.mesh&&(A.content={uri:"i3s:mesh:"+(t.id||t.index)}),m&&m.length&&(A.children=m),A}getJSON(){return this.Ct}}function we$1(t,e,r,n){return K$4(t,g$3(e),g$3(r),n)}const Me$1=!!Ne$1.ktx2,Ce$1=identity$2([]),ve$1=(()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){}return!1})();function Ue$1(t){return t.indexOf("i3s:mesh")>=0}const Be$1="i3s:mesh:".length;function Le$1(t,e,r,n,i){const s=e.layerScene.eslpk,o=function(t,e){const r=e.substring(Be$1);return t>=1.7?parseInt(r):r}(e.version,t),a=e[o],c=e.layerScene.baseUrl,l=[];let f=!1;const u=Ce$1;let h,_;if(e.version<=1.6){if(!a.geometryData)return null;let r=c+`/nodes/${a.id}/`+a.geometryData[a.geometryData.length-1].href;s&&(r+=".bin");const n={geometry:{url:r,info:e.layerScene.store.defaultGeometrySchema}};let i=a.textureData&&a.textureData[0]&&a.textureData[0].href;if(i){const t=e.layerScene.store.textureEncoding[0];let r;r="image/jpeg"===t?"jpg":"png",s&&(i+="."+r);n.material={pbrMetallicRoughness:{baseColorTexture:{url:c+`/nodes/${a.id}/`+i,factor:1,format:r,mimeType:t},metallicFactor:0}}}l.push(n)}else{h=a.mesh.geometry,_=a.mesh.material;const t=e.layerScene.geometryDefinitions[h.definition],{geometryBuffers:o}=t;f=n&&2===o.length;let E=c+`/nodes/${h.resource}/geometries/`+(Ne$1.draco&&f?1:0);s&&(E+=".bin");const T={geometry:{url:E,info:Ne$1.draco&&f?o[1]:o[0]}};if(i&&ve$1&&f&&!Ne$1.draco)throw new Error("Must import @maptalks/transcoder.draco to load i3s draco compressed geometry");const m=e.layerScene.materialDefinitions,A=e.layerScene.textureSetDefinitions;let p,y=0;_&&(y=m[_.definition]),p=m?function(t,e,r,n,i,s){const o=JSON.parse(JSON.stringify(t));return Pe$1(o,e,r,n,i,s),o}(y,A,c,_.resource,r,e.layerScene.eslpk):{pbrMetallicRoughness:{metallicFactor:0}},T.material=p,l.push(T)}return{dracoCompression:f,meshes:l,nodeIndex:o,center:a.obb&&a.obb.center||a.mbs&&[a.mbs[0],a.mbs[1],a.mbs[2]],transform:u}}function Pe$1(t,e,r,n,i,s){for(const o in t)if(t[o]&&t[o].textureSetDefinitionId>=0){const a=e[t[o].textureSetDefinitionId],c="images/"+a.formats[0].format,l=De$1(a.formats,i),f={url:r+`/nodes/${n}/textures/${l.name}`,factor:void 0===t[o].factor?1:t[o].factor,format:l.format,mimeType:c};if(s){let t="";switch(l.format){case"dds":t="bin.dds";break;case"jpg":case"png":t=l.format}f.url+="."+t}t[o]=f}else R$5(t[o])&&Pe$1(t[o],e,r,n,i,s)}function De$1(t,e){for(let r=0;r<=t.length;r++){const n=t[r].format;if("dds"===n&&e.hasExtension("WEBGL_compressed_texture_s3tc"))return t[r];if("jpg"===n||"png"===n)return t[r];if("ktx2"===n&&Me$1)return t[r]}return null}const Fe$1=[];function ke$1(t,e){return t.j-e.j}function He$1(t,e,r){return t[0]=e[r],t[1]=e[r+3],t[2]=e[r+6],t}const Ve$1=[],Xe$1=[],Ye$1=[],Ze$1=[],Ke$1=[],We$1=2*Math.PI;class je$1{constructor(t,e,r,n){this.west=t,this.south=e,this.east=r,this.north=n}static contains(t,e){var r=e[0],n=e[1],i=t.west,s=t.east;return s<i&&(s+=We$1,r<0&&(r+=We$1)),(r>i||at$2(r,i,1e-14))&&(r<s||at$2(r,s,1e-14))&&n>=t.south&&n<=t.north}static southwest(t,e){return e[0]=t.west,e[1]=t.south,e[2]=0,e}static northeast(t,e){return e[0]=t.east,e[1]=t.north,e[2]=0,e}static southeast(t,e){return e[0]=t.east,e[1]=t.south,e[2]=0,e}static northwest(t,e){return e[0]=t.west,e[1]=t.north,e[2]=0,e}}const qe$1=[0,0,1];function $e$1(t,e){return K$4(e,t[0],t[1],t[2])}class Je$1{constructor(t,e){this.normal=copy$4([],t),this.distance=e}static fromPointNormal(t,e,r){var n=-dot$4(e,t);return copy$4(r.normal,e),r.distance=n,r}}const Qe$1=[],tr$1=[],er$1=[],rr$1=[],nr$1=[],ir$1=[],sr$1=[],or$1=[],ar$1=[],cr$1=[],lr$1=new Je$1([1,0,0],0),fr$1=[];class ur$1{constructor(t){this.southwestCornerCartesian=[],this.northeastCornerCartesian=[],this.westNormal=[],this.eastNormal=[],this.southNormal=[],this.northNormal=[],this.rectangle=new je$1(...t),this.minimumHeight=t[4],this.maximumHeight=t[5],this.computeBox(this.rectangle)}distanceToCamera(t,e){var r,n,s,o=0;if(!je$1.contains(this.rectangle,e)){var c=this.northeastCornerCartesian,l=this.westNormal,f=this.southNormal,u=this.eastNormal,h=this.northNormal,_=subtract$2(fr$1,t,this.southwestCornerCartesian),d=dot$4(_,l),E=dot$4(_,f),T=subtract$2(fr$1,t,c),m=dot$4(T,u),A=dot$4(T,h);d>0?o+=d*d:m>0&&(o+=m*m),E>0?o+=E*E:A>0&&(o+=A*A)}if(n=this.minimumHeight,(r=e[2])>(s=this.maximumHeight)){var p=r-s;o+=p*p}else if(r<n){var y=n-r;o+=y*y}return Math.sqrt(o)}computeBox(t){const e=this;$e$1(je$1.southwest(t,tr$1),e.southwestCornerCartesian),$e$1(je$1.northeast(t,tr$1),e.northeastCornerCartesian),Qe$1[0]=t.west,Qe$1[1]=.5*(t.south+t.north),Qe$1[2]=0;var r=$e$1(Qe$1,er$1),n=cross$1(nr$1,r,qe$1);normalize$4(e.westNormal,n),Qe$1[0]=t.east;var s=$e$1(Qe$1,or$1),o=cross$1(nr$1,qe$1,s);normalize$4(e.eastNormal,o);var a,c=subtract$2(nr$1,r,s),l=normalize$4(rr$1,c),f=t.south;if(f>0){Qe$1[0]=.5*(t.west+t.east),Qe$1[1]=f;var u=$e$1(Qe$1,ar$1);copy$4(cr$1,l);var h=Je$1.fromPointNormal(e.southwestCornerCartesian,e.westNormal,lr$1);hr$1(ar$1,cr$1,h,e.southwestCornerCartesian),a=it$2(u,ir$1)}else a=st$2(je$1.southeast(t,tr$1),ir$1);var _=cross$1(sr$1,a,c);normalize$4(e.southNormal,_);var d,E=t.north;if(E<0){Qe$1[0]=.5*(t.west+t.east),Qe$1[1]=E;var T=$e$1(Qe$1,ar$1);scale$4(cr$1,l,-1);var m=Je$1.fromPointNormal(e.northeastCornerCartesian,e.eastNormal,lr$1);hr$1(ar$1,cr$1,m,e.northeastCornerCartesian),d=it$2(T,ir$1)}else d=st$2(je$1.northwest(t,tr$1),ir$1);var A=cross$1(sr$1,c,d);normalize$4(e.northNormal,A)}}function hr$1(t,e,r,n){var s=t,o=e,a=r.normal,c=dot$4(a,o);if(!(Math.abs(c)<1e-15)){var l=(-r.distance-dot$4(a,s))/c;if(!(l<0))return add$4(n=scale$4(n,o,l),s,n)}}const _r$1=new t__namespace.Extent(0,0,0,0),dr$1=new t__namespace.Extent(0,0,0,0),Er$1=[],Tr$1=[],mr$1=[],Ar$1=[],pr$1=new t__namespace.Point(0,0),yr$1=[],Rr$1=new t__namespace.Coordinate(0,0),gr$1=identity$2([]);class br$1 extends t__namespace.Layer{constructor(t,e){super(t,e),this._e(),this.Gt={},this.de=[]}_e(){let t=this.options.services.map((t=>t.url));this.Ee=t.map(((t,e)=>function(t,e){return{baseUrl:(t=I$4(t)).substring(0,t.lastIndexOf("/"))+"/",content:{url:t},refine:"replace",matrix:identity$2([]),k:e,te:0}}(t,e))),this.fire("rootready",{roots:this.Ee.slice(0)})}getTileUrl(t){return t}getExtent(e){if(!e&&0!==e){const e=new t__namespace.Extent;for(let t=0;t<this.Ee.length;t++)if(this.Ee[t].boundingVolume){const r=this.boundingVolumeToExtent(this.Ee[t]);e._combine(r)}return e}return this.Ee[e]&&this.Ee[e].boundingVolume?this.boundingVolumeToExtent(this.Ee[e]):null}boundingVolumeToExtent(e){const r=e.boundingVolume.Te?gr$1:e.matrix,n=this.getMap();if(e.boundingVolume.region){const r=e.boundingVolume.region;return new t__namespace.Extent(b$5(r[0]),b$5(r[1]),b$5(r[2]),b$5(r[3]))}if(e.boundingVolume.sphere){const s=e.boundingVolume.sphere,o=Q$3([],transformMat4$2([],s,r)),a=s[3],c=n.locate(o,-a,a),l=n.locate(o,a,-a);return new t__namespace.Extent(c,l)}if(e.boundingVolume.box){const o=e.boundingVolume.box,a=transformMat4$2([],o,r),c=new t__namespace.Coordinate(Q$3([],a)),l=o.slice(3);multiply$6(l,fromMat4$1([],e.matrix),l);const f=length$4(l.slice(0,3)),u=length$4(l.slice(3,6)),h=length$4(l.slice(6,9)),_=Math.max(f,u,h),d=n.locate(c,-_,_),E=n.locate(c,_,-_);return new t__namespace.Extent(d,E)}return null}getRootTiles(){return this.Ee}getTiles(){const t=this.getRenderer();if(!t.ready)return this.me(),{tiles:Ar$1};const e=this.getMap(),r=e.cameraPosition;let n,s;if(e.getGLZoom)s=e.pointToDistance(r[2],0,e.getGLZoom()),Rr$1.set(r[0],r[1]),n=e.pointToCoord(Rr$1,e.getGLZoom());else{const t=e.getGLRes();s=e.pointAtResToDistance(r[2],0,t),Rr$1.set(r[0],r[1]),n=e.pointAtResToCoord(Rr$1,t)}this.Ae=this.Ae||[],set$4(this.Ae,g$3(n.x),g$3(n.y),s),this.pe=K$4(this.pe||[],this.Ae[0],this.Ae[1],this.Ae[2]),this.ye=2*Math.tan(.5*g$3(e.getFov()));const o=e.projViewMatrix,a={children:[],level:-1};let c=a;const l=[];for(let e=0;e<this.Ee.length;e++){let r=1/0;const n=[this.Ee[e]],i=this.Re(e);for(;n.length>0;){const e=n.pop();for(e.id||this.ge(e);c.level>=e.te;)c=c.parent;const s=this.be(e,i,o);if(s<1){let t=c;for(;t&&!t.content;)t=t.parent;if(0===s&&t&&t.content&&this.Ie(l,t),!1===this.options.services[e.k].alwaysShow)continue;if(!(0===s&&e.te<=r))continue;e.content&&(r=e.te)}e.j<1/0&&this.Ne(e);const a=this.ee(e,c);c.children.push(a);const f=e.children,u=f&&f.length,h=a.content;if(!u&&h&&this.Ie(l,a),u){h&&"add"===e.refine&&this.Ie(l,a),c=a;const r=f[0].parent;let i=!1;for(let s=0,o=f.length;s<o;s++){if(r){const e=t.getCachedTile(f[s].id);if(e&&e.error&&404!==e.error.status)continue;i=!0}else{i=!0,f[s].parent=e,f[s].ft=e.ft,f[s].baseUrl=e.baseUrl;const t=f[s].content&&(f[s].content.url||f[s].content.uri);t&&(C$4(t)||t.indexOf("i3s:")>=0?f[s].baseUrl=e.baseUrl:-1===t.indexOf("http://")&&-1===t.indexOf("https://")?f[s].content.url=e.baseUrl+t:f[s].baseUrl=t.substring(0,t.lastIndexOf("/")+1))}n.push(f[s])}!i&&h&&this.Ie(l,a)}}}return{root:a,tiles:l}}Ie(t,e){const{viewerRequestVolume:r}=e.node;r&&!function(t,e,r){if(r.region){const e=r.region;if(t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3])return!0}else{if(r.sphere)return Ir$1(r,e);if(r.box)return 0===Nr$1(r,e)}return!1}(this.Ae,this.pe,r)||t.push(e)}ee(t,e){return{id:t.id,node:t,children:[],level:t.te,parent:e,content:t.content&&t.content.url}}ge(e){e.id=t__namespace.Util.GUID(),e.matrix=e.transform||identity$2([]),e.Se=this.Oe(e),e.parent&&(function(t){return t.content&&t.content.uri&&t.content.uri.indexOf("i3s:")>=0}(e)||(e.matrix=multiply$5(e.matrix,e.parent.matrix,e.matrix)),e.k=e.parent.k,void 0===e.te&&(e.te=e.parent.te+1),e.maxExtent=e.parent.maxExtent),e.refine=e.refine&&e.refine.toLowerCase()||"replace",e.content&&!e.content.url&&e.content.uri&&(e.content.url=e.content.uri),this.xe(e)}xe(t){const e=t.boundingVolume;if(!e||e.Te)return;const r=this.options.services[t.k].heightOffset||0,s=this.options.offset,o=y$4(s)||s[0]||s[1];if(!t.boundingVolume||!r&&exactEquals$5(t.matrix,gr$1)&&!o)return;const{region:a,box:c,sphere:l}=e;if(a){const t=this.we([b$5(a[0]),b$5(a[1])]);a[0]=g$3(t.x),a[1]=g$3(t.y);const e=this.we([b$5(a[2]),b$5(a[3])]);a[2]=g$3(e.x),a[3]=g$3(e.y),a[4]+=r,a[5]+=r}else if(c||l){const e=c||l,n=transformMat4$2(Er$1,e,t.matrix),s=Q$3(Tr$1,n),o=this.we([s[0],s[1]]);s[0]=o.x,s[1]=o.y,s[2]+=r,K$4(e,g$3(s[0]),g$3(s[1]),s[2])}e.Te=!0}Oe(t){return void 0===t.geometricError||!t.boundingVolume}Ne(t){let e=t.parent;for(;e&&e.Se&&!(e.j<=t.j);)e.j=t.j,e=t.parent}onTileLoad(t,e){if(t.children&&(!e.children||!e.children.length)){e.children=t.children;const r=e.content.url;e.baseUrl=r.substring(0,r.lastIndexOf("/")+1);const n=this.getRenderer();n&&n.setToRedraw()}}onTilesetLoad(t,e,r){if(!t)return void console.warn("invalid tileset at : "+r);const i=this.options.services[e.k],s=(t.asset&&t.asset.gltfUpAxis||e&&e.ft||i.upAxis||"Y").toUpperCase();t.root.baseUrl=r.substring(0,r.lastIndexOf("/")+1);const o=r.indexOf("realspace/")>-1;0===e.te&&(t.asset&&t.asset.s3mType&&o||i.isSuperMapiServer)&&(t.root.baseUrl+="data/path/");const a=t.asset.i3s;if(t.root.ft=s,e){const r=e.boundingVolume;p$5(e,t.root),e.refine=e.refine&&e.refine.toLowerCase()||"replace",r&&(e.boundingVolume=r);const i=t.root.transform;i&&(e.parent?a||(e.matrix=multiply$5([],e.parent.matrix,i)):e.matrix=i),this.xe(e),e.Me=e.content,delete e.content,t.root.content&&(e.content=t.root.content),e.Se=this.Oe(e);const s=e.content&&(e.content.url||e.content.uri);s&&e.content.uri&&(e.content.url=e.content.uri,delete e.content.uri),a||!s||C$4(s)||-1!==s.indexOf("http://")||-1!==s.indexOf("https://")||(e.content.url=e.baseUrl+s)}this.me(),this.fire("loadtileset",{tileset:t,index:e.k,url:r})}be(t,e,r){if(t.j=1/0,0===t.te||t.Se)return 1;if(!this.Ce(t,e,r))return-1;if(0===t.geometricError)return 1;let n=this.options.services[t.k].maximumScreenSpaceError;null==n&&(n=8);let i=this.ve(t);return 0===i&&t.parent&&(i=.5*(t.parent.Ue||0)),i>=n?1:0}nt(e,r){r||(r=new t__namespace.Point(0,0));const n=this.getMap();return n.getGLZoom?n.coordToPoint(e,n.getGLZoom(),r):n.coordToPointAtRes(e,n.getGLRes(),r)}Ce(e,r,i){const o=e.id;let a=this.de[o];const{boundingVolume:c}=e,h=c.sphere,_=c.region,d=c.box;if(!a){let r,i,c;if(_){r=_r$1.set(b$5(_[0]),b$5(_[1]),b$5(_[2]),b$5(_[3]));const t=r.getCenter(),e=this.Be(t);r=r.convertTo((t=>this.nt(t,pr$1)),dr$1),c=_[4],i=_[5],a=this.de[o]=[[r.xmin,r.ymin,c*e[2]],[r.xmax,r.ymax,i*e[2]]],a.center=t}else if(h){const e=Q$3(Er$1,h),r=new t__namespace.Coordinate(e),n=this.nt(r,pr$1).toArray(),i=this.Be(r);n.push(e[2]*i[2]),a=this.de[o]=[n,h[3]*i[2]],a.center=r}else if(d){const r=Q$3(Er$1,d),i=new t__namespace.Coordinate(r),c=this.nt(i,pr$1).toArray(),l=this.Be(i);c.push(r[2]*l[2]);const f=d.slice(3);exactEquals$5(e.matrix,gr$1)||multiply$6(f,fromMat4$1(yr$1,e.matrix),f);for(let t=0;t<f.length;t++)f[t]*=l[t%3],d[3+t]=f[t];a=this.de[o]=[...c,...f],a.center=i}}if(r){if(_)_r$1.xmin=a[0][0],_r$1.ymin=a[0][1],_r$1.xmax=a[1][0],_r$1.ymax=a[1][1];else if(h){const t=a[2];_r$1.xmin=a[0][0]-t,_r$1.ymin=a[0][1]-t,_r$1.xmax=a[0][0]+t,_r$1.ymax=a[0][1]+t}else if(d){const t=a[1],e=a[2];_r$1.xmin=a[0][0]-t,_r$1.ymin=a[0][1]-e,_r$1.xmax=a[0][0]+t,_r$1.ymax=a[0][1]+e}if(!r.intersects(_r$1))return!1}return _?intersectsBox$1(i,a):h?function(matrix,sphere,mask){setPlanes$1(matrix);for(var center=sphere[0],negRadius=-sphere[1],i=0;i<6;i++)if((!mask||"0"!==mask.charAt(i))&&distanceToPoint$1(planes$1[i],center)<negRadius)return!1;return!0}(i,a):!!d&&function(matrix,box,mask){setPlanes$1(matrix);for(var i=0;i<6;i++)if(!(mask&&"0"===mask.charAt(i)||intersectsPlane(planes$1[i],box)))return!1;return!0}(i,a)}Be(t){const e=this.getMap(),r=e.distanceToPointAtRes(100,100,e.getGLRes(),t);let n;return n=e.altitudeToPoint?e.altitudeToPoint(100,e.getGLRes())/100:r.y/100,set$4(mr$1,r.x/100*1.01,r.y/100*1.01,n),mr$1}we(e){Array.isArray(e)&&(e=new t__namespace.Coordinate(e));let r=this.options.offset;if(y$4(r)&&(r=r(Array.isArray(e)?new t__namespace.Coordinate(e):e)),r[0]||r[1]){const t=this.getMap(),n=t.getGLRes(),i=t.coordToPointAtRes(e,n);return i._sub(r),t.pointAtResToCoord(i,n)}return e}Re(e){const r=this.options.services[e].maxExtent;if(!r)return null;const n=this.Ee[e];return n.maxExtent||(n.maxExtent=new t__namespace.Extent(r).convertTo((t=>this.nt(t)))),n.maxExtent}ve(t){const e=this.ye,r=t.geometricError;if(0===r)return 0;const n=this.getMap();let i;t.boundingVolume.region?i=function(t,e,r){return t.Le||(t.Le=new ur$1(t.boundingVolume.region)),t.Le.distanceToCamera(e,r)}(t,this.pe,this.Ae):t.boundingVolume.sphere?i=Ir$1(t.boundingVolume,this.pe):t.boundingVolume.box&&(i=Nr$1(t.boundingVolume,this.pe));const s=Math.max(Math.abs(i),1e-7),o=r*n.height/(s*e);return t.j=i,t.Ue=o,o}me(){const t=this.getRenderer();t&&t.setToRedraw()}Et(t){return this.de[t]}identify(e,r={}){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];const s=n.coordToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(s,r)}identifyAtPoint(t,e={}){const r=this.getMap(),n=this.getRenderer();if(!r||!n)return[];const i=r.getDevicePixelRatio();return n.pick(t.x*i,t.y*i,e)}}function Ir$1(t,e){const n=dist$2(t.sphere,e),s=t.sphere[3];return n<s?0:n-s}function Nr$1(t,e){const r=t.box;return function(t,e,r){return Math.sqrt(function(t,e,r){var n=subtract$2(Ve$1,r,t),i=He$1(Xe$1,e,0),s=He$1(Ye$1,e,1),o=He$1(Ze$1,e,2),a=len$4(i),c=len$4(s),l=len$4(o);normalize$4(i,i),normalize$4(s,s),normalize$4(o,o);var f=Ke$1;f[0]=dot$4(n,i),f[1]=dot$4(n,s),f[2]=dot$4(n,o);var u,h=0;return f[0]<-a?h+=(u=f[0]+a)*u:f[0]>a&&(h+=(u=f[0]-a)*u),f[1]<-c?h+=(u=f[1]+c)*u:f[1]>c&&(h+=(u=f[1]-c)*u),f[2]<-l?h+=(u=f[2]+l)*u:f[2]>l&&(h+=(u=f[2]-l)*u),h}(t,e,r))}(set$4(Er$1,r[0],r[1],r[2]),set$6(yr$1,r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11]),e)}br$1.mergeOptions({maxGPUMemory:512,retireInterval:2e3,loadingLimitOnInteracting:5,loadingLimit:0,renderer:"gl",forceRenderOnZooming:!0,forceRenderOnRotating:!0,forceRenderOnMoving:!0,debug:!1,debugOutline:[0,1,0],meshLimitPerFrame:1,i3sNodepageLimitPerFrame:1,enableI3SCompressedGeometry:!0,forceI3SCompressedGeometry:!0,picking:!0,pickingPoint:!0,geometryEvents:!1,antialias:!1,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb"],offset:[0,0]}),br$1.registerRenderer("gl",class extends t__namespace.renderer.CanvasRenderer{constructor(t){super(t),this.prepareWorker(),this.tilesLoading={},this.tileCache=new G$3(1024*t.options.maxGPUMemory*1024,this.deleteTile.bind(this)),this.Gt={},this.kt=[],this.Ot=this.Ht.bind(this)}getAnalysisMeshes(){if(!this.painter)return Fe$1;const t=this.painter.getPaintedMeshes();if(!t)return Fe$1;const e=[],{b3dmMeshes:r,pntsMeshes:n,i3dmMeshes:i}=t;return r.length&&U$3(e,r),n.length&&U$3(e,n),i.length&&U$3(e,i),e}needToRedraw(){return!!this.getMap().isInteracting()||!!this.kt.length||super.needToRedraw()}drawOnInteracting(t,e,r){this.draw(e,r)}draw(t,e){const r=this.prepareCanvas();if(r&&!r.intersects(this.canvasExtent2D))return void this.completeRender();const{root:n,tiles:i}=this.layer.getTiles();if(!i||!i.length)return void this.completeRender();this.zt(),this.Vt();const{selectedTiles:o,leaves:a,requests:c}=this.Xt(n,i);c.length&&this.loadTiles(c),this.Yt(o,a,e),this.Zt(),c.length||this.completeRender()}Xt(t,e){let r=[];this.Kt();let n=0;const i=this.Wt(),s={};let o=!1,a=!1;for(let t=0;t<e.length;t++){const i=e[t],c=i.node;if(s[c.id])continue;s[c.id]=1;let l=!1;const f=this.getCachedTile(c.id);(this.jt(c.id)?(n++,l=a=!0,this.tilesLoading[c.id].current=!0):f?(this.getTileOpacity(f)<1&&(l=a=!0),o=!0,i.selected=!0,i.data=f):this.painter.has(c)||(l=a=!0,r.push(c)),l)&&((this.qt(i)||this.$t(i).length)&&(o=!0))}let c=[],l={};if(o&&({selectedTiles:c,leaves:l}=this.Jt(t)),r.length>1&&(r.sort(ke$1),i)){const t=i-n;r=t>0?r.slice(0,t):[]}return{loading:a,requests:r,selectedTiles:c,leaves:l}}Jt(t){const e=[],r={};let n;const i=[t],s=[];for(;i.length>0||s.length>0;){if(s.length>0){const t=s[s.length-1];if(t.Qt===i.length){s.pop(),t===n&&(t.leave=!0,r[t.node.id]=1),e.push(t);continue}}const t=i.pop(),o=t.children;if(t.selected)if("add"===t.node.refine)r[t.node.id]=1,t.selectionDepth=s.length,e.push(t);else{if(t.selectionDepth=s.length,n=t,0===o.length){t.leave=!0,r[t.node.id]=1,e.push(t);continue}s.push(t),t.Qt=i.length}for(let t=0;t<o.length;t++)i.push(o[t])}return{selectedTiles:e,leaves:r}}qt(t){if(!t.parent)return null;let e=t.parent;for(;e&&e.level>=0;){const t=e.node.id;if(this.tileCache.has(t))return e.selected=!0,e.data=this.tileCache.get(t),e;e=e.parent}return null}$t(t){const e=[];if(!t.node.children||!t.node.children.length)return e;const r=t.te+1,n=[t.node];for(;n.length>0;){const i=n.pop().children;for(let s=0,o=i.length;s<o;s++){if((!i[s].content||!i[s].content.url)&&i[s].children&&i[s].children.length){n.push(i[s]);continue}const o=i[s].id;if(this.tileCache.has(o)){const r=this.layer.ee(i[s],t);r.selected=!0,r.data=this.tileCache.get(o),t.children.push(r),e.push(r)}else i[s].te<=r&&n.push(i[s])}}return e}Yt(t,e,r){this.tileCache.markAll(!1);for(let e=0,r=t.length;e<r;e++){const r=t[e].data;r.current=!0,this.tileCache.add(t[e].node.id,r)}this.tileCache.shrink();const n={tiles:t,leaves:e};this.onDrawTileStart(n);const i=r&&r.renderTarget,s=r&&r.sceneFilter,o=this.painter.paint(t,e,s,i);this.layer.options.debug&&this.painter.paintRegion(t,{color:this.layer.options.debugOutline},s,i),this.onDrawTileEnd(n),o&&this.layer.fire("canvasisdirty",{renderCount:o})}onDrawTileStart(){}onDrawTileEnd(){}loadTiles(t){for(let e=0,r=t.length;e<r;e++){const r=t[e];this.tilesLoading[r.id]={current:!0,node:r},this.loadTile(r)}}loadTile(t){let e=t.content.url;if(C$4(e)){const r=v$4(e);return void this.re(e,r,t)}if(function(t){return t.indexOf("i3s:tileset")>=0}(e)){const r=t.k;return new xe$1(e,r,this.ne[r],this.Ot).load().then((r=>{this.onTilesetLoad(r,t,e)}))}t&&-1===e.indexOf("http://")&&-1===e.indexOf("https://")&&!Ue$1(e)&&(e=t.baseUrl+e);const r=this.layer.options.services[t.k];if(r.ajaxInMainThread){let n=r.urlParams;n&&(n=(e.indexOf("?")>0?"&":"?")+n);let i=w$9.getArrayBuffer(e+(n||""),r.fetchOptions);const s=i.xhr;i=i.then((r=>{delete this.Gt[e],r?this.re(e,r.data,t):this.onTileError(null,t)})).catch((r=>{delete this.Gt[e],this.onTileError(r,t)})),this.Gt[e]=s}else this.re(e,null,t)}re(t,e,n){let i=this.ie;i||(i=I$7.getSupportedFormats(this.gl.gl||this.gl),this.ie=i);const s=this.layer.options.services[n.k];s.isSuperMapiServer&&(t=function(t,e){const r=t.substring(e.length).split("/"),n=[];for(let t=0;t<r.length;t++)n.push(encodeURIComponent(r[t]));return e+n.join("/")}(t,n.baseUrl));const o={url:t=this.layer.getTileUrl(t,n.baseUrl,s),arraybuffer:e,rootIdx:n.k,upAxis:n.ft,transform:n.matrix,supportedFormats:i};if(Ue$1(t)){if(o.i3sInfo=Le$1(t,this.ne[n.k],this.regl,this.layer.options.enableI3SCompressedGeometry,this.layer.options.forceI3SCompressedGeometry),!o.i3sInfo)return void this.onTileError({status:404},n)}this.workerConn.loadTile(this.layer.getId(),o,((e,r)=>{if(e)return void this.onTileError(e,n);const{magic:i}=r;"b3dm"===i||"pnts"===i||"i3dm"===i||"cmpt"===i?this.kt.push({data:r,tile:n}):this.onTilesetLoad(r,n,t)}))}Vt(){const t=this.getMap(),e=this.layer.options.meshLimitPerFrame;let r=0;for(;this.kt.length&&(r<e||!t.isInteracting());){const{data:t,tile:e}=this.kt.shift(),{magic:n}=t;"b3dm"===n?this.painter.createB3DMMesh(t,e.id,e,((r,{mesh:n})=>{this.se(t,e,r,n)})):"pnts"===n?this.painter.createPntsMesh(t,e.id,e,((r,{mesh:n})=>{this.se(t,e,r,n)})):"i3dm"===n?this.painter.createI3DMMesh(t,e.id,e,((r,{mesh:n})=>{this.se(t,e,r,n)})):"cmpt"===n&&this.painter.createCMPTMesh(t,e.id,e,((r,{mesh:n})=>{this.se(t,e,r,n)})),r++}}se(t,e,r,n){if(r)this.onTileError(r,e);else{const r=this.oe(n);e.memorySize=r,this.onTileLoad(t,e)}}oe(t){let e=0;if(Array.isArray(t))for(let r=0;r<t.length;r++)t[r]&&(e+=this.oe(t[r]));else t&&(e+=t.getMemorySize());return e}onTileLoad(t,e){this.layer&&(delete this.tilesLoading[e.id],this.layer.onTileLoad(t,e),this.ae(e),this.setToRedraw(),this.layer.fire("tileload",{node:e}))}onTilesetLoad(t,e,r){this.layer&&(t.capabilities||t.layers&&t.layers[0]&&t.layers[0].capabilities?this.ce(t,e,r):(delete this.tilesLoading[e.id],this.layer.onTilesetLoad(t,e,r)))}onTileError(t,e){if(!this.layer)return;console.warn("failed to load 3d tile: "+e.content.url),console.warn(t),delete this.tilesLoading[e.id],this.le(e,t),this.setToRedraw(),this.layer.fire("tileerror",{node:e,error:t})}getCachedTile(t){return this.tileCache.get(t)}le(e,r){const n={loadTime:t__namespace.Util.now(),current:!0,error:r,node:e};this.tileCache.add(e.id,n)}ae(e){const r={loadTime:t__namespace.Util.now(),current:!0,node:e};this.tileCache.add(e.id,r)}abortTileLoading(t){if(!t||!this.workerConn)return;const e=t.node.content.url;if(this.layer.options.services[t.node.k].ajaxInMainThread){const t=this.Gt[e];t&&t.abort()}else this.workerConn.abortTileLoading(this.layer.getId(),e);delete this.Gt[e]}Kt(){if(this.tilesLoading)for(const t in this.tilesLoading)this.tilesLoading[t].current=!1}deleteTile(t){this.painter.deleteTile(t)}createContext(){const t=this.layer,e=t.options.glOptions||{alpha:!0,depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:t.options.antialias},r=this.canvas.gl&&this.canvas.gl.wrap;r?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):(this.glOptions=e,this.gl=this.fe(this.canvas,e)),this.regl=this.regl||u$5({gl:this.gl,attributes:e,extensions:["OES_element_index_uint"],optionalExtensions:t.options.optionalExtensions||[]}),r&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.painter=new ge$1(this.regl,t)}prepareWorker(){const t=this.getMap();this.workerConn||(this.workerConn=new P$5("@maptalks/3dtiles",t.id));const e=this.workerConn;if(!e.isActive())return;let r=this.layer.options||{};r=p$5({},r),delete r.offset,r.projection=t.getSpatialReference().getProjection().code;const n=this.layer.getId();e.addLayer(n,r,(t=>{if(t)throw t;this.layer&&(this.ready=!0,this.layer.fire("workerready"))}))}onRemove(){this.painter&&this.painter.remove(),this.pickingFBO&&(this.canvas.pickingFBO||this.pickingFBO.destroy(),delete this.pickingFBO),this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(t=>{if(t)throw t})),this.workerConn.remove(),delete this.workerConn),this.clear(),delete this.tileCache,super.onRemove()}clear(){this.Zt(!0),this.tileCache.reset(),this.tilesLoading={},super.clear()}clearCanvas(){this.regl&&this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas()}getTileOpacity(){return 1}getStencilValue(){return 0}Zt(t){this.ue||(this.ue=Date.now());const e=Date.now();if(t||!(e-this.ue<this.layer.options.retireInterval)){this.ue=e;for(const e in this.tilesLoading){const r=this.tilesLoading[e];!t&&r.current||this.abortTileLoading(r)}}}Wt(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit}fe(t,e){const r=["webgl","experimental-webgl"];let n=null;for(let i=0;i<r.length;++i){try{n=t.getContext(r[i],e)}catch(t){}if(n)break}return n}jt(t){return!!this.tilesLoading[t]}getI3DMMeshes(){return this.painter.getI3DMMeshes()}getPNTSMeshes(){return this.painter.getPNTSMeshes()}getB3DMMeshes(){return this.painter.getB3DMMeshes()}readBatchData(t,e,r){return _t$1(t,e,0,r)}zt(){if(!this.he)return;const t=this.layer.options.i3sNodepageLimitPerFrame||Number.MAX_VALUE;let e=0;const r=[];for(const n in this.he){const i=this.he[n];if("pending"===i.status)continue;i.status="pending";const s=i.rootIdx;if(r.push(w$9.getJSON(n).then((t=>{delete this.he[n];const e=this.ne[s];if(e){t.nodes?Se$1(e,t.nodes):(e[t.id]=t,Se$1(e,t.children));for(let t=0;t<i.length;t++)i[t]();this.setToRedraw()}else this.setToRedraw()}))),e++,e>=t)break}r.length&&Promise.all(r)}Ht(t,e,r){this.he||(this.he={}),this.he[e]=this.he[e]||[],this.he[e].rootIdx=t,this.he[e].push(r),this.setToRedraw()}ce(t,e,r){this.ne||(this.ne=[]);const n=e.k;this.ne[n]||(this.ne[n]={});const i=this.ne[n];t.layers&&(t=t.layers[0],"/"!==r[r.length-1]&&(r+="/"),r+="layers/0"),i.version=+(this.layer.options.services[n].i3sVersion||t.store.version),function(t,e,r,n,i,s){if(!i.layerScene){i.layerScene=t,i.nodesPerPage=t.nodePages&&t.nodePages.nodesPerPage||64,i.lodSelectionMetricType=t.nodePages&&t.nodePages.lodSelectionMetricType;let e=n;if(i.layerScene.eslpk=e.indexOf("3dSceneLayer.json")>=0,e.endsWith(".json")){const t=n.lastIndexOf("/");e=t<0?"./":n.substring(0,t)}i.layerScene.baseUrl=function(t){return t.split("?")[0]}(e)}return new xe$1(n,e,i,s).load()}(t,n,0,r,i,this.Ot).then((t=>{this.onTilesetLoad(t,e,r)}))}pick(t,e,r){return this.painter?this.painter.pick(t,e,r&&r.tolerance):[]}}),br$1.registerJSONType("Geo3DTilesLayer");class Sr$1{constructor(t,e,r){this.Pe=t,this.De=e||k$8,this.ie=r,this.Fe={"image/crn":Ne$1.crn&&Ne$1.crn(),"image/ktx2":Ne$1.ktx2&&Ne$1.ktx2(),"image/cttf":Ne$1.ktx2&&Ne$1.ktx2(),draco:Ne$1.draco&&Ne$1.draco()}}static createEmptyB3DM(){return{featureTable:null,batchTable:null,gltf:{}}}load(t,e,r=0,n=0,i){return e?(n||(n=e.byteLength),this.Ge(t,e,r,n,i)):w$9.getArrayBuffer(t,{}).then((e=>{const i=e.data;return n||(n=i.byteLength),this.Ge(t,i,r,n)}))}Ge(t,e,r,n,i){const s=i&&i.maxTextureSize,o=this.ke(e,r,n,t);if(o.error)return Promise.resolve(o);const a=t.substring(0,t.lastIndexOf("/")),c=new this.De(a,o.glb,{transferable:!0,requestImage:this.Pe,decoders:this.Fe,supportedFormats:this.ie,maxTextureSize:s});return c.load({skipAttributeTransform:!1}).then((e=>{e.url=`${t}-${r}-${n}`;const i=c.transferables;for(let t=0;t<o.transferables.length;t++)i.indexOf(o.transferables[t])<0&&i.push(o.transferables[t]);return{magic:"b3dm",count:o.count,transferables:i,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,gltf:e}}))}ke(t,e,r,n){const i=new DataView(t,e,r),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported b3dm version: "+s+", url:"+n;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in b3dm header is inconsistent with b3dm's byte length, url: "+n;return console.warn(t),{error:t}}let o,a=i.getUint32(12,!0),c=i.getUint32(16,!0),l=i.getUint32(20,!0),f=i.getUint32(24,!0),u=28+e;l>=570425344?(u-=8,o=a,l=c,f=0,a=0,c=0):f>=570425344&&(u-=4,o=l,l=a,f=c,a=0,c=0);const h=[t];let _,d,E;if(a>0?(_=ft$2(t,u,a),u+=a,o=_.BATCH_LENGTH):_={BATCH_LENGTH:o},c>0&&(u+=c),l>0&&(d=ut$2(t,u,l),u+=l,f>0)){const e=ht$2(0,u,f);E=t.slice(e.offset,e.offset+e.byteLength),u+=f,h.push(E)}const T=_.BATCH_LENGTH,m={};if(_&&_.BATCH_ID){m.BATCH_ID=dt$2(_.BATCH_ID,t,(void 0).offset,T);const e=m.BATCH_ID.array&&m.BATCH_ID.array.buffer;e&&h.indexOf(e)<0&&h.push(e)}return{count:o,transferables:h,featureTable:_,batchTable:d,batchTableBin:E,b3dm:m,glb:{buffer:t,byteOffset:u,byteLength:i.byteLength+i.byteOffset-u}}}He(){return null}}class Or$1{constructor(t,e,r,n){this.Pe=t,this.De=e||k$8,this.ie=r,this.Fe={"image/crn":Ne$1.crn&&Ne$1.crn(),"image/ktx2":Ne$1.ktx2&&Ne$1.ktx2(),"image/cttf":Ne$1.ktx2&&Ne$1.ktx2(),draco:Ne$1.draco&&Ne$1.draco()},this.ze=n}load(t,e,r=0,n=0,i){return e?(n||(n=e.byteLength),this.Ge(t,e,r,n,i)):w$9.getArrayBuffer(t,{}).then((e=>{const i=e.data;return n||(n=i.byteLength),this.Ge(t,i,r,n)}))}Ge(t,e,r,n,i){return this.Ve(t,e,r,n,i).then((({gltf:i,transferables:s})=>{const o=this.Xe(e,r,n,t);if(o.error)return Promise.resolve(o);for(let t=0;t<s.length;t++)-1===o.transferables.indexOf(s[t])&&o.transferables.push(s[t]);return delete i.transferables,Promise.resolve({magic:"i3dm",count:o.count,transferables:o.transferables,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,i3dm:o.i3dm,gltf:i})}))}Ve(t,e,r,n,i){const o={transferable:!0,requestImage:this.Pe,decoders:this.Fe,supportedFormats:this.ie,maxTextureSize:i&&i.maxTextureSize},a=new DataView(e,r,n),c=32+a.getUint32(12,!0)+a.getUint32(16,!0)+a.getUint32(20,!0)+a.getUint32(24,!0);if(0===a.getUint32(28,!0)){let n=O$5(new Uint8Array(e,c+r,a.byteLength-c));return-1==n.indexOf("://")&&(n=t.substring(0,t.lastIndexOf("/"))+"/"+n),n.indexOf(".glb")>0?w$9.getArrayBuffer(n,{}).then((t=>this.Ye(n,{buffer:t.data,byteOffset:0},o))):w$9.getJSON(n,{}).then((t=>this.Ye(n,t,o)))}return this.Ye(t,{buffer:e,byteOffset:c+r,byteLength:a.byteLength-c},o)}Ye(t,e,r){const n=t.substring(0,t.lastIndexOf("/")),i=new this.De(n,e,r);return i.load({skipAttributeTransform:!0}).then((r=>{let n=0,s=0;return e.buffer&&(n=e.byteOffset||0,s=e.byteLength||0),r.url=`${t}-${n}-${s}`,{transferables:i.transferables,gltf:r}}))}Xe(t,e,r,n){const i=new DataView(t,e,r),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported pnts version: "+s+", url:"+n;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+n;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:l,batchTableBin:f}=gt$2(i,32+e,o),u={},h=a.INSTANCES_LENGTH;if(a.POSITION){const{byteOffset:e}=a.POSITION;u.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(u.POSITION.array.buffer)}else if(a.POSITION_QUANTIZED){const e=a.QUANTIZED_VOLUME_OFFSET,r=a.QUANTIZED_VOLUME_SCALE,{byteOffset:n}=a.POSITION_QUANTIZED;u.POSITION={byteStride:12,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.Ze(new Uint16Array(t,n+c.offset,3*h),e,r)},o.push(u.POSITION.array.buffer)}if(a.BATCH_ID){u.BATCH_ID=dt$2(a.BATCH_ID,t,c.offset,h);const e=u.BATCH_ID.array&&u.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}if(a.NORMAL_UP){let{byteOffset:e}=a.NORMAL_UP;u.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(u.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT.byteOffset,u.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(u.NORMAL_RIGHT.array.buffer)}else if(a.NORMAL_UP_OCT32P){let{byteOffset:e}=a.NORMAL_UP_OCT32P;u.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.Ke(new Uint16Array(t,e+c.offset,2*h))},o.push(u.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT_OCT32P.byteOffset,u.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.Ke(new Uint16Array(t,e+c.offset,2*h))},o.push(u.NORMAL_RIGHT.array.buffer)}if(a.SCALE){const{byteOffset:e}=a.SCALE;u.SCALE={byteStride:0,byteOffset:0,itemSize:1,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,h).slice()},o.push(u.SCALE.array.buffer)}else if(a.SCALE_NON_UNIFORM){const{byteOffset:e}=a.SCALE_NON_UNIFORM;u.SCALE_NON_UNIFORM={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(u.SCALE_NON_UNIFORM.array.buffer)}return{count:h,batchTable:l,batchTableBin:f,featureTable:a,i3dm:u,transferables:o}}Ke(t){const e=t.length/2,r=new Float32Array(3*e),n=[];for(let i=0;i<e;i++)xr$1(n,t[2*i],t[2*i+1],65535),r[3*i]=n[0],r[3*i+1]=n[1],r[3*i+2]=n[2];return r}Ze(t,e,r){return Rt$1(new Float32Array(t.length),t,e,r)}He(){return null}}function xr$1(t,e,r,n){if(t[0]=wr$1(e,n),t[1]=wr$1(r,n),t[2]=1-(Math.abs(t[0])+Math.abs(t[1])),t[2]<0){const e=t[0];t[0]=(1-Math.abs(t[1]))*Mr$1(e),t[1]=(1-Math.abs(e))*Mr$1(t[1])}return normalize$4(t,t)}function wr$1(t,e){return function(t,e,r){return t<0?0:t>r?r:t}(t,0,e=function(t,e){return null!=t?t:255}(e))/e*2-1}function Mr$1(t){return t<0?-1:1}class Cr$1{constructor(){}load(t,e,r=0,n=0){return e?(n||(n=e.byteLength),this.Ge(t,e,r,n)):w$9.getArrayBuffer(t,{}).then((e=>{const i=e.data;return n||(n=i.byteLength),this.Ge(t,i,r,n)}))}Ge(t,e,r,n){return this.We(e,r,n,t).then((t=>t.error?t:{magic:"pnts",count:t.count,transferables:t.transferables,featureTable:t.featureTable,batchTable:t.batchTable,batchTableBin:t.batchTableBin,pnts:t.pnts}))}We(t,e,r,n){const i=new DataView(t,e,r),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported pnts version: "+s+", url:"+n;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+n;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:l,batchTableBin:f}=gt$2(i,e+28,o),u=a.QUANTIZED_VOLUME_OFFSET,h=a.QUANTIZED_VOLUME_SCALE,_=a.POINTS_LENGTH;let d,E={};if(a.extensions&&a.extensions["3DTILES_draco_point_compression"]){E=a.extensions["3DTILES_draco_point_compression"],d=new DataView(t,E.byteOffset+c.offset,E.byteLength);const e={attributes:E.properties,useUniqueIDs:!1};return this.je||(this.je=Ne$1.draco()),this.je(d,e).then((e=>{const r=e.attributes;!a.POSITION&&!a.POSITION_QUANTIZED||r.POSITION||r.POSITION_QUANTIZED||(r.POSITION=a.POSITION,r.POSITION_QUANTIZED=a.POSITION_QUANTIZED),!(a.RGB||a.RGBA||a.RGB565)||r.RGB||r.RGBA||r.RGB565||(r.RGB=a.RGB,r.RGBA=a.RGBA,r.RGB565=a.RGB565),!a.NORMAL&&!a.NORMAL_OCT16P||r.NORMAL||r.NORMAL_OCT16P||(r.NORMAL=a.NORMAL,r.NORMAL_OCT16P=a.NORMAL_OCT16P);const n=this.qe(t,e.attributes,c.offset,_,o,u,h);if(e.attributes.BATCH_ID){const t=e.attributes.BATCH_ID.array;n.BATCH_ID={byteStride:0,byteOffset:0,itemSize:1,count:t.length,componentType:yt$1(t.constructor),array:t},o.push(t.buffer)}else if(a.BATCH_ID||Object.keys(l).length){n.BATCH_ID=a.BATCH_ID?dt$2(a.BATCH_ID,t,c.offset,_):vr$1(_);const e=n.BATCH_ID.array&&n.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return{count:_,batchTable:l,batchTableBin:f,featureTable:a,pnts:n,transferables:o}}))}const T=this.qe(t,a,c.offset,_,o,u,h);if(a.BATCH_ID||Object.keys(l).length){T.BATCH_ID=a.BATCH_ID?dt$2(a.BATCH_ID,t,c.offset,_):vr$1(_);const e=T.BATCH_ID.array&&T.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return Promise.resolve({count:_,batchTable:l,batchTableBin:f,featureTable:a,pnts:T,transferables:o})}qe(t,e,r,n,i,s,o){const a={};if(e.POSITION){let{byteOffset:s,array:o}=e.POSITION;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+3*n*4);o=new Float32Array(e)}a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:o},i.push(o.buffer)}else if(e.POSITION_QUANTIZED){let{byteOffset:c,array:l}=e.POSITION_QUANTIZED;c=c||0;const f=l?0:r;a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:this.Ze(l||new Uint16Array(t,c+f,3*n),s,o)},i.push(a.POSITION.array.buffer)}if(e.RGBA){let{byteOffset:s,array:o}=e.RGBA;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+4*n);o=new Uint8Array(e)}a.RGBA={byteStride:0,byteOffset:0,itemSize:4,count:n,componentType:5121,array:o},i.push(o.buffer)}else if(e.RGB){let{byteOffset:s,array:o}=e.RGB;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+3*n);o=new Uint8Array(e)}a.RGB={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5121,array:o},i.push(o.buffer)}else if(e.RGB565){let{byteOffset:s,array:o}=e.RGB565;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+2*n);o=new Uint16Array(e)}a.RGB565={byteStride:0,byteOffset:0,itemSize:1,count:n,componentType:5123,array:o},i.push(o.buffer)}if(e.NORMAL){let{byteOffset:s,array:o}=e.NORMAL;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+3*n*4);o=new Float32Array(e)}a.NORMAL={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:o},i.push(o.buffer)}else if(e.NORMAL_OCT16P){let{byteOffset:s,array:o}=e.NORMAL_OCT16P;s=s||0;const c=o?0:r;if(!o){const e=t.slice(s+c,s+c+2*n);o=new Uint8Array(e)}a.NORMAL_OCT16P={byteStride:0,byteOffset:0,itemSize:2,count:n,componentType:5121,array:o},i.push(o.buffer)}return a}Ze(t,e,r){return Rt$1(new Float32Array(t.length),t,e,r)}He(){return null}}function vr$1(t){const e=M$4(t),r=new e(t);for(let e=0;e<t;e++)r[e]=e;return{byteStride:0,byteOffset:0,itemSize:1,count:t,componentType:yt$1(e),array:r}}class Ur$1{constructor(t,e){this.Pe=t,this.De=e||k$8}load(t,e,r=0,n=0,i){return e?this.Ge(t,e,r,n,i):w$9.getArrayBuffer(t,{}).then((e=>this.Ge(t,e.data,r,n)))}Ge(t,e,r,n,i){n||(n=e.byteLength);const s=this.$e(e,t,r,n),o=[];for(let r=0;r<s.length;r++){let n;if("b3dm"===s[r].magic)n=new Sr$1(this.Pe,this.De);else if("i3dm"===s[r].magic)n=new Or$1(this.Pe,this.De);else if("pnts"===s[r].magic)n=new Cr$1;else{if("cmpt"!==s[r].magic){console.warn("Unsupported magic in CMPT tile:",s[r].magic);continue}n=new Ur$1(this.Pe,this.De)}o.push(n.load(t,e,s[r].offset,s[r].byteLength,i).then((t=>t)))}return Promise.all(o).then((t=>({magic:"cmpt",tiles:t})))}$e(t,e,r,n){const i=new DataView(t,r,n),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported cmpt version: "+s+", url:"+e;return console.warn(t),{error:t}}if(16===i.byteLength)return[];const o=[],a=i.getUint32(12,!0);let c=16;for(let e=0;e<a;e++){const e=ct$2(i,c),n=i.getUint32(c+8,!0);o.push({magic:e,buffer:t,offset:c+r,byteLength:n}),c+=n}return o}}if(transcoders){const r=t__namespace.Map.VERSION;if(r.indexOf("1.0.0-beta")>=0||r.indexOf("1.0.0-alpha")>=0){const r=transcoders.inject(m$4);t__namespace.registerWorkerAdapter("@maptalks/3dtiles",r)}else t__namespace.registerWorkerAdapter("@maptalks/3dtiles",(function(){return transcoders.inject(m$4)}))}else t__namespace.registerWorkerAdapter("@maptalks/3dtiles",m$4);"undefined"!=typeof console&&console.log("@maptalks/3dtiles v0.18.2");for(
/*!
	* Contains code from THREE.js
	* MIT License
	* https://github.com/mrdoob/three.js
	*/
var planes=[],i$1=0;i$1<6;i$1++)planes[i$1]=[];var p$4=[];function intersectsBox(matrix,box,mask){!function(m){var me0=m[0],me1=m[1],me2=m[2],me3=m[3],me4=m[4],me5=m[5],me6=m[6],me7=m[7],me8=m[8],me9=m[9],me10=m[10],me11=m[11],me12=m[12],me13=m[13],me14=m[14],me15=m[15];setComponents(planes[0],me3-me0,me7-me4,me11-me8,me15-me12),setComponents(planes[1],me3+me0,me7+me4,me11+me8,me15+me12),setComponents(planes[2],me3+me1,me7+me5,me11+me9,me15+me13),setComponents(planes[3],me3-me1,me7-me5,me11-me9,me15-me13),setComponents(planes[4],me3-me2,me7-me6,me11-me10,me15-me14),setComponents(planes[5],me3+me2,me7+me6,me11+me10,me15+me14)}(matrix);for(var i=0;i<6;i++)if(!mask||"0"!==mask.charAt(i)){var plane=planes[i];if(p$4[0]=plane[0]>0?box[1][0]:box[0][0],p$4[1]=plane[1]>0?box[1][1]:box[0][1],p$4[2]=plane[2]>0?box[1][2]:box[0][2],distanceToPoint(plane,p$4)<0)return!1}return!0}function setComponents(out,x,y,z,w){return out[0]=.16666666666666666*x,out[1]=.16666666666666666*y,out[2]=.16666666666666666*z,out[3]=.16666666666666666*w,out}function distanceToPoint(plane,p){return plane[0]*p[0]+plane[1]*p[1]+plane[2]*p[2]+plane[3]}
/*!
	 * @maptalks/gltf-layer v0.34.1
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.org
	 */const b$4='function(t){var e="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e,n){var r=e[0],s=e[1],i=e[2],o=e[3],c=e[4],a=e[5],u=e[6],f=e[7],h=e[8],l=e[9],d=e[10],m=e[11],g=e[12],_=e[13],b=e[14],p=e[15],y=n[0],w=n[1],A=n[2],T=n[3];return t[0]=y*r+w*c+A*h+T*g,t[1]=y*s+w*a+A*l+T*_,t[2]=y*i+w*u+A*d+T*b,t[3]=y*o+w*f+A*m+T*p,y=n[4],w=n[5],A=n[6],T=n[7],t[4]=y*r+w*c+A*h+T*g,t[5]=y*s+w*a+A*l+T*_,t[6]=y*i+w*u+A*d+T*b,t[7]=y*o+w*f+A*m+T*p,y=n[8],w=n[9],A=n[10],T=n[11],t[8]=y*r+w*c+A*h+T*g,t[9]=y*s+w*a+A*l+T*_,t[10]=y*i+w*u+A*d+T*b,t[11]=y*o+w*f+A*m+T*p,y=n[12],w=n[13],A=n[14],T=n[15],t[12]=y*r+w*c+A*h+T*g,t[13]=y*s+w*a+A*l+T*_,t[14]=y*i+w*u+A*d+T*b,t[15]=y*o+w*f+A*m+T*p,t}function r(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function s(t,n,r){var s=new e(3);return s[0]=t,s[1]=n,s[2]=r,s}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function c(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function a(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function u(t,e,n,r,s){return t[0]=e,t[1]=n,t[2]=r,t[3]=s,t}function f(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function h(t,e,n,r){var s=e[0],i=e[1],o=e[2],c=e[3],a=n[0],u=n[1],f=n[2],h=n[3],l=void 0,d=void 0,m=void 0,g=void 0,_=void 0;return(d=s*a+i*u+o*f+c*h)<0&&(d=-d,a=-a,u=-u,f=-f,h=-h),1-d>1e-6?(l=Math.acos(d),m=Math.sin(l),g=Math.sin((1-r)*l)/m,_=Math.sin(r*l)/m):(g=1-r,_=r),t[0]=g*s+_*a,t[1]=g*i+_*u,t[2]=g*o+_*f,t[3]=g*c+_*h,t}r(),function(){var t,n=(t=new e(4),e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var l,d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};r(),s(1,0,0),s(0,1,0),f(),f(),l=new e(9),e!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1;\n/*!\n   * @maptalks/gltf-loader v0.27.1\n   * LICENSE : UNLICENSED\n   * (c) 2016-2022 maptalks.org\n   */\nlet m=0;function g(t){return null==t}function _(t){return!g(t)}function b(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function p(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView\'s component type: "+t)}function y(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function w(t){const e=function(t){return"undefined"!=typeof self?self.atob(t):window.atob(t)}(t.substring(t.indexOf(",")+1)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.charCodeAt(t);return r.buffer}const A=[],T=[],I=[],x=[0,0,0],M=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),v=[1,1,1];function E(t,e,n,r,s,i,o){const c=p(o);if((0===s||s===r*c.BYTES_PER_ELEMENT)&&i%c.BYTES_PER_ELEMENT==0){const s=new c(e,i,n*r);return t.set(s),t}0===s&&(s=r*c.BYTES_PER_ELEMENT);const a=new Uint8Array(r*c.BYTES_PER_ELEMENT);for(let o=0;o<n;o++){let n=null;const u=new Uint8Array(e,s*o+i,r*c.BYTES_PER_ELEMENT);a.set(u),n=new c(a.buffer,0,r);for(let e=0;e<r;e++)t[o*r+e]=n[e]}return t}const O="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function P(t,e,n){const r=new Uint8Array(t,e,n);return O.decode(r)}const k={get:function(t,e={}){e||(e={});const n=new AbortController,r=n.signal,s=b({},e);s.signal=r,s.method||(s.method="GET");const i=fetch(t,s).then((t=>{const n=this.t(t,e.responseType);return n.message?n:n.then((n=>"arraybuffer"===e.responseType?{data:n,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:n)).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}))})).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}));return i.xhr=n,i},t:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={})=>(e||(e={}),e.responseType="arraybuffer",k.get(t,e)),getJSON:function(t,e={}){return e&&e.jsonp?k.jsonp(t):((e=e||{}).responseType="json",k.get(t,e))},jsonp:function(t){const e="_maptalks_jsonp_"+m++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let n=document.createElement("script");return n.type="text/javascript",n.src=t,new Promise((t=>{window[e]=function(r){document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[e],t(r)},document.getElementsByTagName("head")[0].appendChild(n)}))}};class N{constructor(t,e,n){this.i=t,this.decoders=e,this.o=n,this.images={},this.u={}}requestImageFromBufferURI(t,e,n){if(this.buffers[t.id]){const r=this.buffers[t.id],s=this.h(e,r);return this.getImageByBuffer(s,n)}if(this.u[t.id])return this.u[t.id].then((()=>{const r=this.buffers[t.id],s=this.h(e,r);return this.getImageByBuffer(s,n)}));if(y(t.uri)){const r=this.buffers[t.id]=w(t.uri),s=this.h(e,r);return this.getImageByBuffer(s,n)}return this.u[t.id]=k.getArrayBuffer(t.uri,null).then((r=>{const s=this.buffers[t.id]=r.data,i=this.h(e,s);return this.getImageByBuffer(i,n)}))}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=this.decoders;if(n[e.mimeType])return n[e.mimeType](t,{supportedFormats:this.o});if("image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType)return console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null);{const n=new Blob([t],{type:e.mimeType}),r=URL.createObjectURL(n);return this.l(e.id,r)}}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this.u[t.id]?this.u[t.id].then((()=>this.images[t.id])):this.u[t.id]=this.l(t.id,e)}l(t,e){return new Promise(((n,r)=>{this.i(e,((s,i)=>{s?r(s):(URL.revokeObjectURL(e),this.images[t]=i,n(this.images[t]))}))}))}}const S=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16];class B{constructor(t,e,n){this.rootPath=t,this.gltf=e,this.m=!1,this.glbBuffer=n,this.buffers={},this.requests={},this.accessors={},this.g()}_(t,e){const n=this.gltf,r=n.accessors[e];if(void 0===r.bufferView)return this.accessors[r.id]=this.p(t,e,null,0),Promise.resolve(this.accessors[r.id]);if(r&&this.accessors[r.id])return Promise.resolve(this.accessors[r.id]);const s=n.bufferViews[r.bufferView];return this.A(s).then((n=>{const{buffer:s,byteOffset:i}=n;return this.accessors[r.id]=this.p(t,e,s,i)}))}A(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id]){const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}if(this.requests[e.id])return this.requests[e.id].then((()=>{const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}));if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(y(e.uri)){const t=this.buffers[e.id]=w(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const n=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||n?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=k.getArrayBuffer(t,null).then((r=>(n&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=r.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}p(t,e,n,r=0){const s=this.gltf,i=s.accessors[e],o=void 0!==i.bufferView?s.bufferViews[i.bufferView]:{},c=(o.byteOffset||0)+r,a=this.T(i.type),u=p(i.componentType),f=o.byteStride||0,h={array:void 0,name:t,accessorName:e,byteLength:i.count*a*u.BYTES_PER_ELEMENT,componentType:i.componentType,count:i.count,type:i.type,itemSize:a};if(i.min&&(h.min=i.min),i.max&&(h.max=i.max),n)if(this.m)h.byteStride=f,h.byteOffset=c+(i.byteOffset||0),!f||f===a*u.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(h.array=this.I(n,i.count,a,c+(i.byteOffset||0),u),h.array.buffer.byteLength===h.byteLength&&(h.byteOffset=0)):h.array=new Uint8Array(n,c,o.byteLength);else if(i.interleaved){h.byteStride=0,h.byteOffset=0;const t=new u(i.count*a);h.array=E(t,n,i.count,a,f,c+(i.byteOffset||0),i.componentType)}else h.byteStride=0,h.array=this.I(n,i.count,a,c+(i.byteOffset||0),u),h.byteOffset=h.array.byteOffset;else{h.array=new u(i.count);const t=h.min||h.max;t&&(h.array[0]=t[0],h.array[1]=t[1],h.array[2]=t[2])}return h}g(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0);else for(const e in t)for(const n in t)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0)}I(t,e,n,r,s){return r%s.BYTES_PER_ELEMENT!=0&&(t=t.slice(r,r+e*n*s.BYTES_PER_ELEMENT),r=0),new s(t,r,n*e)}T(t){const e=S.indexOf(t);return S[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,n=e.map((t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:n}=e;return this.A(e).then((r=>{const{buffer:s,byteOffset:i}=r,o=P(s,i+(e.byteOffset||0),n);return t.content=o,t}))}if(t.uri){if(y(t.uri)){const e=w(t.uri),n=P(e,0,e.byteLength);return t.content=n,Promise.resolve(t)}{const e=this.rootPath+"/"+t.uri;return k.get(e).then((e=>(t.content=e,t)))}}return Promise.resolve(t)}));return Promise.all(n).then((()=>t))}}class C extends N{constructor(t,e,n,r,s,i){super(r,s,i),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=n,this.accessor=new B(t,e,n)}iterate(t,e){const n=this.gltf[e];if(!n)return;let r=0;for(const e in n)t(e,n[e],r++)}createNode(t){const e={};if(_(t.name)&&(e.name=t.name),_(t.children)&&(e.children=t.children),_(t.jointName)&&(e.jointName=t.jointName),_(t.matrix)&&(e.matrix=t.matrix),_(t.rotation)&&(e.rotation=t.rotation),_(t.scale)&&(e.scale=t.scale),_(t.translation)&&(e.translation=t.translation),_(t.extras)&&(e.extras=t.extras),_(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const r=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(A,e.translation||x),s=function(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],o=n+n,c=r+r,a=s+s,u=n*o,f=r*o,h=r*c,l=s*o,d=s*c,m=s*a,g=i*o,_=i*c,b=i*a;return t[0]=1-h-m,t[1]=f+b,t[2]=l-_,t[3]=0,t[4]=f-b,t[5]=1-u-m,t[6]=d+g,t[7]=0,t[8]=l+_,t[9]=d-g,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(T,e.rotation||M),i=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(I,e.scale||v);return n(i,s,i),n(t,r,i)}return function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}M(t){const e={};for(const n in t){const r=t[n];let s,i;r.instanceTechnique&&r.instanceTechnique.values?(s=r.instanceTechnique,i=s.values.diffuse):(s=r,i=s.values.tex||s.values.diffuseTex||s.values.diffuse);const o={baseColorTexture:{index:i}};r.name&&(o.name=r.name),r.extensions&&(o.extensions=r.extensions),r.extras&&(o.extras=r.extras),e[n]=o}return e}v(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const n=this.gltf.bufferViews[e.bufferView],r=(n.byteOffset||0)+this.glbBuffer.byteOffset,s=n.byteLength,i=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,r,s);return this.getImageByBuffer(i,t)}return this.requestExternalImage(t)}O(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this.v(n).then((t=>{const r=this.gltf.samplers[e.sampler];return{image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extras:n.extras},sampler:r}}))}getBaseColorTexture(t){const e=this.gltf.materials[t];let n,r;if(e.instanceTechnique&&e.instanceTechnique.values?(n=e.instanceTechnique,r=n.values.diffuse):(n=e,r=n.values.tex||n.values.diffuseTex||n.values.diffuse),void 0===r||void 0===this.gltf.textures)return null;const s=this.gltf.textures[r];if(!s)return null;const i=this.gltf.samplers[s.sampler];return{format:s.format||6408,internalFormat:s.internalFormat||6408,type:s.type||5121,sampler:i,source:this.gltf.images[s.source]}}getMaterial(){return null}getAnimations(){return null}}class U extends N{constructor(t,e,n,r,s,i){super(r,s,i),this.rootPath=t,this.gltf=e,this.glbBuffer=n,this.buffers={},this.requests={},this.accessor=new B(t,e,n)}iterate(t,e){const n=this.gltf[e];if(n)for(let e=0;e<n.length;e++)t(e,n[e],e)}createNode(t){const e={};return b(e,t),!_(t.weights)&&this.gltf.meshes&&_(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}O(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this.v(n).then((t=>{if(!t)return null;const r={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extensions:n.extensions,extras:n.extras}};b(r,e);const s=_(e.sampler)?this.gltf.samplers[e.sampler]:void 0;return s&&(r.sampler=s),t.format&&(r.format=t.format),r}))}v(t){if(!_(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],n=this.gltf.buffers[e.buffer];if(n.uri)return this.requestImageFromBufferURI(n,e,t);if(this.glbBuffer)return this.P(e,t)}return null}P(t,e){const n=this.h(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(n,e)}h(t,e,n){n=n||0;const r=t.byteOffset+n,s=t.byteLength;return new Uint8Array(e,r,s)}k(t,e){const n=new Array(t.byteLength);for(let e=0;e<t.byteLength;e++)n[e]=String.fromCharCode(t[e]);return n.join(""),"data:"+(e=e||"image/png")+";base64,"+function(t){return"undefined"!=typeof self?self.btoa(t):window.btoa(t)}(unescape(encodeURIComponent(n)))}getAnimations(t){const e=[];return t.forEach((t=>{e.push(this.getSamplers(t.samplers))})),Promise.all(e).then((e=>{for(let n=0;n<e.length;n++)t[n].samplers=e[n];return t}))}getSamplers(t){const e=[];for(let n=0;n<t.length;n++)(_(t[n].input)||_(t[n].output))&&(e.push(this.accessor._("input",t[n].input)),e.push(this.accessor._("output",t[n].output)));return Promise.all(e).then((e=>{for(let n=0;n<e.length/2;n++)t[n].input=e[2*n],t[n].output=e[2*n+1],t[n].interpolation||(t[n].interpolation="LINEAR");return t}))}}const R="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class L{static read(t,e=0,n=0){n||(n=t.byteLength);const r=new DataView(t,e,n),s=r.getUint32(4,!0);if(1===s)return L.readV1(r,e);if(2===s)return L.readV2(t,e);throw new Error("Unsupported glb version : "+s)}static readV1(t,e){const n=t.getUint32(8,!0),r=t.getUint32(12,!0);if(n!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb\'s byte length.");const s=D(t.buffer,20+e,r);return{json:JSON.parse(s),glbBuffer:{byteOffset:20+e+r,buffer:t.buffer,byteLength:n}}}static readV2(t,e){let n,r,s;const i=new DataView(t,e+12);let o=0;for(;o<i.byteLength;){const c=i.getUint32(o,!0);o+=4;const a=i.getUint32(o,!0);if(o+=4,1313821514===a)n=D(t,e+12+o,c);else if(5130562===a){s=e+12+o,r=c;break}o+=c}return{json:JSON.parse(n),glbBuffer:{byteOffset:s,buffer:t,byteLength:r}}}}function D(t,e,n){if(R){const r=new Uint8Array(t,e,n);return R.decode(r)}return function(t){const e=t.length;let n="";for(let r=0;r<e;){let s=t[r++];if(128&s){let n=j[s>>3&7];if(!(64&s)||!n||r+n>e)return null;for(s&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;s=s<<6|63&e}}n+=String.fromCharCode(s)}return n}(new Uint8Array(t,e,n))}const j=[1,1,1,1,2,2,3,0],q=[0,0,0],F=[0,0,0,1],V=[1,1,1],H={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},K={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},$={N(t,e,n,r,s,o,c,a){const u=_(t)?e.animations:[e.animations[0]],f={};for(let e=0;e<u.length;e++){const h=u[e],l=h.name||e;if(_(t)&&l!==t)continue;const m=h.channelsMap[n];if(m)for(let t=0;t<m.length;t++){const e=m[t];"translation"===e.target.path?(this.S(s,h.samplers[e.sampler],r,1),f.translation=i(q,s)):"rotation"===e.target.path?(this.B(o,h.samplers[e.sampler],r,1),f.rotation=d(F,o)):"scale"===e.target.path?(this.S(c,h.samplers[e.sampler],r,1),f.scale=i(V,c)):"weights"===e.target.path&&a&&(this.S(a,h.samplers[e.sampler],r,a.length),f.weights=a)}}return f},S(t,e,n,r){switch(e.interpolation){case"LINEAR":{const s=this.C(K,e,n,1*r);s&&(t=function(t,e,n,r){for(let s=0;s<t.length;s++)t[s]=e[s]+r*(n[s]-e[s]);return t}(t,s.PREVIOUS,s.NEXT,s.INTERPOLATION));break}case"STEP":{const s=this.C(K,e,n,1*r);s&&(t=function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t}(t,...s.PREVIOUS));break}case"CUBICSPLINE":{const s=this.C(K,e,n,3*r);s&&(t=this.U(t,s,e.input.array,3*r));break}}return t},B(t,e,n){switch(e.interpolation){case"LINEAR":{const r=this.C(K,e,n,1);r&&h(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION);break}case"STEP":{const r=this.C(K,e,n,1);r&&(t=u(t,...r.PREVIOUS));break}case"CUBICSPLINE":{const r=this.C(K,e,n,3);if(r){for(let t=0;t<r.PREVIOUS.length;t++)r.PREVIOUS[t]=Math.acos(r.PREVIOUS[t]),r.NEXT[t]=Math.acos(r.NEXT[t]);t=this.U(t,r,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},R(t,e){const n=t.length;let r,s,i,o=0,c=n-1,a=Math.floor((o+c)/2);for(;o<=n-1&&c>=0;){if(o===c)return null;if(t[a]<=e&&e<=t[a+1]){const n=t[a];return r=a,s=a+1,i=(e-n)/(t[a+1]-n),{preIndx:r,nextIndex:s,interpolation:i}}e<t[a]?(c=a,a=Math.floor((o+c)/2)):t[a+1]<e&&(o=a,a=Math.floor((o+c)/2))}return null},C(t,e,n,r){const s=e.input.array,i=e.output.array,o=e.output.itemSize;(n<s[0]||n>s[s.length-1])&&(n=Math.max(s[0],Math.min(s[s.length-1],n))),n===s[s.length-1]&&(n=s[0]);const c=this.R(s,n);if(!c||!c.nextIndex)return null;const{preIndx:a,nextIndex:u,interpolation:f}=c;t.PREINDEX=a,t.NEXTINDEX=u,t.INTERPOLATION=f;const h=o*r;return t.PREVIOUS=i.subarray(t.PREINDEX*h,(t.PREINDEX+1)*h),t.NEXT=i.subarray(t.NEXTINDEX*h,(t.NEXTINDEX+1)*h),t},U(t,e,n,r){const s=e.INTERPOLATION,i=n[e.PREINDEX],o=n[e.NEXTINDEX];for(let n=0;n<3;n++){const c=e.PREVIOUS[r+n],a=(o-i)*e.PREVIOUS[2*r+n],u=e.NEXT[3+n],f=(o-i)*e.NEXT[n],h=(2*Math.pow(s,3)-3*Math.pow(s,2)+1)*c+(Math.pow(s,3)-2*Math.pow(s,2)+s)*a+(2*-Math.pow(s,3)+3*Math.pow(s,2))*u+(Math.pow(s,3)-Math.pow(s,2))*f;t[n]=h}return t},getAnimationClip(t,e,n,r){const s=t.nodes[e]&&t.nodes[e].weights;return o(q,...H.TRANSLATION),u(F,...H.ROTATION),o(V,...H.SCALE),this.N(r,t,e,n,q,F,V,s)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach(((e,n)=>{let r=-1/0,s=1/0;const i=e.channels;for(let t=0;t<i.length;t++){const n=i[t],o=e.samplers[n.sampler].input.array;o[o.length-1]>r&&(r=o[o.length-1]),o[0]<s&&(s=o[0])}const o=e.name||n;t.timeSpan[o]={max:r,min:s}})),t.timeSpan},getTimeSpanByName(t,e){const n=this.getTimeSpan(t);return n?_(e)?n[e]:n[Object.keys(n)[0]]:null}};let G=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(rt){}t&&"undefined"!=typeof createImageBitmap&&(G=!0)}const X="undefined"==typeof document?null:document.createElement("canvas");class z{constructor(t,e,n){if(this.options=n||{},this.options.decoders||(this.options.decoders={}),e.buffer instanceof ArrayBuffer){const{json:n,glbBuffer:r}=L.read(e.buffer,e.byteOffset,e.byteLength);this.L(t,n,r)}else this.L(t,e);this.D=new B(this.rootPath,this.gltf,this.glbBuffer),this.j()}j(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders.ktx2)throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded")}}q(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this.D.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then((e=>(t.KHR_techniques_webgl=e,t))):Promise.resolve(t)}load(t){t=t||{};const e=this.F(t),n=this.V(),r=this.H(),s=this.q();return Promise.all([e,n,r,s]).then((t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0])))}createChannelsMap(t){const e=t.animations;if(e)for(let t=0;t<e.length;t++){const n=e[t];n.channelsMap={};for(let t=0;t<n.channels.length;t++){const e=n.channels[t];n.channelsMap[e.target.node]||(n.channelsMap[e.target.node]=[]),n.channelsMap[e.target.node].push(e)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:n}=this.gltf;for(let n=0;n<e.length;n++)e[n].uri&&e[n].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[n].uri});for(let e=0;e<n.length;e++)n[e].uri&&n[e].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:n[e].uri})}return t}static getAnimationClip(t,e,n,r){return $.getAnimationClip(t,e,n,r)}static getAnimationTimeSpan(t,e){return $.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return p(t)}static readInterleavedArray(t,e,n,r,s,i,o){return E(t,e,n,r,s,i,o)}L(t,e,n){this.gltf=e,this.glbBuffer=n,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=G?Y.bind(this):this.options.requestImage||J,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new U(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate(((t,e,n)=>{e.id="buffer_"+n}),"buffers"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors")):(this.adapter=new C(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"))}K(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(n=t.children[0])&&isFinite(n)||function(t){return!g(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}(t.children[0])))return t;const r=t.children.map((t=>{const n=e[t];return n.nodeIndex=t,this.K(n,e)}));t.children=r}var n;return t}F(t){return this.$(t).then((t=>{const e=this.scenes=[];let n;for(const e in t)t[e]=this.K(t[e],t),t[e].nodeIndex=Number(e)?Number(e):e;this.adapter.iterate(((r,s,i)=>{const o={};s.name&&(o.name=s.name),s.nodes&&(o.nodes=s.nodes.map((e=>t[e]))),this.gltf.scene===r&&(n=i),e.push(o)}),"scenes");const r={asset:this.gltf.asset,scene:n,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const t=this.adapter.M(this.gltf.materials);r.materials=t}return r}))}$(t){return this.G(t).then((()=>{const t=this.nodes={};return this.adapter.iterate(((e,n)=>{const r=this.adapter.createNode(n,this.meshes,this.skins);t[e]=r}),"nodes"),t}))}X(){this.skins=[];const t=[];return this.adapter.iterate(((e,n,r)=>{t.push(this.J(n).then((t=>{t.index=r,this.skins.push(t)})))}),"skins"),t}J(t){const e=t.inverseBindMatrices;return this.adapter.accessor._("inverseBindMatrices",e).then((e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t)))}V(){const t=this.gltf.animations;return _(t)?this.adapter.getAnimations(t):null}G(t){this.meshes={};let e=[];return this.adapter.iterate(((n,r,s)=>{e.push(this.W(r,t).then((t=>{t.index=s,this.meshes[n]=t})))}),"meshes"),e=e.concat(this.X()),Promise.all(e)}W(t,e){const n=t.primitives.map((t=>this.Y(t,e))).filter((t=>!!t));return Promise.all(n).then((e=>{const n={};return b(n,t),n.primitives=e,n}))}H(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const n in t)e.push(this.adapter.O(n));return Promise.all(e).then((e=>{if(this.transferables)for(let t=0;t<e.length;t++){const n=e[t].image.array;if(e[t]&&n){let t;t=n instanceof ImageBitmap?n:n.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const n={},r=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(n[r[t]]=e[t]);return n}return e}))}Y(t,e){let n;const r=[],s=t.extensions;if(_(t.targets))for(let e=0;e<t.targets.length;e++){const n=t.targets[e];for(const t in n){const s=this.adapter.accessor._(`morphTargets_${t}_${e}`,n[t]);s&&r.push(s)}}if(s&&s.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:i,attributes:o}=s.KHR_draco_mesh_compression,c=this.gltf.bufferViews[i],a=this.D.A(c).then((n=>{const{buffer:r,byteOffset:s}=n;let{byteOffset:i,byteLength:a}=c;i||(i=0);const u=new DataView(r,s+i,a),f={attributes:o,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform};return t(u,f).then((t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e}))}));r.push(a),n=Promise.all(r)}else{const e=t.attributes;for(const t in e){const n=this.adapter.accessor._(t,e[t]);n&&r.push(n)}if(_(t.indices)){const e=this.adapter.accessor._("indices",t.indices);e&&r.push(e)}n=Promise.all(r)}return n.then((e=>{if(s&&s.KHR_draco_mesh_compression){const n=t.targets?t.targets.length:0;e[n]=e[n].concat(e.slice(0,n)),e=e[n]}let n,r;const i={attributes:e.reduce(((t,e)=>{if("indices"===e.name)n=e;else if(e.name.indexOf("morphTargets_")>-1)r=r||{},r[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0],{itemSize:r,array:s}=e,i=s.length/r;for(let e=0;e<i;e++)for(let i=0;i<r;i++){const o=e*r+i;s[o]<t[i]&&(t[i]=s[o]),s[o]>n[i]&&(n[i]=s[o])}if(e.quantization){const r=e.quantization,s=r.range/(1<<r.quantizationBits),i=r.minValues;a(t,t,s),c(t,t,i),a(n,n,s),c(n,n,i)}e.min=t,e.max=n}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t}),{}),material:t.material};return n&&(i.indices=n),r&&(i.morphTargets=r),i.mode=_(t.mode)?t.mode:4,_(t.extras)&&(i.extras=t.extras),i}))}}function J(t,e){const n=new Image;n.crossOrigin="",n.onload=()=>{if(!X)return void e(new Error("There is no canvas to draw image!"));X.width=n.width,X.height=n.height;const t=X.getContext("2d");t.drawImage(n,0,0,n.width,n.height);const r=t.getImageData(0,0,n.width,n.height),s={width:n.width,height:n.height,data:new Uint8Array(r.data)};e(null,s)},n.onerror=function(t){e(t)},n.src=t}let W,Q;function Y(t,e){W||(W=new OffscreenCanvas(2,2),Q=W.getContext("2d")),fetch(t).then((t=>t.arrayBuffer())).then((t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)})).then((t=>{let{width:n,height:r}=t;Z(n)||(n=tt(n)),Z(r)||(r=tt(r));const s=this.options.maxTextureSize;s&&(n=Math.min(s,n),r=Math.min(s,r)),W.width=n,W.height=r,Q.drawImage(t,0,0,n,r),t.close();const i=Q.getImageData(0,0,n,r);e(null,{width:n,height:r,data:new Uint8Array(i.data)})})).catch((t=>{console.warn(t),e(t)}))}function Z(t){return 0==(t&t-1)&&0!==t}function tt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}\n/*!\n   * @maptalks/gl v0.73.3\n   * LICENSE : UNLICENSED\n   * (c) 2016-2022 maptalks.com\n   */const et=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof undefined)return global;throw new Error("unable to locate global object")},nt=et(),rt=nt.gl_trans__coders=nt.gl_trans__coders||{};rt.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,r=e.substring(0,n),s=nt.gl_trans__coders=nt.gl_trans__coders||{};let i=`${r}\\n    const _____getGlobal = ${et.toString()};\\n    const g___lobals = _____getGlobal()\\n    const tran_____scoders = g___lobals[\'gl_trans__coders\'] = g___lobals[\'gl_trans__coders\'] || {};`;for(const t in s)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(i+=\'tran_____scoders["\'+t+\'"] =\'+s[t].toString()+"\\n;");return i+="\\n"+e.substring(r.length),i},rt.registerTranscoder=function(t,e){rt[t]=e},rt.getTranscoder=function(t){return rt[t]};const st={"image/crn":rt.crn&&rt.crn(),"image/ktx2":rt.ktx2&&rt.ktx2(),"image/cttf":rt.ktx2&&rt.ktx2(),"draco":rt.draco&&rt.draco()};let it;const ot={};function ct(t,e,n){return new z(t,e,n).load({skipAttributeTransform:!0})}function at(t,e){const n=e.lastIndexOf("/"),r=e.slice(0,n),s=e.slice(e.lastIndexOf(".")).toLowerCase(),i=ut.bind(this,t);return".gltf"===s?function(t,e){return k.getJSON(t,e)}(e,{}).then((t=>t.message?t:ct(r,t,{requestImage:i,decoders:st,transferable:!0}))):".glb"===s?function(t,e){return k.getArrayBuffer(t,e)}(e,{}).then((t=>t.message?t:ct(r,{buffer:t.data,byteOffset:0},{requestImage:i,decoders:st,transferable:!0}))):null}function ut(t,e,n){ot[e]?ot[e].push(n):(ot[e]=[n],self.postMessage({type:"<request>",command:"sendImageData",actorId:t,workerId:it,params:e}))}t.onmessage=function(t){const e=t.data,n=e.url;if("addLayer"===e.command||"removeLayer"===e.command)it=t.workerId,self.postMessage({type:"<response>",actorId:e.actorId,workerId:it,params:"ok"});else if(n)!function(t){const e=t.data,n=t.callback;at(t.actorId,e.url).then((t=>{t.message?self.postMessage({callback:n,error:t}):self.postMessage({callback:n,data:t},t.transferables)})).catch((t=>{self.postMessage({callback:n,error:t})})),ot.receive=n}(t);else if(e.imageUrl){const t=ot[e.imageUrl];if(delete ot[e.imageUrl],t)for(let n=0;n<t.length;n++)t[n](null,e.result)}},Object.defineProperty(t,"Z",{value:!0})}';function _$4(t){return null==t}function x$4(t){return!_$4(t)}function w$4(t,e){const s=new Set(e);return Array.from(new Set(t.filter((t=>s.has(t)))))}function v$3(t,s,n=0){if(!(t&&s instanceof t$2.Coordinate))return null;const i=t.coordinateToPointAtRes(s,t.getGLRes());return[i.x,i.y,n]}const T$4={},S$4="undefined"==typeof document?null:document.createElement("canvas");class O$4 extends t__namespace.worker.Actor{constructor(t,e){super(t),this.mapId=e}loadGLTF(t){const e=function(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}(t),s={url:e};return new Promise(((t,e)=>{this.send(s,null,((s,n)=>{s?e(s):t(n)}))}))}sendImageData(t,e){!function(t,e){const s=new Image;s.onload=()=>{if(!S$4)return void e(new Error("There is no canvas to draw image!"));S$4.width=s.width,S$4.height=s.height;const t=S$4.getContext("2d");t.drawImage(s,0,0,s.width,s.height);const n=t.getImageData(0,0,s.width,s.height),i={width:s.width,height:s.height,data:new Uint8Array(n.data)};e(null,i)},s.onerror=function(t){e(t)},s.src=t}(t,((s,n)=>{s||this.isActive()&&e(null,{result:n,imageUrl:t})}))}addLayer(t,e,s){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{options:e}},null,s)}removeLayer(t,e,s){this.broadcast({mapId:this.mapId,layerId:t,command:"removeLayer"},null,s)}}let M$3=0;const A$2=[],E$4=[],I$3={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]},P$4=[186/255,186/255,186/255,1],k$3=[.2107,-.0202],N$4=[],C$3=[],L$3=[],R$4=[],B$4=[1,1,1],F$3=[],U$2=function(t,e){const s=[];return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=0,s[4]=t[3],s[5]=t[4],s[6]=t[5],s[7]=0,s[8]=t[6],s[9]=t[7],s[10]=t[8],s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s}(function(t){const e=Math.cos(t),s=Math.sin(t),n=[];return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=e,n[5]=s,n[6]=0,n[7]=-s,n[8]=e,n}(.5*Math.PI),[0,0,0]),V$3={points:0,lines:1,"line strip":2,"line loop":3},D$3=[];class q$2 extends t__namespace.renderer.OverlayLayerCanvasRenderer{constructor(t){super(t),this.gltfScenes={},this.t={}}onAdd(){super.onAdd(),this.prepareWorker()}draw(t,e){M$3=t,this.prepareCanvas(),this.i(e,t)}drawOnInteracting(t,e,s){M$3=e,this.i(s,e)}needToRedraw(){const t=this.layer.o();for(const e in t)if(t[e].isDirty()&&this.h&&this.h.length)return!0;return super.needToRedraw()}onRemove(){this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(t=>{if(t)throw t})),this.workerConn.remove(),delete this.workerConn),super.onRemove()}hitDetect(){return!1}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;if(t)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0};this.glOptions=t,this.gl=this.gl||this.u(this.canvas,t),this.regl=u$5({gl:this.gl,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","WEBGL_compressed_texture_s3tc"]})}t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.l=this.regl.gltfManager=this.regl.gltfManager||this.m(),this.p(),this.g(),this._&&this._.forEach((t=>{t.generateInstancedBuffers(this.regl)})),this.v&&this.v.forEach((t=>{t.generateBuffers(this.regl)})),this.layer.fire("contextcreate",{regl:this.regl})}m(){return new pn$3(this.regl,(t=>this.workerConn.loadGLTF(t)))}g(){const t=this.layer.getMap(),e=new k$7(this.regl);this.renderer=e,this.T={projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,viewMatrix:t.viewMatrix,cameraPosition:t.cameraPosition,altitudeScale:1},ur$4.PBRUtils.loginIBLResOnCanvas(this.canvas,this.regl,t),this.S=new nr$4(e,{vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform float pointSize;\n\n#include <fbo_picking_vert>\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    gl_PointSize = pointSize;\n\n    fbo_picking_setData(gl_Position.w, true);\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}}]},this.pickingFBO)}prepareWorker(){const t=this.layer.getMap();this.workerConn||(this.workerConn=new O$4("@maptalks/gltf-layer",t.id));const e=this.workerConn;if(!e.isActive())return;const s=this.layer.options||{},n=this.layer.getId();e.addLayer(n,s,(t=>{if(t)throw t;this.layer&&(this.ready=!0,this.layer.fire("workerready"))}))}O(t){const e=T$4;for(const s in e){if(this.t[s])continue;const n=e[s];this.M(t,n.name,n.type,n.config)}}A(t){const e=t.getShader(),s=t.getUrl();if(!this.l)return;if(this.l.isSimpleModel(s)){const s=this.gltfScenes[t.I()];if(!s)return;const n=s.modelMeshes;return"wireframe"===e&&n.forEach((t=>{this.P(t.properties.geometryResource)})),void this.k(t,n)}const n=this.l.getGLTF(s),i=this.gltfScenes[t.I()];if(!n||!i)return;const r=i.modelMeshes;"wireframe"===e&&n.resources.forEach((t=>{this.P(t)})),this.k(t,r)}k(t,e){const s=t.getShader();e.forEach((e=>{const n=this.N(t,e.properties.geometryResource);e.geometry="wireframe"===s?e.properties.geometryResource.copyGeometry:e.properties.geometryResource.geometry,e.material=n}))}P(t){t.copyGeometry.data.aBarycentric||(t.copyGeometry.buildUniqueVertex(),t.copyGeometry.createBarycentric("aBarycentric"),this.regl?t.copyGeometry.generateBuffers(this.regl):(this.v=this.v||[],this.v.push(t.copyGeometry)))}M(e,s,n,i){this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},i.extraCommandProps||(i.extraCommandProps={});const r={};e&&this.C(r,A$2,e);const o=t__namespace.Util.extend({},i);o.extraCommandProps=t__namespace.Util.extend({},i.extraCommandProps),o.extraCommandProps.viewport=this.viewport,o.uniforms=t__namespace.Util.extend([],i.uniforms,A$2),o.defines=t__namespace.Util.extend({},o.defines,r),n.indexOf(".")>-1?(n=n.split("."),this.t[s]={shader:new h$3[n[0]][n[1]](o),type:n}):this.t[s]={shader:new h$3[n](o),type:n}}remove(){this.L();const t=this.t;for(const e in t)t[e].shader.dispose();this.h&&this.h.forEach((t=>{t.mesh.dispose()})),this.R&&this.R.clear(),this.B&&this.B.clear(),this.F&&this.F.clear(),super.remove()}clearCanvas(){this.canvas&&(this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas())}resizeCanvas(t){super.resizeCanvas(t),this.pickingFBO&&this.pickingFBO.resize(this.canvas.width,this.canvas.height),this.layer.fire("resizecanvas",{size:t})}i(e,s){let n=0;if(this.U(e),s!==this.V&&(this.D=!0,this.h=this.h||[],this.h.splice(0,this.h.length),this.q=!1,this.O(e)),function(t){let e;for(e in t)return!1;return!0}(this.gltfScenes))return;const i=this.layer.getGeometries().filter((t=>(t.isDirty()&&(this.D=!0),this.layer.isVisible()&&t.isVisible()&&t.j())));if(i.length&&(this.q||this.V===s||(this.G(i),this.q=!0),s!==this.V&&(this.h=this.J(i)),this.h.length)){for(const s in this.t){if(!i.filter((t=>t.getShader()===s)).length)continue;const r=this.X(e&&e.renderMode,s);let o=this.t[s].shader;r.triangle.sortMeshes(this.T.cameraPosition),this.T.outSize=[this.canvas.width,this.canvas.height];let a=null,c={};if(e){if(e.includes){const{newShader:n,uniforms:i}=this.H(e,o,this.t[s].type);this.t[s].shader=o=n,t__namespace.Util.extend(c,i)}this.T.halton=e.jitter||[0,0],a=e.renderTarget&&e.renderTarget.fbo,c=this.K(e,o,c)}else this.T.halton=k$3;if(this.W=e,t__namespace.Util.extend(c,this.T),o="pbr"!==s||ur$4.PBRUtils.isSupported(this.regl)?e&&e.onlyUpdateDepthInTaa?this.t.depth.shader:this.t[s].shader:e&&e.onlyUpdateDepthInTaa?this.t.depth.shader:this.t.phong.shader,o.filter=e&&e.sceneFilter||null,this.renderer.render(o,c,r.triangle,a),r.pointLine.getMeshes().length){c.pointSize=this.layer.options.pointSize||1;const t=this.t.pointline.shader;t.filter=e&&e.sceneFilter||null,this.renderer.render(t,c,r.pointLine,a)}n++}this.Y=!0,(!e||e&&e.isFinalRender)&&(this.completeRender(),this.layer.fire("rendercomplete-debug",{count:n})),this.V=s}}X(t,e){const s=[],n=[];for(let i=0;i<this.h.length;i++)if(this.h[i].shader===e){this.Z(t,this.h[i].mesh,s,n)}return this.B=this.B||new pe$4,this.R=this.R||new pe$4,{pointLine:this.B.setMeshes(s),triangle:this.R.setMeshes(n)}}getFrameTimestamp(){return this.V}getFrameContext(){return this.W}supportRenderMode(){return!0}needRetireFrames(){return this.D}C(e,s,n){const i=n&&n.includes;if(i)for(const r in i)i[r]&&(n[r].uniformDeclares&&(s.length=0,s.push(...n[r].uniformDeclares)),n[r].defines&&t__namespace.Util.extend(e,n[r].defines))}$(e,s){const n=s&&s.includes;if(n)for(const i in n)n[i]&&s[i].renderUniforms&&t__namespace.Util.extend(e,s[i].renderUniforms)}H(e,s,n){const i={},r={};this.C(i,A$2,e),this.$(r,e);const o={vert:s.vert,frag:s.frag,uniforms:s.uniforms,extraCommandProps:s.extraCommandProps};o.defines=i,o.uniforms=t__namespace.Util.extend([],o.uniforms,A$2);let a=null;return e.states.includesChanged?(a=Array.isArray(n)?new h$3[n[0]][n[1]](o):new h$3[n](o),s.dispose()):a=s,{uniforms:r,newShader:a}}K(e,s,n){if(e.viewshed){for(const t in e.viewshed.renderUniforms)n[t]=e.viewshed.renderUniforms[t];t__namespace.Util.extend(s.shaderDefines,e.viewshed.defines)}if(e.floodAnalysis){for(const t in e.floodAnalysis.renderUniforms)n[t]=e.floodAnalysis.renderUniforms[t];t__namespace.Util.extend(s.shaderDefines,e.floodAnalysis.defines)}return n}getShadowMeshes(){let t=[];if(!this.layer||!this.layer.isVisible())return t;const e=this.layer.getGeometries();for(let s=0;s<e.length;s++)if(e[s].isCastShadow()&&e[s].isVisible()&&e[s].j()){const n=e[s].I();this.gltfScenes[n]&&(t=t.concat(this.gltfScenes[n].modelMeshes))}return t}tt(){return this.h?this.h.map((t=>t.mesh)):D$3}getAnalysisMeshes(){return this.tt()}drawOutline(t){this.extentShader||(this.extentShader=new rt$6({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n}\n\n",frag:"precision highp float;\n\nvoid main() {\n\n    gl_FragColor = vec4(1.0);\n\n}\n\n",positionAttribute:"POSITION",extraCommandProps:{viewport:this.viewport,cull:{enable:!1}}}));const e=this.getOutlineMeshes();e.length&&(this.F=this.F||new pe$4,this.F.setMeshes(e),this.renderer.render(this.extentShader,{projViewMatrix:this.T.projViewMatrix},this.F,t))}getOutlineMeshes(){let t=[];if(!this.layer)return t;const e=this.layer.getGeometries();for(let s=0;s<e.length;s++)if(e[s].isOutline()&&e[s].isVisible()&&e[s].j()){const n=e[s].I();this.gltfScenes[n]&&(t=t.concat(this.gltfScenes[n].modelMeshes))}return t}G(t){t.forEach((t=>{const e=t.I();this.gltfScenes[e]&&(t.isLoaded()&&(t.et=t.getUrl()),this.st(e),t.isAnimated()||t.hasFunctionDefinition()||t.isOutline()||t.isDashAnimated()?t.setDirty(!0):t.setDirty(!1),t.nt()&&t.it())}))}rt(t,e){return!("wireframe"===e&&!t.geometry.data.aBarycentric)}J(t){const e=this.h||[],s=this.layer.getMap();for(let n=0;n<t.length;n++){const i=t[n],r=i.getShader(),o=this.gltfScenes[i.I()];if(!o)continue;const a=o.modelMeshes;for(let t=0;t<a.length;t++){const n=a[t];this.rt(n,r)&&(this.ot(n,i),this.ht(n,i),this.ct(n,i),n.setUniform("uPickingId",i.I()),n.properties.isAnimated=i.isAnimated(),(n instanceof he$4||intersectsBox(s.projViewMatrix,n.getBoundingBox()))&&e.push({shader:r,mesh:n}))}i.ut()}return e}Z(t,e,s,n){const i=e.properties.isAnimated;"fxaaAfterTaa"===t&&i?this.lt(e,s,n):"taa"!==t||i?"default"===t||"fxaa"===t?this.lt(e,s,n):t||this.lt(e,s,n):this.lt(e,s,n)}ft(t,e,s){const n=t;n.copy(),"wireframe"===s&&n.createCopyBarycentric();const i=this.dt(e,n,s),r=i.getDefines();return i instanceof he$4?(r.HAS_PICKING_ID=1,r.HAS_INSTANCE_COLOR=1):r.HAS_PICKING_ID=2,i.geometry.data.COLOR_0&&(r.HAS_COLOR0=1),n.extraInfo&&"MASK"===n.extraInfo.alphaMode&&(r.HAS_ALPHAMODE=1),i.setDefines(r),i}dt(t,e,s){const n=this.layer.o()[t],i=n.getGLTFMarkerType();let r=null;const o=e.material?e.material:this.N(n,e);e.material=o;const a="wireframe"===s?e.copyGeometry:e.geometry;if(this.regl?a.generateBuffers(this.regl):(this.v=this.v||[],this.v.push(a)),"multigltfmarker"===i){n.gt();const t=n.yt(identity$2(R$4)),e=n.getCount();r=new he$4(t,e,a,o),this.regl?r.generateInstancedBuffers(this.regl):(this._=this._||[],this._.push(r))}else r=new de$4(a,o);r.nodeMatrix=copy$5([],e.nodeMatrix),r.properties.geometryResource=e,n.isBloom()&&(r.bloom=1),r.transparent=n.bt();const u=e.extraInfo;return"BLEND"!==u.alphaMode&&"MASK"!==u.alphaMode||(r.transparent=!0),this.ct(r,n),r}lt(t,e,s){V$3[t.geometry.desc.primitive]<4?e.push(t):s.push(t)}N(t,e){let s=null;const n=t.getShader(),i=t.getUniforms()||{},r=e.materialInfo||{};if("phong"===n)if("pbrSpecularGlossiness"===r.name)s=new le$4(r);else{for(const t in I$3)i[t]=i[t]||I$3[t];s=new ie$4(r)}else if("wireframe"===n)s=new ne$4(r);else if("pbr"===n){if(s="pbrSpecularGlossiness"===r.name?new ur$4.StandardSpecularGlossinessMaterial(r):new ur$4.StandardMaterial(r),this.regl&&!ur$4.PBRUtils.isSupported(this.regl)){s=ie$4.convertFrom(s);for(const t in I$3)i[t]=i[t]||I$3[t]}}else s=new ee$3(r);s.doubleSided=e.extraInfo&&e.extraInfo.doubleSided?1:0;for(const t in i)s.set(t,i[t]);return e.morphWeights&&this._t(e.morphWeights,s),e.skin&&(s.set("jointTextureSize",[4,6]),s.set("numJoints",e.skin.numJoints),s.set("jointTexture",e.skin.jointTexture),s.set("skinAnimation",0)),s}_t(t,e){const s=e.get("morphWeights1")||[],n=e.get("morphWeights2")||[];for(let e=0;e<4;e++)s[e]=t[e]||0,n[e]=t[e+4]||0;e.set("morphWeights1",s),e.set("morphWeights2",n)}ct(t,e){const s=e.getSymbol();s&&s.uniforms?(t.setUniform("polygonFill",s.uniforms.polygonFill||P$4),t.setUniform("polygonOpacity",void 0===s.uniforms.polygonOpacity?1:s.uniforms.polygonOpacity),t.setUniform("lineColor",s.uniforms.lineColor||P$4),t.setUniform("lineOpacity",void 0===s.uniforms.lineOpacity?1:s.uniforms.lineOpacity)):(t.setUniform("polygonFill",P$4),t.setUniform("polygonOpacity",1),t.setUniform("lineColor",P$4),t.setUniform("lineOpacity",1))}xt(e){const s=this.layer.getMap();if(!this.gltfScenes[e])return null;const n=this.gltfScenes[e].modelMeshes,i=this.layer.o()[e],r=this.wt(n,i);if(!r)return null;const o=i.getPointZ()||0,a=r.min,h=r.max,c=set$3(C$3,a[0],a[1],a[2],1),l=set$3(L$3,h[0],h[1],h[2]+o,1),f=transformMat4$1(c,c,s.projViewMatrix),d=transformMat4$1(l,l,s.projViewMatrix),m=(f[0]/f[3]+1)*s.width/2,p=(1-f[1]/f[3])*s.height/2,g=(d[0]/f[3]+1)*s.width/2,y=(1-d[1]/f[3])*s.height/2,b=Math.min(m,g),_=Math.max(m,g),x=Math.min(p,y),w=Math.max(p,y);return new t__namespace.Extent({xmin:b,xmax:_,ymin:x,ymax:w})}L(){this.canvas&&ur$4.PBRUtils.logoutIBLResOnCanvas(this.canvas,this.getMap())}U(e){const s=this.layer.getMap(),{iblTexes:n,dfgLUT:i}=ur$4.PBRUtils.getIBLResOnCanvas(this.canvas);if(s&&s.getLights()){const r=ur$4.PBRUtils.getPBRUniforms(s,n,i,e&&e.ssr,e&&e.jitter),o=s.getLights();this.T.ambientColor=o.ambient&&o.ambient.color?o.ambient.color:[.2,.2,.2],r&&t__namespace.Util.extend(this.T,r)}else{const n=ur$4.PBRUtils.getPBRUniforms(s,null,i,e&&e.ssr,e&&e.jitter);t__namespace.Util.extend(this.T,n)}}ot(t,e){"effectmarker"===e.getGLTFMarkerType()?e.updateUV(M$3):"glowmarker"===e.getGLTFMarkerType()&&e.vt();const s=e.getUniforms();if(s&&e.isDirty()&&e.Tt())for(const e in s)t.material.set(e,s[e]);e.bt()&&(t.transparent=!0),t.bloom=+!!e.isBloom(),"wireframe"===e.getShader()&&s&&s.dashAnimate&&t.material.set("time",M$3/1e3)}ht(t,e){if("pbr"===e.getShader()){const e=t.getDefines(),{iblTexes:s}=ur$4.PBRUtils.getIBLResOnCanvas(this.layer.getRenderer().canvas);s?e.HAS_IBL_LIGHTING=1:delete e.HAS_IBL_LIGHTING,t.setDefines(e)}}St(t,e){const s=t.I(),n=[],i=t.getShader(),r=this.l.getGLTF(e);if(r&&r.resources){if(!r.resources.length){const e="there are no geomtries in the gltf model";return console.error(e),void this.layer.fire("modelerror",{type:"modelerror",marker:t,info:e})}t.gltfPack=r.gltfPack,r.resources.forEach((t=>{const e=this.ft(t,s,i);n.push(e)}))}this.gltfScenes[s]&&this.Ot(t,this.gltfScenes[s].modelMeshes),this.gltfScenes[s]={pickingId:s,modelMeshes:n},t.Mt()?t.Mt()&&(t.At([1,1,1]),t.Et([0,0,0]),this.It(t,n)):this.It(t,n),this.st(s,!0),this.setToRedraw(),t.fire("createscene-debug",{scene:this.gltfScenes[s]})}Pt(t,e){const s=t.I();if(!this.layer.o()[s])return;const n=t.getUrl();t.kt(e.json),this.layer.Nt[n]=1,this.St(t,n),this.A(t),t.Ct(!0),t.fire("load",{data:e.json}),this.Lt()&&this.layer.fire("modelload",{models:this.layer.getGLTFUrls()}),t.fire("setUrl-debug"),this.D=!0}loginGLTFMarker(t){if(!this.l)return;const e=t.getUrl();this.l.loginGLTF(e),this.Rt(e,t)}Rt(t,e){const s=this.l.getGLTF(t);s.then?s.then((s=>{this.l.getGLTF(t)&&this.Pt(e,s)})).catch((t=>{console.error(t),this.layer.fire("modelerror",{type:"modelerror",marker:e,info:t})})):this.Pt(e,s)}logoutGLTF(t){const e=this.l;e&&e.logoutGLTF(t)}p(){const t=this.layer._geoList;for(let e=0;e<t.length;e++)this.loginGLTFMarker(t[e])}Lt(){if(!this.layer)return;const t=this.layer._geoList;for(let e=0;e<t.length;e++)if(!t[e].isLoaded())return!1;return!0}It(t,e){this.st(t.I(),!0);let s=this.wt(e,t);if(!s)return;const n=this.Bt(t.Mt()||[],t,s);t.At(n),this.st(t.I(),!0),s=this.wt(e,t),s&&(this.Ft(t.Ut()||[],s,t),t.Vt=s)}Bt(t,e,s){const n=subtract$2(t,s.max,s.min),i=Math.max(...n);let r=null;r=e.Mt()&&e.Dt()?e.Dt():e.qt();const o=function(t,e,s){return e*t.getGLScale(s)}(this.layer.getMap(),r,e.getZoomOnAdded()),a=o/i,h=set$4(t,a,a,a);return multiply$4(t,e.getScale(),h)}Ft(t,e,s){const n=s.getPointZ()||0;if("multigltfmarker"===s.getGLTFMarkerType())return set$4(t,0,0,-e.min[2]+n);if(!this.jt(s)){const t=s.Ut();return set$4(F$3,0,0,n),add$4(F$3,F$3,t)}const i=s.getAnchorZ()||"bottom";let r=0;"bottom"===i?r=-e.min[2]:"top"===i?r=-e.max[2]:"center"===i&&(r=-(e.min[2]+e.max[2])/2);const o=s.getModelMatrix(),a=s.getTranslation();set$4(t,-(e.min[0]+e.max[0])/2+o[12],-(e.min[1]+e.max[1])/2+o[13],r+a[2]),s.Et(t);const h=copy$4(F$3,t);return h[2]+=n,h}jt(t){if(!t.Vt)return!0;const e=t.getUrl(),s=t.getSymbol(),n=s&&s.fixSizeOnZoom;if((!n||n<0)&&!t.nt()&&t.et===e)return!1;const i=this.layer.getMap();return!(n>0&&!i.isZooming())}wt(t,e){if(!t||!t.length)return null;if(!this.jt(e))return e.Vt;"multigltfmarker"===e.getGLTFMarkerType()&&t.forEach((t=>{const s=e.yt();for(const e in s)t.updateInstancedData(e,s[e]);t.updateBoundingBox()})),this.st(e.I(),!0);const s=t[0].getBoundingBox(),n=copy$4([],s[0]),i=copy$4([],s[1]);for(let e=1;e<t.length;e++){const s=t[e].getBoundingBox(),r=copy$4([],s[0]),o=copy$4([],s[1]);r[0]<n[0]&&(n[0]=r[0]),r[1]<n[1]&&(n[1]=r[1]),r[2]<n[2]&&(n[2]=r[2]),o[0]>i[0]&&(i[0]=o[0]),o[1]>i[1]&&(i[1]=o[1]),o[2]>i[2]&&(i[2]=o[2])}return{min:n,max:i}}st(e,s){const n=this.gltfScenes[e];if(!n)return;const i=this.layer.o()[e];i.Gt();const r=i.isAnimated(),o=this.zt(i),a=this.isInFrustum(i);if(r&&i.gltfPack&&o&&a&&!s){const t=i.Jt();if(x$4(t)){const e=i.isAnimationLooped(),s=i.getAnimationSpeed();(e||!e&&i.gltfPack.isFirstLoop(M$3,s,t))&&i.gltfPack.updateAnimation(M$3,e,s,t)}else console.warn("animation specified does not exist!")}const u=n.modelMeshes,f=i.getModelMatrix();multiply$5(f,f,U$2);const d=this.layer.getMap(),m=[],p=[];u.forEach((e=>{B$4[0]=B$4[1]=B$4[2]=1;const s=i.getSymbol(),n=s&&s.fixSizeOnZoom;if(t__namespace.Util.isNumber(n))if(n>=0){let t=d.getGLScale()/d.getGLScale(n);t*=i.Xt(),set$4(B$4,t,t,t),i.Ht(t)}else{const t=i.Kt();set$4(B$4,t,t,t),i.Wt(t)}const o=i.Mt()||[1,1,1];multiply$4(m,o,B$4);const a=r?e.properties.geometryResource.nodeMatrix:e.nodeMatrix;if(e instanceof he$4){scale$5(p,f,m);const t=multiply$5(e.positionMatrix,p,a);e.positionMatrix=t}else{scale$5(p,f,m);const t=multiply$5(e.localTransform,p,a);e.localTransform=t}if(r){e.material.set("skinAnimation",1);const t=e.geometry.properties.morphWeights;t&&this._t(t,e.material)}else e.material.set("skinAnimation",0)})),s||this.Yt(i,u)}Yt(t,e){const s=this.wt(e,t);if(!s)return;const n=this.Ft(t.Ut()||[],s,t);e.forEach((e=>{e instanceof he$4?(e.positionMatrix[12]+=n[0],e.positionMatrix[13]+=n[1],e.positionMatrix[14]+=n[2],this.Zt(e,t)):(e.localTransform[12]+=n[0],e.localTransform[13]+=n[1],e.localTransform[14]+=n[2])}))}Ot(t,e){const s=this.wt(e,t);t.Vt=s;const n=subtract$2(N$4,s.max,s.min);divide$2(n,n,t.getScale());const i=Math.max(...n)/this.layer.getMap().getGLScale(t.getZoomOnAdded());t.$t(i)}Qt(t,e){for(const s in e)t.setUniform(s,e[s]);return t}Zt(t,e){const s=e.yt();for(const e in s)t.updateInstancedData(e,s[e]);this.regl?t.generateInstancedBuffers(this.regl):(this._=this._||[],this._.push(t)),t.instanceCount=e.getCount()}te(t){if(x$4(t)){this.ee(t);const e=this.layer.o()[t].getUrl();this.logoutGLTF(e),delete this.gltfScenes[t],this.setToRedraw(),this.D=!0}}ee(t){this.gltfScenes[t]&&this.gltfScenes[t].modelMeshes.forEach((t=>{t.dispose()}))}u(t,e){const s=["webgl","experimental-webgl"];let n=null;for(let i=0;i<s.length;++i){try{n=t.getContext(s[i],e)}catch(t){}if(n)break}return n}se(e,s,n={}){if(!this.S)return null;const i=this.layer.getMap();if(this.Y||this.canvas.gl&&this.canvas.gl.wrap){if(!this.h||0===this.h.length)return null;const e=this.tt(),s=t__namespace.Util.extend({},this.T);s.pointSize=this.layer.options.pointSize||1,this.S.render(e,s,!0),this.Y=!1}const{meshId:o,pickingId:a,point:h}=this.S.pick(e,s,n.tolerance||3,{projViewMatrix:i.projViewMatrix,pointSize:this.layer.options.pointSize||1},{viewMatrix:i.viewMatrix,projMatrix:i.projMatrix,returnPoint:!0}),c=this.ne(a);return{meshId:o,target:this.layer.o()[c],pickingId:a,point:h,index:a-c}}ne(t){if(!x$4(t))return null;if(this.layer.o()[t])return t;const e=Object.keys(this.layer.o()).sort().map((t=>Number(t))),s=e.length;let n=0,i=s-1,r=Math.floor((n+i)/2);for(;n<=s-1&&i>=0;){if(n===i)return e[n];if(e[r]<=t&&t<e[r+1])return e[r];t<e[r]?(i=r-1,r=Math.floor((n+i)/2)):e[r+1]<t&&(n=r+1,r=Math.floor((n+i)/2))}return null}zt(t){return"effectmarker"!==t.getGLTFMarkerType()&&"glowmarker"!==t.getGLTFMarkerType()}isInFrustum(t){const e=this.layer.getMap(),s=t.Vt;if(!s||"multigltfmarker"===t.getGLTFMarkerType())return!0;const n=set(E$4,s.min,s.max);return!!intersectsBox(e.projViewMatrix,n)}getRenderMeshesTest(){return this.tt()}isMarkerTransparent(t){return t.bt()}getMarkerMeshes(t){const e=t.I();return this.gltfScenes[e].modelMeshes}getMarkerFitSizeScale(t){return t.Mt()}getMarkerFitTranslate(t){return t.Ut()}getFBORayPicking(){return this.S}getShaderList(){return this.t}}const j$2=[];class G$2 extends t$2.Marker{constructor(t,e){const s=t$2.Util.extend({},e),i=s.symbol;super(t,s),this.options.symbol=i,this.ie=!1,this.re=identity$2([]),this.oe="gltfmarker",this.ae=!0,this.he={get translation(){return[0,0,0]},get rotation(){return[0,0,0]},get scale(){return[1,1,1]}},this.Gt()}static parseJSONData(t){const e=G$2.fromJSON(t);return e.setZoomOnAdded(t.zoomOnAdded),e}static fromJSON(t){return new G$2(t.coordinates,t.options)}ce(){return this.ue}kt(t){this.ue=t}le(t,e){this._externSymbol=this._externSymbol||{},this._externSymbol[t]=e,"uniforms"===t&&(this.fe=!0)}setUrl(t){return super.updateSymbol({url:t}),this}setSymbol(t){const e=this.getUrl(),s=this.getShader(),n=this.de&&this.de.getRenderer();n&&t.url!==e&&n.logoutGLTF(e),super.setSymbol(t),(t.url||"pyramid")!==e&&this.de&&(this.Ct(!1),this.de.me(this)),t.shader!==s&&this.de&&this.de.A(this),this.fe=!0,this.ae=!0}getCenter(){const t=this.getMap();if(!t)return null;const e=v$3(t,super.getCenter()||this.getCoordinates()),s=this.getTranslation(),n=new t$2.Point([e[0]+s[0],e[1]+s[1]]);return t.pointAtResToCoord(n,t.getGLRes())}getPointZ(){const t=this.getCoordinates(),e=this.getMap();return e&&t?e.altitudeToPoint(t.z||0,e.getGLRes()):null}getUrl(){const t=this._getInternalSymbol();return t&&t.url||"pyramid"}addTo(t){if(this.de)throw new Error("GLTFMarker cannot be added to two or more layers at the same time.");return t.addGeometry(this),this}onAdd(){const t=this.getLayer().getMap();if(t&&!x$4(this.pe)){const e=t.getZoom();this.pe=e}}onRemove(){this.ge()}remove(){this.de&&(this.de.ye(this),delete this.ue,delete this.gltfPack,super.remove(),delete this.de)}show(){return super.updateSymbol({visible:!0}),this}hide(){super.updateSymbol({visible:!1})}setBloom(t){return super.updateSymbol({bloom:t}),this}isBloom(){const t=this._getInternalSymbol();return t&&t.bloom}setCastShadow(t){return super.updateSymbol({shadow:t}),this}isCastShadow(){const t=this._getInternalSymbol();return t&&t.shadow}outline(){return this.be=!0,this.ae=!0,this}cancelOutline(){return this.be=!1,this.ae=!0,this}isOutline(){return this.be}isVisible(){const t=this._getInternalSymbol();return!t||!x$4(t.visible)||t.visible}setCoordinates(t){return super.setCoordinates(t),this.he&&this.Gt(),this.ae=!0,this._e=!0,this}copy(){const t=this.toJSON(),e=G$2.fromJSON(t);return e.setZoomOnAdded(this.pe),e}setShader(t){return super.updateSymbol({shader:t}),this}getShader(){const t=this._getInternalSymbol();return t&&t.shader||"pbr"}setUniforms(t){return super.updateSymbol({uniforms:t}),this.fe=!0,this}getUniforms(){const t=this._getInternalSymbol();return t&&t.uniforms}setUniform(t,e){const s=this.getUniforms()||{};return s[t]=e,super.updateSymbol({uniforms:s}),this.fe=!0,this}getUniform(t){const e=this._getInternalSymbol();return e&&e.uniforms&&e.uniforms[t]}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation&&this.ue&&this.ue.animations}isDashAnimated(){const t=this._getInternalSymbol();return t&&t.uniforms&&t.uniforms.dashEnabled&&t.uniforms.dashAnimate}setAnimation(t){return super.updateSymbol({animation:t}),this}setAnimationLoop(t){return super.updateSymbol({loop:t}),this.ae=!0,this}isAnimationLooped(){const t=this._getInternalSymbol();return t&&t.loop}getAnimationSpeed(){const t=this._getInternalSymbol();return t&&x$4(t.speed)?t.speed:1}setAnimationSpeed(t){return super.updateSymbol({speed:t}),this}xe(t){const e=this.getMap();return e?v$3(e,t||this.getCoordinates()):null}setTranslation(t){return super.updateSymbol({translation:t||this.he.translation}),this.Gt(),this._e=!0,this}getTranslation(){const t=this._getInternalSymbol();return t&&t.translation||this.he.translation}setTRS(t,e,s){return super.updateSymbol({translation:t||this.he.translation,rotation:e,scale:s}),this.Gt(),this._e=!0,this}we(){const t=this.getTranslation(),e=this.xe();return e?add$4(this.he.translation,t,e):t}setRotation(t){return super.updateSymbol({rotation:t}),this.Gt(),this._e=!0,this}getRotation(){const t=this._getInternalSymbol();return t&&t.rotation||this.he.rotation}setScale(t){const e=t=t||this.he.scale;return super.updateSymbol({scale:e}),this.Gt(),this._e=!0,this}getScale(){const t=this._getInternalSymbol();return t&&t.scale||this.he.scale}setFixSizeOnZoom(t){return super.updateSymbol({fixSizeOnZoom:t}),this}getFixSizeOnZoom(){const t=this._getInternalSymbol();return t&&t.fixSizeOnZoom}cancelFixSize(){return this.setFixSizeOnZoom(-1)}setAnchorZ(t){return super.updateSymbol({anchorZ:t}),this._e=!0,this}getAnchorZ(){const t=this._getInternalSymbol();return t&&t.anchorZ||"bottom"}_setExternSymbol(t){return this.ae=!0,super._setExternSymbol(t)}ve(t){return loadFunctionTypes(t,(()=>{const t=this.getMap();return t?[t.getZoom()]:null}))}_prepareSymbol(t){super._prepareSymbol(t);const e=this.ve(t);return e&&e.uniforms&&(e.uniforms=this.ve(t.uniforms)),delete this.Te,e}hasFunctionDefinition(){if(x$4(this.Te))return this.Te;const t=this._getInternalSymbol();return this.Te=hasFunctionDefinition(t)||t&&t.uniforms&&hasFunctionDefinition(t.uniforms),this.Te}onSymbolChanged(){super.onSymbolChanged(),this.he&&this.Gt()}setModelMatrix(t){const e=getTranslation$1(this.he.translation,t),s=getRotation(this.he.rotation,t),n=getScaling(this.he.scale,t);return this.setTranslation(e),this.setRotation(s),this.setScale(n),this}getModelMatrix(){return this.re}Gt(){const t=this.getRotation(),e=3===t.length?fromEuler(j$2,t[0]||0,t[1]||0,t[2]||0):t;this.re=fromRotationTranslationScale(this.re,e,this.we(),this.getScale())}isDirty(){return this.ae}setDirty(t){return this.ae=t,this}on(t,e,s){super.on(t,e,s||this),this.de&&this.de.Se(t)}off(t,e,s){super.off(t,e,s||this),this.de&&this.de.Oe()}Me(){const t=this.toJSON();return t.zoomOnAdded=this.pe,t}toJSON(){const t=JSON.parse(JSON.stringify({coordinates:this.getCoordinates(),options:this.options||{}})),e=this.getId();t$2.Util.isNil(e)||(t.options.id=e);const s=this.getProperties();s&&(t.options.properties=JSON.parse(JSON.stringify(s)));const i=this.getSymbol();return i&&(t.options.symbol=JSON.parse(JSON.stringify(i))),t}setZoomOnAdded(t){this.pe=t}getZoomOnAdded(){return this.pe}bt(){return this.j()<1}j(){const t=this.getUniforms(),e=this.getShader();return"phong"===e||"wireframe"===e?t&&x$4(t.opacity)?t.opacity:1:"pbr"===e&&t&&x$4(t.polygonOpacity)?t.polygonOpacity:1}Ct(t){this.ie=t}isLoaded(){return this.ie}getGLTFMarkerType(){return this.oe}Ae(t){this.Ee=t}I(){return this.Ee}getCount(){return 1}At(t){this.Ie=t}Mt(){return this.Ie}Et(t){this.Pe=t}Ut(){return this.Pe}getContainerExtent(){const t=this.getLayer();if(!t)throw Error("marker has not be added to layer");return t.xt(this.Ee)}getGLTFAsset(){return this.ue&&this.ue.asset}openInfoWindow(){this.ue?super.openInfoWindow():this.once("load",(()=>{super.openInfoWindow()}))}getAnimations(){if(!this.ue)return null;const t=this.ue.animations;return t?t.map(((t,e)=>t.name||e)):null}getCurrentAnimation(){const t=this._getInternalSymbol();return t&&t.animationName}Jt(){const t=this.getAnimations();if(!t)return null;const e=this.getCurrentAnimation();return x$4(e)?t.indexOf(e)>-1?e:void 0:t[0]}setCurrentAnimation(t){this.updateSymbol({animationName:t})}Ht(t){this.ke=t}Kt(){return this.ke||1}Wt(t){this.Ne=t}Xt(){return this.Ne||1}$t(t){this.Ce=t}Dt(){return this.Ce}nt(){return this._e}it(){this._e=!1}Tt(){return this.fe}ut(){this.fe=!1}setAnimationTimeframe(t){this.gltfPack.updateAnimation(t,this.isAnimationLooped(),this.getAnimationSpeed())}qt(){return this.options.fitSize||100}ge(){delete this.Vt,delete this.et,delete this.pe,delete this.Ie,delete this.Pe,delete this.ke,delete this.Ne,delete this.Ce}}G$2.mergeOptions({symbol:null}),G$2.registerJSONType("GLTFMarker");const z$2=/\{ *([\w_]+) *\}/g;class J$2 extends G$2{constructor(t,e){super(t,e),this.oe="effectmarker"}static fromJSON(t){return new J$2(t.coordinates,t.options)}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation}setTexture(t){const e=this.getLayer()&&this.getLayer().getRenderer();if(e){const s=this.getTextureUrl();e.Le(s),e.Re(t)}return super.updateSymbol({textureUrl:t}),this}Be(t){const e=this.getTextureUrl(),s=this.getLayer()&&this.getLayer().getRenderer();if(s){let n=e;const i=this.Fe();if(i){const s=this.isAnimationLooped(),r=this.getAnimationSpeed()||1,o=s?Math.floor(.01*t*r)%i.length:Math.floor(.01*t);n=e.replace(z$2,i[o]),this.setUniform("width",1),this.setUniform("height",1),this.setUniform("uvOffset",[0,0])}return s.Ue(n,this.I())}return null}Fe(){const t=this._getInternalSymbol();return t&&t.textureNames}getTextureUrl(){const t=this._getInternalSymbol();return t&&t.textureUrl||"default"}getUrl(){return"plane"}getShader(){return"effect"}setTransparent(t){return this.options.symbol.transparent=t,this}isTransparent(){return this.options.symbol.transparent}updateUV(t){const e=this.isAnimationLooped(),s=this.getAnimationSpeed()||1,n=this.getUniforms()||{},i=n.width||1,r=n.height||1;let o;const a=this.getEffectType();"uv"===a?o=e?.01*t*s%(i*r):.01*t:"sequence"===a&&(o=e?Math.floor(.01*t*s)%(i*r):Math.floor(.01*t));const h=Number(o%i),c=Math.floor(o/i),u=this.Be(t);this._getSymbol()?(this.setUniform("uvOffset",[h,c]),this.setUniform("width",i),this.setUniform("height",r),this.setUniform("texture",u)):this.le("uniforms",{uvOffset:[h,c],width:i,height:r,texture:u})}_setExternSymbol(t){super._setExternSymbol(t);const e=this.getLayer()&&this.getLayer().getRenderer();if(e){const t=this.getTextureUrl();e.Re(t)}}getEffectType(){const t=this._getInternalSymbol();return t&&t.effect||"uv"}setEffectType(t){return this._getInternalSymbol().effect=t,this}remove(){const t=this.getLayer()&&this.getLayer().getRenderer();if(t){const e=this.getTextureUrl();t.Le(e)}super.remove()}}const X$2=["Point","Polygon","LineString","MultiPoint","MultiPolygon","MultiLineString","GeometryCollection","Feature","FeatureCollection"].reduce(((t,e)=>(t[e]=!0,t)),{}),H$3={toGeometry:function(t,e){if(t$2.Util.isString(t)&&(t=t$2.Util.parseJSON(t)),Array.isArray(t)){const s=[];for(let i=0,r=t.length;i<r;i++){const r=H$3.Ve(t[i],e);Array.isArray(r)?t$2.Util.pushIn(s,r):s.push(r)}return s}return H$3.Ve(t,e)},Ve:function(t,e){if(!t||t$2.Util.isNil(t.type))return null;const s=t.type;if("Feature"===s){const n=H$3.Ve(t.geometry,e);return n?(n.setId(t.id),n.setProperties(t.properties),n):null}if("FeatureCollection"===s){const s=t.features;return s?H$3.toGeometry(s,e):null}if("Point"===s)return function(t,e){return"EffectLayer"===e?new J$2(t):new G$2(t)}(t.coordinates,e);if("GeometryCollection"===s){const s=t.geometries,n=[],i=s.length;for(let t=0;t<i;t++)n.push(H$3.Ve(s[t],e));return n}throw new Error("geometry's type is invalid, only support type of Point")},isGeoJSON:function(t){return!(!t||"object"!=typeof t||!t.type||!X$2[t.type]||t instanceof t$2.Geometry)}},K$3=["mousedown","mouseup","mousemove","contextmenu","click","dbclick","touchstart","touchmove","touchend"],W$2=/\{*(\$root)*\}/g;class Y$1 extends t__namespace.OverlayLayer{constructor(e,s,n){!s||s instanceof t__namespace.Geometry||Array.isArray(s)||X$2[s.type]||(n=s,s=null),super(e,null,n),this.pickingId=0,this.De={},this.Nt={},this.qe={},this.mapEvents="";this.setStyle(n&&n.style),s&&this.addGeometry(s)}static registerShader(t,e,s,n){T$4[t]={name:t,type:e,config:s,uniforms:n}}static removeShader(t){delete T$4[t]}static getShaders(){const t=[];for(const e in T$4)t.push({shader:e,uniforms:T$4[e].uniforms});return t}static getShaderMap(){return T$4}addGeometry(t,e){let s=H$3.isGeoJSON(t)?H$3.toGeometry(t,this.getJSONType()):t;s=Array.isArray(s)?s:[s];for(let t=0;t<s.length;t++)if(!this.je(s[t]))return void console.error("type of geometry is invalid");super.addGeometry(s,e),Array.isArray(s)&&this.addMarker(s)}addMarker(t){for(let e=0;e<t.length;e++){const s=t[e];s.Ae(this.pickingId),this.De[this.pickingId]=s,s.de=this,this.Se(s.getListeningEvents());const n=s.getId();n&&(this.qe[n]=s),s.fire("add",{type:"add",target:s,layer:this}),"multigltfmarker"===s.getGLTFMarkerType()?this.pickingId+=s.getCount():this.pickingId++,this.me(s)}}me(t){const e=this.getRenderer();e&&e.loginGLTFMarker(t)}toJSON(t){t||(t={});const e={type:this.getJSONType(),id:this.getId(),options:this.config()};if((_$4(t.style)||t.style)&&(e.style=this.getStyle()),_$4(t.geometries)||t.geometries){const t=[],s=this._geoList;for(let e=0;e<s.length;e++){const n=s[e].Me();t.push(n)}e.geometries=t}return e}je(t){return!!t.getGLTFMarkerType&&this.options.marekrTypes.indexOf(t.getGLTFMarkerType())>-1}setStyle(t){return t?(this.options.style=t,this.Ge=JSON.parse(JSON.stringify(t)),this.ze(),this.fire("setstyle",{target:this,style:this.Ge}),this):(delete this.Ge,delete this.options.style,this)}getStyle(){return this.options.style}updateSymbol(t,e){const s=this.getStyle();this.Je(t,e,s),this.Je(t,e,this.Ge),this.ze(),this.fire("updatesymbol",{target:this,index:t,symbol:e})}Je(t,e,s){if(!s)return;const n=(s.style?s.style:s)[t].symbol||{};for(const t in e)n[t]=e[t]}ze(){this.Xe(this.Ge);this.He=compileStyle(this.Ge.style?this.Ge.style:this.Ge),this._geoList.forEach((function(t){this.Ke(t)}),this)}getGLTFUrls(){return Object.keys(this.Nt)}Se(e){const s=t__namespace.Util.isString(e)?e.split(/\s+/).map((t=>"mouseleave"===t||"mouseenter"===t||"mouseout"===t?"mousemove":t)):e;let n=this.mapEvents;const i=w$4(s,K$3).filter((t=>this.mapEvents.indexOf(t)<0));this.mapEvents+=" "+i.join(" "),this.mapEvents=this.mapEvents.trim();const r=this.mapEvents.replace(" "," dom:");n=n.replace(" "," dom:");const o=this.getMap();o&&(o.off("dom:"+n,this.We,this),o.on("dom:"+r,this.We,this))}Oe(){const t={};let e=this.mapEvents;const s=this._geoList;for(let e=0;e<s.length;e++){const n=s[e].getListeningEvents().map((t=>"mouseleave"===t||"mouseenter"===t||"mouseout"===t?"mousemove":t));for(let e=0;e<n.length;e++)t[n[e]]=1}this.mapEvents=w$4(Object.keys(t),K$3).join(" ");const n=this.mapEvents.replace(" "," dom:");e=e.replace(" "," dom:");const i=this.getMap();i&&(i.off("dom:"+e,this.We,this),i.on("dom:"+n,this.We,this))}Xe(e){t__namespace.Util.isString(e.$root)&&e.style.forEach((t=>{const s=t.symbol.url;s&&s.indexOf("{$root}")>-1&&(t.symbol.url=s.replace(W$2,e.$root))}))}Ke(t){if(!this.He)return!1;for(let e=0,s=this.He.length;e<s;e++)if(!0===this.He[e].filter({properties:t.getProperties()})){const s=this.He[e].symbol;return t.le("url",s.url),t.updateSymbol(s),!0}return!1}Ye(t){if(this.He)for(let e=0,s=this.He.length;e<s;e++)!0===this.He[e].filter({properties:t.getProperties()})&&this.He[e].outline&&t.outline()}removeGeometry(t){this.Oe(),super.removeGeometry(t)}getMapEvents(){return this.mapEvents}ye(e){const s=t__namespace.Util.isString(e)?this.qe[e].I():e.I(),n=this.getRenderer();n&&n.te(s),delete this.De[s],delete this.qe[e]}clear(){return super.clear(),this.De={},this.qe={},this}o(){return this.De}se(t,e,s){const n=this.getRenderer();return n?n.se(t,e,s):null}xt(t){const e=this.getRenderer();return e?e.xt(t):null}We(t){if(!this.options.markerEvents)return;const e=this.getMap();if(!e)return;this.Ze=this.$e,this.Qe=this.ts,this.es=this.ss,this.ns=this.rs;const s=t.containerPoint,n=Math.round(s.x),i=Math.round(s.y);if(n<=0||n>=e.width||i<=0||i>=e.height)return this.$e=null,this.ss=null,void(this.ts=null);const r=this.se(n,i);if(!r)return;r.coordinate=t.coordinate,this.$e=r.target?r.target.I():null,this.ss=r.meshId,this.ts=JSON.stringify(r.point),this.rs=r.pickingId;const o=t.type.replace("dom:","");"mousemove"===o?this.os().forEach((t=>{t.target.fire(t.type,t)})):r.target&&r.target.fire(o,r)}os(){const t=[];return x$4(this.$e)&&!x$4(this.Ze)?t.push({type:"mouseenter",target:this.De[this.$e],meshId:this.ss,pickingId:this.rs,point:JSON.parse(this.ts)}):!x$4(this.$e)&&x$4(this.Ze)?t.push({type:"mouseout",target:this.De[this.Ze],meshId:this.es,pickingId:this.ns,point:JSON.parse(this.Qe)},{type:"mouseleave",target:this.De[this.Ze],meshId:this.es,pickingId:this.ns,point:JSON.parse(this.Qe)}):x$4(this.$e)&&x$4(this.Ze)&&(this.$e===this.Ze?t.push({type:"mousemove",target:this.De[this.$e],meshId:this.ss,pickingId:this.rs,point:JSON.parse(this.ts)}):t.push({type:"mouseenter",target:this.De[this.$e],meshId:this.ss,pickingId:this.rs,point:JSON.parse(this.ts)},{type:"mouseout",target:this.De[this.Ze],meshId:this.es,pickingId:this.ns,point:JSON.parse(this.Qe)},{type:"mouseleave",target:this.De[this.Ze],meshId:this.es,pickingId:this.ns,point:JSON.parse(this.Qe)})),t}A(t){const e=this.getRenderer();e&&e.A(t)}outlineBatch(t){const e=this.Ge.style?this.Ge.style:this.Ge;e[t].outline=!0,this.He=compileStyle(e),this._geoList.forEach((t=>{this.Ye(t)}))}outlineAll(){this._geoList.forEach((t=>{t.outline()}))}cancelOutline(){this.Ge&&(this.Ge.style?this.Ge.style:this.Ge).forEach((t=>{delete t.outline})),this._geoList.forEach((t=>{t.cancelOutline()}))}}Y$1.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,markerEvents:!0,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0});class Z$2 extends Y$1{static initDefaultShader(){const t={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",extraCommandProps:{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new ie$4};Z$2.registerShader("phong","PhongShader",t.shader,t.material.getUniforms());const e={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",extraCommandProps:{cull:{enable:!1,face:"back"},frontFace:"cw",blend:{enable:!1,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new ne$4};Z$2.registerShader("wireframe","WireframeShader",e.shader,e.material.getUniforms());const s={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",tangentAttribute:"TANGENT",colorAttribute:"COLOR_0",uv0Attribute:"TEXCOORD_0",uv1Attribute:"TEXCOORD_1",extraCommandProps:{cull:{enable:!0},frontFace:"ccw",blend:{enable:(t,e)=>!!e.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}},material:new ur$4.StandardMaterial({})};Z$2.registerShader("pbr","pbr.StandardShader",s.shader,s.material.getUniforms()),Z$2.registerShader("depth","pbr.StandardDepthShader",s.shader,s.material.getUniforms());const n={shader:{positionAttribute:"POSITION",color0Attribute:"COLOR_0",extraCommandProps:{blend:{enable:!1,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new ee$3};Z$2.registerShader("pointline","PointLineShader",n.shader,n.material.getUniforms())}static fromJSON(t){if(!t||"GLTFLayer"!==t.type)return null;const e=new Z$2(t.id,t.options),s=t.geometries,n=[];for(let t=0;t<s.length;t++){const e=G$2.parseJSONData(s[t]);e&&n.push(e)}return e.addGeometry(n),t.style&&e.setStyle(t.style),e}onAdd(){const t=this.getMap();t.on(this.mapEvents,this.We,this),this._geoList.forEach((e=>{x$4(e.getZoomOnAdded())||e.setZoomOnAdded(t.getZoom())})),super.onAdd()}onRemove(){super.onRemove(),this.clear()}remove(){const t=this.getMap();if(!t)return;const e=this.mapEvents.replace(" "," dom:");t.off("dom:"+e,this.We,this),super.remove()}identify(e,s){const n=this.getMap();if(!n)return[];const i=n.coordinateToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(i,s)}identifyAtPoint(t,e){const s=this.getMap();if(!s)return[];const n=s.getDevicePixelRatio(),o=this.se(t.x*n,t.y*n,e);return o&&o.target?[{data:o.target,point:o.point}]:[]}hs(){const t=this.getRenderer();t?this.cs(t.gltfScenes):this.on("renderercreate",(t=>{this.cs(t.renderer.gltfScenes)}))}cs(t){this.pickingId=0;for(const e in this.De){const s=this.De[e],n=t[e],i=s.I();delete this.De[i],delete t[i],s.Ae(this.pickingId),this.De[this.pickingId]=s,t[this.pickingId]=n;const r=s.getCount();this.pickingId+=r}}}Z$2.initDefaultShader(),Z$2.mergeOptions({marekrTypes:["gltfmarker","multigltfmarker"],pointSize:1}),Z$2.registerJSONType("GLTFLayer"),Z$2.registerRenderer("gl",q$2);const $$2=[1,1,1,1],Q$2=[],tt$1=[];class et$1 extends G$2{constructor(t,e){super(null,e),this.us=t,this.ls=[],this.oe="multigltfmarker"}static fromJSON(t){return new et$1(t.data,t.options)}setCoordinates(t){return this.fs=Array.isArray(t[0])?t.map((t=>new t$2.Coordinate(t))):t,this.updateAllData("coordinates",this.fs),this.ae=!0,this}getCoordinates(t){if(t&&this.us&&this.us.length){return this.us[t.index].coordinates}return null}addData(t){this.us.push(t);const e=this.getLayer();return e&&e.hs(),this.ae=!0,this}removeData(t){return this.us.splice(t,1),this.gt&&this.ls.splice(t,1),this.ae=!0,this}getData(t){return this.us[t]}updateData(t,e,s){return this.us[t][e]=s,this.ae=!0,this}updateAllData(t,e){for(let s=0;s<this.us.length;s++)this.updateData(s,t,e[s]);return this}gt(){if(this.us){this.ls=this.ls||[];for(let t=0;t<this.us.length;t++){const e=this.ds(t);this.ls[t]=e}}}ds(t){const e=this.us[t],s=this.xe(e.coordinates),n=add$4(Q$2,e.translation||this.he.translation,s||this.he.translation),i=e.rotation||this.he.rotation,r=e.scale||this.he.scale,o=fromEuler(tt$1,i[0]||0,i[1]||0,i[2]||0);return fromRotationTranslationScale(this.ls[t]||[],o,n,r)}Gt(){super.Gt(),this.gt()}ps(){this.gs&&this.gs.instance_vectorA.length/4===this.ls.length||(this.gs={instance_vectorA:[],instance_vectorB:[],instance_vectorC:[],instance_color:[],aPickingId:[]});for(let t=0;t<this.ls.length;t++){const e=this.ls[t];this.ys("instance_vectorA",t,e,0),this.ys("instance_vectorB",t,e,1),this.ys("instance_vectorC",t,e,2);const s=this.us[t].color||$$2;this.gs.instance_color[4*t]=s[0],this.gs.instance_color[4*t+1]=s[1],this.gs.instance_color[4*t+2]=s[2],this.gs.instance_color[4*t+3]=s[3],this.gs.aPickingId[t]=this.I()+t}return this.gs}ys(t,e,s,n){this.gs[t][4*e]=s[n],this.gs[t][4*e+1]=s[n+4],this.gs[t][4*e+2]=s[n+8],this.gs[t][4*e+3]=s[n+12]}yt(t){return this.ae?this.ps(t):this.gs}getCount(){return this.us.length}toJSON(){const t=JSON.parse(JSON.stringify({data:this.us,options:this.options})),e=this.getProperties();return t.options&&(t.options.properties=e),t}getIndexByPickingId(t){return t-this.I()}}const st$1=new je$4({url:void 0,mag:"linear"});class nt$1 extends q$2{constructor(t){super(t),this._textureMap={}}Ue(t){return this.regl&&this._textureMap[t]?this._textureMap[t].texture.getREGLTexture(this.regl):st$1}Re(t){if(this._textureMap[t])this._textureMap[t].count++;else{this.bs=this.bs||new ve$4;const s=new je$4({url:"default"===t?void 0:t,mag:"linear"},this.bs);s.once("complete",(()=>{this.setToRedraw()}),this),this._textureMap[t]={count:1,texture:s}}}Le(t){this._textureMap[t]&&(this._textureMap[t].count--,this._textureMap[t].count<1&&(this._textureMap[t].texture.dispose(),delete this._textureMap[t]))}}class it$1 extends Y$1{static initDefaultShader(){const t={shader:{vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform vec2 uvOffset;\n        uniform float width;\n        uniform float height;\n        varying vec2 vTexCoords;\n        void main()\n        {\n            gl_Position = projViewMatrix * modelMatrix * vec4(aPosition, 1.0);\n            vTexCoords = (uvOffset + aTexCoord) * vec2(1.0 / width, 1.0 / height);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D texture;\n\n        varying vec2 vTexCoords;\n        void main() {\n            vec4 color = texture2D(texture, vTexCoords);\n            gl_FragColor = vec4(color.rgb, color.a) * color.a;\n        }\n    ",positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},material:new ee$3};it$1.registerShader("effect","MeshShader",t.shader,t.material.getUniforms())}onAddGeometry(t){super.onAddGeometry(t);const e=t.getTextureUrl(),s=this.getRenderer();s?s.Re(e):this.on("renderercreate",(t=>{t.renderer.Re(e)}))}remove(){const t=this.getRenderer();t&&this._geoList.forEach((e=>{const s=e.getTextureUrl();t.Le(s)})),super.remove()}clear(){const t=this.getRenderer();t&&this._geoList.forEach((e=>{const s=e.getTextureUrl();t.Le(s)})),super.clear()}getTextureMapTest(){const t=this.getRenderer();return t?t._textureMap:null}}it$1.initDefaultShader(),it$1.mergeOptions({marekrTypes:["effectmarker"]}),it$1.registerJSONType("EffectLayer"),it$1.registerRenderer("gl",nt$1);class rt$1 extends G$2{constructor(t,e){super(t,e),this.oe="glowmarker"}static fromJSON(t){return new rt$1(t.coordinates,t.options)}getUrl(){return"plane"}setSpeed(t){this.setUniform("speed",t)}getSpeed(){return this._getInternalSymbol().uniforms.speed}getShader(){return"glowmarker"}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation}vt(){let t=this._getInternalSymbol().uniforms.time||0;t+=.01,this.setUniform("time",t)}}rt$1.mergeOptions({visible:!0});class ot$1 extends Y$1{static initDefaultShader(){const t=function(){const t={vert:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        attribute vec3 aPosition;\n        uniform mat4 projViewModelMatrix;\n        uniform mat4 modelMatrix;\n        uniform mat4 positionMatrix;\n        varying vec3 v_FragPos;\n        varying vec3 v_center;\n        #include <get_output>\n        void main(){\n            mat4 localPositionMatrix = getPositionMatrix();\n            vec4 localVertex = getPosition(aPosition);\n            vec4 position = localPositionMatrix * localVertex;\n            gl_Position = projViewModelMatrix * position;\n            vec4 worldPos = modelMatrix * position;\n            v_FragPos = worldPos.xyz;\n            v_center = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;\n        }\n    ",frag:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        #define pi 3.14159\n        const float dotsnb = 30.0; // Number of dots\n\n        varying vec3 v_FragPos;\n        varying vec3 v_center;\n        uniform float time;\n        uniform float radius;\n        uniform vec3 color;\n        uniform float speed;\n        vec3 hsb2rgb(in vec3 c)\n        {\n            vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0,0.0,1.0 );\n            rgb = rgb*rgb*(4.0-2.0*rgb);\n            return c.z * mix( vec3(1.0), rgb, c.y);\n        }\n\n        void main()\n        {\n            float r = length(v_FragPos - v_center);\n            r = r*2.-1.;\n            if(r>radius) {\n                gl_FragColor = vec4(1.0,1.0,1.0, 0.0);\n            } else {\n                //vec3 color = hsb2rgb(vec3(fract(time*.1),.7,.4));\n                vec3 color = color;\n                float s = abs(sin(pow(r+5.0, 1.5)-time*speed+sin(r*0.9))*sin(r+.99));\n                color *= (abs(1./(s*10.8))-.01);\n                gl_FragColor = vec4(color, (color.x + color.y + color.z) / 1.0);\n            }\n        }\n    ",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}}],positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]}}};return{shader:t,material:new ee$3}}();ot$1.registerShader("glowmarker","MeshShader",t.shader,t.material.getUniforms())}}ot$1.initDefaultShader(),ot$1.mergeOptions({marekrTypes:["glowmarker"]}),ot$1.registerJSONType("GlowMarkerLayer"),ot$1.registerRenderer("gl",q$2);const at$1={url:"plane",animation:!0,loop:!0,rotation:[0,0,0],translation:[0,0,30],scale:[1,1,30]},ht$1={width:1,height:1,modelHeight:60,startOpacity:0,endOpacity:1};class ut$1 extends Y$1{static initDefaultShader(){const t={shader:{vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform vec2 uvOffset;\n        uniform float width;\n        uniform float height;\n        varying vec2 vTexCoords;\n        varying float vHeight;\n        void main()\n        {\n            vec4 worldPosition = modelMatrix * vec4(aPosition, 1.0);\n            gl_Position = projViewMatrix * worldPosition;\n            vHeight = worldPosition.z;\n            vTexCoords = (uvOffset + aTexCoord) * vec2(1.0 / width, 1.0 / height);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D texture;\n        uniform float modelHeight;\n        uniform float startOpacity;\n        uniform float endOpacity;\n        varying float vHeight;\n        varying vec2 vTexCoords;\n        void main() {\n            vec4 color = texture2D(texture, vTexCoords);\n            float opacity = (endOpacity - startOpacity) * (1.0 - vHeight / modelHeight);\n            gl_FragColor = vec4(color.rgb, color.a) * color.a * opacity;\n        }\n    ",positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},material:new ee$3};ut$1.registerShader("effectline","MeshShader",t.shader)}}ut$1.initDefaultShader(),ut$1.mergeOptions({marekrTypes:["effectmarker"]}),ut$1.registerJSONType("EffectLineLayer"),ut$1.registerRenderer("gl",nt$1);const lt$1={offsetX:0,offsetY:0,uReflectivity:.8,opacity:.9,color:[.9,0,0,1]};class dt$1 extends Y$1{static initDefaultShader(){const t=function(){const t={vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        attribute vec3 aNormal;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform mat4 normalMatrix;\n        uniform float offsetX;\n        uniform float offsetY;\n        varying vec2 uv;\n        void main()\n        {\n            gl_Position = projViewMatrix * modelMatrix * vec4(aPosition, 1.0);\n            uv = vec2(aTexCoord.x + offsetX, aTexCoord.y + offsetY);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D effectTexture;\n        uniform vec3 uCameraPosition;\n        uniform mat4 viewMatrix;\n        uniform float uReflectivity;\n        uniform vec4 color;\n        uniform float opacity;\n\n        varying vec2 uv;\n\n        vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {\n            return normalize((vec4(dir, 0.0) * matrix).xyz);\n        }\n\n        const float GAMMA_FACTOR = 2.0;\n        vec4 GammaToLinear(in vec4 value, in float gammaFactor) {\n            return vec4(pow(value.xyz, vec3(gammaFactor)), value.w);\n        }\n\n        vec4 mixTexelToLinear(vec4 value) {\n            return GammaToLinear(value, float(GAMMA_FACTOR));\n        }\n\n        void main() {\n            vec4 texColor = texture2D(effectTexture, uv);\n            if (color.a == 0.0) {\n                discard;\n            }\n            vec4 mixColor = mixTexelToLinear(color);\n            texColor.rgb += mixColor.xyz * uReflectivity;\n            texColor.a*= opacity;\n            gl_FragColor = texColor;\n        }\n    ",uniforms:[{name:"normalMatrix",type:"function",fn:function(t,e){const s=[];return invert$2(s,e.modelMatrix),transpose(s,s),s}}],positionAttribute:"POSITION",extraCommandProps:{depth:{enable:!0,mask:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}};return{shader:t,material:new ee$3}}();dt$1.registerShader("effectring","MeshShader",t.shader)}}dt$1.initDefaultShader(),dt$1.mergeOptions({marekrTypes:["effectring"]}),dt$1.registerJSONType("EffectRingLayer"),dt$1.registerRenderer("gl",q$2);const mt$1={animation:!0,loop:!0,url:"plane",effect:"sequence",speed:1,scale:[1,1,1],rotation:[90,0,0]},pt$1={width:9,height:5};if(transcoders){const e=t__namespace.Map.VERSION;if(e.indexOf("1.0.0-beta")>=0||e.indexOf("1.0.0-alpha")>=0){const e=transcoders.inject(b$4);t__namespace.registerWorkerAdapter("@maptalks/gltf-layer",e)}else t__namespace.registerWorkerAdapter("@maptalks/gltf-layer",(function(){return transcoders.inject(b$4)}))}else t__namespace.registerWorkerAdapter("@maptalks/gltf-layer",b$4);"undefined"!=typeof console&&console.log("@maptalks/gltf-layer v0.34.1");var zousanMin={exports:{}};!function(module){!function(i){var c,s,u="fulfilled",f="undefined",a=function(){var e=[],n=0;function o(){for(;e.length-n;){try{e[n]()}catch(t){i.console&&i.console.error(t)}e[n++]=s,1024==n&&(e.splice(0,1024),n=0)}}var r=function(){if(typeof MutationObserver===f)return typeof process!==f&&"function"==typeof process.nextTick?function(){process.nextTick(o)}:typeof setImmediate!==f?function(){setImmediate(o)}:function(){setTimeout(o,0)};var t=document.createElement("div");return new MutationObserver(o).observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}();return function(t){e.push(t),e.length-n==1&&r()}}();function l(t){if(!(this instanceof l))throw new TypeError("Zousan must be created with the new keyword");if("function"==typeof t){var e=this;try{t((function(t){e.resolve(t)}),(function(t){e.reject(t)}))}catch(t){e.reject(t)}}else if(0<arguments.length)throw new TypeError("Zousan resolver "+t+" is not a function")}function h(e,t){if("function"==typeof e.y)try{var n=e.y.call(s,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.resolve(t)}function v(e,t){if("function"==typeof e.n)try{var n=e.n.call(s,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.reject(t)}l.prototype={resolve:function(n){if(this.state===c){if(n===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var o=this;if(n&&("function"==typeof n||"object"==typeof n))try{var e=!0,t=n.then;if("function"==typeof t)return void t.call(n,(function(t){e&&(e=!1,o.resolve(t))}),(function(t){e&&(e=!1,o.reject(t))}))}catch(t){return void(e&&this.reject(t))}this.state=u,this.v=n,o.c&&a((function(){for(var t=0,e=o.c.length;t<e;t++)h(o.c[t],n)}))}},reject:function(n){if(this.state===c){var t=this;this.state="rejected",this.v=n;var o=this.c;a(o?function(){for(var t=0,e=o.length;t<e;t++)v(o[t],n)}:function(){t.handled||!l.suppressUncaughtRejectionError&&i.console&&l.warn("You upset Zousan. Please catch rejections: ",n,n?n.stack:null)})}},then:function(t,e){var n=new l,o={y:t,n:e,p:n};if(this.state===c)this.c?this.c.push(o):this.c=[o];else{var r=this.state,i=this.v;this.handled=!0,a((function(){r===u?h(o,i):v(o,i)}))}return n},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,o){o=o||"Timeout";var r=this;return new l((function(e,n){setTimeout((function(){n(Error(o))}),t),r.then((function(t){e(t)}),(function(t){n(t)}))}))}},l.resolve=function(t){var e=new l;return e.resolve(t),e},l.reject=function(t){var e=new l;return e.c=[],e.reject(t),e},l.all=function(n){var o=[],r=0,i=new l;function t(t,e){t&&"function"==typeof t.then||(t=l.resolve(t)),t.then((function(t){o[e]=t,++r==n.length&&i.resolve(o)}),(function(t){i.reject(t)}))}for(var e=0;e<n.length;e++)t(n[e],e);return n.length||i.resolve(o),i},l.warn=console.warn,module.exports&&(module.exports=l),i.define&&i.define.amd&&i.define([],(function(){return l})),(i.Zousan=l).soon=a}(commonjsGlobal)}(zousanMin);var i="undefined"!=typeof Promise?Promise:zousanMin.exports;
/*!
	 * @maptalks/gltf-loader v0.11.2
	 * LICENSE : UNLICENSED
	 * (c) 2016-2021 maptalks.org
	 */function a$1(e){return null==e}function o(e){return!a$1(e)}function u$1(e){for(let t=1;t<arguments.length;t++){const s=arguments[t];for(const t in s)e[t]=s[t]}return e}function f$3(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+e)}function h$1(e){return 0===e.indexOf("data:")&&e.indexOf("base64,")>0}function c$1(e){const t=e.substring(e.indexOf(",")+1),s=window.atob(t),r=s.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=s.charCodeAt(e);return n.buffer}const l$2={get:function(e,t){const s=l$2._getClient(),r=new i(((r,n)=>{if(s.open("GET",e,!0),t){for(const e in t.headers)s.setRequestHeader(e,t.headers[e]);s.withCredentials="include"===t.credentials,t.responseType&&(s.responseType=t.responseType)}s.onreadystatechange=l$2._wrapCallback(s,(function(e,t){e?n(e):r(t)})),s.send(null)}));return r.xhr=s,r},_wrapCallback:function(e,t){return function(){if(4===e.readyState)if(200===e.status)"arraybuffer"===e.responseType?0===e.response.byteLength?t(new Error("http status 200 returned without content.")):t(null,{data:e.response,cacheControl:e.getResponseHeader("Cache-Control"),expires:e.getResponseHeader("Expires"),contentType:e.getResponseHeader("Content-Type")}):t(null,e.responseText);else{if(0===e.status)return;t(new Error(e.statusText+","+e.status))}}},_getClient:function(){let e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return e},getArrayBuffer:(e,t)=>(t||(t={}),t.responseType="arraybuffer",l$2.get(e,t)),getJSON:function(e,t){const s=l$2.get(e,t),r=s.then((e=>e?JSON.parse(e):null));return r.xhr=s.xhr,r}};class g$2{constructor(e,t,s){this.rootPath=e,this.gltf=t,this.requests={},this.buffers={},this.glbBuffer=s}iterate(e,t){const s=this.gltf[t];if(!s)return;let r=0;for(const t in s)e(t,s[t],r++)}createNode(e){const t={};return o(e.name)&&(t.name=e.name),o(e.children)&&(t.children=e.children),o(e.jointName)&&(t.jointName=e.jointName),o(e.matrix)&&(t.matrix=e.matrix),o(e.rotation)&&(t.rotation=e.rotation),o(e.scale)&&(t.scale=e.scale),o(e.translation)&&(t.translation=e.translation),o(e.extras)&&(t.extras=e.extras),o(e.meshes)&&(t.mesh=e.meshes[0]),t}_loadMaterials(e){const t={};for(const s in e){const r=e[s];let n;const a={baseColorTexture:{index:r.instanceTechnique&&r.instanceTechnique.values?(n=r.instanceTechnique).values.diffuse:(n=r).values.tex||n.values.diffuseTex||n.values.diffuse}};r.name&&(a.name=r.name),r.extensions&&(a.extensions=r.extensions),r.extras&&(a.extras=r.extras),t[s]=a}return t}_loadImage(e){if(e.bufferView||e.extensions&&(e.extensions.KHR_binary_glTF||e.extensions.binary_glTF)){const t=e.bufferView?e:e.extensions.KHR_binary_glTF||e.extensions.binary_glTF;if(e.extensions&&(e.mimeType=t.mimeType,e.width=t.width,e.height=t.height),this.buffers[t.bufferView])return Promise.resolve(this.buffers[t.bufferView]);const s=this.gltf.bufferViews[t.bufferView],i=this.buffers[t.bufferView]=new Uint8Array(this.glbBuffer.buffer,(s.byteOffset||0)+this.glbBuffer.byteOffset,s.byteLength);return Promise.resolve(i)}{const s=this.rootPath+"/"+e.uri;return this.requests[s]?this.requests[s].then((()=>this.buffers[s])):this.requests[s]=l$2.getArrayBuffer(s,null).then((e=>{const t=e.data;return this.buffers[s]=t,new Uint8Array(t)}))}}_getTexture(e){const t=this.gltf.textures[e];if(!t)return null;const s=this.gltf.images[t.source];return this._loadImage(s).then((e=>({image:{array:e,width:s.width,height:s.height,index:t.source,mimeType:s.mimeType,name:s.name,extras:s.extras},type:t.type||5121,sampler:this.gltf.samplers[t.sampler],format:t.format||6408,internalFormat:t.internalFormat||6408})))}getBaseColorTexture(e){const t=this.gltf.materials[e];let s,r;if(void 0===(r=t.instanceTechnique&&t.instanceTechnique.values?(s=t.instanceTechnique).values.diffuse:(s=t).values.tex||s.values.diffuseTex||s.values.diffuse)||void 0===this.gltf.textures)return null;const n=this.gltf.textures[r];if(!n)return null;return{format:n.format||6408,internalFormat:n.internalFormat||6408,type:n.type||5121,sampler:this.gltf.samplers[n.sampler],source:this.gltf.images[n.source]}}getMaterial(){return null}getAnimations(){return null}}const m$3=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16];class d$3{constructor(e,t,s,r){this.rootPath=e,this.gltf=t,this.glbBuffer=s,this.buffers={},this.requests={},this.accessors={},this.ignoreGLBOffset=r}_requestData(e,t){const s=this.gltf,r=s.accessors[t];if(void 0===r.bufferView)return this.accessors[r.id]=this._toBufferData(e,t,null,0),i.resolve(this.accessors[r.id]);const n=s.bufferViews[r.bufferView],a=s.buffers[n.buffer];if(this.accessors[r.id])return i.resolve(this.accessors[r.id]);if(this.buffers[a.id]){const r=this._toBufferData(e,t,this.buffers[a.id]);return i.resolve(r)}if(this.requests[a.id])return this.requests[a.id].then((()=>this._toBufferData(e,t,this.buffers[a.id])));if("binary_glTF"!==n.buffer&&"KHR_binary_glTF"!==n.buffer&&a.uri){if(h$1(a.uri)){const s=this.buffers[a.id]=c$1(a.uri),n=this.accessors[r.id]=this._toBufferData(e,t,s);return i.resolve(n)}return this.requests[a.id]=l$2.getArrayBuffer(this.rootPath+"/"+a.uri,null).then((s=>{const n=this.buffers[a.id]=s.data;return this.accessors[r.id]=this._toBufferData(e,t,n)}))}{const s=this.accessors[r.id]=this._toBufferData(e,t,this.glbBuffer.buffer,this.ignoreGLBOffset?0:this.glbBuffer.byteOffset);return i.resolve(s)}}_toBufferData(e,t,s,r=0){const n=this.gltf,i=n.accessors[t],a=void 0!==i.bufferView?n.bufferViews[i.bufferView]:{},o=(a.byteOffset||0)+r,u=this._getTypeItemSize(i.type),h=f$3(i.componentType);let l=a.byteStride||0;l===h.BYTES_PER_ELEMENT*u&&(l=0);const g={array:void 0,name:e,accessorName:t,bufferView:i.bufferView,byteOffset:l&&i.byteOffset||0,byteStride:l,byteLength:i.count*u*h.BYTES_PER_ELEMENT,componentType:i.componentType,count:i.count,type:i.type,itemSize:u};if(i.min&&(g.min=i.min),i.max&&(g.max=i.max),s)if(r=o+(i.byteOffset||0),0===l)r%h.BYTES_PER_ELEMENT!=0&&(s=s.slice(o,o+i.count*u*h.BYTES_PER_ELEMENT),r=0),g.array=new h(s,r,u*i.count);else{const e=[];for(let t=0;t<i.count;t++){const n=s.slice(r+l*t,r+l*t+u*h.BYTES_PER_ELEMENT);e.push(n)}const t=this.concatenate(h,e);g.array=new h(t,0,u*i.count)}else{g.array=new h(i.count);const e=g.min||g.max;e&&(g.array[0]=e[0],g.array[1]=e[1],g.array[2]=e[2])}return delete g.bufferView,g}concatenate(e,t){let s=0;for(const r of t)s+=r.byteLength/e.BYTES_PER_ELEMENT;const r=new e(s);let n=0;for(const s of t){const t=new e(s);r.set(t,n),n+=s.byteLength/e.BYTES_PER_ELEMENT}return r.buffer}_getTypeItemSize(e){const t=m$3.indexOf(e);return m$3[t+1]}}class p$3{constructor(e,t,s,r,n){this.rootPath=e,this.gltf=t,this.glbBuffer=s,this.images={},this.buffers={},this.requests={},this._requestImage=r,this.accessor=new d$3(e,t,s),this.imageDecoders=n}iterate(e,t){const s=this.gltf[t];if(s)for(let t=0;t<s.length;t++)e(t,s[t],t)}createNode(e){const t={};return u$1(t,e),t.weights=!o(e.weights)&&this.gltf.meshes&&o(t.mesh)?this.gltf.meshes[t.mesh].weights:e.weights,t}_getTexture(e){const t=this.gltf.textures[e];if(!t)return null;const s=this.gltf.images[t.source];return this._loadImage(s).then((e=>{const r={image:{array:e.data,width:e.width,height:e.height,index:t.source,mimeType:s.mimeType,name:s.name,extensions:s.extensions,extras:s.extras}};u$1(r,t);const n=o(t.sampler)?this.gltf.samplers[t.sampler]:void 0;return n&&(r.sampler=n),e.format&&(r.format=e.format),r}))}_loadImage(e){if(!o(e.bufferView))return this._requestFromImage(e);{const t=this.gltf.bufferViews[e.bufferView];if(this.images[e.id])return i.resolve(this.images[e.id]);const s=this.gltf.buffers[t.buffer];if(s.uri)return this._requestFromBuffer(s,t,e);if(this.glbBuffer)return this._requestFromGlbBuffer(t,e)}return null}_requestFromImage(e){const t=0===e.uri.indexOf("data:image/")?e.uri:this.rootPath+"/"+e.uri;return this.requests[e.id]?this.requests[e.id].then((()=>this.images[e.id])):this.requests[e.id]=this._getImageInfo(e.id,t)}_requestFromBuffer(e,t,s){const r=s.id;if(this.buffers[e.id]){const i=this._createDataView(t,this.buffers[e.id]),a=new Blob([i],{type:s.mimeType}),o=URL.createObjectURL(a);return this._getImageInfo(r,o)}if(this.requests[e.id])return this.requests[e.id].then((()=>{const i=this._createDataView(t,this.buffers[e.id]),a=new Blob([i],{type:s.mimeType}),o=URL.createObjectURL(a);return this._getImageInfo(r,o)}));if(h$1(e.uri)){const n=this.buffers[e.id]=c$1(e.uri),i=this._createDataView(t,n),a=new Blob([i],{type:s.mimeType}),o=URL.createObjectURL(a);return this._getImageInfo(r,o)}return this.requests[e.id]=l$2.getArrayBuffer(e.uri,null).then((n=>{const i=this.buffers[e.id]=n.data,a=this._createDataView(t,i),o=new Blob([a],{type:s.mimeType}),u=URL.createObjectURL(o);return this._getImageInfo(r,u)}))}_requestFromGlbBuffer(e,t){const s=this._createDataView(e,this.glbBuffer.buffer),r=this.imageDecoders;if(r[t.mimeType])return i.resolve(r[t.mimeType](s));const n=new Blob([s],{type:t.mimeType}),a=URL.createObjectURL(n);return this._getImageInfo(t.bufferView,a)}_getImageInfo(e,t){return new i(((s,r)=>{this._requestImage(t,((t,n)=>{t?r(t):(this.images[e]=n,s(this.images[e]))}))}))}_createDataView(e,t,s){s=s||0;return new Uint8Array(t,e.byteOffset+s,e.byteLength)}_transformArrayBufferToBase64(e,t){const s=new Array(e.byteLength);for(let t=0;t<e.byteLength;t++)s[t]=String.fromCharCode(e[t]);return s.join(""),"data:"+(t=t||"image/png")+";base64,"+window.btoa(unescape(encodeURIComponent(s)))}getAnimations(e){const t=[];return e.forEach((e=>{t.push(this.getSamplers(e.samplers))})),i.all(t).then((t=>{for(let s=0;s<t.length;s++)e[s].samplers=t[s];return e}))}getSamplers(e){const t=[];for(let s=0;s<e.length;s++)(o(e[s].input)||o(e[s].output))&&(t.push(this.accessor._requestData("input",e[s].input)),t.push(this.accessor._requestData("output",e[s].output)));return i.all(t).then((t=>{for(let s=0;s<t.length/2;s++)e[s].input=t[2*s],e[s].output=t[2*s+1],e[s].interpolation||(e[s].interpolation="LINEAR");return e}))}}const b$3="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null,_$3_JSON=1313821514,_$3_BIN=5130562;class T$3{static read(e,t=0){const s=new DataView(e,t),r=s.getUint32(4,!0);if(1===r)return T$3.readV1(s,t);if(2===r)return T$3.readV2(e,t);throw new Error("Unsupported glb version : "+r)}static readV1(e,t){const s=e.getUint32(8,!0),r=e.getUint32(12,!0);if(s!==e.buffer.byteLength-t)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const n=w$3(e.buffer,20+t,r);return{json:JSON.parse(n),glbBuffer:{byteOffset:20+t+r,buffer:e.buffer}}}static readV2(e,t){let s,r;const n=new DataView(e,t+12);let i=0;for(;i<n.byteLength;){const a=n.getUint32(i,!0);i+=4;const o=n.getUint32(i,!0);if(i+=4,o===_$3_JSON)s=w$3(e,t+12+i,a);else if(o===_$3_BIN){const s=t+12+i;r=e.slice(s,s+a)}i+=a}return{json:JSON.parse(s),glbBuffer:{byteOffset:t,buffer:r}}}}function w$3(e,t,s){if(b$3){const r=new Uint8Array(e,t,s);return b$3.decode(r)}return function(e){const t=e.length;let s="";for(let r=0;r<t;){let n=e[r++];if(128&n){let s=E$3[n>>3&7];if(!(64&n)||!s||r+s>t)return null;for(n&=63>>s;s>0;s-=1){const t=e[r++];if(128!=(192&t))return null;n=n<<6|63&t}}s+=String.fromCharCode(n)}return s}(new Uint8Array(e,t,s))}const E$3=[1,1,1,1,2,2,3,0],x$3=[0,0,0],I$2=[0,0,0,1],N$3=[1,1,1],O$3={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},S$3={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},A$1={_getTRSW(e,r,n,i,a,u,f,h){const c=o(e)?r.animations:[r.animations[0]],l={};for(let r=0;r<c.length;r++){const g=c[r];if(o(e)&&g.name!==e)continue;const m=g.channelsMap[n];if(m)for(let e=0;e<m.length;e++){const r=m[e];"translation"===r.target.path?(this._getAnimateData(a,g.samplers[r.sampler],i,1),l.translation=copy$4(x$3,a)):"rotation"===r.target.path?(this._getQuaternion(u,g.samplers[r.sampler],i,1),l.rotation=copy$2(I$2,u)):"scale"===r.target.path?(this._getAnimateData(f,g.samplers[r.sampler],i,1),l.scale=copy$4(N$3,f)):"weights"===r.target.path&&h&&(this._getAnimateData(h,g.samplers[r.sampler],i,h.length),l.weights=h)}}return l},_getAnimateData(e,t,s,r){switch(t.interpolation){case"LINEAR":{const n=this._getPreNext(S$3,t,s,1*r);n&&(e=function(e,t,s,r){for(let n=0;n<e.length;n++)e[n]=t[n]+r*(s[n]-t[n]);return e}(e,n.PREVIOUS,n.NEXT,n.INTERPOLATION));break}case"STEP":{const n=this._getPreNext(S$3,t,s,1*r);n&&(e=function(e,t){for(let s=0;s<e.length;s++)e[s]=t[s];return e}(e,...n.PREVIOUS));break}case"CUBICSPLINE":{const n=this._getPreNext(S$3,t,s,3*r);n&&(e=this._getCubicSpline(e,n,t.input.array,3*r));break}}return e},_getQuaternion(e,t,n){switch(t.interpolation){case"LINEAR":{const r=this._getPreNext(S$3,t,n,1);r&&slerp(e,r.PREVIOUS,r.NEXT,r.INTERPOLATION);break}case"STEP":{const s=this._getPreNext(S$3,t,n,1);s&&(e=set$3(e,...s.PREVIOUS));break}case"CUBICSPLINE":{const s=this._getPreNext(S$3,t,n,3);if(s){for(let e=0;e<s.PREVIOUS.length;e++)s.PREVIOUS[e]=Math.acos(s.PREVIOUS[e]),s.NEXT[e]=Math.acos(s.NEXT[e]);e=this._getCubicSpline(e,s,t.input.array,3);for(let t=0;t<e.length;t++)e[t]=Math.cos(e[t])}break}}return e},_search(e,t){const s=e.length;let a=0,o=s-1,u=Math.floor((a+o)/2);for(;a<=s-1&&o>=0;){if(a===o)return null;if(e[u]<=t&&t<=e[u+1]){const s=e[u];return{preIndx:u,nextIndex:u+1,interpolation:(t-s)/(e[u+1]-s)}}t<e[u]?(o=u,u=Math.floor((a+o)/2)):e[u+1]<t&&(a=u,u=Math.floor((a+o)/2))}return null},_getPreNext(e,t,s,r){const n=t.input.array,i=t.output.array,a=t.output.itemSize;(s<n[0]||s>n[n.length-1])&&(s=Math.max(n[0],Math.min(n[n.length-1],s))),s===n[n.length-1]&&(s=n[0]);const o=this._search(n,s);if(!o||!o.nextIndex)return null;const{preIndx:u,nextIndex:f,interpolation:h}=o;e.PREINDEX=u,e.NEXTINDEX=f,e.INTERPOLATION=h;const c=a*r;return e.PREVIOUS=i.subarray(e.PREINDEX*c,(e.PREINDEX+1)*c),e.NEXT=i.subarray(e.NEXTINDEX*c,(e.NEXTINDEX+1)*c),e},_getCubicSpline(e,t,s,r){const n=t.INTERPOLATION,i=s[t.PREINDEX],a=s[t.NEXTINDEX];for(let s=0;s<3;s++){const o=t.PREVIOUS[r+s],u=(a-i)*t.PREVIOUS[2*r+s],f=t.NEXT[3+s],h=(a-i)*t.NEXT[s],c=(2*Math.pow(n,3)-3*Math.pow(n,2)+1)*o+(Math.pow(n,3)-2*Math.pow(n,2)+n)*u+(2*-Math.pow(n,3)+3*Math.pow(n,2))*f+(Math.pow(n,3)-Math.pow(n,2))*h;e[s]=c}return e},getAnimationClip(e,s,n,i){const a=e.nodes[s]&&e.nodes[s].weights;return set$4(x$3,...O$3.TRANSLATION),set$3(I$2,...O$3.ROTATION),set$4(N$3,...O$3.SCALE),this._getTRSW(i,e,s,n,x$3,I$2,N$3,a)},getTimeSpan(e){if(!e.animations)return null;if(e.timeSpan)return e.timeSpan;const t=e.animations;return e.timeSpan={},t.forEach(((t,s)=>{let r=-1/0,n=1/0;const i=t.channels;for(let e=0;e<i.length;e++){const a=t.samplers[i[e].sampler].input.array;a[a.length-1]>r&&(r=a[a.length-1]),a[0]<n&&(n=a[0])}e.timeSpan[t.name||s]={max:r,min:n}})),e.timeSpan},getTimeSpanByName(e,t){const s=this.getTimeSpan(e);return s?o(t)?s[t]:s[Object.keys(s)[0]]:null}},R$3="undefined"==typeof document?null:document.createElement("canvas");class B$3{constructor(e,t,s){if(this.options=s||{},t.buffer instanceof ArrayBuffer){const{json:s,glbBuffer:r}=T$3.read(t.buffer,t.byteOffset);this._init(e,s,r)}else this._init(e,t)}load(){const e=this._loadScene(),t=this._loadAnimations(),s=this._loadTextures();return i.all([e,t,s]).then((e=>(e[0].animations=e[1],e[0].textures=e[2],this.createChannelsMap(e[0]),e[0])))}createChannelsMap(e){const t=e.animations;if(t)for(let e=0;e<t.length;e++){const s=t[e];s.channelsMap={};for(let e=0;e<s.channels.length;e++){const t=s.channels[e];s.channelsMap[t.target.node]||(s.channelsMap[t.target.node]=[]),s.channelsMap[t.target.node].push(t)}}}getExternalResources(){const e=[];if(this.gltf){const{buffers:t,images:s}=this.gltf;for(let s=0;s<t.length;s++)t[s].uri&&t[s].uri.indexOf("data:application/octet-stream;base64")<0&&e.push({type:"buffer",uri:t[s].uri});for(let t=0;t<s.length;t++)s[t].uri&&s[t].uri.indexOf("data:image/")<0&&e.push({type:"image",uri:s[t].uri})}return e}static getAnimationClip(e,t,s,r){return A$1.getAnimationClip(e,t,s,r)}static getAnimationTimeSpan(e,t){return A$1.getTimeSpanByName(e,t)}static getTypedArrayCtor(e){return f$3(e)}_init(e,t,s){this.gltf=t,this.version=t.asset?+t.asset.version:1,this.rootPath=e,this.glbBuffer=s,this.buffers={},this.requests={},this.options.requestImage=this.options.requestImage||P$3,this.options.transferable&&(this.transferables=[]),2===this.version?(this.accessor=new d$3(e,t,s,!0),this.adapter=new p$3(e,t,s,this.options.requestImage,this.options.imageDecoders||{}),this.adapter.iterate(((e,t,s)=>{t.id="buffer_"+s}),"buffers"),this.adapter.iterate(((e,t,s)=>{t.id="image_"+s}),"images"),this.adapter.iterate(((e,t,s)=>{t.id="accessor_"+s}),"accessors")):(this.accessor=new d$3(e,t,s),this.adapter=new g$2(e,t,s),this.adapter.iterate(((e,t,s)=>{t.id="accessor_"+s}),"accessors"))}_parseNodes(e,t){if(e.children&&e.children.length>0){if(!("number"==typeof(s=e.children[0])&&isFinite(s)||function(e){return!a$1(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}(e.children[0])))return e;const r=e.children.map((e=>{const s=t[e];return s.nodeIndex=e,this._parseNodes(s,t)}));e.children=r}var s;return e}_loadScene(){return this._loadNodes().then((e=>{const t=this.scenes=[];let s;for(const t in e)e[t]=this._parseNodes(e[t],e),e[t].nodeIndex=Number(t)?Number(t):t;this.adapter.iterate(((r,n,i)=>{const a={};n.name&&(a.name=n.name),n.nodes&&(a.nodes=n.nodes.map((t=>e[t]))),this.gltf.scene===r&&(s=i),t.push(a)}),"scenes");const r={asset:this.gltf.asset,scene:s,scenes:t,nodes:e,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const e=this.adapter._loadMaterials(this.gltf.materials);r.materials=e}return r}))}_loadNodes(){return this._loadMeshes().then((()=>{const e=this.nodes={};return this.adapter.iterate(((t,s)=>{const r=this.adapter.createNode(s,this.meshes,this.skins);e[t]=r}),"nodes"),e}))}_loadSkins(){this.skins=[];const e=[];return this.adapter.iterate(((t,s,r)=>{e.push(this._loadSkin(s).then((e=>{e.index=r,this.skins.push(e)})))}),"skins"),e}_loadSkin(e){return this.accessor._requestData("inverseBindMatrices",e.inverseBindMatrices).then((t=>(e.inverseBindMatrices=t,e)))}_loadAnimations(){const e=this.gltf.animations;return o(e)?this.adapter.getAnimations(e):null}_loadMeshes(){this.meshes={};let e=[];return this.adapter.iterate(((t,s,r)=>{e.push(this._loadMesh(s).then((e=>{e.index=r,this.meshes[t]=e})))}),"meshes"),e=e.concat(this._loadSkins()),i.all(e)}_loadMesh(e){const t=e.primitives.map((e=>this._loadPrimitive(e)));return i.all(t).then((t=>{const s={};return u$1(s,e),s.primitives=t,s}))}_loadTextures(){const e=this.gltf.textures;if(!e)return null;const t=[];for(const s in e)t.push(this.adapter._getTexture(s));return i.all(t).then((t=>{if(this.transferables)for(let e=0;e<t.length;e++)if(t[e].image.array){const s=t[e].image.array.buffer;this.transferables.indexOf(s)<0&&this.transferables.push(s)}if(!Array.isArray(e)){const s={},r=Object.keys(e);for(let e=0;e<t.length;e++)s[r[e]]=t[e];return s}return t}))}_loadPrimitive(e){const t=[],s=e.attributes;for(const e in s){const r=this.accessor._requestData(e,s[e]);r&&t.push(r)}if(o(e.indices)){const s=this.accessor._requestData("indices",e.indices);s&&t.push(s)}if(o(e.targets))for(let s=0;s<e.targets.length;s++){const r=e.targets[s];for(const e in r){const n=this.accessor._requestData(`morphTargets_${e}_${s}`,r[e]);n&&t.push(n)}}return i.all(t).then((t=>{let s,r;const n={attributes:t.reduce(((e,t)=>("indices"===t.name?s=t:t.name.indexOf("morphTargets_")>-1?(r=r||{})[t.name.slice(13)]=t:e[t.name]=t,this.transferables&&this.transferables.indexOf(t.array.buffer)<0&&this.transferables.push(t.array.buffer),e)),{}),material:e.material};return s&&(n.indices=s),r&&(n.morphTargets=r),n.mode=o(e.mode)?e.mode:4,o(e.extras)&&(n.extras=e.extras),n}))}}function P$3(e,t){const s=new Image;s.crossOrigin="",s.onload=()=>{if(!R$3)return void t(new Error("There is no canvas to draw image!"));R$3.width=s.width,R$3.height=s.height;const e=R$3.getContext("2d");e.drawImage(s,0,0,s.width,s.height);const r=e.getImageData(0,0,s.width,s.height),n={width:s.width,height:s.height,data:new Uint8Array(r.data)};t(null,n)},s.onerror=function(e){t(e)},s.src=e}
/*!
	 * @maptalks/transform-control v0.7.0
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.org
	 */const w$2={yuanhuan:{accessors:[{name:"_1_0_positions",componentType:5126,count:104,min:[-5.407599925994873,-5.404099941253662,0],max:[5.405200004577637,5.406300067901611,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:104,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:288,min:[0],max:[103],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"-",byteLength:3072,uri:"data:application/octet-stream;base64,KVyjQLbzPT4AAAAAZvesQLbzPT4AAAAAhsmqQC7/YT8AAAAAZ0ShQDC7Vz8AAAAA+u2lwGKhxr8AAAAArK2cwLpJvL8AAAAAEFihwB04V78AAAAAXdyqwE7RYb8AAAAAat6lQEaUxj8AAAAAApqcQG+BvD8AAAAAB18EQFOWlcAAAAAA+u0LQLBynsAAAAAARPoxQNSalMAAAAAAJzEoQIxKjMAAAAAAQBNVQFyPiMAAAAAAIEFJQMDsgMAAAAAA0950QK36dMAAAAAAejZnQFRSZ8AAAAAAXdyAQBBYScAAAAAA+n6IQI0oVcAAAAAAcoqUQAMJMsAAAAAAKjqMQIlBKMAAAAAAXdyAQFdbSUAAAAAA+n6IQDsBVUAAAAAA0950QBTQdEAAAAAAejZnQA5PZ0AAAAAA+n6IwI0oVcAAAAAAwOyAwBBYScAAAAAAXkuMwIlBKMAAAAAA0ZGUwAMJMsAAAAAA5j+8P9ejnMAAAAAAkDFXP65HocAAAAAA1JrGPz7opcAAAAAA/7I7PvhTo8AAAAAA/7I7PmPurMAAAAAAM8RhP/vLqsAAAAAADwutwLbzPT4AAAAA0m+jwLbzPT4AAAAAEFihwDC7Vz8AAAAAXdyqwC7/YT8AAAAArK2cwG+BvD8AAAAA+u2lwEaUxj8AAAAADXGewN/gC0AAAAAAa5qVwIV8BEAAAAAAXkuMwAFNKEAAAAAA0ZGUwD7oMUAAAAAAlIeVQIV8BEAAAAAAlWWeQN/gC0AAAAAAcoqUQD7oMUAAAAAAKjqMQAFNKEAAAAAAQBNVQBB6iEAAAAAAIEFJQKfogEAAAAAAW9N0wK36dMAAAAAAsVBnwFRSZ8AAAAAAlWWeQM/3C8AAAAAAlIeVQNxoBMAAAAAA+n6IwDsBVUAAAAAAwOyAwFdbSUAAAAAAsVBnwA5PZ0AAAAAAW9N0wBTQdEAAAAAAd74LwLBynsAAAAAAkxi8v9ejnMAAAAAAwFsEwFOWlcAAAAAARpRWv65HocAAAAAAayvGvz7opcAAAAAA2c43vvhTo8AAAAAA2c43vmPurMAAAAAAt9Fgv/vLqsAAAAAAt9Fgv7fRqkAAAAAAayvGvybkpUAAAAAAd74LwAponkAAAAAA2c43vv5lo0AAAAAA2c43vmkArUAAAAAARpRWvzxOoUAAAAAAkxi8v9ejnEAAAAAAOdYxwHKKlEAAAAAAwFsEwDqSlUAAAAAA+zoowNBEjEAAAAAAJlNJwKfogEAAAAAAUPxUwBB6iEAAAAAAat6lQGKhxr8AAAAAApqcQLpJvL8AAAAAhsmqQE7RYb8AAAAAZ0ShQB04V78AAAAAZvesQP+yO74AAAAAKVyjQP+yO74AAAAAM8RhP7fRqkAAAAAA/7I7PmkArUAAAAAA/7I7Pv5lo0AAAAAA+u0LQAponkAAAAAA1JrGPybkpUAAAAAAkDFXPzxOoUAAAAAA5j+8P9ejnEAAAAAARPoxQHKKlEAAAAAAB18EQDqSlUAAAAAAJzEoQNBEjEAAAAAA+zoowIxKjMAAAAAAOdYxwNSalMAAAAAAUPxUwFyPiMAAAAAAJlNJwMDsgMAAAAAAa5qVwNxoBMAAAAAADXGewM/3C8AAAAAA0m+jwP+yO74AAAAADwutwP+yO74AAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAACAAMABAAFAAYABAAGAAcAAwACAAgAAwAIAAkACgALAAwACgAMAA0ADQAMAA4ADQAOAA8ADwAOABAADwAQABEAEgATABQAEgAUABUAFgAXABgAFgAYABkAGgAbABwAGgAcAB0AHgALAAoAHwALAB4AHwAgAAsAIQAgAB8AIgAjACAAIgAgACEAJAAlACYAJAAmACcAJwAmACgAJwAoACkAKgArACwAKgAsAC0ALgAvADAALgAwADEAGQAYADIAGQAyADMANAA1ABsANAAbABoAFQAUADYAFQA2ADcAOAA5ADoAOAA6ADsAPAA9AD4APAA/AD0AQAA/ADwAQABBAD8AQgBBAEAAQgBAAEMARABFAEYARABGAEcARABHAEgARgBJAEcARgBKAEkASwBKAEYASwBMAEoASwBNAEwACQAIAC8ACQAvAC4ALQAsADkALQA5ADgAOwA6AE4AOwBOAE8ATwBOAE0ATwBNAEsAKQAoACsAKQArACoANwA2AFAANwBQAFEAUQBQAFIAUQBSAFMAUwBSAFQAUwBUAFUAVgBXAFgAVgBYAFkAVgBZAFoAWwBZAFgAXABZAFsAXABdAFkAXgBdAFwAXwBdAF4APAA+AGAAPABgAGEAMQAwABcAMQAXABYAYgBjADUAYgA1ADQAYQBgAGMAYQBjAGIAMwAyAF0AMwBdAF8AHQAcAGQAHQBkAGUAZQBkAAUAZQAFAAQAZgBnAAcAZgAHAAYAEQAQABMAEQATABIA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:1248,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:1248,byteOffset:1248,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:576,byteOffset:2496,target:34963}],materials:[{name:"SVGMat_001",pbrMetallicRoughness:{baseColorFactor:[.5,.5,.5,1],metallicFactor:0,roughnessFactor:1},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanhuan41:{accessors:[{name:"_1_0_positions",componentType:5126,count:39,min:[0,0,0],max:[5.489999771118164,0,5.488900184631348],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:39,min:[0,-.999939501285553,-1],max:[.13969914615154266,1,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:105,min:[0],max:[38],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yh41",byteLength:1148,uri:"data:application/octet-stream;base64,8tKXQAAAAACoNU09FK6vQAAAAAB1Ako/FK6vQAAAAAAAAACATfOAQAAAAAACmkg+K4dWQAAAAAAIrNw+WvUtQAAAAABbsT8/X5gIQAAAAACMSpI/OUWbQAAAAAD0/VQ/LbKHQAAAAAD0/XQ/W0JqQAAAAAC6SZQ/dLXNPwAAAACfq80/H4VHQAAAAAB0JLc/ZognQAAAAAA1XuI/YVSSPwAAAAAukAhABaMKQAAAAAB4nApABcU/PwAAAACF6y1Aw2TiPwAAAACRfidASS63PwAAAABKe0dAJLncPgAAAACze1ZAj1OUPwAAAADjNmpAAppIPgAAAADu64BAnRF1PwAAAAD8qYdAqDVNPQAAAADBypdAgQRVPwAAAAAIPZtAAAAAAAAAAAASpa9AAwlKPwAAAAASpa9AJJd/PAAAAAASpa9AAwlKPwAAAAASpa9AAAAAAAAAAAASpa9Asp1vPQAAAAASpa9AJLn8PQAAAAASpa9AqoJRPgAAAAASpa9ARwOYPgAAAAASpa9AHhbKPgAAAAASpa9A2hv8PgAAAAASpa9A5q4VPwAAAAASpa9A+n4qPwAAAAASpa9AQxw7PwAAAAASpa9AwhdGPwAAAAASpa9AAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAJ5X/OwL+fz8AAACAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIC/Kzs0PAn8f78AAACApLK/PA7uf78AAACAeJkZPefRfz8AAACA+ZldPQSgf78AAACA6XSTPelVfz8AAACALLO3PdT3fr8AAACAfkjZPR2Ofr8AAACANf32Paohfj8AAACAeUYHPqDBfT8AAACASw0PPlt9fb8AAACAAAABAAIAAwABAAAABAABAAMABQABAAQABgAHAAUABwABAAUABgAIAAcABgAJAAgACgAJAAYACgALAAkACgAMAAsADQAMAAoADQAOAAwADwAOAA0ADwAQAA4ADwARABAAEgARAA8AEgATABEAFAATABIAFAAVABMAFgAVABQAFgAXABUAGAAXABYAGAAZABcAGgAbABwAHQAbABoAHgAbAB0AHwAbAB4AIAAbAB8AIQAbACAAIgAbACEAIwAbACIAJAAbACMAJQAbACQAJgAbACUAAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:468,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:468,byteOffset:468,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:212,byteOffset:936,target:34963}],materials:[{name:"SVGMat_002",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanhuan411:{accessors:[{name:"_1_0_positions",componentType:5126,count:28,min:[.026000000536441803,-4.6834001541137695,0],max:[4.696700096130371,-.014800000004470348,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:28,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:78,min:[0],max:[27],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yuanhuan411",byteLength:828,uri:"data:application/octet-stream;base64,ufwXQLN7Mr8AAAAAObRAQLFQK78AAAAA1ediQMWP8b4AAAAAGQQ6QCv2174AAAAAqFdeQHUCWr4AAAAA7FGCQL6fmr0AAAAAHHyDQDLmrr4AAAAAXkuWQJf/kL4AAAAAXkuWQLN7crwAAAAAMCrxP2RdhL8AAAAA/BgDQJeQn78AAAAADeARQAg9i78AAAAAukkIQISeXb8AAAAAZaogQH/Zbb8AAAAA7Q3ePr4wOcAAAAAA5IMuP9/gP8AAAAAAJQZxPwrXH8AAAAAAPZs1P6UsF8AAAAAAdy2hP0VHAsAAAAAAb/CFP5eQ778AAAAA0ES4P32utr8AAAAAAprQPyL9zr8AAAAAi/1lPqqCXcAAAAAA9dv3PtcSYsAAAAAADi2yPZvmgcAAAAAAYTK1PssQg8AAAAAA9P3UPGrelcAAAAAA4liXPmrelcAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAACAAMAAwACAAQABQAGAAcABQAHAAgABAACAAYABAAGAAUACQAKAAsACQALAAwAAAANAAEADgAPABAADgAQABEAEQAQABIAEQASABMAFAAVAAoAFAAKAAkADAALAA0ADAANAAAAFgAXAA8AFgAPAA4AGAAZABcAGAAXABYAGgAZABgAGgAbABkAEwASABUAEwAVABQA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:336,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:336,byteOffset:336,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:156,byteOffset:672,target:34963}],materials:[{name:"SVGMat",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanpan:{accessors:[{name:"Circle001_1_0_positions",componentType:5126,count:28,min:[-1.9510999917984009,0,-1.9510999917984009],max:[1.9510999917984009,0,1.9510999917984009],type:"VEC3",bufferView:0,byteOffset:0},{name:"Circle001_1_0_normals",componentType:5126,count:28,min:[0,1,0],max:[0,1,0],type:"VEC3",bufferView:1,byteOffset:0},{name:"Circle001_1_0_indices",componentType:5123,count:78,min:[0],max:[27],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yuanpan",byteLength:828,uri:"data:application/octet-stream;base64,S+rkvgAAAADRIvM/AAAAAAAAAAClvfk/S+rkPgAAAADRIvM/0SLzvwAAAABL6uQ+MlXgvwAAAACsi1s/c9fCvwAAAACvJZw/pb35vwAAAAAAAAAA0SLzvwAAAABL6uS+MlXgvwAAAACsi1u/c9fCvwAAAACvJZy/ryWcvwAAAABz18K/rItbvwAAAAAyVeC/S+rkvgAAAADRIvO/AAAAgAAAAAClvfm/S+rkPgAAAADRIvO/rItbPwAAAAAyVeC/ryWcPwAAAABz18K/c9fCPwAAAACvJZy/MlXgPwAAAACsi1u/0SLzPwAAAABL6uS+pb35PwAAAAAAAACA0SLzPwAAAABL6uQ+MlXgPwAAAACsi1s/c9fCPwAAAACvJZw/ryWcvwAAAABz18I/ryWcPwAAAABz18I/rItbvwAAAAAyVeA/rItbPwAAAAAyVeA/AAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAABAAIAAwAEAAUABgADAAUABwAGAAUACAAHAAUACQAIAAUACgAJAAUACwAKAAUADAALAAUADQAMAAUADgANAAUADwAOAAUAEAAPAAUAEQAQAAUAEgARAAUAEwASAAUAFAATAAUAFQAUAAUAFgAVAAUAFwAWAAUAFwAFABgAGQAXABgAGQAYABoAGwAZABoAAgAbABoAAAACABoA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:336,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:336,byteOffset:336,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:156,byteOffset:672,target:34963}],materials:[{name:"wire_008110135",pbrMetallicRoughness:{baseColorFactor:[.0314,.4314,.5294,1],metallicFactor:0,roughnessFactor:.968},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Circle001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Circle001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},zzhou:{accessors:[{name:"Cube.001-Mesh_0_positions",componentType:5126,count:45,min:[-.2711470127105713,-5.473427772521973,-.2711470127105713],max:[.2711470127105713,.46298399567604065,.2711470127105713],type:"VEC3",bufferView:0,byteOffset:0},{name:"Cube.001-Mesh_0_normals",componentType:5126,count:45,min:[-1,-1,-1],max:[1,1,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Cube.001-Mesh_0_texcoords",componentType:5126,count:45,min:[.125,0],max:[.875,1],type:"VEC2",bufferView:2,byteOffset:0},{name:"Cube.001-Mesh_0_indices",componentType:5123,count:72,min:[0],max:[44],type:"SCALAR",bufferView:3,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"Z",byteLength:1584,uri:"data:application/octet-stream;base64,/waNvZMdK77/Bo09/waNPZMdK77/Bo09/waNPR4Kr8D/Bo09l+KKPVImr8D/Bo09/waNvVImr8D/Bo09yNOKPsjTir7I04o+AAAAAD0M7T4AAAAAyNOKvsjTir7I04o+yNOKvsjTir7I04o+AAAAAD0M7T4AAAAAyNOKvsjTir7I04q+yNOKvsjTir7I04q+yNOKPsjTir7I04q+yNOKPsjTir7I04o+yNOKvsjTir7I04o+yNOKPsjTir7I04q+AAAAAD0M7T4AAAAAyNOKPsjTir7I04o+yNOKvsjTir7I04q+AAAAAD0M7T4AAAAAyNOKPsjTir7I04q+/waNPZMdK77/Bo09/waNPZMdK77/Bo29/waNPVImr8D/Bo29/waNPVImr8D/Bo09/waNPR4Kr8D/Bo09/waNvZMdK77/Bo09/waNvVImr8D/Bo09/waNvVImr8D/Bo29/waNvZMdK77/Bo29/waNvZMdK77/Bo29/waNvVImr8D/Bo29/waNPVImr8D/Bo29/waNPZMdK77/Bo29/waNPZMdK77/Bo09/waNvZMdK77/Bo09/waNvZMdK77/Bo29/waNPZMdK77/Bo29/waNvVImr8D/Bo09cooOO1Imr8BAMTI7/waNvVImr8D/Bo29/waNPVImr8D/Bo29/waNPVImr8D/Bo09l+KKPVImr8D/Bo09/waNPVImr8D/Bo09AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAFFmsT5wJHA/AAAAAFFmsT5wJHA/AAAAAFFmsT5wJHA/cCRwv1FmsT4AAAAAcCRwv1FmsT4AAAAAcCRwv1FmsT4AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAcCRwP1FmsT4AAAAAcCRwP1FmsT4AAAAAcCRwP1FmsT4AAAAAAAAAAFFmsT5wJHC/AAAAAFFmsT5wJHC/AAAAAFFmsT5wJHC/AACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAADAPgAAQD8AAMA+AACAP2L1Hz8AAIA/AAAgP3uDfz8AACA/AABAPwAAwD4AAIA+AAAgPwAAAAAAAMA+AAAAAAAAwD4AAIA/AAAgPwAAQD8AAMA+AABAPwAAAD4AAAA/AADAPgAAAD8AAMA+AACAPgAAAD4AAIA+AADAPgAAAD8AACA/AACAPgAAwD4AAIA+AADAPgAAQD8AACA/AAAAPwAAwD4AAAA/AADAPgAAAD8AAMA+AABAPwAAID8AAEA/AAAgPwAAAD9i9R8/AAAAPwAAwD4AAAA/AAAgPwAAAD8AACA/AACAPgAAwD4AAIA+AADAPgAAgD4AACA/AACAPgAAID8AAAAAAADAPgAAAAAAAAA+AAAAPwAAwD4AAAA/AADAPgAAgD4AAAA+AACAPgAAID8AAAA/vAJBP/mGwj4AACA/AACAPgAAYD8AAIA+AAAgPwAAgD97g18/AAAAPwAAYD8AAAA/AAABAAIAAgADAAQAAgAEAAAABQAGAAcACAAJAAoACwAMAA0ACwANAA4ADwAQABEAEgATABQAFQAWABcAFwAYABkAFwAZABUAGgAbABwAGgAcAB0AHgAfACAAHgAgACEAIgAjACQAIgAkACUAJgAnACgAKAAnACkAAwACACoAKQAnACsAKQArACwAJwAmACsA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:540,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:540,byteOffset:540,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:360,byteOffset:1080,byteStride:8,target:34962},{name:"bufferView_3",buffer:0,byteLength:144,byteOffset:1440,target:34963}],materials:[{name:"Material.001",pbrMetallicRoughness:{baseColorFactor:[.8,.8,.8,1],metallicFactor:0,roughnessFactor:.676000006},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Cube.001-Mesh",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0,mode:4}]}],nodes:[{name:"Cube.001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},jiantou:{accessors:[{name:"_1_0_positions",componentType:5126,count:7,min:[-.47690001130104065,-.8044000267982483,0],max:[.47780001163482666,0,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:7,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:15,min:[0],max:[6],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"jiantou",byteLength:200,uri:"data:application/octet-stream;base64,bxIDOintTb8AAAAAH/RsvsKGp74AAAAAPSz0vsKGp74AAAAANs17PsKGp74AAAAANKL0PsKGp74AAAAANs17PgAAAAAAAAAAH/RsvgAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAADAAEAAAAEAAMAAQAFAAYAAQADAAUAAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:84,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:84,byteOffset:84,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:32,byteOffset:168,target:34963}],materials:[{name:"SVGMat_003",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},xuanzhuan:{accessors:[{name:"001_1_0_positions",componentType:5126,count:369,min:[-6.572299957275391,-7.298999786376953,0],max:[6.5742998123168945,7.298299789428711,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"001_1_0_normals",componentType:5126,count:369,min:[0,-1,0],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"001_1_0_indices",componentType:5123,count:1089,min:[0],max:[368],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"-",byteLength:11036,uri:"data:application/octet-stream;base64,1zQDwHql3kAAAAAA48e4vgMJ1kAAAAAAQmD1v6yL6UAAAAAA2qxqv1Fr0EAAAAAAVHSkvnuD1UAAAAAAF7eRvjXv1EAAAAAAyeV/vqVO1EAAAAAA5INevsuh00AAAAAAW7E/vpHt0kAAAAAAZogjvoMv0kAAAAAAAwkKvrpr0UAAAAAA+aDnvTSi0EAAAAAAXCDBvWfVz0AAAAAAqoLZv4NRy0AAAAAALv+hvfcGz0AAAAAAAwmKvVg5zkAAAAAA/Yd0vYtszUAAAAAAak1zvSBBzUAAAAAA1xJyveQUzUAAAAAAIEFxvTLmzEAAAAAARdhwvd21zEAAAAAARdhwvbaEzEAAAAAAIEFxvb1SzEAAAAAAs3tyvSEfzEAAAAAARrZzvYXry0AAAAAAayt2vRe3y0AAAAAAkKB4vQaBy0AAAAAASFB8vfVKy0AAAAAAhXwcwLRZw0AAAAAAbjSAveQUy0AAAAAA3EaDvcX+ykAAAAAAb/CFvTLmykAAAAAAcM6IvRTQykAAAAAAcayLvSS5ykAAAAAAcoqOvQWjykAAAAAA4XqUvWx4ykAAAAAAUI2XvSBjykAAAAAACD2bvQFNykAAAAAAUrievbU3ykAAAAAAeJyivTojykAAAAAA5x2nve0NykAAAAAAMCqpvaMBykAAAAAAVp+rvVr1yUAAAAAAexSuvbPqyUAAAAAAxSCwvTvfyUAAAAAA6pWyvfLSyUAAAAAAoda0vUvIyUAAAAAAx0u3vQK8yUAAAAAAWvW5vVuxyUAAAAAA7Z68vYenyUAAAAAA7ny/veCcyUAAAAAAgSbCvQyTyUAAAAAAgQTFvQmKyUAAAAAA1CvlvRUdyUAAAAAAXW0FviS5yEAAAAAALNQavjVeyEAAAAAADi0yvqYKyEAAAAAAlkNLvki/x0AAAAAA5q5lvhx8x0AAAAAAZaqAvqs+x0AAAAAA4L6OvsgHx0AAAAAAyAedvnPXxkAAAAAAlkOrvqytxkAAAAAAEFi5vs6IxkAAAAAAH4XLvpVlxkAAAAAAAwnKvjhnxkAAAAAA54zIvjhnxkAAAAAAsAPHvgpoxkAAAAAAOwHNvsNkxkAAAAAAO3DOvvFjxkAAAAAA0ETYvpJcxkAAAAAAV+zPvk5ixkAAAAAAV1vRvtlfxkAAAAAAWMrSvgdfxkAAAAAAWDnUvmRdxkAAAAAAIo7VvpJcxkAAAAAA6+LWvpJcxkAAAAAAiIXavgRWxkAAAAAAJLncvkhQxkAAAAAA2/nevl5LxkAAAAAAkzrhvhdIxkAAAAAASnvjvtBExkAAAAAAMzPzvoY4xkAAAAAAArzlvrhAxkAAAAAAufznvkI+xkAAAAAAcT3qvs07xkAAAAAAKH7svlg5xkAAAAAAxLHuvoY4xkAAAAAAfPLwvoY4xkAAAAAA9Gz2vsoyxkAAAAAAtab5vj0sxkAAAAAAduD8vlInxkAAAAAAqRMAvzojxkAAAAAApb0Bv08exkAAAAAAE2EDvzcaxkAAAAAAnREFv00VxkAAAAAAC7UGvzQRxkAAAAAAlWUIv0oMxkAAAAAAHhYKv18HxkAAAAAAGsALv6MBxkAAAAAADk8Pv7n8xUAAAAAAgEgPv7n8xUAAAAAApHANv7n8xUAAAAAAUwWrv90kwkAAAAAASS4Pv7n8xUAAAAAApHANv7n8xUAAAAAAgEgPv7n8xUAAAAAA9wYPv7n8xUAAAAAAidIOv7n8xUAAAAAAG54Ov7n8xUAAAAAAIGMOv7n8xUAAAAAAJCgOv7n8xUAAAAAAKe0Nv7n8xUAAAAAASL8Nv7n8xUAAAAAA9pcNv7n8xUAAAAAAv30Nv7n8xUAAAAAABoFJwDm0uEAAAAAAZvcEwJtVu0AAAAAAwcoxwOzAsUAAAAAARiUFQFdbu8AAAAAAdZMcQM9mw8AAAAAA9pdJQIPAuMAAAAAAtvMxQEvIscAAAAAA2IFzQISeq8AAAAAAjLlbQECkpcAAAAAAZveMQPkxnMAAAAAAPQqBQNEil8AAAAAA+zqeQJOpisAAAAAAdk+SQPd1hsAAAAAAA3ihQFafZ8AAAAAAnl6tQN5xbsAAAAAAsi66QCEfRMAAAAAASFCuQLTIPsAAAAAA4XrEQPW5FsAAAAAAHqe4QJ/NEsAAAAAA1xLMQJhMzb8AAAAA6UjAQFInyL8AAAAAnMTQQM4ZUb8AAAAAsAPFQKMBTL8AAAAAduCMwKMjWcAAAAAA9P1wwOauOcAAAAAA6GqDwG1WGcAAAAAA46WZwA5PM8AAAAAANKLGQBe30TkAAAAAqmDSQBe30TkAAAAAdQLMwEYlzT8AAAAALUPAwAAAyD8AAAAAvp+4wFK4EkAAAAAArWnEwAWjFkAAAAAAF0iuwGizPkAAAAAATx66wI4GREAAAAAAXW2hwAmKZ0AAAAAAPE6twEtZbkAAAAAAW0KSwFFrhkAAAAAAayuewO2eikAAAAAAUPyAwPwYl0AAAAAA1eeMwK8lnEAAAAAAyJhbwA+cpUAAAAAAoWdzwDqSq0AAAAAA6GqrP8cpwsAAAAAA+zoQP6MBxsAAAAAAbqPZPxNhy8AAAAAAYHYPPxsNxsAAAAAAukkMPzQRxsAAAAAA0gAOPxsNxsAAAAAARPoNPxsNxsAAAAAAexQOPxsNxsAAAAAAPzUOPxsNxsAAAAAAIGMOPxsNxsAAAAAAcooOPxsNxsAAAAAAUrgOPxsNxsAAAAAAMuYOPxsNxsAAAAAAoBoPPxsNxsAAAAAAZDsPPxsNxsAAAAAAKVwPPxsNxsAAAAAA0m8PPxsNxsAAAAAAMZkKP00VxsAAAAAAp+gIPzcaxsAAAAAAqz4HPyEfxsAAAAAAIo4FP90kxsAAAAAAmN0DP2srxsAAAAAADi0CPycxxsAAAAAAhXwAP+M2xsAAAAAA9pf9PnE9xsAAAAAA/kP6PltCxsAAAAAA6+L2PqJFxsAAAAAA2IHzPulIxsAAAAAAc2jxPl5LxsAAAAAADk/vPtNNxsAAAAAAqDXtPkhQxsAAAAAAKA/rPr1SxsAAAAAAjNvoPmFUxsAAAAAAC7XmPjJVxsAAAAAAVHTkPgRWxsAAAAAA003iPnlYxsAAAAAAGw3gPh1axsAAAAAAZMzdPpJcxsAAAAAArIvbPgdfxsAAAAAA9UrZPnxhxsAAAAAA2c7XPvFjxsAAAAAA2V/WPpVlxsAAAAAA2PDUPgpoxsAAAAAA847TPn9qxsAAAAAA8x/SPiJsxsAAAAAA8rDQPvRsxsAAAAAA8kHPPphuxsAAAAAAKe3NPg1xxsAAAAAAKH7MPt5xxsAAAAAADALLPlR0xsAAAAAADJPJPsl2xsAAAAAA8BbIPj55xsAAAAAA4za6PryWxsAAAAAATRWsPvW5xsAAAAAASL+dPuvixsAAAAAAYHaPPp0Rx8AAAAAA5WGBPgtGx8AAAAAAi2xnPtiBx8AAAAAAOwFNPtbFx8AAAAAA6gQ0PmIQyMAAAAAAP8YcPiBjyMAAAAAA3pMHPrG/yMAAAAAAZ0TpPdEiycAAAAAAg1HJPcWPycAAAAAAy6HFPQ+cycAAAAAA7lrCPYenycAAAAAAEhS/PdCzycAAAAAAowG8PRrAycAAAAAAEFi5PZLLycAAAAAAfa62PdzXycAAAAAA6gS0PVTjycAAAAAAxY+xPZ7vycAAAAAADk+vPef7ycAAAAAA6NmsPV8HysAAAAAAn82qPakTysAAAAAAeVioPfMfysAAAAAAwaikPT81ysAAAAAA5WGhPYxKysAAAAAACRuePapgysAAAAAACD2bPcl2ysAAAAAAB1+YPbmNysAAAAAAdLWVPamkysAAAAAAvJaQPVvTysAAAAAABFaOPRzrysAAAAAA3+CLPd4Cy8AAAAAAldSJPXEby8AAAAAAcF+HPTMzy8AAAAAA3bWEPc9my8AAAAAALNRqP1Z90MAAAAAAuECCPciYy8AAAAAA3GiAPZLLy8AAAAAAtvN9PS7/y8AAAAAASFB8PScxzMAAAAAA/kN6PSBjzMAAAAAAI9t5PUaUzMAAAAAAI9t5PRHHzMAAAAAAI9t5PTj4zMAAAAAA/kN6PV8pzcAAAAAAkX57PYZazcAAAAAAJLl8PQmKzcAAAAAAcoqOPdZWzsAAAAAAMEymPaMjz8AAAAAAXW3FPZ7vz8AAAAAAjLnrPfW50MAAAAAAqz4DQN213sAAAAAAgy8MPmN/0cAAAAAA5q4lPrhA0sAAAAAAE/JBPn/70sAAAAAAnMRgPhSu08AAAAAAJQaBPnlY1MAAAAAAPL2SPpT21MAAAAAAeHqlPgmK1cAAAAAAhxa5Pr8O1sAAAAAA63P1P2iR6cAAAAAApb1Bv4xKsEAAAAAAMlVAP4xKsEAAAAAAw2QquxDpsUAAAAAAMne9v/OOq0AAAAAA3bW8P/OOq0AAAAAAYqEKwG/wo0AAAAAAcT0KQG/wo0AAAAAA/7IzwG6jmUAAAAAAak0zQG6jmUAAAAAA8IVZwAHejEAAAAAAHcklvw6+lkAAAAAAw2Qqu8UgmEAAAAAAxm0kPw6+lkAAAAAAuB5ZQAHejEAAAAAAc2ihP5aykkAAAAAA1xKiv5aykkAAAAAAKH7sP+AtjEAAAAAAjSjtv+AtjEAAAAAAuK97wBSue0AAAAAAOUV7QBSue0AAAAAAnl4ZQHBfg0AAAAAAdLUZwHBfg0AAAAAAXro5QGDlcEAAAAAA7Q06wGDlcEAAAAAAduCMwPCFWUAAAAAAZaqMQPCFWUAAAAAAqvFWQJAxV0AAAAAA3EZXwJAxV0AAAAAA46WZwEa2M0AAAAAA0m+ZQEa2M0AAAAAAHqdwQIv9OUAAAAAA9P1wwIv9OUAAAAAAIEGDQLWmGUAAAAAA6GqDwLWmGUAAAAAAnzyMwMZt7L8AAAAAiPSjwHE9CsAAAAAAIEGDQG1WGcAAAAAA0m+ZQA5PM8AAAAAA07yjQHE9CsAAAAAANBGMQMZt7L8AAAAA+1yrQAisvL8AAAAA6pWSQBBYob8AAAAAOpKrwAisvL8AAAAAVcGSwBBYob8AAAAA+8uWwI9TJL8AAAAA002wwG40QL8AAAAAYqGWQMbcJT8AAAAA8BawQPfkQT8AAAAA+1yrQE2EvT8AAAAA6pWSQJEPoj8AAAAAVTCYwInSXjsAAAAA+u2xwInSXjsAAAAA6gSYQInSXjsAAAAARraxQInSXjsAAAAAObTQwEXYUD8AAAAAIv3EwBrASz8AAAAAYqGWQI9TJL8AAAAA8BawQG40QL8AAAAA+8uWwMbcJT8AAAAA002wwPfkQT8AAAAAVcGSwJEPoj8AAAAAOpKrwE2EvT8AAAAAnzyMwOQU7T8AAAAAiPSjwEymCkAAAAAA07yjQEymCkAAAAAANBGMQOQU7T8AAAAAHqdwQOauOcAAAAAAZaqMQKMjWcAAAAAA3EZXwOviVsAAAAAAqvFWQOviVsAAAAAA7Q06wLyWcMAAAAAAXro5QLyWcMAAAAAAOUV7QMdLe8AAAAAAuK97wMdLe8AAAAAAdLUZwHo2g8AAAAAAnl4ZQHo2g8AAAAAAuB5ZQE+vjMAAAAAA8IVZwE+vjMAAAAAAjSjtv+oEjMAAAAAAKH7sP+oEjMAAAAAA1xKiv86IksAAAAAAc2ihP86IksAAAAAAak0zQGB2mcAAAAAA/7IzwGB2mcAAAAAAHcklv0aUlsAAAAAAxm0kP0aUlsAAAAAAw2Qqu/32l8AAAAAAcT0KQDPEo8AAAAAAYqEKwDPEo8AAAAAA3bW8P4hjq8AAAAAAMne9v4hjq8AAAAAAMlVAPyEfsMAAAAAApb1BvyEfsMAAAAAAw2Qqu3e+scAAAAAASFDSwG8Sg7oAAAAASZ3GwG8Sg7oAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAwABAAAAAwAEAAEAAwAFAAQAAwAGAAUAAwAHAAYAAwAIAAcAAwAJAAgAAwAKAAkAAwALAAoAAwAMAAsADQAMAAMADQAOAAwADQAPAA4ADQAQAA8ADQARABAADQASABEADQATABIADQAUABMADQAVABQADQAWABUADQAXABYADQAYABcADQAZABgADQAaABkADQAbABoAHAAbAA0AHAAdABsAHAAeAB0AHAAfAB4AHAAgAB8AHAAhACAAHAAiACEAHAAjACIAHAAkACMAHAAlACQAHAAmACUAHAAnACYAHAAoACcAHAApACgAHAAqACkAHAArACoAHAAsACsAHAAtACwAHAAuAC0AHAAvAC4AHAAwAC8AHAAxADAAHAAyADEAHAAzADIAHAA0ADMAHAA1ADQAHAA2ADUAHAA3ADYAHAA4ADcAHAA5ADgAHAA6ADkAHAA7ADoAHAA8ADsAHAA9ADwAHAA+AD0AHAA/AD4AHABAAD8AQABBAD8AQQBCAD8AQgBDAD8AHABAAEQAHABEAEUAHABGAEUARgBHAEUARgBIAEcARgBJAEgARgBKAEkARgBLAEoARgBMAEsAHABNAEYAHABOAE0AHABPAE4AHABQAE8AHABRAFAAHABSAFEAUgBTAFEAUgBUAFMAUgBVAFQAUgBWAFUAUgBXAFYAUgBYAFcAHABZAFIAHABaAFkAHABbAFoAHABcAFsAHABdAFwAHABeAF0AHABfAF4AHABgAF8AHABhAGAAHABiAGEAHABjAGIAHABjAGQAZABlAGMAZQBmAGMAHABnAGQAaABpAGoAawBpAGgAbABpAGsAbQBpAGwAbgBpAG0AbwBpAG4AcABpAG8AcQBpAHAAcgBpAHEAcwBpAHIAdABnABwAdAB1AGcAdAB2AHUAdwB4AHkAdwB5AHoAegB5AHsAegB7AHwAfAB7AH0AfAB9AH4AfgB9AH8AfgB/AIAAgQCCAIMAgQCDAIQAhACDAIUAhACFAIYAhgCFAIcAhgCHAIgAiACHAIkAiACJAIoAiwCMAI0AiwCNAI4AjwCKAJAAigCJAJAAkQCSAJMAkQCTAJQAlACTAJUAlACVAJYAlgCVAJcAlgCXAJgAgAB/AIIAgACCAIEAmACXAJkAmACZAJoAmgCZAJsAmgCbAJwAnACbAJ0AnACdAJ4AngCdAHYAngB2AHQAnwB4AHcAoAB4AJ8AoAChAHgAogChAKAAowCkAKUAowCmAKQAowCnAKYAowCoAKcAowCpAKgAowCqAKkAowCrAKoAowCsAKsAowCtAKwAowCuAK0AowCvAK4AowCiAK8AowChAKIAsAChAKMAsQChALAAsgChALEAswChALIAtAChALMAtQChALQAtgChALUAtwChALYAuAChALcAuQChALgAugChALkAuwChALoAvAChALsAvQChALwAvgChAL0AvwChAL4AwAChAL8AwQChAMAAwgChAMEAwwChAMIAxAChAMMAxQChAMQAxgChAMUAxwChAMYAyAChAMcAyQChAMgAygChAMkAywChAMoAzAChAMsAzQChAMwAzgChAM0AzwChAM4A0AChAM8A0QChANAA0gChANEA0wChANIA1AChANMA1QChANQA1gChANUA1wChANYA2AChANcA2QChANgA2gChANkA2wChANoA3AChANsA3QChANwA3gChAN0A3wChAN4A4AChAN8A4QChAOAA4gChAOEA4wChAOIA5AChAOMA5QChAOQA5gChAOUA5wChAOYA6AChAOcA6QChAOgA6gChAOkA6wChAOoA7AChAOsA7QChAOwA7gChAO0A7wChAO4A8AChAO8A8QChAO8A8gChAPEA8wChAPIA9AChAPMA9QChAPQA9gChAPUA9gD3AKEA+AD3APYA+QD3APgA+gD3APkA+wD3APoA/AD3APsA/QD3APwA/gD3AP0A/wD3AP4AAAH3AP8AAQH3AAABAgH3AAEBAwH3AAIBBAH3AAMBBQH3AAQBBgH3AAUBBgEHAfcACAEHAQYBCQEHAQgBCgEHAQkBCwEHAQoBDAEHAQsBDQEHAQwBDgEHAQ0BDwEHAQ4BEAEHAQ8BEQESARMBFAESAREBFAEVARIBFgEVARQBFgEXARUBGAEXARYBGAEZARcBGgEbARgBGwEcARgBHAEZARgBHAEdARkBHQEeARkBHwEeAR0BGgEgARsBIQEeAR8BGgEiASABIwEiARoBIQEkAR4BJQEkASEBIwEmASIBJwEkASUBIwEoASYBKQEoASMBJwEqASQBKwEqAScBKQEsASgBLQEsASkBKwEuASoBLwEuASsBLQEwASwBMQEuAS8BLQEyATABjgCNADMBjgAzATQBNQE2ATcBNQE3ATgBOAE3ATkBOAE5AToBOwE8AT0BOwE9AT4BPwFAAUEBPwFBAUIBPgE9AUMBPgFDAUQBRQFGAUABRQFAAT8BRwFIAZIARwGSAJEASQFKAUYBSQFGAUUBRAFDAUsBRAFLAUwBOgE5AUoBOgFKAUkBTAFLAU0BTAFNAU4BTgFNAU8BTgFPAVABQgFBAVEBQgFRAVIBUgFRAS4BUgEuATEBNAEzATwBNAE8ATsBUwFUATYBUwE2ATUBUAFPATIBUAEyAS0BiwBVAYwAVgFUAVMBiwBXAVUBWAFUAVYBWAFZAVQBWgFXAYsAWgFbAVcBXAFZAVgBXAFdAVkBXgFbAVoBXgFfAVsBYAFdAVwBXgFhAV8BYgFdAWABYgFjAV0BZAFhAV4BZAFlAWEBZgFjAWIBZAFnAWUBZwFjAWYBZAFjAWcBZAFoAWMBaQFoAWQBaQFqAWgBawFqAWkBawFsAWoBbQFsAWsBbQFuAWwBbwFwAUgBbwFIAUcBAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:4428,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:4428,byteOffset:4428,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:2180,byteOffset:8856,target:34963}],materials:[{name:"SVGMat",pbrMetallicRoughness:{baseColorFactor:[.5,.5,.5,1],metallicFactor:0,roughnessFactor:1},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},plane:{accessors:[{name:"Rectangle001_1_0_positions",componentType:5126,count:4,min:[-5,-5,0],max:[5,5,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"Rectangle001_1_0_normals",componentType:5126,count:4,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Rectangle001_1_0_indices",componentType:5123,count:6,min:[0],max:[3],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"plane",byteLength:108,uri:"data:application/octet-stream;base64,AACgQAAAoEAAAAAAAACgwAAAoEAAAAAAAACgwAAAoMAAAAAAAACgQAAAoMAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAgADAAAA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:48,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:48,byteOffset:48,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:12,byteOffset:96,target:34963}],materials:[{name:"wire_225198087",pbrMetallicRoughness:{baseColorFactor:[.8824,.7765,.3412,1],metallicFactor:0,roughnessFactor:.968},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Rectangle001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Rectangle001",mesh:0}],scene:0,scenes:[{nodes:[0]}]}};function f$2(s,i,n,o,I,r){const a=[],g=fromRotationTranslationScale([],fromEuler([],n[0],n[1],n[2]),i,o),B=function(A){return new B$3("",w$2[A]).load().then((A=>A))}(s);return B.then((A=>{const s=dn$3.exportGLTFPack(A).getMeshesInfo(),h=new ee$3({color:I});s.forEach((A=>{const s=new de$4(A.geometry,h);s.setUniform("uPickingId",r);const c=s.getDefines();c.HAS_PICKING_ID=2,s.setDefines(c),s.translate=i,s.rotation=n,s.scaling=o,multiply$5(s.localTransform,g,A.nodeMatrix),s.originTransform=copy$5([],s.localTransform),s.originColor=I,a.push(s)}))})),a}function C$2(A,e){const i=A.getCoordinates(),n=e.coordinateToPointAtRes(i,e.getGLRes()),I=[n.x,n.y,0];add$4(I,I,A.getTranslation());const a=function(A,t,e,s){return A._pointAtResToContainerPoint(t,e,void 0)}(e,new t__namespace.Point(I[0],I[1]),e.getGLRes());a.x+=170;const h=function(A,e,i,n){{const t=A.containerPointToCoordinate(e);return A.coordinateToPointAtRes(t,i)}}(e,a,e.getGLRes());return Math.sqrt(Math.pow(h.x-I[0],2)+Math.pow(h.y-I[1],2))/5.272881136101205}class P$2{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],t=340/177,e=f$2("jiantou",[1.2*t,0,0],[0,0,90],[t,t,t],[89/255,206/255,147/255,0],7),s=f$2("jiantou",[0,1.2*t,0],[0,0,180],[t,t,t],[89/255,206/255,147/255,0],8),i=f$2("jiantou",[-1.2*t,0,0],[0,0,270],[t,t,t],[89/255,206/255,147/255,0],9),n=f$2("jiantou",[0,-1.2*t,0],[0,0,0],[t,t,t],[89/255,206/255,147/255,0],10);return A.push(e,s,i,n),A}getMeshes(){return this._meshes}}class m$2{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],t=340/177,e=f$2("xuanzhuan",[0,0,0],[180,0,0],[.5*t,.5*t,.5*t],[50/255,130/255,184/255,.8],11);return A.push(e),A}getMeshes(){return this._meshes}}class u{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],t=340/177,e=f$2("yuanhuan",[0,0,0],[0,0,0],[.5*t,.5*t,.5*t],[149/255,179/255,199/255,.5],12);return A.push(e),A}getMeshes(){return this._meshes}}class Q$1{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],t=f$2("plane",[0,0,0],[0,0,0],[10,10,10],[1,0,0,.5],16);return A.push(t),A}getMeshes(){return this._meshes}}const l$1=[],b$2=[],y$2=[],v$2=[],M$2=[],E$2=[177/170,177/170,177/170],D$2=[1,2,3,4,12];class p$2{constructor(){this.translate=new P$2,this.rotation=new m$2,this.scaling=new u,this.planeHelper=new Q$1,this._meshes=this.t(),this.i=!0}t(){const A={};A.translate=this.translate.getMeshes(),A.rotation=this.rotation.getMeshes(),A.scaling=this.scaling.getMeshes(),A.planeHelper=this.planeHelper.getMeshes();const t=340/177,e=f$2("yuanhuan41",[-2.745*t,2.745*t,0],[90,0,0],[.5*t,.5*t,.5*t],[149/255,179/255,199/255,.6],1),s=f$2("yuanhuan41",[2.745*t,2.745*t,0],[-90,0,180],[.5*t,.5*t,.5*t],[50/255,130/255,184/255,.5],2),i=f$2("yuanhuan41",[2.745*t,-2.745*t,0],[90,0,180],[.5*t,.5*t,.5*t],[149/255,179/255,199/255,.6],3),n=f$2("yuanhuan41",[-2.745*t,-2.745*t,0],[-90,0,0],[.5*t,.5*t,.5*t],[50/255,130/255,184/255,.5],4),o=f$2("yuanpan",[0,0,0],[90,0,0],[.5*t,.5*t,.5*t],[89/255,206/255,147/255,.5],5),I=f$2("zzhou",[0,0,6.5],[90,0,0],[1,1,1],[14/255,127/255,191/255,1],6);return A.translate.push(e,s,i,n,o,I),A}updateMatrix(e,i,n,o,I){const r=i.getCoordinates(),a=e.coordinateToPointAtRes(r,e.getGLRes()),h=i.getPointZ();set$4(b$2,a.x,a.y,h);const g=copy$4(l$1,I),c=i.getTranslation();add$4(b$2,b$2,c),add$4(b$2,b$2,g);for(const I in this._meshes)for(let r=0;r<this._meshes[I].length;r++){const a=this._meshes[I][r];for(let I=0;I<a.length;I++){const r=a[I],h=r.getUniform("uPickingId"),g=copy$4(l$1,r.translate),c=[r.rotation[0],r.rotation[1],r.rotation[2]],w=r.scaling;if(11===h&&(this.i?(c[2]+=n,r.rotation[2]+=n):this.i||(c[2]+=n,r.rotation[2]+=n,c[0]=360,c[2]-=90)),D$2.indexOf(h)>-1)if(12!==h)w[0]+=o,w[1]+=o,w[2]+=o;else{const A=this._meshes.translate[4][0];w[0]=1.2*A.scaling[0],w[1]=1.2*A.scaling[0],w[2]=1.2*A.scaling[0]}let B=C$2(i,e);if(B=set$4(y$2,B,B,B),multiply$4(g,g,B),multiply$4(B,B,w),1===h||2===h||3===h||4===h){const A=multiply$4(M$2,w,E$2);multiply$4(g,g,A)}const f=fromEuler(v$2,c[0],c[1],c[2]);add$4(g,g,b$2),fromRotationTranslationScale(r.localTransform,f,g,B)}}}getMeshes(A){const t={};return t.translate=this._meshes.translate,A&&"translate"!==A&&(t[A]=this._meshes[A]),t}o(A){this.i=A}dispose(){for(const A in this._meshes)for(let t=0;t<this._meshes[A].length;t++){const e=this._meshes[A][t];for(let A=0;A<e.length;A++){const t=e[A];t.geometry.dispose(),t.dispose()}}}}const d$2=[5,6,7,8,9,10],x$2=[5,7,8,9,10],F$2=[2,4,11],U$1=[1,3,12],k$2=[12,16],L$2=[1,2,3,4],V$2=[1,2,3,4,12],O$2=[],S$2=[],H$2=[],N$2=[],T$2=[],K$2=[],_$2=[];class R$2 extends(t$2.Eventable(t$2.Handlerable(t$2.Class))){constructor(A){super(A),this.options=A,this.mouseAction="moving",this.I="translate",this.h=!0,this.TransformHelper=new p$2,this.helperScene=new pe$4([]),this.addToMapCount=0}enable(){return this.h=!0,this.layerRenderer&&this.layerRenderer.setToRedraw(),this}disable(){return this.h=!1,this.layerRenderer&&this.layerRenderer.setToRedraw(),this.map&&this.map.resetCursor(),this}isEnable(){return this.h}g(A){this.I=d$2.indexOf(A)>-1?"translate":F$2.indexOf(A)>-1?"rotation":U$1.indexOf(A)>-1?"scaling":"translate"}B(){return this.I}addTo(A){this.map&&(this.C(),console.warn("transform control has been added to a map, it suggest remove from the map before")),this.addToMapCount++,this.map=A,this.container=A.getContainer(),A.on("dom:mousemove",this.P,this),A.on("dom:mousedown",this.m,this),A.on("dom:mouseup",this.u,this),A.on("zooming moving dragrotating",this.l,this),this.v()}remove(){this.map&&this.container&&this.layerRenderer&&(this.C(),this.TransformHelper.dispose(),this.layerRenderer.setToRedraw(),delete this.map,delete this.layer,delete this.layerRenderer,delete this.container,delete this.M)}C(){this.container&&this.map&&(this.map.off("mousemove",this.P,this),this.map.off("mousedown",this.m,this),this.map.off("mouseup",this.u,this),this.map.off("zooming moving dragrotating",this.l,this),this.layer&&this.layer.off("renderend",this.render,this))}P(A){if(this.D()){if(this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y},"moving"===this.mouseAction){const A=this.p();this.currentPickingObject=this.F(this.currentMousePosition,A,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.pickingId?(this.g(this.currentPickingObject.pickingId),this.U(6===this.currentPickingObject.pickingId)):(this.U(!1),this.g()),this.k()}this.L(this.currentMousePosition)}}m(A){if(!this.D())return;const t=this.p();this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y},this.V=!0,this.currentPickingObject=this.F(this.currentMousePosition,t,"meshes"),this.firstDownPoint=this.F(this.currentMousePosition,t,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.meshId?(this.mouseAction="transform",this.O(this.currentPickingObject.pickingId),this.map.config("zoomable",!1),this.map.config("draggable",!1),this.layerRenderer&&this.layerRenderer.setToRedraw()):(this.mouseAction="pan",this.map.config("zoomable",!0),this.map.config("draggable",!0),this.S()),this.lastMousePosition=this.currentMousePosition,this.lastPickingObject=this.currentPickingObject,this.lastPickingMesh=t[this.currentPickingObject.meshId]}u(){"transform"===this.mouseAction&&(this.firstDownPoint=null,this.S(),this.V=!0,this.fire("transformend",{action:this.H,type:"transformend"})),this.mouseAction="moving",this.I="translate",this.map.config("zoomable",!0),this.map.config("draggable",!0),this.layerRenderer&&this.layerRenderer.setToRedraw()}l(){const A=this.TransformHelper.planeHelper.getMeshes()[0][0],t=this.map.getBearing();A.rotation[2]=-t,this.N()}N(){this.D()&&(this.TransformHelper.updateMatrix(this.map,this.M,0,0,[0,0,0]),this.V=!0)}picked(A){if(!this.layerRenderer)return!1;const t=this.p();let s=A;A instanceof t$2.Point||(s=this.map.coordinateToContainerPoint(new t$2.Coordinate(A)));const i=this.F(s,t,"picked");return!(!i||null===i.meshId)}S(){const A=this.TransformHelper.getMeshes("scaling").scaling[0][0],t=340/177;A.scaling=[.6*t,.6*t,.6*t],this.layerRenderer&&(this.T(A),this.K())}K(){this.TransformHelper._meshes.translate.forEach((A=>{for(let t=0;t<A.length;t++){const e=A[t];L$2.indexOf(e.getUniform("uPickingId"))>-1&&e.material.set("color",e.originColor)}}))}T(e){const i=this.M.getCoordinates(),n=this.map.coordinateToPointAtRes(i,this.map.getGLRes()),o=[n.x,n.y,0],I=this.M.getTranslation();add$4(o,o,I);const r=copy$4([],e.translate),a=e.scaling;let h=C$2(this.M,this.map);h=set$4([],h,h,h),multiply$4(r,r,h),multiply$4(h,h,a),add$4(r,r,o),fromRotationTranslationScale(e.localTransform,[0,0,0,1],r,h),this.p().forEach((e=>{const i=e.getUniform("uPickingId");if(1===i||3===i||2===i||4===i){const i=copy$4([],e.translate),n=170/177;e.scaling=[n,n,n];const I=e.scaling,r=e.rotation;let a=C$2(this.M,this.map);a=set$4([],a,a,a),multiply$4(i,i,a),multiply$4(a,a,I),add$4(i,i,o);const h=fromEuler([],r[0],r[1],r[2]);fromRotationTranslationScale(e.localTransform,h,i,a)}}))}_(A){const t=this.map.containerPointToCoordinate(A),e=this.map.coordinateToPointAtRes(t,this.map.getGLRes());return{point:[e.x,e.y]}}L(A){if("transform"===this.mouseAction){const A=this.B(),t=this.M.getTranslation(),e=this.M.getPointZ(),n=this.M.getCoordinates(),o=this.map.coordinateToPointAtRes(n,this.map.getGLRes()),I=this.M.getRotation(),r=this.M.getScale();let a=null,c=null;if(t[2]+e<.01&&"z-translate"!==this.H)a=this._(this.currentMousePosition),c=this._(this.lastMousePosition);else{const A=this.TransformHelper.planeHelper.getMeshes()[0];if(a=this.F(this.currentMousePosition,A,"plane"),c=this.F(this.lastMousePosition,A,"plane"),!a||null===a.meshId||!c||null===c.meshId)return}const w=[0,0,0],B=[0,0,0];let f=0,C=0,P=0;if("translate"===A){if("xy-translate"===this.H){const t=a.point[1]-c.point[1];w[0]=a.point[0]-c.point[0],w[1]=t}else if("x-translate"===this.H){w[0]=a.point[0]-c.point[0]}else if("y-translate"===this.H){w[1]=a.point[1]-c.point[1]}else if("z-translate"===this.H){let A=0;if(this.R()){const t=this.map.getGLRes(),e=this.map._pointAtResToContainerPoint(new t$2.Point(c.point[0],c.point[1]),t),s=this.map._pointAtResToContainerPoint(new t$2.Point(a.point[0],a.point[1]),t),n=length(set(N$2,a.point[0]-c.point[0],a.point[1]-c.point[1]));A=s.y<e.y?n:-n}else A=a.point[2]-c.point[2];w[2]=Math.sign(A)*this.map.pointAtResToAltitude(A,this.map.getGLRes())}}else if("rotation"===A)C=this.G(a.point,c.point),this.TransformHelper.o(C>=0),B[2]+=C;else if("scaling"===A){const A=this.j(),t=length(set(N$2,this.firstDownPoint.point[0]-A[0],this.firstDownPoint.point[1]-A[1])),e=length(set(N$2,c.point[0]-A[0],c.point[1]-A[1]));f=this.Z(a.point,c.point,A,e,r),P=this.Z(a.point,c.point,A,t)}const m=set$4([],o.x,o.y,n.z||0),u=add$4(m,m,w),Q=this.map.pointAtResToCoordinate(new t$2.Coordinate(u[0],u[1]),this.map.getGLRes());Q.z=u[2];let l=null;l=f>=0?f:f*(this.options&&this.options.scaleStrength||1);const b=add$4(r,set$4(N$2,l,l*(r[1]/r[0]),l*(r[2]/r[0])),r);if(Math.min(...b)<.01){const A=Math.min(...r);b[0]=r[0]*(.01/A),b[1]=r[1]*(.01/A),b[2]=r[2]*(.01/A)}const y=add$4(I,B,I);this.TransformHelper.updateMatrix(this.map,this.M,C,P,w),this.H.indexOf("translate")>-1?this.fire("positionchange",{action:this.H,type:"positionchange",target:this.M,coordinate:Q}):this.fire("transforming",{action:this.H,type:"transforming",target:this.M,translate:t,rotation:y,scale:b})}this.lastMousePosition=A,this.lastPickingObject=this.currentPickingObject;const t=this.p();this.lastPickingMesh=t[this.currentPickingObject.meshId]}Z(A,t,e,s,n){const o=(length(set(N$2,A[0]-e[0],A[1]-e[1]))-length(set(N$2,t[0]-e[0],t[1]-e[1])))/s;return n?(n[0]-.01)*o:o}j(){const A=this.map,t=this.M.getCoordinates(),e=A.coordinateToPointAtRes(t,A.getGLRes()),i=set$4(T$2,e.x,e.y,0);return add$4(i,i,this.M.getTranslation()),i}U(e){const i=this.TransformHelper.planeHelper.getMeshes()[0][0],n=getTranslation$1(H$2,i.localTransform),o=getScaling(S$2,i.localTransform);let I=fromEuler(O$2,0,0,0);const r=this.map.getBearing();e&&!this.R()?(I=fromEuler(O$2,90,0,-r),0===i.rotation[0]&&(this.V=!0),set$4(i.rotation,90,0,-r)):(90===i.rotation[0]&&(this.V=!0),set$4(i.rotation,0,0,-r)),fromRotationTranslationScale(i.localTransform,I,n,o)}R(){if(this.map.getPitch())return!1;const A=this.map.cameraPosition,t=this.map.coordinateToPointAtRes(this.map.getCenter(),this.map.getGLRes());set$4(t,t.x,t.y,0);const e=this.M.getCoordinates(),i=this.map.coordinateToPointAtRes(e,this.map.getGLRes()),n=this.M.getTranslation(),o=set$4(H$2,i.x,i.y,0);return angle$1(subtract$2([],A,add$4(o,o,n)),subtract$2([],A,t))<1/180*Math.PI}k(){const A=this.p();if(this.currentPickingObject&&null!=this.currentPickingObject.meshId){this.J(),this.lastPickingObject&&null!=this.lastPickingObject.meshId&&this.lastPickingObject.meshId!==this.currentPickingObject.meshId&&this.Y();const t=A[this.currentPickingObject.meshId];if(t&&k$2.indexOf(this.currentPickingObject.pickingId)<0){t.material.set("color",[t.originColor[0],t.originColor[1],t.originColor[2],.8]),this.W(t,.5)}this.layerRenderer.setToRedraw()}else this.lastPickingObject&&null!=this.lastPickingObject.meshId&&(this.map.resetCursor(),this.Y(),this.layerRenderer.setToRedraw())}J(){6===this.currentPickingObject.pickingId?this.map.setCursor("ns-resize"):x$2.indexOf(this.currentPickingObject.pickingId)>-1?this.map.setCursor("move"):this.map.setCursor("pointer")}Y(){const A=this.lastPickingMesh;if(!A)return;const t=A.getUniform("uPickingId"),e=this.p();x$2.indexOf(t)>-1?e.forEach((A=>{x$2.indexOf(A.getUniform("uPickingId"))>-1&&A.material.set("color",A.originColor)})):V$2.indexOf(t)>-1?e.forEach((A=>{const t=A.getUniform("uPickingId");L$2.indexOf(t)>-1&&A.material.set("color",A.originColor)})):11===t&&e.forEach((A=>{L$2.indexOf(A.getUniform("uPickingId"))>-1&&A.material.set("color",A.originColor)})),A.material.set("color",A.originColor)}W(A,t){const e=A.getUniform("uPickingId"),s=this.p();x$2.indexOf(e)>-1?s.forEach((e=>{if(x$2.indexOf(e.getUniform("uPickingId"))>-1&&e.getUniform("uPickingId")!==A.getUniform("uPickingId")){e.material.set("color",[e.originColor[0],e.originColor[1],e.originColor[2],t])}})):"scaling"===this.I?s.forEach((A=>{const t=A.getUniform("uPickingId");if(1===t||3===t||2===t||4===t){A.material.set("color",[149/255,179/255,199/255,.8])}})):"rotation"===this.I&&s.forEach((A=>{const t=A.getUniform("uPickingId");if(1===t||3===t||2===t||4===t){const t=A.originColor;A.material.set("color",[t[0],t[1],t[2],0])}}))}reset(){if(!this.map||!this.M)return;this.M.setTranslation(this.M.originTrans),this.M.setRotation(this.q),this.M.setScale(this.X);const A=this.M.getTranslation();scale$4(A,A,-1),this.TransformHelper.updateMatrix(this.map,this.M,0,1,[0,0,0])}G(A,t){const e=this.j(),s=set(K$2,t[0]-e[0],t[1]-e[1]),n=set(_$2,A[0]-e[0],A[1]-e[1]),o=Math.atan2(s[1],s[0]);return(Math.atan2(n[1],n[0])-o)/Math.PI*180}O(A){return this.H=5===A?"xy-translate":6===A?"z-translate":7===A||9===A?"x-translate":8===A||10===A?"y-translate":11===A?"z-rotate":"scale",this.H}transform(A){if(this.layerRenderer&&this.layerRenderer.layer&&(this.layerRenderer.layer.off("renderend",this.render),this.layerRenderer.layer.off("resizeCanvas",this.$)),this.M&&(this.M.off("remove",this.AA,this),delete this.M),this.M=A,this.M.on("remove",this.AA,this),!this.map)return void console.error("should add to a target first");const t=this.map;this.M.originTrans||(this.M.originTrans=this.M.getTranslation(),this.M.originRotation=this.M.getRotation(),this.M.originScale=this.M.getScale()),this.TransformHelper.updateMatrix(t,A,0,0,[0,0,0]),this.tA(),this.V=!0}getTransformTarget(){return this.M}AA(){delete this.M}tA(){const A=this.M.getLayer();A&&(A.off("renderend",this.render),A.off("resizeCanvas",this.$));const t=this.map.getLayers();let e=null;for(let A=0;A<t.length;A++)if(t[A]instanceof _t$4){e=t[A];break}if(!e)return;const s=e.getLayers(),i=s.indexOf(A);if(i<0)return;s.splice(i,1),s.push(A);const o=this.map,I=A.getRenderer();this.layerRenderer=I,this.regl=I.regl,this.renderer=I.renderer,this.eA=this.layerRenderer.getFBORayPicking(),this.sA={projViewMatrix:o.projViewMatrix},A.on("renderend",this.render,this),A.on("resizeCanvas",this.$,this),I.setToRedraw()}$(){this.eA.clear(),this.V=!0}F(A,t,e){const s=this.map;if(!(s&&this.eA&&this.layerRenderer&&this.layerRenderer.canvas))return null;const i=s.getDevicePixelRatio(),n=A.x*i,o=A.y*i,I={projViewMatrix:this.map.projViewMatrix,pointSize:1};return(this.V||this.layerRenderer.canvas.gl&&this.layerRenderer.canvas.gl.wrap||!this.iA||this.iA!==e)&&(this.eA.render(t,I,!0),this.iA=e,this.V=!1),this.eA.pick(n,o,10,I,{viewMatrix:this.map.viewMatrix,projMatrix:this.map.projMatrix,returnPoint:!0})}v(){const A=this.map.getDevicePixelRatio();this.nA=new rt$6({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewModelMatrix;\n\n\n\nvoid main()\n\n{\n\n    gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n\n\n\n}\n\n",frag:"precision mediump float;\n\nuniform vec4 color;\n\n\n\nvoid main() {\n\n    gl_FragColor = color;\n\n}\n\n",uniforms:["color",{name:"projViewModelMatrix",type:"function",fn:function(A,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>this.map?this.map.width*A:1,height:()=>this.map?this.map.height*A:1},depth:{enable:!0,func:"always",mask:!1,range:[0,0]},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}},defines:{}})}render(){if(!this.D())return;const A=this.p();this.helperScene.setMeshes(A);const t=this.layerRenderer.getFrameContext();if(t&&t.renderTarget&&this.layerRenderer.getFrameTimestamp()!==t.timestamp)return;this.N(),this.nA.filter=t&&t.sceneFilter;this.renderer.render(this.nA,this.sA,this.helperScene,t&&t.renderTarget&&t.renderTarget.fbo)}p(){let A=[];const t=this.TransformHelper.getMeshes(this.I);for(const e in t){if("translate"===e)continue;const s=t[e];for(let t=0;t<s.length;t++)A=A.concat(s[t])}const e=t.translate;for(let t=0;t<e.length;t++)A=A.concat(e[t]);return A}D(){const A=this.layerRenderer,t=A&&A.layer;return A&&this.M&&t&&t.isVisible()&&this.M.isVisible()&&this.regl&&this.h}}R$2.mergeOptions({scaleStrength:2}),"undefined"!=typeof console&&console.log("@maptalks/transform-control v0.7.0");
/*!
	 * @maptalks/msd-json-loader v0.1.0
	 * LICENSE : BSD-3-Clause
	 * (c) 2016-2022 maptalks.com
	 */
class t{constructor(t){this.t=t||{}}getJSON(){return e(this.t)}getId(){return this.t.id}getStyle(){return this.t.options?e(this.t.options.style):null}getData(){return this.t.options?e(this.t.options.data):null}getGeometryById(t){const r=this.t.geometries;if(!r)return null;for(let i=0;i<r.length;i++)if(r[i]&&r[i].options&&r[i].options.id===t)return e(r[i]);return null}getGeometries(){return this.t.geometries?e(this.t.geometries):[]}}function e(t){return t?JSON.parse(JSON.stringify(t)):null}
/*!
	 * @maptalks/video-layer v0.2.2
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.org
	 */
/*!
	* Contains code from THREE.js
	* MIT License
	* https://github.com/mrdoob/three.js
	*/for(var f$1=[],d$1=0;d$1<6;d$1++)f$1[d$1]=[];var v$1=[];function p$1(t,e,i){var r,n,o,s,a,u,h,l,c,d,p,m,_,w,y,b,M;n=(r=t)[0],o=r[1],s=r[2],h=r[5],l=r[6],p=r[9],m=r[10],y=r[13],b=r[14],g$1(f$1[0],(a=r[3])-n,(c=r[7])-(u=r[4]),(_=r[11])-(d=r[8]),(M=r[15])-(w=r[12])),g$1(f$1[1],a+n,c+u,_+d,M+w),g$1(f$1[2],a+o,c+h,_+p,M+y),g$1(f$1[3],a-o,c-h,_-p,M-y),g$1(f$1[4],a-s,c-l,_-m,M-b),g$1(f$1[5],a+s,c+l,_+m,M+b);for(var O=0;O<6;O++)if(!i||"0"!==i.charAt(O)){var S=f$1[O];if(v$1[0]=S[0]>0?e[1][0]:e[0][0],v$1[1]=S[1]>0?e[1][1]:e[0][1],v$1[2]=S[2]>0?e[1][2]:e[0][2],x$1(S,v$1)<0)return!1}return!0}var m$1=1/6;function g$1(t,e,i,r,n){return t[0]=e*m$1,t[1]=i*m$1,t[2]=r*m$1,t[3]=n*m$1,t}function x$1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}var _$1=y$1,w$1=y$1;function y$1(t,e,i){i=i||2;var r,n,o,s,a,u,h,l=e&&e.length,c=l?e[0]*i:t.length,f=b$1(t,0,c,i,!0),d=[];if(!f||f.next===f.prev)return d;if(l&&(f=function(t,e,i,r){var n,o,u,h=[];for(n=0,o=e.length;n<o;n++)(u=b$1(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1))===u.next&&(u.steiner=!0),h.push(R$1(u));for(h.sort(P$1),n=0;n<h.length;n++)V$1(h[n],i),i=M$1(i,i.next);return i}(t,e,f,i)),t.length>80*i){r=o=t[0],n=s=t[1];for(var v=i;v<c;v+=i)(a=t[v])<r&&(r=a),(u=t[v+1])<n&&(n=u),a>o&&(o=a),u>s&&(s=u);h=0!==(h=Math.max(o-r,s-n))?1/h:0}return O$1(f,d,i,r,n,h),d}function b$1(t,e,i,r,n){var o,s;if(n===q$1(t,e,i,r)>0)for(o=e;o<i;o+=r)s=X$1(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=X$1(o,t[o],t[o+1],s);return s&&j$1(s,s.next)&&(z$1(s),s=s.next),s}function M$1(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!j$1(r,r.next)&&0!==L$1(r.prev,r,r.next))r=r.next;else{if(z$1(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function O$1(t,e,i,r,n,o,s){if(t){!s&&o&&function(t,e,i,r){var n=t;do{null===n.z&&(n.z=I$1(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,s,a,u,h=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<h&&(a++,r=r.nextZ);e++);for(u=h;a>0||u>0&&r;)0!==a&&(0===u||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,u--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,h*=2}while(s>1)}(n)}(t,r,n,o);for(var a,u,h=t;t.prev!==t.next;)if(a=t.prev,u=t.next,o?T$1(t,r,n,o):S$1(t))e.push(a.i/i),e.push(t.i/i),e.push(u.i/i),z$1(t),t=u.next,h=u.next;else if((t=u)===h){s?1===s?O$1(t=C$1(M$1(t),e,i),e,i,r,n,o,2):2===s&&E$1(t,e,i,r,n,o):O$1(M$1(t),e,i,r,n,o,1);break}}}function S$1(t){var e=t.prev,i=t,r=t.next;if(L$1(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(A(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&L$1(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function T$1(t,e,i,r){var n=t.prev,o=t,s=t.next;if(L$1(n,o,s)>=0)return!1;for(var h=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,l=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,c=I$1(n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,e,i,r),f=I$1(h,l,e,i,r),d=t.prevZ,v=t.nextZ;d&&d.z>=c&&v&&v.z<=f;){if(d!==t.prev&&d!==t.next&&A(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&L$1(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,v!==t.prev&&v!==t.next&&A(n.x,n.y,o.x,o.y,s.x,s.y,v.x,v.y)&&L$1(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&A(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&L$1(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;v&&v.z<=f;){if(v!==t.prev&&v!==t.next&&A(n.x,n.y,o.x,o.y,s.x,s.y,v.x,v.y)&&L$1(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function C$1(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!j$1(n,o)&&F$1(n,r,r.next,o)&&W$1(n,o)&&W$1(o,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(o.i/i),z$1(r),z$1(r.next),r=t=o),r=r.next}while(r!==t);return M$1(r)}function E$1(t,e,i,r,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&D$1(s,a)){var u=H$1(s,a);return s=M$1(s,s.next),u=M$1(u,u.next),O$1(s,e,i,r,n,o),void O$1(u,e,i,r,n,o)}a=a.next}s=s.next}while(s!==t)}function P$1(t,e){return t.x-e.x}function V$1(t,e){if(e=function(t,e){var i,r=e,n=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===s)return i;var u,h=i,l=i.x,c=i.y,f=1/0;r=i;do{n>=r.x&&r.x>=l&&n!==r.x&&A(o<c?n:s,o,l,c,o<c?s:n,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(n-r.x),W$1(r,t)&&(u<f||u===f&&(r.x>i.x||r.x===i.x&&k$1(i,r)))&&(i=r,f=u)),r=r.next}while(r!==h);return i}(t,e)){var i=H$1(e,t);M$1(e,e.next),M$1(i,i.next)}}function k$1(t,e){return L$1(t.prev,t,e.prev)<0&&L$1(e.next,t,t.next)<0}function I$1(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function R$1(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function A(t,e,i,r,n,o,s,a){return(n-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(i-s)*(e-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function D$1(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&F$1(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(W$1(t,e)&&W$1(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(L$1(t.prev,t,e.prev)||L$1(t,e.prev,e))||j$1(t,e)&&L$1(t.prev,t,t.next)>0&&L$1(e.prev,e,e.next)>0)}function L$1(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function j$1(t,e){return t.x===e.x&&t.y===e.y}function F$1(t,e,i,r){var n=G$1(L$1(t,e,i)),o=G$1(L$1(t,e,r)),s=G$1(L$1(i,r,t)),a=G$1(L$1(i,r,e));return n!==o&&s!==a||!(0!==n||!N$1(t,i,e))||!(0!==o||!N$1(t,r,e))||!(0!==s||!N$1(i,t,r))||!(0!==a||!N$1(i,e,r))}function N$1(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function G$1(t){return t>0?1:t<0?-1:0}function W$1(t,e){return L$1(t.prev,t,t.next)<0?L$1(t,e,t.next)>=0&&L$1(t,t.prev,e)>=0:L$1(t,e,t.prev)<0||L$1(t,t.next,e)<0}function H$1(t,e){var i=new B$1(t.i,t.x,t.y),r=new B$1(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function X$1(t,e,i,r){var n=new B$1(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function z$1(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function B$1(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function q$1(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}y$1.deviation=function(t,e,i,r){var n=e&&e.length,s=Math.abs(q$1(t,0,n?e[0]*i:t.length,i));if(n)for(var a=0,u=e.length;a<u;a++){s-=Math.abs(q$1(t,e[a]*i,a<u-1?e[a+1]*i:t.length,i))}var c=0;for(a=0;a<r.length;a+=3){var f=r[a]*i,d=r[a+1]*i,v=r[a+2]*i;c+=Math.abs((t[f]-t[v])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[v+1]-t[f+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},y$1.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[n][o][s]);n>0&&i.holes.push(r+=t[n-1].length)}return i},_$1.default=w$1;const Z$1={vert:"\n    attribute vec3 aPosition;\n    attribute vec2 aTexCoord;\n    uniform mat4 projViewModelMatrix;\n    uniform mat4 positionMatrix;\n    uniform mat4 modelMatrix;\n    varying vec2 vTexCoords;\n    #include <get_output>\n    void main()\n    {\n        mat4 localPositionMatrix = getPositionMatrix();\n        vec4 localPosition = getPosition(aPosition);\n        gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n        vTexCoords = aTexCoord;\n    }\n",frag:"\n    precision mediump float;\n    uniform sampler2D videoTexture;\n    uniform float opacity;\n\n    varying vec2 vTexCoords;\n    void main() {\n        vec4 color = texture2D(videoTexture, vTexCoords);\n        gl_FragColor = color * opacity;\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>multiply$5([],e.projViewMatrix,e.modelMatrix)},"texture","opacity"],positionAttribute:"POSITION",extraCommandProps:{depth:{enable:!0,func:"always",mask:!1,range:[0,0]},cull:{enable:!1,face:"back"},frontFace:"cw",blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}};function $$1(t,e,i){if(!t)return null;const r=t.coordinateToPointAtRes(e,t.getGLRes());return[r.x,r.y,i]}class J$1 extends t$2.Layer{constructor(t,e,i){super(t,i),this.t={},this.videoId=0,this.addSurfaces(e)}addSurfaces(t){if(t)if(Array.isArray(t))t.forEach((t=>{this.addMarker(t)}));else{t.o=this,this.t[this.videoId]=t,t.s(this.videoId);const e=this.getRenderer();e?e.u()&&e.h(t):this.on("renderercreate",(e=>{e.renderer.u()&&e.renderer.h(t)})),this.videoId++}}getVideoSurfaces(){const t=[];for(const e in this.t)t.push(this.t[e]);return t}removeVideoSurfaces(t){if(Array.isArray(t))t.forEach((t=>{this.removeVideoSurfaces(t)}));else{const e=t.l(),i=this.getRenderer();i&&i.v(e),delete this.t[e]}}clear(){const t=this.getVideoSurfaces();for(let e=0;e<t.length;e++)this.removeVideoSurfaces(t[e])}}J$1.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,markerEvents:!0,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0}),J$1.registerJSONType("VideoLayer"),J$1.registerRenderer("gl",class extends t$2.renderer.CanvasRenderer{constructor(t){super(t),this.p(),this.m={}}draw(t,e){this.prepareCanvas(),this.g(e)}drawOnInteracting(t,e,i){this.g(i)}needToRedraw(){return!0}hitDetect(){return!1}createContext(){if(this.canvas.gl&&this.canvas.gl.wrap)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0};this.glOptions=t,this.gl=this.gl||this._(this.canvas,t),this.regl=u$5({gl:this.gl,extensions:["ANGLE_instanced_arrays","OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","EXT_shader_texture_lod","OES_element_index_uint","OES_standard_derivatives","WEBGL_depth_texture"],optionalExtensions:this.layer.options.glExtensions||[]})}this.M();const t=this.layer.getVideoSurfaces();for(let e=0;e<t.length;e++)this.h(t[e])}_(t,e){const i=["webgl","experimental-webgl"];let r=null;for(let n=0;n<i.length;++n){try{r=t.getContext(i[n],e)}catch(t){}if(r)break}return r}M(){const t=this.layer.getMap(),e=new k$7(this.regl);this.renderer=e,this.O={projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,viewMatrix:t.viewMatrix,halton:[.2107,-.0202],uHalton:[.2107,-.0202],uCameraPosition:t.cameraPosition,cameraPosition:t.cameraPosition,globalTexSize:[t.width,t.height]}}u(){return this.regl}p(){this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},this.S=new rt$6(Z$1)}h(t){const e=this.regl.texture(),i=new ee$3({videoTexture:e,opacity:1}),r=t.getCoordinates(),n=this.T(r),o=new de$4(n,i);this.C(o);const s=new pe$4(o),a=t.l();this.m[a]=s}P(t){const e=t.l(),i=this.m[e].getMeshes()[0],r=t.getCoordinates();i.geometry.dispose();const n=this.T(r);i.geometry=n}g(t){const e=this.layer.getVideoSurfaces().filter((t=>t.isVisible()));if(!e.length)return;const i=this.V(e);if(!i)return;let r=null;t&&(r=t.renderTarget&&t.renderTarget.fbo),this.renderer.render(this.S,this.O,i,r)}T(t){const i=new t$2.Polygon(t).getCenter(),r=this.k(i,t),n=_$1(r,null,3);return new Z$7({POSITION:r,TEXCOORD:[0,0,1,0,1,1,0,1]},n,0,{primitive:"triangles",positionAttribute:"POSITION",uv0Attribute:"TEXCOORD",normalAttribute:"NORMAL",positionSize:3})}k(t,e){let r=[];const n=this.getMap(),o=$$1(n,t,0);return this.I=o,n&&e.forEach((t=>{const e=new t$2.Coordinate(t[0],t[1]),s=$$1(n,e,t[2]);s[0]=s[0]-o[0],s[1]=s[1]-o[1],r=r.concat(s)})),r}V(t){const e=[],i=this.layer.getMap();for(let r=0;r<t.length;r++){const n=t[r],o=this.m[n.l()];if(!o)continue;const s=o.getMeshes();for(let t=0;t<s.length;t++){const r=s[t],o=r.getMaterial(),a=o.get("videoTexture");a&&n.R()&&(a(n.video),o.set("opacity",n.getOpacity())),this.C(r),p$1(i.projViewMatrix,r.getBoundingBox())&&e.push(r)}}return e.length?new pe$4(e):null}C(t){fromRotationTranslationScale(t.localTransform,fromEuler([],0,0,0),this.I,[1,1,1])}clearCanvas(){this.canvas&&(this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas())}v(t){const e=this.m[t];e&&e.getMeshes().forEach((t=>{t.geometry.dispose(),t.material&&t.material.dispose(),t.dispose()}))}});class K$1 extends(t$2.Eventable(t$2.Handlerable(t$2.Class))){constructor(t,e){super(e),this.setCoordinates(t),this.setVideo(this.options.url)}setCoordinates(t){this.A=t}getCoordinates(){return this.A}setVideo(t){this.options.url=t;const e=document.createElement("video");e.src=t,e.autoplay=!0,e.loop=!0,e.muted=!0,e.play(),e.addEventListener("playing",(()=>{this.D="playing"})),e.addEventListener("pause",(()=>{this.D="pause"})),this.video=e}getVideo(){return this.video}s(t){this.L=t}l(){return this.L}addTo(t){if(this.o)throw new Error("VideoSurface cannot be added to two or more layers at the same time.");return t.addSurfaces(this),this}show(){return this.options.visible=!0,this}hide(){return this.options.visible=!1,this}isVisible(){return this.options.visible}play(){this.video&&this.video.play()}pause(){this.video&&this.video.pause()}setAudio(t){this.video.muted=t}setOpacity(t){this.options.opacity=t}getOpacity(){return this.options.opacity}remove(){const t=this.getLayer();t&&t.removeVideoSurfaces(this)}getLayer(){return this.o}R(){return"playing"===this.D||"pause"===this.D}startEdit(){const t=this.getLayer();if(!t)return void console.warn("videosurface should be added to a map before edit");const i=t.getMap();if(!i)return void console.warn("videosurface should be added to a map before edit");if(!this.j){const e=t.getId();this.j=new t$2.VectorLayer(`internal_${e}_edit`).addTo(i)}const r=this.getCoordinates();this.F=new t$2.Polygon(r,{symbol:{lineColor:"#34495e",lineWidth:2,polygonFill:"rgb(135,196,240)",polygonOpacity:.1}}).addTo(this.j),this.F.startEdit({newVertexHandleSymbol:{polygonFill:"rgba(0, 0, 0, 0)",polygonOpacity:0,markerType:"ellipse",markerWidth:1,markerHeight:1}}),this.F.on("shapechange",(e=>{const i=e.target.getCoordinates()[0].slice(0,4).map((t=>[t.x,t.y,0]));this.setCoordinates(i),t.getRenderer().P(this)}),this)}endEdit(){this.j&&(this.F.endEdit(),this.F.remove(),this.j.remove()),delete this.j,delete this.F}}K$1.mergeOptions({opacity:1,visible:!0}),"undefined"!=typeof console&&console.log("@maptalks/video-layer v0.2.2");
/*!
	 * @maptalks/analysis v0.74.0
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.org
	 */
const h=[0,0,0,1];class f{constructor(A,t){this.renderer=A,this.u=t,this.h()}h(){this.l=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.g=new rt$6({vert:"attribute vec3 aPosition;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n\n\nvoid main() {\n\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,n)=>multiply$5([],n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.C=new pe$4}render(A,t){this.D(),this.renderer.clear({color:h,depth:1,framebuffer:this.l}),this.C.setMeshes(A);return this.renderer.render(this.g,{projViewMatrix:t},this.C,this.l),this.l}D(){const A=t__namespace.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t__namespace.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.l||this.l.width===A&&this.l.height===t||this.l.resize(A,t)}dispose(){this.l&&(this.l.destroy(),delete this.l),this.g&&(this.g.dispose(),delete this.g)}}function c(A){return!function(A){return null==A}(A)}function a(A,t){return A.altitudeToPoint(t||0,A.getGLRes())}const v=new t__namespace.Coordinate(0,0);function l(A,t,n,i){if(!A)return null;v.set(t,n);const r=A.coordinateToPointAtRes(v,A.getGLRes()),e=a(A,i);return[r.x,r.y,e]}var w={exports:{}};function P(A,t,n){n=n||2;var i,r,e,s,u,o,h,f=t&&t.length,c=f?t[0]*n:A.length,a=g(A,0,c,n,!0),v=[];if(!a||a.next===a.prev)return v;if(f&&(a=function(A,t,n,i){var r,e,o,h=[];for(r=0,e=t.length;r<e;r++)(o=g(A,t[r]*i,r<e-1?t[r+1]*i:A.length,i,!1))===o.next&&(o.steiner=!0),h.push(p(o));for(h.sort(x),r=0;r<h.length;r++)n=d(h[r],n);return n}(A,t,a,n)),A.length>80*n){i=e=A[0],r=s=A[1];for(var l=n;l<c;l+=n)(u=A[l])<i&&(i=u),(o=A[l+1])<r&&(r=o),u>e&&(e=u),o>s&&(s=o);h=0!==(h=Math.max(e-i,s-r))?32767/h:0}return D(a,v,n,i,r,h,0),v}function g(A,t,n,i,r){var e,s;if(r===k(A,t,n,i)>0)for(e=t;e<n;e+=i)s=S(e,A[e],A[e+1],s);else for(e=n-i;e>=t;e-=i)s=S(e,A[e],A[e+1],s);return s&&F(s,s.next)&&(B(s),s=s.next),s}function C(A,t){if(!A)return A;t||(t=A);var n,i=A;do{if(n=!1,i.steiner||!F(i,i.next)&&0!==O(i.prev,i,i.next))i=i.next;else{if(B(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function D(A,t,n,i,r,e,s){if(A){!s&&e&&function(A,t,n,i){var r=A;do{0===r.z&&(r.z=m(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==A);r.prevZ.nextZ=null,r.prevZ=null,function(A){var t,n,i,r,e,s,u,o,h=1;do{for(n=A,A=null,e=null,s=0;n;){for(s++,i=n,u=0,t=0;t<h&&(u++,i=i.nextZ);t++);for(o=h;u>0||o>0&&i;)0!==u&&(0===o||!i||n.z<=i.z)?(r=n,n=n.nextZ,u--):(r=i,i=i.nextZ,o--),e?e.nextZ=r:A=r,r.prevZ=e,e=r;n=i}e.nextZ=null,h*=2}while(s>1)}(r)}(A,i,r,e);for(var u,o,h=A;A.prev!==A.next;)if(u=A.prev,o=A.next,e?M(A,i,r,e):I(A))t.push(u.i/n|0),t.push(A.i/n|0),t.push(o.i/n|0),B(A),A=o.next,h=o.next;else if((A=o)===h){s?1===s?D(A=b(C(A),t,n),t,n,i,r,e,2):2===s&&z(A,t,n,i,r,e):D(C(A),t,n,i,r,e,1);break}}}function I(A){var t=A.prev,n=A,i=A.next;if(O(t,n,i)>=0)return!1;for(var r=t.x,e=n.x,s=i.x,u=t.y,o=n.y,h=i.y,f=r<e?r<s?r:s:e<s?e:s,c=u<o?u<h?u:h:o<h?o:h,a=r>e?r>s?r:s:e>s?e:s,v=u>o?u>h?u:h:o>h?o:h,l=i.next;l!==t;){if(l.x>=f&&l.x<=a&&l.y>=c&&l.y<=v&&L(r,u,e,o,s,h,l.x,l.y)&&O(l.prev,l,l.next)>=0)return!1;l=l.next}return!0}function M(A,t,n,i){var r=A.prev,e=A,s=A.next;if(O(r,e,s)>=0)return!1;for(var u=r.x,o=e.x,h=s.x,f=r.y,c=e.y,a=s.y,v=u<o?u<h?u:h:o<h?o:h,l=f<c?f<a?f:a:c<a?c:a,w=u>o?u>h?u:h:o>h?o:h,P=f>c?f>a?f:a:c>a?c:a,g=m(v,l,t,n,i),C=m(w,P,t,n,i),D=A.prevZ,I=A.nextZ;D&&D.z>=g&&I&&I.z<=C;){if(D.x>=v&&D.x<=w&&D.y>=l&&D.y<=P&&D!==r&&D!==s&&L(u,f,o,c,h,a,D.x,D.y)&&O(D.prev,D,D.next)>=0)return!1;if(D=D.prevZ,I.x>=v&&I.x<=w&&I.y>=l&&I.y<=P&&I!==r&&I!==s&&L(u,f,o,c,h,a,I.x,I.y)&&O(I.prev,I,I.next)>=0)return!1;I=I.nextZ}for(;D&&D.z>=g;){if(D.x>=v&&D.x<=w&&D.y>=l&&D.y<=P&&D!==r&&D!==s&&L(u,f,o,c,h,a,D.x,D.y)&&O(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;I&&I.z<=C;){if(I.x>=v&&I.x<=w&&I.y>=l&&I.y<=P&&I!==r&&I!==s&&L(u,f,o,c,h,a,I.x,I.y)&&O(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function b(A,t,n){var i=A;do{var r=i.prev,e=i.next.next;!F(r,e)&&E(r,i,i.next,e)&&j(r,e)&&j(e,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(e.i/n|0),B(i),B(i.next),i=A=e),i=i.next}while(i!==A);return C(i)}function z(A,t,n,i,r,e){var s=A;do{for(var u=s.next.next;u!==s.prev;){if(s.i!==u.i&&T(s,u)){var o=Q(s,u);return s=C(s,s.next),o=C(o,o.next),D(s,t,n,i,r,e,0),void D(o,t,n,i,r,e,0)}u=u.next}s=s.next}while(s!==A)}function x(A,t){return A.x-t.x}function d(A,t){var n=function(A,t){var n,i=t,r=A.x,e=A.y,s=-1/0;do{if(e<=i.y&&e>=i.next.y&&i.next.y!==i.y){var u=i.x+(e-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(u<=r&&u>s&&(s=u,n=i.x<i.next.x?i:i.next,u===r))return n}i=i.next}while(i!==t);if(!n)return null;var o,h=n,f=n.x,c=n.y,a=1/0;i=n;do{r>=i.x&&i.x>=f&&r!==i.x&&L(e<c?r:s,e,f,c,e<c?s:r,e,i.x,i.y)&&(o=Math.abs(e-i.y)/(r-i.x),j(i,A)&&(o<a||o===a&&(i.x>n.x||i.x===n.x&&y(n,i)))&&(n=i,a=o)),i=i.next}while(i!==h);return n}(A,t);if(!n)return t;var i=Q(n,A);return C(i,i.next),C(n,n.next)}function y(A,t){return O(A.prev,A,t.prev)<0&&O(t.next,A,A.next)<0}function m(A,t,n,i,r){return(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A=(A-n)*r|0)|A<<8))|A<<4))|A<<2))|A<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(A){var t=A,n=A;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==A);return n}function L(A,t,n,i,r,e,s,u){return(r-s)*(t-u)>=(A-s)*(e-u)&&(A-s)*(i-u)>=(n-s)*(t-u)&&(n-s)*(e-u)>=(r-s)*(i-u)}function T(A,t){return A.next.i!==t.i&&A.prev.i!==t.i&&!function(A,t){var n=A;do{if(n.i!==A.i&&n.next.i!==A.i&&n.i!==t.i&&n.next.i!==t.i&&E(n,n.next,A,t))return!0;n=n.next}while(n!==A);return!1}(A,t)&&(j(A,t)&&j(t,A)&&function(A,t){var n=A,i=!1,r=(A.x+t.x)/2,e=(A.y+t.y)/2;do{n.y>e!=n.next.y>e&&n.next.y!==n.y&&r<(n.next.x-n.x)*(e-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==A);return i}(A,t)&&(O(A.prev,A,t.prev)||O(A,t.prev,t))||F(A,t)&&O(A.prev,A,A.next)>0&&O(t.prev,t,t.next)>0)}function O(A,t,n){return(t.y-A.y)*(n.x-t.x)-(t.x-A.x)*(n.y-t.y)}function F(A,t){return A.x===t.x&&A.y===t.y}function E(A,t,n,i){var r=N(O(A,t,n)),e=N(O(A,t,i)),s=N(O(n,i,A)),u=N(O(n,i,t));return r!==e&&s!==u||!(0!==r||!U(A,n,t))||!(0!==e||!U(A,i,t))||!(0!==s||!U(n,A,i))||!(0!==u||!U(n,t,i))}function U(A,t,n){return t.x<=Math.max(A.x,n.x)&&t.x>=Math.min(A.x,n.x)&&t.y<=Math.max(A.y,n.y)&&t.y>=Math.min(A.y,n.y)}function N(A){return A>0?1:A<0?-1:0}function j(A,t){return O(A.prev,A,A.next)<0?O(A,t,A.next)>=0&&O(A,A.prev,t)>=0:O(A,t,A.prev)<0||O(A,A.next,t)<0}function Q(A,t){var n=new R(A.i,A.x,A.y),i=new R(t.i,t.x,t.y),r=A.next,e=t.prev;return A.next=t,t.prev=A,n.next=r,r.prev=n,i.next=n,n.prev=i,e.next=i,i.prev=e,i}function S(A,t,n,i){var r=new R(A,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function B(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function R(A,t,n){this.i=A,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function k(A,t,n,i){for(var r=0,e=t,s=n-i;e<n;e+=i)r+=(A[s]-A[e])*(A[e+1]+A[s+1]),s=e;return r}w.exports=P,w.exports.default=P,P.deviation=function(A,t,n,i){var r=t&&t.length,s=Math.abs(k(A,0,r?t[0]*n:A.length,n));if(r)for(var u=0,o=t.length;u<o;u++){s-=Math.abs(k(A,t[u]*n,u<o-1?t[u+1]*n:A.length,n))}var c=0;for(u=0;u<i.length;u+=3){var a=i[u]*n,v=i[u+1]*n,l=i[u+2]*n;c+=Math.abs((A[a]-A[l])*(A[v+1]-A[a+1])-(A[a]-A[v])*(A[l+1]-A[a+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},P.flatten=function(A){for(var t=A[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<A.length;r++){for(var e=0;e<A[r].length;e++)for(var s=0;s<t;s++)n.vertices.push(A[r][e][s]);r>0&&n.holes.push(i+=A[r-1].length)}return n};var G=w.exports;class Y extends(t$2.Eventable(t$2.Handlerable(t$2.Class))){constructor(A){super(A),this.I=!0}addTo(A){return A.getMap()?(this.layer=A,this.m()):A.once("add",(()=>{this.addTo(A)}),this),this}m(){const A=this.layer.getRenderer();A?(this.regl=A.regl,this.T(A)):this.layer.once("renderercreate",(A=>{this.regl=A.renderer.regl,this.T(A.renderer)}),this)}enable(){this.I=!0;const A=this.layer.getRenderer();A&&A.setToRedraw()}disable(){this.I=!1;const A=this.layer.getRenderer();A&&A.setToRedraw()}isEnable(){return this.I}remove(){if(this.layer){const A=this.layer;delete this.layer,A.removeAnalysis(this),this.O&&(this.O.dispose(),delete this.O),this.F&&(this.F.dispose(),delete this.F),this.U&&(this.U.forEach((A=>{A.geometry.dispose(),A.dispose()})),delete this.U)}}update(A,t){this.options[A]=t;const n=this.layer.getRenderer();n&&n.setToRedraw()}getExcludeLayers(){return this.options.excludeLayers||[]}setExcludeLayers(A){this.options.excludeLayers=A}exportAnalysisMap(A){let t=this.O.render(A,this.N);t=t.meshesMap?t.meshesMap:t;const n=this.layer.getRenderer();if(t&&n){const A=n.regl,i=t.width,r=t.height,e=new Uint8Array(4*i*r);return A.read({data:e,x:0,y:0,framebuffer:t,width:i,height:r}),e}return null}getAnalysisType(){return this.type}j(A){const t=new t$2.Polygon(A,{symbol:{polygonOpacity:.2}}).getExtent();return this.S(t,A)}S(n,i){const r=this.layer.getMap(),e=r.getCenter(),s=r.getZoom(),u=r.getPitch(),o=r.getBearing(),h=r.getFitZoom(n),c=n.getCenter();r.setZoom(h),r.setCenter(c),r.setPitch(0),r.setBearing(0);const a=r.getExtent();this.B=this.B||[],copy$5(this.B,r.projViewMatrix);const v=l(r,a.xmin,a.ymin),w=l(r,a.xmax,a.ymax),P=[v[0],v[1],w[0],w[1]],g=l(r,n.xmin,n.ymin),C=l(r,n.xmax,n.ymax),D=[g[0],g[1],C[0],C[1]];if(r.setZoom(s),r.setCenter(e),r.setPitch(u),r.setBearing(o),this.U=this.R(i),!this.F){const t=new k$7(this.regl);this.F=new f(t,this.u)}return{extentMap:this.F.render(this.U,this.B),extentInWorld:P,extentPolygon:D}}R(t){const n=[],i=this.layer.getMap();for(let A=0;A<t.length;A++){const r=l(i,...t[A]);n.push(r[0]),n.push(r[1]),n.push(0)}const r=G(n,null,3);if(this.U)this.U.geometry.updateData("POSITION",n);else{const t=new Z$7({POSITION:n},r,0,{positionAttribute:"POSITION"}),i=new de$4(t);this.U=[i]}return this.U}}var DA,q="undefined"!=typeof Float32Array?Float32Array:Array;function W(A){return A[0]=1,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=1,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=1,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A}function V(A,t,n){var i=t[0],r=t[1],e=t[2],s=t[3],u=t[4],o=t[5],h=t[6],f=t[7],c=t[8],a=t[9],v=t[10],l=t[11],w=t[12],P=t[13],g=t[14],C=t[15],D=n[0],I=n[1],M=n[2],b=n[3];return A[0]=D*i+I*u+M*c+b*w,A[1]=D*r+I*o+M*a+b*P,A[2]=D*e+I*h+M*v+b*g,A[3]=D*s+I*f+M*l+b*C,A[4]=(D=n[4])*i+(I=n[5])*u+(M=n[6])*c+(b=n[7])*w,A[5]=D*r+I*o+M*a+b*P,A[6]=D*e+I*h+M*v+b*g,A[7]=D*s+I*f+M*l+b*C,A[8]=(D=n[8])*i+(I=n[9])*u+(M=n[10])*c+(b=n[11])*w,A[9]=D*r+I*o+M*a+b*P,A[10]=D*e+I*h+M*v+b*g,A[11]=D*s+I*f+M*l+b*C,A[12]=(D=n[12])*i+(I=n[13])*u+(M=n[14])*c+(b=n[15])*w,A[13]=D*r+I*o+M*a+b*P,A[14]=D*e+I*h+M*v+b*g,A[15]=D*s+I*f+M*l+b*C,A}function K(A,t,n){var i=n[0],r=n[1],e=n[2];return A[0]=t[0]*i,A[1]=t[1]*i,A[2]=t[2]*i,A[3]=t[3]*i,A[4]=t[4]*r,A[5]=t[5]*r,A[6]=t[6]*r,A[7]=t[7]*r,A[8]=t[8]*e,A[9]=t[9]*e,A[10]=t[10]*e,A[11]=t[11]*e,A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15],A}function H(A,t,n){var i=Math.sin(n),r=Math.cos(n),e=t[4],s=t[5],u=t[6],o=t[7],h=t[8],f=t[9],c=t[10],a=t[11];return t!==A&&(A[0]=t[0],A[1]=t[1],A[2]=t[2],A[3]=t[3],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15]),A[4]=e*r+h*i,A[5]=s*r+f*i,A[6]=u*r+c*i,A[7]=o*r+a*i,A[8]=h*r-e*i,A[9]=f*r-s*i,A[10]=c*r-u*i,A[11]=a*r-o*i,A}function _(A,t,n){var i=Math.sin(n),r=Math.cos(n),e=t[0],s=t[1],u=t[2],o=t[3],h=t[8],f=t[9],c=t[10],a=t[11];return t!==A&&(A[4]=t[4],A[5]=t[5],A[6]=t[6],A[7]=t[7],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15]),A[0]=e*r-h*i,A[1]=s*r-f*i,A[2]=u*r-c*i,A[3]=o*r-a*i,A[8]=e*i+h*r,A[9]=s*i+f*r,A[10]=u*i+c*r,A[11]=o*i+a*r,A}function J(A,t,n){var i=Math.sin(n),r=Math.cos(n),e=t[0],s=t[1],u=t[2],o=t[3],h=t[4],f=t[5],c=t[6],a=t[7];return t!==A&&(A[8]=t[8],A[9]=t[9],A[10]=t[10],A[11]=t[11],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15]),A[0]=e*r+h*i,A[1]=s*r+f*i,A[2]=u*r+c*i,A[3]=o*r+a*i,A[4]=h*r-e*i,A[5]=f*r-s*i,A[6]=c*r-u*i,A[7]=a*r-o*i,A}function Z(A,t){return A[0]=t[12],A[1]=t[13],A[2]=t[14],A}function X(A,t,n,i){var r=t[0],e=t[1],s=t[2],u=t[3],o=r+r,h=e+e,f=s+s,c=r*o,a=r*h,v=r*f,l=e*h,w=e*f,P=s*f,g=u*o,C=u*h,D=u*f,I=i[0],M=i[1],b=i[2];return A[0]=(1-(l+P))*I,A[1]=(a+D)*I,A[2]=(v-C)*I,A[3]=0,A[4]=(a-D)*M,A[5]=(1-(c+P))*M,A[6]=(w+g)*M,A[7]=0,A[8]=(v+C)*b,A[9]=(w-g)*b,A[10]=(1-(c+l))*b,A[11]=0,A[12]=n[0],A[13]=n[1],A[14]=n[2],A[15]=1,A}function $(A,t,n,i,r){var e=1/Math.tan(t/2),s=void 0;return A[0]=e/n,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=e,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,null!=r&&r!==1/0?(A[10]=(r+i)*(s=1/(i-r)),A[14]=2*r*i*s):(A[10]=-1,A[14]=-2*i),A}function AA(A,t,n,i){var r=void 0,e=void 0,s=void 0,u=void 0,o=void 0,h=void 0,f=void 0,c=void 0,a=void 0,v=void 0,l=t[0],w=t[1],P=t[2],g=i[0],C=i[1],D=i[2],I=n[0],M=n[1],b=n[2];return Math.abs(l-I)<1e-6&&Math.abs(w-M)<1e-6&&Math.abs(P-b)<1e-6?W(A):(f=l-I,c=w-M,a=P-b,r=C*(a*=v=1/Math.sqrt(f*f+c*c+a*a))-D*(c*=v),e=D*(f*=v)-g*a,s=g*c-C*f,(v=Math.sqrt(r*r+e*e+s*s))?(r*=v=1/v,e*=v,s*=v):(r=0,e=0,s=0),u=c*s-a*e,o=a*r-f*s,h=f*e-c*r,(v=Math.sqrt(u*u+o*o+h*h))?(u*=v=1/v,o*=v,h*=v):(u=0,o=0,h=0),A[0]=r,A[1]=u,A[2]=f,A[3]=0,A[4]=e,A[5]=o,A[6]=c,A[7]=0,A[8]=s,A[9]=h,A[10]=a,A[11]=0,A[12]=-(r*l+e*w+s*P),A[13]=-(u*l+o*w+h*P),A[14]=-(f*l+c*w+a*P),A[15]=1,A)}function tA(){var A=new q(3);return q!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A}function iA(A,t,n){var i=new q(3);return i[0]=A,i[1]=t,i[2]=n,i}function rA(A,t){return A[0]=t[0],A[1]=t[1],A[2]=t[2],A}function eA(A,t,n,i){return A[0]=t,A[1]=n,A[2]=i,A}function sA(A,t,n){return A[0]=t[0]+n[0],A[1]=t[1]+n[1],A[2]=t[2]+n[2],A}function uA(A,t,n){return A[0]=t[0]-n[0],A[1]=t[1]-n[1],A[2]=t[2]-n[2],A}function oA(A,t){var n=t[0],i=t[1],r=t[2],e=n*n+i*i+r*r;return e>0&&(e=1/Math.sqrt(e),A[0]=t[0]*e,A[1]=t[1]*e,A[2]=t[2]*e),A}function fA(A,t,n){var i=t[0],r=t[1],e=t[2],s=n[3]*i+n[7]*r+n[11]*e+n[15];return A[0]=(n[0]*i+n[4]*r+n[8]*e+n[12])/(s=s||1),A[1]=(n[1]*i+n[5]*r+n[9]*e+n[13])/s,A[2]=(n[2]*i+n[6]*r+n[10]*e+n[14])/s,A}function cA(A,t){var n=iA(A[0],A[1],A[2]),i=iA(t[0],t[1],t[2]);oA(n,n),oA(i,i);var r=function(A,t){return A[0]*t[0]+A[1]*t[1]+A[2]*t[2]}(n,i);return r>1?0:r<-1?Math.PI:Math.acos(r)}function aA(){var A=new q(4);return q!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A[3]=1,A}function vA(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A}function wA(A,t,n){n*=.5;var i=t[0],r=t[1],e=t[2],s=t[3],u=Math.sin(n),o=Math.cos(n);return A[0]=i*o+s*u,A[1]=r*o+e*u,A[2]=e*o-r*u,A[3]=s*o-i*u,A}function PA(A,t,n){n*=.5;var i=t[0],r=t[1],e=t[2],s=t[3],u=Math.sin(n),o=Math.cos(n);return A[0]=i*o-e*u,A[1]=r*o+s*u,A[2]=e*o+i*u,A[3]=s*o-r*u,A}function gA(A,t,n){n*=.5;var i=t[0],r=t[1],e=t[2],s=t[3],u=Math.sin(n),o=Math.cos(n);return A[0]=i*o+r*u,A[1]=r*o-i*u,A[2]=e*o+s*u,A[3]=s*o-e*u,A}function CA(A,t,n,i){var r=.5*Math.PI/180;t*=r,n*=r,i*=r;var e=Math.sin(t),s=Math.cos(t),u=Math.sin(n),o=Math.cos(n),h=Math.sin(i),f=Math.cos(i);return A[0]=e*o*f-s*u*h,A[1]=s*u*f+e*o*h,A[2]=s*o*h-e*u*f,A[3]=s*o*f+e*u*h,A}function IA(A,t,n){return A[0]=t,A[1]=n,A}tA(),function(){var A;A=new q(4),q!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0)}(),tA(),iA(1,0,0),iA(0,1,0),aA(),aA(),DA=new q(9),q!=Float32Array&&(DA[1]=0,DA[2]=0,DA[3]=0,DA[5]=0,DA[6]=0,DA[7]=0),DA[0]=1,DA[4]=1,DA[8]=1,function(){var A=new q(2);q!=Float32Array&&(A[0]=0,A[1]=0)}();var MA="attribute vec3 aPosition;\n\nattribute vec2 aTexCoord;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 cut_projViewMatrixFromViewpoint;\n\nvarying vec4 cut_positionFromViewpoint;\n\nvarying vec2 v_texCoord;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_PointSize = 1.0;\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n    cut_positionFromViewpoint = cut_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n    v_texCoord = aTexCoord;\n\n}\n\n",bA="#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform sampler2D meshesMap;\n\nvarying vec4 cut_positionFromViewpoint;\n\nvarying vec2 v_texCoord;\n\n\n\nvoid main() {\n\n    vec3 shadowCoord = (cut_positionFromViewpoint.xyz / cut_positionFromViewpoint.w)/2.0 + 0.5;\n\n    if (shadowCoord.x > 0.0 && shadowCoord.x < 1.0 && shadowCoord.y > 0.0 && shadowCoord.y < 1.0 && shadowCoord.z < 1.0) {\n\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    } else {\n\n        #ifdef HAS_HELPERPARTS\n\n          gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n\n        #else\n\n          gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n        #endif\n\n        vec2 v = v_texCoord;\n\n    }\n\n}\n\n";const zA={helper:{asset:{generator:"Khronos glTF Blender I/O v1.6.16",version:"2.0"},scene:0,scenes:[{name:"Scene",nodes:[0,1,2,3,4,5,6,7]}],nodes:[{mesh:0,name:"2",scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[-8.534053802490234,0,-9.680065155029297]},{mesh:1,name:"3",rotation:[1,0,0,-4.371138828673793e-8],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[-8.534053802490234,.04612281173467636,9.669971466064453]},{mesh:2,name:"1",rotation:[0,0,-1,-4.371138828673793e-8],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[8.530546188354492,.028526417911052704,-9.667880058288574]},{mesh:3,name:"4",rotation:[0,-1,0,1910685676922942e-30],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[8.530546188354492,0,9.639498710632324]},{mesh:4,name:"X",translation:[.008500291034579277,0,11.816417694091797]},{mesh:5,name:"",scale:[9.5003657913208,9.5003657913208,9.5003657913208]},{mesh:6,name:"Y",rotation:[.5384660959243774,.45831674337387085,-.45831674337387085,-.5384663343429565],translation:[11.712308883666992,0,.32547950744628906]},{mesh:7,name:"Z",scale:[.49277400970458984,.41999998688697815,.49277400970458984],translation:[.0035659661516547203,1.6771862506866455,-11.201739311218262]}],materials:[{doubleSided:!0,name:".015",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".014",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".016",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".013",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".009",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,.800000011920929],metallicFactor:0,roughnessFactor:.5}},{alphaMode:"BLEND",name:"Color_H04",pbrMetallicRoughness:{metallicFactor:0,roughnessFactor:.6000000238418579}},{doubleSided:!0,name:".017",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,.800000011920929],metallicFactor:0,roughnessFactor:.5}},{alphaMode:"BLEND",name:"Color_H04.006",pbrMetallicRoughness:{metallicFactor:0,roughnessFactor:.6000000238418579}},{doubleSided:!0,name:".023",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".022",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".021",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}}],meshes:[{name:".009",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0}]},{name:".010",primitives:[{attributes:{POSITION:4,NORMAL:5,TEXCOORD_0:6},indices:3,material:1}]},{name:".011",primitives:[{attributes:{POSITION:7,NORMAL:8,TEXCOORD_0:9},indices:3,material:2}]},{name:".012",primitives:[{attributes:{POSITION:10,NORMAL:11,TEXCOORD_0:12},indices:3,material:3}]},{name:".004",primitives:[{attributes:{POSITION:13,NORMAL:14,TEXCOORD_0:15},indices:16,material:4},{attributes:{POSITION:17,NORMAL:18,TEXCOORD_0:19},indices:20,material:5}]},{name:".015",primitives:[{attributes:{POSITION:21,NORMAL:22,TEXCOORD_0:23},indices:24}]},{name:".008",primitives:[{attributes:{POSITION:25,NORMAL:26,TEXCOORD_0:27},indices:16,material:6},{attributes:{POSITION:28,NORMAL:29,TEXCOORD_0:30},indices:20,material:7}]},{name:".011",primitives:[{attributes:{POSITION:31,NORMAL:32,TEXCOORD_0:33},indices:34,material:8},{attributes:{POSITION:35,NORMAL:36,TEXCOORD_0:37},indices:38,material:9},{attributes:{POSITION:39,NORMAL:40,TEXCOORD_0:41},indices:42,material:10}]}],accessors:[{bufferView:0,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:1,componentType:5126,count:68,type:"VEC3"},{bufferView:2,componentType:5126,count:68,type:"VEC2"},{bufferView:3,componentType:5123,count:144,type:"SCALAR"},{bufferView:4,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:5,componentType:5126,count:68,type:"VEC3"},{bufferView:6,componentType:5126,count:68,type:"VEC2"},{bufferView:7,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:8,componentType:5126,count:68,type:"VEC3"},{bufferView:9,componentType:5126,count:68,type:"VEC2"},{bufferView:10,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:11,componentType:5126,count:68,type:"VEC3"},{bufferView:12,componentType:5126,count:68,type:"VEC2"},{bufferView:13,componentType:5126,count:32,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:14,componentType:5126,count:32,type:"VEC3"},{bufferView:15,componentType:5126,count:32,type:"VEC2"},{bufferView:16,componentType:5123,count:90,type:"SCALAR"},{bufferView:17,componentType:5126,count:745,max:[.7661519646644592,.011582847684621811,.664243221282959],min:[-.7468101978302002,-.015204675495624542,-.6202079057693481],type:"VEC3"},{bufferView:18,componentType:5126,count:745,type:"VEC3"},{bufferView:19,componentType:5126,count:745,type:"VEC2"},{bufferView:20,componentType:5123,count:1053,type:"SCALAR"},{bufferView:21,componentType:5126,count:4,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:22,componentType:5126,count:4,type:"VEC3"},{bufferView:23,componentType:5126,count:4,type:"VEC2"},{bufferView:24,componentType:5123,count:6,type:"SCALAR"},{bufferView:25,componentType:5126,count:32,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:26,componentType:5126,count:32,type:"VEC3"},{bufferView:27,componentType:5126,count:32,type:"VEC2"},{bufferView:28,componentType:5126,count:745,max:[.7661519646644592,.011582847684621811,.664243221282959],min:[-.7468101978302002,-.015204675495624542,-.6202079057693481],type:"VEC3"},{bufferView:29,componentType:5126,count:745,type:"VEC3"},{bufferView:30,componentType:5126,count:745,type:"VEC2"},{bufferView:31,componentType:5126,count:16,max:[1,1,1],min:[-1,-1,-1],type:"VEC3"},{bufferView:32,componentType:5126,count:16,type:"VEC3"},{bufferView:33,componentType:5126,count:16,type:"VEC2"},{bufferView:34,componentType:5123,count:18,type:"SCALAR"},{bufferView:35,componentType:5126,count:16,max:[1.0000004768371582,-6.847862720489502,1.0000038146972656],min:[-.999999463558197,-8.847862243652344,-.9999960660934448],type:"VEC3"},{bufferView:36,componentType:5126,count:16,type:"VEC3"},{bufferView:37,componentType:5126,count:16,type:"VEC2"},{bufferView:38,componentType:5123,count:18,type:"SCALAR"},{bufferView:39,componentType:5126,count:24,max:[.23352710902690887,-.6051979064941406,.20581023395061493],min:[-.16755716502666473,-7.437830924987793,-.19527404010295868],type:"VEC3"},{bufferView:40,componentType:5126,count:24,type:"VEC3"},{bufferView:41,componentType:5126,count:24,type:"VEC2"},{bufferView:42,componentType:5123,count:36,type:"SCALAR"}],bufferViews:[{buffer:0,byteLength:816,byteOffset:0},{buffer:0,byteLength:816,byteOffset:816},{buffer:0,byteLength:544,byteOffset:1632},{buffer:0,byteLength:288,byteOffset:2176},{buffer:0,byteLength:816,byteOffset:2464},{buffer:0,byteLength:816,byteOffset:3280},{buffer:0,byteLength:544,byteOffset:4096},{buffer:0,byteLength:816,byteOffset:4640},{buffer:0,byteLength:816,byteOffset:5456},{buffer:0,byteLength:544,byteOffset:6272},{buffer:0,byteLength:816,byteOffset:6816},{buffer:0,byteLength:816,byteOffset:7632},{buffer:0,byteLength:544,byteOffset:8448},{buffer:0,byteLength:384,byteOffset:8992},{buffer:0,byteLength:384,byteOffset:9376},{buffer:0,byteLength:256,byteOffset:9760},{buffer:0,byteLength:180,byteOffset:10016},{buffer:0,byteLength:8940,byteOffset:10196},{buffer:0,byteLength:8940,byteOffset:19136},{buffer:0,byteLength:5960,byteOffset:28076},{buffer:0,byteLength:2106,byteOffset:34036},{buffer:0,byteLength:48,byteOffset:36144},{buffer:0,byteLength:48,byteOffset:36192},{buffer:0,byteLength:32,byteOffset:36240},{buffer:0,byteLength:12,byteOffset:36272},{buffer:0,byteLength:384,byteOffset:36284},{buffer:0,byteLength:384,byteOffset:36668},{buffer:0,byteLength:256,byteOffset:37052},{buffer:0,byteLength:8940,byteOffset:37308},{buffer:0,byteLength:8940,byteOffset:46248},{buffer:0,byteLength:5960,byteOffset:55188},{buffer:0,byteLength:192,byteOffset:61148},{buffer:0,byteLength:192,byteOffset:61340},{buffer:0,byteLength:128,byteOffset:61532},{buffer:0,byteLength:36,byteOffset:61660},{buffer:0,byteLength:192,byteOffset:61696},{buffer:0,byteLength:192,byteOffset:61888},{buffer:0,byteLength:128,byteOffset:62080},{buffer:0,byteLength:36,byteOffset:62208},{buffer:0,byteLength:288,byteOffset:62244},{buffer:0,byteLength:288,byteOffset:62532},{buffer:0,byteLength:192,byteOffset:62820},{buffer:0,byteLength:72,byteOffset:63012}],buffers:[{byteLength:63084,uri:"data:application/octet-stream;base64,AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBGuQuv2EECDtIAIC/GuQuv2EECDtIAIC/HOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBAACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAABAAGAAAABgACAAgADAAOAAgADgAKABMAEAAiABMAIgAqAB8AFgAuAB8ALgA3AA0ACQAZAA0AGQAVAAMABwATAAMAEwASAAUAAQARAAUAEQAQAA8ADQAVAA8AFQAeAAkACwAcAAkAHAAZAAcABQAQAAcAEAATAAEAAwASAAEAEgARAAsADwAeAAsAHgAcACgAKwBDACgAQwBAABEAEgAnABEAJwAlABIAEwAqABIAKgAnABAAEQAlABAAJQAiADEANAA2ADEANgAtAD0APwBCAD0AQgA6ACAAIwA7ACAAOwA4ABcAGgAyABcAMgAvACkAIQA5ACkAOQBBACQAJgA+ACQAPgA8ABsAHQA1ABsANQAzABQAGAAwABQAMAAsAAAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgD8AAAAAAACAvwAAgD8AAAAAAACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9b7f79hBAg7UQo6Qdb7f79hBAg7UQo6QRrkLr9hBAg7SACAvxrkLr9hBAg7SACAvxzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QQAAgL8AAAAAAACAvwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAvxrkLr9hBAg7SACAvxrkLr9hBAg7SACAvxrkLr9hBAg7SACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9b7f79hBAg7UQo6Qdb7f79hBAg7UQo6Qdb7f79hBAg7UQo6QRzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QQAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAvwAAgD8AAAAAAACAvwAAgD8AAAAAAACAvxrkLr9WWa49SACAvxrkLr9WWa49SACAvxrkLr9WWa49SACAv9T7f79WWa49SACAv9T7f79WWa49SACAv9T7f79WWa49SACAv9b7f79WWa49UQo6Qdb7f79WWa49UQo6Qdb7f79WWa49UQo6QRzkLr9WWa49UQo6QRzkLr9WWa49UQo6QRzkLr9WWa49UQo6QQAAgL8zGao9AACAvwAAgL8zGao9AACAvwAAgL8zGao9AACAvwAAgL8zGao9AACAPwAAgL8zGao9AACAPwAAgL8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAvwAAgD8zGao9AACAvwAAgD8zGao9AACAvwAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAOhd0sgAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAOhd0sgAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAAAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAOhd0sgAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAOhd0sgAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAAAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/W+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkEa5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL8c5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEAAIC/AAAAAAAAgL8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgL8a5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/W+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkEc5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEAAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL8a5C6/VlmuPUgAgL8a5C6/VlmuPUgAgL8a5C6/VlmuPUgAgL/U+3+/VlmuPUgAgL/U+3+/VlmuPUgAgL/U+3+/VlmuPUgAgL/W+3+/VlmuPVEKOkHW+3+/VlmuPVEKOkHW+3+/VlmuPVEKOkEc5C6/VlmuPVEKOkEc5C6/VlmuPVEKOkEc5C6/VlmuPVEKOkEAAIC/MxmqPQAAgL8AAIC/MxmqPQAAgL8AAIC/MxmqPQAAgL8AAIC/MxmqPQAAgD8AAIC/MxmqPQAAgD8AAIC/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgL8AAIA/MxmqPQAAgL8AAIA/MxmqPQAAgL8AAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAADoXdLIAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAADoXdLIAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAADoXdLIAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAADoXdLIAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBGuQuv2EECDtIAIC/GuQuv2EECDtIAIC/HOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBAACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAACAv8LFR74AAAAAvhR7vxbvw74AAAAAXoNsv9o5Dr8AAAAAMdtUv/MENb8AAAAA8wQ1vzHbVL8AAAAA2jkOv16DbL8AAAAAFe/Dvr4Ue78AAAAAxMVHvgAAgL8AAAAALr07M74Ue78AAAAAwsVHPl+DbL8AAAAAFO/DPjLbVL8AAAAA2TkOP/MENb8AAAAA8wQ1P9k5Dr8AAAAAMttUPxfvw74AAAAAXoNsP8HFR74AAAAAvxR7Py69uzMAAAAAAACAP73FRz4AAAAAvxR7PxXvwz4AAAAAXoNsP9s5Dj8AAAAAMNtUP/IENT8AAAAA9AQ1Py/bVD8AAAAA3TkOP16DbD8AAAAAGu/DPr4Uez8AAAAAxsVHPgAAgD8AAAAALt5Msr4Uez8AAAAAyMVHvl2DbD8AAAAAG+/DvjPbVD8AAAAA1zkOv/UENT8AAAAA8gQ1v9s5Dj8AAAAAMdtUvxXvwz4AAAAAX4Nsv7zFRz4AAAAAvxR7vwAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAEAAgACAAMABAAEAAUABgAGAAcACAAIAAkACgAKAAsADAAMAA0ADgAOAA8AEAAQABEAEgASABMAFAAUABUAFgAWABcAGAAYABkAGgAaABsAHAAcAB0AHgAeAB8AAAAAAAIABAAEAAYACAAIAAoADAAMAA4AEAAQABIAFAAUABYAGAAYABoAHAAcAB4AAAAAAAQACAAIAAwAEAAQABQAGAAYABwAAAAAAAgAEAAQABgAAAAcfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8McFu+mRx5vOP/r74McFu+mRx5vOP/r74McFu+mRx5vOP/r74Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G7/osCq+oRx5vN/bvL7osCq+oRx5vN/bvL7INe69qBx5vOSPxr7INe69qBx5vOSPxr7Q/IK9sBx5vL30zL7Q/IK9sBx5vL30zL7Q/IK9sBx5vL30zL7K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr8APSu8txx5vJ3wz74APSu8txx5vJ3wz77QnjE9vRx5vHt3z77QnjE9vRx5vHt3z7746sU9wxx5vDOLy7746sU9wxx5vDOLy7746sU9wxx5vDOLy74Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA7+MGRg+yBx5vLA7xL6MGRg+yBx5vLA7xL40/Uo+zRx5vGimub40/Uo+zRx5vGimub40/Uo+zRx5vGimub4izto+8Rx5vOq17r4izto+8Rx5vOq17r4izto+8Rx5vOq17r7U0no+0Rx5vA72q77U0no+0Rx5vA72q77U0no+0Rx5vA72q76qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b7SbJM+1Bx5vPdhm77SbJM+1Bx5vPdhm77WL6c+1Rx5vAYtiL7WL6c+1Rx5vAYtiL7WL6c+1Rx5vAYtiL59Hwk/9Rx5vDiasb59Hwk/9Rx5vDiasb59Hwk/9Rx5vDiasb66Yrg+1hx5vJhJZb66Yrg+1hx5vJhJZb66Yrg+1hx5vJhJZb5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr6yasU+1hx5vCieOr6yasU+1hx5vCieOr6yasU+1hx5vCieOr4+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRztGxYA+xRx5vOoPLL69LRw/9Bx5vEj9Ur69LRw/9Bx5vEj9Ur6JIkQ/CB15vAzvY76JIkQ/CB15vAzvY74zFgo/1Bx5vDBIyT3AWYK+pRx5vGN2EL/AWYK+pRx5vGN2EL/AWYK+pRx5vGN2EL/Zw8i+jRx5vKrq9b7Zw8i+jRx5vKrq9b4k6aa+mRx5vGTRBr8tYee+ghx5vDUk2r4tYee+ghx5vDUk2r4tYee+ghx5vDUk2r6UUje+sBx5vGO9F7+UUje+sBx5vGO9F7+UUje+sBx5vGO9F7/EIgG/dxx5vIu/ur7EIgG/dxx5vIu/ur7EIgG/dxx5vIu/ur6oz829uxx5vAaJHL+oz829uxx5vAaJHL+oz829uxx5vAaJHL8qggy/bBx5vGs7mL4qggy/bBx5vGs7mL4qggy/bBx5vGs7mL7AvqW8xhx5vPLFHr/AvqW8xhx5vPLFHr/AvqW8xhx5vPLFHr/goBW/Yxx5vFxGZr7goBW/Yxx5vFxGZr7goBW/Yxx5vFxGZr5QxXc90Bx5vBVrHr9QxXc90Bx5vBVrHr9QxXc90Bx5vBVrHr8WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL7aSYS+kRx5vM4voL7aSYS+kRx5vM4voL7aSYS+kRx5vM4voL6+spi+ihx5vH6rjb6+spi+ihx5vH6rjb5KoKq+ghx5vHN7cb5KoKq+ghx5vHN7cb4qyrm+exx5vPJ1Q74qyrm+exx5vPJ1Q74c88W+dRx5vE0AEr4c88W+dRx5vE0AEr4O6s6+bxx5vFTEu71x5RM/MMU9PFZTjr69LRw/9Bx5vEj9Ur5x5RM/9Rx5vFZTjr69LRw/MsU9PEj9Ur6JIkQ/HsU9PAzvY76JIkQ/HsU9PAzvY769LRw/9Bx5vEj9Ur69LRw/9Bx5vEj9Ur69LRw/MsU9PEj9Ur6JIkQ/CB15vAzvY76JIkQ/CB15vAzvY76JIkQ/CB15vAzvY74zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/1Bx5vDBIyT2JIkQ/HsU9PAzvY74zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0+dd8+zhx5vABTRzs+dd8+zhx5vABTRzszFgo/1Bx5vDBIyT1GxYA+xRx5vOoPLL5GxYA+xRx5vOoPLL5GxYA+YsU9POoPLL5GxYA+YsU9POoPLL4+dd8+WMU9PABTRzuyasU+UMU9PCieOr5GxYA+xRx5vOoPLL5GxYA+YsU9POoPLL6yasU+1hx5vCieOr6yasU+UMU9PCieOr66Yrg+1hx5vJhJZb6yasU+1hx5vCieOr66Yrg+UMU9PJhJZb7WL6c+1Rx5vAYtiL7WL6c+UMU9PAYtiL7SbJM+1Bx5vPdhm77SbJM+UsU9PPdhm77U0no+0Rx5vA72q77U0no+VsU9PA72q740/Uo+zRx5vGimub40/Uo+WsU9PGimub6MGRg+yBx5vLA7xL6MGRg+XsU9PLA7xL746sU9wxx5vDOLy7746sU9YsU9PDOLy77QnjE9aMU9PHt3z77QnjE9vRx5vHt3z74APSu8cMU9PJ3wz74APSu8txx5vJ3wz77Q/IK9dsU9PL30zL7Q/IK9sBx5vL30zL7INe69fsU9POSPxr7INe69qBx5vOSPxr7osCq+hsU9PN/bvL7osCq+oRx5vN/bvL4McFu+jsU9POP/r74McFu+mRx5vOP/r77aSYS+lMU9PM4voL7aSYS+kRx5vM4voL6+spi+nMU9PH6rjb6+spi+ihx5vH6rjb5KoKq+pMU9PHN7cb5KoKq+ghx5vHN7cb4qyrm+qsU9PPJ1Q74qyrm+exx5vPJ1Q74c88W+ssU9PE0AEr4c88W+dRx5vE0AEr4O6s6+uMU9PFTEu70O6s6+bxx5vFTEu70O6s6+uMU9PFTEu70O6s6+uMU9PFTEu70WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4O6s6+bxx5vFTEu70WWhy/zMU9PCkZGL7goBW/xMU9PFxGZr4WWhy/WRx5vCkZGL4WWhy/zMU9PCkZGL7goBW/Yxx5vFxGZr4qggy/usU9PGs7mL4qggy/bBx5vGs7mL7EIgG/sMU9PIu/ur7EIgG/dxx5vIu/ur4tYee+pMU9PDUk2r4tYee+ghx5vDUk2r7Zw8i+mMU9PKrq9b7Zw8i+jRx5vKrq9b4k6aa+jMU9PGTRBr8k6aa+mRx5vGTRBr/AWYK+gsU9PGN2EL/AWYK+pRx5vGN2EL+UUje+dsU9PGO9F7+UUje+sBx5vGO9F7+oz829asU9PAaJHL+oz829uxx5vAaJHL/AvqW8YMU9PPLFHr/AvqW8xhx5vPLFHr9QxXc9VsU9PBVrHr9QxXc90Bx5vBVrHr8Uxg8+TsU9POJ5G78Uxg8+2Bx5vOJ5G78cfF8+4Bx5vDz+Fb8cfF8+RsU9PDz+Fb/K6JU+5xx5vEYODr/K6JU+PsU9PEYODr8Wybk+7Rx5vAjKA78Wybk+OsU9PAjKA78izto+8Rx5vOq17r4izto+NsU9POq17r6qcvg+9Bx5vIbm0b6qcvg+MsU9PIbm0b59Hwk/9Rx5vDiasb59Hwk/MMU9PDiasb7Zw8i+mMU9PKrq9b7Zw8i+mMU9PKrq9b7AWYK+gsU9PGN2EL/AWYK+gsU9PGN2EL/AWYK+gsU9PGN2EL8k6aa+jMU9PGTRBr8tYee+pMU9PDUk2r4tYee+pMU9PDUk2r4tYee+pMU9PDUk2r6UUje+dsU9PGO9F7+UUje+dsU9PGO9F7+UUje+dsU9PGO9F7/EIgG/sMU9PIu/ur7EIgG/sMU9PIu/ur7EIgG/sMU9PIu/ur6oz829asU9PAaJHL+oz829asU9PAaJHL+oz829asU9PAaJHL8qggy/usU9PGs7mL4qggy/usU9PGs7mL4qggy/usU9PGs7mL7AvqW8YMU9PPLFHr/AvqW8YMU9PPLFHr/AvqW8YMU9PPLFHr/goBW/xMU9PFxGZr7goBW/xMU9PFxGZr7goBW/xMU9PFxGZr5QxXc9VsU9PBVrHr9QxXc9VsU9PBVrHr9QxXc9VsU9PBVrHr8WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G7/aSYS+lMU9PM4voL7aSYS+lMU9PM4voL7aSYS+lMU9PM4voL6+spi+nMU9PH6rjb6+spi+nMU9PH6rjb5KoKq+pMU9PHN7cb5KoKq+pMU9PHN7cb4qyrm+qsU9PPJ1Q74qyrm+qsU9PPJ1Q74c88W+ssU9PE0AEr4c88W+ssU9PE0AEr4O6s6+uMU9PFTEu70McFu+jsU9POP/r74McFu+jsU9POP/r74McFu+jsU9POP/r74+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzuyasU+UMU9PCieOr6yasU+UMU9PCieOr6yasU+UMU9PCieOr5GxYA+YsU9POoPLL5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr69LRw/MsU9PEj9Ur69LRw/MsU9PEj9Ur6JIkQ/HsU9PAzvY76JIkQ/HsU9PAzvY74zFgo/UsU9PDBIyT0cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb/osCq+hsU9PN/bvL7osCq+hsU9PN/bvL7INe69fsU9POSPxr7INe69fsU9POSPxr7Q/IK9dsU9PL30zL7Q/IK9dsU9PL30zL7Q/IK9dsU9PL30zL7K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr8APSu8cMU9PJ3wz74APSu8cMU9PJ3wz77QnjE9aMU9PHt3z77QnjE9aMU9PHt3z7746sU9YsU9PDOLy7746sU9YsU9PDOLy7746sU9YsU9PDOLy74Wybk+OsU9PAjKA78Wybk+OsU9PAjKA78Wybk+OsU9PAjKA78Wybk+OsU9PAjKA7+MGRg+XsU9PLA7xL6MGRg+XsU9PLA7xL40/Uo+WsU9PGimub40/Uo+WsU9PGimub40/Uo+WsU9PGimub4izto+NsU9POq17r4izto+NsU9POq17r4izto+NsU9POq17r7U0no+VsU9PA72q77U0no+VsU9PA72q77U0no+VsU9PA72q76qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b7SbJM+UsU9PPdhm77SbJM+UsU9PPdhm77WL6c+UMU9PAYtiL7WL6c+UMU9PAYtiL7WL6c+UMU9PAYtiL59Hwk/MMU9PDiasb59Hwk/MMU9PDiasb59Hwk/MMU9PDiasb66Yrg+UMU9PJhJZb66Yrg+UMU9PJhJZb66Yrg+UMU9PJhJZb4JJda+Yxx5vLwSJT0JJda+Yxx5vLwSJT30Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD4FbAW/XRx5vKwxXr387m2+bRx5vA4gWD787m2+bRx5vA4gWD787m2+bRx5vA4gWD5yeRe/Phx5vIU3gD5yeRe/Phx5vIU3gD5yeRe/Phx5vIU3gD6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz5HOw+/PBx5vCrfpD5HOw+/PBx5vCrfpD5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT56R88+vRx5vOgXPz56R88+vRx5vOgXPz5qPtg+wxx5vLz5Cj6KHsM+thx5vI6NcD6KHsM+thx5vI6NcD6q9LM+rxx5vIhJjz6q9LM+rxx5vIhJjz4aB6I+qBx5vFA3pD4aB6I+qBx5vFA3pD42no0+oBx5vJ67tj42no0+oBx5vJ67tj68GG4+mBx5vLCLxj68GG4+mBx5vLCLxj68GG4+mBx5vLCLxj7oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj9wIi29Yhx5vP6wKT9wIi29Yhx5vP6wKT9wIi29Yhx5vP6wKT8LSxo/zxx5vACviT4LSxo/zxx5vACviT4LSxo/zxx5vACviT5Qgh09axx5vNgLKj9Qgh09axx5vNgLKj9Qgh09axx5vNgLKj9dLBE/xRx5vDzHrj5dLBE/xRx5vDzHrj5dLBE/xRx5vDzHrj74IPM9dhx5vPLOJz/4IPM9dhx5vPLOJz/4IPM9dhx5vPLOJz/rzAU/uhx5vFxL0T7rzAU/uhx5vFxL0T7rzAU/uhx5vFxL0T40+0k+gRx5vEwDIz80+0k+gRx5vEwDIz80+0k+gRx5vEwDIz+KtfA+rxx5vPyv8D6KtfA+rxx5vPyv8D6KtfA+rxx5vPyv8D4eros+jBx5vE68Gz8eros+jBx5vE68Gz8eros+jBx5vE68Gz8yGNI+pBx5vD47Bj8yGNI+pBx5vD47Bj+CPbA+mBx5vEwXEj9OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5eDq++Wxx5vKAwiT5eDq++Wxx5vKAwiT5+252+XBx5vNe4nj5+252+XBx5vNe4nj5+252+XBx5vNe4nj5MHu++PRx5vF5y6D5MHu++PRx5vF5y6D5MHu++PRx5vF5y6D52GIq+Xhx5vMrtsT52GIq+Xhx5vMrtsT52GIq+Xhx5vMrtsT7KedG+QBx5vNygAj/KedG+QBx5vNygAj/KedG+QBx5vNygAj/KedG+QBx5vNygAj8kKmi+YRx5vOSBwj4kKmi+YRx5vOSBwj5sVDi+ZBx5vDQy0D5sVDi+ZBx5vDQy0D5sVDi+ZBx5vDQy0D62dLC+RBx5vO4PDz+2dLC+RBx5vO4PDz+2dLC+RBx5vO4PDz/UcAW+aRx5vH7H2j7UcAW+aRx5vH7H2j7UcAW+aRx5vH7H2j5mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT+omaC9bhx5vAgX4j6omaC9bhx5vAgX4j5g9828dBx5vFAD5j5g9828dBx5vFAD5j5g9828dBx5vFAD5j5g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT/g4+o8exx5vGh85j7g4+o8exx5vGh85j5ITqg9ghx5vJSA4z5ITqg9ghx5vJSA4z6kwwk+iRx5vLwb3T6kwwk+iRx5vLwb3T6kwwk+iRx5vLwb3T6UWT0+kRx5vKxn0z6UWT0+kRx5vKxn0z787m2+bRx5vA4gWD787m2+bRx5vA4gWD6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+Wxx5vPBLZz787m2+usU9PA4gWD6mNry+zMU9PPBLZz5eDq++Wxx5vKAwiT6mNry+Wxx5vPBLZz5eDq++zMU9PKAwiT5+252+XBx5vNe4nj5+252+ysU9PNe4nj52GIq+Xhx5vMrtsT52GIq+yMU9PMrtsT4kKmi+YRx5vOSBwj4kKmi+xsU9POSBwj5sVDi+ZBx5vDQy0D5sVDi+wsU9PDQy0D7UcAW+aRx5vH7H2j7UcAW+vsU9PH7H2j6omaC9bhx5vAgX4j6omaC9uMU9PAgX4j5g9828ssU9PFAD5j5g9828dBx5vFAD5j7g4+o8rMU9PGh85j7g4+o8exx5vGh85j5ITqg9pMU9PJSA4z5ITqg9ghx5vJSA4z6kwwk+nsU9PLwb3T6kwwk+iRx5vLwb3T6UWT0+lsU9PKxn0z6UWT0+kRx5vKxn0z68GG4+jsU9PLCLxj68GG4+mBx5vLCLxj42no0+hsU9PJ67tj42no0+oBx5vJ67tj4aB6I+fsU9PFA3pD4aB6I+qBx5vFA3pD6q9LM+dsU9PIhJjz6q9LM+rxx5vIhJjz6KHsM+cMU9PI6NcD6KHsM+thx5vI6NcD56R88+asU9POgXPz56R88+vRx5vOgXPz5qPtg+ZMU9PLz5Cj5qPtg+wxx5vLz5Cj5qPtg+ZMU9PLz5Cj5qPtg+ZMU9PLz5Cj5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5qPtg+wxx5vLz5Cj5DBCE/TsU9PLwwRT5DBCE/2Bx5vLwwRT4LSxo/WMU9PACviT4LSxo/zxx5vACviT5DBCE/TsU9PLwwRT5dLBE/YsU9PDzHrj5dLBE/xRx5vDzHrj7rzAU/bMU9PFxL0T7rzAU/uhx5vFxL0T6KtfA+dsU9PPyv8D6KtfA+rxx5vPyv8D4yGNI+gsU9PD47Bj8yGNI+pBx5vD47Bj+CPbA+jsU9PEwXEj+CPbA+mBx5vEwXEj8eros+msU9PE68Gz8eros+jBx5vE68Gz80+0k+pMU9PEwDIz80+0k+gRx5vEwDIz/4IPM9sMU9PPLOJz/4IPM9dhx5vPLOJz9Qgh09usU9PNgLKj9Qgh09axx5vNgLKj9wIi29xMU9PP6wKT9wIi29Yhx5vP6wKT/oOvq9zsU9PMe/Jj/oOvq9WRx5vMe/Jj9g00y+URx5vChEIT9g00y+1sU9PChEIT9mlIy+Shx5vC1UGT9mlIy+3MU9PC1UGT+2dLC+RBx5vO4PDz+2dLC+4sU9PO4PDz/KedG+QBx5vNygAj/KedG+5sU9PNygAj9MHu++PRx5vF5y6D5MHu++6MU9PF5y6D5OdQS/PBx5vAomyD5OdQS/6sU9PAomyD5HOw+/PBx5vCrfpD5HOw+/6sU9PCrfpD5yeRe/Phx5vIU3gD5yeRe/6MU9PIU3gD5yeRe/Phx5vIU3gD70Lj+//MU9PKvqiD70Lj+/KRx5vKvqiD5yeRe/6MU9PIU3gD4FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr30Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD70Lj+//MU9PKvqiD4FbAW/XRx5vKwxXr0FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr0JJda+Yxx5vLwSJT0JJda+Yxx5vLwSJT0FbAW/XRx5vKwxXr387m2+bRx5vA4gWD787m2+bRx5vA4gWD787m2+usU9PA4gWD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz5HOw+/6sU9PCrfpD5HOw+/6sU9PCrfpD5eDq++zMU9PKAwiT5eDq++zMU9PKAwiT5+252+ysU9PNe4nj5+252+ysU9PNe4nj5+252+ysU9PNe4nj5MHu++6MU9PF5y6D5MHu++6MU9PF5y6D5MHu++6MU9PF5y6D52GIq+yMU9PMrtsT52GIq+yMU9PMrtsT52GIq+yMU9PMrtsT7KedG+5sU9PNygAj/KedG+5sU9PNygAj/KedG+5sU9PNygAj/KedG+5sU9PNygAj8kKmi+xsU9POSBwj4kKmi+xsU9POSBwj5sVDi+wsU9PDQy0D5sVDi+wsU9PDQy0D5sVDi+wsU9PDQy0D62dLC+4sU9PO4PDz+2dLC+4sU9PO4PDz+2dLC+4sU9PO4PDz/UcAW+vsU9PH7H2j7UcAW+vsU9PH7H2j7UcAW+vsU9PH7H2j5mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT+omaC9uMU9PAgX4j6omaC9uMU9PAgX4j5g9828ssU9PFAD5j5g9828ssU9PFAD5j5g9828ssU9PFAD5j5g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT/g4+o8rMU9PGh85j7g4+o8rMU9PGh85j5ITqg9pMU9PJSA4z5ITqg9pMU9PJSA4z6kwwk+nsU9PLwb3T6kwwk+nsU9PLwb3T6kwwk+nsU9PLwb3T7oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj+UWT0+lsU9PKxn0z6UWT0+lsU9PKxn0z68GG4+jsU9PLCLxj68GG4+jsU9PLCLxj68GG4+jsU9PLCLxj56R88+asU9POgXPz56R88+asU9POgXPz5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5qPtg+ZMU9PLz5Cj6KHsM+cMU9PI6NcD6KHsM+cMU9PI6NcD6q9LM+dsU9PIhJjz6q9LM+dsU9PIhJjz4aB6I+fsU9PFA3pD4aB6I+fsU9PFA3pD42no0+hsU9PJ67tj42no0+hsU9PJ67tj5wIi29xMU9PP6wKT9wIi29xMU9PP6wKT9wIi29xMU9PP6wKT8LSxo/WMU9PACviT4LSxo/WMU9PACviT4LSxo/WMU9PACviT5Qgh09usU9PNgLKj9Qgh09usU9PNgLKj9Qgh09usU9PNgLKj9dLBE/YsU9PDzHrj5dLBE/YsU9PDzHrj5dLBE/YsU9PDzHrj74IPM9sMU9PPLOJz/4IPM9sMU9PPLOJz/4IPM9sMU9PPLOJz/rzAU/bMU9PFxL0T7rzAU/bMU9PFxL0T7rzAU/bMU9PFxL0T40+0k+pMU9PEwDIz80+0k+pMU9PEwDIz80+0k+pMU9PEwDIz+KtfA+dsU9PPyv8D6KtfA+dsU9PPyv8D6KtfA+dsU9PPyv8D4eros+msU9PE68Gz8eros+msU9PE68Gz8eros+msU9PE68Gz8yGNI+gsU9PD47Bj8yGNI+gsU9PD47Bj+CPbA+jsU9PEwXEj/0Lj+//MU9PKvqiD70Lj+//MU9PKvqiD70Lj+//MU9PKvqiD4JJda+xMU9PLwSJT0JJda+xMU9PLwSJT0FbAW/yMU9PKwxXr387m2+usU9PA4gWD787m2+usU9PA4gWD787m2+usU9PA4gWD5yeRe/6MU9PIU3gD5yeRe/6MU9PIU3gD5yeRe/6MU9PIU3gD4eeCG0AACAvyvyJDPYIA20//9/v/jrjTM+Zwm0AACAvwGvAzRUadWzAACAv2wBkzMAAAAAAACAv1sy8rNUadWzAACAv2wBkzMAAAAAAACAv1sy8rMAAAAAAACAv/sMtrMvygK0//9/v6OQjDMt3tWzAACAv4PItjNUadWzAACAv2wBkzMAAAAAAACAv/sMtrM+Zwm0AACAvwGvAzQAAAAAAACAv1sy8rMeeCG0AACAvyvyJDM+Zwm0AACAvwGvAzQeeCG0AACAvyvyJDPYIA20//9/v/jrjTMeeKGzAACAv1bqjzPYIA20//9/v/jrjTPeWvGzAACAv9ZSuDP9L+6zAACAvyhzjjMGTcqzAACAv3rnlTMeeKGzAACAv1bqjzPeWvGzAACAv9ZSuDMeeKGzAACAv1bqjzPeWvGzAACAv9ZSuDMGTcqzAACAv3rnlTP9L+6zAACAvyhzjjMGTcqzAACAv3rnlTMGTcqzAACAv46mqzNGxgi0AACAv0PmizOdo/yzAACAv1rInTP9L+6zAACAvyhzjjMGTcqzAACAv46mqzNGxgi0AACAv0PmizMGTcqzAACAv46mqzNexgi0AACAv4iLizNGxgi0AACAv0PmizOdo/yzAACAv1rInTNexgi0AACAv4iLizOdo/yzAACAv1rInTNomu6zAACAv3yUkjP8kR+0AACAv/n0jjNexgi0AACAv4iLizNomu6zAACAv3yUkjP8kR+0AACAv/n0jjPITQK0AACAvzKJojNomu6zAACAv3yUkjPmvK2zAACAvzROtDP8kR+0AACAv/n0jjPmvK2zAACAvzROtDPITQK0AACAvzKJojOcTQK0AACAvxVtljPmvK2zAACAvzROtDPITQK0AACAvzKJojOcTQK0AACAvxVtljPSscqzAACAv2EalzMCow+0AACAv80alzOcTQK0AACAvxVtljPSscqzAACAv2EalzMCow+0AACAv80alzPEuQG0AACAvy3imTOCvc+zAACAvze8kTPSscqzAACAv2EalzMCow+0AACAv80alzPEuQG0AACAvy3imTNklMOz//9/v+eNlzPEuQG0AACAvy3imTOqIAC0AACAv7IwkjO3aO+zAACAv241pTOCvc+zAACAvze8kTNklMOz//9/v+eNlzNklMOz//9/v+eNlzO3aO+zAACAv241pTOCvc+zAACAvze8kTOqIAC0AACAv7IwkjO3aO+zAACAv241pTOqIAC0AACAv7IwkjPTFk20AACAvxck/zLKARm0AACAv8NAmzMNM4GzAACAv4MQxDPTFk20AACAvxck/zLKARm0AACAv8NAmzPKARm0AACAv8NAmzPTFk20AACAvxck/zJjBjy0AACAv1jUkjMNM4GzAACAv4MQxDNjBjy0AACAv1jUkjPE8rOzAACAv07jlzMNM4GzAACAv4MQxDNjBjy0AACAv1jUkjMT1vWzAACAv1zarjPE8rOzAACAv07jlzMT1vWzAACAv1zarjP0ZdCzAACAv51NhDPE8rOzAACAv07jlzMT1vWzAACAv1zarjMc6N+z//9/v/qUZzP0ZdCzAACAv51NhDO8riO0AACAv7WyjzMc6N+z//9/v/qUZzP0ZdCzAACAv51NhDO8riO0AACAv7WyjzMc6N+z//9/v/qUZzMFsM2zAACAv91zuDO8riO0AACAv7WyjzMt3tWzAACAv4PItjMFsM2zAACAv91zuDMB1km0//9/v1NUFzMvygK0//9/v6OQjDO4TQK0AACAv6h2lDP6wPqzAACAv/jvdzOxluOzAACAv6tQkzMt3tWzAACAv4PItjNHL9OzAACAvxxNvTMFsM2zAACAv91zuDMB1km0//9/v1NUFzMvygK0//9/v6OQjDMAAAAAAACAv/sMtrMB1km0//9/v1NUFzNHL9OzAACAvxxNvTOxluOzAACAv6tQkzNHL9OzAACAvxxNvTP6wPqzAACAv/jvdzOxluOzAACAv6tQkzO4TQK0AACAv6h2lDP6wPqzAACAv/jvdzO4TQK0AACAv6h2lDPFaWI/AAAAAN7p7r7Td2k/AAAAAKQB0r7FaWI/AAAAAN7p7r7Td2k/AAAAAKQB0r5z6te9AAAAAMSSfr9n6te9AAAAAMSSfr9z6te9AAAAAMSSfr9n6te9AAAAAMSSfr9n6te9AAAAAMSSfr9z6te9AAAAAMSSfr8GEVE/AAAAAIS9Ez8JEVE/AAAAAIO9Ez8GEVE/AAAAAIS9Ez8JEVE/AAAAAIO9Ez8JEVE/AAAAAIO9Ez8GEVE/AAAAAIS9Ez9t1i2/AAAAAEXtOz9j1i2/AAAAAEztOz9i1i2/lvevtk3tOz9c1S2/wAFgOXjrOz9t1i2/AAAAAEXtOz9i1i2/lvevtk3tOz9t1i2/AAAAAEXtOz9j1i2/AAAAAEztOz9i1i2/lvevtk3tOz9j1i2/AAAAAEztOz9c1S2/AAAAAHjrOz+uAdc7AP5/PxABCDvX6te9AAAAAMOSfr/X6te9AAAAAMOSfr/X6te9AAAAAMOSfr/X6te9AAAAAMOSfr+1d1q/AAAAAAtvBT+jp1G/AAAAACbjEj+1d1q/AAAAAAtvBT+jp1G/AAAAACbjEj97lz2/AAAAAFgDLD97lz2/AAAAAFgDLD9NiSa/AAAAAIVrQj9NiSa/AAAAAIVrQj8a3Qy/AAAAAKzBVT8a3Qy/AAAAAKzBVT/E6eG+AAAAAMu5ZT/E6eG+AAAAAMu5ZT9Njaa+AAAAAOQRcj9Njaa+AAAAAOQRcj+iGVG+AAAAAPWZej+iGVG+AAAAAPWZej9HoaO9AAAAAP4tfz9HoaO9AAAAAP4tfz924To9AAAAAP+5fz924To9AAAAAP+5fz9dkS4+AAAAAPg/fD9dkS4+AAAAAPg/fD8s0ZU+AAAAAOrJdD8s0ZU+AAAAAOrJdD+kAdI+AAAAANN3aT+kAdI+AAAAANN3aT8LbwU/AAAAALV3Wj8LbwU/AAAAALV3Wj9Awx8/AAAAAJAFSD9Awx8/AAAAAJAFSD9vkzc/AAAAAGVrMj9vkzc/AAAAAGVrMj+ZfUw/AAAAADQBGj+ZfUw/AAAAADQBGj+8LV4/AAAAAP1R/j68LV4/AAAAAP1R/j7ZXWw/AAAAAImdxD7ZXWw/AAAAAImdxD7kEXI/AAAAAE2Npj7kEXI/AAAAAE2Npj6Z04e+AAAAANTTdj+P04e+AAAAANTTdj+Z04e+AAAAANTTdj+P04e+AAAAANTTdj+Z04e+AAAAANTTdj+P04e+AAAAANTTdj/ZXWy/AAAAAImdxL7kEXK/AAAAAE2Npr7kEXK/AAAAAE2Npr7ZXWy/AAAAAImdxL68LV6/AAAAAP1R/r68LV6/AAAAAP1R/r6ZfUy/AAAAADQBGr+ZfUy/AAAAADQBGr9vkze/AAAAAGVrMr9vkze/AAAAAGVrMr9Awx+/AAAAAJAFSL9Awx+/AAAAAJAFSL8LbwW/AAAAALV3Wr8LbwW/AAAAALV3Wr+kAdK+AAAAANN3ab+kAdK+AAAAANN3ab8s0ZW+AAAAAOrJdL8s0ZW+AAAAAOrJdL9dkS6+AAAAAPg/fL9dkS6+AAAAAPg/fL924Tq9AAAAAP+5f7924Tq9AAAAAP+5f79HoaM9AAAAAP4tf79HoaM9AAAAAP4tf7+iGVE+AAAAAPWZer+iGVE+AAAAAPWZer9NjaY+AAAAAOQRcr9NjaY+AAAAAOQRcr/E6eE+AAAAAMu5Zb/E6eE+AAAAAMu5Zb8a2ww/AAAAAKzBVb8a2ww/AAAAAKzBVb9NiSY/AAAAAIVpQr9NiSY/AAAAAIVpQr97lz0/AAAAAFgDLL97lz0/AAAAAFgDLL+jp1E/AAAAACbjEr+jp1E/AAAAACbjEr8AAAAAAACAP99/b7ToFs0zAACAPztbCbQAAAAAAACAP99/b7ToFs0zAACAPztbCbQVuM4zAACAPxB8JrMAAAAAAACAP99/b7ToFs0zAACAPztbCbQVuM4zAACAPxB8JrPGBA00AACAP04+17MVuM4zAACAPxB8JrNaC/4zAACAP9AmXLPGBA00AACAP04+17NaC/4zAACAP9AmXLNvSAo0AACAPwePZLPGBA00AACAP04+17Ow0OozAACAP6P0tbNaC/4zAACAP9AmXLNvSAo0AACAPwePZLOw0OozAACAP6P0tbNvSAo0AACAPwePZLM4mxA0AACAP94+m7Ow0OozAACAP6P0tbMDsPQzAACAP9OilLM4mxA0AACAP94+m7MDsPQzAACAP9OilLOB+wY0AACAPyWKabM4mxA0AACAP94+m7NMxNwzAACAP09Bs7MDsPQzAACAP9OilLOB+wY0AACAPyWKabPxA7UzAACAP67AxbNMxNwzAACAP09Bs7Oigewz//9/P+Fg1rPR4+4zAACAPwWMmrMINPIzAACAP9R1vbNU4PwzAACAP6VWQrOB+wY0AACAPyWKabNn3g80//9/P5hCdLPus1O1AACAP1RpgrVMxNwzAACAP09Bs7MfDQw0AACAPweLmLNn3g80//9/P5hCdLPus1O1AACAP1RpgrUINPIzAACAP9R1vbNn3g80//9/P5hCdLPxA7UzAACAP67AxbMINPIzAACAP9R1vbPxA7UzAACAP67AxbNU4PwzAACAP6VWQrOigewz//9/P+Fg1rNU4PwzAACAP6VWQrOigewz//9/P+Fg1rPR4+4zAACAPwWMmrPR4+4zAACAPwWMmrPus1O1AACAP1RpgrWDL7y0AACAP8e4RTMfDQw0AACAPweLmLOOm8kzAACAP4A1pbNX6/YzAACAP4WIm7OyGPczAACAP6NlnLNsGvczAACAP7AwkrNx1gE0AACAPzDFo7NX6/YzAACAP4WIm7OyGPczAACAP6NlnLPCqgM0AACAP6X6m7NX6/YzAACAP4WIm7MUIfYzAACAPyr6m7OyGPczAACAP6NlnLNx1gE0AACAPzDFo7PCqgM0AACAP6X6m7OOm8kzAACAP4A1pbNx1gE0AACAPzDFo7OOm8kzAACAP4A1pbNsGvczAACAP7AwkrNsGvczAACAP7AwkrODL7y0AACAP8e4RTM91skzAACAPz/yJLMfDQw0AACAPweLmLM+5Q80AACAPzbdabMZ3mc0//9/P/75HrODL7y0AACAP8e4RTMZ3mc0//9/P/75HrM91skzAACAPz/yJLMZ3mc0//9/P/75HrPPVJIz//9/P5ozCrQ91skzAACAPz/yJLM+5Q80AACAPzbdabPPVJIz//9/P5ozCrQDMO4zAACAP8z6t7NbmQE0AACAP3jnlbM+5Q80AACAPzbdabPT9xg0AACAP8ew/7LPVJIz//9/P5ozCrTT9xg0AACAP8ew/7JbmQE0AACAP3jnlbPT9xg0AACAP8ew/7LNVbczAACAP9yCzLMDMO4zAACAP8z6t7NbmQE0AACAP3jnlbPNVbczAACAP9yCzLMDMO4zAACAP8z6t7PyDfUzAACAPzLsqbOdo/wzAACAP1PInbPNVbczAACAP9yCzLPyDfUzAACAPzLsqbPyDfUzAACAPzLsqbMIwfozAACAP5GLi7Odo/wzAACAP1PInbMIwfozAACAP5GLi7OBo/wzAACAP1gyfLOdo/wzAACAP1PInbPdwPozAACAP97yVbMIwfozAACAP5GLi7OBo/wzAACAP1gyfLPdwPozAACAP97yVbOBo/wzAACAP1gyfLOuTQI0AACAP24GkrPKTQI0AACAPx1RirPdwPozAACAP97yVbOuTQI0AACAP24GkrOk4+4zAACAPzvBurOuTQI0AACAP24GkrPKTQI0AACAPx1RirOk4+4zAACAPzvBurMUIfYzAACAPyr6m7PKTQI0AACAPx1RirOk4+4zAACAPzvBurMUIfYzAACAPyr6m7PCqgM0AACAP6X6m7PA8hK0//9/v4LkkjOSF/Sz//9/v1t7mDOg9f+7oPV/v7H0grzA8hK0//9/v4LkkjOSF/Sz//9/v1t7mDPA8hK0//9/v4LkkjOg9f+7oPV/v7H0grySF/Sz//9/v1t7mDO/zMw57/9/v8Cotjqg9f+7oPV/v7H0grxtqQW0AACAv4YwpDO/zMw57/9/v8CotjoBQg60AACAv44alzNtqQW0AACAv4YwpDOapuezAACAv5IalzO/zMw57/9/v8CotjptqQW0AACAv4YwpDOapuezAACAv5IalzMeeCG0AACAv6F1vTPbuRe0AACAv5pQkzOCdQS0AACAv06elTOlWvGzAACAv3GmdDOt4+6zAACAvzWBlzPdZeezAACAv/hIlzNI9eOzAACAv3ssqTPQ6+KzAACAv1AdgTMAAAAAAACAv8iawDOt4+6zAACAvzWBlzNI9eOzAACAv3ssqTOt4+6zAACAvzWBlzPbuRe0AACAv5pQkzNI9eOzAACAv3ssqTPbuRe0AACAv5pQkzOlWvGzAACAv3GmdDMeeCG0AACAv6F1vTOlWvGzAACAv3GmdDMeeCG0AACAv6F1vTMAAAAAAACAv8iawDPQ6+KzAACAv1AdgTOmGs6zAACAv9nYDTQAAAAAAACAv8iawDMC1AS0//9/v4IBlTOCdQS0AACAv06elTPQ6+KzAACAv1AdgTOmGs6zAACAv9nYDTTuNXKzAACAv31SazMn7hi0AACAv3gntzOCdQS0AACAv06elTPdZeezAACAv/hIlzMn7hi0AACAv3gntzNakPKzAACAv2U/mzPdZeezAACAv/hIlzMn7hi0AACAv3gntzNp4wy0AACAv8hMhDNakPKzAACAv2U/mzNp4wy0AACAv8hMhDPT1vWzAACAv0bZrjNakPKzAACAv2U/mzNp4wy0AACAv8hMhDPYC/6zAACAv07jlzPT1vWzAACAv0bZrjPYC/6zAACAv07jlzPT1vWzAACAv0bZrjOGBryzAACAvznWkjPYC/6zAACAv07jlzPHts6zAACAvyQRxDOGBryzAACAvznWkjPHts6zAACAvyQRxDOGBryzAACAvznWkjNDFk2zAACAv2If/zLHts6zAACAvyQRxDNDFk2zAACAv2If/zIAAAAAAACAv65CmzNDFk2zAACAv2If/zIAAAAAAACAv65CmzMAAAAAAACAv65CmzMBQg60AACAv44alzOcpuezAACAvxeJojOapuezAACAv5IalzOjdMOz//9/vx9tljMBQg60AACAv44alzOjdMOz//9/vx9tljNiKQ20AACAvzO7mDOcpuezAACAvxeJojOjdMOz//9/vx9tljNSyBC0AACAv0C7mDNiKQ20AACAvzO7mDOcpuezAACAvxeJojNSyBC0AACAv0C7mDNiKQ20AACAvzO7mDMaLNmzAACAv+FtlzNSyBC0AACAv0C7mDNKW++zAACAv/dUtTNjkeCzAACAv4LInTMaLNmzAACAv+FtlzNKW++zAACAv/dUtTMaLNmzAACAv+FtlzNKW++zAACAv/dUtTNjkeCzAACAv4LInTPPXbazAACAvwnmizMAbSi0AACAv0+3kjNjkeCzAACAv4LInTPPXbazAACAvwnmizMAbSi0AACAv0+3kjPPXbazAACAvwnmizPKXbaz//9/vx/YoTMAbSi0AACAv0+3kjN7UwS0AACAv9makjMfbeCzAACAv0DolTPKXbaz//9/vx/YoTMfbeCzAACAv0DolTPKXbaz//9/vx/YoTNbkAS0AACAvydkhTN7UwS0AACAv9makjMfbeCzAACAv0DolTNpnRq0AACAv8gDnDMC1AS0//9/v4IBlTNbkAS0AACAvydkhTN7UwS0AACAv9makjNqj6uzAACAv/ODvjNpnRq0AACAv8gDnDNbkAS0AACAvydkhTNpnRq0AACAv8gDnDNqj6uzAACAv/ODvjMC1AS0//9/v4IBlTNqj6uzAACAv/ODvjPuNXKzAACAv31SazOmGs6zAACAv9nYDTTuNXKzAACAv31SazMtBN89AAAAAEh6fj8wBN89AAAAAEd6fj8tBN89AAAAAEh6fj8wBN89AAAAAEd6fj8tBN89AAAAAEh6fj8wBN89AAAAAEd6fj+1d1o/AAAAAAtvBb+jp1E/AAAAACbjEr+1d1o/AAAAAAtvBb+jp1E/AAAAACbjEr97lz0/AAAAAFgDLL97lz0/AAAAAFgDLL9NiSY/AAAAAIVpQr9NiSY/AAAAAIVpQr8a2ww/AAAAAKzBVb8a2ww/AAAAAKzBVb/E6eE+AAAAAMu5Zb/E6eE+AAAAAMu5Zb9NjaY+AAAAAOQRcr9NjaY+AAAAAOQRcr+iGVE+AAAAAPWZer+iGVE+AAAAAPWZer9HoaM9AAAAAP4tf79HoaM9AAAAAP4tf7924Tq9AAAAAP+5f7924Tq9AAAAAP+5f79dkS6+AAAAAPg/fL9dkS6+AAAAAPg/fL8s1ZW+AAAAAOrJdL8s1ZW+AAAAAOrJdL+kAdK+AAAAANN3ab+kAdK+AAAAANN3ab8LbwW/AAAAALV3Wr8LbwW/AAAAALV3Wr9Awx+/AAAAAJAFSL9Awx+/AAAAAJAFSL9vkze/AAAAAGVrMr9vkze/AAAAAGVrMr+ZfUy/AAAAADQBGr+ZfUy/AAAAADQBGr+8LV6/AAAAAP1R/r68LV6/AAAAAP1R/r7ZXWy/AAAAAImdxL7ZXWy/AAAAAImdxL7kEXK/AAAAAE2Npr7kEXK/AAAAAE2Npr6Z04c+AAAAANTTdr+Z04c+AAAAANLTdr+Z04c+AAAAANTTdr+Z04c+AAAAANLTdr+Z04c+AAAAANTTdr+Z04c+AAAAANLTdr/kEXI/AAAAAE2Npj7ZXWw/AAAAAImdxD7ZXWw/AAAAAImdxD7kEXI/AAAAAE2Npj68LV4/AAAAAP1R/j68LV4/AAAAAP1R/j6ZfUw/AAAAADQBGj+ZfUw/AAAAADQBGj9vkzc/AAAAAGVrMj9vkzc/AAAAAGVrMj9Awx8/AAAAAJAFSD9Awx8/AAAAAJAFSD8LbwU/AAAAALV3Wj8LbwU/AAAAALV3Wj+kAdI+AAAAANN3aT+kAdI+AAAAANN3aT8s0ZU+AAAAAOrJdD8s0ZU+AAAAAOrJdD9dkS4+AAAAAPg/fD9dkS4+AAAAAPg/fD924To9AAAAAP+5fz924To9AAAAAP+5fz9HoaO9AAAAAP4tfz9HoaO9AAAAAP4tfz+iGVG+AAAAAPWZej+iGVG+AAAAAPWZej9Njaa+AAAAAOQRcj9Njaa+AAAAAOQRcj/E6eG+AAAAAMu5ZT/E6eG+AAAAAMu5ZT8a2wy/AAAAAKzBVT8a2wy/AAAAAKzBVT9NiSa/AAAAAIVrQj9NiSa/AAAAAIVrQj97lz2/AAAAAFgDLD97lz2/AAAAAFgDLD+jp1G/AAAAACbjEj+jp1G/AAAAACbjEj/FaWK/AAAAAN7p7j7FaWK/AAAAAN7p7j7Td2m/AAAAAKQB0j7Td2m/AAAAAKQB0j5IA989AAAAAEp6fj9IA989AAAAAEp6fj9IA989AAAAAEp6fj9IA989AAAAAEp6fj+MlFG/AAAAALUCE7+HlFG/AAAAAL8CE7+MlFG/AAAAALUCE7+HlFG/AAAAAL8CE7+HlFG/AAAAAL8CE7+MlFG/AAAAALUCE79rLi0/u+QTNiGIPL9tLi0/AAAAACKIPL9xLi0/AAAAAB6IPL9rLi0/u+QTNiGIPL9xLi0/AAAAAB6IPL9xLi0/AAAAAB6IPL9rLi0/u+QTNiGIPL9tLi0/AAAAACKIPL9tLi0/AAAAACKIPL+cpuczAACAP706krMJIfYzAACAPwhRirPCTQI0//9/P/wxZLMDQg40AACAP786krOJzEy6q/9/P70fSrsKxd4zAACAPy1doLOcpuczAACAP706krMDQg40AACAP786krMKxd4zAACAPy1doLOcpuczAACAP706krPCTQI0//9/P/wxZLMDQg40AACAP786krMJIfYzAACAPwhRirOXTQI0AACAP5AGkrPCTQI0//9/P/wxZLPqpuczAACAPxfhqLMJIfYzAACAPwhRirOXTQI0AACAP5AGkrMgLNkzAACAP46mr7PqpuczAACAPxfhqLOXTQI0AACAP5AGkrMgLNkzAACAP46mr7PqpuczAACAPxfhqLNymu4z//9/P33InbN2xgg0AACAPymMi7MgLNkzAACAP46mr7N2xgg0AACAPymMi7NI9eMzAACAP+7rqbNymu4z//9/P33InbN2xgg0AACAPymMi7PLjNkzAACAPy7ZirNI9eMzAACAP+7rqbNymu4z//9/P33InbPLjNkzAACAPy7ZirNI9eMzAACAP+7rqbNSxgg0AACAPzElfLPLjNkzAACAPy7ZirPk3/wzAACAPzzolbOYBAE0AACAP2wCrbNSxgg0AACAPzElfLPk3/wzAACAPzzolbNSxgg0AACAPzElfLOmTcozAACAP2uos7Pk3/wzAACAPzzolbOYBAE0AACAP2wCrbPrd6EzAACAP1VHFbSmTcozAACAP2uos7NaYd0z//9/P4IBlbOYBAE0AACAP2wCrbM8AzU0AACAPxCjSbOmTcozAACAP2uos7M8AzU0AACAPxCjSbPrd6EzAACAP1VHFbQ8AzU0AACAPxCjSbPrd6EzAACAP1VHFbRaYd0z//9/P4IBlbNQeSE0AACAP4dSa7MAAAAAAACAP+jSZbNaYd0z//9/P4IBlbPQ6+IzAACAPw2bl7O91gU0AACAPz72b7NQeSE0AACAP4dSa7MAAAAAAACAP+jSZbNQeSE0AACAP4dSa7MAAAAAAACAP+jSZbPQ6+IzAACAPw2bl7Pm7jw0AACAP5mawLOnTQI0AACAP392lLNexgg0AACAPwDwd7Mop7Uz//9/P6h1vbPcr80zAACAPyjNubPQ6+IzAACAPw2bl7Ns4PwzAACAP4RWQrOnTQI0AACAP392lLO91gU0AACAPz72b7P3wgc0AACAPynAxbNexgg0AACAPwDwd7Pm7jw0AACAP5mawLOnTQI0AACAP392lLNs4PwzAACAP4RWQrNexgg0AACAPwDwd7Ns4PwzAACAP4RWQrP3wgc0AACAPynAxbMop7Uz//9/P6h1vbP3wgc0AACAPynAxbMop7Uz//9/P6h1vbPm7jw0AACAP5mawLPcr80zAACAPyjNubML3wE0AACAP+HCirO91gU0AACAPz72b7Pcr80zAACAPyjNubML3wE0AACAP+HCirOCnAI0AACAP8CQoLPh2bszAACAP9rfprML3wE0AACAP+HCirOCnAI0AACAP8CQoLPh2bszAACAP9rfprOCnAI0AACAP8CQoLM6phk0AACAP1dkerPh2bszAACAP9rfprNL9gY0AACAP73yJrM6phk0AACAP1dkerNL9gY0AACAP73yJrM6phk0AACAP1dkerMksBw0AACAPwfZHLMVCZszAACAP1pxGrRL9gY0AACAP73yJrMksBw0AACAPwfZHLMvFk0zAACAP/6ZsLMVCZszAACAP1pxGrQksBw0AACAPwfZHLMvFk0zAACAP/6ZsLOBApkzAACAP65Cm7MVCZszAACAP1pxGrQvFk0zAACAP/6ZsLOBApkzAACAP65Cm7OBApkzAACAP65Cm7MAAAAAqv9/P7lLUzsgbNwzAACAP3x4o7OSF/Qz//9/P1XrkLMgbNwzAACAP3x4o7OSF/Qz//9/P1XrkLMgbNwzAACAP3x4o7OJzEy6q/9/P70fSrsAAAAAqv9/P7lLUzuSF/Qz//9/P1XrkLOJzEy6q/9/P70fSrsAAAAAqv9/P7lLUzsKxd4zAACAPy1doLMAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwMABQAKAAYABAANAAwAAgAPAA4AAAAQABEAAQATABIAFwAZABgAFAAaABsAFgAdABwAFQAhAB4AIgAkACMAHwAmACcAIAApACUAKAAsAC0AKgAwACsALgAyADMAMQA2ADQALwA3ADUAOAA7ADwAOQBAADoAPQBBAEMASABJAEQAQgA+AEcAPwBLAEYASgBNAEUATABOAFAAUwBUAFIATwBVAFcAUQBaAFYAWABbAF0AWQBgAFwAXgBhAGMAXwBmAGIAZQBoAGcAZABqAGkAbAB0AHIAawAJAG4ACAB2AG0AdQB4AHMAeQB7AHEAegB9AHAAfAB/AG8AfgCAAHcACwAHAIEAggCDAIIAgQCEAIYAiACJAIcAhQCKAIwAjgCPAI0AiwCQAJEAlQCXAJYAkwCZAJgAkgCaAJsAlACcAJ0AngCfAJ4AnQCgAKEAogCjAKIAoQCkAKQApQCiAKUApACmAKYApwClAKcApgCoAKgAqQCnAKkAqACqAKoAqwCpAKsAqgCsAKwArQCrAK0ArACuAK4ArwCtAK8ArgCwAK8AsQCyALEArwCwALIAswC0ALMAsgCxALQAtQC2ALUAtACzALYAtwC4ALcAtgC1ALgAuQC6ALkAuAC3ALoAuwC8ALsAugC5ALwAvQC+AL0AvAC7AL4AvwDAAL8AvgC9AMAAwQDCAMEAwAC/AMIAwwDEAMMAwgDBAMQAxQDGAMUAxADDAMYAxwDIAMcAxgDFAMkAywDNAMwAygDOAM8A0ADRANAAzwDSANMA0gDPANIA0wDUANUA1ADTANQA1QDWANcA1gDVANYA1wDYANkA2ADXANgA2QDaANsA2gDZANoA2wDcAN0A3ADbANwA3QDeAN8A3gDdAN4A3wDgAOEA4ADfAOAA4QDiAOMA4gDhAOIA4wDkAOUA5ADjAOQA5QDmAOcA5gDlAOYA5wDoAOcA6QDoAOkA5wDqAOoA6wDpAOsA6gDsAOwA7QDrAO0A7ADuAO4A7wDtAO8A7gDwAPAA8QDvAPEA8ADyAPIA8wDxAPMA8gD0APQAgwDzAIMA9ACBAPUA9wD6APgA9gD7APkA/AD+AAAB/QADAf8AAQEFAQYBAgEIAQQBBwEKAQwBCQEPAQsBDQERARIBDgEZARABFAEcAR4BGgEhASABFwEjASIBEwEkASUBGAEnASYBFQEoASkBFgEqARsBHwErAS8BMwE2ATQBMAE4ATkBMgE8ATsBLgE9AT4BMQE/AS0BQgEdAUABLAFFAUQBRgFIAUEBRwFKAUMBSwFPAUwBSQFRAVABUgFUAU4BUwFXAU0BVgFZAVgBVQFcAVoBXQFeAVsBYAFjAWEBXwFlAWIBZgFoAWcBZAFrAWkBbAFuAWoBbwFyAXABbQFzAXEBdAE3AToBdQE1AXYBeQF7AXoBdwF9AXgBfAF/AYEBfgGFAYABgwGGAYwBkQGTAZIBjgGVAZQBiQGWAZcBiwGZAZgBiAGaAZsBkAGeAZwBjwGhAaABigGlAaYBjQGpAaQBpwGqAawBqAGvAasBrQGwAbIBrgG0AbEBswG2AbgBtQG6AbcBuQG8Ab0BuwG/Ab4BwAHBAYQBxAGHAcIBggHGAcUBxwHKAcMByQHNAcwByAHPAcsBzgHRAdQB0AHWAdIB1QHXAdMB2AHbAdwB2QHeAdoB3QHgAeMB3wHlAeIB5AHoAeEB5wHsAesB5gHvAekB7gHwAe0B8QHzAeoB8gGfAaMB9AH2AaIB9QGdAfcB+QH7AfoB+AH8Af0B/gH/Af4B/QEAAgACAQL+AQECAAICAgICAwIBAgMCAgIEAgQCBQIDAgUCBAIGAgYCBwIFAgcCBgIIAggCCQIHAgkCCAIKAgoCCwIJAgsCCgIMAg0CCwIMAgsCDQIOAg8CDgINAg4CDwIQAhECEAIPAhACEQISAhMCEgIRAhICEwIUAhUCFAITAhQCFQIWAhcCFgIVAhYCFwIYAhkCGAIXAhgCGQIaAhsCGgIZAhoCGwIcAh0CHAIbAhwCHQIeAh8CHgIdAh4CHwIgAiECIAIfAiACIQIiAiMCIgIhAiICIwIkAiUCJwIpAigCJgIqAisCLAItAiwCKwIuAi0CLwIwAi8CLQIsAjACMQIyAjECMAIvAjICMwI0AjMCMgIxAjQCNQI2AjUCNAIzAjYCNwI4AjcCNgI1AjgCOQI6AjkCOAI3AjoCOwI8AjsCOgI5AjwCPQI+Aj0CPAI7Aj4CPwJAAj8CPgI9AkACQQJCAkECQAI/AkICQwJEAkMCQgJBAkMCRQJEAkUCQwJGAkYCRwJFAkcCRgJIAkgCSQJHAkkCSAJKAkoCSwJJAksCSgJMAkwCTQJLAk0CTAJOAk4CTwJNAk8CTgJQAlACUQJPAlECUAJSAlICUwJRAlMCUgJUAlUCVgJXAlYCVQJYAloCXAJdAlsCWQJeAmECYwJkAmICXwJlAmYCYAJnAmgCbgJxAm8CawJzAnICagJ2AnQCaQJ4AnUCeQJ8AnsCdwJ+AnoCfQKBAoICgAKFAoQCfwKIAoMChwKKAokChgKMAosCjwKRApACjQKTApQCjgKYApIClgKaApsCmQKdApwClQKeAp8ClwKiAqACpQKnAqYCoQKoAqsCsQK2ArQCrAK4ArACtwK5ArMCugK8Aq0CuwK9ArUCvgKqAq8CqQKjArICpALBAq4CvwLCAsMCwALGAsQCxwLJAsgCxQLLAsoCzQLPAs4CzALSAtAC0wLWAtUC0QLZAtQC1wLaAtsC2ALcAt4C4ALiAuEC3wLlAuQC3QLnAuMC5gJsAm0C6AJwAgAAAACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAIA/AACAPwAAAAAAAAAAAACAPwAAAAAAAAEAAwAAAAMAAgAAAAAAAAAAAAAAgL/CxUe+AAAAAL4Ue78W78O+AAAAAF6DbL/aOQ6/AAAAADHbVL/zBDW/AAAAAPMENb8x21S/AAAAANo5Dr9eg2y/AAAAABXvw76+FHu/AAAAAMTFR74AAIC/AAAAAC69OzO+FHu/AAAAAMLFRz5fg2y/AAAAABTvwz4y21S/AAAAANk5Dj/zBDW/AAAAAPMENT/ZOQ6/AAAAADLbVD8X78O+AAAAAF6DbD/BxUe+AAAAAL8Uez8uvbszAAAAAAAAgD+9xUc+AAAAAL8Uez8V78M+AAAAAF6DbD/bOQ4/AAAAADDbVD/yBDU/AAAAAPQENT8v21Q/AAAAAN05Dj9eg2w/AAAAABrvwz6+FHs/AAAAAMbFRz4AAIA/AAAAAC7eTLK+FHs/AAAAAMjFR75dg2w/AAAAABvvw74z21Q/AAAAANc5Dr/1BDU/AAAAAPIENb/bOQ4/AAAAADHbVL8V78M+AAAAAF+DbL+8xUc+AAAAAL8Ue78AAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/DHBbvpkcebzj/6++DHBbvpkcebzj/6++DHBbvpkcebzj/6++FMYPPtgcebzieRu/FMYPPtgcebzieRu/FMYPPtgcebzieRu/FMYPPtgcebzieRu/6LAqvqEcebzf27y+6LAqvqEcebzf27y+yDXuvagcebzkj8a+yDXuvagcebzkj8a+0PyCvbAceby99My+0PyCvbAceby99My+0PyCvbAceby99My+yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/AD0rvLccebyd8M++AD0rvLccebyd8M++0J4xPb0cebx7d8++0J4xPb0cebx7d8+++OrFPcMcebwzi8u++OrFPcMcebwzi8u++OrFPcMcebwzi8u+Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/jBkYPsgcebywO8S+jBkYPsgcebywO8S+NP1KPs0cebxoprm+NP1KPs0cebxoprm+NP1KPs0cebxoprm+Is7aPvEcebzqte6+Is7aPvEcebzqte6+Is7aPvEcebzqte6+1NJ6PtEcebwO9qu+1NJ6PtEcebwO9qu+1NJ6PtEcebwO9qu+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+0myTPtQcebz3YZu+0myTPtQcebz3YZu+1i+nPtUcebwGLYi+1i+nPtUcebwGLYi+1i+nPtUcebwGLYi+fR8JP/Ucebw4mrG+fR8JP/Ucebw4mrG+fR8JP/Ucebw4mrG+umK4PtYcebyYSWW+umK4PtYcebyYSWW+umK4PtYcebyYSWW+ceUTP/UcebxWU46+ceUTP/UcebxWU46+ceUTP/UcebxWU46+ceUTP/UcebxWU46+smrFPtYcebwonjq+smrFPtYcebwonjq+smrFPtYcebwonjq+PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7RsWAPsUcebzqDyy+vS0cP/QcebxI/VK+vS0cP/QcebxI/VK+iSJEPwgdebwM72O+iSJEPwgdebwM72O+MxYKP9QcebwwSMk9wFmCvqUcebxjdhC/wFmCvqUcebxjdhC/wFmCvqUcebxjdhC/2cPIvo0cebyq6vW+2cPIvo0cebyq6vW+JOmmvpkcebxk0Qa/LWHnvoIcebw1JNq+LWHnvoIcebw1JNq+LWHnvoIcebw1JNq+lFI3vrAcebxjvRe/lFI3vrAcebxjvRe/lFI3vrAcebxjvRe/xCIBv3ccebyLv7q+xCIBv3ccebyLv7q+xCIBv3ccebyLv7q+qM/NvbscebwGiRy/qM/NvbscebwGiRy/qM/NvbscebwGiRy/KoIMv2wcebxrO5i+KoIMv2wcebxrO5i+KoIMv2wcebxrO5i+wL6lvMYcebzyxR6/wL6lvMYcebzyxR6/wL6lvMYcebzyxR6/4KAVv2McebxcRma+4KAVv2McebxcRma+4KAVv2McebxcRma+UMV3PdAcebwVax6/UMV3PdAcebwVax6/UMV3PdAcebwVax6/Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+2kmEvpEcebzOL6C+2kmEvpEcebzOL6C+2kmEvpEcebzOL6C+vrKYvoocebx+q42+vrKYvoocebx+q42+SqCqvoIcebxze3G+SqCqvoIcebxze3G+Ksq5vnscebzydUO+Ksq5vnscebzydUO+HPPFvnUcebxNABK+HPPFvnUcebxNABK+DurOvm8cebxUxLu9ceUTPzDFPTxWU46+vS0cP/QcebxI/VK+ceUTP/UcebxWU46+vS0cPzLFPTxI/VK+iSJEPx7FPTwM72O+iSJEPx7FPTwM72O+vS0cP/QcebxI/VK+vS0cP/QcebxI/VK+vS0cPzLFPTxI/VK+iSJEPwgdebwM72O+iSJEPwgdebwM72O+iSJEPwgdebwM72O+MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP9QcebwwSMk9iSJEPx7FPTwM72O+MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7MxYKP9QcebwwSMk9RsWAPsUcebzqDyy+RsWAPsUcebzqDyy+RsWAPmLFPTzqDyy+RsWAPmLFPTzqDyy+PnXfPljFPTwAU0c7smrFPlDFPTwonjq+RsWAPsUcebzqDyy+RsWAPmLFPTzqDyy+smrFPtYcebwonjq+smrFPlDFPTwonjq+umK4PtYcebyYSWW+smrFPtYcebwonjq+umK4PlDFPTyYSWW+1i+nPtUcebwGLYi+1i+nPlDFPTwGLYi+0myTPtQcebz3YZu+0myTPlLFPTz3YZu+1NJ6PtEcebwO9qu+1NJ6PlbFPTwO9qu+NP1KPs0cebxoprm+NP1KPlrFPTxoprm+jBkYPsgcebywO8S+jBkYPl7FPTywO8S++OrFPcMcebwzi8u++OrFPWLFPTwzi8u+0J4xPWjFPTx7d8++0J4xPb0cebx7d8++AD0rvHDFPTyd8M++AD0rvLccebyd8M++0PyCvXbFPTy99My+0PyCvbAceby99My+yDXuvX7FPTzkj8a+yDXuvagcebzkj8a+6LAqvobFPTzf27y+6LAqvqEcebzf27y+DHBbvo7FPTzj/6++DHBbvpkcebzj/6++2kmEvpTFPTzOL6C+2kmEvpEcebzOL6C+vrKYvpzFPTx+q42+vrKYvoocebx+q42+SqCqvqTFPTxze3G+SqCqvoIcebxze3G+Ksq5vqrFPTzydUO+Ksq5vnscebzydUO+HPPFvrLFPTxNABK+HPPFvnUcebxNABK+DurOvrjFPTxUxLu9DurOvm8cebxUxLu9DurOvrjFPTxUxLu9DurOvrjFPTxUxLu9Flocv1kcebwpGRi+Flocv1kcebwpGRi+DurOvm8cebxUxLu9Flocv8zFPTwpGRi+4KAVv8TFPTxcRma+Flocv1kcebwpGRi+Flocv8zFPTwpGRi+4KAVv2McebxcRma+KoIMv7rFPTxrO5i+KoIMv2wcebxrO5i+xCIBv7DFPTyLv7q+xCIBv3ccebyLv7q+LWHnvqTFPTw1JNq+LWHnvoIcebw1JNq+2cPIvpjFPTyq6vW+2cPIvo0cebyq6vW+JOmmvozFPTxk0Qa/JOmmvpkcebxk0Qa/wFmCvoLFPTxjdhC/wFmCvqUcebxjdhC/lFI3vnbFPTxjvRe/lFI3vrAcebxjvRe/qM/NvWrFPTwGiRy/qM/NvbscebwGiRy/wL6lvGDFPTzyxR6/wL6lvMYcebzyxR6/UMV3PVbFPTwVax6/UMV3PdAcebwVax6/FMYPPk7FPTzieRu/FMYPPtgcebzieRu/HHxfPuAcebw8/hW/HHxfPkbFPTw8/hW/yuiVPuccebxGDg6/yuiVPj7FPTxGDg6/Fsm5Pu0cebwIygO/Fsm5PjrFPTwIygO/Is7aPvEcebzqte6+Is7aPjbFPTzqte6+qnL4PvQcebyG5tG+qnL4PjLFPTyG5tG+fR8JP/Ucebw4mrG+fR8JPzDFPTw4mrG+2cPIvpjFPTyq6vW+2cPIvpjFPTyq6vW+wFmCvoLFPTxjdhC/wFmCvoLFPTxjdhC/wFmCvoLFPTxjdhC/JOmmvozFPTxk0Qa/LWHnvqTFPTw1JNq+LWHnvqTFPTw1JNq+LWHnvqTFPTw1JNq+lFI3vnbFPTxjvRe/lFI3vnbFPTxjvRe/lFI3vnbFPTxjvRe/xCIBv7DFPTyLv7q+xCIBv7DFPTyLv7q+xCIBv7DFPTyLv7q+qM/NvWrFPTwGiRy/qM/NvWrFPTwGiRy/qM/NvWrFPTwGiRy/KoIMv7rFPTxrO5i+KoIMv7rFPTxrO5i+KoIMv7rFPTxrO5i+wL6lvGDFPTzyxR6/wL6lvGDFPTzyxR6/wL6lvGDFPTzyxR6/4KAVv8TFPTxcRma+4KAVv8TFPTxcRma+4KAVv8TFPTxcRma+UMV3PVbFPTwVax6/UMV3PVbFPTwVax6/UMV3PVbFPTwVax6/Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/2kmEvpTFPTzOL6C+2kmEvpTFPTzOL6C+2kmEvpTFPTzOL6C+vrKYvpzFPTx+q42+vrKYvpzFPTx+q42+SqCqvqTFPTxze3G+SqCqvqTFPTxze3G+Ksq5vqrFPTzydUO+Ksq5vqrFPTzydUO+HPPFvrLFPTxNABK+HPPFvrLFPTxNABK+DurOvrjFPTxUxLu9DHBbvo7FPTzj/6++DHBbvo7FPTzj/6++DHBbvo7FPTzj/6++PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7smrFPlDFPTwonjq+smrFPlDFPTwonjq+smrFPlDFPTwonjq+RsWAPmLFPTzqDyy+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+vS0cPzLFPTxI/VK+vS0cPzLFPTxI/VK+iSJEPx7FPTwM72O+iSJEPx7FPTwM72O+MxYKP1LFPTwwSMk9HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/6LAqvobFPTzf27y+6LAqvobFPTzf27y+yDXuvX7FPTzkj8a+yDXuvX7FPTzkj8a+0PyCvXbFPTy99My+0PyCvXbFPTy99My+0PyCvXbFPTy99My+yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/AD0rvHDFPTyd8M++AD0rvHDFPTyd8M++0J4xPWjFPTx7d8++0J4xPWjFPTx7d8+++OrFPWLFPTwzi8u++OrFPWLFPTwzi8u++OrFPWLFPTwzi8u+Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/jBkYPl7FPTywO8S+jBkYPl7FPTywO8S+NP1KPlrFPTxoprm+NP1KPlrFPTxoprm+NP1KPlrFPTxoprm+Is7aPjbFPTzqte6+Is7aPjbFPTzqte6+Is7aPjbFPTzqte6+1NJ6PlbFPTwO9qu+1NJ6PlbFPTwO9qu+1NJ6PlbFPTwO9qu+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+0myTPlLFPTz3YZu+0myTPlLFPTz3YZu+1i+nPlDFPTwGLYi+1i+nPlDFPTwGLYi+1i+nPlDFPTwGLYi+fR8JPzDFPTw4mrG+fR8JPzDFPTw4mrG+fR8JPzDFPTw4mrG+umK4PlDFPTyYSWW+umK4PlDFPTyYSWW+umK4PlDFPTyYSWW+CSXWvmMceby8EiU9CSXWvmMceby8EiU99C4/vykcebyr6og+9C4/vykcebyr6og+9C4/vykcebyr6og+BWwFv10cebysMV69/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+cnkXvz4cebyFN4A+cnkXvz4cebyFN4A+cnkXvz4cebyFN4A+pja8vlscebzwS2c+pja8vlscebzwS2c+pja8vlscebzwS2c+pja8vlscebzwS2c+RzsPvzwcebwq36Q+RzsPvzwcebwq36Q+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+ekfPPr0cebzoFz8+ekfPPr0cebzoFz8+aj7YPsMceby8+Qo+ih7DPrYcebyOjXA+ih7DPrYcebyOjXA+qvSzPq8cebyISY8+qvSzPq8cebyISY8+GgeiPqgcebxQN6Q+GgeiPqgcebxQN6Q+Np6NPqAcebyeu7Y+Np6NPqAcebyeu7Y+vBhuPpgcebywi8Y+vBhuPpgcebywi8Y+vBhuPpgcebywi8Y+6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/cCItvWIcebz+sCk/cCItvWIcebz+sCk/cCItvWIcebz+sCk/C0saP88cebwAr4k+C0saP88cebwAr4k+C0saP88cebwAr4k+UIIdPWscebzYCyo/UIIdPWscebzYCyo/UIIdPWscebzYCyo/XSwRP8Ucebw8x64+XSwRP8Ucebw8x64+XSwRP8Ucebw8x64++CDzPXYcebzyzic/+CDzPXYcebzyzic/+CDzPXYcebzyzic/68wFP7ocebxcS9E+68wFP7ocebxcS9E+68wFP7ocebxcS9E+NPtJPoEcebxMAyM/NPtJPoEcebxMAyM/NPtJPoEcebxMAyM/irXwPq8cebz8r/A+irXwPq8cebz8r/A+irXwPq8cebz8r/A+Hq6LPowcebxOvBs/Hq6LPowcebxOvBs/Hq6LPowcebxOvBs/MhjSPqQcebw+OwY/MhjSPqQcebw+OwY/gj2wPpgcebxMFxI/TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+Xg6vvlscebygMIk+Xg6vvlscebygMIk+ftudvlwcebzXuJ4+ftudvlwcebzXuJ4+ftudvlwcebzXuJ4+TB7vvj0cebxecug+TB7vvj0cebxecug+TB7vvj0cebxecug+dhiKvl4cebzK7bE+dhiKvl4cebzK7bE+dhiKvl4cebzK7bE+ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/JCpovmEcebzkgcI+JCpovmEcebzkgcI+bFQ4vmQcebw0MtA+bFQ4vmQcebw0MtA+bFQ4vmQcebw0MtA+tnSwvkQcebzuDw8/tnSwvkQcebzuDw8/tnSwvkQcebzuDw8/1HAFvmkcebx+x9o+1HAFvmkcebx+x9o+1HAFvmkcebx+x9o+ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/qJmgvW4cebwIF+I+qJmgvW4cebwIF+I+YPfNvHQcebxQA+Y+YPfNvHQcebxQA+Y+YPfNvHQcebxQA+Y+YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/4OPqPHscebxofOY+4OPqPHscebxofOY+SE6oPYIcebyUgOM+SE6oPYIcebyUgOM+pMMJPokceby8G90+pMMJPokceby8G90+pMMJPokceby8G90+lFk9PpEcebysZ9M+lFk9PpEcebysZ9M+/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vlscebzwS2c+/O5tvrrFPTwOIFg+pja8vszFPTzwS2c+Xg6vvlscebygMIk+pja8vlscebzwS2c+Xg6vvszFPTygMIk+ftudvlwcebzXuJ4+ftudvsrFPTzXuJ4+dhiKvl4cebzK7bE+dhiKvsjFPTzK7bE+JCpovmEcebzkgcI+JCpovsbFPTzkgcI+bFQ4vmQcebw0MtA+bFQ4vsLFPTw0MtA+1HAFvmkcebx+x9o+1HAFvr7FPTx+x9o+qJmgvW4cebwIF+I+qJmgvbjFPTwIF+I+YPfNvLLFPTxQA+Y+YPfNvHQcebxQA+Y+4OPqPKzFPTxofOY+4OPqPHscebxofOY+SE6oPaTFPTyUgOM+SE6oPYIcebyUgOM+pMMJPp7FPTy8G90+pMMJPokceby8G90+lFk9PpbFPTysZ9M+lFk9PpEcebysZ9M+vBhuPo7FPTywi8Y+vBhuPpgcebywi8Y+Np6NPobFPTyeu7Y+Np6NPqAcebyeu7Y+GgeiPn7FPTxQN6Q+GgeiPqgcebxQN6Q+qvSzPnbFPTyISY8+qvSzPq8cebyISY8+ih7DPnDFPTyOjXA+ih7DPrYcebyOjXA+ekfPPmrFPTzoFz8+ekfPPr0cebzoFz8+aj7YPmTFPTy8+Qo+aj7YPsMceby8+Qo+aj7YPmTFPTy8+Qo+aj7YPmTFPTy8+Qo+QwQhP9gceby8MEU+QwQhP9gceby8MEU+aj7YPsMceby8+Qo+QwQhP07FPTy8MEU+QwQhP9gceby8MEU+C0saP1jFPTwAr4k+C0saP88cebwAr4k+QwQhP07FPTy8MEU+XSwRP2LFPTw8x64+XSwRP8Ucebw8x64+68wFP2zFPTxcS9E+68wFP7ocebxcS9E+irXwPnbFPTz8r/A+irXwPq8cebz8r/A+MhjSPoLFPTw+OwY/MhjSPqQcebw+OwY/gj2wPo7FPTxMFxI/gj2wPpgcebxMFxI/Hq6LPprFPTxOvBs/Hq6LPowcebxOvBs/NPtJPqTFPTxMAyM/NPtJPoEcebxMAyM/+CDzPbDFPTzyzic/+CDzPXYcebzyzic/UIIdPbrFPTzYCyo/UIIdPWscebzYCyo/cCItvcTFPTz+sCk/cCItvWIcebz+sCk/6Dr6vc7FPTzHvyY/6Dr6vVkcebzHvyY/YNNMvlEcebwoRCE/YNNMvtbFPTwoRCE/ZpSMvkocebwtVBk/ZpSMvtzFPTwtVBk/tnSwvkQcebzuDw8/tnSwvuLFPTzuDw8/ynnRvkAcebzcoAI/ynnRvubFPTzcoAI/TB7vvj0cebxecug+TB7vvujFPTxecug+TnUEvzwcebwKJsg+TnUEv+rFPTwKJsg+RzsPvzwcebwq36Q+RzsPv+rFPTwq36Q+cnkXvz4cebyFN4A+cnkXv+jFPTyFN4A+cnkXvz4cebyFN4A+9C4/v/zFPTyr6og+9C4/vykcebyr6og+cnkXv+jFPTyFN4A+BWwFv8jFPTysMV69BWwFv8jFPTysMV699C4/vykcebyr6og+9C4/vykcebyr6og+9C4/v/zFPTyr6og+BWwFv10cebysMV69BWwFv8jFPTysMV69BWwFv8jFPTysMV69BWwFv8jFPTysMV69CSXWvmMceby8EiU9CSXWvmMceby8EiU9BWwFv10cebysMV69/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+/O5tvrrFPTwOIFg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vszFPTzwS2c+RzsPv+rFPTwq36Q+RzsPv+rFPTwq36Q+Xg6vvszFPTygMIk+Xg6vvszFPTygMIk+ftudvsrFPTzXuJ4+ftudvsrFPTzXuJ4+ftudvsrFPTzXuJ4+TB7vvujFPTxecug+TB7vvujFPTxecug+TB7vvujFPTxecug+dhiKvsjFPTzK7bE+dhiKvsjFPTzK7bE+dhiKvsjFPTzK7bE+ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/JCpovsbFPTzkgcI+JCpovsbFPTzkgcI+bFQ4vsLFPTw0MtA+bFQ4vsLFPTw0MtA+bFQ4vsLFPTw0MtA+tnSwvuLFPTzuDw8/tnSwvuLFPTzuDw8/tnSwvuLFPTzuDw8/1HAFvr7FPTx+x9o+1HAFvr7FPTx+x9o+1HAFvr7FPTx+x9o+ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/qJmgvbjFPTwIF+I+qJmgvbjFPTwIF+I+YPfNvLLFPTxQA+Y+YPfNvLLFPTxQA+Y+YPfNvLLFPTxQA+Y+YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/4OPqPKzFPTxofOY+4OPqPKzFPTxofOY+SE6oPaTFPTyUgOM+SE6oPaTFPTyUgOM+pMMJPp7FPTy8G90+pMMJPp7FPTy8G90+pMMJPp7FPTy8G90+6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/lFk9PpbFPTysZ9M+lFk9PpbFPTysZ9M+vBhuPo7FPTywi8Y+vBhuPo7FPTywi8Y+vBhuPo7FPTywi8Y+ekfPPmrFPTzoFz8+ekfPPmrFPTzoFz8+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+aj7YPmTFPTy8+Qo+ih7DPnDFPTyOjXA+ih7DPnDFPTyOjXA+qvSzPnbFPTyISY8+qvSzPnbFPTyISY8+GgeiPn7FPTxQN6Q+GgeiPn7FPTxQN6Q+Np6NPobFPTyeu7Y+Np6NPobFPTyeu7Y+cCItvcTFPTz+sCk/cCItvcTFPTz+sCk/cCItvcTFPTz+sCk/C0saP1jFPTwAr4k+C0saP1jFPTwAr4k+C0saP1jFPTwAr4k+UIIdPbrFPTzYCyo/UIIdPbrFPTzYCyo/UIIdPbrFPTzYCyo/XSwRP2LFPTw8x64+XSwRP2LFPTw8x64+XSwRP2LFPTw8x64++CDzPbDFPTzyzic/+CDzPbDFPTzyzic/+CDzPbDFPTzyzic/68wFP2zFPTxcS9E+68wFP2zFPTxcS9E+68wFP2zFPTxcS9E+NPtJPqTFPTxMAyM/NPtJPqTFPTxMAyM/NPtJPqTFPTxMAyM/irXwPnbFPTz8r/A+irXwPnbFPTz8r/A+irXwPnbFPTz8r/A+Hq6LPprFPTxOvBs/Hq6LPprFPTxOvBs/Hq6LPprFPTxOvBs/MhjSPoLFPTw+OwY/MhjSPoLFPTw+OwY/gj2wPo7FPTxMFxI/9C4/v/zFPTyr6og+9C4/v/zFPTyr6og+9C4/v/zFPTyr6og+CSXWvsTFPTy8EiU9CSXWvsTFPTy8EiU9BWwFv8jFPTysMV69/O5tvrrFPTwOIFg+/O5tvrrFPTwOIFg+/O5tvrrFPTwOIFg+cnkXv+jFPTyFN4A+cnkXv+jFPTyFN4A+cnkXv+jFPTyFN4A+HnghtAAAgL8r8iQz2CANtP//f7/4640zPmcJtAAAgL8BrwM0VGnVswAAgL9sAZMzAAAAAAAAgL9bMvKzVGnVswAAgL9sAZMzAAAAAAAAgL9bMvKzAAAAAAAAgL/7DLazL8oCtP//f7+jkIwzLd7VswAAgL+DyLYzVGnVswAAgL9sAZMzAAAAAAAAgL/7DLazPmcJtAAAgL8BrwM0AAAAAAAAgL9bMvKzHnghtAAAgL8r8iQzPmcJtAAAgL8BrwM0HnghtAAAgL8r8iQz2CANtP//f7/4640zHnihswAAgL9W6o8z2CANtP//f7/4640z3lrxswAAgL/WUrgz/S/uswAAgL8oc44zBk3KswAAgL9655UzHnihswAAgL9W6o8z3lrxswAAgL/WUrgzHnihswAAgL9W6o8z3lrxswAAgL/WUrgzBk3KswAAgL9655Uz/S/uswAAgL8oc44zBk3KswAAgL9655UzBk3KswAAgL+OpqszRsYItAAAgL9D5osznaP8swAAgL9ayJ0z/S/uswAAgL8oc44zBk3KswAAgL+OpqszRsYItAAAgL9D5oszBk3KswAAgL+OpqszXsYItAAAgL+Ii4szRsYItAAAgL9D5osznaP8swAAgL9ayJ0zXsYItAAAgL+Ii4sznaP8swAAgL9ayJ0zaJruswAAgL98lJIz/JEftAAAgL/59I4zXsYItAAAgL+Ii4szaJruswAAgL98lJIz/JEftAAAgL/59I4zyE0CtAAAgL8yiaIzaJruswAAgL98lJIz5rytswAAgL80TrQz/JEftAAAgL/59I4z5rytswAAgL80TrQzyE0CtAAAgL8yiaIznE0CtAAAgL8VbZYz5rytswAAgL80TrQzyE0CtAAAgL8yiaIznE0CtAAAgL8VbZYz0rHKswAAgL9hGpczAqMPtAAAgL/NGpcznE0CtAAAgL8VbZYz0rHKswAAgL9hGpczAqMPtAAAgL/NGpczxLkBtAAAgL8t4pkzgr3PswAAgL83vJEz0rHKswAAgL9hGpczAqMPtAAAgL/NGpczxLkBtAAAgL8t4pkzZJTDs///f7/njZczxLkBtAAAgL8t4pkzqiAAtAAAgL+yMJIzt2jvswAAgL9uNaUzgr3PswAAgL83vJEzZJTDs///f7/njZczZJTDs///f7/njZczt2jvswAAgL9uNaUzgr3PswAAgL83vJEzqiAAtAAAgL+yMJIzt2jvswAAgL9uNaUzqiAAtAAAgL+yMJIz0xZNtAAAgL8XJP8yygEZtAAAgL/DQJszDTOBswAAgL+DEMQz0xZNtAAAgL8XJP8yygEZtAAAgL/DQJszygEZtAAAgL/DQJsz0xZNtAAAgL8XJP8yYwY8tAAAgL9Y1JIzDTOBswAAgL+DEMQzYwY8tAAAgL9Y1JIzxPKzswAAgL9O45czDTOBswAAgL+DEMQzYwY8tAAAgL9Y1JIzE9b1swAAgL9c2q4zxPKzswAAgL9O45czE9b1swAAgL9c2q4z9GXQswAAgL+dTYQzxPKzswAAgL9O45czE9b1swAAgL9c2q4zHOjfs///f7/6lGcz9GXQswAAgL+dTYQzvK4jtAAAgL+1so8zHOjfs///f7/6lGcz9GXQswAAgL+dTYQzvK4jtAAAgL+1so8zHOjfs///f7/6lGczBbDNswAAgL/dc7gzvK4jtAAAgL+1so8zLd7VswAAgL+DyLYzBbDNswAAgL/dc7gzAdZJtP//f79TVBczL8oCtP//f7+jkIwzuE0CtAAAgL+odpQz+sD6swAAgL/473czsZbjswAAgL+rUJMzLd7VswAAgL+DyLYzRy/TswAAgL8cTb0zBbDNswAAgL/dc7gzAdZJtP//f79TVBczL8oCtP//f7+jkIwzAAAAAAAAgL/7DLazAdZJtP//f79TVBczRy/TswAAgL8cTb0zsZbjswAAgL+rUJMzRy/TswAAgL8cTb0z+sD6swAAgL/473czsZbjswAAgL+rUJMzuE0CtAAAgL+odpQz+sD6swAAgL/473czuE0CtAAAgL+odpQzxWliPwAAAADe6e6+03dpPwAAAACkAdK+xWliPwAAAADe6e6+03dpPwAAAACkAdK+c+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/c+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/c+rXvQAAAADEkn6/BhFRPwAAAACEvRM/CRFRPwAAAACDvRM/BhFRPwAAAACEvRM/CRFRPwAAAACDvRM/CRFRPwAAAACDvRM/BhFRPwAAAACEvRM/bdYtvwAAAABF7Ts/Y9YtvwAAAABM7Ts/YtYtv5b3r7ZN7Ts/XNUtv8ABYDl46zs/bdYtvwAAAABF7Ts/YtYtv5b3r7ZN7Ts/bdYtvwAAAABF7Ts/Y9YtvwAAAABM7Ts/YtYtv5b3r7ZN7Ts/Y9YtvwAAAABM7Ts/XNUtvwAAAAB46zs/rgHXOwD+fz8QAQg71+rXvQAAAADDkn6/1+rXvQAAAADDkn6/1+rXvQAAAADDkn6/1+rXvQAAAADDkn6/tXdavwAAAAALbwU/o6dRvwAAAAAm4xI/tXdavwAAAAALbwU/o6dRvwAAAAAm4xI/e5c9vwAAAABYAyw/e5c9vwAAAABYAyw/TYkmvwAAAACFa0I/TYkmvwAAAACFa0I/Gt0MvwAAAACswVU/Gt0MvwAAAACswVU/xOnhvgAAAADLuWU/xOnhvgAAAADLuWU/TY2mvgAAAADkEXI/TY2mvgAAAADkEXI/ohlRvgAAAAD1mXo/ohlRvgAAAAD1mXo/R6GjvQAAAAD+LX8/R6GjvQAAAAD+LX8/duE6PQAAAAD/uX8/duE6PQAAAAD/uX8/XZEuPgAAAAD4P3w/XZEuPgAAAAD4P3w/LNGVPgAAAADqyXQ/LNGVPgAAAADqyXQ/pAHSPgAAAADTd2k/pAHSPgAAAADTd2k/C28FPwAAAAC1d1o/C28FPwAAAAC1d1o/QMMfPwAAAACQBUg/QMMfPwAAAACQBUg/b5M3PwAAAABlazI/b5M3PwAAAABlazI/mX1MPwAAAAA0ARo/mX1MPwAAAAA0ARo/vC1ePwAAAAD9Uf4+vC1ePwAAAAD9Uf4+2V1sPwAAAACJncQ+2V1sPwAAAACJncQ+5BFyPwAAAABNjaY+5BFyPwAAAABNjaY+mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/2V1svwAAAACJncS+5BFyvwAAAABNjaa+5BFyvwAAAABNjaa+2V1svwAAAACJncS+vC1evwAAAAD9Uf6+vC1evwAAAAD9Uf6+mX1MvwAAAAA0ARq/mX1MvwAAAAA0ARq/b5M3vwAAAABlazK/b5M3vwAAAABlazK/QMMfvwAAAACQBUi/QMMfvwAAAACQBUi/C28FvwAAAAC1d1q/C28FvwAAAAC1d1q/pAHSvgAAAADTd2m/pAHSvgAAAADTd2m/LNGVvgAAAADqyXS/LNGVvgAAAADqyXS/XZEuvgAAAAD4P3y/XZEuvgAAAAD4P3y/duE6vQAAAAD/uX+/duE6vQAAAAD/uX+/R6GjPQAAAAD+LX+/R6GjPQAAAAD+LX+/ohlRPgAAAAD1mXq/ohlRPgAAAAD1mXq/TY2mPgAAAADkEXK/TY2mPgAAAADkEXK/xOnhPgAAAADLuWW/xOnhPgAAAADLuWW/GtsMPwAAAACswVW/GtsMPwAAAACswVW/TYkmPwAAAACFaUK/TYkmPwAAAACFaUK/e5c9PwAAAABYAyy/e5c9PwAAAABYAyy/o6dRPwAAAAAm4xK/o6dRPwAAAAAm4xK/AAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0AAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0FbjOMwAAgD8QfCazAAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0FbjOMwAAgD8QfCazxgQNNAAAgD9OPtezFbjOMwAAgD8QfCazWgv+MwAAgD/QJlyzxgQNNAAAgD9OPtezWgv+MwAAgD/QJlyzb0gKNAAAgD8Hj2SzxgQNNAAAgD9OPtezsNDqMwAAgD+j9LWzWgv+MwAAgD/QJlyzb0gKNAAAgD8Hj2SzsNDqMwAAgD+j9LWzb0gKNAAAgD8Hj2SzOJsQNAAAgD/ePpuzsNDqMwAAgD+j9LWzA7D0MwAAgD/TopSzOJsQNAAAgD/ePpuzA7D0MwAAgD/TopSzgfsGNAAAgD8limmzOJsQNAAAgD/ePpuzTMTcMwAAgD9PQbOzA7D0MwAAgD/TopSzgfsGNAAAgD8limmz8QO1MwAAgD+uwMWzTMTcMwAAgD9PQbOzooHsM///fz/hYNaz0ePuMwAAgD8FjJqzCDTyMwAAgD/Udb2zVOD8MwAAgD+lVkKzgfsGNAAAgD8limmzZ94PNP//fz+YQnSz7rNTtQAAgD9UaYK1TMTcMwAAgD9PQbOzHw0MNAAAgD8Hi5izZ94PNP//fz+YQnSz7rNTtQAAgD9UaYK1CDTyMwAAgD/Udb2zZ94PNP//fz+YQnSz8QO1MwAAgD+uwMWzCDTyMwAAgD/Udb2z8QO1MwAAgD+uwMWzVOD8MwAAgD+lVkKzooHsM///fz/hYNazVOD8MwAAgD+lVkKzooHsM///fz/hYNaz0ePuMwAAgD8FjJqz0ePuMwAAgD8FjJqz7rNTtQAAgD9UaYK1gy+8tAAAgD/HuEUzHw0MNAAAgD8Hi5izjpvJMwAAgD+ANaWzV+v2MwAAgD+FiJuzshj3MwAAgD+jZZyzbBr3MwAAgD+wMJKzcdYBNAAAgD8wxaOzV+v2MwAAgD+FiJuzshj3MwAAgD+jZZyzwqoDNAAAgD+l+puzV+v2MwAAgD+FiJuzFCH2MwAAgD8q+puzshj3MwAAgD+jZZyzcdYBNAAAgD8wxaOzwqoDNAAAgD+l+puzjpvJMwAAgD+ANaWzcdYBNAAAgD8wxaOzjpvJMwAAgD+ANaWzbBr3MwAAgD+wMJKzbBr3MwAAgD+wMJKzgy+8tAAAgD/HuEUzPdbJMwAAgD8/8iSzHw0MNAAAgD8Hi5izPuUPNAAAgD823WmzGd5nNP//fz/++R6zgy+8tAAAgD/HuEUzGd5nNP//fz/++R6zPdbJMwAAgD8/8iSzGd5nNP//fz/++R6zz1SSM///fz+aMwq0PdbJMwAAgD8/8iSzPuUPNAAAgD823Wmzz1SSM///fz+aMwq0AzDuMwAAgD/M+rezW5kBNAAAgD9455WzPuUPNAAAgD823Wmz0/cYNAAAgD/HsP+yz1SSM///fz+aMwq00/cYNAAAgD/HsP+yW5kBNAAAgD9455Wz0/cYNAAAgD/HsP+yzVW3MwAAgD/cgsyzAzDuMwAAgD/M+rezW5kBNAAAgD9455WzzVW3MwAAgD/cgsyzAzDuMwAAgD/M+rez8g31MwAAgD8y7KmznaP8MwAAgD9TyJ2zzVW3MwAAgD/cgsyz8g31MwAAgD8y7Kmz8g31MwAAgD8y7KmzCMH6MwAAgD+Ri4uznaP8MwAAgD9TyJ2zCMH6MwAAgD+Ri4uzgaP8MwAAgD9YMnyznaP8MwAAgD9TyJ2z3cD6MwAAgD/e8lWzCMH6MwAAgD+Ri4uzgaP8MwAAgD9YMnyz3cD6MwAAgD/e8lWzgaP8MwAAgD9YMnyzrk0CNAAAgD9uBpKzyk0CNAAAgD8dUYqz3cD6MwAAgD/e8lWzrk0CNAAAgD9uBpKzpOPuMwAAgD87wbqzrk0CNAAAgD9uBpKzyk0CNAAAgD8dUYqzpOPuMwAAgD87wbqzFCH2MwAAgD8q+puzyk0CNAAAgD8dUYqzpOPuMwAAgD87wbqzFCH2MwAAgD8q+puzwqoDNAAAgD+l+puzwPIStP//f7+C5JIzkhf0s///f79be5gzoPX/u6D1f7+x9IK8wPIStP//f7+C5JIzkhf0s///f79be5gzwPIStP//f7+C5JIzoPX/u6D1f7+x9IK8khf0s///f79be5gzv8zMOe//f7/AqLY6oPX/u6D1f7+x9IK8bakFtAAAgL+GMKQzv8zMOe//f7/AqLY6AUIOtAAAgL+OGpczbakFtAAAgL+GMKQzmqbnswAAgL+SGpczv8zMOe//f7/AqLY6bakFtAAAgL+GMKQzmqbnswAAgL+SGpczHnghtAAAgL+hdb0z27kXtAAAgL+aUJMzgnUEtAAAgL9OnpUzpVrxswAAgL9xpnQzrePuswAAgL81gZcz3WXnswAAgL/4SJczSPXjswAAgL97LKkz0OviswAAgL9QHYEzAAAAAAAAgL/ImsAzrePuswAAgL81gZczSPXjswAAgL97LKkzrePuswAAgL81gZcz27kXtAAAgL+aUJMzSPXjswAAgL97LKkz27kXtAAAgL+aUJMzpVrxswAAgL9xpnQzHnghtAAAgL+hdb0zpVrxswAAgL9xpnQzHnghtAAAgL+hdb0zAAAAAAAAgL/ImsAz0OviswAAgL9QHYEzphrOswAAgL/Z2A00AAAAAAAAgL/ImsAzAtQEtP//f7+CAZUzgnUEtAAAgL9OnpUz0OviswAAgL9QHYEzphrOswAAgL/Z2A007jVyswAAgL99UmszJ+4YtAAAgL94J7czgnUEtAAAgL9OnpUz3WXnswAAgL/4SJczJ+4YtAAAgL94J7czWpDyswAAgL9lP5sz3WXnswAAgL/4SJczJ+4YtAAAgL94J7czaeMMtAAAgL/ITIQzWpDyswAAgL9lP5szaeMMtAAAgL/ITIQz09b1swAAgL9G2a4zWpDyswAAgL9lP5szaeMMtAAAgL/ITIQz2Av+swAAgL9O45cz09b1swAAgL9G2a4z2Av+swAAgL9O45cz09b1swAAgL9G2a4zhga8swAAgL851pIz2Av+swAAgL9O45czx7bOswAAgL8kEcQzhga8swAAgL851pIzx7bOswAAgL8kEcQzhga8swAAgL851pIzQxZNswAAgL9iH/8yx7bOswAAgL8kEcQzQxZNswAAgL9iH/8yAAAAAAAAgL+uQpszQxZNswAAgL9iH/8yAAAAAAAAgL+uQpszAAAAAAAAgL+uQpszAUIOtAAAgL+OGpcznKbnswAAgL8XiaIzmqbnswAAgL+SGpczo3TDs///f78fbZYzAUIOtAAAgL+OGpczo3TDs///f78fbZYzYikNtAAAgL8zu5gznKbnswAAgL8XiaIzo3TDs///f78fbZYzUsgQtAAAgL9Au5gzYikNtAAAgL8zu5gznKbnswAAgL8XiaIzUsgQtAAAgL9Au5gzYikNtAAAgL8zu5gzGizZswAAgL/hbZczUsgQtAAAgL9Au5gzSlvvswAAgL/3VLUzY5HgswAAgL+CyJ0zGizZswAAgL/hbZczSlvvswAAgL/3VLUzGizZswAAgL/hbZczSlvvswAAgL/3VLUzY5HgswAAgL+CyJ0zz122swAAgL8J5oszAG0otAAAgL9Pt5IzY5HgswAAgL+CyJ0zz122swAAgL8J5oszAG0otAAAgL9Pt5Izz122swAAgL8J5oszyl22s///f78f2KEzAG0otAAAgL9Pt5Ize1MEtAAAgL/ZmpIzH23gswAAgL9A6JUzyl22s///f78f2KEzH23gswAAgL9A6JUzyl22s///f78f2KEzW5AEtAAAgL8nZIUze1MEtAAAgL/ZmpIzH23gswAAgL9A6JUzaZ0atAAAgL/IA5wzAtQEtP//f7+CAZUzW5AEtAAAgL8nZIUze1MEtAAAgL/ZmpIzao+rswAAgL/zg74zaZ0atAAAgL/IA5wzW5AEtAAAgL8nZIUzaZ0atAAAgL/IA5wzao+rswAAgL/zg74zAtQEtP//f7+CAZUzao+rswAAgL/zg74z7jVyswAAgL99UmszphrOswAAgL/Z2A007jVyswAAgL99UmszLQTfPQAAAABIen4/MATfPQAAAABHen4/LQTfPQAAAABIen4/MATfPQAAAABHen4/LQTfPQAAAABIen4/MATfPQAAAABHen4/tXdaPwAAAAALbwW/o6dRPwAAAAAm4xK/tXdaPwAAAAALbwW/o6dRPwAAAAAm4xK/e5c9PwAAAABYAyy/e5c9PwAAAABYAyy/TYkmPwAAAACFaUK/TYkmPwAAAACFaUK/GtsMPwAAAACswVW/GtsMPwAAAACswVW/xOnhPgAAAADLuWW/xOnhPgAAAADLuWW/TY2mPgAAAADkEXK/TY2mPgAAAADkEXK/ohlRPgAAAAD1mXq/ohlRPgAAAAD1mXq/R6GjPQAAAAD+LX+/R6GjPQAAAAD+LX+/duE6vQAAAAD/uX+/duE6vQAAAAD/uX+/XZEuvgAAAAD4P3y/XZEuvgAAAAD4P3y/LNWVvgAAAADqyXS/LNWVvgAAAADqyXS/pAHSvgAAAADTd2m/pAHSvgAAAADTd2m/C28FvwAAAAC1d1q/C28FvwAAAAC1d1q/QMMfvwAAAACQBUi/QMMfvwAAAACQBUi/b5M3vwAAAABlazK/b5M3vwAAAABlazK/mX1MvwAAAAA0ARq/mX1MvwAAAAA0ARq/vC1evwAAAAD9Uf6+vC1evwAAAAD9Uf6+2V1svwAAAACJncS+2V1svwAAAACJncS+5BFyvwAAAABNjaa+5BFyvwAAAABNjaa+mdOHPgAAAADU03a/mdOHPgAAAADS03a/mdOHPgAAAADU03a/mdOHPgAAAADS03a/mdOHPgAAAADU03a/mdOHPgAAAADS03a/5BFyPwAAAABNjaY+2V1sPwAAAACJncQ+2V1sPwAAAACJncQ+5BFyPwAAAABNjaY+vC1ePwAAAAD9Uf4+vC1ePwAAAAD9Uf4+mX1MPwAAAAA0ARo/mX1MPwAAAAA0ARo/b5M3PwAAAABlazI/b5M3PwAAAABlazI/QMMfPwAAAACQBUg/QMMfPwAAAACQBUg/C28FPwAAAAC1d1o/C28FPwAAAAC1d1o/pAHSPgAAAADTd2k/pAHSPgAAAADTd2k/LNGVPgAAAADqyXQ/LNGVPgAAAADqyXQ/XZEuPgAAAAD4P3w/XZEuPgAAAAD4P3w/duE6PQAAAAD/uX8/duE6PQAAAAD/uX8/R6GjvQAAAAD+LX8/R6GjvQAAAAD+LX8/ohlRvgAAAAD1mXo/ohlRvgAAAAD1mXo/TY2mvgAAAADkEXI/TY2mvgAAAADkEXI/xOnhvgAAAADLuWU/xOnhvgAAAADLuWU/GtsMvwAAAACswVU/GtsMvwAAAACswVU/TYkmvwAAAACFa0I/TYkmvwAAAACFa0I/e5c9vwAAAABYAyw/e5c9vwAAAABYAyw/o6dRvwAAAAAm4xI/o6dRvwAAAAAm4xI/xWlivwAAAADe6e4+xWlivwAAAADe6e4+03dpvwAAAACkAdI+03dpvwAAAACkAdI+SAPfPQAAAABKen4/SAPfPQAAAABKen4/SAPfPQAAAABKen4/SAPfPQAAAABKen4/jJRRvwAAAAC1AhO/h5RRvwAAAAC/AhO/jJRRvwAAAAC1AhO/h5RRvwAAAAC/AhO/h5RRvwAAAAC/AhO/jJRRvwAAAAC1AhO/ay4tP7vkEzYhiDy/bS4tPwAAAAAiiDy/cS4tPwAAAAAeiDy/ay4tP7vkEzYhiDy/cS4tPwAAAAAeiDy/cS4tPwAAAAAeiDy/ay4tP7vkEzYhiDy/bS4tPwAAAAAiiDy/bS4tPwAAAAAiiDy/nKbnMwAAgD+9OpKzCSH2MwAAgD8IUYqzwk0CNP//fz/8MWSzA0IONAAAgD+/OpKzicxMuqv/fz+9H0q7CsXeMwAAgD8tXaCznKbnMwAAgD+9OpKzA0IONAAAgD+/OpKzCsXeMwAAgD8tXaCznKbnMwAAgD+9OpKzwk0CNP//fz/8MWSzA0IONAAAgD+/OpKzCSH2MwAAgD8IUYqzl00CNAAAgD+QBpKzwk0CNP//fz/8MWSz6qbnMwAAgD8X4aizCSH2MwAAgD8IUYqzl00CNAAAgD+QBpKzICzZMwAAgD+Opq+z6qbnMwAAgD8X4aizl00CNAAAgD+QBpKzICzZMwAAgD+Opq+z6qbnMwAAgD8X4aizcpruM///fz99yJ2zdsYINAAAgD8pjIuzICzZMwAAgD+Opq+zdsYINAAAgD8pjIuzSPXjMwAAgD/u66mzcpruM///fz99yJ2zdsYINAAAgD8pjIuzy4zZMwAAgD8u2YqzSPXjMwAAgD/u66mzcpruM///fz99yJ2zy4zZMwAAgD8u2YqzSPXjMwAAgD/u66mzUsYINAAAgD8xJXyzy4zZMwAAgD8u2Yqz5N/8MwAAgD886JWzmAQBNAAAgD9sAq2zUsYINAAAgD8xJXyz5N/8MwAAgD886JWzUsYINAAAgD8xJXyzpk3KMwAAgD9rqLOz5N/8MwAAgD886JWzmAQBNAAAgD9sAq2z63ehMwAAgD9VRxW0pk3KMwAAgD9rqLOzWmHdM///fz+CAZWzmAQBNAAAgD9sAq2zPAM1NAAAgD8Qo0mzpk3KMwAAgD9rqLOzPAM1NAAAgD8Qo0mz63ehMwAAgD9VRxW0PAM1NAAAgD8Qo0mz63ehMwAAgD9VRxW0WmHdM///fz+CAZWzUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWzWmHdM///fz+CAZWz0OviMwAAgD8Nm5ezvdYFNAAAgD8+9m+zUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWzUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWz0OviMwAAgD8Nm5ez5u48NAAAgD+ZmsCzp00CNAAAgD9/dpSzXsYINAAAgD8A8HezKKe1M///fz+odb2z3K/NMwAAgD8ozbmz0OviMwAAgD8Nm5ezbOD8MwAAgD+EVkKzp00CNAAAgD9/dpSzvdYFNAAAgD8+9m+z98IHNAAAgD8pwMWzXsYINAAAgD8A8Hez5u48NAAAgD+ZmsCzp00CNAAAgD9/dpSzbOD8MwAAgD+EVkKzXsYINAAAgD8A8HezbOD8MwAAgD+EVkKz98IHNAAAgD8pwMWzKKe1M///fz+odb2z98IHNAAAgD8pwMWzKKe1M///fz+odb2z5u48NAAAgD+ZmsCz3K/NMwAAgD8ozbmzC98BNAAAgD/hwoqzvdYFNAAAgD8+9m+z3K/NMwAAgD8ozbmzC98BNAAAgD/hwoqzgpwCNAAAgD/AkKCz4dm7MwAAgD/a36azC98BNAAAgD/hwoqzgpwCNAAAgD/AkKCz4dm7MwAAgD/a36azgpwCNAAAgD/AkKCzOqYZNAAAgD9XZHqz4dm7MwAAgD/a36azS/YGNAAAgD+98iazOqYZNAAAgD9XZHqzS/YGNAAAgD+98iazOqYZNAAAgD9XZHqzJLAcNAAAgD8H2RyzFQmbMwAAgD9acRq0S/YGNAAAgD+98iazJLAcNAAAgD8H2RyzLxZNMwAAgD/+mbCzFQmbMwAAgD9acRq0JLAcNAAAgD8H2RyzLxZNMwAAgD/+mbCzgQKZMwAAgD+uQpuzFQmbMwAAgD9acRq0LxZNMwAAgD/+mbCzgQKZMwAAgD+uQpuzgQKZMwAAgD+uQpuzAAAAAKr/fz+5S1M7IGzcMwAAgD98eKOzkhf0M///fz9V65CzIGzcMwAAgD98eKOzkhf0M///fz9V65CzIGzcMwAAgD98eKOzicxMuqv/fz+9H0q7AAAAAKr/fz+5S1M7khf0M///fz9V65CzicxMuqv/fz+9H0q7AAAAAKr/fz+5S1M7CsXeMwAAgD8tXaCzAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8u+WS/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZD8u+WS/LvnkPgAAAIAAAAAALvnkPi75ZL8AAAAALvnkPi75ZD8u+WQ/LvnkPgAAAIAu+WS/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZL8AAAAAAACAvwAAAIAAAAAALvnkPi75ZD8u+WQ/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZL8u+WQ/LvnkPgAAAIAAAMA+AACAPwAAAD4AAIA+AADAPgAAAAAAACA/AABAPwAAID8AAAA/AAAgPwAAAAAAACA/AACAPgAAwD4AAEA/AAAAPgAAAD8AAMA+AABAPwAAwD4AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAAA/AADAPgAAAD8AAMA+AAAAPwAAAwAHAAkABAAOAA8ABgAMAAsABQACAAgADQAKAAgACgABAPf/f7+xIdvAvv9/v/f/f7+xIdvAvv9/v/f/f7+xIdvAvv9/vwAAADXYkA3B5f96NgAAADXYkA3B5f96NgAAADXYkA3B5f96NgAAADXYkA3B5f96Nvf/f7+xIdvAIACAP/f/f7+xIdvAIACAP/f/f7+xIdvAIACAPwQAgD+xIdvAvv9/vwQAgD+xIdvAvv9/vwQAgD+xIdvAvv9/vwQAgD+xIdvAIACAPwQAgD+xIdvAIACAPwQAgD+xIdvAIACAPy35ZL8u+eS+AAAAgAAAAAAu+eS+LflkvwAAAAAAAIA/AAAAgC35ZL8u+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAu+eS+Lflkvy35ZD8v+eS+AAAAgC35ZL8u+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAAAIA/AAAAgAAAAAAu+eS+LflkvwAAAAAAAIA/AAAAgC35ZD8v+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAAAIA/AAAAgC35ZD8v+eS+AAAAgAAAwD4AAIA/AADAPgAAAAAAAAA+AACAPgAAID8AAEA/AAAgPwAAAD8AACA/AAAAAAAAID8AAIA+AADAPgAAQD8AAMA+AABAPwAAAD4AAAA/AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAADAAcACAAEAA0ADwAGAAwACgAFAAEACQAOAAsACQALAAIAG5QrvrYC7sDrv1I+G5QrvrYC7sDrv1I+G5QrvrYC7sDrv1I+G5QrvkDuGr/rv1I+G5QrvkDuGr/rv1I+G5QrvkDuGr/rv1I+G5QrvrYC7sDr9Ue+G5QrvrYC7sDr9Ue+G5QrvrYC7sDr9Ue+G5QrvkDuGr/r9Ue+G5QrvkDuGr/r9Ue+G5QrvkDuGr/r9Ue+uyFvPrYC7sDrv1I+uyFvPrYC7sDrv1I+uyFvPrYC7sDrv1I+uyFvPkDuGr/rv1I+uyFvPkDuGr/rv1I+uyFvPkDuGr/rv1I+uyFvPrYC7sDr9Ue+uyFvPrYC7sDr9Ue+uyFvPrYC7sDr9Ue+uyFvPkDuGr/r9Ue+uyFvPkDuGr/r9Ue+uyFvPkDuGr/r9Ue+//9/vwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//38///9/vwAAAAAAAACAAAAAAAAAAAD//38/AAAAAAAAgD8AAACA//9/vwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//3+///9/vwAAAAAAAACAAAAAAAAAAAD//3+/AAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//38///9/PwAAAAAAAACAAAAAAAAAAAD//38/AAAAAAAAgD8AAACA//9/PwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//3+///9/PwAAAAAAAACAAAAAAAAAAAD//3+/AAAAAAAAgD8AAACA//9/PwAAAAAAAACAAADAPgAAgD8AAAA+AACAPgAAwD4AAAAAAAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AAADAAkAAAAJAAYACAAKABUACAAVABMAFAAXABEAFAARAA4ADQAPAAQADQAEAAIABwASAAwABwAMAAEAFgALAAUAFgAFABAA"}]}};var xA="attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform float pointSize;\n\n//fbo pickingvert\n\n#include <fbo_picking_vert>\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    //gl_Positiondepth\n\n    fbo_picking_setData(gl_Position.w, true);\n\n}\n\n";const dA=[0,1e5,0],yA=[0,0,0],mA=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],pA=[3,1,0,0,2,3],LA=[.1,.1,.1],TA=[],OA=[],FA=[],EA=[],UA=[],NA=[],jA=[],QA=[],SA=[0,-1,0],BA={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]},RA={4:[4,5],5:[4,5],7:[7,8],8:[7,8],9:[9,10,11],10:[9,10,11],11:[9,10,11]},kA=[6];class GA{constructor(A,t,n,i,r){this.map=A,this.renderer=t,this.updateTRS(n,i,r),this.createPickHelper(),this.createHelperMeshes(),this.k(),this.registEvents(),this.mouseAction="moving",this.G=null,this.q=!0}registEvents(){const A=this.map;A.on("dom:mousemove",this.W,this),A.on("dom:mousedown",this.V,this),A.on("dom:mouseup",this.K,this),A.on("zooming moving dragrotating",this.H,this)}unregistEvents(){const A=this.map;A.off("dom:mousemove",this.W,this),A.off("dom:mousedown",this.V,this),A.off("dom:mouseup",this.K,this),A.off("zooming moving dragrotating",this.H,this)}W(A){this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y};const t=this.getCntrollerMeshes();if(this.currentPickingObject=this._(this.currentMousePosition,t,"meshes"),"transform"===this.mouseAction){if("z-translate"===this.J){const n=Z(FA,t[9].localTransform);this.$(!0,n,[this.AA[0]*Math.PI/180,this.AA[1]*Math.PI/180,this.AA[2]*Math.PI/180])}else if("y-rotate"===this.J){const n=Z(FA,t[4].localTransform);this.$(!0,n,[90*Math.PI/180,0,-this.AA[2]])}else if("z-rotate"===this.J){const n=Z(FA,t[7].localTransform);this.$(!0,n,[0,0,0])}}else this.$(!1);this.tA(),this.nA(this.currentMousePosition)}tA(){this.iA(),this.currentPickingObject&&null!=this.currentPickingObject.meshId&&(this.lastPickingMeshId=this.currentPickingObject.pickingId,this.rA(this.currentPickingObject.pickingId,.6)),this.eA()}nA(A){if("transform"===this.mouseAction){const A=this.sA,t=this._(this.currentMousePosition,[A],"plane"),n=this._(this.lastMousePosition,[A],"plane");if(!t||null===t.meshId||!n||null===n.meshId)return;const i=[0,0,0];let r=0;if("z-translate"===this.J){i[0]=t.point[0]-n.point[0],i[1]=t.point[1]-n.point[1],i[2]=t.point[2]-n.point[2];const A=this.uA(),r=cA(i,A),e=function(A){var t=A[0],n=A[1],i=A[2];return Math.sqrt(t*t+n*n+i*i)}(i)*Math.cos(r),s=Math.sign(e)*Math.sqrt(Math.pow(e,2)/(Math.pow(A[0],2)+Math.pow(A[1],2)+Math.pow(A[2],2))),u=eA(EA,A[0]*s,A[1]*s,A[2]*s);this.oA(u)}else"y-rotate"!==this.J&&"z-rotate"!==this.J||(r=this.hA(t.point,n.point,this.J),this.fA(r,this.J))}this.lastMousePosition=A,this.lastPickingObject=this.currentPickingObject,this.lastPickingMeshId=this.currentPickingObject.meshId}hA(A,t,n){const i=this.cA;let r,e;"y-rotate"===n?(r=IA(jA,t[0]-i[0],t[2]-i[2]),e=IA(QA,A[0]-i[0],A[2]-i[2])):"z-rotate"===n&&(r=IA(jA,t[0]-i[0],t[1]-i[1]),e=IA(QA,A[0]-i[0],A[1]-i[1]));const s=Math.atan2(r[1],r[0]);return(Math.atan2(e[1],e[0])-s)/Math.PI*180}oA(A){sA(this.cA,this.cA,A),this.aA()}fA(A,t){"y-rotate"===t?this.AA[1]-=A:"z-rotate"===t&&(this.AA[2]+=A),this.aA()}aA(){const A=this.updateMatrix();K(A,A,LA);const t=this.getCntrollerMeshes();for(let n=0;n<t.length;n++){const i=t[n];let r=A;7!==n&&8!==n||(r=this.updateMatrixExcept(0),K(r,r,LA)),V(i.localTransform,r,i.nodeMatrix)}}eA(){this.renderer&&this.renderer.parentRenderer.setToRedraw()}V(A){this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y};const t=this.getCntrollerMeshes();this.firstDownPoint=this.currentPickingObject=this._(this.currentMousePosition,t,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.meshId?(this.mouseAction="transform",this.vA(this.currentPickingObject.pickingId),this.map.config("zoomable",!1),this.map.config("draggable",!1),this.eA()):(this.mouseAction="pan",this.map.config("zoomable",!0),this.map.config("draggable",!0)),this.lastMousePosition=this.currentMousePosition,this.lastPickingObject=this.currentPickingObject,this.lastPickingMesh=t[this.currentPickingObject.meshId]}vA(A){RA[9].indexOf(A)>-1?this.J="z-translate":RA[4].indexOf(A)>-1?this.J="y-rotate":RA[7].indexOf(A)>-1&&(this.J="z-rotate")}$(A,t,n){const i=this.sA,r=t||i.originTranslation,e=function(A,t){var n=t[0],i=t[1],r=t[2],e=t[4],s=t[5],u=t[6],o=t[8],h=t[9],f=t[10];return A[0]=Math.sqrt(n*n+i*i+r*r),A[1]=Math.sqrt(e*e+s*s+u*u),A[2]=Math.sqrt(o*o+h*h+f*f),A}(OA,i.localTransform);let s=CA(TA,0,0,0);X(i.localTransform,s,r,e),A&&!this.lA()&&(J(i.localTransform,i.localTransform,n[2]),H(i.localTransform,i.localTransform,n[0]),_(i.localTransform,i.localTransform,n[1]))}lA(){if(this.map.getPitch())return!1;const A=this.map.cameraPosition,t=this.map.coordinateToPointAtRes(this.map.getCenter(),this.map.getGLRes());eA(t,t.x,t.y,0);const n=this.wA.getCoordinates(),i=this.map.coordinateToPointAtRes(n,this.map.getGLRes()),r=this.wA.getTranslation(),e=eA(FA,i.x,i.y,0),s=sA(e,e,r);return cA(uA(EA,A,s),uA(EA,A,t))<1/180*Math.PI}K(){"transform"===this.mouseAction&&(this.firstDownPoint=null,this.q=!0),this.mouseAction="moving",this.J=null,this.map.config("zoomable",!0),this.map.config("draggable",!0),this.eA()}H(){this.q=!0}iA(){c(this.lastPickingMeshId)&&this.rA(this.lastPickingMeshId),this.map.resetCursor()}rA(A,t){const n=this.getCntrollerMeshes();if(kA.indexOf(A)<0){const i=RA[A];if(i)for(let A=0;A<i.length;A++){this.PA(n[i[A]],t)}else{this.PA(n[A],t)}}this.map.setCursor("pointer")}PA(A,t){const n=A.material.get("polygonFill");n[3]=t||A.originOpacity,A.material.set("polygonFill",n)}_(A,t,n){const i=this.map;if(!(i&&this.gA&&this.renderer&&this.renderer.canvas))return null;const r=i.getDevicePixelRatio(),e=A.x*r,s=A.y*r,u={projViewMatrix:this.map.projViewMatrix,pointSize:1};return!this.q&&this.CA&&this.CA===n||(this.gA.render(t,u,!0),this.CA=n,this.q=!1),this.gA.pick(e,s,10,u,{viewMatrix:this.map.viewMatrix,projMatrix:this.map.projMatrix,returnPoint:!0})}updateTRS(A,t,n){this.cA=rA([],A),this.DA=rA([],n),this.AA=rA([],t)}updateMatrix(){const A=this.AA,t=this.cA,n=this.DA,i=vA(TA);return gA(i,i,A[2]*Math.PI/180),wA(i,i,A[0]*Math.PI/180),PA(i,i,A[1]*Math.PI/180),X(UA,i,t,n)}updateMatrixExcept(){const A=rA([],this.AA);A[0]=0;const t=this.cA,n=this.DA,i=vA(TA);return gA(i,i,A[2]*Math.PI/180),wA(i,i,A[0]*Math.PI/180),PA(i,i,A[1]*Math.PI/180),X(NA,i,t,n)}uA(){const A=this.AA,t=W([]);return J(t,t,A[2]*Math.PI/180),H(t,t,A[0]*Math.PI/180),_(t,t,A[1]*Math.PI/180),fA(EA,SA,t)}createPickHelper(){const t=new Z$7({POSITION:mA},pA,0,{primitive:"triangles",positionAttribute:"POSITION"}),n=t$2.Util.extend({},BA,{polygonFill:[0,0,0,.001]});this.sA=new de$4(t,new ie$4(n)),this.sA.setUniform("uPickingId",12);const i=W([]),r=CA([],0,0,0);this.sA.originRotation=[0,0,0],X(i,r,this.cA,[3,3,3]),this.sA.originTranslation=this.cA,this.sA.localTransform=i,this.sA.transparent=!0,this.sA.setDefines({HAS_HELPERPARTS:1,HAS_PICKING_ID:2})}createHelperMeshes(){this.IA=this.MA("helper"),this.bA=[],this.bA.push(...this.IA),this.bA.push(this.sA)}getPickHelperMesh(){return this.sA}getCntrollerMeshes(){return this.IA}getAllMeshes(){return this.bA.length<12&&this.bA.push(...this.IA),this.bA}createProjViewMatrix(){const A=this.updateMatrix(),t=fA([],yA,A),n=fA([],dA,A),i=Math.sqrt(Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)+Math.pow(n[2]-t[2],2));return V([],function(A,t,n,i,r,e,s){var u=1/(t-n),o=1/(i-r),h=1/(1-s);return A[0]=-2*u,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=-2*o,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=2*h,A[11]=0,A[12]=(t+n)*u,A[13]=(r+i)*o,A[14]=(s+1)*h,A[15]=1,A}([],-this.DA[0],this.DA[1],-this.DA[0],this.DA[1],0,i),AA([],n,t,[0,0,1]))}MA(t){const n=[],i=function(t){return dn$3.loadGLTF("",zA[t]).then((A=>A))}(t),r=this.updateMatrix();return K(r,r,LA),i.then((t=>{dn$3.exportGLTFPack(t).getMeshesInfo().forEach(((t,i)=>{const e=t.materialInfo||{};e.polygonFill=6===i?[1,1,1,.1]:[1,1,1,1],t$2.Util.extend(e,BA,e);const s=new ie$4(e),u=new de$4(t.geometry,s);u.setUniform("uPickingId",i);const h=u.getDefines();if(h.HAS_HELPERPARTS=1,h.HAS_PICKING_ID=2,u.setDefines(h),u.nodeMatrix=t.nodeMatrix,u.originTransform=function(A,t){return A[0]=t[0],A[1]=t[1],A[2]=t[2],A[3]=t[3],A[4]=t[4],A[5]=t[5],A[6]=t[6],A[7]=t[7],A[8]=t[8],A[9]=t[9],A[10]=t[10],A[11]=t[11],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15],A}([],u.localTransform),7===i||8===i){const A=this.updateMatrixExcept(0);K(A,A,LA),V(u.localTransform,A,u.nodeMatrix)}else V(u.localTransform,r,u.nodeMatrix);u.originOpacity=6===i?.1:1,u.transparent=!0,n.push(u)}))})),n}k(){this.pickingFBO=this.renderer.regl.framebuffer(this.renderer.canvas.width,this.renderer.canvas.height),this.gA=new nr$4(this.renderer,{vert:xA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(A,t){return V([],t.projViewMatrix,t.modelMatrix)}}]},this.pickingFBO)}zA(){this.unregistEvents(),this.dispose()}dispose(){this.getAllMeshes().forEach((A=>{A.geometry.dispose(),A.dispose()})),this.pickingFBO&&this.pickingFBO.destroy()}resize(A,t){this.pickingFBO.width===A&&this.pickingFBO.height===t||this.pickingFBO.resize(A,t)}}class YA extends rt$6{constructor(A={}){const t=[],n=[],i=A.uniforms,r=[{name:"modelNormalMatrix",type:"function",fn:function(A,n){return function(A,t){return A[0]=t[0],A[1]=t[1],A[2]=t[2],A[3]=t[4],A[4]=t[5],A[5]=t[6],A[6]=t[8],A[7]=t[9],A[8]=t[10],A}(t,n.modelMatrix)}},{name:"viewModelMatrix",type:"function",fn:function(A,t){return V(n,t.viewMatrix,t.modelMatrix)}}];i&&r.push(...i),super({vert:"#include <gl2_vert>\n\nattribute vec3 aPosition;\n\n#include <line_extrusion_vert>\n\n\n\n#ifdef HAS_MAP\n\n    uniform vec2 uvScale;\n\n    uniform vec2 uvOffset;\n\n    attribute vec2 aTexCoord;\n\n    varying vec2 vTexCoord;\n\n#endif\n\n#if defined(HAS_COLOR)\n\n    attribute vec4 aColor;\n\n    varying vec4 vColor;\n\n#elif defined(HAS_COLOR0)\n\n    attribute vec4 aColor0;\n\n    varying vec4 vColor;\n\n#endif\n\n\n\nvarying vec3 vFragPos;\n\nvarying vec3 vNormal;\n\n\n\nuniform mat4 projMatrix;\n\nuniform mat4 viewModelMatrix;\n\nuniform mat3 modelNormalMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform vec2 halton;\n\nuniform vec2 outSize;\n\n\n\nuniform mat4 projViewMatrix;\n\n\n\n#include <get_output>\n\n#include <heatmap_render_vert>\n\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n    #include <vsm_shadow_vert>\n\n#endif\n\n\n\n#ifdef HAS_EXTRUSION_OPACITY\n\n    attribute float aExtrusionOpacity;\n\n    varying float vExtrusionOpacity;\n\n#endif\n\n\n\n#if defined(HAS_TANGENT)\n\n    varying vec4 vTangent;\n\n#endif\n\n\n\nuniform mat4 cut_projViewMatrixFromViewpoint;\n\nvarying vec4 cut_positionFromViewpoint;\n\n\n\n\n\nvoid toTangentFrame(const highp vec4 q, out highp vec3 n) {\n\n    n = vec3( 0.0,  0.0,  1.0) +\n\n        vec3( 2.0, -2.0, -2.0) * q.x * q.zwx +\n\n        vec3( 2.0,  2.0, -2.0) * q.y * q.wzy;\n\n}\n\n\n\n\n\nvoid toTangentFrame(const highp vec4 q, out highp vec3 n, out highp vec3 t) {\n\n    toTangentFrame(q, n);\n\n    t = vec3( 1.0,  0.0,  0.0) +\n\n        vec3(-2.0,  2.0, -2.0) * q.y * q.yxw +\n\n        vec3(-2.0,  2.0,  2.0) * q.z * q.zwx;\n\n}\n\n\n\n\n\nvoid main()\n\n{\n\n    #ifdef IS_LINE_EXTRUSION\n\n        vec4 localPosition = getPosition(getLineExtrudePosition(aPosition));\n\n    #else\n\n        vec4 localPosition = getPosition(aPosition);\n\n    #endif\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n\n\n    vFragPos = vec3(modelMatrix * localPositionMatrix * localPosition);\n\n\n\n    #if defined(HAS_NORMAL) || defined(HAS_TANGENT)\n\n        mat3 localNormalMatrix = modelNormalMatrix * mat3(localPositionMatrix);\n\n        vec3 Normal;\n\n        #if defined(HAS_TANGENT)\n\n            vec3 t;\n\n            toTangentFrame(aTangent, Normal, t);\n\n            vTangent = vec4(localNormalMatrix * t, aTangent.w);\n\n        #else\n\n            #ifdef HAS_DECODE_NORMAL\n\n                Normal = getNormal(aNormal);\n\n            #else\n\n                Normal = aNormal;\n\n            #endif\n\n        #endif\n\n        vec3 localNormal = appendMorphNormal(Normal);\n\n        vNormal = normalize(localNormalMatrix * localNormal);\n\n    #else\n\n        vNormal = vec3(0.0);\n\n    #endif\n\n\n\n    mat4 jitteredProjection = projMatrix;\n\n    jitteredProjection[2].xy += halton.xy / outSize.xy;\n\n    gl_Position = jitteredProjection * viewModelMatrix * localPositionMatrix * localPosition;\n\n    #ifdef HAS_MAP\n\n        vec2 TexCoord = getTexcoord(aTexCoord);\n\n        vTexCoord = TexCoord * uvScale + uvOffset;\n\n    #endif\n\n    #ifdef HAS_EXTRUSION_OPACITY\n\n        vExtrusionOpacity = aExtrusionOpacity;\n\n    #endif\n\n    #if defined(HAS_COLOR)\n\n        vColor = aColor / 255.0;\n\n    #elif defined(HAS_COLOR0)\n\n        vColor = aColor0 / 255.0;\n\n    #endif\n\n    cut_positionFromViewpoint = cut_projViewMatrixFromViewpoint * modelMatrix * localPositionMatrix * localPosition;\n\n}\n\n",frag:"precision mediump float;\n\n#include <gl2_frag>\n\n\n\nuniform vec4 baseColorFactor;\n\nuniform float materialShininess;///\n\nuniform float opacity;\n\nuniform float ambientStrength;\n\nuniform float specularStrength;\n\n\n\nuniform vec3 light0_viewDirection;\n\nuniform vec3 ambientColor;\n\nuniform vec4 light0_diffuse;\n\nuniform vec3 lightSpecular;\n\nuniform vec3 cameraPosition;\n\n\n\n#ifdef HAS_TANGENT\n\n    varying vec4 vTangent;\n\n#endif\n\n\n\n#ifdef HAS_MAP\n\n    varying vec2 vTexCoord;\n\n#endif\n\nvarying vec3 vNormal;\n\nvarying vec3 vFragPos;\n\n\n\n#ifdef HAS_INSTANCE_COLOR\n\n    varying vec4 vInstanceColor;\n\n#endif\n\n\n\n#ifdef HAS_BASECOLOR_MAP\n\n    uniform sampler2D baseColorTexture;\n\n#endif\n\n\n\n#ifdef HAS_EXTRUSION_OPACITY\n\n    uniform vec2 extrusionOpacityRange;\n\n    varying float vExtrusionOpacity;\n\n#endif\n\n\n\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n    varying vec4 vColor;\n\n#elif defined(IS_LINE_EXTRUSION)\n\n    uniform vec4 lineColor;\n\n#else\n\n    uniform vec4 polygonFill;\n\n#endif\n\n\n\n#ifdef IS_LINE_EXTRUSION\n\n    uniform float lineOpacity;\n\n#else\n\n    uniform float polygonOpacity;\n\n#endif\n\n\n\n#ifdef HAS_OCCLUSION_MAP\n\n    uniform sampler2D occlusionTexture;\n\n#endif\n\n\n\n#ifdef HAS_NORMAL_MAP\n\n    uniform sampler2D normalTexture;\n\n#endif\n\n\n\n#ifdef HAS_EMISSIVE_MAP\n\n    uniform sampler2D emissiveTexture;\n\n#endif\n\n\n\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\n\n    uniform vec4 diffuseFactor;\n\n    uniform vec3 specularFactor;\n\n    #ifdef HAS_DIFFUSE_MAP\n\n        uniform sampler2D diffuseTexture;\n\n    #endif\n\n    #ifdef HAS_SPECULARGLOSSINESS_MAP\n\n        uniform sampler2D specularGlossinessTexture;\n\n    #endif\n\n#endif\n\n#include <heatmap_render_frag>\n\n\n\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n  #include <vsm_shadow_frag>\n\n#endif\n\nvarying vec4 cut_positionFromViewpoint;\n\n\n\nvec3 transformNormal() {\n\n    #if defined(HAS_NORMAL_MAP)\n\n        vec3 n = normalize(vNormal);\n\n        vec3 normal = texture2D(normalTexture, vTexCoord).xyz * 2.0 - 1.0;\n\n        #if defined(HAS_TANGENT)\n\n            vec3 t = normalize(vTangent.xyz);\n\n            vec3 b = normalize(cross(n, t) * sign(vTangent.w));\n\n            mat3 tbn = mat3(t, b, n);\n\n            return normalize(tbn * normal);\n\n        #else\n\n            return normalize(normal);\n\n        #endif\n\n    #else\n\n        return normalize(vNormal);\n\n    #endif\n\n}\n\n\n\nvec4 linearTosRGB(const in vec4 color) {\n\n    return vec4( color.r < 0.0031308 ? color.r * 12.92 : 1.055 * pow(color.r, 1.0/2.4) - 0.055, color.g < 0.0031308 ? color.g * 12.92 : 1.055 * pow(color.g, 1.0/2.4) - 0.055, color.b < 0.0031308 ? color.b * 12.92 : 1.055 * pow(color.b, 1.0/2.4) - 0.055, color.a);\n\n}\n\n\n\nvec4 getBaseColor() {\n\n    #if defined(HAS_BASECOLOR_MAP)\n\n        return texture2D(baseColorTexture, vTexCoord);\n\n    #elif defined(HAS_DIFFUSE_MAP)\n\n        return texture2D(diffuseTexture, vTexCoord);\n\n    #elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\n\n        return diffuseFactor;\n\n    #else\n\n        return baseColorFactor;\n\n    #endif\n\n}\n\n\n\nvec3 getSpecularColor() {\n\n    #if defined(HAS_SPECULARGLOSSINESS_MAP)\n\n        return texture2D(specularGlossinessTexture, vTexCoord).rgb;\n\n    #elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\n\n        return specularFactor;\n\n    #else\n\n        return vec3(1.0);\n\n    #endif\n\n}\n\n\n\nvoid main() {\n\n    //\n\n    vec4 baseColor = getBaseColor();\n\n    vec3 ambient = ambientStrength * ambientColor * baseColor.rgb;\n\n\n\n    #ifdef HAS_INSTANCE_COLOR\n\n        ambient *= vInstanceColor.rgb;\n\n    #endif\n\n\n\n    //\n\n    vec3 norm = transformNormal();\n\n    vec3 lightDir = normalize(-light0_viewDirection);\n\n    float diff = max(dot(norm, lightDir), 0.0);\n\n    vec3 diffuse = light0_diffuse.rgb * diff * baseColor.rgb;\n\n    #if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n        vec3 color = vColor.rgb;\n\n    #elif defined(IS_LINE_EXTRUSION)\n\n        vec3 color = lineColor.rgb;\n\n    #else\n\n        vec3 color = polygonFill.rgb;\n\n    #endif\n\n    #ifdef HAS_INSTANCE_COLOR\n\n        color *= vInstanceColor.rgb;\n\n    #endif\n\n    ambient *= color.rgb;\n\n    diffuse *= color.rgb;\n\n\n\n    //\n\n    vec3 viewDir = normalize(cameraPosition - vFragPos);\n\n    vec3 halfwayDir = normalize(lightDir + viewDir);\n\n    float spec = pow(max(dot(norm, halfwayDir), 0.0), materialShininess);\n\n    vec3 specular = specularStrength * lightSpecular * spec * getSpecularColor();\n\n    #ifdef HAS_OCCLUSION_MAP\n\n        float ao = texture2D(occlusionTexture, vTexCoord).r;\n\n        ambient *= ao;\n\n    #endif\n\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n        float shadowCoeff = shadow_computeShadow();\n\n        diffuse = shadow_blend(diffuse, shadowCoeff).rgb;\n\n        specular = shadow_blend(specular, shadowCoeff).rgb;\n\n    #endif\n\n    vec3 result = ambient + diffuse + specular;\n\n\n\n    #ifdef HAS_EMISSIVE_MAP\n\n        vec3 emit = texture2D(emissiveTexture, vTexCoord).rgb;\n\n        result += emit;\n\n    #endif\n\n    vec3 shadowCoord = (cut_positionFromViewpoint.xyz / cut_positionFromViewpoint.w)/2.0 + 0.5;\n\n    if (shadowCoord.x > 0.0 && shadowCoord.x < 1.0 && shadowCoord.y > 0.0 && shadowCoord.y < 1.0 && shadowCoord.z < 1.0) {\n\n        discard;\n\n    }\n\n    glFragColor = vec4(result, opacity);\n\n    // glFragColor = linearTosRGB(glFragColor);\n\n    #if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n        float colorAlpha = vColor.a;\n\n    #elif defined(IS_LINE_EXTRUSION)\n\n        float colorAlpha = lineColor.a;\n\n    #else\n\n        float colorAlpha = polygonFill.a;\n\n    #endif\n\n        glFragColor *= colorAlpha;\n\n    #ifdef HAS_EXTRUSION_OPACITY\n\n        float topAlpha = extrusionOpacityRange.x;\n\n        float bottomAlpha = extrusionOpacityRange.y;\n\n        float alpha = topAlpha + vExtrusionOpacity * (bottomAlpha - topAlpha);\n\n        alpha = clamp(alpha, 0.0, 1.0);\n\n        glFragColor *= alpha;\n\n    #endif\n\n\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:r,defines:A.defines||{},extraCommandProps:A.extraCommandProps||{}}),this.version=300}}const qA=[0,0,0,1],WA={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]};class VA{constructor(A,t){this.renderer=A,this.u=t,this.h()}h(){this.xA=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.dA=new rt$6({vert:MA,frag:bA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>V([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.yA=new rt$6({vert:MA,frag:bA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>V([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u,depth:{enable:!0,func:"always",mask:!1,range:[0,0]}}}),this.mA=new YA({extraCommandProps:{viewport:this.u,blend:{enable:(A,t)=>!!t.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}}),this.pA=new YA({extraCommandProps:{viewport:this.u,blend:{enable:(A,t)=>!!t.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"},depth:{enable:!0,func:"always",mask:!1,range:[0,0]}}}),this.l=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.LA=new pe$4,this.TA=new pe$4,this.C=new pe$4}OA(A,t,n,i){this.controller=new GA(A,this.renderer,t,n,i)}FA(A,t,n){this.controller&&(this.controller.updateTRS(A,t,n),this.controller.aA(),this.controller.eA())}render(A,t){this.D(),this.renderer.clear({color:qA,depth:1,framebuffer:this.l});const n=this.EA(A),i=this.controller.getAllMeshes(),r=this.controller.createProjViewMatrix();return this.UA(n,i,r,t.map),this.NA(n,i,r,t.map),{meshesMap:this.xA,invisibleMap:this.l}}EA(t){const n=[];for(let i=0;i<t.length;i++){const r=t$2.Util.extend({},t[i].material.uniforms,WA),e=new ie$4(r),s=new de$4(t[i].geometry,e),u=s.getDefines();u.HAS_CUT=1,s.setDefines(u),s.localTransform=t[i].localTransform,n.push(s)}return n}NA(A,t,n,i){this.renderer.clear({color:[0,0,0,0],depth:1,framebuffer:this.l});const r={cut_projViewMatrixFromViewpoint:n,projViewMatrix:i.projViewMatrix};this.C.setMeshes(A),this.renderer.render(this.dA,r,this.C,this.l),this.C.setMeshes(t),this.renderer.render(this.yA,r,this.C,this.l)}UA(t,n,i,r){this.renderer.clear({color:[0,0,0,0],depth:1,framebuffer:this.xA});const e=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,s=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height,u={projMatrix:r.projMatrix,cut_projViewMatrixFromViewpoint:i,projViewMatrix:r.projViewMatrix,viewMatrix:r.viewMatrix,cameraPosition:r.cameraPosition,altitudeScale:1,outSize:[e,s],halton:[.2107,-.0202],polygonFill:[1,1,1,1],polygonOpacity:1};!function(t,n,i,r){const{iblTexes:e,dfgLUT:s}=ur$4.PBRUtils.getIBLResOnCanvas(n);if(i&&i.getLights()){const n=ur$4.PBRUtils.getPBRUniforms(i,e,s,r,r),u=i.getLights();t.ambientColor=u.ambient&&u.ambient.color?u.ambient.color:[1,1,1],n&&t$2.Util.extend(t,n)}else{const n=ur$4.PBRUtils.getPBRUniforms(i,null,s,r,r);t$2.Util.extend(t,n)}}(u,this.renderer.canvas,r),this.LA.setMeshes(t),this.renderer.render(this.mA,u,this.LA,this.xA),this.TA.setMeshes(n),this.renderer.render(this.pA,u,this.TA,this.xA)}dispose(){this.l&&this.l.destroy(),this.jA&&this.jA.dispose(),this.QA&&this.QA.dispose(),this.controller&&this.controller.zA()}D(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.l||this.l.width===A&&this.l.height===t||this.l.resize(A,t),!this.xA||this.xA.width===A&&this.xA.height===t||this.xA.resize(A,t),this.controller&&this.controller.resize(A,t)}}var HA="attribute vec3 aPosition;\n\n// uniform mat4 projViewMatrix;\n\n// uniform mat4 modelMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewModelMatrix * localPositionMatrix * getPosition(aPosition);\n\n}\n\n",_A="#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n\n\nvec4 pack (float depth) {\n\n    // ,z,18,432\n\n    // rgba 432z,11/256\n\n    const vec4 bitShift = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    const vec4 bitMask = vec4(1.0/256.0, 1.0/256.0, 1.0/256.0, 0.0);\n\n    // gl_FragCoord:,fract():\n\n    vec4 rgbaDepth = fract(depth * bitShift); //z\n\n    rgbaDepth -= rgbaDepth.gbaa * bitMask; // Cut off the value which do not fit in 8 bits\n\n    return rgbaDepth;\n\n}\n\n//z,zgl_FragColor,z,\n\nvoid main() {\n\n    gl_FragColor = pack(gl_FragCoord.z);// zrgba,z\n\n}\n\n";const JA=[0,0,0,1,1,-1,1,-1,-1,1,-1,1,1,1,1],ZA=[0,1,0,2,0,3,0,4,1,2,2,3,3,4,4,1],XA=[],$A=[],At=[],tt=[1,0,0],nt=[],it=[0,0,0,1];class rt{constructor(A,t){this.renderer=A,this.u=t,this.h()}h(){this.jA=new rt$6({vert:HA,frag:_A,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>V([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.BA=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.RA=new rt$6({vert:"attribute vec3 aPosition;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 viewshed_projViewMatrixFromViewpoint;\n\nvarying vec4 viewshed_positionFromViewpoint;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_PointSize = 1.0;\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n    viewshed_positionFromViewpoint = viewshed_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nvarying vec4 viewshed_positionFromViewpoint;\n\nuniform sampler2D depthMap;\n\n#ifdef HAS_HELPERLINE\n\n  uniform vec3 lineColor;\n\n#endif\n\n\n\nfloat viewshed_unpack(const in vec4 rgbaDepth) {\n\n    const vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0*256.0), 1.0/(256.0*256.0*256.0));\n\n    float depth = dot(rgbaDepth, bitShift);\n\n    return depth;\n\n}\n\n\n\nvoid main() {\n\n    #ifdef HAS_HELPERLINE\n\n        gl_FragColor = vec4(lineColor, 0.009);\n\n    #else\n\n        vec3 shadowCoord = (viewshed_positionFromViewpoint.xyz / viewshed_positionFromViewpoint.w)/2.0 + 0.5;\n\n        vec4 rgbaDepth = texture2D(depthMap, shadowCoord.xy);\n\n        float depth = viewshed_unpack(rgbaDepth); // Retrieve the z-value from R\n\n        if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && shadowCoord.z <= 1.0) {\n\n            if (shadowCoord.z <= depth + 0.002) {\n\n                gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//\n\n            } else {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);//\n\n            }\n\n        } else {\n\n            gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n        }\n\n    #endif\n\n}\n\n\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>V([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.l=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const t=new Z$7({POSITION:JA},ZA,0,{primitive:"lines",positionAttribute:"POSITION"});this.kA=new de$4(t,new ee$3({lineColor:[.8,.8,.1]}));const n=this.kA.getDefines();n.HAS_HELPERLINE=1,this.kA.setDefines(n),this.C=new pe$4}render(A,t){this.D(),this.renderer.clear({color:it,depth:1,framebuffer:this.l});const n=t.eyePos,i=t.lookPoint;if(!n||!i)return this.l;const r=t.verticalAngle||90,e=t.horizontalAngle||90,s=Math.sqrt(Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2)+Math.pow(n[2]-i[2],2));s<=0&&console.warn("both lookpoint and eyePos are in the same position");const u=W(XA),o=eA(At,i[0]-n[0],i[1]-n[1],i[2]-n[2]),h=this.GA(nt,tt,o);let f=cA(tt,o);f=o[1]>=0?f:2*Math.PI-f;const c=function(A,t,n){n*=.5;var i=Math.sin(n);return A[0]=i*t[0],A[1]=i*t[1],A[2]=i*t[2],A[3]=Math.cos(n),A}($A,h,f),a=e*Math.PI/360,v=r*Math.PI/360;X(u,c,n,[s,s*Math.tan(a),s*Math.tan(v)]),this.kA.localTransform=u,A.push(this.kA),this.C.setMeshes(A);const l=this.YA(n,i,r,e);return this.qA(this.C,l),this.WA(this.C,l,t.projViewMatrix),this.l}GA(A,t,n){if(0===t[0]&&0===n[0])return eA(A,1,0,0);if(0===t[1]&&0===n[1])return eA(A,0,1,0);{const i=(t[2]*n[0]-n[2]*t[0])/(t[0]*n[1]-n[0]*t[1]);return eA(A,(t[2]-n[2]+(t[1]-n[1])*i)/(t[0]-n[0]),i,1)}}qA(A,t){const n={projViewMatrix:t};this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.BA}),this.renderer.render(this.jA,n,A,this.BA)}WA(A,t,n){this.renderer.render(this.RA,{viewshed_projViewMatrixFromViewpoint:t,projViewMatrix:n,depthMap:this.BA},A,this.l)}YA(A,t,n,i){const r=n/i;let e=Math.sqrt(Math.pow(A[0]-t[0],2)+Math.pow(A[1]-t[1],2)+Math.pow(A[2]-t[2],2));return e=e<1?1:e,V([],$([],i*Math.PI/180,r,1,e),AA([],A,t,[0,1,0]))}dispose(){this.l&&this.l.destroy(),this.BA&&this.BA.destroy(),this.jA&&this.jA.dispose(),this.RA&&this.RA.dispose(),this.kA&&(this.kA.geometry.dispose(),this.kA.dispose())}D(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.l||this.l.width===A&&this.l.height===t||this.l.resize(A,t),!this.BA||this.BA.width===A&&this.BA.height===t||this.BA.resize(A,t)}}class st{constructor(A,t){this.VA=A,this.regl=A.regl,this.u=t,this.h()}render(A,{projViewMatrix:t,lineColor:n,lineWidth:i}){if(A&&A.length)return this.KA(),this.D(),this.C.setMeshes(A),this.HA(this.C,t),this._A(n,i,this.l),this.l}h(){this.fboExtent=this.JA();const t=this.u;this.extentShader=new rt$6({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>  \n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n}",frag:"precision highp float;\n\nvoid main() {\n\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\n}",extraCommandProps:{viewport:t,cull:{enable:!1}}}),this.outlineShader=new ht$6({vert:"#if __VERSION__ == 300\n\n\t#define attribute in\n\n\t#define varying out\n\n#endif\n\n\n\nattribute vec2 aPosition;\n\nattribute vec2 aTexCoord;\n\n\n\nvarying vec2 vTexCoord;\n\n\n\nvoid main()\n\n{\n\n  gl_Position = vec4(aPosition, 0., 1.);\n\n  vTexCoord = aTexCoord;\n\n}\n\n",frag:"precision highp float;\n\nprecision highp int;\n\n\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D maskTexture;\n\nuniform vec2 texSize;\n\nuniform vec3 visibleEdgeColor;\n\nuniform float lineWidth;\n\nvoid main() {\n\n    vec2 invSize = (1.0 / texSize) * lineWidth;\n\n    vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize.x, invSize.y, invSize.x, invSize.y);\n\n    vec4 c1 = texture2D(maskTexture, vTexCoord + uvOffset.xy);\n\n    vec4 c2 = texture2D(maskTexture, vTexCoord - uvOffset.xy);\n\n    vec4 c3 = texture2D(maskTexture, vTexCoord + uvOffset.yw);\n\n    vec4 c4 = texture2D(maskTexture, vTexCoord - uvOffset.yw);\n\n    float diff1 = (c1.r - c2.r)*0.7;\n\n    float diff2 = (c3.r - c4.r)*0.7;\n\n    float d = length(vec2(diff1, diff2) );\n\n    float a1 = min(c1.g, c2.g);\n\n    float a2 = min(c3.g, c4.g);\n\n    float visibilityFactor = min(a1, a2);\n\n    gl_FragColor = 1.0 - visibilityFactor > 0.001 ? vec4(visibleEdgeColor, 1.0) * vec4(d) : vec4(0.0);\n\n}",extraCommandProps:{viewport:t,depth:{enable:!0,mask:!1,func:"always"},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}}),this.l=this.regl.framebuffer({color:this.regl.texture({width:t.width(),height:t.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.C=new pe$4}HA(A,t){this.VA.render(this.extentShader,{projViewMatrix:t},A,this.fboExtent)}_A(A,t,n){this.VA.render(this.outlineShader,{texSize:[n.width,n.height],visibleEdgeColor:A||[1,0,0],maskTexture:this.fboExtent,lineWidth:t||1},null,n)}JA(){return this.regl.framebuffer({color:this.regl.texture({width:2,height:2,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}getRenderMeshes(){return this.C.getMeshes()}KA(){this.regl.clear({color:[1,1,1,1],depth:1,framebuffer:this.fboExtent})}dispose(){this.fboExtent&&(this.fboExtent.destroy(),this.extentShader.dispose(),this.outlineShader.dispose(),delete this.fboExtent),this.l&&(this.l.destroy(),delete this.l)}D(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;this.l.width===A&&this.fboExtent.height===t||this.l.resize(A,t),this.fboExtent.width===A&&this.fboExtent.height===t||this.fboExtent.resize(A,t)}}const ut="undefined"==typeof document?null:document.createElement("canvas");class ht{constructor(A,t){this.renderer=A,this.u=t,this.h()}h(){this.jA=new rt$6({vert:HA,frag:_A,extraCommandProps:{viewport:this.u}}),this.g=new rt$6({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>\n\nvarying float flood_height;\n\nvarying vec4 vWorldPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vWorldPosition = worldPosition;\n\n    gl_Position = projViewMatrix * worldPosition;\n\n    flood_height = worldPosition.z;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform vec4 extent;\n\nuniform float waterHeight;\n\nuniform sampler2D extentMap;\n\nuniform float hasExtent;\n\nuniform float type;\n\nvarying float flood_height;\n\nvarying vec4 vWorldPosition;\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    bool compare = type == 1.0 ? flood_height < waterHeight : flood_height >= waterHeight;\n\n    if (compare) {\n\n        if (hasExtent == 1.0) {\n\n            if (extentColor.r > 0.0) {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n            } else {\n\n                gl_FragColor = vec4(0.0);\n\n            }\n\n        } else {\n\n            gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n        }\n\n    } else {\n\n        gl_FragColor = vec4(0.0);\n\n    }\n\n}\n\n",extraCommandProps:{viewport:this.u}}),this.l=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}render(t,n){this.D(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.l});const i=new pe$4(t);return this.At(i,n),this.l}At(A,t){this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.l}),this.renderer.render(this.g,t,A,this.l)}dispose(){this.l&&this.l.destroy(),this.g&&this.g.dispose()}D(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.l||this.l.width===A&&this.l.height===t||this.l.resize(A,t)}}const ft=[.1451,.2588,.4863],ct=[0,0,0,0];class at extends Y{constructor(A){super(A),this.type="floodAnalysis"}SA(A){const t=this.layer.getMap();if(this.N={},this.N.waterHeight=a(t,this.options.waterHeight),this.N.extent=ct,this.N.extentMap=A.regl.texture({width:2,height:2}),this.N.hasExtent=0,this.N.type=1,this.options.boundary){const{extentMap:A,extentInWorld:t}=this.j(this.options.boundary);this.N.extent=t,this.N.extentMap=A,this.N.hasExtent=1}this.N.projViewMatrix=t.projViewMatrix}T(t){const n=this.u={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.SA(t);const i=new k$7(t.regl);this.O=this.O||new ht(i,n),this.layer.addAnalysis(this)}update(A,t){if("boundary"===A){const{extentMap:A,extentInWorld:n,extentPolygon:i}=this.j(t);this.N.extent=n,this.N.extentPolygon=i,this.N.extentMap=A}else if("waterHeight"===A){const A=this.layer.getMap();this.N.waterHeight=A.altitudeToPoint(t||0,A.getGLRes())}else this.N[A]=t;super.update(A,t)}renderAnalysis(A){const t={};return this.options.boundary&&this.F.render(this.U,this.B),t.flood_waterColor=this.options.waterColor||ft,t.floodMap=this.O.render(A,this.N),t}getDefines(){return{HAS_FLOODANALYSE:1}}}const vt=[0,0,0,1,0,0],lt=[0,1],wt=[],Pt=[0,0,0,1];class gt{constructor(A,t){this.renderer=A,this.u=t,this.h()}h(){this.jA=new rt$6({vert:HA,frag:_A,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>V([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.BA=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.tt=new rt$6({vert:"attribute vec3 aPosition;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 insight_projViewMatrixFromViewpoint;\n\nvarying vec4 insight_positionFromViewpoint;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n    insight_positionFromViewpoint = insight_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nvarying vec4 insight_positionFromViewpoint;\n\nuniform sampler2D depthMap;\n\n\n\nfloat unpack(const in vec4 rgbaDepth) {\n\n    const vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0*256.0), 1.0/(256.0*256.0*256.0));\n\n    float depth = dot(rgbaDepth, bitShift);\n\n    return depth;\n\n}\n\n\n\nvoid main() {\n\n    vec3 shadowCoord = (insight_positionFromViewpoint.xyz / insight_positionFromViewpoint.w)/2.0 + 0.5;\n\n    vec4 rgbaDepth = texture2D(depthMap, shadowCoord.xy);\n\n    float depth = unpack(rgbaDepth); // Retrieve the z-value from R\n\n    if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && shadowCoord.z <= 1.0) {\n\n        if (depth <0.001) {\n\n            gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//,green\n\n        } else {\n\n            if (shadowCoord.z <= depth + 0.002) {\n\n                gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//,green\n\n            } else {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);//,red\n\n            }\n\n        }\n\n    } else {\n\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);//,blue\n\n    }\n\n}\n\n\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>V([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.l=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const t=new Z$7({POSITION:vt},lt,0,{primitive:"lines",positionAttribute:"POSITION"});this.nt=t,this.kA=new de$4(t,new ee$3({lineColor:[.8,.8,.1]})),this.C=new pe$4}render(A,t){this.D(),this.renderer.clear({color:Pt,depth:1,framebuffer:this.l});const n=t.eyePos,i=t.lookPoint;if(!n||!i)return this.l;const r=W(wt);this.kA.localTransform=r,this.C.setMeshes(A);const e=this.YA(n,i,45,45);return this.qA(this.C,e),this.it(n,i),this.C.setMeshes(this.kA),this.rt(this.C,e,t.projViewMatrix),this.l}it(t,n){this.nt&&(this.nt.dispose(),this.kA.dispose(),vt[0]=t[0],vt[1]=t[1],vt[2]=t[2],vt[3]=n[0],vt[4]=n[1],vt[5]=n[2],this.nt=new Z$7({POSITION:vt},lt,0,{primitive:"lines",positionAttribute:"POSITION"}),this.kA=new de$4(this.nt,new ee$3({lineColor:[.8,.8,.1]})))}qA(A,t){const n={projViewMatrix:t};this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.BA}),this.renderer.render(this.jA,n,A,this.BA)}rt(A,t,n){this.renderer.render(this.tt,{insight_projViewMatrixFromViewpoint:t,projViewMatrix:n,depthMap:this.BA},A,this.l)}YA(A,t,n,i){const r=n/i,e=Math.sqrt(Math.pow(A[0]-t[0],2)+Math.pow(A[1]-t[1],2)+Math.pow(A[2]-t[2],2));return V([],$([],i*Math.PI/180,r,1,e+1e3),AA([],A,t,[0,1,0]))}dispose(){this.l&&this.l.destroy(),this.BA&&this.BA.destroy(),this.jA&&this.jA.dispose(),this.tt&&this.tt.dispose(),this.kA&&(this.kA.geometry.dispose(),this.kA.dispose())}D(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.l||this.l.width===A&&this.l.height===t||this.l.resize(A,t),!this.BA||this.BA.width===A&&this.BA.height===t||this.BA.resize(A,t)}}const Dt=[0,0,0,1];class It{constructor(A,t){this.renderer=A,this.u=t,this.h()}h(){this.g=new rt$6({vert:"precision mediump float;\n\nattribute vec3 aPosition;\n\nattribute vec2 aTexCoord;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform vec4 extent;\n\nuniform sampler2D extentMap;\n\nuniform float height;\n\nvarying vec4 vWorldPosition;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\n    vWorldPosition = modelMatrix * vec4(aPosition, 1.0);\n\n    float w = extent.z - extent.x;\n\n    float h = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / w, 1.0 - (vWorldPosition.y - extent.w) / h);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    if (extentColor.r > 0.0) {\n\n        vec4 wPosition = vec4(vWorldPosition.x, vWorldPosition.y, height, vWorldPosition.w);\n\n        gl_Position = projViewMatrix * wPosition;\n\n    } else {\n\n        gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n\n    }\n\n    v_texCoord = aTexCoord;\n\n}\n\n",frag:"precision mediump float;\n\nuniform vec4 extent;\n\nuniform vec4 extentPolygon;\n\nuniform sampler2D extentMap;\n\nuniform sampler2D groundTexture;\n\n#ifdef HAS_TERRAIN\n\n    uniform sampler2D u_image;\n\n#endif\n\n#ifdef HAS_MODELTEXTURE\n\n    uniform sampler2D baseColorTexture;\n\n#endif\n\nuniform float hasTexture;\n\nvarying vec4 vWorldPosition;\n\nvarying vec2 v_texCoord;\n\n\n\nvoid fragColor() {\n\n    #ifdef HAS_TERRAIN\n\n        gl_FragColor = texture2D(u_image, v_texCoord);\n\n    #endif\n\n    #ifdef HAS_MODELTEXTURE\n\n        gl_FragColor = texture2D(baseColorTexture, v_texCoord);\n\n    #endif\n\n}\n\n\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n\n\n    float widthPolygon = extentPolygon.z - extentPolygon.x;\n\n    float heightPolygon = extentPolygon.y - extentPolygon.w;\n\n    vec2 uvInExtentPolygon = vec2((vWorldPosition.x - extentPolygon.x) / widthPolygon, 1.0 - (vWorldPosition.y - extentPolygon.w) / heightPolygon);\n\n    vec4 groundColor = texture2D(groundTexture, uvInExtentPolygon);\n\n    if (extentColor.r > 0.0) {\n\n        if (hasTexture == 1.0) {\n\n            gl_FragColor = groundColor;\n\n        } else {\n\n            fragColor();\n\n        }\n\n        // discard;\n\n    } else {\n\n       fragColor();\n\n    }\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>V([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.l=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.C=new pe$4}render(A,t){return this.resize(),this.renderer.clear({color:Dt,depth:1,framebuffer:this.l}),this.C.setMeshes(A),this.renderer.render(this.g,t,this.C,this.l),this.l}dispose(){this.l&&this.l.destroy(),this.g&&this.g.dispose()}resize(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.l||this.l.width===A&&this.l.height===t||this.l.resize(A,t)}}class bt{constructor(A,t){this.renderer=A,this.u=t,this.h()}h(){this.g=new rt$6({vert:"attribute vec3 aPosition;\n\nuniform mat4 viewModelMatrix;\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>\n\nvarying vec4 vWorldPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vWorldPosition = worldPosition;\n\n    gl_Position = projMatrix * viewModelMatrix * localPositionMatrix * getPosition(aPosition);\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform vec4 extent;\n\nuniform sampler2D extentMap;\n\nvarying vec4 vWorldPosition;\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    if (extentColor.r > 0.0) {\n\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    } else {\n\n        gl_FragColor = vec4(0.0);\n\n    }\n\n}\n\n",uniforms:[{name:"viewModelMatrix",type:"function",fn:function(A,n){return multiply$5([],n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:this.u}}),this.l=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}render(t,n){this.D(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.l});const i=new pe$4(t);return this.At(i,n),this.l}At(A,t){this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.l}),this.renderer.render(this.g,t,A,this.l)}dispose(){this.l&&this.l.destroy(),this.g&&this.g.dispose()}D(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.l||this.l.width===A&&this.l.height===t||this.l.resize(A,t)}}var zt={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function xt(A,t,n){void 0===n&&(n={});var i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=A,i}function dt(A,t,n){if(void 0===n&&(n={}),!A)throw new Error("coordinates is required");if(!Array.isArray(A))throw new Error("coordinates must be an Array");if(A.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ft(A[0])||!Ft(A[1]))throw new Error("coordinates must contain numbers");return xt({type:"Point",coordinates:A},t,n)}function yt(A,t,n){if(void 0===n&&(n={}),A.length<2)throw new Error("coordinates must be an array of two or more positions");return xt({type:"LineString",coordinates:A},t,n)}function mt(A,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=A,n}function pt(A,t){void 0===t&&(t="kilometers");var n=zt[t];if(!n)throw new Error(t+" units is invalid");return A*n}function Lt(A,t){void 0===t&&(t="kilometers");var n=zt[t];if(!n)throw new Error(t+" units is invalid");return A/n}function Tt(A){return A%(2*Math.PI)*180/Math.PI}function Ot(A){return A%360*Math.PI/180}function Ft(A){return!isNaN(A)&&null!==A&&!Array.isArray(A)}function Et(A){if(!A)throw new Error("coord is required");if(!Array.isArray(A)){if("Feature"===A.type&&null!==A.geometry&&"Point"===A.geometry.type)return A.geometry.coordinates;if("Point"===A.type)return A.coordinates}if(Array.isArray(A)&&A.length>=2&&!Array.isArray(A[0])&&!Array.isArray(A[1]))return A;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ut(A,t,n){if(void 0===n&&(n={}),!0===n.final)return function(A,t){var n=Ut(t,A);return(n+180)%360}(A,t);var i=Et(A),r=Et(t),e=Ot(i[0]),s=Ot(r[0]),u=Ot(i[1]),o=Ot(r[1]),h=Math.sin(s-e)*Math.cos(o),f=Math.cos(u)*Math.sin(o)-Math.sin(u)*Math.cos(o)*Math.cos(s-e);return Tt(Math.atan2(h,f))}function Nt(A,t,n,i){void 0===i&&(i={});var r=Et(A),e=Ot(r[0]),s=Ot(r[1]),u=Ot(n),o=Lt(t,i.units),h=Math.asin(Math.sin(s)*Math.cos(o)+Math.cos(s)*Math.sin(o)*Math.cos(u));return dt([Tt(e+Math.atan2(Math.sin(u)*Math.sin(o)*Math.cos(s),Math.cos(o)-Math.sin(s)*Math.sin(h))),Tt(h)],i.properties)}function jt(A,t,n){void 0===n&&(n={});var i=Et(A),r=Et(t),e=Ot(r[1]-i[1]),s=Ot(r[0]-i[0]),u=Ot(i[1]),o=Ot(r[1]),h=Math.pow(Math.sin(e/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(o);return pt(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),n.units)}function Qt(A,t,n){void 0===n&&(n={});for(var i,r=("Feature"===(i=A).type?i.geometry:i).coordinates,e=0,s=0;s<r.length&&!(t>=e&&s===r.length-1);s++){if(e>=t){var u=t-e;if(u){var o=Ut(r[s],r[s-1])-180;return Nt(r[s],u,o,n)}return dt(r[s])}e+=jt(r[s],r[s+1],n)}return dt(r[r.length-1])}function St(A,t){if("Feature"===A.type)t(A,0);else if("FeatureCollection"===A.type)for(var n=0;n<A.features.length&&!1!==t(A.features[n],n);n++);}function Bt(A,t){var n,i,r,e,s,u,o,h,f,c,a=0,v="FeatureCollection"===A.type,l="Feature"===A.type,w=v?A.features.length:1;for(n=0;n<w;n++){for(h=v?A.features[n].properties:l?A.properties:{},f=v?A.features[n].bbox:l?A.bbox:void 0,c=v?A.features[n].id:l?A.id:void 0,s=(o=!!(u=v?A.features[n].geometry:l?A.geometry:A)&&"GeometryCollection"===u.type)?u.geometries.length:1,r=0;r<s;r++)if(null!==(e=o?u.geometries[r]:u))switch(e.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(e,a,h,f,c))return!1;break;case"GeometryCollection":for(i=0;i<e.geometries.length;i++)if(!1===t(e.geometries[i],a,h,f,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,a,h,f,c))return!1;a++}}function Rt(A){var t=[1/0,1/0,-1/0,-1/0];return function A(t,n,i){if(null!==t)for(var r,e,s,u,o,h,f,c,a=0,v=0,l=t.type,w="FeatureCollection"===l,P="Feature"===l,g=w?t.features.length:1,C=0;C<g;C++){o=(c=!!(f=w?t.features[C].geometry:P?t.geometry:t)&&"GeometryCollection"===f.type)?f.geometries.length:1;for(var D=0;D<o;D++){var I=0,M=0;if(null!==(u=c?f.geometries[D]:f)){h=u.coordinates;var b=u.type;switch(a=!i||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===n(h,v,C,I,M))return!1;v++,I++;break;case"LineString":case"MultiPoint":for(r=0;r<h.length;r++){if(!1===n(h[r],v,C,I,M))return!1;v++,"MultiPoint"===b&&I++}"LineString"===b&&I++;break;case"Polygon":case"MultiLineString":for(r=0;r<h.length;r++){for(e=0;e<h[r].length-a;e++){if(!1===n(h[r][e],v,C,I,M))return!1;v++}"MultiLineString"===b&&I++,"Polygon"===b&&M++}"Polygon"===b&&I++;break;case"MultiPolygon":for(r=0;r<h.length;r++){for(M=0,e=0;e<h[r].length;e++){for(s=0;s<h[r][e].length-a;s++){if(!1===n(h[r][e][s],v,C,I,M))return!1;v++}M++}I++}break;case"GeometryCollection":for(r=0;r<u.geometries.length;r++)if(!1===A(u.geometries[r],n,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}(A,(function(A){t[0]>A[0]&&(t[0]=A[0]),t[1]>A[1]&&(t[1]=A[1]),t[2]<A[0]&&(t[2]=A[0]),t[3]<A[1]&&(t[3]=A[1])})),t}Rt.default=Rt,"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(A){if(null==this)throw new TypeError(this+" is not an object");var t=Object(this),n=Math.max(Math.min(t.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(n+i,0):Math.min(i,n);var r=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(r=r<0?Math.max(n+arguments[2],0):Math.min(r,n);i<r;)t[i]=A,++i;return t},writable:!0}),Number.isFinite=Number.isFinite||function(A){return"number"==typeof A&&isFinite(A)},Number.isInteger=Number.isInteger||function(A){return"number"==typeof A&&isFinite(A)&&Math.floor(A)===A},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(A){return A!=A},Math.trunc=Math.trunc||function(A){return A<0?Math.ceil(A):Math.floor(A)};var kt=function(){};kt.prototype.interfaces_=function(){return[]},kt.prototype.getClass=function(){return kt},kt.prototype.equalsWithTolerance=function(A,t,n){return Math.abs(A-t)<=n};var Gt=function(A){function t(t){A.call(this,t),this.name="IllegalArgumentException",this.message=t,this.stack=(new A).stack}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t}(Error),Yt=function(){},qt={MAX_VALUE:{configurable:!0}};Yt.isNaN=function(A){return Number.isNaN(A)},Yt.doubleToLongBits=function(A){return A},Yt.longBitsToDouble=function(A){return A},Yt.isInfinite=function(A){return!Number.isFinite(A)},qt.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(Yt,qt);var Wt=function(){},Vt=function(){},Kt=function(){};function Ht(){}var _t=function A(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=A.NULL_ORDINATE;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=A.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Jt={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};_t.prototype.setOrdinate=function(A,t){switch(A){case _t.X:this.x=t;break;case _t.Y:this.y=t;break;case _t.Z:this.z=t;break;default:throw new Gt("Invalid ordinate index: "+A)}},_t.prototype.equals2D=function(){if(1===arguments.length){var A=arguments[0];return this.x===A.x&&this.y===A.y}if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!kt.equalsWithTolerance(this.x,t.x,n)&&!!kt.equalsWithTolerance(this.y,t.y,n)}},_t.prototype.getOrdinate=function(A){switch(A){case _t.X:return this.x;case _t.Y:return this.y;case _t.Z:return this.z}throw new Gt("Invalid ordinate index: "+A)},_t.prototype.equals3D=function(A){return this.x===A.x&&this.y===A.y&&(this.z===A.z||Yt.isNaN(this.z))&&Yt.isNaN(A.z)},_t.prototype.equals=function(A){return A instanceof _t&&this.equals2D(A)},_t.prototype.equalInZ=function(A,t){return kt.equalsWithTolerance(this.z,A.z,t)},_t.prototype.compareTo=function(A){return this.x<A.x?-1:this.x>A.x?1:this.y<A.y?-1:this.y>A.y?1:0},_t.prototype.clone=function(){},_t.prototype.copy=function(){return new _t(this)},_t.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},_t.prototype.distance3D=function(A){var t=this.x-A.x,n=this.y-A.y,i=this.z-A.z;return Math.sqrt(t*t+n*n+i*i)},_t.prototype.distance=function(A){var t=this.x-A.x,n=this.y-A.y;return Math.sqrt(t*t+n*n)},_t.prototype.hashCode=function(){var A=17;return 37*(A=37*A+_t.hashCode(this.x))+_t.hashCode(this.y)},_t.prototype.setCoordinate=function(A){this.x=A.x,this.y=A.y,this.z=A.z},_t.prototype.interfaces_=function(){return[Wt,Vt,Ht]},_t.prototype.getClass=function(){return _t},_t.hashCode=function(){if(1===arguments.length){var A=arguments[0],t=Yt.doubleToLongBits(A);return Math.trunc((t^t)>>>32)}},Jt.DimensionalComparator.get=function(){return Zt},Jt.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},Jt.NULL_ORDINATE.get=function(){return Yt.NaN},Jt.X.get=function(){return 0},Jt.Y.get=function(){return 1},Jt.Z.get=function(){return 2},Object.defineProperties(_t,Jt);var Zt=function(A){if(this.Pt=2,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new Gt("only 2 or 3 dimensions may be specified");this.Pt=t}};Zt.prototype.compare=function(A,t){var n=A,i=t,r=Zt.compare(n.x,i.x);if(0!==r)return r;var e=Zt.compare(n.y,i.y);return 0!==e?e:this.Pt<=2?0:Zt.compare(n.z,i.z)},Zt.prototype.interfaces_=function(){return[Kt]},Zt.prototype.getClass=function(){return Zt},Zt.compare=function(A,t){return A<t?-1:A>t?1:Yt.isNaN(A)?Yt.isNaN(t)?0:-1:Yt.isNaN(t)?1:0};var Xt=function(){};Xt.prototype.create=function(){},Xt.prototype.interfaces_=function(){return[]},Xt.prototype.getClass=function(){return Xt};var $t=function(){},An={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};$t.prototype.interfaces_=function(){return[]},$t.prototype.getClass=function(){return $t},$t.toLocationSymbol=function(A){switch(A){case $t.EXTERIOR:return"e";case $t.BOUNDARY:return"b";case $t.INTERIOR:return"i";case $t.NONE:return"-"}throw new Gt("Unknown location value: "+A)},An.INTERIOR.get=function(){return 0},An.BOUNDARY.get=function(){return 1},An.EXTERIOR.get=function(){return 2},An.NONE.get=function(){return-1},Object.defineProperties($t,An);var tn=function(A,t){return A.interfaces_&&A.interfaces_().indexOf(t)>-1},nn=function(){},rn={LOG_10:{configurable:!0}};nn.prototype.interfaces_=function(){return[]},nn.prototype.getClass=function(){return nn},nn.log10=function(A){var t=Math.log(A);return Yt.isInfinite(t)||Yt.isNaN(t)?t:t/nn.LOG_10},nn.min=function(A,t,n,i){var r=A;return t<r&&(r=t),n<r&&(r=n),i<r&&(r=i),r},nn.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var A=arguments[0],t=arguments[1],n=arguments[2];return A<t?t:A>n?n:A}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],e=arguments[2];return i<r?r:i>e?e:i}},nn.wrap=function(A,t){return A<0?t- -A%t:A%t},nn.max=function(){if(3===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2],i=A;return t>i&&(i=t),n>i&&(i=n),i}if(4===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3],o=r;return e>o&&(o=e),s>o&&(o=s),u>o&&(o=u),o}},nn.average=function(A,t){return(A+t)/2},rn.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(nn,rn);var en=function(A){this.str=A};en.prototype.append=function(A){this.str+=A},en.prototype.setCharAt=function(A,t){this.str=this.str.substr(0,A)+t+this.str.substr(A+1)},en.prototype.toString=function(A){return this.str};var sn=function(A){this.value=A};sn.prototype.intValue=function(){return this.value},sn.prototype.compareTo=function(A){return this.value<A?-1:this.value>A?1:0},sn.isNaN=function(A){return Number.isNaN(A)};var un=function(){};un.isWhitespace=function(A){return A<=32&&A>=0||127===A},un.toUpperCase=function(A){return A.toUpperCase()};var on=function A(){if(this.Ct=0,this.Dt=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof A){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var i=arguments[0];A.call(this,A.parse(i))}}else if(2===arguments.length){var r=arguments[0],e=arguments[1];this.init(r,e)}},hn={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};on.prototype.le=function(A){return(this.Ct<A.Ct||this.Ct===A.Ct)&&this.Dt<=A.Dt},on.prototype.extractSignificantDigits=function(A,t){var n=this.abs(),i=on.magnitude(n.Ct),r=on.TEN.pow(i);(n=n.divide(r)).gt(on.TEN)?(n=n.divide(on.TEN),i+=1):n.lt(on.ONE)&&(n=n.multiply(on.TEN),i-=1);for(var e=i+1,s=new en,u=on.MAX_PRINT_DIGITS-1,o=0;o<=u;o++){A&&o===e&&s.append(".");var h=Math.trunc(n.Ct);if(h<0)break;var f=!1,c=0;h>9?(f=!0,c="9"):c="0"+h,s.append(c),n=n.subtract(on.valueOf(h)).multiply(on.TEN),f&&n.selfAdd(on.TEN);var a=!0,v=on.magnitude(n.Ct);if(v<0&&Math.abs(v)>=u-o&&(a=!1),!a)break}return t[0]=i,s.toString()},on.prototype.sqr=function(){return this.multiply(this)},on.prototype.doubleValue=function(){return this.Ct+this.Dt},on.prototype.subtract=function(){if(arguments[0]instanceof on){var A=arguments[0];return this.add(A.negate())}if("number"==typeof arguments[0]){var t=arguments[0];return this.add(-t)}},on.prototype.equals=function(){if(1===arguments.length){var A=arguments[0];return this.Ct===A.Ct&&this.Dt===A.Dt}},on.prototype.isZero=function(){return 0===this.Ct&&0===this.Dt},on.prototype.selfSubtract=function(){if(arguments[0]instanceof on){var A=arguments[0];return this.isNaN()?this:this.selfAdd(-A.Ct,-A.Dt)}if("number"==typeof arguments[0]){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}},on.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},on.prototype.min=function(A){return this.le(A)?this:A},on.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof on){var A=arguments[0];return this.selfDivide(A.Ct,A.Dt)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfDivide(t,0)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=null,e=null,s=null,u=null,o=null,h=null,f=null,c=null;return c=(r=(h=on.SPLIT*(o=this.Ct/n))-(r=h-o))*(s=(c=on.SPLIT*n)-(s=c-n))-(f=o*n)+r*(u=n-s)+(e=o-r)*s+e*u,c=o+(h=(this.Ct-f-c+this.Dt-o*i)/n),this.Ct=c,this.Dt=o-c+h,this}},on.prototype.dump=function(){return"DD<"+this.Ct+", "+this.Dt+">"},on.prototype.divide=function(){if(arguments[0]instanceof on){var A=arguments[0],t=null,n=null,i=null,r=null,e=null,s=null,u=null,o=null;n=(e=this.Ct/A.Ct)-(t=(s=on.SPLIT*e)-(t=s-e)),o=t*(i=(o=on.SPLIT*A.Ct)-(i=o-A.Ct))-(u=e*A.Ct)+t*(r=A.Ct-i)+n*i+n*r;var h=o=e+(s=(this.Ct-u-o+this.Dt-e*A.Dt)/A.Ct),f=e-o+s;return new on(h,f)}if("number"==typeof arguments[0]){var c=arguments[0];return Yt.isNaN(c)?on.createNaN():on.copy(this).selfDivide(c,0)}},on.prototype.ge=function(A){return(this.Ct>A.Ct||this.Ct===A.Ct)&&this.Dt>=A.Dt},on.prototype.pow=function(A){if(0===A)return on.valueOf(1);var t=new on(this),n=on.valueOf(1),i=Math.abs(A);if(i>1)for(;i>0;)i%2==1&&n.selfMultiply(t),(i/=2)>0&&(t=t.sqr());else n=t;return A<0?n.reciprocal():n},on.prototype.ceil=function(){if(this.isNaN())return on.NaN;var A=Math.ceil(this.Ct),t=0;return A===this.Ct&&(t=Math.ceil(this.Dt)),new on(A,t)},on.prototype.compareTo=function(A){return this.Ct<A.Ct?-1:this.Ct>A.Ct?1:this.Dt<A.Dt?-1:this.Dt>A.Dt?1:0},on.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},on.prototype.setValue=function(){if(arguments[0]instanceof on){var A=arguments[0];return this.init(A),this}if("number"==typeof arguments[0]){var t=arguments[0];return this.init(t),this}},on.prototype.max=function(A){return this.ge(A)?this:A},on.prototype.sqrt=function(){if(this.isZero())return on.valueOf(0);if(this.isNegative())return on.NaN;var A=1/Math.sqrt(this.Ct),n=on.valueOf(this.Ct*A),i=this.subtract(n.sqr()).Ct*(.5*A);return n.add(i)},on.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof on){var A=arguments[0];return this.selfAdd(A.Ct,A.Dt)}if("number"==typeof arguments[0]){var t=arguments[0],n=null,i=null,r=null,e=null,s=null,u=null;return e=(r=this.Ct+t)-(s=r-this.Ct),i=(u=(e=t-s+(this.Ct-e))+this.Dt)+(r-(n=r+u)),this.Ct=n+i,this.Dt=i+(n-this.Ct),this}}else if(2===arguments.length){var o=arguments[0],h=arguments[1],f=null,c=null,a=null,v=null,l=null,w=null,P=null;l=(v=this.Ct+o)-(w=v-this.Ct),a=(c=this.Dt+h)-(P=c-this.Dt);var g=(f=v+(w=(l=o-w+(this.Ct-l))+c))+(w=(a=h-P+(this.Dt-a))+(w+(v-f))),C=w+(f-g);return this.Ct=g,this.Dt=C,this}},on.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof on){var A=arguments[0];return this.selfMultiply(A.Ct,A.Dt)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfMultiply(t,0)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=null,e=null,s=null,u=null,o=null,h=null;r=(o=on.SPLIT*this.Ct)-this.Ct,r=o-r;var f=(o=this.Ct*n)+(h=r*(s=(h=on.SPLIT*n)-(s=h-n))-o+r*(u=n-s)+(e=this.Ct-r)*s+e*u+(this.Ct*i+this.Dt*n)),c=h+(r=o-f);return this.Ct=f,this.Dt=c,this}},on.prototype.selfSqr=function(){return this.selfMultiply(this)},on.prototype.floor=function(){if(this.isNaN())return on.NaN;var A=Math.floor(this.Ct),t=0;return A===this.Ct&&(t=Math.floor(this.Dt)),new on(A,t)},on.prototype.negate=function(){return this.isNaN()?this:new on(-this.Ct,-this.Dt)},on.prototype.clone=function(){},on.prototype.multiply=function(){if(arguments[0]instanceof on){var A=arguments[0];return A.isNaN()?on.createNaN():on.copy(this).selfMultiply(A)}if("number"==typeof arguments[0]){var t=arguments[0];return Yt.isNaN(t)?on.createNaN():on.copy(this).selfMultiply(t,0)}},on.prototype.isNaN=function(){return Yt.isNaN(this.Ct)},on.prototype.intValue=function(){return Math.trunc(this.Ct)},on.prototype.toString=function(){var A=on.magnitude(this.Ct);return A>=-3&&A<=20?this.toStandardNotation():this.toSciNotation()},on.prototype.toStandardNotation=function(){var A=this.getSpecialNumberString();if(null!==A)return A;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!0,t),i=t[0]+1,r=n;if("."===n.charAt(0))r="0"+n;else if(i<0)r="0."+on.stringOfChar("0",-i)+n;else if(-1===n.indexOf(".")){r=n+on.stringOfChar("0",i-n.length)+".0"}return this.isNegative()?"-"+r:r},on.prototype.reciprocal=function(){var A,t,n,i,r=null,e=null,s=null,u=null;A=(n=1/this.Ct)-(r=(s=on.SPLIT*n)-(r=s-n)),e=(u=on.SPLIT*this.Ct)-this.Ct;var o=n+(s=(1-(i=n*this.Ct)-(u=r*(e=u-e)-i+r*(t=this.Ct-e)+A*e+A*t)-n*this.Dt)/this.Ct);return new on(o,n-o+s)},on.prototype.toSciNotation=function(){if(this.isZero())return on.SCI_NOT_ZERO;var A=this.getSpecialNumberString();if(null!==A)return A;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),i=on.SCI_NOT_EXPONENT_CHAR+t[0];if("0"===n.charAt(0))throw new Error("Found leading zero: "+n);var r="";n.length>1&&(r=n.substring(1));var e=n.charAt(0)+"."+r;return this.isNegative()?"-"+e+i:e+i},on.prototype.abs=function(){return this.isNaN()?on.NaN:this.isNegative()?this.negate():new on(this)},on.prototype.isPositive=function(){return(this.Ct>0||0===this.Ct)&&this.Dt>0},on.prototype.lt=function(A){return(this.Ct<A.Ct||this.Ct===A.Ct)&&this.Dt<A.Dt},on.prototype.add=function(){if(arguments[0]instanceof on){var A=arguments[0];return on.copy(this).selfAdd(A)}if("number"==typeof arguments[0]){var t=arguments[0];return on.copy(this).selfAdd(t)}},on.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var A=arguments[0];this.Ct=A,this.Dt=0}else if(arguments[0]instanceof on){var t=arguments[0];this.Ct=t.Ct,this.Dt=t.Dt}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.Ct=n,this.Dt=i}},on.prototype.gt=function(A){return(this.Ct>A.Ct||this.Ct===A.Ct)&&this.Dt>A.Dt},on.prototype.isNegative=function(){return(this.Ct<0||0===this.Ct)&&this.Dt<0},on.prototype.trunc=function(){return this.isNaN()?on.NaN:this.isPositive()?this.floor():this.ceil()},on.prototype.signum=function(){return this.Ct>0?1:this.Ct<0?-1:this.Dt>0?1:this.Dt<0?-1:0},on.prototype.interfaces_=function(){return[Ht,Wt,Vt]},on.prototype.getClass=function(){return on},on.sqr=function(A){return on.valueOf(A).selfMultiply(A)},on.valueOf=function(){if("string"==typeof arguments[0]){var A=arguments[0];return on.parse(A)}if("number"==typeof arguments[0]){var t=arguments[0];return new on(t)}},on.sqrt=function(A){return on.valueOf(A).sqrt()},on.parse=function(A){for(var t=0,n=A.length;un.isWhitespace(A.charAt(t));)t++;var i=!1;if(t<n){var r=A.charAt(t);"-"!==r&&"+"!==r||(t++,"-"===r&&(i=!0))}for(var e=new on,s=0,u=0,o=0;!(t>=n);){var h=A.charAt(t);if(t++,un.isDigit(h)){var f=h-"0";e.selfMultiply(on.TEN),e.selfAdd(f),s++}else{if("."!==h){if("e"===h||"E"===h){var c=A.substring(t);try{o=sn.parseInt(c)}catch(t){throw t instanceof Error?new Error("Invalid exponent "+c+" in string "+A):t}break}throw new Error("Unexpected character '"+h+"' at position "+t+" in string "+A)}u=s}}var a=e,v=s-u-o;if(0===v)a=e;else if(v>0){var l=on.TEN.pow(v);a=e.divide(l)}else if(v<0){var w=on.TEN.pow(-v);a=e.multiply(w)}return i?a.negate():a},on.createNaN=function(){return new on(Yt.NaN,Yt.NaN)},on.copy=function(A){return new on(A)},on.magnitude=function(A){var t=Math.abs(A),n=Math.log(t)/Math.log(10),i=Math.trunc(Math.floor(n));return 10*Math.pow(10,i)<=t&&(i+=1),i},on.stringOfChar=function(A,t){for(var n=new en,i=0;i<t;i++)n.append(A);return n.toString()},hn.PI.get=function(){return new on(3.141592653589793,12246467991473532e-32)},hn.TWO_PI.get=function(){return new on(6.283185307179586,24492935982947064e-32)},hn.PI_2.get=function(){return new on(1.5707963267948966,6123233995736766e-32)},hn.E.get=function(){return new on(2.718281828459045,14456468917292502e-32)},hn.NaN.get=function(){return new on(Yt.NaN,Yt.NaN)},hn.EPS.get=function(){return 123259516440783e-46},hn.SPLIT.get=function(){return 134217729},hn.MAX_PRINT_DIGITS.get=function(){return 32},hn.TEN.get=function(){return on.valueOf(10)},hn.ONE.get=function(){return on.valueOf(1)},hn.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},hn.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(on,hn);var fn=function(){},cn={DP_SAFE_EPSILON:{configurable:!0}};fn.prototype.interfaces_=function(){return[]},fn.prototype.getClass=function(){return fn},fn.orientationIndex=function(A,t,n){var i=fn.orientationIndexFilter(A,t,n);if(i<=1)return i;var r=on.valueOf(t.x).selfAdd(-A.x),e=on.valueOf(t.y).selfAdd(-A.y),s=on.valueOf(n.x).selfAdd(-t.x),u=on.valueOf(n.y).selfAdd(-t.y);return r.selfMultiply(u).selfSubtract(e.selfMultiply(s)).signum()},fn.signOfDet2x2=function(A,t,n,i){return A.multiply(i).selfSubtract(t.multiply(n)).signum()},fn.intersection=function(A,t,n,i){var r=on.valueOf(i.y).selfSubtract(n.y).selfMultiply(on.valueOf(t.x).selfSubtract(A.x)),e=on.valueOf(i.x).selfSubtract(n.x).selfMultiply(on.valueOf(t.y).selfSubtract(A.y)),s=r.subtract(e),u=on.valueOf(i.x).selfSubtract(n.x).selfMultiply(on.valueOf(A.y).selfSubtract(n.y)),o=on.valueOf(i.y).selfSubtract(n.y).selfMultiply(on.valueOf(A.x).selfSubtract(n.x)),h=u.subtract(o).selfDivide(s).doubleValue(),f=on.valueOf(A.x).selfAdd(on.valueOf(t.x).selfSubtract(A.x).selfMultiply(h)).doubleValue(),c=on.valueOf(t.x).selfSubtract(A.x).selfMultiply(on.valueOf(A.y).selfSubtract(n.y)),a=on.valueOf(t.y).selfSubtract(A.y).selfMultiply(on.valueOf(A.x).selfSubtract(n.x)),v=c.subtract(a).selfDivide(s).doubleValue(),l=on.valueOf(n.y).selfAdd(on.valueOf(i.y).selfSubtract(n.y).selfMultiply(v)).doubleValue();return new _t(f,l)},fn.orientationIndexFilter=function(A,t,n){var i=null,r=(A.x-n.x)*(t.y-n.y),e=(A.y-n.y)*(t.x-n.x),s=r-e;if(r>0){if(e<=0)return fn.signum(s);i=r+e}else{if(!(r<0))return fn.signum(s);if(e>=0)return fn.signum(s);i=-r-e}var u=fn.DP_SAFE_EPSILON*i;return s>=u||-s>=u?fn.signum(s):2},fn.signum=function(A){return A>0?1:A<0?-1:0},cn.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(fn,cn);var an=function(){},vn={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};vn.X.get=function(){return 0},vn.Y.get=function(){return 1},vn.Z.get=function(){return 2},vn.M.get=function(){return 3},an.prototype.setOrdinate=function(A,t,n){},an.prototype.size=function(){},an.prototype.getOrdinate=function(A,t){},an.prototype.getCoordinate=function(){},an.prototype.getCoordinateCopy=function(A){},an.prototype.getDimension=function(){},an.prototype.getX=function(A){},an.prototype.clone=function(){},an.prototype.expandEnvelope=function(A){},an.prototype.copy=function(){},an.prototype.getY=function(A){},an.prototype.toCoordinateArray=function(){},an.prototype.interfaces_=function(){return[Vt]},an.prototype.getClass=function(){return an},Object.defineProperties(an,vn);var ln=function(){},wn=function(A){function t(){A.call(this,"Projective point not representable on the Cartesian plane.")}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ln),Pn=function(){};Pn.arraycopy=function(A,t,n,i,r){for(var e=0,s=t;s<t+r;s++)n[i+e]=A[s],e++},Pn.getProperty=function(A){return{"line.separator":"\n"}[A]};var gn=function A(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],i=arguments[1];this.x=n,this.y=i,this.w=1}else if(arguments[0]instanceof A&&arguments[1]instanceof A){var r=arguments[0],e=arguments[1];this.x=r.y*e.w-e.y*r.w,this.y=e.x*r.w-r.x*e.w,this.w=r.x*e.y-e.x*r.y}else if(arguments[0]instanceof _t&&arguments[1]instanceof _t){var s=arguments[0],u=arguments[1];this.x=s.y-u.y,this.y=u.x-s.x,this.w=s.x*u.y-u.x*s.y}}else if(3===arguments.length){var o=arguments[0],h=arguments[1],f=arguments[2];this.x=o,this.y=h,this.w=f}else if(4===arguments.length){var c=arguments[0],a=arguments[1],v=arguments[2],l=arguments[3],w=c.y-a.y,P=a.x-c.x,g=c.x*a.y-a.x*c.y,C=v.y-l.y,D=l.x-v.x,I=v.x*l.y-l.x*v.y;this.x=P*I-D*g,this.y=C*g-w*I,this.w=w*D-C*P}};gn.prototype.getY=function(){var A=this.y/this.w;if(Yt.isNaN(A)||Yt.isInfinite(A))throw new wn;return A},gn.prototype.getX=function(){var A=this.x/this.w;if(Yt.isNaN(A)||Yt.isInfinite(A))throw new wn;return A},gn.prototype.getCoordinate=function(){var A=new _t;return A.x=this.getX(),A.y=this.getY(),A},gn.prototype.interfaces_=function(){return[]},gn.prototype.getClass=function(){return gn},gn.intersection=function(A,t,n,i){var r=A.y-t.y,e=t.x-A.x,s=A.x*t.y-t.x*A.y,u=n.y-i.y,o=i.x-n.x,h=n.x*i.y-i.x*n.y,f=r*o-u*e,c=(e*h-o*s)/f,a=(u*s-r*h)/f;if(Yt.isNaN(c)||Yt.isInfinite(c)||Yt.isNaN(a)||Yt.isInfinite(a))throw new wn;return new _t(c,a)};var Cn=function A(){if(this.It=null,this.Mt=null,this.bt=null,this.zt=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof _t){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof A){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2],o=arguments[3];this.init(e,s,u,o)}},Dn={serialVersionUID:{configurable:!0}};Cn.prototype.getArea=function(){return this.getWidth()*this.getHeight()},Cn.prototype.equals=function(A){if(!(A instanceof Cn))return!1;var t=A;return this.isNull()?t.isNull():this.Mt===t.getMaxX()&&this.zt===t.getMaxY()&&this.It===t.getMinX()&&this.bt===t.getMinY()},Cn.prototype.intersection=function(A){return this.isNull()||A.isNull()||!this.intersects(A)?new Cn:new Cn(this.It>A.It?this.It:A.It,this.Mt<A.Mt?this.Mt:A.Mt,this.bt>A.bt?this.bt:A.bt,this.zt<A.zt?this.zt:A.zt)},Cn.prototype.isNull=function(){return this.Mt<this.It},Cn.prototype.getMaxX=function(){return this.Mt},Cn.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof _t){var A=arguments[0];return this.covers(A.x,A.y)}if(arguments[0]instanceof Cn){var t=arguments[0];return!this.isNull()&&!t.isNull()&&t.getMinX()>=this.It&&t.getMaxX()<=this.Mt&&t.getMinY()>=this.bt&&t.getMaxY()<=this.zt}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&n>=this.It&&n<=this.Mt&&i>=this.bt&&i<=this.zt}},Cn.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof Cn){var A=arguments[0];return!this.isNull()&&!A.isNull()&&!(A.It>this.Mt||A.Mt<this.It||A.bt>this.zt||A.zt<this.bt)}if(arguments[0]instanceof _t){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&!(n>this.Mt||n<this.It||i>this.zt||i<this.bt)}},Cn.prototype.getMinY=function(){return this.bt},Cn.prototype.getMinX=function(){return this.It},Cn.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof _t){var A=arguments[0];this.expandToInclude(A.x,A.y)}else if(arguments[0]instanceof Cn){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this.It=t.getMinX(),this.Mt=t.getMaxX(),this.bt=t.getMinY(),this.zt=t.getMaxY()):(t.It<this.It&&(this.It=t.It),t.Mt>this.Mt&&(this.Mt=t.Mt),t.bt<this.bt&&(this.bt=t.bt),t.zt>this.zt&&(this.zt=t.zt))}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.isNull()?(this.It=n,this.Mt=n,this.bt=i,this.zt=i):(n<this.It&&(this.It=n),n>this.Mt&&(this.Mt=n),i<this.bt&&(this.bt=i),i>this.zt&&(this.zt=i))}},Cn.prototype.minExtent=function(){if(this.isNull())return 0;var A=this.getWidth(),t=this.getHeight();return A<t?A:t},Cn.prototype.getWidth=function(){return this.isNull()?0:this.Mt-this.It},Cn.prototype.compareTo=function(A){var t=A;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this.It<t.It?-1:this.It>t.It?1:this.bt<t.bt?-1:this.bt>t.bt?1:this.Mt<t.Mt?-1:this.Mt>t.Mt?1:this.zt<t.zt?-1:this.zt>t.zt?1:0},Cn.prototype.translate=function(A,t){if(this.isNull())return null;this.init(this.getMinX()+A,this.getMaxX()+A,this.getMinY()+t,this.getMaxY()+t)},Cn.prototype.toString=function(){return"Env["+this.It+" : "+this.Mt+", "+this.bt+" : "+this.zt+"]"},Cn.prototype.setToNull=function(){this.It=0,this.Mt=-1,this.bt=0,this.zt=-1},Cn.prototype.getHeight=function(){return this.isNull()?0:this.zt-this.bt},Cn.prototype.maxExtent=function(){if(this.isNull())return 0;var A=this.getWidth(),t=this.getHeight();return A>t?A:t},Cn.prototype.expandBy=function(){if(1===arguments.length){var A=arguments[0];this.expandBy(A,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this.It-=t,this.Mt+=t,this.bt-=n,this.zt+=n,(this.It>this.Mt||this.bt>this.zt)&&this.setToNull()}},Cn.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof Cn){var A=arguments[0];return this.covers(A)}if(arguments[0]instanceof _t){var t=arguments[0];return this.covers(t)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return this.covers(n,i)}},Cn.prototype.centre=function(){return this.isNull()?null:new _t((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},Cn.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof _t){var A=arguments[0];this.init(A.x,A.x,A.y,A.y)}else if(arguments[0]instanceof Cn){var t=arguments[0];this.It=t.It,this.Mt=t.Mt,this.bt=t.bt,this.zt=t.zt}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3];r<e?(this.It=r,this.Mt=e):(this.It=e,this.Mt=r),s<u?(this.bt=s,this.zt=u):(this.bt=u,this.zt=s)}},Cn.prototype.getMaxY=function(){return this.zt},Cn.prototype.distance=function(A){if(this.intersects(A))return 0;var t=0;this.Mt<A.It?t=A.It-this.Mt:this.It>A.Mt&&(t=this.It-A.Mt);var n=0;return this.zt<A.bt?n=A.bt-this.zt:this.bt>A.zt&&(n=this.bt-A.zt),0===t?n:0===n?t:Math.sqrt(t*t+n*n)},Cn.prototype.hashCode=function(){var A=17;return 37*(A=37*(A=37*(A=37*A+_t.hashCode(this.It))+_t.hashCode(this.Mt))+_t.hashCode(this.bt))+_t.hashCode(this.zt)},Cn.prototype.interfaces_=function(){return[Wt,Ht]},Cn.prototype.getClass=function(){return Cn},Cn.intersects=function(){if(3===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(A.x<t.x?A.x:t.x)&&n.x<=(A.x>t.x?A.x:t.x)&&n.y>=(A.y<t.y?A.y:t.y)&&n.y<=(A.y>t.y?A.y:t.y)}if(4===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=arguments[3],u=Math.min(e.x,s.x),o=Math.max(e.x,s.x),h=Math.min(i.x,r.x),f=Math.max(i.x,r.x);return!(h>o||f<u||(u=Math.min(e.y,s.y),o=Math.max(e.y,s.y),h=Math.min(i.y,r.y),f=Math.max(i.y,r.y),h>o||f<u))}},Dn.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(Cn,Dn);var In={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Mn=function(A){this.geometryFactory=A||new sr};Mn.prototype.read=function(A){var t,n;A=A.replace(/[\n\r]/g," ");var r=In.typeStr.exec(A);if(-1!==A.search("EMPTY")&&((r=In.emptyTypeStr.exec(A))[2]=void 0),r&&(n=r[1].toLowerCase(),zn[n]&&(t=zn[n].apply(this,[r[2]]))),void 0===t)throw new Error("Could not parse WKT "+A);return t},Mn.prototype.write=function(A){return this.extractGeometry(A)},Mn.prototype.extractGeometry=function(A){var t=A.getGeometryType().toLowerCase();if(!bn[t])return null;var n=t.toUpperCase();return A.isEmpty()?n+" EMPTY":n+"("+bn[t].apply(this,[A])+")"};var bn={coordinate:function(A){return A.x+" "+A.y},point:function(A){return bn.coordinate.call(this,A.xt.xt[0])},multipoint:function(A){for(var t=[],n=0,i=A.dt.length;n<i;++n)t.push("("+bn.point.apply(this,[A.dt[n]])+")");return t.join(",")},linestring:function(A){for(var t=[],n=0,i=A.yt.xt.length;n<i;++n)t.push(bn.coordinate.apply(this,[A.yt.xt[n]]));return t.join(",")},linearring:function(A){for(var t=[],n=0,i=A.yt.xt.length;n<i;++n)t.push(bn.coordinate.apply(this,[A.yt.xt[n]]));return t.join(",")},multilinestring:function(A){for(var t=[],n=0,i=A.dt.length;n<i;++n)t.push("("+bn.linestring.apply(this,[A.dt[n]])+")");return t.join(",")},polygon:function(A){var t=[];t.push("("+bn.linestring.apply(this,[A.Lt])+")");for(var n=0,i=A.Tt.length;n<i;++n)t.push("("+bn.linestring.apply(this,[A.Tt[n]])+")");return t.join(",")},multipolygon:function(A){for(var t=[],n=0,i=A.dt.length;n<i;++n)t.push("("+bn.polygon.apply(this,[A.dt[n]])+")");return t.join(",")},geometrycollection:function(A){for(var t=[],n=0,i=A.dt.length;n<i;++n)t.push(this.extractGeometry(A.dt[n]));return t.join(",")}},zn={point:function(A){if(void 0===A)return this.geometryFactory.createPoint();var t=A.trim().split(In.spaces);return this.geometryFactory.createPoint(new _t(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(A){var t;if(void 0===A)return this.geometryFactory.createMultiPoint();for(var n=A.trim().split(","),i=[],r=0,e=n.length;r<e;++r)t=n[r].replace(In.trimParens,"$1"),i.push(zn.point.apply(this,[t]));return this.geometryFactory.createMultiPoint(i)},linestring:function(A){if(void 0===A)return this.geometryFactory.createLineString();for(var t,n=A.trim().split(","),i=[],r=0,e=n.length;r<e;++r)t=n[r].trim().split(In.spaces),i.push(new _t(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLineString(i)},linearring:function(A){if(void 0===A)return this.geometryFactory.createLinearRing();for(var t,n=A.trim().split(","),i=[],r=0,e=n.length;r<e;++r)t=n[r].trim().split(In.spaces),i.push(new _t(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLinearRing(i)},multilinestring:function(A){var t;if(void 0===A)return this.geometryFactory.createMultiLineString();for(var n=A.trim().split(In.parenComma),i=[],r=0,e=n.length;r<e;++r)t=n[r].replace(In.trimParens,"$1"),i.push(zn.linestring.apply(this,[t]));return this.geometryFactory.createMultiLineString(i)},polygon:function(A){var t,n,i;if(void 0===A)return this.geometryFactory.createPolygon();for(var r,e=A.trim().split(In.parenComma),s=[],u=0,o=e.length;u<o;++u)t=e[u].replace(In.trimParens,"$1"),n=zn.linestring.apply(this,[t]),i=this.geometryFactory.createLinearRing(n.yt),0===u?r=i:s.push(i);return this.geometryFactory.createPolygon(r,s)},multipolygon:function(A){var t;if(void 0===A)return this.geometryFactory.createMultiPolygon();for(var n=A.trim().split(In.doubleParenComma),i=[],r=0,e=n.length;r<e;++r)t=n[r].replace(In.trimParens,"$1"),i.push(zn.polygon.apply(this,[t]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(A){if(void 0===A)return this.geometryFactory.createGeometryCollection();for(var t=(A=A.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],i=0,r=t.length;i<r;++i)n.push(this.read(t[i]));return this.geometryFactory.createGeometryCollection(n)}},xn=function(A){this.parser=new Mn(A)};xn.prototype.write=function(A){return this.parser.write(A)},xn.toLineString=function(A,t){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+A.x+" "+A.y+", "+t.x+" "+t.y+" )"};var dn=function(A){function t(t){A.call(this,t),this.name="RuntimeException",this.message=t,this.stack=(new A).stack}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t}(Error),yn=function(A){function t(){if(A.call(this),0===arguments.length)A.call(this);else if(1===arguments.length){var t=arguments[0];A.call(this,t)}}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(dn),mn=function(){};mn.prototype.interfaces_=function(){return[]},mn.prototype.getClass=function(){return mn},mn.shouldNeverReachHere=function(){if(0===arguments.length)mn.shouldNeverReachHere(null);else if(1===arguments.length){var A=arguments[0];throw new yn("Should never reach here"+(null!==A?": "+A:""))}},mn.isTrue=function(){var A;if(1===arguments.length)mn.isTrue(arguments[0],null);else if(2===arguments.length&&(A=arguments[1],!arguments[0]))throw null===A?new yn:new yn(A)},mn.equals=function(){var A,t,n;if(2===arguments.length)mn.equals(A=arguments[0],t=arguments[1],null);else if(3===arguments.length&&(n=arguments[2],!(t=arguments[1]).equals(A=arguments[0])))throw new yn("Expected "+A+" but encountered "+t+(null!==n?": "+n:""))};var pn=function(){this.Ot=null,this.Ft=Array(2).fill().map((function(){return Array(2)})),this.Et=new Array(2).fill(null),this.Ut=null,this.Nt=null,this.jt=null,this.Qt=null,this.St=null,this.Et[0]=new _t,this.Et[1]=new _t,this.jt=this.Et[0],this.Qt=this.Et[1],this.Ot=0},Ln={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};pn.prototype.getIndexAlongSegment=function(A,t){return this.computeIntLineIndex(),this.Ut[A][t]},pn.prototype.getTopologySummary=function(){var A=new en;return this.isEndPoint()&&A.append(" endpoint"),this.Nt&&A.append(" proper"),this.isCollinear()&&A.append(" collinear"),A.toString()},pn.prototype.computeIntersection=function(A,t,n,i){this.Ft[0][0]=A,this.Ft[0][1]=t,this.Ft[1][0]=n,this.Ft[1][1]=i,this.Ot=this.computeIntersect(A,t,n,i)},pn.prototype.getIntersectionNum=function(){return this.Ot},pn.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this.Ut&&(this.Ut=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var A=arguments[0],t=this.getEdgeDistance(A,0),n=this.getEdgeDistance(A,1);t>n?(this.Ut[A][0]=0,this.Ut[A][1]=1):(this.Ut[A][0]=1,this.Ut[A][1]=0)}},pn.prototype.isProper=function(){return this.hasIntersection()&&this.Nt},pn.prototype.setPrecisionModel=function(A){this.St=A},pn.prototype.isInteriorIntersection=function(){var A=this;if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],n=0;n<this.Ot;n++)if(!A.Et[n].equals2D(A.Ft[t][0])&&!A.Et[n].equals2D(A.Ft[t][1]))return!0;return!1}},pn.prototype.getIntersection=function(A){return this.Et[A]},pn.prototype.isEndPoint=function(){return this.hasIntersection()&&!this.Nt},pn.prototype.hasIntersection=function(){return this.Ot!==pn.NO_INTERSECTION},pn.prototype.getEdgeDistance=function(A,t){return pn.computeEdgeDistance(this.Et[t],this.Ft[A][0],this.Ft[A][1])},pn.prototype.isCollinear=function(){return this.Ot===pn.COLLINEAR_INTERSECTION},pn.prototype.toString=function(){return xn.toLineString(this.Ft[0][0],this.Ft[0][1])+" - "+xn.toLineString(this.Ft[1][0],this.Ft[1][1])+this.getTopologySummary()},pn.prototype.getEndpoint=function(A,t){return this.Ft[A][t]},pn.prototype.isIntersection=function(A){for(var t=0;t<this.Ot;t++)if(this.Et[t].equals2D(A))return!0;return!1},pn.prototype.getIntersectionAlongSegment=function(A,t){return this.computeIntLineIndex(),this.Et[this.Ut[A][t]]},pn.prototype.interfaces_=function(){return[]},pn.prototype.getClass=function(){return pn},pn.computeEdgeDistance=function(A,t,n){var i=Math.abs(n.x-t.x),r=Math.abs(n.y-t.y),e=-1;if(A.equals(t))e=0;else if(A.equals(n))e=i>r?i:r;else{var s=Math.abs(A.x-t.x),u=Math.abs(A.y-t.y);0!==(e=i>r?s:u)||A.equals(t)||(e=Math.max(s,u))}return mn.isTrue(!(0===e&&!A.equals(t)),"Bad distance calculation"),e},pn.nonRobustComputeEdgeDistance=function(A,t,n){var i=A.x-t.x,r=A.y-t.y,e=Math.sqrt(i*i+r*r);return mn.isTrue(!(0===e&&!A.equals(t)),"Invalid distance calculation"),e},Ln.DONT_INTERSECT.get=function(){return 0},Ln.DO_INTERSECT.get=function(){return 1},Ln.COLLINEAR.get=function(){return 2},Ln.NO_INTERSECTION.get=function(){return 0},Ln.POINT_INTERSECTION.get=function(){return 1},Ln.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(pn,Ln);var Tn=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.isInSegmentEnvelopes=function(A){var t=new Cn(this.Ft[0][0],this.Ft[0][1]),n=new Cn(this.Ft[1][0],this.Ft[1][1]);return t.contains(A)&&n.contains(A)},t.prototype.computeIntersection=function(){if(3!==arguments.length)return A.prototype.computeIntersection.apply(this,arguments);var t=arguments[0],n=arguments[1],i=arguments[2];if(this.Nt=!1,Cn.intersects(n,i,t)&&0===En.orientationIndex(n,i,t)&&0===En.orientationIndex(i,n,t))return this.Nt=!0,(t.equals(n)||t.equals(i))&&(this.Nt=!1),this.Ot=A.POINT_INTERSECTION,null;this.Ot=A.NO_INTERSECTION},t.prototype.normalizeToMinimum=function(A,t,n,i,r){r.x=this.smallestInAbsValue(A.x,t.x,n.x,i.x),r.y=this.smallestInAbsValue(A.y,t.y,n.y,i.y),A.x-=r.x,A.y-=r.y,t.x-=r.x,t.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},t.prototype.safeHCoordinateIntersection=function(A,n,i,r){var e=null;try{e=gn.intersection(A,n,i,r)}catch(s){if(!(s instanceof wn))throw s;e=t.nearestEndpoint(A,n,i,r)}return e},t.prototype.intersection=function(A,n,i,r){var e=this.intersectionWithNormalization(A,n,i,r);return this.isInSegmentEnvelopes(e)||(e=new _t(t.nearestEndpoint(A,n,i,r))),null!==this.St&&this.St.makePrecise(e),e},t.prototype.smallestInAbsValue=function(A,t,n,i){var r=A,e=Math.abs(r);return Math.abs(t)<e&&(r=t,e=Math.abs(t)),Math.abs(n)<e&&(r=n,e=Math.abs(n)),Math.abs(i)<e&&(r=i),r},t.prototype.checkDD=function(A,t,n,i,r){var e=fn.intersection(A,t,n,i),s=this.isInSegmentEnvelopes(e);Pn.out.println("DD in env = "+s+"  --------------------- "+e),r.distance(e)>1e-4&&Pn.out.println("Distance = "+r.distance(e))},t.prototype.intersectionWithNormalization=function(A,t,n,i){var r=new _t(A),e=new _t(t),s=new _t(n),u=new _t(i),o=new _t;this.normalizeToEnvCentre(r,e,s,u,o);var h=this.safeHCoordinateIntersection(r,e,s,u);return h.x+=o.x,h.y+=o.y,h},t.prototype.computeCollinearIntersection=function(t,n,i,r){var e=Cn.intersects(t,n,i),s=Cn.intersects(t,n,r),u=Cn.intersects(i,r,t),o=Cn.intersects(i,r,n);return e&&s?(this.Et[0]=i,this.Et[1]=r,A.COLLINEAR_INTERSECTION):u&&o?(this.Et[0]=t,this.Et[1]=n,A.COLLINEAR_INTERSECTION):e&&u?(this.Et[0]=i,this.Et[1]=t,!i.equals(t)||s||o?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):e&&o?(this.Et[0]=i,this.Et[1]=n,!i.equals(n)||s||u?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):s&&u?(this.Et[0]=r,this.Et[1]=t,!r.equals(t)||e||o?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):s&&o?(this.Et[0]=r,this.Et[1]=n,!r.equals(n)||e||u?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):A.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(A,t,n,i,r){var e=A.x<t.x?A.x:t.x,s=A.y<t.y?A.y:t.y,u=A.x>t.x?A.x:t.x,o=A.y>t.y?A.y:t.y,h=n.x<i.x?n.x:i.x,f=n.y<i.y?n.y:i.y,c=n.x>i.x?n.x:i.x,a=n.y>i.y?n.y:i.y,l=((s>f?s:f)+(o<a?o:a))/2;r.x=((e>h?e:h)+(u<c?u:c))/2,r.y=l,A.x-=r.x,A.y-=r.y,t.x-=r.x,t.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},t.prototype.computeIntersect=function(t,n,i,r){if(this.Nt=!1,!Cn.intersects(t,n,i,r))return A.NO_INTERSECTION;var e=En.orientationIndex(t,n,i),s=En.orientationIndex(t,n,r);if(e>0&&s>0||e<0&&s<0)return A.NO_INTERSECTION;var u=En.orientationIndex(i,r,t),o=En.orientationIndex(i,r,n);return u>0&&o>0||u<0&&o<0?A.NO_INTERSECTION:0===e&&0===s&&0===u&&0===o?this.computeCollinearIntersection(t,n,i,r):(0===e||0===s||0===u||0===o?(this.Nt=!1,t.equals2D(i)||t.equals2D(r)?this.Et[0]=t:n.equals2D(i)||n.equals2D(r)?this.Et[0]=n:0===e?this.Et[0]=new _t(i):0===s?this.Et[0]=new _t(r):0===u?this.Et[0]=new _t(t):0===o&&(this.Et[0]=new _t(n))):(this.Nt=!0,this.Et[0]=this.intersection(t,n,i,r)),A.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(A,t,n,i){var r=A,e=En.distancePointLine(A,n,i),s=En.distancePointLine(t,n,i);return s<e&&(e=s,r=t),(s=En.distancePointLine(n,A,t))<e&&(e=s,r=n),(s=En.distancePointLine(i,A,t))<e&&(e=s,r=i),r},t}(pn),On=function(){};On.prototype.interfaces_=function(){return[]},On.prototype.getClass=function(){return On},On.orientationIndex=function(A,t,n){return On.signOfDet2x2(t.x-A.x,t.y-A.y,n.x-t.x,n.y-t.y)},On.signOfDet2x2=function(A,t,n,i){var r=null,e=null,s=null;if(r=1,0===A||0===i)return 0===t||0===n?0:t>0?n>0?-r:r:n>0?r:-r;if(0===t||0===n)return i>0?A>0?r:-r:A>0?-r:r;if(t>0?i>0?t<=i||(r=-r,e=A,A=n,n=e,e=t,t=i,i=e):t<=-i?(r=-r,n=-n,i=-i):(e=A,A=-n,n=e,e=t,t=-i,i=e):i>0?-t<=i?(r=-r,A=-A,t=-t):(e=-A,A=n,n=e,e=-t,t=i,i=e):t>=i?(A=-A,t=-t,n=-n,i=-i):(r=-r,e=-A,A=-n,n=e,e=-t,t=-i,i=e),A>0){if(!(n>0))return r;if(!(A<=n))return r}else{if(n>0)return-r;if(!(A>=n))return-r;r=-r,A=-A,n=-n}for(;;){if((i-=(s=Math.floor(n/A))*t)<0)return-r;if(i>t)return r;if(A>(n-=s*A)+n){if(t<i+i)return r}else{if(t>i+i)return-r;n=A-n,i=t-i,r=-r}if(0===i)return 0===n?0:-r;if(0===n)return r;if((t-=(s=Math.floor(A/n))*i)<0)return r;if(t>i)return-r;if(n>(A-=s*n)+A){if(i<t+t)return-r}else{if(i>t+t)return r;A=n-A,t=i-t,r=-r}if(0===t)return 0===A?0:r;if(0===A)return-r}};var Fn=function(){this.Bt=null,this.Rt=0,this.kt=!1;var A=arguments[0];this.Bt=A};Fn.prototype.countSegment=function(A,t){if(A.x<this.Bt.x&&t.x<this.Bt.x)return null;if(this.Bt.x===t.x&&this.Bt.y===t.y)return this.kt=!0,null;if(A.y===this.Bt.y&&t.y===this.Bt.y){var n=A.x,i=t.x;return n>i&&(n=t.x,i=A.x),this.Bt.x>=n&&this.Bt.x<=i&&(this.kt=!0),null}if(A.y>this.Bt.y&&t.y<=this.Bt.y||t.y>this.Bt.y&&A.y<=this.Bt.y){var e=A.y-this.Bt.y,u=t.y-this.Bt.y,o=On.signOfDet2x2(A.x-this.Bt.x,e,t.x-this.Bt.x,u);if(0===o)return this.kt=!0,null;u<e&&(o=-o),o>0&&this.Rt++}},Fn.prototype.isPointInPolygon=function(){return this.getLocation()!==$t.EXTERIOR},Fn.prototype.getLocation=function(){return this.kt?$t.BOUNDARY:this.Rt%2==1?$t.INTERIOR:$t.EXTERIOR},Fn.prototype.isOnSegment=function(){return this.kt},Fn.prototype.interfaces_=function(){return[]},Fn.prototype.getClass=function(){return Fn},Fn.locatePointInRing=function(){if(arguments[0]instanceof _t&&tn(arguments[1],an)){for(var A=arguments[0],t=arguments[1],n=new Fn(A),i=new _t,r=new _t,e=1;e<t.size();e++)if(t.getCoordinate(e,i),t.getCoordinate(e-1,r),n.countSegment(i,r),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof _t&&arguments[1]instanceof Array){for(var s=arguments[0],u=arguments[1],o=new Fn(s),h=1;h<u.length;h++){var f=u[h],c=u[h-1];if(o.countSegment(f,c),o.isOnSegment())return o.getLocation()}return o.getLocation()}};var En=function(){},Un={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};En.prototype.interfaces_=function(){return[]},En.prototype.getClass=function(){return En},En.orientationIndex=function(A,t,n){return fn.orientationIndex(A,t,n)},En.signedArea=function(){if(arguments[0]instanceof Array){var A=arguments[0];if(A.length<3)return 0;for(var t=0,n=A[0].x,i=1;i<A.length-1;i++){var r=A[i].x-n,e=A[i+1].y,s=A[i-1].y;t+=r*(s-e)}return t/2}if(tn(arguments[0],an)){var u=arguments[0],o=u.size();if(o<3)return 0;var h=new _t,f=new _t,c=new _t;u.getCoordinate(0,f),u.getCoordinate(1,c);var a=f.x;c.x-=a;for(var v=0,l=1;l<o-1;l++)h.y=f.y,f.x=c.x,f.y=c.y,u.getCoordinate(l+1,c),c.x-=a,v+=f.x*(h.y-c.y);return v/2}},En.distanceLineLine=function(A,t,n,i){if(A.equals(t))return En.distancePointLine(A,n,i);if(n.equals(i))return En.distancePointLine(i,A,t);var r=!1;if(Cn.intersects(A,t,n,i)){var e=(t.x-A.x)*(i.y-n.y)-(t.y-A.y)*(i.x-n.x);if(0===e)r=!0;else{var u=((A.y-n.y)*(t.x-A.x)-(A.x-n.x)*(t.y-A.y))/e,o=((A.y-n.y)*(i.x-n.x)-(A.x-n.x)*(i.y-n.y))/e;(o<0||o>1||u<0||u>1)&&(r=!0)}}else r=!0;return r?nn.min(En.distancePointLine(A,n,i),En.distancePointLine(t,n,i),En.distancePointLine(n,A,t),En.distancePointLine(i,A,t)):0},En.isPointInRing=function(A,t){return En.locatePointInRing(A,t)!==$t.EXTERIOR},En.computeLength=function(A){var t=A.size();if(t<=1)return 0;var n=0,i=new _t;A.getCoordinate(0,i);for(var r=i.x,e=i.y,s=1;s<t;s++){A.getCoordinate(s,i);var u=i.x,o=i.y,h=u-r,f=o-e;n+=Math.sqrt(h*h+f*f),r=u,e=o}return n},En.isCCW=function(A){var t=A.length-1;if(t<3)throw new Gt("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=A[0],i=0,r=1;r<=t;r++){var e=A[r];e.y>n.y&&(n=e,i=r)}var s=i;do{(s-=1)<0&&(s=t)}while(A[s].equals2D(n)&&s!==i);var u=i;do{u=(u+1)%t}while(A[u].equals2D(n)&&u!==i);var o=A[s],h=A[u];if(o.equals2D(n)||h.equals2D(n)||o.equals2D(h))return!1;var f=En.computeOrientation(o,n,h);return 0===f?o.x>h.x:f>0},En.locatePointInRing=function(A,t){return Fn.locatePointInRing(A,t)},En.distancePointLinePerpendicular=function(A,t,n){var i=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y);return Math.abs(((t.y-A.y)*(n.x-t.x)-(t.x-A.x)*(n.y-t.y))/i)*Math.sqrt(i)},En.computeOrientation=function(A,t,n){return En.orientationIndex(A,t,n)},En.distancePointLine=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];if(0===t.length)throw new Gt("Line array must contain at least one vertex");for(var n=A.distance(t[0]),i=0;i<t.length-1;i++){var r=En.distancePointLine(A,t[i],t[i+1]);r<n&&(n=r)}return n}if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2];if(s.x===u.x&&s.y===u.y)return e.distance(s);var o=(u.x-s.x)*(u.x-s.x)+(u.y-s.y)*(u.y-s.y),h=((e.x-s.x)*(u.x-s.x)+(e.y-s.y)*(u.y-s.y))/o;if(h<=0)return e.distance(s);if(h>=1)return e.distance(u);var f=((s.y-e.y)*(u.x-s.x)-(s.x-e.x)*(u.y-s.y))/o;return Math.abs(f)*Math.sqrt(o)}},En.isOnLine=function(A,t){for(var n=new Tn,i=1;i<t.length;i++){if(n.computeIntersection(A,t[i-1],t[i]),n.hasIntersection())return!0}return!1},Un.CLOCKWISE.get=function(){return-1},Un.RIGHT.get=function(){return En.CLOCKWISE},Un.COUNTERCLOCKWISE.get=function(){return 1},Un.LEFT.get=function(){return En.COUNTERCLOCKWISE},Un.COLLINEAR.get=function(){return 0},Un.STRAIGHT.get=function(){return En.COLLINEAR},Object.defineProperties(En,Un);var Nn=function(){};Nn.prototype.filter=function(A){},Nn.prototype.interfaces_=function(){return[]},Nn.prototype.getClass=function(){return Nn};var jn=function(){var A=arguments[0];this.Gt=null,this.Yt=null,this.qt=null,this.Wt=null,this.Yt=A,this.qt=A.getSRID()},Qn={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};jn.prototype.isGeometryCollection=function(){return this.getSortIndex()===jn.SORTINDEX_GEOMETRYCOLLECTION},jn.prototype.getFactory=function(){return this.Yt},jn.prototype.getGeometryN=function(A){return this},jn.prototype.getArea=function(){return 0},jn.prototype.isRectangle=function(){return!1},jn.prototype.equals=function(){if(arguments[0]instanceof jn){var A=arguments[0];return null!==A&&this.equalsTopo(A)}if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof jn))return!1;var n=t;return this.equalsExact(n)}},jn.prototype.equalsExact=function(A){return this===A||this.equalsExact(A,0)},jn.prototype.geometryChanged=function(){this.apply(jn.geometryChangedFilter)},jn.prototype.geometryChangedAction=function(){this.Gt=null},jn.prototype.equalsNorm=function(A){return null!==A&&this.norm().equalsExact(A.norm())},jn.prototype.getLength=function(){return 0},jn.prototype.getNumGeometries=function(){return 1},jn.prototype.compareTo=function(){if(1===arguments.length){var A=arguments[0],t=A;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(A)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,i)}},jn.prototype.getUserData=function(){return this.Wt},jn.prototype.getSRID=function(){return this.qt},jn.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},jn.prototype.checkNotGeometryCollection=function(A){if(A.getSortIndex()===jn.SORTINDEX_GEOMETRYCOLLECTION)throw new Gt("This method does not support GeometryCollection arguments")},jn.prototype.equal=function(A,t,n){return 0===n?A.equals(t):A.distance(t)<=n},jn.prototype.norm=function(){var A=this.copy();return A.normalize(),A},jn.prototype.getPrecisionModel=function(){return this.Yt.getPrecisionModel()},jn.prototype.getEnvelopeInternal=function(){return null===this.Gt&&(this.Gt=this.computeEnvelopeInternal()),new Cn(this.Gt)},jn.prototype.setSRID=function(A){this.qt=A},jn.prototype.setUserData=function(A){this.Wt=A},jn.prototype.compare=function(A,t){for(var n=A.iterator(),i=t.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),e=i.next(),s=r.compareTo(e);if(0!==s)return s}return n.hasNext()?1:i.hasNext()?-1:0},jn.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},jn.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===jn.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===jn.SORTINDEX_MULTIPOINT||this.getSortIndex()===jn.SORTINDEX_MULTILINESTRING||this.getSortIndex()===jn.SORTINDEX_MULTIPOLYGON},jn.prototype.interfaces_=function(){return[Vt,Wt,Ht]},jn.prototype.getClass=function(){return jn},jn.hasNonEmptyElements=function(A){for(var t=0;t<A.length;t++)if(!A[t].isEmpty())return!0;return!1},jn.hasNullElements=function(A){for(var t=0;t<A.length;t++)if(null===A[t])return!0;return!1},Qn.serialVersionUID.get=function(){return 0x799ea46522854c00},Qn.SORTINDEX_POINT.get=function(){return 0},Qn.SORTINDEX_MULTIPOINT.get=function(){return 1},Qn.SORTINDEX_LINESTRING.get=function(){return 2},Qn.SORTINDEX_LINEARRING.get=function(){return 3},Qn.SORTINDEX_MULTILINESTRING.get=function(){return 4},Qn.SORTINDEX_POLYGON.get=function(){return 5},Qn.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Qn.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Qn.geometryChangedFilter.get=function(){return Sn},Object.defineProperties(jn,Qn);var Sn=function(){};Sn.interfaces_=function(){return[Nn]},Sn.filter=function(A){A.geometryChangedAction()};var Bn=function(){};Bn.prototype.filter=function(A){},Bn.prototype.interfaces_=function(){return[]},Bn.prototype.getClass=function(){return Bn};var Rn=function(){},kn={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Rn.prototype.isInBoundary=function(A){},Rn.prototype.interfaces_=function(){return[]},Rn.prototype.getClass=function(){return Rn},kn.Mod2BoundaryNodeRule.get=function(){return Gn},kn.EndPointBoundaryNodeRule.get=function(){return Yn},kn.MultiValentEndPointBoundaryNodeRule.get=function(){return qn},kn.MonoValentEndPointBoundaryNodeRule.get=function(){return Wn},kn.MOD2_BOUNDARY_RULE.get=function(){return new Gn},kn.ENDPOINT_BOUNDARY_RULE.get=function(){return new Yn},kn.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new qn},kn.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Wn},kn.OGC_SFS_BOUNDARY_RULE.get=function(){return Rn.MOD2_BOUNDARY_RULE},Object.defineProperties(Rn,kn);var Gn=function(){};Gn.prototype.isInBoundary=function(A){return A%2==1},Gn.prototype.interfaces_=function(){return[Rn]},Gn.prototype.getClass=function(){return Gn};var Yn=function(){};Yn.prototype.isInBoundary=function(A){return A>0},Yn.prototype.interfaces_=function(){return[Rn]},Yn.prototype.getClass=function(){return Yn};var qn=function(){};qn.prototype.isInBoundary=function(A){return A>1},qn.prototype.interfaces_=function(){return[Rn]},qn.prototype.getClass=function(){return qn};var Wn=function(){};Wn.prototype.isInBoundary=function(A){return 1===A},Wn.prototype.interfaces_=function(){return[Rn]},Wn.prototype.getClass=function(){return Wn};var Vn=function(){};function Kn(A){this.message=A||""}Vn.prototype.add=function(){},Vn.prototype.addAll=function(){},Vn.prototype.isEmpty=function(){},Vn.prototype.iterator=function(){},Vn.prototype.size=function(){},Vn.prototype.toArray=function(){},Vn.prototype.remove=function(){},(Kn.prototype=new Error).name="IndexOutOfBoundsException";var Hn=function(){};Hn.prototype.hasNext=function(){},Hn.prototype.next=function(){},Hn.prototype.remove=function(){};var _n=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(Vn);function Jn(A){this.message=A||""}(Jn.prototype=new Error).name="NoSuchElementException";var Zn=function(A){function t(){A.call(this),this.array_=[],arguments[0]instanceof Vn&&this.addAll(arguments[0])}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[A,Vn]},t.prototype.add=function(A){return 1===arguments.length?this.array_.push(A):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.set=function(A,t){var n=this.array_[A];return this.array_[A]=t,n},t.prototype.iterator=function(){return new Xn(this)},t.prototype.get=function(A){if(A<0||A>=this.size())throw new Kn;return this.array_[A]},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A},t.prototype.remove=function(A){for(var t=!1,n=0,i=this.array_.length;n<i;n++)if(this.array_[n]===A){this.array_.splice(n,1),t=!0;break}return t},t}(_n),Xn=function(A){function t(t){A.call(this),this.arrayList_=t,this.position_=0}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Jn;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(A){return this.arrayList_.set(this.position_-1,A)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(Hn),$n=function(A){function t(){if(A.call(this),0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.ensureCapacity(n.length),this.add(n,i)}}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(A){return this.get(A)},t.prototype.addAll=function(){var t=this;if(2===arguments.length){for(var n=arguments[0],i=arguments[1],r=!1,e=n.iterator();e.hasNext();)t.add(e.next(),i),r=!0;return r}return A.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var t=A.prototype.clone.call(this),n=0;n<this.size();n++)t.add(n,this.get(n).copy());return t},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var t=this;if(1===arguments.length){var n=arguments[0];A.prototype.add.call(this,n)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var i=arguments[0],r=arguments[1];return this.add(i,r,!0),!0}if(arguments[0]instanceof _t&&"boolean"==typeof arguments[1]){var e=arguments[0],s=arguments[1];if(!s&&this.size()>=1){var u=this.get(this.size()-1);if(u.equals2D(e))return null}A.prototype.add.call(this,e)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],h=arguments[1];return this.add(o,h),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var f=arguments[0],c=arguments[1],a=arguments[2];if(a)for(var v=0;v<f.length;v++)t.add(f[v],c);else for(var l=f.length-1;l>=0;l--)t.add(f[l],c);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof _t){var w=arguments[0],P=arguments[1],g=arguments[2];if(!g){var C=this.size();if(C>0){if(w>0){var D=this.get(w-1);if(D.equals2D(P))return null}if(w<C){var I=this.get(w);if(I.equals2D(P))return null}}}A.prototype.add.call(this,w,P)}}else if(4===arguments.length){var M=arguments[0],b=arguments[1],z=arguments[2],x=arguments[3],d=1;z>x&&(d=-1);for(var y=z;y!==x;y+=d)t.add(M[y],b);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new _t(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,n),t}(Zn),Ai=function(){},ti={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};ti.ForwardComparator.get=function(){return ni},ti.BidirectionalComparator.get=function(){return ii},ti.coordArrayType.get=function(){return new Array(0).fill(null)},Ai.prototype.interfaces_=function(){return[]},Ai.prototype.getClass=function(){return Ai},Ai.isRing=function(A){return!(A.length<4||!A[0].equals2D(A[A.length-1]))},Ai.ptNotInList=function(A,t){for(var n=0;n<A.length;n++){var i=A[n];if(Ai.indexOf(i,t)<0)return i}return null},Ai.scroll=function(A,t){var n=Ai.indexOf(t,A);if(n<0)return null;var i=new Array(A.length).fill(null);Pn.arraycopy(A,n,i,0,A.length-n),Pn.arraycopy(A,0,i,A.length-n,n),Pn.arraycopy(i,0,A,0,A.length)},Ai.equals=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];if(A===t)return!0;if(null===A||null===t)return!1;if(A.length!==t.length)return!1;for(var n=0;n<A.length;n++)if(!A[n].equals(t[n]))return!1;return!0}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];if(i===r)return!0;if(null===i||null===r)return!1;if(i.length!==r.length)return!1;for(var s=0;s<i.length;s++)if(0!==e.compare(i[s],r[s]))return!1;return!0}},Ai.intersection=function(A,t){for(var n=new $n,i=0;i<A.length;i++)t.intersects(A[i])&&n.add(A[i],!0);return n.toCoordinateArray()},Ai.hasRepeatedPoints=function(A){for(var t=1;t<A.length;t++)if(A[t-1].equals(A[t]))return!0;return!1},Ai.removeRepeatedPoints=function(A){return Ai.hasRepeatedPoints(A)?new $n(A,!1).toCoordinateArray():A},Ai.reverse=function(A){for(var t=A.length-1,n=Math.trunc(t/2),i=0;i<=n;i++){var r=A[i];A[i]=A[t-i],A[t-i]=r}},Ai.removeNull=function(A){for(var t=0,n=0;n<A.length;n++)null!==A[n]&&t++;var i=new Array(t).fill(null);if(0===t)return i;for(var r=0,e=0;e<A.length;e++)null!==A[e]&&(i[r++]=A[e]);return i},Ai.copyDeep=function(){if(1===arguments.length){for(var A=arguments[0],t=new Array(A.length).fill(null),n=0;n<A.length;n++)t[n]=new _t(A[n]);return t}if(5===arguments.length)for(var i=arguments[0],r=arguments[1],e=arguments[2],s=arguments[3],u=arguments[4],o=0;o<u;o++)e[s+o]=new _t(i[r+o])},Ai.isEqualReversed=function(A,t){for(var n=0;n<A.length;n++){if(0!==A[n].compareTo(t[A.length-n-1]))return!1}return!0},Ai.envelope=function(A){for(var t=new Cn,n=0;n<A.length;n++)t.expandToInclude(A[n]);return t},Ai.toCoordinateArray=function(A){return A.toArray(Ai.coordArrayType)},Ai.atLeastNCoordinatesOrNothing=function(A,t){return t.length>=A?t:[]},Ai.indexOf=function(A,t){for(var n=0;n<t.length;n++)if(A.equals(t[n]))return n;return-1},Ai.increasingDirection=function(A){for(var t=0;t<Math.trunc(A.length/2);t++){var i=A[t].compareTo(A[A.length-1-t]);if(0!==i)return i}return 1},Ai.compare=function(A,t){for(var n=0;n<A.length&&n<t.length;){var i=A[n].compareTo(t[n]);if(0!==i)return i;n++}return n<t.length?-1:n<A.length?1:0},Ai.minCoordinate=function(A){for(var t=null,n=0;n<A.length;n++)(null===t||t.compareTo(A[n])>0)&&(t=A[n]);return t},Ai.extract=function(A,t,n){t=nn.clamp(t,0,A.length);var i=(n=nn.clamp(n,-1,A.length))-t+1;n<0&&(i=0),t>=A.length&&(i=0),n<t&&(i=0);var r=new Array(i).fill(null);if(0===i)return r;for(var e=0,s=t;s<=n;s++)r[e++]=A[s];return r},Object.defineProperties(Ai,ti);var ni=function(){};ni.prototype.compare=function(A,t){return Ai.compare(A,t)},ni.prototype.interfaces_=function(){return[Kt]},ni.prototype.getClass=function(){return ni};var ii=function(){};ii.prototype.compare=function(A,t){var n=A,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;var r=Ai.compare(n,i);return Ai.isEqualReversed(n,i)?0:r},ii.prototype.OLDcompare=function(A,t){var n=A,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;for(var r=Ai.increasingDirection(n),e=Ai.increasingDirection(i),s=r>0?0:n.length-1,u=e>0?0:n.length-1,o=0;o<n.length;o++){var h=n[s].compareTo(i[u]);if(0!==h)return h;s+=r,u+=e}return 0},ii.prototype.interfaces_=function(){return[Kt]},ii.prototype.getClass=function(){return ii};var ri=function(){};ri.prototype.get=function(){},ri.prototype.put=function(){},ri.prototype.size=function(){},ri.prototype.values=function(){},ri.prototype.entrySet=function(){};var ei=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t}(ri);function si(A){this.message=A||""}function ui(){}(si.prototype=new Error).name="OperationNotSupported",(ui.prototype=new Vn).contains=function(){};var oi=function(A){function t(){A.call(this),this.array_=[],arguments[0]instanceof Vn&&this.addAll(arguments[0])}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.contains=function(A){for(var t=0,n=this.array_.length;t<n;t++)if(this.array_[t]===A)return!0;return!1},t.prototype.add=function(A){return!this.contains(A)&&(this.array_.push(A),!0)},t.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.remove=function(A){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A},t.prototype.iterator=function(){return new hi(this)},t}(ui),hi=function(A){function t(t){A.call(this),this.hashSet_=t,this.position_=0}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Jn;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new si},t}(Hn);function fi(A){return null===A?0:A.color}function ci(A){return null===A?null:A.parent}function ai(A,t){null!==A&&(A.color=t)}function vi(A){return null===A?null:A.left}function li(A){return null===A?null:A.right}function wi(){this.root_=null,this.size_=0}(wi.prototype=new ei).get=function(A){for(var t=this.root_;null!==t;){var n=A.compareTo(t.key);if(n<0)t=t.left;else{if(!(n>0))return t.value;t=t.right}}return null},wi.prototype.put=function(A,t){if(null===this.root_)return this.root_={key:A,value:t,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,i,r=this.root_;do{if(n=r,(i=A.compareTo(r.key))<0)r=r.left;else{if(!(i>0)){var e=r.value;return r.value=t,e}r=r.right}}while(null!==r);var s={key:A,left:null,right:null,value:t,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=s:n.right=s,this.fixAfterInsertion(s),this.size_++,null},wi.prototype.fixAfterInsertion=function(A){for(A.color=1;null!=A&&A!==this.root_&&1===A.parent.color;)if(ci(A)===vi(ci(ci(A)))){var t=li(ci(ci(A)));1===fi(t)?(ai(ci(A),0),ai(t,0),ai(ci(ci(A)),1),A=ci(ci(A))):(A===li(ci(A))&&(A=ci(A),this.rotateLeft(A)),ai(ci(A),0),ai(ci(ci(A)),1),this.rotateRight(ci(ci(A))))}else{var n=vi(ci(ci(A)));1===fi(n)?(ai(ci(A),0),ai(n,0),ai(ci(ci(A)),1),A=ci(ci(A))):(A===vi(ci(A))&&(A=ci(A),this.rotateRight(A)),ai(ci(A),0),ai(ci(ci(A)),1),this.rotateLeft(ci(ci(A))))}this.root_.color=0},wi.prototype.values=function(){var A=new Zn,t=this.getFirstEntry();if(null!==t)for(A.add(t.value);null!==(t=wi.successor(t));)A.add(t.value);return A},wi.prototype.entrySet=function(){var A=new oi,t=this.getFirstEntry();if(null!==t)for(A.add(t);null!==(t=wi.successor(t));)A.add(t);return A},wi.prototype.rotateLeft=function(A){if(null!=A){var t=A.right;A.right=t.left,null!=t.left&&(t.left.parent=A),t.parent=A.parent,null===A.parent?this.root_=t:A.parent.left===A?A.parent.left=t:A.parent.right=t,t.left=A,A.parent=t}},wi.prototype.rotateRight=function(A){if(null!=A){var t=A.left;A.left=t.right,null!=t.right&&(t.right.parent=A),t.parent=A.parent,null===A.parent?this.root_=t:A.parent.right===A?A.parent.right=t:A.parent.left=t,t.right=A,A.parent=t}},wi.prototype.getFirstEntry=function(){var A=this.root_;if(null!=A)for(;null!=A.left;)A=A.left;return A},wi.successor=function(A){if(null===A)return null;if(null!==A.right){for(var t=A.right;null!==t.left;)t=t.left;return t}for(var n=A.parent,i=A;null!==n&&i===n.right;)i=n,n=n.parent;return n},wi.prototype.size=function(){return this.size_};var Pi=function(){};function gi(){}function Ci(){this.array_=[],arguments[0]instanceof Vn&&this.addAll(arguments[0])}Pi.prototype.interfaces_=function(){return[]},Pi.prototype.getClass=function(){return Pi},gi.prototype=new ui,(Ci.prototype=new gi).contains=function(A){for(var t=0,n=this.array_.length;t<n;t++)if(0===this.array_[t].compareTo(A))return!0;return!1},Ci.prototype.add=function(A){if(this.contains(A))return!1;for(var t=0,n=this.array_.length;t<n;t++)if(1===this.array_[t].compareTo(A))return this.array_.splice(t,0,A),!0;return this.array_.push(A),!0},Ci.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next());return!0},Ci.prototype.remove=function(A){throw new si},Ci.prototype.size=function(){return this.array_.length},Ci.prototype.isEmpty=function(){return 0===this.array_.length},Ci.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A},Ci.prototype.iterator=function(){return new Di(this)};var Di=function(A){this.treeSet_=A,this.position_=0};Di.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Jn;return this.treeSet_.array_[this.position_++]},Di.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Di.prototype.remove=function(){throw new si};var Ii=function(){};Ii.sort=function(){var A,t,n,i,r=arguments[0];if(1===arguments.length)i=function(A,t){return A.compareTo(t)},r.sort(i);else if(2===arguments.length)n=arguments[1],i=function(A,t){return n.compare(A,t)},r.sort(i);else if(3===arguments.length){(t=r.slice(arguments[1],arguments[2])).sort();var e=r.slice(0,arguments[1]).concat(t,r.slice(arguments[2],r.length));for(r.splice(0,r.length),A=0;A<e.length;A++)r.push(e[A])}else if(4===arguments.length)for(t=r.slice(arguments[1],arguments[2]),n=arguments[3],i=function(A,t){return n.compare(A,t)},t.sort(i),e=r.slice(0,arguments[1]).concat(t,r.slice(arguments[2],r.length)),r.splice(0,r.length),A=0;A<e.length;A++)r.push(e[A])},Ii.asList=function(A){for(var t=new Zn,n=0,i=A.length;n<i;n++)t.add(A[n]);return t};var Mi=function(){},bi={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};bi.P.get=function(){return 0},bi.L.get=function(){return 1},bi.A.get=function(){return 2},bi.FALSE.get=function(){return-1},bi.TRUE.get=function(){return-2},bi.DONTCARE.get=function(){return-3},bi.SYM_FALSE.get=function(){return"F"},bi.SYM_TRUE.get=function(){return"T"},bi.SYM_DONTCARE.get=function(){return"*"},bi.SYM_P.get=function(){return"0"},bi.SYM_L.get=function(){return"1"},bi.SYM_A.get=function(){return"2"},Mi.prototype.interfaces_=function(){return[]},Mi.prototype.getClass=function(){return Mi},Mi.toDimensionSymbol=function(A){switch(A){case Mi.FALSE:return Mi.SYM_FALSE;case Mi.TRUE:return Mi.SYM_TRUE;case Mi.DONTCARE:return Mi.SYM_DONTCARE;case Mi.P:return Mi.SYM_P;case Mi.L:return Mi.SYM_L;case Mi.A:return Mi.SYM_A}throw new Gt("Unknown dimension value: "+A)},Mi.toDimensionValue=function(A){switch(un.toUpperCase(A)){case Mi.SYM_FALSE:return Mi.FALSE;case Mi.SYM_TRUE:return Mi.TRUE;case Mi.SYM_DONTCARE:return Mi.DONTCARE;case Mi.SYM_P:return Mi.P;case Mi.SYM_L:return Mi.L;case Mi.SYM_A:return Mi.A}throw new Gt("Unknown dimension symbol: "+A)},Object.defineProperties(Mi,bi);var zi=function(){};zi.prototype.filter=function(A){},zi.prototype.interfaces_=function(){return[]},zi.prototype.getClass=function(){return zi};var xi=function(){};xi.prototype.filter=function(A,t){},xi.prototype.isDone=function(){},xi.prototype.isGeometryChanged=function(){},xi.prototype.interfaces_=function(){return[]},xi.prototype.getClass=function(){return xi};var di=function(A){function t(t,n){if(A.call(this,n),this.dt=t||[],A.hasNullElements(this.dt))throw new Gt("geometries must not contain null elements")}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var A=new Cn,t=0;t<this.dt.length;t++)A.expandToInclude(this.dt[t].getEnvelopeInternal());return A},t.prototype.getGeometryN=function(A){return this.dt[A]},t.prototype.getSortIndex=function(){return A.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var A=new Array(this.getNumPoints()).fill(null),t=-1,n=0;n<this.dt.length;n++)for(var i=this.dt[n].getCoordinates(),r=0;r<i.length;r++)A[++t]=i[r];return A},t.prototype.getArea=function(){for(var A=0,t=0;t<this.dt.length;t++)A+=this.dt[t].getArea();return A},t.prototype.equalsExact=function(){var t=this;if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var r=n;if(this.dt.length!==r.dt.length)return!1;for(var e=0;e<this.dt.length;e++)if(!t.dt[e].equalsExact(r.dt[e],i))return!1;return!0}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var A=0;A<this.dt.length;A++)this.dt[A].normalize();Ii.sort(this.dt)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this.dt[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var A=Mi.FALSE,t=0;t<this.dt.length;t++)A=Math.max(A,this.dt[t].getBoundaryDimension());return A},t.prototype.getDimension=function(){for(var A=Mi.FALSE,t=0;t<this.dt.length;t++)A=Math.max(A,this.dt[t].getDimension());return A},t.prototype.getLength=function(){for(var A=0,t=0;t<this.dt.length;t++)A+=this.dt[t].getLength();return A},t.prototype.getNumPoints=function(){for(var A=0,t=0;t<this.dt.length;t++)A+=this.dt[t].getNumPoints();return A},t.prototype.getNumGeometries=function(){return this.dt.length},t.prototype.reverse=function(){for(var t=new Array(this.dt.length).fill(null),n=0;n<this.dt.length;n++)t[n]=this.dt[n].reverse();return this.getFactory().createGeometryCollection(t)},t.prototype.compareToSameClass=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=new Ci(Ii.asList(this.dt)),i=new Ci(Ii.asList(t.dt));return this.compare(n,i)}if(2===arguments.length){for(var r=arguments[0],e=arguments[1],s=r,u=this.getNumGeometries(),o=s.getNumGeometries(),h=0;h<u&&h<o;){var f=A.getGeometryN(h),c=s.getGeometryN(h),a=f.compareToSameClass(c,e);if(0!==a)return a;h++}return h<u?1:h<o?-1:0}},t.prototype.apply=function(){var A=this;if(tn(arguments[0],Bn))for(var t=arguments[0],n=0;n<this.dt.length;n++)A.dt[n].apply(t);else if(tn(arguments[0],xi)){var i=arguments[0];if(0===this.dt.length)return null;for(var r=0;r<this.dt.length&&(A.dt[r].apply(i),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(tn(arguments[0],zi)){var e=arguments[0];e.filter(this);for(var s=0;s<this.dt.length;s++)A.dt[s].apply(e)}else if(tn(arguments[0],Nn)){var u=arguments[0];u.filter(this);for(var o=0;o<this.dt.length;o++)A.dt[o].apply(u)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),mn.shouldNeverReachHere(),null},t.prototype.clone=function(){var t=A.prototype.clone.call(this);t.dt=new Array(this.dt.length).fill(null);for(var n=0;n<this.dt.length;n++)t.dt[n]=this.dt[n].clone();return t},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var A=new Array(this.dt.length).fill(null),n=0;n<A.length;n++)A[n]=this.dt[n].copy();return new t(A,this.Yt)},t.prototype.isEmpty=function(){for(var A=0;A<this.dt.length;A++)if(!this.dt[A].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(t,n),t}(jn),yi=function(A){function t(){A.apply(this,arguments)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return jn.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&A.prototype.equalsExact.call(this,t,n)}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?Mi.FALSE:0},t.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var A=0;A<this.dt.length;A++)if(!this.dt[A].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var A=this.dt.length,t=new Array(A).fill(null),n=0;n<this.dt.length;n++)t[A-1-n]=this.dt[n].reverse();return this.getFactory().createMultiLineString(t)},t.prototype.getBoundary=function(){return new mi(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var A=new Array(this.dt.length).fill(null),n=0;n<A.length;n++)A[n]=this.dt[n].copy();return new t(A,this.Yt)},t.prototype.interfaces_=function(){return[Pi]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(t,n),t}(di),mi=function(){if(this.Vt=null,this.Kt=null,this.Ht=null,this._t=null,1===arguments.length){var A=arguments[0],t=Rn.MOD2_BOUNDARY_RULE;this.Vt=A,this.Kt=A.getFactory(),this.Ht=t}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.Vt=n,this.Kt=n.getFactory(),this.Ht=i}};mi.prototype.boundaryMultiLineString=function(A){if(this.Vt.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(A);return 1===t.length?this.Kt.createPoint(t[0]):this.Kt.createMultiPointFromCoords(t)},mi.prototype.getBoundary=function(){return this.Vt instanceof Si?this.boundaryLineString(this.Vt):this.Vt instanceof yi?this.boundaryMultiLineString(this.Vt):this.Vt.getBoundary()},mi.prototype.boundaryLineString=function(A){return this.Vt.isEmpty()?this.getEmptyMultiPoint():A.isClosed()?this.Ht.isInBoundary(2)?A.getStartPoint():this.Kt.createMultiPoint():this.Kt.createMultiPoint([A.getStartPoint(),A.getEndPoint()])},mi.prototype.getEmptyMultiPoint=function(){return this.Kt.createMultiPoint()},mi.prototype.computeBoundaryCoordinates=function(A){var t=new Zn;this._t=new wi;for(var n=0;n<A.getNumGeometries();n++){var i=A.getGeometryN(n);0!==i.getNumPoints()&&(this.addEndpoint(i.getCoordinateN(0)),this.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var r=this._t.entrySet().iterator();r.hasNext();){var e=r.next(),s=e.getValue().count;this.Ht.isInBoundary(s)&&t.add(e.getKey())}return Ai.toCoordinateArray(t)},mi.prototype.addEndpoint=function(A){var t=this._t.get(A);null===t&&(t=new pi,this._t.put(A,t)),t.count++},mi.prototype.interfaces_=function(){return[]},mi.prototype.getClass=function(){return mi},mi.getBoundary=function(){if(1===arguments.length){var A=arguments[0],t=new mi(A);return t.getBoundary()}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=new mi(n,i);return r.getBoundary()}};var pi=function(){this.count=null};function Li(){}function Ti(){}pi.prototype.interfaces_=function(){return[]},pi.prototype.getClass=function(){return pi};var Oi=function(){};function Fi(){}function Ei(){}function Ui(){}var Ni=function(){},ji={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Ni.prototype.interfaces_=function(){return[]},Ni.prototype.getClass=function(){return Ni},Ni.chars=function(A,t){for(var n=new Array(t).fill(null),i=0;i<t;i++)n[i]=A;return String(n)},Ni.getStackTrace=function(){if(1===arguments.length){var A=arguments[0],t=new Fi,n=new Li;return A.printStackTrace(n),t.toString()}if(2===arguments.length){for(var i=arguments[0],r=arguments[1],e="",u=(new Ti(Ni.getStackTrace(i)),new Ui),o=0;o<r;o++)try{e+=u.readLine()+Ni.NEWLINE}catch(A){if(!(A instanceof Ei))throw A;mn.shouldNeverReachHere()}return e}},Ni.split=function(A,t){for(var n=t.length,i=new Zn,r=""+A,e=r.indexOf(t);e>=0;){var s=r.substring(0,e);i.add(s),e=(r=r.substring(e+n)).indexOf(t)}r.length>0&&i.add(r);for(var u=new Array(i.size()).fill(null),o=0;o<u.length;o++)u[o]=i.get(o);return u},Ni.toString=function(){if(1===arguments.length){var A=arguments[0];return Ni.SIMPLE_ORDINATE_FORMAT.format(A)}},Ni.spaces=function(A){return Ni.chars(" ",A)},ji.NEWLINE.get=function(){return Pn.getProperty("line.separator")},ji.SIMPLE_ORDINATE_FORMAT.get=function(){return new Oi},Object.defineProperties(Ni,ji);var Qi=function(){};Qi.prototype.interfaces_=function(){return[]},Qi.prototype.getClass=function(){return Qi},Qi.copyCoord=function(A,t,n,i){for(var r=Math.min(A.getDimension(),n.getDimension()),e=0;e<r;e++)n.setOrdinate(i,e,A.getOrdinate(t,e))},Qi.isRing=function(A){var t=A.size();return 0===t||!(t<=3)&&A.getOrdinate(0,an.X)===A.getOrdinate(t-1,an.X)&&A.getOrdinate(0,an.Y)===A.getOrdinate(t-1,an.Y)},Qi.isEqual=function(A,t){var n=A.size();if(n!==t.size())return!1;for(var i=Math.min(A.getDimension(),t.getDimension()),r=0;r<n;r++)for(var e=0;e<i;e++){var s=A.getOrdinate(r,e),u=t.getOrdinate(r,e);if(!(A.getOrdinate(r,e)===t.getOrdinate(r,e)||Yt.isNaN(s)&&Yt.isNaN(u)))return!1}return!0},Qi.extend=function(A,t,n){var i=A.create(n,t.getDimension()),r=t.size();if(Qi.copy(t,0,i,0,r),r>0)for(var e=r;e<n;e++)Qi.copy(t,r-1,i,e,1);return i},Qi.reverse=function(A){for(var t=A.size()-1,n=Math.trunc(t/2),i=0;i<=n;i++)Qi.swap(A,i,t-i)},Qi.swap=function(A,t,n){if(t===n)return null;for(var i=0;i<A.getDimension();i++){var r=A.getOrdinate(t,i);A.setOrdinate(t,i,A.getOrdinate(n,i)),A.setOrdinate(n,i,r)}},Qi.copy=function(A,t,n,i,r){for(var e=0;e<r;e++)Qi.copyCoord(A,t+e,n,i+e)},Qi.toString=function(){if(1===arguments.length){var A=arguments[0],t=A.size();if(0===t)return"()";var n=A.getDimension(),i=new en;i.append("(");for(var r=0;r<t;r++){r>0&&i.append(" ");for(var e=0;e<n;e++)e>0&&i.append(","),i.append(Ni.toString(A.getOrdinate(r,e)))}return i.append(")"),i.toString()}},Qi.ensureValidRing=function(A,t){var n=t.size();return 0===n?t:n<=3?Qi.createClosedRing(A,t,4):t.getOrdinate(0,an.X)===t.getOrdinate(n-1,an.X)&&t.getOrdinate(0,an.Y)===t.getOrdinate(n-1,an.Y)?t:Qi.createClosedRing(A,t,n+1)},Qi.createClosedRing=function(A,t,n){var i=A.create(n,t.getDimension()),r=t.size();Qi.copy(t,0,i,0,r);for(var e=r;e<n;e++)Qi.copy(t,0,i,e,1);return i};var Si=function(A){function t(t,n){A.call(this,n),this.yt=null,this.init(t)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Cn:this.yt.expandEnvelope(new Cn)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return A.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this.yt.toCoordinateArray()},t.prototype.equalsExact=function(){var t=this;if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var r=n;if(this.yt.size()!==r.yt.size())return!1;for(var e=0;e<this.yt.size();e++)if(!t.equal(t.yt.getCoordinate(e),r.yt.getCoordinate(e),i))return!1;return!0}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var A=0;A<Math.trunc(this.yt.size()/2);A++){var t=this.yt.size()-1-A;if(!this.yt.getCoordinate(A).equals(this.yt.getCoordinate(t)))return this.yt.getCoordinate(A).compareTo(this.yt.getCoordinate(t))>0&&Qi.reverse(this.yt),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this.yt.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?Mi.FALSE:0},t.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return En.computeLength(this.yt)},t.prototype.getNumPoints=function(){return this.yt.size()},t.prototype.reverse=function(){var A=this.yt.copy();return Qi.reverse(A),this.getFactory().createLineString(A)},t.prototype.compareToSameClass=function(){var A=this;if(1===arguments.length){for(var t=arguments[0],n=t,i=0,r=0;i<this.yt.size()&&r<n.yt.size();){var e=A.yt.getCoordinate(i).compareTo(n.yt.getCoordinate(r));if(0!==e)return e;i++,r++}return i<this.yt.size()?1:r<n.yt.size()?-1:0}if(2===arguments.length){var s=arguments[0],u=arguments[1],o=s;return u.compare(this.yt,o.yt)}},t.prototype.apply=function(){var A=this;if(tn(arguments[0],Bn))for(var t=arguments[0],n=0;n<this.yt.size();n++)t.filter(A.yt.getCoordinate(n));else if(tn(arguments[0],xi)){var i=arguments[0];if(0===this.yt.size())return null;for(var r=0;r<this.yt.size()&&(i.filter(A.yt,r),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(tn(arguments[0],zi)){var e=arguments[0];e.filter(this)}else if(tn(arguments[0],Nn)){var s=arguments[0];s.filter(this)}},t.prototype.getBoundary=function(){return new mi(this).getBoundary()},t.prototype.isEquivalentClass=function(A){return A instanceof t},t.prototype.clone=function(){var t=A.prototype.clone.call(this);return t.yt=this.yt.clone(),t},t.prototype.getCoordinateN=function(A){return this.yt.getCoordinate(A)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this.yt.copy(),this.Yt)},t.prototype.getCoordinateSequence=function(){return this.yt},t.prototype.isEmpty=function(){return 0===this.yt.size()},t.prototype.init=function(A){if(null===A&&(A=this.getFactory().getCoordinateSequenceFactory().create([])),1===A.size())throw new Gt("Invalid number of points in LineString (found "+A.size()+" - must be 0 or >= 2)");this.yt=A},t.prototype.isCoordinate=function(A){for(var t=0;t<this.yt.size();t++)if(this.yt.getCoordinate(t).equals(A))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(A){return this.getFactory().createPoint(this.yt.getCoordinate(A))},t.prototype.interfaces_=function(){return[Pi]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,n),t}(jn),Bi=function(){};Bi.prototype.interfaces_=function(){return[]},Bi.prototype.getClass=function(){return Bi};var Ri=function(A){function t(t,n){A.call(this,n),this.xt=t||null,this.init(this.xt)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Cn;var A=new Cn;return A.expandToInclude(this.xt.getX(0),this.xt.getY(0)),A},t.prototype.getSortIndex=function(){return A.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&(!(!this.isEmpty()||!t.isEmpty())||this.isEmpty()===t.isEmpty()&&this.equal(t.getCoordinate(),this.getCoordinate(),n))}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return 0!==this.xt.size()?this.xt.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return Mi.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(1===arguments.length){var A=arguments[0],t=A;return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=n;return i.compare(this.xt,r.xt)}},t.prototype.apply=function(){if(tn(arguments[0],Bn)){var A=arguments[0];if(this.isEmpty())return null;A.filter(this.getCoordinate())}else if(tn(arguments[0],xi)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.xt,0),t.isGeometryChanged()&&this.geometryChanged()}else if(tn(arguments[0],zi)){var n=arguments[0];n.filter(this)}else if(tn(arguments[0],Nn)){var i=arguments[0];i.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var t=A.prototype.clone.call(this);return t.xt=this.xt.clone(),t},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this.xt.copy(),this.Yt)},t.prototype.getCoordinateSequence=function(){return this.xt},t.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return 0===this.xt.size()},t.prototype.init=function(A){null===A&&(A=this.getFactory().getCoordinateSequenceFactory().create([])),mn.isTrue(A.size()<=1),this.xt=A},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[Bi]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(t,n),t}(jn),ki=function(){};ki.prototype.interfaces_=function(){return[]},ki.prototype.getClass=function(){return ki};var Gi=function(A){function t(t,n,i){if(A.call(this,i),this.Lt=null,this.Tt=null,null===t&&(t=this.getFactory().createLinearRing()),null===n&&(n=[]),A.hasNullElements(n))throw new Gt("holes must not contain null elements");if(t.isEmpty()&&A.hasNonEmptyElements(n))throw new Gt("shell is empty but holes are not");this.Lt=t,this.Tt=n}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.Lt.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return A.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var A=new Array(this.getNumPoints()).fill(null),t=-1,n=this.Lt.getCoordinates(),i=0;i<n.length;i++)A[++t]=n[i];for(var r=0;r<this.Tt.length;r++)for(var e=this.Tt[r].getCoordinates(),s=0;s<e.length;s++)A[++t]=e[s];return A},t.prototype.getArea=function(){var A=0;A+=Math.abs(En.signedArea(this.Lt.getCoordinateSequence()));for(var t=0;t<this.Tt.length;t++)A-=Math.abs(En.signedArea(this.Tt[t].getCoordinateSequence()));return A},t.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this.Lt)return!1;if(5!==this.Lt.getNumPoints())return!1;for(var A=this.Lt.getCoordinateSequence(),t=this.getEnvelopeInternal(),n=0;n<5;n++){var i=A.getX(n);if(i!==t.getMinX()&&i!==t.getMaxX())return!1;var r=A.getY(n);if(r!==t.getMinY()&&r!==t.getMaxY())return!1}for(var e=A.getX(0),s=A.getY(0),u=1;u<=4;u++){var o=A.getX(u),h=A.getY(u);if(o!==e==(h!==s))return!1;e=o,s=h}return!0},t.prototype.equalsExact=function(){var t=this;if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var r=n,e=this.Lt,s=r.Lt;if(!e.equalsExact(s,i))return!1;if(this.Tt.length!==r.Tt.length)return!1;for(var u=0;u<this.Tt.length;u++)if(!t.Tt[u].equalsExact(r.Tt[u],i))return!1;return!0}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var A=this;if(0===arguments.length){this.normalize(this.Lt,!0);for(var t=0;t<this.Tt.length;t++)A.normalize(A.Tt[t],!1);Ii.sort(this.Tt)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];if(n.isEmpty())return null;var r=new Array(n.getCoordinates().length-1).fill(null);Pn.arraycopy(n.getCoordinates(),0,r,0,r.length);var e=Ai.minCoordinate(n.getCoordinates());Ai.scroll(r,e),Pn.arraycopy(r,0,n.getCoordinates(),0,r.length),n.getCoordinates()[r.length]=r[0],En.isCCW(n.getCoordinates())===i&&Ai.reverse(n.getCoordinates())}},t.prototype.getCoordinate=function(){return this.Lt.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this.Tt.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var A=0;A+=this.Lt.getLength();for(var t=0;t<this.Tt.length;t++)A+=this.Tt[t].getLength();return A},t.prototype.getNumPoints=function(){for(var A=this.Lt.getNumPoints(),t=0;t<this.Tt.length;t++)A+=this.Tt[t].getNumPoints();return A},t.prototype.reverse=function(){var A=this.copy();A.Lt=this.Lt.copy().reverse(),A.Tt=new Array(this.Tt.length).fill(null);for(var t=0;t<this.Tt.length;t++)A.Tt[t]=this.Tt[t].copy().reverse();return A},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=this.Lt,i=t.Lt;return n.compareToSameClass(i)}if(2===arguments.length){var r=arguments[0],e=arguments[1],s=r,u=this.Lt,o=s.Lt,h=u.compareToSameClass(o,e);if(0!==h)return h;for(var f=this.getNumInteriorRing(),c=s.getNumInteriorRing(),a=0;a<f&&a<c;){var v=A.getInteriorRingN(a),l=s.getInteriorRingN(a),w=v.compareToSameClass(l,e);if(0!==w)return w;a++}return a<f?1:a<c?-1:0}},t.prototype.apply=function(A){if(tn(A,Bn)){this.Lt.apply(A);for(var t=0;t<this.Tt.length;t++)this.Tt[t].apply(A)}else if(tn(A,xi)){if(this.Lt.apply(A),!A.isDone())for(var n=0;n<this.Tt.length&&(this.Tt[n].apply(A),!A.isDone());n++);A.isGeometryChanged()&&this.geometryChanged()}else if(tn(A,zi))A.filter(this);else if(tn(A,Nn)){A.filter(this),this.Lt.apply(A);for(var i=0;i<this.Tt.length;i++)this.Tt[i].apply(A)}},t.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var A=new Array(this.Tt.length+1).fill(null);A[0]=this.Lt;for(var t=0;t<this.Tt.length;t++)A[t+1]=this.Tt[t];return A.length<=1?this.getFactory().createLinearRing(A[0].getCoordinateSequence()):this.getFactory().createMultiLineString(A)},t.prototype.clone=function(){var t=A.prototype.clone.call(this);t.Lt=this.Lt.clone(),t.Tt=new Array(this.Tt.length).fill(null);for(var n=0;n<this.Tt.length;n++)t.Tt[n]=this.Tt[n].clone();return t},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var A=this.Lt.copy(),n=new Array(this.Tt.length).fill(null),i=0;i<n.length;i++)n[i]=this.Tt[i].copy();return new t(A,n,this.Yt)},t.prototype.getExteriorRing=function(){return this.Lt},t.prototype.isEmpty=function(){return this.Lt.isEmpty()},t.prototype.getInteriorRingN=function(A){return this.Tt[A]},t.prototype.interfaces_=function(){return[ki]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,n),t}(jn),Yi=function(A){function t(){A.apply(this,arguments)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return jn.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&A.prototype.equalsExact.call(this,t,n)}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this.dt[t].getCoordinate()}return A.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return Mi.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var A=new Array(this.dt.length).fill(null),n=0;n<A.length;n++)A[n]=this.dt[n].copy();return new t(A,this.Yt)},t.prototype.interfaces_=function(){return[Bi]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(t,n),t}(di),qi=function(A){function t(t,n){t instanceof _t&&n instanceof sr&&(t=n.getCoordinateSequenceFactory().create(t)),A.call(this,t,n),this.validateConstruction()}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return jn.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return Mi.FALSE},t.prototype.isClosed=function(){return!!this.isEmpty()||A.prototype.isClosed.call(this)},t.prototype.reverse=function(){var A=this.yt.copy();return Qi.reverse(A),this.getFactory().createLinearRing(A)},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!A.prototype.isClosed.call(this))throw new Gt("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new Gt("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this.yt.copy(),this.Yt)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,n),t}(Si),Wi=function(A){function t(){A.apply(this,arguments)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return jn.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&A.prototype.equalsExact.call(this,t,n)}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var t=new Array(this.dt.length).fill(null),n=0;n<this.dt.length;n++)t[n]=this.dt[n].reverse();return this.getFactory().createMultiPolygon(t)},t.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var A=new Zn,t=0;t<this.dt.length;t++)for(var n=this.dt[t].getBoundary(),i=0;i<n.getNumGeometries();i++)A.add(n.getGeometryN(i));var r=new Array(A.size()).fill(null);return this.getFactory().createMultiLineString(A.toArray(r))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var A=new Array(this.dt.length).fill(null),n=0;n<A.length;n++)A[n]=this.dt[n].copy();return new t(A,this.Yt)},t.prototype.interfaces_=function(){return[ki]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,n),t}(di),Vi=function(A){this.Yt=A||null,this.Jt=!1},Ki={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Vi.prototype.setCopyUserData=function(A){this.Jt=A},Vi.prototype.edit=function(A,t){if(null===A)return null;var n=this.editInternal(A,t);return this.Jt&&n.setUserData(A.getUserData()),n},Vi.prototype.editInternal=function(A,t){return null===this.Yt&&(this.Yt=A.getFactory()),A instanceof di?this.editGeometryCollection(A,t):A instanceof Gi?this.editPolygon(A,t):A instanceof Ri||A instanceof Si?t.edit(A,this.Yt):(mn.shouldNeverReachHere("Unsupported Geometry class: "+A.getClass().getName()),null)},Vi.prototype.editGeometryCollection=function(A,t){for(var n=t.edit(A,this.Yt),i=new Zn,r=0;r<n.getNumGeometries();r++){var e=this.edit(n.getGeometryN(r),t);null===e||e.isEmpty()||i.add(e)}return n.getClass()===Yi?this.Yt.createMultiPoint(i.toArray([])):n.getClass()===yi?this.Yt.createMultiLineString(i.toArray([])):n.getClass()===Wi?this.Yt.createMultiPolygon(i.toArray([])):this.Yt.createGeometryCollection(i.toArray([]))},Vi.prototype.editPolygon=function(A,t){var n=t.edit(A,this.Yt);if(null===n&&(n=this.Yt.createPolygon(null)),n.isEmpty())return n;var i=this.edit(n.getExteriorRing(),t);if(null===i||i.isEmpty())return this.Yt.createPolygon();for(var r=new Zn,e=0;e<n.getNumInteriorRing();e++){var s=this.edit(n.getInteriorRingN(e),t);null===s||s.isEmpty()||r.add(s)}return this.Yt.createPolygon(i,r.toArray([]))},Vi.prototype.interfaces_=function(){return[]},Vi.prototype.getClass=function(){return Vi},Vi.GeometryEditorOperation=function(){},Ki.NoOpGeometryOperation.get=function(){return Hi},Ki.CoordinateOperation.get=function(){return _i},Ki.CoordinateSequenceOperation.get=function(){return Ji},Object.defineProperties(Vi,Ki);var Hi=function(){};Hi.prototype.edit=function(A,t){return A},Hi.prototype.interfaces_=function(){return[Vi.GeometryEditorOperation]},Hi.prototype.getClass=function(){return Hi};var _i=function(){};_i.prototype.edit=function(A,t){var n=this.editCoordinates(A.getCoordinates(),A);return null===n?A:A instanceof qi?t.createLinearRing(n):A instanceof Si?t.createLineString(n):A instanceof Ri?n.length>0?t.createPoint(n[0]):t.createPoint():A},_i.prototype.interfaces_=function(){return[Vi.GeometryEditorOperation]},_i.prototype.getClass=function(){return _i};var Ji=function(){};Ji.prototype.edit=function(A,t){return A instanceof qi?t.createLinearRing(this.edit(A.getCoordinateSequence(),A)):A instanceof Si?t.createLineString(this.edit(A.getCoordinateSequence(),A)):A instanceof Ri?t.createPoint(this.edit(A.getCoordinateSequence(),A)):A},Ji.prototype.interfaces_=function(){return[Vi.GeometryEditorOperation]},Ji.prototype.getClass=function(){return Ji};var Zi=function(){var A=this;if(this.Zt=3,this.xt=null,1===arguments.length){if(arguments[0]instanceof Array)this.xt=arguments[0],this.Zt=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this.xt=new Array(t).fill(null);for(var n=0;n<t;n++)A.xt[n]=new _t}else if(tn(arguments[0],an)){var i=arguments[0];if(null===i)return this.xt=new Array(0).fill(null),null;this.Zt=i.getDimension(),this.xt=new Array(i.size()).fill(null);for(var r=0;r<this.xt.length;r++)A.xt[r]=i.getCoordinateCopy(r)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var e=arguments[0],s=arguments[1];this.xt=e,this.Zt=s,null===e&&(this.xt=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],o=arguments[1];this.xt=new Array(u).fill(null),this.Zt=o;for(var h=0;h<u;h++)A.xt[h]=new _t}},Xi={serialVersionUID:{configurable:!0}};Zi.prototype.setOrdinate=function(A,t,n){switch(t){case an.X:this.xt[A].x=n;break;case an.Y:this.xt[A].y=n;break;case an.Z:this.xt[A].z=n;break;default:throw new Gt("invalid ordinateIndex")}},Zi.prototype.size=function(){return this.xt.length},Zi.prototype.getOrdinate=function(A,t){switch(t){case an.X:return this.xt[A].x;case an.Y:return this.xt[A].y;case an.Z:return this.xt[A].z}return Yt.NaN},Zi.prototype.getCoordinate=function(){if(1===arguments.length){var A=arguments[0];return this.xt[A]}if(2===arguments.length){var t=arguments[0],n=arguments[1];n.x=this.xt[t].x,n.y=this.xt[t].y,n.z=this.xt[t].z}},Zi.prototype.getCoordinateCopy=function(A){return new _t(this.xt[A])},Zi.prototype.getDimension=function(){return this.Zt},Zi.prototype.getX=function(A){return this.xt[A].x},Zi.prototype.clone=function(){for(var A=new Array(this.size()).fill(null),t=0;t<this.xt.length;t++)A[t]=this.xt[t].clone();return new Zi(A,this.Zt)},Zi.prototype.expandEnvelope=function(A){for(var t=0;t<this.xt.length;t++)A.expandToInclude(this.xt[t]);return A},Zi.prototype.copy=function(){for(var A=new Array(this.size()).fill(null),t=0;t<this.xt.length;t++)A[t]=this.xt[t].copy();return new Zi(A,this.Zt)},Zi.prototype.toString=function(){if(this.xt.length>0){var A=new en(17*this.xt.length);A.append("("),A.append(this.xt[0]);for(var t=1;t<this.xt.length;t++)A.append(", "),A.append(this.xt[t]);return A.append(")"),A.toString()}return"()"},Zi.prototype.getY=function(A){return this.xt[A].y},Zi.prototype.toCoordinateArray=function(){return this.xt},Zi.prototype.interfaces_=function(){return[an,Ht]},Zi.prototype.getClass=function(){return Zi},Xi.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(Zi,Xi);var $i=function(){},Ar={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};$i.prototype.readResolve=function(){return $i.instance()},$i.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array){var A=arguments[0];return new Zi(A)}if(tn(arguments[0],an)){var t=arguments[0];return new Zi(t)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return i>3&&(i=3),i<2?new Zi(n):new Zi(n,i)}},$i.prototype.interfaces_=function(){return[Xt,Ht]},$i.prototype.getClass=function(){return $i},$i.instance=function(){return $i.instanceObject},Ar.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Ar.instanceObject.get=function(){return new $i},Object.defineProperties($i,Ar);var tr=function(A){function t(){A.call(this),this.map_=new Map}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.get=function(A){return this.map_.get(A)||null},t.prototype.put=function(A,t){return this.map_.set(A,t),t},t.prototype.values=function(){for(var A=new Zn,t=this.map_.values(),n=t.next();!n.done;)A.add(n.value),n=t.next();return A},t.prototype.entrySet=function(){var A=new oi;return this.map_.entries().forEach((function(t){return A.add(t)})),A},t.prototype.size=function(){return this.map_.size()},t}(ri),nr=function A(){if(this.Xt=null,this.DA=null,0===arguments.length)this.Xt=A.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof rr){var t=arguments[0];this.Xt=t,t===A.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this.Xt=A.FIXED,this.setScale(n)}else if(arguments[0]instanceof A){var i=arguments[0];this.Xt=i.Xt,this.DA=i.DA}},ir={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};nr.prototype.equals=function(A){if(!(A instanceof nr))return!1;return this.Xt===A.Xt&&this.DA===A.DA},nr.prototype.compareTo=function(A){var t=A,n=this.getMaximumSignificantDigits(),i=t.getMaximumSignificantDigits();return new sn(n).compareTo(new sn(i))},nr.prototype.getScale=function(){return this.DA},nr.prototype.isFloating=function(){return this.Xt===nr.FLOATING||this.Xt===nr.FLOATING_SINGLE},nr.prototype.getType=function(){return this.Xt},nr.prototype.toString=function(){var A="UNKNOWN";return this.Xt===nr.FLOATING?A="Floating":this.Xt===nr.FLOATING_SINGLE?A="Floating-Single":this.Xt===nr.FIXED&&(A="Fixed (Scale="+this.getScale()+")"),A},nr.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var A=arguments[0];return Yt.isNaN(A)||this.Xt===nr.FLOATING_SINGLE?A:this.Xt===nr.FIXED?Math.round(A*this.DA)/this.DA:A}if(arguments[0]instanceof _t){var t=arguments[0];if(this.Xt===nr.FLOATING)return null;t.x=this.makePrecise(t.x),t.y=this.makePrecise(t.y)}},nr.prototype.getMaximumSignificantDigits=function(){var A=16;return this.Xt===nr.FLOATING?A=16:this.Xt===nr.FLOATING_SINGLE?A=6:this.Xt===nr.FIXED&&(A=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),A},nr.prototype.setScale=function(A){this.DA=Math.abs(A)},nr.prototype.interfaces_=function(){return[Ht,Wt]},nr.prototype.getClass=function(){return nr},nr.mostPrecise=function(A,t){return A.compareTo(t)>=0?A:t},ir.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},ir.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(nr,ir);var rr=function A(t){this.$t=t||null,A.nameToTypeMap.put(t,this)},er={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};rr.prototype.readResolve=function(){return rr.nameToTypeMap.get(this.$t)},rr.prototype.toString=function(){return this.$t},rr.prototype.interfaces_=function(){return[Ht]},rr.prototype.getClass=function(){return rr},er.serialVersionUID.get=function(){return-552860263173159e4},er.nameToTypeMap.get=function(){return new tr},Object.defineProperties(rr,er),nr.Type=rr,nr.FIXED=new rr("FIXED"),nr.FLOATING=new rr("FLOATING"),nr.FLOATING_SINGLE=new rr("FLOATING SINGLE");var sr=function A(){this.St=new nr,this.qt=0,this.An=A.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?tn(arguments[0],Xt)?this.An=arguments[0]:arguments[0]instanceof nr&&(this.St=arguments[0]):2===arguments.length?(this.St=arguments[0],this.qt=arguments[1]):3===arguments.length&&(this.St=arguments[0],this.qt=arguments[1],this.An=arguments[2]))},ur={serialVersionUID:{configurable:!0}};sr.prototype.toGeometry=function(A){return A.isNull()?this.createPoint(null):A.getMinX()===A.getMaxX()&&A.getMinY()===A.getMaxY()?this.createPoint(new _t(A.getMinX(),A.getMinY())):A.getMinX()===A.getMaxX()||A.getMinY()===A.getMaxY()?this.createLineString([new _t(A.getMinX(),A.getMinY()),new _t(A.getMaxX(),A.getMaxY())]):this.createPolygon(this.createLinearRing([new _t(A.getMinX(),A.getMinY()),new _t(A.getMinX(),A.getMaxY()),new _t(A.getMaxX(),A.getMaxY()),new _t(A.getMaxX(),A.getMinY()),new _t(A.getMinX(),A.getMinY())]),null)},sr.prototype.createLineString=function(A){return A?A instanceof Array?new Si(this.getCoordinateSequenceFactory().create(A),this):tn(A,an)?new Si(A,this):void 0:new Si(this.getCoordinateSequenceFactory().create([]),this)},sr.prototype.createMultiLineString=function(){if(0===arguments.length)return new yi(null,this);if(1===arguments.length){var A=arguments[0];return new yi(A,this)}},sr.prototype.buildGeometry=function(A){for(var t=null,n=!1,i=!1,r=A.iterator();r.hasNext();){var e=r.next(),s=e.getClass();null===t&&(t=s),s!==t&&(n=!0),e.isGeometryCollectionOrDerived()&&(i=!0)}if(null===t)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(sr.toGeometryArray(A));var u=A.iterator().next();if(A.size()>1){if(u instanceof Gi)return this.createMultiPolygon(sr.toPolygonArray(A));if(u instanceof Si)return this.createMultiLineString(sr.toLineStringArray(A));if(u instanceof Ri)return this.createMultiPoint(sr.toPointArray(A));mn.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u},sr.prototype.createMultiPointFromCoords=function(A){return this.createMultiPoint(null!==A?this.getCoordinateSequenceFactory().create(A):null)},sr.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof _t){var A=arguments[0];return this.createPoint(null!==A?this.getCoordinateSequenceFactory().create([A]):null)}if(tn(arguments[0],an)){var t=arguments[0];return new Ri(t,this)}}},sr.prototype.getCoordinateSequenceFactory=function(){return this.An},sr.prototype.createPolygon=function(){if(0===arguments.length)return new Gi(null,null,this);if(1===arguments.length){if(tn(arguments[0],an)){var A=arguments[0];return this.createPolygon(this.createLinearRing(A))}if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof qi){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return new Gi(i,r,this)}},sr.prototype.getSRID=function(){return this.qt},sr.prototype.createGeometryCollection=function(){if(0===arguments.length)return new di(null,this);if(1===arguments.length){var A=arguments[0];return new di(A,this)}},sr.prototype.createGeometry=function(A){return new Vi(this).edit(A,{edit:function(){if(2===arguments.length){var A=arguments[0];return this.An.create(A)}}})},sr.prototype.getPrecisionModel=function(){return this.St},sr.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var A=arguments[0];return this.createLinearRing(null!==A?this.getCoordinateSequenceFactory().create(A):null)}if(tn(arguments[0],an)){var t=arguments[0];return new qi(t,this)}}},sr.prototype.createMultiPolygon=function(){if(0===arguments.length)return new Wi(null,this);if(1===arguments.length){var A=arguments[0];return new Wi(A,this)}},sr.prototype.createMultiPoint=function(){var A=this;if(0===arguments.length)return new Yi(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return new Yi(t,this)}if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(null!==n?this.getCoordinateSequenceFactory().create(n):null)}if(tn(arguments[0],an)){var i=arguments[0];if(null===i)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(i.size()).fill(null),e=0;e<i.size();e++){var s=A.getCoordinateSequenceFactory().create(1,i.getDimension());Qi.copy(i,e,s,0,1),r[e]=A.createPoint(s)}return this.createMultiPoint(r)}}},sr.prototype.interfaces_=function(){return[Ht]},sr.prototype.getClass=function(){return sr},sr.toMultiPolygonArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},sr.toGeometryArray=function(A){if(null===A)return null;var t=new Array(A.size()).fill(null);return A.toArray(t)},sr.getDefaultCoordinateSequenceFactory=function(){return $i.instance()},sr.toMultiLineStringArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},sr.toLineStringArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},sr.toMultiPointArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},sr.toLinearRingArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},sr.toPointArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},sr.toPolygonArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},sr.createPointFromInternalCoord=function(A,t){return t.getPrecisionModel().makePrecise(A),t.getFactory().createPoint(A)},ur.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(sr,ur);var or=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],hr=function(A){this.geometryFactory=A||new sr};hr.prototype.read=function(A){var t,n=(t="string"==typeof A?JSON.parse(A):A).type;if(!fr[n])throw new Error("Unknown GeoJSON type: "+t.type);return-1!==or.indexOf(n)?fr[n].apply(this,[t.coordinates]):fr[n].apply(this,"GeometryCollection"===n?[t.geometries]:[t])},hr.prototype.write=function(A){var t=A.getGeometryType();if(!cr[t])throw new Error("Geometry is not supported");return cr[t].apply(this,[A])};var fr={Feature:function(A){var t={};for(var n in A)t[n]=A[n];if(A.geometry){if(!fr[A.geometry.type])throw new Error("Unknown GeoJSON type: "+A.type);t.geometry=this.read(A.geometry)}return A.bbox&&(t.bbox=fr.bbox.apply(this,[A.bbox])),t},FeatureCollection:function(A){var t={};if(A.features){t.features=[];for(var n=0;n<A.features.length;++n)t.features.push(this.read(A.features[n]))}return A.bbox&&(t.bbox=this.parse.bbox.apply(this,[A.bbox])),t},coordinates:function(A){for(var t=[],n=0;n<A.length;++n){var i=A[n];t.push(new _t(i[0],i[1]))}return t},bbox:function(A){return this.geometryFactory.createLinearRing([new _t(A[0],A[1]),new _t(A[2],A[1]),new _t(A[2],A[3]),new _t(A[0],A[3]),new _t(A[0],A[1])])},Point:function(A){var t=new _t(A[0],A[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(A){for(var t=[],n=0;n<A.length;++n)t.push(fr.Point.apply(this,[A[n]]));return this.geometryFactory.createMultiPoint(t)},LineString:function(A){var t=fr.coordinates.apply(this,[A]);return this.geometryFactory.createLineString(t)},MultiLineString:function(A){for(var t=[],n=0;n<A.length;++n)t.push(fr.LineString.apply(this,[A[n]]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(A){for(var t=fr.coordinates.apply(this,[A[0]]),n=this.geometryFactory.createLinearRing(t),i=[],r=1;r<A.length;++r){var s=fr.coordinates.apply(this,[A[r]]),u=this.geometryFactory.createLinearRing(s);i.push(u)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(A){for(var t=[],n=0;n<A.length;++n){t.push(fr.Polygon.apply(this,[A[n]]))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(A){for(var t=[],n=0;n<A.length;++n){t.push(this.read(A[n]))}return this.geometryFactory.createGeometryCollection(t)}},cr={coordinate:function(A){return[A.x,A.y]},Point:function(A){return{type:"Point",coordinates:cr.coordinate.apply(this,[A.getCoordinate()])}},MultiPoint:function(A){for(var t=[],n=0;n<A.dt.length;++n){var r=cr.Point.apply(this,[A.dt[n]]);t.push(r.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(A){for(var t=[],n=A.getCoordinates(),i=0;i<n.length;++i){t.push(cr.coordinate.apply(this,[n[i]]))}return{type:"LineString",coordinates:t}},MultiLineString:function(A){for(var t=[],n=0;n<A.dt.length;++n){var r=cr.LineString.apply(this,[A.dt[n]]);t.push(r.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(A){var t=[],n=cr.LineString.apply(this,[A.Lt]);t.push(n.coordinates);for(var i=0;i<A.Tt.length;++i){var e=cr.LineString.apply(this,[A.Tt[i]]);t.push(e.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(A){for(var t=[],n=0;n<A.dt.length;++n){var r=cr.Polygon.apply(this,[A.dt[n]]);t.push(r.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(A){for(var t=[],n=0;n<A.dt.length;++n){var i=A.dt[n],r=i.getGeometryType();t.push(cr[r].apply(this,[i]))}return{type:"GeometryCollection",geometries:t}}},ar=function(A){this.geometryFactory=A||new sr,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new hr(this.geometryFactory)};ar.prototype.read=function(A){var t=this.parser.read(A);return this.precisionModel.getType()===nr.FIXED&&this.reducePrecision(t),t},ar.prototype.reducePrecision=function(A){var t,n;if(A.coordinate)this.precisionModel.makePrecise(A.coordinate);else if(A.points)for(t=0,n=A.points.length;t<n;t++)this.precisionModel.makePrecise(A.points[t]);else if(A.geometries)for(t=0,n=A.geometries.length;t<n;t++)this.reducePrecision(A.geometries[t])};var vr=function(){this.parser=new hr(this.geometryFactory)};vr.prototype.write=function(A){return this.parser.write(A)};var lr=function(){},wr={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};function Pr(A){this.message=A||""}function gr(){this.array_=[]}lr.prototype.interfaces_=function(){return[]},lr.prototype.getClass=function(){return lr},lr.opposite=function(A){return A===lr.LEFT?lr.RIGHT:A===lr.RIGHT?lr.LEFT:A},wr.ON.get=function(){return 0},wr.LEFT.get=function(){return 1},wr.RIGHT.get=function(){return 2},Object.defineProperties(lr,wr),(Pr.prototype=new Error).name="EmptyStackException",(gr.prototype=new _n).add=function(A){return this.array_.push(A),!0},gr.prototype.get=function(A){if(A<0||A>=this.size())throw new Error;return this.array_[A]},gr.prototype.push=function(A){return this.array_.push(A),A},gr.prototype.pop=function(A){if(0===this.array_.length)throw new Pr;return this.array_.pop()},gr.prototype.peek=function(){if(0===this.array_.length)throw new Pr;return this.array_[this.array_.length-1]},gr.prototype.empty=function(){return 0===this.array_.length},gr.prototype.isEmpty=function(){return this.empty()},gr.prototype.search=function(A){return this.array_.indexOf(A)},gr.prototype.size=function(){return this.array_.length},gr.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A};var Cr=function(){this.tn=-1,this.nn=null,this.in=null,this.rn=null};Cr.prototype.getCoordinate=function(){return this.nn},Cr.prototype.getRightmostSide=function(A,t){var n=this.getRightmostSideOfSegment(A,t);return n<0&&(n=this.getRightmostSideOfSegment(A,t-1)),n<0&&(this.nn=null,this.checkForRightmostCoordinate(A)),n},Cr.prototype.findRightmostEdgeAtVertex=function(){var A=this.in.getEdge().getCoordinates();mn.isTrue(this.tn>0&&this.tn<A.length,"rightmost point expected to be interior vertex of edge");var t=A[this.tn-1],n=A[this.tn+1],i=En.computeOrientation(this.nn,n,t),r=!1;(t.y<this.nn.y&&n.y<this.nn.y&&i===En.COUNTERCLOCKWISE||t.y>this.nn.y&&n.y>this.nn.y&&i===En.CLOCKWISE)&&(r=!0),r&&(this.tn=this.tn-1)},Cr.prototype.getRightmostSideOfSegment=function(A,t){var n=A.getEdge().getCoordinates();if(t<0||t+1>=n.length)return-1;if(n[t].y===n[t+1].y)return-1;var i=lr.LEFT;return n[t].y<n[t+1].y&&(i=lr.RIGHT),i},Cr.prototype.getEdge=function(){return this.rn},Cr.prototype.checkForRightmostCoordinate=function(A){for(var t=A.getEdge().getCoordinates(),n=0;n<t.length-1;n++)(null===this.nn||t[n].x>this.nn.x)&&(this.in=A,this.tn=n,this.nn=t[n])},Cr.prototype.findRightmostEdgeAtNode=function(){var A=this.in.getNode().getEdges();this.in=A.getRightmostEdge(),this.in.isForward()||(this.in=this.in.getSym(),this.tn=this.in.getEdge().getCoordinates().length-1)},Cr.prototype.findEdge=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next();n.isForward()&&this.checkForRightmostCoordinate(n)}mn.isTrue(0!==this.tn||this.nn.equals(this.in.getCoordinate()),"inconsistency in rightmost processing"),0===this.tn?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this.rn=this.in,this.getRightmostSide(this.in,this.tn)===lr.LEFT&&(this.rn=this.in.getSym())},Cr.prototype.interfaces_=function(){return[]},Cr.prototype.getClass=function(){return Cr};var Dr=function(A){function t(n,i){A.call(this,t.msgWithCoord(n,i)),this.pt=i?new _t(i):null,this.name="TopologyException"}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(A,t){return t?A:A+" [ "+t+" ]"},t}(dn),Ir=function(){this.array_=[]};Ir.prototype.addLast=function(A){this.array_.push(A)},Ir.prototype.removeFirst=function(){return this.array_.shift()},Ir.prototype.isEmpty=function(){return 0===this.array_.length};var Mr=function(){this.en=null,this.sn=new Zn,this.un=new Zn,this.hn=null,this.cn=null,this.en=new Cr};Mr.prototype.clearVisitedEdges=function(){for(var A=this.sn.iterator();A.hasNext();)A.next().setVisited(!1)},Mr.prototype.getRightmostCoordinate=function(){return this.hn},Mr.prototype.computeNodeDepth=function(A){for(var t=null,n=A.getEdges().iterator();n.hasNext();){var i=n.next();if(i.isVisited()||i.getSym().isVisited()){t=i;break}}if(null===t)throw new Dr("unable to find edge to compute depths at "+A.getCoordinate());A.getEdges().computeDepths(t);for(var r=A.getEdges().iterator();r.hasNext();){var e=r.next();e.setVisited(!0),this.copySymDepths(e)}},Mr.prototype.computeDepth=function(A){this.clearVisitedEdges();var t=this.en.getEdge();t.setEdgeDepths(lr.RIGHT,A),this.copySymDepths(t),this.computeDepths(t)},Mr.prototype.create=function(A){this.addReachable(A),this.en.findEdge(this.sn),this.hn=this.en.getCoordinate()},Mr.prototype.findResultEdges=function(){for(var A=this.sn.iterator();A.hasNext();){var t=A.next();t.getDepth(lr.RIGHT)>=1&&t.getDepth(lr.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}},Mr.prototype.computeDepths=function(A){var t=new oi,n=new Ir,i=A.getNode();for(n.addLast(i),t.add(i),A.setVisited(!0);!n.isEmpty();){var r=n.removeFirst();t.add(r),this.computeNodeDepth(r);for(var e=r.getEdges().iterator();e.hasNext();){var s=e.next().getSym();if(!s.isVisited()){var u=s.getNode();t.contains(u)||(n.addLast(u),t.add(u))}}}},Mr.prototype.compareTo=function(A){return this.hn.x<A.hn.x?-1:this.hn.x>A.hn.x?1:0},Mr.prototype.getEnvelope=function(){if(null===this.cn){for(var A=new Cn,t=this.sn.iterator();t.hasNext();)for(var n=t.next().getEdge().getCoordinates(),i=0;i<n.length-1;i++)A.expandToInclude(n[i]);this.cn=A}return this.cn},Mr.prototype.addReachable=function(A){var t=new gr;for(t.add(A);!t.empty();){var n=t.pop();this.add(n,t)}},Mr.prototype.copySymDepths=function(A){var t=A.getSym();t.setDepth(lr.LEFT,A.getDepth(lr.RIGHT)),t.setDepth(lr.RIGHT,A.getDepth(lr.LEFT))},Mr.prototype.add=function(A,t){A.setVisited(!0),this.un.add(A);for(var n=A.getEdges().iterator();n.hasNext();){var i=n.next();this.sn.add(i);var r=i.getSym().getNode();r.isVisited()||t.push(r)}},Mr.prototype.getNodes=function(){return this.un},Mr.prototype.getDirectedEdges=function(){return this.sn},Mr.prototype.interfaces_=function(){return[Wt]},Mr.prototype.getClass=function(){return Mr};var br=function A(){var t=this;if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[lr.ON]=i}else if(arguments[0]instanceof A){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var e=0;e<this.location.length;e++)t.location[e]=r.location[e]}}else if(3===arguments.length){var s=arguments[0],u=arguments[1],o=arguments[2];this.init(3),this.location[lr.ON]=s,this.location[lr.LEFT]=u,this.location[lr.RIGHT]=o}};br.prototype.setAllLocations=function(A){for(var t=0;t<this.location.length;t++)this.location[t]=A},br.prototype.isNull=function(){for(var A=0;A<this.location.length;A++)if(this.location[A]!==$t.NONE)return!1;return!0},br.prototype.setAllLocationsIfNull=function(A){for(var t=0;t<this.location.length;t++)this.location[t]===$t.NONE&&(this.location[t]=A)},br.prototype.isLine=function(){return 1===this.location.length},br.prototype.merge=function(A){if(A.location.length>this.location.length){var t=new Array(3).fill(null);t[lr.ON]=this.location[lr.ON],t[lr.LEFT]=$t.NONE,t[lr.RIGHT]=$t.NONE,this.location=t}for(var n=0;n<this.location.length;n++)this.location[n]===$t.NONE&&n<A.location.length&&(this.location[n]=A.location[n])},br.prototype.getLocations=function(){return this.location},br.prototype.flip=function(){if(this.location.length<=1)return null;var A=this.location[lr.LEFT];this.location[lr.LEFT]=this.location[lr.RIGHT],this.location[lr.RIGHT]=A},br.prototype.toString=function(){var A=new en;return this.location.length>1&&A.append($t.toLocationSymbol(this.location[lr.LEFT])),A.append($t.toLocationSymbol(this.location[lr.ON])),this.location.length>1&&A.append($t.toLocationSymbol(this.location[lr.RIGHT])),A.toString()},br.prototype.setLocations=function(A,t,n){this.location[lr.ON]=A,this.location[lr.LEFT]=t,this.location[lr.RIGHT]=n},br.prototype.get=function(A){return A<this.location.length?this.location[A]:$t.NONE},br.prototype.isArea=function(){return this.location.length>1},br.prototype.isAnyNull=function(){for(var A=0;A<this.location.length;A++)if(this.location[A]===$t.NONE)return!0;return!1},br.prototype.setLocation=function(){if(1===arguments.length){var A=arguments[0];this.setLocation(lr.ON,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.location[t]=n}},br.prototype.init=function(A){this.location=new Array(A).fill(null),this.setAllLocations($t.NONE)},br.prototype.isEqualOnSide=function(A,t){return this.location[t]===A.location[t]},br.prototype.allPositionsEqual=function(A){for(var t=0;t<this.location.length;t++)if(this.location[t]!==A)return!1;return!0},br.prototype.interfaces_=function(){return[]},br.prototype.getClass=function(){return br};var zr=function A(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new br(t),this.elt[1]=new br(t)}else if(arguments[0]instanceof A){var n=arguments[0];this.elt[0]=new br(n.elt[0]),this.elt[1]=new br(n.elt[1])}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.elt[0]=new br($t.NONE),this.elt[1]=new br($t.NONE),this.elt[i].setLocation(r)}else if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2];this.elt[0]=new br(e,s,u),this.elt[1]=new br(e,s,u)}else if(4===arguments.length){var o=arguments[0],h=arguments[1],f=arguments[2],c=arguments[3];this.elt[0]=new br($t.NONE,$t.NONE,$t.NONE),this.elt[1]=new br($t.NONE,$t.NONE,$t.NONE),this.elt[o].setLocations(h,f,c)}};zr.prototype.getGeometryCount=function(){var A=0;return this.elt[0].isNull()||A++,this.elt[1].isNull()||A++,A},zr.prototype.setAllLocations=function(A,t){this.elt[A].setAllLocations(t)},zr.prototype.isNull=function(A){return this.elt[A].isNull()},zr.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var A=arguments[0];this.setAllLocationsIfNull(0,A),this.setAllLocationsIfNull(1,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}},zr.prototype.isLine=function(A){return this.elt[A].isLine()},zr.prototype.merge=function(A){for(var t=0;t<2;t++)null===this.elt[t]&&null!==A.elt[t]?this.elt[t]=new br(A.elt[t]):this.elt[t].merge(A.elt[t])},zr.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},zr.prototype.getLocation=function(){if(1===arguments.length){var A=arguments[0];return this.elt[A].get(lr.ON)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}},zr.prototype.toString=function(){var A=new en;return null!==this.elt[0]&&(A.append("A:"),A.append(this.elt[0].toString())),null!==this.elt[1]&&(A.append(" B:"),A.append(this.elt[1].toString())),A.toString()},zr.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var A=arguments[0];return this.elt[A].isArea()}},zr.prototype.isAnyNull=function(A){return this.elt[A].isAnyNull()},zr.prototype.setLocation=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];this.elt[A].setLocation(lr.ON,t)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}},zr.prototype.isEqualOnSide=function(A,t){return this.elt[0].isEqualOnSide(A.elt[0],t)&&this.elt[1].isEqualOnSide(A.elt[1],t)},zr.prototype.allPositionsEqual=function(A,t){return this.elt[A].allPositionsEqual(t)},zr.prototype.toLine=function(A){this.elt[A].isArea()&&(this.elt[A]=new br(this.elt[A].location[0]))},zr.prototype.interfaces_=function(){return[]},zr.prototype.getClass=function(){return zr},zr.toLineLabel=function(A){for(var t=new zr($t.NONE),n=0;n<2;n++)t.setLocation(n,A.getLocation(n));return t};var xr=function(){this.an=null,this.vn=-1,this.ln=new Zn,this.wn=new Zn,this.Pn=new zr($t.NONE),this.gn=null,this.Cn=null,this.Lt=null,this.Tt=new Zn,this.Dn=null;var A=arguments[0],t=arguments[1];this.Dn=t,this.computePoints(A),this.computeRing()};xr.prototype.computeRing=function(){if(null!==this.gn)return null;for(var A=new Array(this.wn.size()).fill(null),t=0;t<this.wn.size();t++)A[t]=this.wn.get(t);this.gn=this.Dn.createLinearRing(A),this.Cn=En.isCCW(this.gn.getCoordinates())},xr.prototype.isIsolated=function(){return 1===this.Pn.getGeometryCount()},xr.prototype.computePoints=function(A){this.an=A;var t=A,n=!0;do{if(null===t)throw new Dr("Found null DirectedEdge");if(t.getEdgeRing()===this)throw new Dr("Directed Edge visited twice during ring-building at "+t.getCoordinate());this.ln.add(t);var i=t.getLabel();mn.isTrue(i.isArea()),this.mergeLabel(i),this.addPoints(t.getEdge(),t.isForward(),n),n=!1,this.setEdgeRing(t,this),t=this.getNext(t)}while(t!==this.an)},xr.prototype.getLinearRing=function(){return this.gn},xr.prototype.getCoordinate=function(A){return this.wn.get(A)},xr.prototype.computeMaxNodeDegree=function(){this.vn=0;var A=this.an;do{var t=A.getNode().getEdges().getOutgoingDegree(this);t>this.vn&&(this.vn=t),A=this.getNext(A)}while(A!==this.an);this.vn*=2},xr.prototype.addPoints=function(A,t,n){var i=A.getCoordinates();if(t){var r=1;n&&(r=0);for(var e=r;e<i.length;e++)this.wn.add(i[e])}else{var s=i.length-2;n&&(s=i.length-1);for(var u=s;u>=0;u--)this.wn.add(i[u])}},xr.prototype.isHole=function(){return this.Cn},xr.prototype.setInResult=function(){var A=this.an;do{A.getEdge().setInResult(!0),A=A.getNext()}while(A!==this.an)},xr.prototype.containsPoint=function(A){var t=this.getLinearRing();if(!t.getEnvelopeInternal().contains(A))return!1;if(!En.isPointInRing(A,t.getCoordinates()))return!1;for(var n=this.Tt.iterator();n.hasNext();)if(n.next().containsPoint(A))return!1;return!0},xr.prototype.addHole=function(A){this.Tt.add(A)},xr.prototype.isShell=function(){return null===this.Lt},xr.prototype.getLabel=function(){return this.Pn},xr.prototype.getEdges=function(){return this.ln},xr.prototype.getMaxNodeDegree=function(){return this.vn<0&&this.computeMaxNodeDegree(),this.vn},xr.prototype.getShell=function(){return this.Lt},xr.prototype.mergeLabel=function(){if(1===arguments.length){var A=arguments[0];this.mergeLabel(A,0),this.mergeLabel(A,1)}else if(2===arguments.length){var t=arguments[0],n=arguments[1],i=t.getLocation(n,lr.RIGHT);if(i===$t.NONE)return null;if(this.Pn.getLocation(n)===$t.NONE)return this.Pn.setLocation(n,i),null}},xr.prototype.setShell=function(A){this.Lt=A,null!==A&&A.addHole(this)},xr.prototype.toPolygon=function(A){for(var t=new Array(this.Tt.size()).fill(null),n=0;n<this.Tt.size();n++)t[n]=this.Tt.get(n).getLinearRing();return A.createPolygon(this.getLinearRing(),t)},xr.prototype.interfaces_=function(){return[]},xr.prototype.getClass=function(){return xr};var dr=function(A){function t(){var t=arguments[0],n=arguments[1];A.call(this,t,n)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.setEdgeRing=function(A,t){A.setMinEdgeRing(t)},t.prototype.getNext=function(A){return A.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xr),yr=function(A){function t(){var t=arguments[0],n=arguments[1];A.call(this,t,n)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.buildMinimalRings=function(){var A=new Zn,t=this.an;do{if(null===t.getMinEdgeRing()){var n=new dr(t,this.Dn);A.add(n)}t=t.getNext()}while(t!==this.an);return A},t.prototype.setEdgeRing=function(A,t){A.setEdgeRing(t)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var A=this.an;do{A.getNode().getEdges().linkMinimalDirectedEdges(this),A=A.getNext()}while(A!==this.an)},t.prototype.getNext=function(A){return A.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xr),mr=function(){if(this.Pn=null,this.In=!1,this.Mn=!1,this.bn=!1,this.zn=!1,0===arguments.length);else if(1===arguments.length){var A=arguments[0];this.Pn=A}};mr.prototype.setVisited=function(A){this.zn=A},mr.prototype.setInResult=function(A){this.In=A},mr.prototype.isCovered=function(){return this.Mn},mr.prototype.isCoveredSet=function(){return this.bn},mr.prototype.setLabel=function(A){this.Pn=A},mr.prototype.getLabel=function(){return this.Pn},mr.prototype.setCovered=function(A){this.Mn=A,this.bn=!0},mr.prototype.updateIM=function(A){mn.isTrue(this.Pn.getGeometryCount()>=2,"found partial label"),this.computeIM(A)},mr.prototype.isInResult=function(){return this.In},mr.prototype.isVisited=function(){return this.zn},mr.prototype.interfaces_=function(){return[]},mr.prototype.getClass=function(){return mr};var pr=function(A){function t(){A.call(this),this.xn=null,this.ln=null;var t=arguments[0],n=arguments[1];this.xn=t,this.ln=n,this.Pn=new zr(0,$t.NONE)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var A=this.getEdges().getEdges().iterator();A.hasNext();)if(A.next().getEdge().isInResult())return!0;return!1},t.prototype.isIsolated=function(){return 1===this.Pn.getGeometryCount()},t.prototype.getCoordinate=function(){return this.xn},t.prototype.print=function(A){A.println("node "+this.xn+" lbl: "+this.Pn)},t.prototype.computeIM=function(A){},t.prototype.computeMergedLocation=function(A,t){var n=$t.NONE;if(n=this.Pn.getLocation(t),!A.isNull(t)){var i=A.getLocation(t);n!==$t.BOUNDARY&&(n=i)}return n},t.prototype.setLabel=function(){if(2!==arguments.length)return A.prototype.setLabel.apply(this,arguments);var t=arguments[0],n=arguments[1];null===this.Pn?this.Pn=new zr(t,n):this.Pn.setLocation(t,n)},t.prototype.getEdges=function(){return this.ln},t.prototype.mergeLabel=function(){var A=this;if(arguments[0]instanceof t){var n=arguments[0];this.mergeLabel(n.Pn)}else if(arguments[0]instanceof zr)for(var i=arguments[0],r=0;r<2;r++){var e=A.computeMergedLocation(i,r),s=A.Pn.getLocation(r);s===$t.NONE&&A.Pn.setLocation(r,e)}},t.prototype.add=function(A){this.ln.insert(A),A.setNode(this)},t.prototype.setLabelBoundary=function(A){if(null===this.Pn)return null;var t=$t.NONE;null!==this.Pn&&(t=this.Pn.getLocation(A));var n=null;if(t===$t.BOUNDARY)n=$t.INTERIOR;else n=$t.BOUNDARY;this.Pn.setLocation(A,n)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(mr),Lr=function(){this.nodeMap=new wi,this.nodeFact=null;var A=arguments[0];this.nodeFact=A};Lr.prototype.find=function(A){return this.nodeMap.get(A)},Lr.prototype.addNode=function(){if(arguments[0]instanceof _t){var A=arguments[0],t=this.nodeMap.get(A);return null===t&&(t=this.nodeFact.createNode(A),this.nodeMap.put(A,t)),t}if(arguments[0]instanceof pr){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return null===i?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}},Lr.prototype.print=function(A){for(var t=this.iterator();t.hasNext();)t.next().print(A)},Lr.prototype.iterator=function(){return this.nodeMap.values().iterator()},Lr.prototype.values=function(){return this.nodeMap.values()},Lr.prototype.getBoundaryNodes=function(A){for(var t=new Zn,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(A)===$t.BOUNDARY&&t.add(i)}return t},Lr.prototype.add=function(A){var t=A.getCoordinate();this.addNode(t).add(A)},Lr.prototype.interfaces_=function(){return[]},Lr.prototype.getClass=function(){return Lr};var Tr=function(){},Or={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Tr.prototype.interfaces_=function(){return[]},Tr.prototype.getClass=function(){return Tr},Tr.isNorthern=function(A){return A===Tr.NE||A===Tr.NW},Tr.isOpposite=function(A,t){return A!==t&&2==(A-t+4)%4},Tr.commonHalfPlane=function(A,t){if(A===t)return A;if(2==(A-t+4)%4)return-1;var n=A<t?A:t;return 0===n&&3===(A>t?A:t)?3:n},Tr.isInHalfPlane=function(A,t){return t===Tr.SE?A===Tr.SE||A===Tr.SW:A===t||A===t+1},Tr.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var A=arguments[0],t=arguments[1];if(0===A&&0===t)throw new Gt("Cannot compute the quadrant for point ( "+A+", "+t+" )");return A>=0?t>=0?Tr.NE:Tr.SE:t>=0?Tr.NW:Tr.SW}if(arguments[0]instanceof _t&&arguments[1]instanceof _t){var n=arguments[0],i=arguments[1];if(i.x===n.x&&i.y===n.y)throw new Gt("Cannot compute the quadrant for two identical points "+n);return i.x>=n.x?i.y>=n.y?Tr.NE:Tr.SE:i.y>=n.y?Tr.NW:Tr.SW}},Or.NE.get=function(){return 0},Or.NW.get=function(){return 1},Or.SW.get=function(){return 2},Or.SE.get=function(){return 3},Object.defineProperties(Tr,Or);var Fr=function(){if(this.dn=null,this.Pn=null,this.yn=null,this.mn=null,this.pn=null,this.Ln=null,this.Tn=null,this.On=null,1===arguments.length){var A=arguments[0];this.dn=A}else if(3===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2],r=null;this.dn=t,this.init(n,i),this.Pn=r}else if(4===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2],o=arguments[3];this.dn=e,this.init(s,u),this.Pn=o}};Fr.prototype.compareDirection=function(A){return this.Ln===A.Ln&&this.Tn===A.Tn?0:this.On>A.On?1:this.On<A.On?-1:En.computeOrientation(A.mn,A.pn,this.pn)},Fr.prototype.getDy=function(){return this.Tn},Fr.prototype.getCoordinate=function(){return this.mn},Fr.prototype.setNode=function(A){this.yn=A},Fr.prototype.print=function(A){var t=Math.atan2(this.Tn,this.Ln),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);A.print("  "+r+": "+this.mn+" - "+this.pn+" "+this.On+":"+t+"   "+this.Pn)},Fr.prototype.compareTo=function(A){return this.compareDirection(A)},Fr.prototype.getDirectedCoordinate=function(){return this.pn},Fr.prototype.getDx=function(){return this.Ln},Fr.prototype.getLabel=function(){return this.Pn},Fr.prototype.getEdge=function(){return this.dn},Fr.prototype.getQuadrant=function(){return this.On},Fr.prototype.getNode=function(){return this.yn},Fr.prototype.toString=function(){var A=Math.atan2(this.Tn,this.Ln),t=this.getClass().getName(),n=t.lastIndexOf(".");return"  "+t.substring(n+1)+": "+this.mn+" - "+this.pn+" "+this.On+":"+A+"   "+this.Pn},Fr.prototype.computeLabel=function(A){},Fr.prototype.init=function(A,t){this.mn=A,this.pn=t,this.Ln=t.x-A.x,this.Tn=t.y-A.y,this.On=Tr.quadrant(this.Ln,this.Tn),mn.isTrue(!(0===this.Ln&&0===this.Tn),"EdgeEnd with identical endpoints found")},Fr.prototype.interfaces_=function(){return[Wt]},Fr.prototype.getClass=function(){return Fr};var Er=function(A){function t(){var t=arguments[0],n=arguments[1];if(A.call(this,t),this.Fn=null,this.In=!1,this.zn=!1,this.En=null,this.Un=null,this.Nn=null,this.jn=null,this.Qn=null,this.Sn=[0,-999,-999],this.Fn=n,n)this.init(t.getCoordinate(0),t.getCoordinate(1));else{var i=t.getNumPoints()-1;this.init(t.getCoordinate(i),t.getCoordinate(i-1))}this.computeDirectedLabel()}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.getNextMin=function(){return this.Nn},t.prototype.getDepth=function(A){return this.Sn[A]},t.prototype.setVisited=function(A){this.zn=A},t.prototype.computeDirectedLabel=function(){this.Pn=new zr(this.dn.getLabel()),this.Fn||this.Pn.flip()},t.prototype.getNext=function(){return this.Un},t.prototype.setDepth=function(A,t){if(-999!==this.Sn[A]&&this.Sn[A]!==t)throw new Dr("assigned depths do not match",this.getCoordinate());this.Sn[A]=t},t.prototype.isInteriorAreaEdge=function(){for(var A=!0,t=0;t<2;t++)this.Pn.isArea(t)&&this.Pn.getLocation(t,lr.LEFT)===$t.INTERIOR&&this.Pn.getLocation(t,lr.RIGHT)===$t.INTERIOR||(A=!1);return A},t.prototype.setNextMin=function(A){this.Nn=A},t.prototype.print=function(t){A.prototype.print.call(this,t),t.print(" "+this.Sn[lr.LEFT]+"/"+this.Sn[lr.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this.In&&t.print(" inResult")},t.prototype.setMinEdgeRing=function(A){this.Qn=A},t.prototype.isLineEdge=function(){var A=this.Pn.isLine(0)||this.Pn.isLine(1),t=!this.Pn.isArea(0)||this.Pn.allPositionsEqual(0,$t.EXTERIOR),n=!this.Pn.isArea(1)||this.Pn.allPositionsEqual(1,$t.EXTERIOR);return A&&t&&n},t.prototype.setEdgeRing=function(A){this.jn=A},t.prototype.getMinEdgeRing=function(){return this.Qn},t.prototype.getDepthDelta=function(){var A=this.dn.getDepthDelta();return this.Fn||(A=-A),A},t.prototype.setInResult=function(A){this.In=A},t.prototype.getSym=function(){return this.En},t.prototype.isForward=function(){return this.Fn},t.prototype.getEdge=function(){return this.dn},t.prototype.printEdge=function(A){this.print(A),A.print(" "),this.Fn?this.dn.print(A):this.dn.printReverse(A)},t.prototype.setSym=function(A){this.En=A},t.prototype.setVisitedEdge=function(A){this.setVisited(A),this.En.setVisited(A)},t.prototype.setEdgeDepths=function(A,t){var n=this.getEdge().getDepthDelta();this.Fn||(n=-n);var i=1;A===lr.LEFT&&(i=-1);var r=lr.opposite(A),e=t+n*i;this.setDepth(A,t),this.setDepth(r,e)},t.prototype.getEdgeRing=function(){return this.jn},t.prototype.isInResult=function(){return this.In},t.prototype.setNext=function(A){this.Un=A},t.prototype.isVisited=function(){return this.zn},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(A,t){return A===$t.EXTERIOR&&t===$t.INTERIOR?1:A===$t.INTERIOR&&t===$t.EXTERIOR?-1:0},t}(Fr),Ur=function(){};Ur.prototype.createNode=function(A){return new pr(A,null)},Ur.prototype.interfaces_=function(){return[]},Ur.prototype.getClass=function(){return Ur};var Nr=function(){if(this.ln=new Zn,this.un=null,this.Bn=new Zn,0===arguments.length)this.un=new Lr(new Ur);else if(1===arguments.length){var A=arguments[0];this.un=new Lr(A)}};Nr.prototype.printEdges=function(A){A.println("Edges:");for(var t=0;t<this.ln.size();t++){A.println("edge "+t+":");var n=this.ln.get(t);n.print(A),n.eiList.print(A)}},Nr.prototype.find=function(A){return this.un.find(A)},Nr.prototype.addNode=function(){if(arguments[0]instanceof pr){var A=arguments[0];return this.un.addNode(A)}if(arguments[0]instanceof _t){var t=arguments[0];return this.un.addNode(t)}},Nr.prototype.getNodeIterator=function(){return this.un.iterator()},Nr.prototype.linkResultDirectedEdges=function(){for(var A=this.un.iterator();A.hasNext();)A.next().getEdges().linkResultDirectedEdges()},Nr.prototype.debugPrintln=function(A){Pn.out.println(A)},Nr.prototype.isBoundaryNode=function(A,t){var n=this.un.find(t);if(null===n)return!1;var i=n.getLabel();return null!==i&&i.getLocation(A)===$t.BOUNDARY},Nr.prototype.linkAllDirectedEdges=function(){for(var A=this.un.iterator();A.hasNext();)A.next().getEdges().linkAllDirectedEdges()},Nr.prototype.matchInSameDirection=function(A,t,n,i){return!!A.equals(n)&&En.computeOrientation(A,t,i)===En.COLLINEAR&&Tr.quadrant(A,t)===Tr.quadrant(n,i)},Nr.prototype.getEdgeEnds=function(){return this.Bn},Nr.prototype.debugPrint=function(A){Pn.out.print(A)},Nr.prototype.getEdgeIterator=function(){return this.ln.iterator()},Nr.prototype.findEdgeInSameDirection=function(A,t){for(var n=0;n<this.ln.size();n++){var i=this.ln.get(n),r=i.getCoordinates();if(this.matchInSameDirection(A,t,r[0],r[1]))return i;if(this.matchInSameDirection(A,t,r[r.length-1],r[r.length-2]))return i}return null},Nr.prototype.insertEdge=function(A){this.ln.add(A)},Nr.prototype.findEdgeEnd=function(A){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===A)return n}return null},Nr.prototype.addEdges=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next();this.ln.add(n);var i=new Er(n,!0),r=new Er(n,!1);i.setSym(r),r.setSym(i),this.add(i),this.add(r)}},Nr.prototype.add=function(A){this.un.add(A),this.Bn.add(A)},Nr.prototype.getNodes=function(){return this.un.values()},Nr.prototype.findEdge=function(A,t){for(var n=0;n<this.ln.size();n++){var i=this.ln.get(n),r=i.getCoordinates();if(A.equals(r[0])&&t.equals(r[1]))return i}return null},Nr.prototype.interfaces_=function(){return[]},Nr.prototype.getClass=function(){return Nr},Nr.linkResultDirectedEdges=function(A){for(var t=A.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()};var jr=function(){this.Dn=null,this.Rn=new Zn;var A=arguments[0];this.Dn=A};jr.prototype.sortShellsAndHoles=function(A,t,n){for(var i=A.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):t.add(r)}},jr.prototype.computePolygons=function(A){for(var t=new Zn,n=A.iterator();n.hasNext();){var i=n.next().toPolygon(this.Dn);t.add(i)}return t},jr.prototype.placeFreeHoles=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next();if(null===i.getShell()){var r=this.findEdgeRingContaining(i,A);if(null===r)throw new Dr("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(r)}}},jr.prototype.buildMinimalEdgeRings=function(A,t,n){for(var i=new Zn,r=A.iterator();r.hasNext();){var e=r.next();if(e.getMaxNodeDegree()>2){e.linkDirectedEdgesForMinimalEdgeRings();var s=e.buildMinimalRings(),u=this.findShell(s);null!==u?(this.placePolygonHoles(u,s),t.add(u)):n.addAll(s)}else i.add(e)}return i},jr.prototype.containsPoint=function(A){for(var t=this.Rn.iterator();t.hasNext();)if(t.next().containsPoint(A))return!0;return!1},jr.prototype.buildMaximalEdgeRings=function(A){for(var t=new Zn,n=A.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()){var r=new yr(i,this.Dn);t.add(r),r.setInResult()}}return t},jr.prototype.placePolygonHoles=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(A)}},jr.prototype.getPolygons=function(){return this.computePolygons(this.Rn)},jr.prototype.findEdgeRingContaining=function(A,t){for(var n=A.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),e=null,s=null,u=t.iterator();u.hasNext();){var o=u.next(),h=o.getLinearRing(),f=h.getEnvelopeInternal();null!==e&&(s=e.getLinearRing().getEnvelopeInternal());var c=!1;f.contains(i)&&En.isPointInRing(r,h.getCoordinates())&&(c=!0),c&&(null===e||s.contains(f))&&(e=o)}return e},jr.prototype.findShell=function(A){for(var t=0,n=null,i=A.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,t++)}return mn.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n},jr.prototype.add=function(){if(1===arguments.length){var A=arguments[0];this.add(A.getEdgeEnds(),A.getNodes())}else if(2===arguments.length){var t=arguments[0],n=arguments[1];Nr.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(t),r=new Zn,e=this.buildMinimalEdgeRings(i,this.Rn,r);this.sortShellsAndHoles(e,this.Rn,r),this.placeFreeHoles(this.Rn,r)}},jr.prototype.interfaces_=function(){return[]},jr.prototype.getClass=function(){return jr};var Qr=function(){};Qr.prototype.getBounds=function(){},Qr.prototype.interfaces_=function(){return[]},Qr.prototype.getClass=function(){return Qr};var Sr=function(){this.kn=null,this.Gn=null;var A=arguments[0],t=arguments[1];this.kn=A,this.Gn=t};Sr.prototype.getItem=function(){return this.Gn},Sr.prototype.getBounds=function(){return this.kn},Sr.prototype.interfaces_=function(){return[Qr,Ht]},Sr.prototype.getClass=function(){return Sr};var Br=function(){this.Yn=null,this.qn=null,this.Yn=0,this.qn=new Zn,this.qn.add(null)};Br.prototype.poll=function(){if(this.isEmpty())return null;var A=this.qn.get(1);return this.qn.set(1,this.qn.get(this.Yn)),this.Yn-=1,this.reorder(1),A},Br.prototype.size=function(){return this.Yn},Br.prototype.reorder=function(A){for(var t=null,n=this.qn.get(A);2*A<=this.Yn&&((t=2*A)!==this.Yn&&this.qn.get(t+1).compareTo(this.qn.get(t))<0&&t++,this.qn.get(t).compareTo(n)<0);A=t)this.qn.set(A,this.qn.get(t));this.qn.set(A,n)},Br.prototype.clear=function(){this.Yn=0,this.qn.clear()},Br.prototype.isEmpty=function(){return 0===this.Yn},Br.prototype.add=function(A){this.qn.add(null),this.Yn+=1;var t=this.Yn;for(this.qn.set(0,A);A.compareTo(this.qn.get(Math.trunc(t/2)))<0;t/=2)this.qn.set(t,this.qn.get(Math.trunc(t/2)));this.qn.set(t,A)},Br.prototype.interfaces_=function(){return[]},Br.prototype.getClass=function(){return Br};var Rr=function(){};Rr.prototype.visitItem=function(A){},Rr.prototype.interfaces_=function(){return[]},Rr.prototype.getClass=function(){return Rr};var kr=function(){};kr.prototype.insert=function(A,t){},kr.prototype.remove=function(A,t){},kr.prototype.query=function(){},kr.prototype.interfaces_=function(){return[]},kr.prototype.getClass=function(){return kr};var Gr=function(){if(this.Wn=new Zn,this.kn=null,this.Vn=null,0===arguments.length);else if(1===arguments.length){var A=arguments[0];this.Vn=A}},Yr={serialVersionUID:{configurable:!0}};Gr.prototype.getLevel=function(){return this.Vn},Gr.prototype.size=function(){return this.Wn.size()},Gr.prototype.getChildBoundables=function(){return this.Wn},Gr.prototype.addChildBoundable=function(A){mn.isTrue(null===this.kn),this.Wn.add(A)},Gr.prototype.isEmpty=function(){return this.Wn.isEmpty()},Gr.prototype.getBounds=function(){return null===this.kn&&(this.kn=this.computeBounds()),this.kn},Gr.prototype.interfaces_=function(){return[Qr,Ht]},Gr.prototype.getClass=function(){return Gr},Yr.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Gr,Yr);var qr=function(){};qr.reverseOrder=function(){return{compare:function(A,t){return t.compareTo(A)}}},qr.min=function(A){return qr.sort(A),A.get(0)},qr.sort=function(A,t){var n=A.toArray();t?Ii.sort(n,t):Ii.sort(n);for(var i=A.iterator(),r=0,e=n.length;r<e;r++)i.next(),i.set(n[r])},qr.singletonList=function(A){var t=new Zn;return t.add(A),t};var Wr=function(){this.Kn=null,this.Hn=null,this._n=null,this.Jn=null;var A=arguments[0],t=arguments[1],n=arguments[2];this.Kn=A,this.Hn=t,this.Jn=n,this._n=this.distance()};Wr.prototype.expandToQueue=function(A,t){var n=Wr.isComposite(this.Kn),i=Wr.isComposite(this.Hn);if(n&&i)return Wr.area(this.Kn)>Wr.area(this.Hn)?(this.expand(this.Kn,this.Hn,A,t),null):(this.expand(this.Hn,this.Kn,A,t),null);if(n)return this.expand(this.Kn,this.Hn,A,t),null;if(i)return this.expand(this.Hn,this.Kn,A,t),null;throw new Gt("neither boundable is composite")},Wr.prototype.isLeaves=function(){return!(Wr.isComposite(this.Kn)||Wr.isComposite(this.Hn))},Wr.prototype.compareTo=function(A){return this._n<A._n?-1:this._n>A._n?1:0},Wr.prototype.expand=function(A,t,n,i){for(var r=A.getChildBoundables().iterator();r.hasNext();){var e=r.next(),s=new Wr(e,t,this.Jn);s.getDistance()<i&&n.add(s)}},Wr.prototype.getBoundable=function(A){return 0===A?this.Kn:this.Hn},Wr.prototype.getDistance=function(){return this._n},Wr.prototype.distance=function(){return this.isLeaves()?this.Jn.distance(this.Kn,this.Hn):this.Kn.getBounds().distance(this.Hn.getBounds())},Wr.prototype.interfaces_=function(){return[Wt]},Wr.prototype.getClass=function(){return Wr},Wr.area=function(A){return A.getBounds().getArea()},Wr.isComposite=function(A){return A instanceof Gr};var Vr=function A(){if(this.Zn=null,this.Xn=!1,this.$n=new Zn,this.Ai=null,0===arguments.length){var t=A.DEFAULT_NODE_CAPACITY;this.Ai=t}else if(1===arguments.length){var n=arguments[0];mn.isTrue(n>1,"Node capacity must be greater than 1"),this.Ai=n}},Kr={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Vr.prototype.getNodeCapacity=function(){return this.Ai},Vr.prototype.lastNode=function(A){return A.get(A.size()-1)},Vr.prototype.size=function(){var A=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this.Zn));if(1===arguments.length){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof Gr?n+=A.size(r):r instanceof Sr&&(n+=1)}return n}},Vr.prototype.removeItem=function(A,t){for(var n=null,i=A.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof Sr&&r.getItem()===t&&(n=r)}return null!==n&&(A.getChildBoundables().remove(n),!0)},Vr.prototype.itemsTree=function(){var A=this;if(0===arguments.length){this.build();var t=this.itemsTree(this.Zn);return null===t?new Zn:t}if(1===arguments.length){for(var n=arguments[0],i=new Zn,r=n.getChildBoundables().iterator();r.hasNext();){var e=r.next();if(e instanceof Gr){var s=A.itemsTree(e);null!==s&&i.add(s)}else e instanceof Sr?i.add(e.getItem()):mn.shouldNeverReachHere()}return i.size()<=0?null:i}},Vr.prototype.insert=function(A,t){mn.isTrue(!this.Xn,"Cannot insert items into an STR packed R-tree after it has been built."),this.$n.add(new Sr(A,t))},Vr.prototype.boundablesAtLevel=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=new Zn;return this.boundablesAtLevel(t,this.Zn,n),n}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];if(mn.isTrue(i>-2),r.getLevel()===i)return e.add(r),null;for(var s=r.getChildBoundables().iterator();s.hasNext();){var u=s.next();u instanceof Gr?A.boundablesAtLevel(i,u,e):(mn.isTrue(u instanceof Sr),-1===i&&e.add(u))}return null}},Vr.prototype.query=function(){var A=this;if(1===arguments.length){var t=arguments[0];this.build();var n=new Zn;return this.isEmpty()||this.getIntersectsOp().intersects(this.Zn.getBounds(),t)&&this.query(t,this.Zn,n),n}if(2===arguments.length){var i=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this.Zn.getBounds(),i)&&this.query(i,this.Zn,r)}else if(3===arguments.length)if(tn(arguments[2],Rr)&&arguments[0]instanceof Object&&arguments[1]instanceof Gr)for(var e=arguments[0],s=arguments[1],u=arguments[2],o=s.getChildBoundables(),h=0;h<o.size();h++){var f=o.get(h);A.getIntersectsOp().intersects(f.getBounds(),e)&&(f instanceof Gr?A.query(e,f,u):f instanceof Sr?u.visitItem(f.getItem()):mn.shouldNeverReachHere())}else if(tn(arguments[2],_n)&&arguments[0]instanceof Object&&arguments[1]instanceof Gr)for(var c=arguments[0],a=arguments[1],v=arguments[2],l=a.getChildBoundables(),w=0;w<l.size();w++){var P=l.get(w);A.getIntersectsOp().intersects(P.getBounds(),c)&&(P instanceof Gr?A.query(c,P,v):P instanceof Sr?v.add(P.getItem()):mn.shouldNeverReachHere())}},Vr.prototype.build=function(){if(this.Xn)return null;this.Zn=this.$n.isEmpty()?this.createNode(0):this.createHigherLevels(this.$n,-1),this.$n=null,this.Xn=!0},Vr.prototype.getRoot=function(){return this.build(),this.Zn},Vr.prototype.remove=function(){var A=this;if(2===arguments.length){var t=arguments[0],n=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this.Zn.getBounds(),t)&&this.remove(t,this.Zn,n)}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=this.removeItem(r,e);if(s)return!0;for(var u=null,o=r.getChildBoundables().iterator();o.hasNext();){var h=o.next();if(A.getIntersectsOp().intersects(h.getBounds(),i)&&h instanceof Gr&&(s=A.remove(i,h,e))){u=h;break}}return null!==u&&u.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(u),s}},Vr.prototype.createHigherLevels=function(A,t){mn.isTrue(!A.isEmpty());var n=this.createParentBoundables(A,t+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,t+1)},Vr.prototype.depth=function(){var A=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this.Zn));if(1===arguments.length){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof Gr){var e=A.depth(r);e>n&&(n=e)}}return n+1}},Vr.prototype.createParentBoundables=function(A,t){mn.isTrue(!A.isEmpty());var n=new Zn;n.add(this.createNode(t));var i=new Zn(A);qr.sort(i,this.getComparator());for(var r=i.iterator();r.hasNext();){var e=r.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(t)),this.lastNode(n).addChildBoundable(e)}return n},Vr.prototype.isEmpty=function(){return this.Xn?this.Zn.isEmpty():this.$n.isEmpty()},Vr.prototype.interfaces_=function(){return[Ht]},Vr.prototype.getClass=function(){return Vr},Vr.compareDoubles=function(A,t){return A>t?1:A<t?-1:0},Kr.IntersectsOp.get=function(){return Hr},Kr.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},Kr.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(Vr,Kr);var Hr=function(){},_r=function(){};_r.prototype.distance=function(A,t){},_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r};var Jr=function(A){function t(n){A.call(this,n=n||t.DEFAULT_NODE_CAPACITY)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(A,t){mn.isTrue(A.length>0);for(var n=new Zn,i=0;i<A.length;i++)n.addAll(this.createParentBoundablesFromVerticalSlice(A[i],t));return n},t.prototype.createNode=function(A){return new Zr(A)},t.prototype.size=function(){return 0===arguments.length?A.prototype.size.call(this):A.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(2!==arguments.length)return A.prototype.insert.apply(this,arguments);var t=arguments[0],n=arguments[1];if(t.isNull())return null;A.prototype.insert.call(this,t,n)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(A,t){for(var n=Math.trunc(Math.ceil(A.size()/t)),i=new Array(t).fill(null),r=A.iterator(),e=0;e<t;e++){i[e]=new Zn;for(var s=0;r.hasNext()&&s<n;){var u=r.next();i[e].add(u),s++}}return i},t.prototype.query=function(){if(1===arguments.length){var t=arguments[0];return A.prototype.query.call(this,t)}if(2===arguments.length){var n=arguments[0],i=arguments[1];A.prototype.query.call(this,n,i)}else if(3===arguments.length)if(tn(arguments[2],Rr)&&arguments[0]instanceof Object&&arguments[1]instanceof Gr){var r=arguments[0],e=arguments[1],s=arguments[2];A.prototype.query.call(this,r,e,s)}else if(tn(arguments[2],_n)&&arguments[0]instanceof Object&&arguments[1]instanceof Gr){var u=arguments[0],o=arguments[1],h=arguments[2];A.prototype.query.call(this,u,o,h)}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(t,n){return A.prototype.createParentBoundables.call(this,t,n)},t.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return A.prototype.remove.call(this,t,n)}return A.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return 0===arguments.length?A.prototype.depth.call(this):A.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(A,n){mn.isTrue(!A.isEmpty());var i=Math.trunc(Math.ceil(A.size()/this.getNodeCapacity())),r=new Zn(A);qr.sort(r,t.xComparator);var e=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(i))));return this.createParentBoundablesFromVerticalSlices(e,n)},t.prototype.nearestNeighbour=function(){if(1===arguments.length){if(tn(arguments[0],_r)){var A=arguments[0],n=new Wr(this.getRoot(),this.getRoot(),A);return this.nearestNeighbour(n)}if(arguments[0]instanceof Wr){var i=arguments[0];return this.nearestNeighbour(i,Yt.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof t&&tn(arguments[1],_r)){var r=arguments[0],e=arguments[1],s=new Wr(this.getRoot(),r.getRoot(),e);return this.nearestNeighbour(s)}if(arguments[0]instanceof Wr&&"number"==typeof arguments[1]){var u=arguments[0],o=arguments[1],h=o,f=null,c=new Br;for(c.add(u);!c.isEmpty()&&h>0;){var a=c.poll(),v=a.getDistance();if(v>=h)break;a.isLeaves()?(h=v,f=a):a.expandToQueue(c,h)}return[f.getBoundable(0).getItem(),f.getBoundable(1).getItem()]}}else if(3===arguments.length){var l=arguments[0],w=arguments[1],P=arguments[2],g=new Sr(l,w),C=new Wr(this.getRoot(),g,P);return this.nearestNeighbour(C)[0]}},t.prototype.interfaces_=function(){return[kr,Ht]},t.prototype.getClass=function(){return t},t.centreX=function(A){return t.avg(A.getMinX(),A.getMaxX())},t.avg=function(A,t){return(A+t)/2},t.centreY=function(A){return t.avg(A.getMinY(),A.getMaxY())},n.STRtreeNode.get=function(){return Zr},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[Kt]},compare:function(n,i){return A.compareDoubles(t.centreX(n.getBounds()),t.centreX(i.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[Kt]},compare:function(n,i){return A.compareDoubles(t.centreY(n.getBounds()),t.centreY(i.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[A.IntersectsOp]},intersects:function(A,t){return A.intersects(t)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,n),t}(Vr),Zr=function(A){function t(){var t=arguments[0];A.call(this,t)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.computeBounds=function(){for(var A=null,t=this.getChildBoundables().iterator();t.hasNext();){var n=t.next();null===A?A=new Cn(n.getBounds()):A.expandToInclude(n.getBounds())}return A},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Gr),Xr=function(){};Xr.prototype.interfaces_=function(){return[]},Xr.prototype.getClass=function(){return Xr},Xr.relativeSign=function(A,t){return A<t?-1:A>t?1:0},Xr.compare=function(A,t,n){if(t.equals2D(n))return 0;var i=Xr.relativeSign(t.x,n.x),r=Xr.relativeSign(t.y,n.y);switch(A){case 0:return Xr.compareValue(i,r);case 1:return Xr.compareValue(r,i);case 2:return Xr.compareValue(r,-i);case 3:return Xr.compareValue(-i,r);case 4:return Xr.compareValue(-i,-r);case 5:return Xr.compareValue(-r,-i);case 6:return Xr.compareValue(-r,i);case 7:return Xr.compareValue(i,-r)}return mn.shouldNeverReachHere("invalid octant value"),0},Xr.compareValue=function(A,t){return A<0?-1:A>0?1:t<0?-1:t>0?1:0};var $r=function(){this.ti=null,this.coord=null,this.segmentIndex=null,this.ni=null,this.ii=null;var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.ti=A,this.coord=new _t(t),this.segmentIndex=n,this.ni=i,this.ii=!t.equals2D(A.getCoordinate(n))};$r.prototype.getCoordinate=function(){return this.coord},$r.prototype.print=function(A){A.print(this.coord),A.print(" seg # = "+this.segmentIndex)},$r.prototype.compareTo=function(A){var t=A;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:Xr.compare(this.ni,this.coord,t.coord)},$r.prototype.isEndPoint=function(A){return 0===this.segmentIndex&&!this.ii||this.segmentIndex===A},$r.prototype.isInterior=function(){return this.ii},$r.prototype.interfaces_=function(){return[Wt]},$r.prototype.getClass=function(){return $r};var Ae=function(){this.ri=new wi,this.dn=null;var A=arguments[0];this.dn=A};Ae.prototype.getSplitCoordinates=function(){var A=new $n;this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next();this.addEdgeCoordinates(n,i,A),n=i}return A.toCoordinateArray()},Ae.prototype.addCollapsedNodes=function(){var A=new Zn;this.findCollapsesFromInsertedNodes(A),this.findCollapsesFromExistingVertices(A);for(var t=A.iterator();t.hasNext();){var n=t.next().intValue();this.add(this.dn.getCoordinate(n),n)}},Ae.prototype.print=function(A){A.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(A)},Ae.prototype.findCollapsesFromExistingVertices=function(A){for(var t=0;t<this.dn.size()-2;t++){var n=this.dn.getCoordinate(t),i=this.dn.getCoordinate(t+2);n.equals2D(i)&&A.add(new sn(t+1))}},Ae.prototype.addEdgeCoordinates=function(A,t,n){var i=this.dn.getCoordinate(t.segmentIndex),r=t.isInterior()||!t.coord.equals2D(i);n.add(new _t(A.coord),!1);for(var e=A.segmentIndex+1;e<=t.segmentIndex;e++)n.add(this.dn.getCoordinate(e));r&&n.add(new _t(t.coord))},Ae.prototype.iterator=function(){return this.ri.values().iterator()},Ae.prototype.addSplitEdges=function(A){this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next(),r=this.createSplitEdge(n,i);A.add(r),n=i}},Ae.prototype.findCollapseIndex=function(A,t,n){if(!A.coord.equals2D(t.coord))return!1;var i=t.segmentIndex-A.segmentIndex;return t.isInterior()||i--,1===i&&(n[0]=A.segmentIndex+1,!0)},Ae.prototype.findCollapsesFromInsertedNodes=function(A){for(var t=new Array(1).fill(null),n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();this.findCollapseIndex(i,r,t)&&A.add(new sn(t[0])),i=r}},Ae.prototype.getEdge=function(){return this.dn},Ae.prototype.addEndpoints=function(){var A=this.dn.size()-1;this.add(this.dn.getCoordinate(0),0),this.add(this.dn.getCoordinate(A),A)},Ae.prototype.createSplitEdge=function(A,t){var n=t.segmentIndex-A.segmentIndex+2,i=this.dn.getCoordinate(t.segmentIndex),r=t.isInterior()||!t.coord.equals2D(i);r||n--;var e=new Array(n).fill(null),s=0;e[s++]=new _t(A.coord);for(var u=A.segmentIndex+1;u<=t.segmentIndex;u++)e[s++]=this.dn.getCoordinate(u);return r&&(e[s]=new _t(t.coord)),new re(e,this.dn.getData())},Ae.prototype.add=function(A,t){var n=new $r(this.dn,A,t,this.dn.getSegmentOctant(t)),i=this.ri.get(n);return null!==i?(mn.isTrue(i.coord.equals2D(A),"Found equal nodes with different coordinates"),i):(this.ri.put(n,n),n)},Ae.prototype.checkSplitEdgesCorrectness=function(A){var t=this.dn.getCoordinates(),n=A.get(0).getCoordinate(0);if(!n.equals2D(t[0]))throw new dn("bad split edge start point at "+n);var i=A.get(A.size()-1).getCoordinates(),r=i[i.length-1];if(!r.equals2D(t[t.length-1]))throw new dn("bad split edge end point at "+r)},Ae.prototype.interfaces_=function(){return[]},Ae.prototype.getClass=function(){return Ae};var te=function(){};te.prototype.interfaces_=function(){return[]},te.prototype.getClass=function(){return te},te.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var A=arguments[0],t=arguments[1];if(0===A&&0===t)throw new Gt("Cannot compute the octant for point ( "+A+", "+t+" )");var n=Math.abs(A),i=Math.abs(t);return A>=0?t>=0?n>=i?0:1:n>=i?7:6:t>=0?n>=i?3:2:n>=i?4:5}if(arguments[0]instanceof _t&&arguments[1]instanceof _t){var r=arguments[0],e=arguments[1],s=e.x-r.x,u=e.y-r.y;if(0===s&&0===u)throw new Gt("Cannot compute the octant for two identical points "+r);return te.octant(s,u)}};var ne=function(){};ne.prototype.getCoordinates=function(){},ne.prototype.size=function(){},ne.prototype.getCoordinate=function(A){},ne.prototype.isClosed=function(){},ne.prototype.setData=function(A){},ne.prototype.getData=function(){},ne.prototype.interfaces_=function(){return[]},ne.prototype.getClass=function(){return ne};var ie=function(){};ie.prototype.addIntersection=function(A,t){},ie.prototype.interfaces_=function(){return[ne]},ie.prototype.getClass=function(){return ie};var re=function(){this.ei=new Ae(this),this.wn=null,this.si=null;var A=arguments[0],t=arguments[1];this.wn=A,this.si=t};re.prototype.getCoordinates=function(){return this.wn},re.prototype.size=function(){return this.wn.length},re.prototype.getCoordinate=function(A){return this.wn[A]},re.prototype.isClosed=function(){return this.wn[0].equals(this.wn[this.wn.length-1])},re.prototype.getSegmentOctant=function(A){return A===this.wn.length-1?-1:this.safeOctant(this.getCoordinate(A),this.getCoordinate(A+1))},re.prototype.setData=function(A){this.si=A},re.prototype.safeOctant=function(A,t){return A.equals2D(t)?0:te.octant(A,t)},re.prototype.getData=function(){return this.si},re.prototype.addIntersection=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];this.addIntersectionNode(A,t)}else if(4===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[3],e=new _t(n.getIntersection(r));this.addIntersection(e,i)}},re.prototype.toString=function(){return xn.toLineString(new Zi(this.wn))},re.prototype.getNodeList=function(){return this.ei},re.prototype.addIntersectionNode=function(A,t){var n=t,i=n+1;i<this.wn.length&&(A.equals2D(this.wn[i])&&(n=i));return this.ei.add(A,n)},re.prototype.addIntersections=function(A,t,n){for(var i=0;i<A.getIntersectionNum();i++)this.addIntersection(A,t,n,i)},re.prototype.interfaces_=function(){return[ie]},re.prototype.getClass=function(){return re},re.getNodedSubstrings=function(){if(1===arguments.length){var A=arguments[0],t=new Zn;return re.getNodedSubstrings(A,t),t}if(2===arguments.length)for(var n=arguments[0],i=arguments[1],r=n.iterator();r.hasNext();){var e=r.next();e.getNodeList().addSplitEdges(i)}};var ee=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new _t,this.p1=new _t;else if(1===arguments.length){var A=arguments[0];this.p0=new _t(A.p0),this.p1=new _t(A.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3];this.p0=new _t(t,n),this.p1=new _t(i,r)}},se={serialVersionUID:{configurable:!0}};ee.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},ee.prototype.orientationIndex=function(){if(arguments[0]instanceof ee){var A=arguments[0],t=En.orientationIndex(this.p0,this.p1,A.p0),n=En.orientationIndex(this.p0,this.p1,A.p1);return t>=0&&n>=0||t<=0&&n<=0?Math.max(t,n):0}if(arguments[0]instanceof _t){var i=arguments[0];return En.orientationIndex(this.p0,this.p1,i)}},ee.prototype.toGeometry=function(A){return A.createLineString([this.p0,this.p1])},ee.prototype.isVertical=function(){return this.p0.x===this.p1.x},ee.prototype.equals=function(A){if(!(A instanceof ee))return!1;var t=A;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)},ee.prototype.intersection=function(A){var t=new Tn;return t.computeIntersection(this.p0,this.p1,A.p0,A.p1),t.hasIntersection()?t.getIntersection(0):null},ee.prototype.project=function(){if(arguments[0]instanceof _t){var A=arguments[0];if(A.equals(this.p0)||A.equals(this.p1))return new _t(A);var t=this.projectionFactor(A),n=new _t;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof ee){var i=arguments[0],r=this.projectionFactor(i.p0),e=this.projectionFactor(i.p1);if(r>=1&&e>=1)return null;if(r<=0&&e<=0)return null;var s=this.project(i.p0);r<0&&(s=this.p0),r>1&&(s=this.p1);var u=this.project(i.p1);return e<0&&(u=this.p0),e>1&&(u=this.p1),new ee(s,u)}},ee.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},ee.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},ee.prototype.getCoordinate=function(A){return 0===A?this.p0:this.p1},ee.prototype.distancePerpendicular=function(A){return En.distancePointLinePerpendicular(A,this.p0,this.p1)},ee.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},ee.prototype.midPoint=function(){return ee.midPoint(this.p0,this.p1)},ee.prototype.projectionFactor=function(A){if(A.equals(this.p0))return 0;if(A.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=t*t+n*n;return i<=0?Yt.NaN:((A.x-this.p0.x)*t+(A.y-this.p0.y)*n)/i},ee.prototype.closestPoints=function(A){var t=this.intersection(A);if(null!==t)return[t,t];var n=new Array(2).fill(null),i=Yt.MAX_VALUE,r=null,e=this.closestPoint(A.p0);i=e.distance(A.p0),n[0]=e,n[1]=A.p0;var s=this.closestPoint(A.p1);(r=s.distance(A.p1))<i&&(i=r,n[0]=s,n[1]=A.p1);var u=A.closestPoint(this.p0);(r=u.distance(this.p0))<i&&(i=r,n[0]=this.p0,n[1]=u);var o=A.closestPoint(this.p1);return(r=o.distance(this.p1))<i&&(i=r,n[0]=this.p1,n[1]=o),n},ee.prototype.closestPoint=function(A){var t=this.projectionFactor(A);return t>0&&t<1?this.project(A):this.p0.distance(A)<this.p1.distance(A)?this.p0:this.p1},ee.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},ee.prototype.getLength=function(){return this.p0.distance(this.p1)},ee.prototype.compareTo=function(A){var t=A,n=this.p0.compareTo(t.p0);return 0!==n?n:this.p1.compareTo(t.p1)},ee.prototype.reverse=function(){var A=this.p0;this.p0=this.p1,this.p1=A},ee.prototype.equalsTopo=function(A){return this.p0.equals(A.p0)&&(this.p1.equals(A.p1)||this.p0.equals(A.p1))&&this.p1.equals(A.p0)},ee.prototype.lineIntersection=function(A){try{return gn.intersection(this.p0,this.p1,A.p0,A.p1)}catch(A){if(!(A instanceof wn))throw A}return null},ee.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},ee.prototype.pointAlongOffset=function(A,t){var n=this.p0.x+A*(this.p1.x-this.p0.x),i=this.p0.y+A*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,e=this.p1.y-this.p0.y,s=Math.sqrt(r*r+e*e),u=0,o=0;if(0!==t){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");u=t*r/s,o=t*e/s}return new _t(n-o,i+u)},ee.prototype.setCoordinates=function(){if(1===arguments.length){var A=arguments[0];this.setCoordinates(A.p0,A.p1)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}},ee.prototype.segmentFraction=function(A){var t=this.projectionFactor(A);return t<0?t=0:(t>1||Yt.isNaN(t))&&(t=1),t},ee.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},ee.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},ee.prototype.distance=function(){if(arguments[0]instanceof ee){var A=arguments[0];return En.distanceLineLine(this.p0,this.p1,A.p0,A.p1)}if(arguments[0]instanceof _t){var t=arguments[0];return En.distancePointLine(t,this.p0,this.p1)}},ee.prototype.pointAlong=function(A){var t=new _t;return t.x=this.p0.x+A*(this.p1.x-this.p0.x),t.y=this.p0.y+A*(this.p1.y-this.p0.y),t},ee.prototype.hashCode=function(){var A=Yt.doubleToLongBits(this.p0.x);A^=31*Yt.doubleToLongBits(this.p0.y);var t=Math.trunc(A)^Math.trunc(A>>32),n=Yt.doubleToLongBits(this.p1.x);return n^=31*Yt.doubleToLongBits(this.p1.y),t^Math.trunc(n)^Math.trunc(n>>32)},ee.prototype.interfaces_=function(){return[Wt,Ht]},ee.prototype.getClass=function(){return ee},ee.midPoint=function(A,t){return new _t((A.x+t.x)/2,(A.y+t.y)/2)},se.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(ee,se);var ue=function(){this.tempEnv1=new Cn,this.tempEnv2=new Cn,this.ui=new ee,this.oi=new ee};ue.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];A.getLineSegment(t,this.ui),n.getLineSegment(i,this.oi),this.overlap(this.ui,this.oi)}},ue.prototype.interfaces_=function(){return[]},ue.prototype.getClass=function(){return ue};var oe=function(){this.wn=null,this.hi=null,this.fi=null,this.cn=null,this.ci=null,this.ai=null;var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.wn=A,this.hi=t,this.fi=n,this.ci=i};oe.prototype.getLineSegment=function(A,t){t.p0=this.wn[A],t.p1=this.wn[A+1]},oe.prototype.computeSelect=function(A,t,n,i){if(i.tempEnv1.init(this.wn[t],this.wn[n]),n-t==1)return i.select(this,t),null;if(!A.intersects(i.tempEnv1))return null;var s=Math.trunc((t+n)/2);t<s&&this.computeSelect(A,t,s,i),s<n&&this.computeSelect(A,s,n,i)},oe.prototype.getCoordinates=function(){for(var A=new Array(this.fi-this.hi+1).fill(null),t=0,n=this.hi;n<=this.fi;n++)A[t++]=this.wn[n];return A},oe.prototype.computeOverlaps=function(A,t){this.computeOverlapsInternal(this.hi,this.fi,A,A.hi,A.fi,t)},oe.prototype.setId=function(A){this.ai=A},oe.prototype.select=function(A,t){this.computeSelect(A,this.hi,this.fi,t)},oe.prototype.getEnvelope=function(){null===this.cn&&(this.cn=new Cn(this.wn[this.hi],this.wn[this.fi]));return this.cn},oe.prototype.getEndIndex=function(){return this.fi},oe.prototype.getStartIndex=function(){return this.hi},oe.prototype.getContext=function(){return this.ci},oe.prototype.getId=function(){return this.ai},oe.prototype.computeOverlapsInternal=function(A,t,n,i,r,e){var s=this.wn[A],u=this.wn[t],o=n.wn[i],h=n.wn[r];if(t-A==1&&r-i==1)return e.overlap(this,A,n,i),null;if(e.tempEnv1.init(s,u),e.tempEnv2.init(o,h),!e.tempEnv1.intersects(e.tempEnv2))return null;var f=Math.trunc((A+t)/2),c=Math.trunc((i+r)/2);A<f&&(i<c&&this.computeOverlapsInternal(A,f,n,i,c,e),c<r&&this.computeOverlapsInternal(A,f,n,c,r,e)),f<t&&(i<c&&this.computeOverlapsInternal(f,t,n,i,c,e),c<r&&this.computeOverlapsInternal(f,t,n,c,r,e))},oe.prototype.interfaces_=function(){return[]},oe.prototype.getClass=function(){return oe};var he=function(){};he.prototype.interfaces_=function(){return[]},he.prototype.getClass=function(){return he},he.getChainStartIndices=function(A){var t=0,n=new Zn;n.add(new sn(t));do{var i=he.findChainEnd(A,t);n.add(new sn(i)),t=i}while(t<A.length-1);return he.toIntArray(n)},he.findChainEnd=function(A,t){for(var n=t;n<A.length-1&&A[n].equals2D(A[n+1]);)n++;if(n>=A.length-1)return A.length-1;for(var i=Tr.quadrant(A[n],A[n+1]),r=t+1;r<A.length&&(A[r-1].equals2D(A[r])||Tr.quadrant(A[r-1],A[r])===i);)r++;return r-1},he.getChains=function(){if(1===arguments.length){var A=arguments[0];return he.getChains(A,null)}if(2===arguments.length){for(var t=arguments[0],n=arguments[1],i=new Zn,r=he.getChainStartIndices(t),e=0;e<r.length-1;e++){var s=new oe(t,r[e],r[e+1],n);i.add(s)}return i}},he.toIntArray=function(A){for(var t=new Array(A.size()).fill(null),n=0;n<t.length;n++)t[n]=A.get(n).intValue();return t};var fe=function(){};fe.prototype.computeNodes=function(A){},fe.prototype.getNodedSubstrings=function(){},fe.prototype.interfaces_=function(){return[]},fe.prototype.getClass=function(){return fe};var ce=function(){if(this.vi=null,0===arguments.length);else if(1===arguments.length){var A=arguments[0];this.setSegmentIntersector(A)}};ce.prototype.setSegmentIntersector=function(A){this.vi=A},ce.prototype.interfaces_=function(){return[fe]},ce.prototype.getClass=function(){return ce};var ae=function(A){function t(t){t?A.call(this,t):A.call(this),this.li=new Zn,this.wi=new Jr,this.Pi=0,this.gi=null,this.Ci=0}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this.li},t.prototype.getNodedSubstrings=function(){return re.getNodedSubstrings(this.gi)},t.prototype.getIndex=function(){return this.wi},t.prototype.add=function(A){for(var t=he.getChains(A.getCoordinates(),A).iterator();t.hasNext();){var n=t.next();n.setId(this.Pi++),this.wi.insert(n.getEnvelope(),n),this.li.add(n)}},t.prototype.computeNodes=function(A){this.gi=A;for(var t=A.iterator();t.hasNext();)this.add(t.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var A=new ve(this.vi),t=this.li.iterator();t.hasNext();)for(var n=t.next(),i=this.wi.query(n.getEnvelope()).iterator();i.hasNext();){var r=i.next();if(r.getId()>n.getId()&&(n.computeOverlaps(r,A),this.Ci++),this.vi.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.SegmentOverlapAction.get=function(){return ve},Object.defineProperties(t,n),t}(ce),ve=function(A){function t(){A.call(this),this.Di=null;var t=arguments[0];this.Di=t}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.overlap=function(){if(4!==arguments.length)return A.prototype.overlap.apply(this,arguments);var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3],e=t.getContext(),s=i.getContext();this.Di.processIntersections(e,n,s,r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ue),le=function A(){if(this.Ii=A.DEFAULT_QUADRANT_SEGMENTS,this.Mi=A.CAP_ROUND,this.bi=A.JOIN_ROUND,this.zi=A.DEFAULT_MITRE_LIMIT,this.xi=!1,this.di=A.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(i)}else if(4===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(e),this.setJoinStyle(s),this.setMitreLimit(u)}},we={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};le.prototype.getEndCapStyle=function(){return this.Mi},le.prototype.isSingleSided=function(){return this.xi},le.prototype.setQuadrantSegments=function(A){this.Ii=A,0===this.Ii&&(this.bi=le.JOIN_BEVEL),this.Ii<0&&(this.bi=le.JOIN_MITRE,this.zi=Math.abs(this.Ii)),A<=0&&(this.Ii=1),this.bi!==le.JOIN_ROUND&&(this.Ii=le.DEFAULT_QUADRANT_SEGMENTS)},le.prototype.getJoinStyle=function(){return this.bi},le.prototype.setJoinStyle=function(A){this.bi=A},le.prototype.setSimplifyFactor=function(A){this.di=A<0?0:A},le.prototype.getSimplifyFactor=function(){return this.di},le.prototype.getQuadrantSegments=function(){return this.Ii},le.prototype.setEndCapStyle=function(A){this.Mi=A},le.prototype.getMitreLimit=function(){return this.zi},le.prototype.setMitreLimit=function(A){this.zi=A},le.prototype.setSingleSided=function(A){this.xi=A},le.prototype.interfaces_=function(){return[]},le.prototype.getClass=function(){return le},le.bufferDistanceError=function(A){var t=Math.PI/2/A;return 1-Math.cos(t/2)},we.CAP_ROUND.get=function(){return 1},we.CAP_FLAT.get=function(){return 2},we.CAP_SQUARE.get=function(){return 3},we.JOIN_ROUND.get=function(){return 1},we.JOIN_MITRE.get=function(){return 2},we.JOIN_BEVEL.get=function(){return 3},we.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},we.DEFAULT_MITRE_LIMIT.get=function(){return 5},we.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(le,we);var Pe=function(A){this.yi=null,this.mi=null,this.pi=En.COUNTERCLOCKWISE,this.Li=A||null},ge={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Pe.prototype.isDeletable=function(A,t,n,i){var r=this.Li[A],e=this.Li[t],s=this.Li[n];return!!this.isConcave(r,e,s)&&!!this.isShallow(r,e,s,i)&&this.isShallowSampled(r,e,A,n,i)},Pe.prototype.deleteShallowConcavities=function(){for(var A=1,t=this.findNextNonDeletedIndex(A),n=this.findNextNonDeletedIndex(t),i=!1;n<this.Li.length;){var r=!1;this.isDeletable(A,t,n,this.yi)&&(this.mi[t]=Pe.DELETE,r=!0,i=!0),t=this.findNextNonDeletedIndex(A=r?n:t),n=this.findNextNonDeletedIndex(t)}return i},Pe.prototype.isShallowConcavity=function(A,t,n,i){return En.computeOrientation(A,t,n)===this.pi&&En.distancePointLine(t,A,n)<i},Pe.prototype.isShallowSampled=function(A,t,n,i,r){var e=Math.trunc((i-n)/Pe.NUM_PTS_TO_CHECK);e<=0&&(e=1);for(var s=n;s<i;s+=e)if(!this.isShallow(A,t,this.Li[s],r))return!1;return!0},Pe.prototype.isConcave=function(A,t,n){return En.computeOrientation(A,t,n)===this.pi},Pe.prototype.simplify=function(A){this.yi=Math.abs(A),A<0&&(this.pi=En.CLOCKWISE),this.mi=new Array(this.Li.length).fill(null);var t=!1;do{t=this.deleteShallowConcavities()}while(t);return this.collapseLine()},Pe.prototype.findNextNonDeletedIndex=function(A){for(var t=A+1;t<this.Li.length&&this.mi[t]===Pe.DELETE;)t++;return t},Pe.prototype.isShallow=function(A,t,n,i){return En.distancePointLine(t,A,n)<i},Pe.prototype.collapseLine=function(){for(var A=new $n,t=0;t<this.Li.length;t++)this.mi[t]!==Pe.DELETE&&A.add(this.Li[t]);return A.toCoordinateArray()},Pe.prototype.interfaces_=function(){return[]},Pe.prototype.getClass=function(){return Pe},Pe.simplify=function(A,t){return new Pe(A).simplify(t)},ge.INIT.get=function(){return 0},ge.DELETE.get=function(){return 1},ge.KEEP.get=function(){return 1},ge.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Pe,ge);var Ce=function(){this.Ti=null,this.St=null,this.Oi=0,this.Ti=new Zn},De={COORDINATE_ARRAY_TYPE:{configurable:!0}};Ce.prototype.getCoordinates=function(){return this.Ti.toArray(Ce.COORDINATE_ARRAY_TYPE)},Ce.prototype.setPrecisionModel=function(A){this.St=A},Ce.prototype.addPt=function(A){var t=new _t(A);if(this.St.makePrecise(t),this.isRedundant(t))return null;this.Ti.add(t)},Ce.prototype.revere=function(){},Ce.prototype.addPts=function(A,t){if(t)for(var n=0;n<A.length;n++)this.addPt(A[n]);else for(var i=A.length-1;i>=0;i--)this.addPt(A[i])},Ce.prototype.isRedundant=function(A){if(this.Ti.size()<1)return!1;var t=this.Ti.get(this.Ti.size()-1);return A.distance(t)<this.Oi},Ce.prototype.toString=function(){return(new sr).createLineString(this.getCoordinates()).toString()},Ce.prototype.closeRing=function(){if(this.Ti.size()<1)return null;var A=new _t(this.Ti.get(0)),t=this.Ti.get(this.Ti.size()-1);if(A.equals(t))return null;this.Ti.add(A)},Ce.prototype.setMinimumVertexDistance=function(A){this.Oi=A},Ce.prototype.interfaces_=function(){return[]},Ce.prototype.getClass=function(){return Ce},De.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Ce,De);var Ie=function(){},Me={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Ie.prototype.interfaces_=function(){return[]},Ie.prototype.getClass=function(){return Ie},Ie.toDegrees=function(A){return 180*A/Math.PI},Ie.normalize=function(A){for(;A>Math.PI;)A-=Ie.PI_TIMES_2;for(;A<=-Math.PI;)A+=Ie.PI_TIMES_2;return A},Ie.angle=function(){if(1===arguments.length){var A=arguments[0];return Math.atan2(A.y,A.x)}if(2===arguments.length){var t=arguments[0],n=arguments[1],i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)}},Ie.isAcute=function(A,t,n){return(A.x-t.x)*(n.x-t.x)+(A.y-t.y)*(n.y-t.y)>0},Ie.isObtuse=function(A,t,n){return(A.x-t.x)*(n.x-t.x)+(A.y-t.y)*(n.y-t.y)<0},Ie.interiorAngle=function(A,t,n){var i=Ie.angle(t,A),r=Ie.angle(t,n);return Math.abs(r-i)},Ie.normalizePositive=function(A){if(A<0){for(;A<0;)A+=Ie.PI_TIMES_2;A>=Ie.PI_TIMES_2&&(A=0)}else{for(;A>=Ie.PI_TIMES_2;)A-=Ie.PI_TIMES_2;A<0&&(A=0)}return A},Ie.angleBetween=function(A,t,n){var i=Ie.angle(t,A),r=Ie.angle(t,n);return Ie.diff(i,r)},Ie.diff=function(A,t){var n=null;return(n=A<t?t-A:A-t)>Math.PI&&(n=2*Math.PI-n),n},Ie.toRadians=function(A){return A*Math.PI/180},Ie.getTurn=function(A,t){var n=Math.sin(t-A);return n>0?Ie.COUNTERCLOCKWISE:n<0?Ie.CLOCKWISE:Ie.NONE},Ie.angleBetweenOriented=function(A,t,n){var i=Ie.angle(t,A),r=Ie.angle(t,n)-i;return r<=-Math.PI?r+Ie.PI_TIMES_2:r>Math.PI?r-Ie.PI_TIMES_2:r},Me.PI_TIMES_2.get=function(){return 2*Math.PI},Me.PI_OVER_2.get=function(){return Math.PI/2},Me.PI_OVER_4.get=function(){return Math.PI/4},Me.COUNTERCLOCKWISE.get=function(){return En.COUNTERCLOCKWISE},Me.CLOCKWISE.get=function(){return En.CLOCKWISE},Me.NONE.get=function(){return En.COLLINEAR},Object.defineProperties(Ie,Me);var be=function A(){this.Fi=0,this.Ei=null,this.Ui=1,this.Ni=null,this._n=0,this.St=null,this.ji=null,this.Qi=null,this.Si=null,this.Bi=null,this.Ri=null,this.ki=new ee,this.Gi=new ee,this.Yi=new ee,this.qi=new ee,this.Wi=0,this.Vi=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this.St=t,this.ji=n,this.Qi=new Tn,this.Ei=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===le.JOIN_ROUND&&(this.Ui=A.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)},ze={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};be.prototype.addNextSegment=function(A,t){if(this.Si=this.Bi,this.Bi=this.Ri,this.Ri=A,this.ki.setCoordinates(this.Si,this.Bi),this.computeOffsetSegment(this.ki,this.Wi,this._n,this.Yi),this.Gi.setCoordinates(this.Bi,this.Ri),this.computeOffsetSegment(this.Gi,this.Wi,this._n,this.qi),this.Bi.equals(this.Ri))return null;var n=En.computeOrientation(this.Si,this.Bi,this.Ri),i=n===En.CLOCKWISE&&this.Wi===lr.LEFT||n===En.COUNTERCLOCKWISE&&this.Wi===lr.RIGHT;0===n?this.addCollinear(t):i?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)},be.prototype.addLineEndCap=function(A,t){var n=new ee(A,t),i=new ee;this.computeOffsetSegment(n,lr.LEFT,this._n,i);var r=new ee;this.computeOffsetSegment(n,lr.RIGHT,this._n,r);var u=Math.atan2(t.y-A.y,t.x-A.x);switch(this.ji.getEndCapStyle()){case le.CAP_ROUND:this.Ni.addPt(i.p1),this.addFilletArc(t,u+Math.PI/2,u-Math.PI/2,En.CLOCKWISE,this._n),this.Ni.addPt(r.p1);break;case le.CAP_FLAT:this.Ni.addPt(i.p1),this.Ni.addPt(r.p1);break;case le.CAP_SQUARE:var o=new _t;o.x=Math.abs(this._n)*Math.cos(u),o.y=Math.abs(this._n)*Math.sin(u);var h=new _t(i.p1.x+o.x,i.p1.y+o.y),f=new _t(r.p1.x+o.x,r.p1.y+o.y);this.Ni.addPt(h),this.Ni.addPt(f)}},be.prototype.getCoordinates=function(){return this.Ni.getCoordinates()},be.prototype.addMitreJoin=function(A,t,n,i){var r=!0,e=null;try{e=gn.intersection(t.p0,t.p1,n.p0,n.p1),(i<=0?1:e.distance(A)/Math.abs(i))>this.ji.getMitreLimit()&&(r=!1)}catch(A){if(!(A instanceof wn))throw A;e=new _t(0,0),r=!1}r?this.Ni.addPt(e):this.addLimitedMitreJoin(t,n,i,this.ji.getMitreLimit())},be.prototype.addFilletCorner=function(A,t,n,i,r){var u=Math.atan2(t.y-A.y,t.x-A.x),f=Math.atan2(n.y-A.y,n.x-A.x);i===En.CLOCKWISE?u<=f&&(u+=2*Math.PI):u>=f&&(u-=2*Math.PI),this.Ni.addPt(t),this.addFilletArc(A,u,f,i,r),this.Ni.addPt(n)},be.prototype.addOutsideTurn=function(A,t){if(this.Yi.p1.distance(this.qi.p0)<this._n*be.OFFSET_SEGMENT_SEPARATION_FACTOR)return this.Ni.addPt(this.Yi.p1),null;this.ji.getJoinStyle()===le.JOIN_MITRE?this.addMitreJoin(this.Bi,this.Yi,this.qi,this._n):this.ji.getJoinStyle()===le.JOIN_BEVEL?this.addBevelJoin(this.Yi,this.qi):(t&&this.Ni.addPt(this.Yi.p1),this.addFilletCorner(this.Bi,this.Yi.p1,this.qi.p0,A,this._n),this.Ni.addPt(this.qi.p0))},be.prototype.createSquare=function(A){this.Ni.addPt(new _t(A.x+this._n,A.y+this._n)),this.Ni.addPt(new _t(A.x+this._n,A.y-this._n)),this.Ni.addPt(new _t(A.x-this._n,A.y-this._n)),this.Ni.addPt(new _t(A.x-this._n,A.y+this._n)),this.Ni.closeRing()},be.prototype.addSegments=function(A,t){this.Ni.addPts(A,t)},be.prototype.addFirstSegment=function(){this.Ni.addPt(this.qi.p0)},be.prototype.addLastSegment=function(){this.Ni.addPt(this.qi.p1)},be.prototype.initSideSegments=function(A,t,n){this.Bi=A,this.Ri=t,this.Wi=n,this.Gi.setCoordinates(A,t),this.computeOffsetSegment(this.Gi,n,this._n,this.qi)},be.prototype.addLimitedMitreJoin=function(A,t,n,i){var r=this.ki.p1,e=Ie.angle(r,this.ki.p0),s=Ie.angleBetweenOriented(this.ki.p0,r,this.Gi.p1)/2,u=Ie.normalize(e+s),o=Ie.normalize(u+Math.PI),h=i*n,f=n-h*Math.abs(Math.sin(s)),c=r.x+h*Math.cos(o),a=r.y+h*Math.sin(o),v=new _t(c,a),l=new ee(r,v),w=l.pointAlongOffset(1,f),P=l.pointAlongOffset(1,-f);this.Wi===lr.LEFT?(this.Ni.addPt(w),this.Ni.addPt(P)):(this.Ni.addPt(P),this.Ni.addPt(w))},be.prototype.computeOffsetSegment=function(A,t,n,i){var r=t===lr.LEFT?1:-1,e=A.p1.x-A.p0.x,s=A.p1.y-A.p0.y,u=Math.sqrt(e*e+s*s),o=r*n*e/u,h=r*n*s/u;i.p0.x=A.p0.x-h,i.p0.y=A.p0.y+o,i.p1.x=A.p1.x-h,i.p1.y=A.p1.y+o},be.prototype.addFilletArc=function(A,t,n,i,r){var e=i===En.CLOCKWISE?-1:1,s=Math.abs(t-n),u=Math.trunc(s/this.Ei+.5);if(u<1)return null;for(var o=s/u,h=0,f=new _t;h<s;){var c=t+e*h;f.x=A.x+r*Math.cos(c),f.y=A.y+r*Math.sin(c),this.Ni.addPt(f),h+=o}},be.prototype.addInsideTurn=function(A,t){if(this.Qi.computeIntersection(this.Yi.p0,this.Yi.p1,this.qi.p0,this.qi.p1),this.Qi.hasIntersection())this.Ni.addPt(this.Qi.getIntersection(0));else if(this.Vi=!0,this.Yi.p1.distance(this.qi.p0)<this._n*be.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this.Ni.addPt(this.Yi.p1);else{if(this.Ni.addPt(this.Yi.p1),this.Ui>0){var n=new _t((this.Ui*this.Yi.p1.x+this.Bi.x)/(this.Ui+1),(this.Ui*this.Yi.p1.y+this.Bi.y)/(this.Ui+1));this.Ni.addPt(n);var i=new _t((this.Ui*this.qi.p0.x+this.Bi.x)/(this.Ui+1),(this.Ui*this.qi.p0.y+this.Bi.y)/(this.Ui+1));this.Ni.addPt(i)}else this.Ni.addPt(this.Bi);this.Ni.addPt(this.qi.p0)}},be.prototype.createCircle=function(A){var t=new _t(A.x+this._n,A.y);this.Ni.addPt(t),this.addFilletArc(A,0,2*Math.PI,-1,this._n),this.Ni.closeRing()},be.prototype.addBevelJoin=function(A,t){this.Ni.addPt(A.p1),this.Ni.addPt(t.p0)},be.prototype.init=function(A){this._n=A,this.Fi=A*(1-Math.cos(this.Ei/2)),this.Ni=new Ce,this.Ni.setPrecisionModel(this.St),this.Ni.setMinimumVertexDistance(A*be.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},be.prototype.addCollinear=function(A){this.Qi.computeIntersection(this.Si,this.Bi,this.Bi,this.Ri),this.Qi.getIntersectionNum()>=2&&(this.ji.getJoinStyle()===le.JOIN_BEVEL||this.ji.getJoinStyle()===le.JOIN_MITRE?(A&&this.Ni.addPt(this.Yi.p1),this.Ni.addPt(this.qi.p0)):this.addFilletCorner(this.Bi,this.Yi.p1,this.qi.p0,En.CLOCKWISE,this._n))},be.prototype.closeRing=function(){this.Ni.closeRing()},be.prototype.hasNarrowConcaveAngle=function(){return this.Vi},be.prototype.interfaces_=function(){return[]},be.prototype.getClass=function(){return be},ze.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},ze.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},ze.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},ze.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(be,ze);var xe=function(){this._n=0,this.St=null,this.ji=null;var A=arguments[0],t=arguments[1];this.St=A,this.ji=t};xe.prototype.getOffsetCurve=function(A,t){if(this._n=t,0===t)return null;var n=t<0,i=Math.abs(t),r=this.getSegGen(i);A.length<=1?this.computePointCurve(A[0],r):this.computeOffsetCurve(A,n,r);var e=r.getCoordinates();return n&&Ai.reverse(e),e},xe.prototype.computeSingleSidedBufferCurve=function(A,t,n){var i=this.simplifyTolerance(this._n);if(t){n.addSegments(A,!0);var r=Pe.simplify(A,-i),e=r.length-1;n.initSideSegments(r[e],r[e-1],lr.LEFT),n.addFirstSegment();for(var s=e-2;s>=0;s--)n.addNextSegment(r[s],!0)}else{n.addSegments(A,!1);var u=Pe.simplify(A,i),o=u.length-1;n.initSideSegments(u[0],u[1],lr.LEFT),n.addFirstSegment();for(var h=2;h<=o;h++)n.addNextSegment(u[h],!0)}n.addLastSegment(),n.closeRing()},xe.prototype.computeRingBufferCurve=function(A,t,n){var i=this.simplifyTolerance(this._n);t===lr.RIGHT&&(i=-i);var r=Pe.simplify(A,i),e=r.length-1;n.initSideSegments(r[e-1],r[0],t);for(var s=1;s<=e;s++){n.addNextSegment(r[s],1!==s)}n.closeRing()},xe.prototype.computeLineBufferCurve=function(A,t){var n=this.simplifyTolerance(this._n),i=Pe.simplify(A,n),r=i.length-1;t.initSideSegments(i[0],i[1],lr.LEFT);for(var e=2;e<=r;e++)t.addNextSegment(i[e],!0);t.addLastSegment(),t.addLineEndCap(i[r-1],i[r]);var s=Pe.simplify(A,-n),u=s.length-1;t.initSideSegments(s[u],s[u-1],lr.LEFT);for(var o=u-2;o>=0;o--)t.addNextSegment(s[o],!0);t.addLastSegment(),t.addLineEndCap(s[1],s[0]),t.closeRing()},xe.prototype.computePointCurve=function(A,t){switch(this.ji.getEndCapStyle()){case le.CAP_ROUND:t.createCircle(A);break;case le.CAP_SQUARE:t.createSquare(A)}},xe.prototype.getLineCurve=function(A,t){if(this._n=t,t<0&&!this.ji.isSingleSided())return null;if(0===t)return null;var n=Math.abs(t),i=this.getSegGen(n);if(A.length<=1)this.computePointCurve(A[0],i);else if(this.ji.isSingleSided()){this.computeSingleSidedBufferCurve(A,t<0,i)}else this.computeLineBufferCurve(A,i);return i.getCoordinates()},xe.prototype.getBufferParameters=function(){return this.ji},xe.prototype.simplifyTolerance=function(A){return A*this.ji.getSimplifyFactor()},xe.prototype.getRingCurve=function(A,t,n){if(this._n=n,A.length<=2)return this.getLineCurve(A,n);if(0===n)return xe.copyCoordinates(A);var i=this.getSegGen(n);return this.computeRingBufferCurve(A,t,i),i.getCoordinates()},xe.prototype.computeOffsetCurve=function(A,t,n){var i=this.simplifyTolerance(this._n);if(t){var r=Pe.simplify(A,-i),e=r.length-1;n.initSideSegments(r[e],r[e-1],lr.LEFT),n.addFirstSegment();for(var s=e-2;s>=0;s--)n.addNextSegment(r[s],!0)}else{var u=Pe.simplify(A,i),o=u.length-1;n.initSideSegments(u[0],u[1],lr.LEFT),n.addFirstSegment();for(var h=2;h<=o;h++)n.addNextSegment(u[h],!0)}n.addLastSegment()},xe.prototype.getSegGen=function(A){return new be(this.St,this.ji,A)},xe.prototype.interfaces_=function(){return[]},xe.prototype.getClass=function(){return xe},xe.copyCoordinates=function(A){for(var t=new Array(A.length).fill(null),n=0;n<t.length;n++)t[n]=new _t(A[n]);return t};var de=function(){this.Ki=null,this.Hi=new ee,this._i=new En;var A=arguments[0];this.Ki=A},ye={DepthSegment:{configurable:!0}};de.prototype.findStabbedSegments=function(){var A=this;if(1===arguments.length){for(var t=arguments[0],n=new Zn,i=this.Ki.iterator();i.hasNext();){var r=i.next(),e=r.getEnvelope();t.y<e.getMinY()||t.y>e.getMaxY()||A.findStabbedSegments(t,r.getDirectedEdges(),n)}return n}if(3===arguments.length)if(tn(arguments[2],_n)&&arguments[0]instanceof _t&&arguments[1]instanceof Er)for(var s=arguments[0],u=arguments[1],o=arguments[2],h=u.getEdge().getCoordinates(),f=0;f<h.length-1;f++){A.Hi.p0=h[f],A.Hi.p1=h[f+1],A.Hi.p0.y>A.Hi.p1.y&&A.Hi.reverse();var c=Math.max(A.Hi.p0.x,A.Hi.p1.x);if(!(c<s.x||A.Hi.isHorizontal()||s.y<A.Hi.p0.y||s.y>A.Hi.p1.y||En.computeOrientation(A.Hi.p0,A.Hi.p1,s)===En.RIGHT)){var a=u.getDepth(lr.LEFT);A.Hi.p0.equals(h[f])||(a=u.getDepth(lr.RIGHT));var v=new me(A.Hi,a);o.add(v)}}else if(tn(arguments[2],_n)&&arguments[0]instanceof _t&&tn(arguments[1],_n))for(var l=arguments[0],w=arguments[1],P=arguments[2],g=w.iterator();g.hasNext();){var C=g.next();C.isForward()&&A.findStabbedSegments(l,C,P)}},de.prototype.getDepth=function(A){var t=this.findStabbedSegments(A);return 0===t.size()?0:qr.min(t).Ji},de.prototype.interfaces_=function(){return[]},de.prototype.getClass=function(){return de},ye.DepthSegment.get=function(){return me},Object.defineProperties(de,ye);var me=function(){this.Zi=null,this.Ji=null;var A=arguments[0],t=arguments[1];this.Zi=new ee(A),this.Ji=t};me.prototype.compareTo=function(A){var t=A;if(this.Zi.minX()>=t.Zi.maxX())return 1;if(this.Zi.maxX()<=t.Zi.minX())return-1;var n=this.Zi.orientationIndex(t.Zi);return 0!==n||0!=(n=-1*t.Zi.orientationIndex(this.Zi))?n:this.Zi.compareTo(t.Zi)},me.prototype.compareX=function(A,t){var n=A.p0.compareTo(t.p0);return 0!==n?n:A.p1.compareTo(t.p1)},me.prototype.toString=function(){return this.Zi.toString()},me.prototype.interfaces_=function(){return[Wt]},me.prototype.getClass=function(){return me};var pe=function(A,t,n){this.p0=A||null,this.p1=t||null,this.p2=n||null};pe.prototype.area=function(){return pe.area(this.p0,this.p1,this.p2)},pe.prototype.signedArea=function(){return pe.signedArea(this.p0,this.p1,this.p2)},pe.prototype.interpolateZ=function(A){if(null===A)throw new Gt("Supplied point is null.");return pe.interpolateZ(A,this.p0,this.p1,this.p2)},pe.prototype.longestSideLength=function(){return pe.longestSideLength(this.p0,this.p1,this.p2)},pe.prototype.isAcute=function(){return pe.isAcute(this.p0,this.p1,this.p2)},pe.prototype.circumcentre=function(){return pe.circumcentre(this.p0,this.p1,this.p2)},pe.prototype.area3D=function(){return pe.area3D(this.p0,this.p1,this.p2)},pe.prototype.centroid=function(){return pe.centroid(this.p0,this.p1,this.p2)},pe.prototype.inCentre=function(){return pe.inCentre(this.p0,this.p1,this.p2)},pe.prototype.interfaces_=function(){return[]},pe.prototype.getClass=function(){return pe},pe.area=function(A,t,n){return Math.abs(((n.x-A.x)*(t.y-A.y)-(t.x-A.x)*(n.y-A.y))/2)},pe.signedArea=function(A,t,n){return((n.x-A.x)*(t.y-A.y)-(t.x-A.x)*(n.y-A.y))/2},pe.det=function(A,t,n,i){return A*i-t*n},pe.interpolateZ=function(A,t,n,i){var r=t.x,e=t.y,s=n.x-r,u=i.x-r,o=n.y-e,h=i.y-e,f=s*h-u*o,c=A.x-r,a=A.y-e;return t.z+(h*c-u*a)/f*(n.z-t.z)+(-o*c+s*a)/f*(i.z-t.z)},pe.longestSideLength=function(A,t,n){var i=A.distance(t),r=t.distance(n),e=n.distance(A),s=i;return r>s&&(s=r),e>s&&(s=e),s},pe.isAcute=function(A,t,n){return!!Ie.isAcute(A,t,n)&&!!Ie.isAcute(t,n,A)&&!!Ie.isAcute(n,A,t)},pe.circumcentre=function(A,t,n){var i=n.x,r=n.y,e=A.x-i,s=A.y-r,u=t.x-i,o=t.y-r,h=2*pe.det(e,s,u,o),f=pe.det(s,e*e+s*s,o,u*u+o*o),c=pe.det(e,e*e+s*s,u,u*u+o*o);return new _t(i-f/h,r+c/h)},pe.perpendicularBisector=function(A,t){var n=t.x-A.x,i=t.y-A.y,r=new gn(A.x+n/2,A.y+i/2,1),e=new gn(A.x-i+n/2,A.y+n+i/2,1);return new gn(r,e)},pe.angleBisector=function(A,t,n){var i=t.distance(A),r=i/(i+t.distance(n));return new _t(A.x+r*(n.x-A.x),A.y+r*(n.y-A.y))},pe.area3D=function(A,t,n){var i=t.x-A.x,r=t.y-A.y,e=t.z-A.z,s=n.x-A.x,u=n.y-A.y,o=n.z-A.z,h=r*o-e*u,f=e*s-i*o,c=i*u-r*s;return Math.sqrt(h*h+f*f+c*c)/2},pe.centroid=function(A,t,n){return new _t((A.x+t.x+n.x)/3,(A.y+t.y+n.y)/3)},pe.inCentre=function(A,t,n){var i=t.distance(n),r=A.distance(n),e=A.distance(t),s=i+r+e;return new _t((i*A.x+r*t.x+e*n.x)/s,(i*A.y+r*t.y+e*n.y)/s)};var Le=function(){this.Xi=null,this._n=null,this.$i=null,this.Ar=new Zn;var A=arguments[0],t=arguments[1],n=arguments[2];this.Xi=A,this._n=t,this.$i=n};Le.prototype.addPoint=function(A){if(this._n<=0)return null;var t=A.getCoordinates(),n=this.$i.getLineCurve(t,this._n);this.addCurve(n,$t.EXTERIOR,$t.INTERIOR)},Le.prototype.addPolygon=function(A){var t=this._n,n=lr.LEFT;this._n<0&&(t=-this._n,n=lr.RIGHT);var i=A.getExteriorRing(),r=Ai.removeRepeatedPoints(i.getCoordinates());if(this._n<0&&this.isErodedCompletely(i,this._n))return null;if(this._n<=0&&r.length<3)return null;this.addPolygonRing(r,t,n,$t.EXTERIOR,$t.INTERIOR);for(var e=0;e<A.getNumInteriorRing();e++){var s=A.getInteriorRingN(e),u=Ai.removeRepeatedPoints(s.getCoordinates());this._n>0&&this.isErodedCompletely(s,-this._n)||this.addPolygonRing(u,t,lr.opposite(n),$t.INTERIOR,$t.EXTERIOR)}},Le.prototype.isTriangleErodedCompletely=function(A,t){var n=new pe(A[0],A[1],A[2]),i=n.inCentre();return En.distancePointLine(i,n.p0,n.p1)<Math.abs(t)},Le.prototype.addLineString=function(A){if(this._n<=0&&!this.$i.getBufferParameters().isSingleSided())return null;var t=Ai.removeRepeatedPoints(A.getCoordinates()),n=this.$i.getLineCurve(t,this._n);this.addCurve(n,$t.EXTERIOR,$t.INTERIOR)},Le.prototype.addCurve=function(A,t,n){if(null===A||A.length<2)return null;var i=new re(A,new zr(0,$t.BOUNDARY,t,n));this.Ar.add(i)},Le.prototype.getCurves=function(){return this.add(this.Xi),this.Ar},Le.prototype.addPolygonRing=function(A,t,n,i,r){if(0===t&&A.length<qi.MINIMUM_VALID_SIZE)return null;var e=i,s=r;A.length>=qi.MINIMUM_VALID_SIZE&&En.isCCW(A)&&(e=r,s=i,n=lr.opposite(n));var u=this.$i.getRingCurve(A,n,t);this.addCurve(u,e,s)},Le.prototype.add=function(A){if(A.isEmpty())return null;A instanceof Gi?this.addPolygon(A):A instanceof Si?this.addLineString(A):A instanceof Ri?this.addPoint(A):(A instanceof Yi||A instanceof yi||A instanceof Wi||A instanceof di)&&this.addCollection(A)},Le.prototype.isErodedCompletely=function(A,t){var n=A.getCoordinates();if(n.length<4)return t<0;if(4===n.length)return this.isTriangleErodedCompletely(n,t);var i=A.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return t<0&&2*Math.abs(t)>r},Le.prototype.addCollection=function(A){for(var t=0;t<A.getNumGeometries();t++){var n=A.getGeometryN(t);this.add(n)}},Le.prototype.interfaces_=function(){return[]},Le.prototype.getClass=function(){return Le};var Te=function(){};Te.prototype.locate=function(A){},Te.prototype.interfaces_=function(){return[]},Te.prototype.getClass=function(){return Te};var Oe=function(){this.tr=null,this.nr=null,this.ir=null,this.wi=null,this.rr=null;var A=arguments[0];this.tr=A,this.nr=!0,this.wi=0,this.ir=A.getNumGeometries()};Oe.prototype.next=function(){if(this.nr)return this.nr=!1,Oe.isAtomic(this.tr)&&this.wi++,this.tr;if(null!==this.rr){if(this.rr.hasNext())return this.rr.next();this.rr=null}if(this.wi>=this.ir)throw new Jn;var A=this.tr.getGeometryN(this.wi++);return A instanceof di?(this.rr=new Oe(A),this.rr.next()):A},Oe.prototype.remove=function(){throw new Error(this.getClass().getName())},Oe.prototype.hasNext=function(){if(this.nr)return!0;if(null!==this.rr){if(this.rr.hasNext())return!0;this.rr=null}return!(this.wi>=this.ir)},Oe.prototype.interfaces_=function(){return[Hn]},Oe.prototype.getClass=function(){return Oe},Oe.isAtomic=function(A){return!(A instanceof di)};var Fe=function(){this.Vt=null;var A=arguments[0];this.Vt=A};Fe.prototype.locate=function(A){return Fe.locate(A,this.Vt)},Fe.prototype.interfaces_=function(){return[Te]},Fe.prototype.getClass=function(){return Fe},Fe.isPointInRing=function(A,t){return!!t.getEnvelopeInternal().intersects(A)&&En.isPointInRing(A,t.getCoordinates())},Fe.containsPointInPolygon=function(A,t){if(t.isEmpty())return!1;var n=t.getExteriorRing();if(!Fe.isPointInRing(A,n))return!1;for(var i=0;i<t.getNumInteriorRing();i++){var r=t.getInteriorRingN(i);if(Fe.isPointInRing(A,r))return!1}return!0},Fe.containsPoint=function(A,t){if(t instanceof Gi)return Fe.containsPointInPolygon(A,t);if(t instanceof di)for(var n=new Oe(t);n.hasNext();){var i=n.next();if(i!==t&&Fe.containsPoint(A,i))return!0}return!1},Fe.locate=function(A,t){return t.isEmpty()?$t.EXTERIOR:Fe.containsPoint(A,t)?$t.INTERIOR:$t.EXTERIOR};var Ee=function(){this.er=new wi,this.sr=null,this.ur=[$t.NONE,$t.NONE]};Ee.prototype.getNextCW=function(A){this.getEdges();var t=this.sr.indexOf(A),n=t-1;return 0===t&&(n=this.sr.size()-1),this.sr.get(n)},Ee.prototype.propagateSideLabels=function(A){for(var t=$t.NONE,n=this.iterator();n.hasNext();){var i=n.next().getLabel();i.isArea(A)&&i.getLocation(A,lr.LEFT)!==$t.NONE&&(t=i.getLocation(A,lr.LEFT))}if(t===$t.NONE)return null;for(var r=t,e=this.iterator();e.hasNext();){var s=e.next(),u=s.getLabel();if(u.getLocation(A,lr.ON)===$t.NONE&&u.setLocation(A,lr.ON,r),u.isArea(A)){var o=u.getLocation(A,lr.LEFT),h=u.getLocation(A,lr.RIGHT);if(h!==$t.NONE){if(h!==r)throw new Dr("side location conflict",s.getCoordinate());o===$t.NONE&&mn.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),r=o}else mn.isTrue(u.getLocation(A,lr.LEFT)===$t.NONE,"found single null side"),u.setLocation(A,lr.RIGHT,r),u.setLocation(A,lr.LEFT,r)}}},Ee.prototype.getCoordinate=function(){var A=this.iterator();return A.hasNext()?A.next().getCoordinate():null},Ee.prototype.print=function(A){Pn.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();)t.next().print(A)},Ee.prototype.isAreaLabelsConsistent=function(A){return this.computeEdgeEndLabels(A.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Ee.prototype.checkAreaLabelsConsistent=function(A){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,i=t.get(n).getLabel().getLocation(A,lr.LEFT);mn.isTrue(i!==$t.NONE,"Found unlabelled area edge");for(var r=i,e=this.iterator();e.hasNext();){var s=e.next().getLabel();mn.isTrue(s.isArea(A),"Found non-area edge");var u=s.getLocation(A,lr.LEFT),o=s.getLocation(A,lr.RIGHT);if(u===o)return!1;if(o!==r)return!1;r=u}return!0},Ee.prototype.findIndex=function(A){this.iterator();for(var t=0;t<this.sr.size();t++)if(this.sr.get(t)===A)return t;return-1},Ee.prototype.iterator=function(){return this.getEdges().iterator()},Ee.prototype.getEdges=function(){return null===this.sr&&(this.sr=new Zn(this.er.values())),this.sr},Ee.prototype.getLocation=function(A,t,n){return this.ur[A]===$t.NONE&&(this.ur[A]=Fe.locate(t,n[A].getGeometry())),this.ur[A]},Ee.prototype.toString=function(){var A=new en;A.append("EdgeEndStar:   "+this.getCoordinate()),A.append("\n");for(var t=this.iterator();t.hasNext();){var n=t.next();A.append(n),A.append("\n")}return A.toString()},Ee.prototype.computeEdgeEndLabels=function(A){for(var t=this.iterator();t.hasNext();)t.next().computeLabel(A)},Ee.prototype.computeLabelling=function(A){this.computeEdgeEndLabels(A[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],n=this.iterator();n.hasNext();)for(var i=n.next().getLabel(),r=0;r<2;r++)i.isLine(r)&&i.getLocation(r)===$t.BOUNDARY&&(t[r]=!0);for(var e=this.iterator();e.hasNext();)for(var s=e.next(),u=s.getLabel(),o=0;o<2;o++)if(u.isAnyNull(o)){var h=$t.NONE;if(t[o])h=$t.EXTERIOR;else{var f=s.getCoordinate();h=this.getLocation(o,f,A)}u.setAllLocationsIfNull(o,h)}},Ee.prototype.getDegree=function(){return this.er.size()},Ee.prototype.insertEdgeEnd=function(A,t){this.er.put(A,t),this.sr=null},Ee.prototype.interfaces_=function(){return[]},Ee.prototype.getClass=function(){return Ee};var Ue=function(A){function t(){A.call(this),this.or=null,this.Pn=null,this.hr=1,this.cr=2}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var A=null,t=null,n=this.hr,i=0;i<this.or.size();i++){var r=this.or.get(i),e=r.getSym();if(r.getLabel().isArea())switch(null===A&&r.isInResult()&&(A=r),n){case this.hr:if(!e.isInResult())continue;t=e,n=this.cr;break;case this.cr:if(!r.isInResult())continue;t.setNext(r),n=this.hr}}if(n===this.cr){if(null===A)throw new Dr("no outgoing dirEdge found",this.getCoordinate());mn.isTrue(A.isInResult(),"unable to link last incoming dirEdge"),t.setNext(A)}},t.prototype.insert=function(A){this.insertEdgeEnd(A,A)},t.prototype.getRightmostEdge=function(){var A=this.getEdges(),t=A.size();if(t<1)return null;var n=A.get(0);if(1===t)return n;var i=A.get(t-1),r=n.getQuadrant(),e=i.getQuadrant();return Tr.isNorthern(r)&&Tr.isNorthern(e)?n:Tr.isNorthern(r)||Tr.isNorthern(e)?0!==n.getDy()?n:0!==i.getDy()?i:(mn.shouldNeverReachHere("found two horizontal edges incident on node"),null):i},t.prototype.print=function(A){Pn.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();A.print("out "),n.print(A),A.println(),A.print("in "),n.getSym().print(A),A.println()}},t.prototype.getResultAreaEdges=function(){if(null!==this.or)return this.or;this.or=new Zn;for(var A=this.iterator();A.hasNext();){var t=A.next();(t.isInResult()||t.getSym().isInResult())&&this.or.add(t)}return this.or},t.prototype.updateLabelling=function(A){for(var t=this.iterator();t.hasNext();){var n=t.next().getLabel();n.setAllLocationsIfNull(0,A.getLocation(0)),n.setAllLocationsIfNull(1,A.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var A=null,t=null,n=this.sr.size()-1;n>=0;n--){var i=this.sr.get(n),r=i.getSym();null===t&&(t=r),null!==A&&r.setNext(A),A=i}t.setNext(A)},t.prototype.computeDepths=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=this.findIndex(t),i=t.getDepth(lr.LEFT),r=t.getDepth(lr.RIGHT),e=this.computeDepths(n+1,this.sr.size(),i),s=this.computeDepths(0,n,e);if(s!==r)throw new Dr("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var u=arguments[0],o=arguments[1],h=arguments[2],f=h,c=u;c<o;c++){var a=A.sr.get(c);a.setEdgeDepths(lr.RIGHT,f),f=a.getDepth(lr.LEFT)}return f}},t.prototype.mergeSymLabels=function(){for(var A=this.iterator();A.hasNext();){var t=A.next();t.getLabel().merge(t.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(A){for(var t=null,n=null,i=this.hr,r=this.or.size()-1;r>=0;r--){var e=this.or.get(r),s=e.getSym();switch(null===t&&e.getEdgeRing()===A&&(t=e),i){case this.hr:if(s.getEdgeRing()!==A)continue;n=s,i=this.cr;break;case this.cr:if(e.getEdgeRing()!==A)continue;n.setNextMin(e),i=this.hr}}i===this.cr&&(mn.isTrue(null!==t,"found null for first outgoing dirEdge"),mn.isTrue(t.getEdgeRing()===A,"unable to link last incoming dirEdge"),n.setNextMin(t))},t.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var A=0,t=this.iterator();t.hasNext();){var n=t.next();n.isInResult()&&A++}return A}if(1===arguments.length){for(var i=arguments[0],r=0,e=this.iterator();e.hasNext();){var s=e.next();s.getEdgeRing()===i&&r++}return r}},t.prototype.getLabel=function(){return this.Pn},t.prototype.findCoveredLineEdges=function(){for(var A=$t.NONE,t=this.iterator();t.hasNext();){var n=t.next(),i=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){A=$t.INTERIOR;break}if(i.isInResult()){A=$t.EXTERIOR;break}}}if(A===$t.NONE)return null;for(var r=A,e=this.iterator();e.hasNext();){var s=e.next(),u=s.getSym();s.isLineEdge()?s.getEdge().setCovered(r===$t.INTERIOR):(s.isInResult()&&(r=$t.EXTERIOR),u.isInResult()&&(r=$t.INTERIOR))}},t.prototype.computeLabelling=function(t){A.prototype.computeLabelling.call(this,t),this.Pn=new zr($t.NONE);for(var n=this.iterator();n.hasNext();)for(var i=n.next().getEdge().getLabel(),r=0;r<2;r++){var e=i.getLocation(r);e!==$t.INTERIOR&&e!==$t.BOUNDARY||this.Pn.setLocation(r,$t.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ee),Ne=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.createNode=function(A){return new pr(A,new Ue)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ur),je=function A(){this.wn=null,this.ar=null;var t=arguments[0];this.wn=t,this.ar=A.orientation(t)};je.prototype.compareTo=function(A){return je.compareOriented(this.wn,this.ar,A.wn,A.ar)},je.prototype.interfaces_=function(){return[Wt]},je.prototype.getClass=function(){return je},je.orientation=function(A){return 1===Ai.increasingDirection(A)},je.compareOriented=function(A,t,n,i){for(var r=t?1:-1,e=i?1:-1,s=t?A.length:-1,u=i?n.length:-1,o=t?0:A.length-1,h=i?0:n.length-1;;){var f=A[o].compareTo(n[h]);if(0!==f)return f;var c=(o+=r)===s,a=(h+=e)===u;if(c&&!a)return-1;if(!c&&a)return 1;if(c&&a)return 0}};var Qe=function(){this.ln=new Zn,this.vr=new wi};Qe.prototype.print=function(A){A.print("MULTILINESTRING ( ");for(var t=0;t<this.ln.size();t++){var n=this.ln.get(t);t>0&&A.print(","),A.print("(");for(var i=n.getCoordinates(),r=0;r<i.length;r++)r>0&&A.print(","),A.print(i[r].x+" "+i[r].y);A.println(")")}A.print(")  ")},Qe.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next())},Qe.prototype.findEdgeIndex=function(A){for(var t=0;t<this.ln.size();t++)if(this.ln.get(t).equals(A))return t;return-1},Qe.prototype.iterator=function(){return this.ln.iterator()},Qe.prototype.getEdges=function(){return this.ln},Qe.prototype.get=function(A){return this.ln.get(A)},Qe.prototype.findEqualEdge=function(A){var t=new je(A.getCoordinates());return this.vr.get(t)},Qe.prototype.add=function(A){this.ln.add(A);var t=new je(A.getCoordinates());this.vr.put(t,A)},Qe.prototype.interfaces_=function(){return[]},Qe.prototype.getClass=function(){return Qe};var Se=function(){};Se.prototype.processIntersections=function(A,t,n,i){},Se.prototype.isDone=function(){},Se.prototype.interfaces_=function(){return[]},Se.prototype.getClass=function(){return Se};var Be=function(){this.lr=!1,this.wr=!1,this.Pr=!1,this.gr=!1,this.Cr=null,this.Qi=null,this.Dr=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var A=arguments[0];this.Qi=A};Be.prototype.isTrivialIntersection=function(A,t,n,i){if(A===n&&1===this.Qi.getIntersectionNum()){if(Be.isAdjacentSegments(t,i))return!0;if(A.isClosed()){var r=A.size()-1;if(0===t&&i===r||0===i&&t===r)return!0}}return!1},Be.prototype.getProperIntersectionPoint=function(){return this.Cr},Be.prototype.hasProperInteriorIntersection=function(){return this.Pr},Be.prototype.getLineIntersector=function(){return this.Qi},Be.prototype.hasProperIntersection=function(){return this.wr},Be.prototype.processIntersections=function(A,t,n,i){if(A===n&&t===i)return null;this.numTests++;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this.Qi.computeIntersection(r,e,s,u),this.Qi.hasIntersection()&&(this.numIntersections++,this.Qi.isInteriorIntersection()&&(this.numInteriorIntersections++,this.gr=!0),this.isTrivialIntersection(A,t,n,i)||(this.lr=!0,A.addIntersections(this.Qi,t,0),n.addIntersections(this.Qi,i,1),this.Qi.isProper()&&(this.numProperIntersections++,this.wr=!0,this.Pr=!0)))},Be.prototype.hasIntersection=function(){return this.lr},Be.prototype.isDone=function(){return!1},Be.prototype.hasInteriorIntersection=function(){return this.gr},Be.prototype.interfaces_=function(){return[Se]},Be.prototype.getClass=function(){return Be},Be.isAdjacentSegments=function(A,t){return 1===Math.abs(A-t)};var Re=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var A=arguments[0],t=arguments[1],n=arguments[2];this.coord=new _t(A),this.segmentIndex=t,this.dist=n};Re.prototype.getSegmentIndex=function(){return this.segmentIndex},Re.prototype.getCoordinate=function(){return this.coord},Re.prototype.print=function(A){A.print(this.coord),A.print(" seg # = "+this.segmentIndex),A.println(" dist = "+this.dist)},Re.prototype.compareTo=function(A){return this.compare(A.segmentIndex,A.dist)},Re.prototype.isEndPoint=function(A){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===A},Re.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Re.prototype.getDistance=function(){return this.dist},Re.prototype.compare=function(A,t){return this.segmentIndex<A?-1:this.segmentIndex>A?1:this.dist<t?-1:this.dist>t?1:0},Re.prototype.interfaces_=function(){return[Wt]},Re.prototype.getClass=function(){return Re};var ke=function(){this.ri=new wi,this.edge=null;var A=arguments[0];this.edge=A};ke.prototype.print=function(A){A.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(A)},ke.prototype.iterator=function(){return this.ri.values().iterator()},ke.prototype.addSplitEdges=function(A){this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next(),r=this.createSplitEdge(n,i);A.add(r),n=i}},ke.prototype.addEndpoints=function(){var A=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[A],A,0)},ke.prototype.createSplitEdge=function(A,t){var n=t.segmentIndex-A.segmentIndex+2,r=t.dist>0||!t.coord.equals2D(this.edge.pts[t.segmentIndex]);r||n--;var e=new Array(n).fill(null),s=0;e[s++]=new _t(A.coord);for(var u=A.segmentIndex+1;u<=t.segmentIndex;u++)e[s++]=this.edge.pts[u];return r&&(e[s]=t.coord),new Ve(e,new zr(this.edge.Pn))},ke.prototype.add=function(A,t,n){var i=new Re(A,t,n),r=this.ri.get(i);return null!==r?r:(this.ri.put(i,i),i)},ke.prototype.isIntersection=function(A){for(var t=this.iterator();t.hasNext();)if(t.next().coord.equals(A))return!0;return!1},ke.prototype.interfaces_=function(){return[]},ke.prototype.getClass=function(){return ke};var Ge=function(){};Ge.prototype.getChainStartIndices=function(A){var t=0,n=new Zn;n.add(new sn(t));do{var i=this.findChainEnd(A,t);n.add(new sn(i)),t=i}while(t<A.length-1);return Ge.toIntArray(n)},Ge.prototype.findChainEnd=function(A,t){for(var n=Tr.quadrant(A[t],A[t+1]),i=t+1;i<A.length&&Tr.quadrant(A[i-1],A[i])===n;)i++;return i-1},Ge.prototype.interfaces_=function(){return[]},Ge.prototype.getClass=function(){return Ge},Ge.toIntArray=function(A){for(var t=new Array(A.size()).fill(null),n=0;n<t.length;n++)t[n]=A.get(n).intValue();return t};var Ye=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Cn,this.env2=new Cn;var A=arguments[0];this.e=A,this.pts=A.getCoordinates();var t=new Ge;this.startIndex=t.getChainStartIndices(this.pts)};Ye.prototype.getCoordinates=function(){return this.pts},Ye.prototype.getMaxX=function(A){var t=this.pts[this.startIndex[A]].x,n=this.pts[this.startIndex[A+1]].x;return t>n?t:n},Ye.prototype.getMinX=function(A){var t=this.pts[this.startIndex[A]].x,n=this.pts[this.startIndex[A+1]].x;return t<n?t:n},Ye.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[A],this.startIndex[A+1],t,t.startIndex[n],t.startIndex[n+1],i)}else if(6===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3],o=arguments[4],h=arguments[5],f=this.pts[r],c=this.pts[e],a=s.pts[u],v=s.pts[o];if(e-r==1&&o-u==1)return h.addIntersections(this.e,r,s.e,u),null;if(this.env1.init(f,c),this.env2.init(a,v),!this.env1.intersects(this.env2))return null;var l=Math.trunc((r+e)/2),w=Math.trunc((u+o)/2);r<l&&(u<w&&this.computeIntersectsForChain(r,l,s,u,w,h),w<o&&this.computeIntersectsForChain(r,l,s,w,o,h)),l<e&&(u<w&&this.computeIntersectsForChain(l,e,s,u,w,h),w<o&&this.computeIntersectsForChain(l,e,s,w,o,h))}},Ye.prototype.getStartIndexes=function(){return this.startIndex},Ye.prototype.computeIntersects=function(A,t){for(var n=0;n<this.startIndex.length-1;n++)for(var i=0;i<A.startIndex.length-1;i++)this.computeIntersectsForChain(n,A,i,t)},Ye.prototype.interfaces_=function(){return[]},Ye.prototype.getClass=function(){return Ye};var qe=function A(){this.Sn=Array(2).fill().map((function(){return Array(3)}));for(var t=0;t<2;t++)for(var n=0;n<3;n++)this.Sn[t][n]=A.NULL_VALUE},We={NULL_VALUE:{configurable:!0}};qe.prototype.getDepth=function(A,t){return this.Sn[A][t]},qe.prototype.setDepth=function(A,t,n){this.Sn[A][t]=n},qe.prototype.isNull=function(){var A=this;if(0===arguments.length){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(A.Sn[t][n]!==qe.NULL_VALUE)return!1;return!0}if(1===arguments.length){var i=arguments[0];return this.Sn[i][1]===qe.NULL_VALUE}if(2===arguments.length){var r=arguments[0],e=arguments[1];return this.Sn[r][e]===qe.NULL_VALUE}},qe.prototype.normalize=function(){for(var A=0;A<2;A++)if(!this.isNull(A)){var t=this.Sn[A][1];this.Sn[A][2]<t&&(t=this.Sn[A][2]),t<0&&(t=0);for(var n=1;n<3;n++){var i=0;this.Sn[A][n]>t&&(i=1),this.Sn[A][n]=i}}},qe.prototype.getDelta=function(A){return this.Sn[A][lr.RIGHT]-this.Sn[A][lr.LEFT]},qe.prototype.getLocation=function(A,t){return this.Sn[A][t]<=0?$t.EXTERIOR:$t.INTERIOR},qe.prototype.toString=function(){return"A: "+this.Sn[0][1]+","+this.Sn[0][2]+" B: "+this.Sn[1][1]+","+this.Sn[1][2]},qe.prototype.add=function(){var A=this;if(1===arguments.length)for(var t=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var r=t.getLocation(n,i);r!==$t.EXTERIOR&&r!==$t.INTERIOR||(A.isNull(n,i)?A.Sn[n][i]=qe.depthAtLocation(r):A.Sn[n][i]+=qe.depthAtLocation(r))}else if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2];u===$t.INTERIOR&&this.Sn[e][s]++}},qe.prototype.interfaces_=function(){return[]},qe.prototype.getClass=function(){return qe},qe.depthAtLocation=function(A){return A===$t.EXTERIOR?0:A===$t.INTERIOR?1:qe.NULL_VALUE},We.NULL_VALUE.get=function(){return-1},Object.defineProperties(qe,We);var Ve=function(A){function t(){if(A.call(this),this.pts=null,this.cn=null,this.eiList=new ke(this),this.$t=null,this.Ir=null,this.Mr=!0,this.Sn=new qe,this.br=0,1===arguments.length){var n=arguments[0];t.call(this,n,null)}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.pts=i,this.Pn=r}}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.getDepth=function(){return this.Sn},t.prototype.getCollapsedEdge=function(){var A=new Array(2).fill(null);return A[0]=this.pts[0],A[1]=this.pts[1],new t(A,zr.toLineLabel(this.Pn))},t.prototype.isIsolated=function(){return this.Mr},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(A){this.Mr=A},t.prototype.setName=function(A){this.$t=A},t.prototype.equals=function(A){if(!(A instanceof t))return!1;var n=A;if(this.pts.length!==n.pts.length)return!1;for(var i=!0,r=!0,e=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(n.pts[s])||(i=!1),this.pts[s].equals2D(n.pts[--e])||(r=!1),!i&&!r)return!1;return!0},t.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var A=arguments[0];return this.pts[A]}},t.prototype.print=function(A){A.print("edge "+this.$t+": "),A.print("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&A.print(","),A.print(this.pts[t].x+" "+this.pts[t].y);A.print(")  "+this.Pn+" "+this.br)},t.prototype.computeIM=function(A){t.updateIM(this.Pn,A)},t.prototype.isCollapsed=function(){return!!this.Pn.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this.br},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(A){A.print("edge "+this.$t+": ");for(var t=this.pts.length-1;t>=0;t--)A.print(this.pts[t]+" ");A.println("")},t.prototype.getMonotoneChainEdge=function(){return null===this.Ir&&(this.Ir=new Ye(this)),this.Ir},t.prototype.getEnvelope=function(){if(null===this.cn){this.cn=new Cn;for(var A=0;A<this.pts.length;A++)this.cn.expandToInclude(this.pts[A])}return this.cn},t.prototype.addIntersection=function(A,t,n,i){var r=new _t(A.getIntersection(i)),e=t,s=A.getEdgeDistance(n,i),u=e+1;u<this.pts.length&&(r.equals2D(this.pts[u])&&(e=u,s=0));this.eiList.add(r,e,s)},t.prototype.toString=function(){var A=new en;A.append("edge "+this.$t+": "),A.append("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&A.append(","),A.append(this.pts[t].x+" "+this.pts[t].y);return A.append(")  "+this.Pn+" "+this.br),A.toString()},t.prototype.isPointwiseEqual=function(A){if(this.pts.length!==A.pts.length)return!1;for(var t=0;t<this.pts.length;t++)if(!this.pts[t].equals2D(A.pts[t]))return!1;return!0},t.prototype.setDepthDelta=function(A){this.br=A},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(A,t,n){for(var i=0;i<A.getIntersectionNum();i++)this.addIntersection(A,t,n,i)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(2!==arguments.length)return A.prototype.updateIM.apply(this,arguments);var t=arguments[0],n=arguments[1];n.setAtLeastIfValid(t.getLocation(0,lr.ON),t.getLocation(1,lr.ON),1),t.isArea()&&(n.setAtLeastIfValid(t.getLocation(0,lr.LEFT),t.getLocation(1,lr.LEFT),2),n.setAtLeastIfValid(t.getLocation(0,lr.RIGHT),t.getLocation(1,lr.RIGHT),2))},t}(mr),Ke=function(A){this.zr=null,this.xr=null,this.Kt=null,this.dr=null,this.sr=new Qe,this.ji=A||null};Ke.prototype.setWorkingPrecisionModel=function(A){this.zr=A},Ke.prototype.insertUniqueEdge=function(A){var t=this.sr.findEqualEdge(A);if(null!==t){var n=t.getLabel(),i=A.getLabel();t.isPointwiseEqual(A)||(i=new zr(A.getLabel())).flip(),n.merge(i);var r=Ke.depthDelta(i),e=t.getDepthDelta()+r;t.setDepthDelta(e)}else this.sr.add(A),A.setDepthDelta(Ke.depthDelta(A.getLabel()))},Ke.prototype.buildSubgraphs=function(A,t){for(var n=new Zn,i=A.iterator();i.hasNext();){var r=i.next(),e=r.getRightmostCoordinate(),s=new de(n).getDepth(e);r.computeDepth(s),r.findResultEdges(),n.add(r),t.add(r.getDirectedEdges(),r.getNodes())}},Ke.prototype.createSubgraphs=function(A){for(var t=new Zn,n=A.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new Mr;r.create(i),t.add(r)}}return qr.sort(t,qr.reverseOrder()),t},Ke.prototype.createEmptyResultGeometry=function(){return this.Kt.createPolygon()},Ke.prototype.getNoder=function(A){if(null!==this.xr)return this.xr;var t=new ae,n=new Tn;return n.setPrecisionModel(A),t.setSegmentIntersector(new Be(n)),t},Ke.prototype.buffer=function(A,t){var n=this.zr;null===n&&(n=A.getPrecisionModel()),this.Kt=A.getFactory();var i=new xe(n,this.ji),r=new Le(A,t,i).getCurves();if(r.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(r,n),this.dr=new Nr(new Ne),this.dr.addEdges(this.sr.getEdges());var e=this.createSubgraphs(this.dr),s=new jr(this.Kt);this.buildSubgraphs(e,s);var u=s.getPolygons();return u.size()<=0?this.createEmptyResultGeometry():this.Kt.buildGeometry(u)},Ke.prototype.computeNodedEdges=function(A,t){var n=this.getNoder(t);n.computeNodes(A);for(var i=n.getNodedSubstrings().iterator();i.hasNext();){var r=i.next(),e=r.getCoordinates();if(2!==e.length||!e[0].equals2D(e[1])){var s=r.getData(),u=new Ve(r.getCoordinates(),new zr(s));this.insertUniqueEdge(u)}}},Ke.prototype.setNoder=function(A){this.xr=A},Ke.prototype.interfaces_=function(){return[]},Ke.prototype.getClass=function(){return Ke},Ke.depthDelta=function(A){var t=A.getLocation(0,lr.LEFT),n=A.getLocation(0,lr.RIGHT);return t===$t.INTERIOR&&n===$t.EXTERIOR?1:t===$t.EXTERIOR&&n===$t.INTERIOR?-1:0},Ke.convertSegStrings=function(A){for(var t=new sr,n=new Zn;A.hasNext();){var i=A.next(),r=t.createLineString(i.getCoordinates());n.add(r)}return t.buildGeometry(n)};var He=function(){if(this.yr=null,this.mr=null,this.pr=null,this.Lr=null,this.Tr=!1,2===arguments.length){var A=arguments[0],t=arguments[1];this.yr=A,this.mr=t,this.pr=0,this.Lr=0,this.Tr=!this.isIntegerPrecision()}else if(4===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],e=arguments[3];this.yr=n,this.mr=i,this.pr=r,this.Lr=e,this.Tr=!this.isIntegerPrecision()}};He.prototype.rescale=function(){var A=this;if(tn(arguments[0],Vn))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();A.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var r=arguments[0],e=0;e<r.length;e++)r[e].x=r[e].x/A.mr+A.pr,r[e].y=r[e].y/A.mr+A.Lr;2===r.length&&r[0].equals2D(r[1])&&Pn.out.println(r)}},He.prototype.scale=function(){var A=this;if(tn(arguments[0],Vn)){for(var t=arguments[0],n=new Zn,i=t.iterator();i.hasNext();){var r=i.next();n.add(new re(A.scale(r.getCoordinates()),r.getData()))}return n}if(arguments[0]instanceof Array){for(var e=arguments[0],s=new Array(e.length).fill(null),u=0;u<e.length;u++)s[u]=new _t(Math.round((e[u].x-A.pr)*A.mr),Math.round((e[u].y-A.Lr)*A.mr),e[u].z);var o=Ai.removeRepeatedPoints(s);return o}},He.prototype.isIntegerPrecision=function(){return 1===this.mr},He.prototype.getNodedSubstrings=function(){var A=this.yr.getNodedSubstrings();return this.Tr&&this.rescale(A),A},He.prototype.computeNodes=function(A){var t=A;this.Tr&&(t=this.scale(A)),this.yr.computeNodes(t)},He.prototype.interfaces_=function(){return[fe]},He.prototype.getClass=function(){return He};var _e=function(){this.Qi=new Tn,this.Or=null;var A=arguments[0];this.Or=A},Je={fact:{configurable:!0}};_e.prototype.checkEndPtVertexIntersections=function(){var A=this;if(0===arguments.length)for(var t=this.Or.iterator();t.hasNext();){var n=t.next(),i=n.getCoordinates();A.checkEndPtVertexIntersections(i[0],A.Or),A.checkEndPtVertexIntersections(i[i.length-1],A.Or)}else if(2===arguments.length)for(var r=arguments[0],e=arguments[1],s=e.iterator();s.hasNext();)for(var u=s.next(),o=u.getCoordinates(),h=1;h<o.length-1;h++)if(o[h].equals(r))throw new dn("found endpt/interior pt intersection at index "+h+" :pt "+r)},_e.prototype.checkInteriorIntersections=function(){var A=this;if(0===arguments.length)for(var t=this.Or.iterator();t.hasNext();)for(var n=t.next(),i=this.Or.iterator();i.hasNext();){var r=i.next();A.checkInteriorIntersections(n,r)}else if(2===arguments.length)for(var e=arguments[0],s=arguments[1],u=e.getCoordinates(),o=s.getCoordinates(),h=0;h<u.length-1;h++)for(var f=0;f<o.length-1;f++)A.checkInteriorIntersections(e,h,s,f);else if(4===arguments.length){var c=arguments[0],a=arguments[1],v=arguments[2],l=arguments[3];if(c===v&&a===l)return null;var w=c.getCoordinates()[a],P=c.getCoordinates()[a+1],g=v.getCoordinates()[l],C=v.getCoordinates()[l+1];if(this.Qi.computeIntersection(w,P,g,C),this.Qi.hasIntersection()&&(this.Qi.isProper()||this.hasInteriorIntersection(this.Qi,w,P)||this.hasInteriorIntersection(this.Qi,g,C)))throw new dn("found non-noded intersection at "+w+"-"+P+" and "+g+"-"+C)}},_e.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},_e.prototype.checkCollapses=function(){var A=this;if(0===arguments.length)for(var t=this.Or.iterator();t.hasNext();){var n=t.next();A.checkCollapses(n)}else if(1===arguments.length)for(var i=arguments[0],r=i.getCoordinates(),e=0;e<r.length-2;e++)A.checkCollapse(r[e],r[e+1],r[e+2])},_e.prototype.hasInteriorIntersection=function(A,t,n){for(var i=0;i<A.getIntersectionNum();i++){var r=A.getIntersection(i);if(!r.equals(t)&&!r.equals(n))return!0}return!1},_e.prototype.checkCollapse=function(A,t,n){if(A.equals(n))throw new dn("found non-noded collapse at "+_e.fact.createLineString([A,t,n]))},_e.prototype.interfaces_=function(){return[]},_e.prototype.getClass=function(){return _e},Je.fact.get=function(){return new sr},Object.defineProperties(_e,Je);var Ze=function(){this.Qi=null,this.Fr=null,this.Er=null,this.Ur=null,this.Nr=null,this.jr=null,this.mr=null,this.It=null,this.Mt=null,this.bt=null,this.zt=null,this.Qr=new Array(4).fill(null),this.Sr=null;var A=arguments[0],t=arguments[1],n=arguments[2];if(this.Er=A,this.Fr=A,this.mr=t,this.Qi=n,t<=0)throw new Gt("Scale factor must be non-zero");1!==t&&(this.Fr=new _t(this.scale(A.x),this.scale(A.y)),this.Nr=new _t,this.jr=new _t),this.initCorners(this.Fr)},Xe={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Ze.prototype.intersectsScaled=function(A,t){var n=Math.min(A.x,t.x),i=Math.max(A.x,t.x),r=Math.min(A.y,t.y),e=Math.max(A.y,t.y),s=this.Mt<n||this.It>i||this.zt<r||this.bt>e;if(s)return!1;var u=this.intersectsToleranceSquare(A,t);return mn.isTrue(!(s&&u),"Found bad envelope test"),u},Ze.prototype.initCorners=function(A){this.It=A.x-.5,this.Mt=A.x+.5,this.bt=A.y-.5,this.zt=A.y+.5,this.Qr[0]=new _t(this.Mt,this.zt),this.Qr[1]=new _t(this.It,this.zt),this.Qr[2]=new _t(this.It,this.bt),this.Qr[3]=new _t(this.Mt,this.bt)},Ze.prototype.intersects=function(A,t){return 1===this.mr?this.intersectsScaled(A,t):(this.copyScaled(A,this.Nr),this.copyScaled(t,this.jr),this.intersectsScaled(this.Nr,this.jr))},Ze.prototype.scale=function(A){return Math.round(A*this.mr)},Ze.prototype.getCoordinate=function(){return this.Er},Ze.prototype.copyScaled=function(A,t){t.x=this.scale(A.x),t.y=this.scale(A.y)},Ze.prototype.getSafeEnvelope=function(){if(null===this.Sr){var A=Ze.SAFE_ENV_EXPANSION_FACTOR/this.mr;this.Sr=new Cn(this.Er.x-A,this.Er.x+A,this.Er.y-A,this.Er.y+A)}return this.Sr},Ze.prototype.intersectsPixelClosure=function(A,t){return this.Qi.computeIntersection(A,t,this.Qr[0],this.Qr[1]),!!(this.Qi.hasIntersection()||(this.Qi.computeIntersection(A,t,this.Qr[1],this.Qr[2]),this.Qi.hasIntersection()||(this.Qi.computeIntersection(A,t,this.Qr[2],this.Qr[3]),this.Qi.hasIntersection()||(this.Qi.computeIntersection(A,t,this.Qr[3],this.Qr[0]),this.Qi.hasIntersection()))))},Ze.prototype.intersectsToleranceSquare=function(A,t){var n=!1,i=!1;return this.Qi.computeIntersection(A,t,this.Qr[0],this.Qr[1]),!!(this.Qi.isProper()||(this.Qi.computeIntersection(A,t,this.Qr[1],this.Qr[2]),this.Qi.isProper()||(this.Qi.hasIntersection()&&(n=!0),this.Qi.computeIntersection(A,t,this.Qr[2],this.Qr[3]),this.Qi.isProper()||(this.Qi.hasIntersection()&&(i=!0),this.Qi.computeIntersection(A,t,this.Qr[3],this.Qr[0]),this.Qi.isProper()||n&&i||A.equals(this.Fr)||t.equals(this.Fr)))))},Ze.prototype.addSnappedNode=function(A,t){var n=A.getCoordinate(t),i=A.getCoordinate(t+1);return!!this.intersects(n,i)&&(A.addIntersection(this.getCoordinate(),t),!0)},Ze.prototype.interfaces_=function(){return[]},Ze.prototype.getClass=function(){return Ze},Xe.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(Ze,Xe);var $e=function(){this.tempEnv1=new Cn,this.selectedSegment=new ee};$e.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var A=arguments[0],t=arguments[1];A.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},$e.prototype.interfaces_=function(){return[]},$e.prototype.getClass=function(){return $e};var As=function(){this.wi=null;var A=arguments[0];this.wi=A},ts={HotPixelSnapAction:{configurable:!0}};As.prototype.snap=function(){if(1===arguments.length){var A=arguments[0];return this.snap(A,null,-1)}if(3===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2],r=t.getSafeEnvelope(),e=new ns(t,n,i);return this.wi.query(r,{interfaces_:function(){return[Rr]},visitItem:function(A){A.select(r,e)}}),e.isNodeAdded()}},As.prototype.interfaces_=function(){return[]},As.prototype.getClass=function(){return As},ts.HotPixelSnapAction.get=function(){return ns},Object.defineProperties(As,ts);var ns=function(A){function t(){A.call(this),this.Br=null,this.Rr=null,this.kr=null,this.Gr=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this.Br=t,this.Rr=n,this.kr=i}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.isNodeAdded=function(){return this.Gr},t.prototype.select=function(){if(2!==arguments.length)return A.prototype.select.apply(this,arguments);var t=arguments[0],n=arguments[1],i=t.getContext();if(null!==this.Rr&&i===this.Rr&&n===this.kr)return null;this.Gr=this.Br.addSnappedNode(i,n)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}($e),is=function(){this.Qi=null,this.Yr=null;var A=arguments[0];this.Qi=A,this.Yr=new Zn};is.prototype.processIntersections=function(A,t,n,i){if(A===n&&t===i)return null;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];if(this.Qi.computeIntersection(r,e,s,u),this.Qi.hasIntersection()&&this.Qi.isInteriorIntersection()){for(var o=0;o<this.Qi.getIntersectionNum();o++)this.Yr.add(this.Qi.getIntersection(o));A.addIntersections(this.Qi,t,0),n.addIntersections(this.Qi,i,1)}},is.prototype.isDone=function(){return!1},is.prototype.getInteriorIntersections=function(){return this.Yr},is.prototype.interfaces_=function(){return[Se]},is.prototype.getClass=function(){return is};var rs=function(){this.qr=null,this.Qi=null,this.mr=null,this.yr=null,this.Wr=null,this.gi=null;var A=arguments[0];this.qr=A,this.Qi=new Tn,this.Qi.setPrecisionModel(A),this.mr=A.getScale()};rs.prototype.checkCorrectness=function(A){var t=re.getNodedSubstrings(A),n=new _e(t);try{n.checkValid()}catch(A){if(!(A instanceof ln))throw A;A.printStackTrace()}},rs.prototype.getNodedSubstrings=function(){return re.getNodedSubstrings(this.gi)},rs.prototype.snapRound=function(A,t){var n=this.findInteriorIntersections(A,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(A)},rs.prototype.findInteriorIntersections=function(A,t){var n=new is(t);return this.yr.setSegmentIntersector(n),this.yr.computeNodes(A),n.getInteriorIntersections()},rs.prototype.computeVertexSnaps=function(){var A=this;if(tn(arguments[0],Vn))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();A.computeVertexSnaps(i)}else if(arguments[0]instanceof re)for(var r=arguments[0],e=r.getCoordinates(),s=0;s<e.length;s++){var u=new Ze(e[s],A.mr,A.Qi),o=A.Wr.snap(u,r,s);o&&r.addIntersection(e[s],s)}},rs.prototype.computeNodes=function(A){this.gi=A,this.yr=new ae,this.Wr=new As(this.yr.getIndex()),this.snapRound(A,this.Qi)},rs.prototype.computeIntersectionSnaps=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next(),i=new Ze(n,this.mr,this.Qi);this.Wr.snap(i)}},rs.prototype.interfaces_=function(){return[fe]},rs.prototype.getClass=function(){return rs};var es=function(){if(this.Vr=null,this._n=null,this.ji=new le,this.Kr=null,this.Hr=null,1===arguments.length){var A=arguments[0];this.Vr=A}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.Vr=t,this.ji=n}},ss={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};es.prototype.bufferFixedPrecision=function(A){var t=new He(new rs(new nr(1)),A.getScale()),n=new Ke(this.ji);n.setWorkingPrecisionModel(A),n.setNoder(t),this.Kr=n.buffer(this.Vr,this._n)},es.prototype.bufferReducedPrecision=function(){var A=this;if(0===arguments.length){for(var t=es.MAX_PRECISION_DIGITS;t>=0;t--){try{A.bufferReducedPrecision(t)}catch(t){if(!(t instanceof Dr))throw t;A.Hr=t}if(null!==A.Kr)return null}throw this.Hr}if(1===arguments.length){var n=arguments[0],i=es.precisionScaleFactor(this.Vr,this._n,n),r=new nr(i);this.bufferFixedPrecision(r)}},es.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this.Kr)return null;var A=this.Vr.getFactory().getPrecisionModel();A.getType()===nr.FIXED?this.bufferFixedPrecision(A):this.bufferReducedPrecision()},es.prototype.setQuadrantSegments=function(A){this.ji.setQuadrantSegments(A)},es.prototype.bufferOriginalPrecision=function(){try{var A=new Ke(this.ji);this.Kr=A.buffer(this.Vr,this._n)}catch(A){if(!(A instanceof dn))throw A;this.Hr=A}},es.prototype.getResultGeometry=function(A){return this._n=A,this.computeGeometry(),this.Kr},es.prototype.setEndCapStyle=function(A){this.ji.setEndCapStyle(A)},es.prototype.interfaces_=function(){return[]},es.prototype.getClass=function(){return es},es.bufferOp=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new es(A),i=n.getResultGeometry(t);return i}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof jn&&"number"==typeof arguments[1]){var r=arguments[0],e=arguments[1],s=arguments[2],u=new es(r);u.setQuadrantSegments(s);var o=u.getResultGeometry(e);return o}if(arguments[2]instanceof le&&arguments[0]instanceof jn&&"number"==typeof arguments[1]){var h=arguments[0],f=arguments[1],c=arguments[2],a=new es(h,c),v=a.getResultGeometry(f);return v}}else if(4===arguments.length){var l=arguments[0],w=arguments[1],P=arguments[2],g=arguments[3],C=new es(l);C.setQuadrantSegments(P),C.setEndCapStyle(g);var D=C.getResultGeometry(w);return D}},es.precisionScaleFactor=function(A,t,n){var i=A.getEnvelopeInternal(),r=nn.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY()))+2*(t>0?t:0),e=n-Math.trunc(Math.log(r)/Math.log(10)+1);return Math.pow(10,e)},ss.CAP_ROUND.get=function(){return le.CAP_ROUND},ss.CAP_BUTT.get=function(){return le.CAP_FLAT},ss.CAP_FLAT.get=function(){return le.CAP_FLAT},ss.CAP_SQUARE.get=function(){return le.CAP_SQUARE},ss.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(es,ss);var us=function(){this.Fr=[new _t,new _t],this._n=Yt.NaN,this._r=!0};us.prototype.getCoordinates=function(){return this.Fr},us.prototype.getCoordinate=function(A){return this.Fr[A]},us.prototype.setMinimum=function(){if(1===arguments.length){var A=arguments[0];this.setMinimum(A.Fr[0],A.Fr[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this._r)return this.initialize(t,n),null;var i=t.distance(n);i<this._n&&this.initialize(t,n,i)}},us.prototype.initialize=function(){if(0===arguments.length)this._r=!0;else if(2===arguments.length){var A=arguments[0],t=arguments[1];this.Fr[0].setCoordinate(A),this.Fr[1].setCoordinate(t),this._n=A.distance(t),this._r=!1}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.Fr[0].setCoordinate(n),this.Fr[1].setCoordinate(i),this._n=r,this._r=!1}},us.prototype.getDistance=function(){return this._n},us.prototype.setMaximum=function(){if(1===arguments.length){var A=arguments[0];this.setMaximum(A.Fr[0],A.Fr[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this._r)return this.initialize(t,n),null;var i=t.distance(n);i>this._n&&this.initialize(t,n,i)}},us.prototype.interfaces_=function(){return[]},us.prototype.getClass=function(){return us};var os=function(){};os.prototype.interfaces_=function(){return[]},os.prototype.getClass=function(){return os},os.computeDistance=function(){if(arguments[2]instanceof us&&arguments[0]instanceof Si&&arguments[1]instanceof _t)for(var A=arguments[0],t=arguments[1],n=arguments[2],i=A.getCoordinates(),r=new ee,e=0;e<i.length-1;e++){r.setCoordinates(i[e],i[e+1]);var s=r.closestPoint(t);n.setMinimum(s,t)}else if(arguments[2]instanceof us&&arguments[0]instanceof Gi&&arguments[1]instanceof _t){var u=arguments[0],o=arguments[1],h=arguments[2];os.computeDistance(u.getExteriorRing(),o,h);for(var f=0;f<u.getNumInteriorRing();f++)os.computeDistance(u.getInteriorRingN(f),o,h)}else if(arguments[2]instanceof us&&arguments[0]instanceof jn&&arguments[1]instanceof _t){var c=arguments[0],a=arguments[1],v=arguments[2];if(c instanceof Si)os.computeDistance(c,a,v);else if(c instanceof Gi)os.computeDistance(c,a,v);else if(c instanceof di)for(var l=c,w=0;w<l.getNumGeometries();w++){var P=l.getGeometryN(w);os.computeDistance(P,a,v)}else v.setMinimum(c.getCoordinate(),a)}else if(arguments[2]instanceof us&&arguments[0]instanceof ee&&arguments[1]instanceof _t){var g=arguments[0],C=arguments[1],D=arguments[2],I=g.closestPoint(C);D.setMinimum(I,C)}};var hs=function(A){this.Jr=new us,this.Xi=A||null},fs={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};hs.prototype.computeMaxMidpointDistance=function(A){var t=new as(this.Xi);A.apply(t),this.Jr.setMaximum(t.getMaxPointDistance())},hs.prototype.computeMaxVertexDistance=function(A){var t=new cs(this.Xi);A.apply(t),this.Jr.setMaximum(t.getMaxPointDistance())},hs.prototype.findDistance=function(A){return this.computeMaxVertexDistance(A),this.computeMaxMidpointDistance(A),this.Jr.getDistance()},hs.prototype.getDistancePoints=function(){return this.Jr},hs.prototype.interfaces_=function(){return[]},hs.prototype.getClass=function(){return hs},fs.MaxPointDistanceFilter.get=function(){return cs},fs.MaxMidpointDistanceFilter.get=function(){return as},Object.defineProperties(hs,fs);var cs=function(A){this.Jr=new us,this.Zr=new us,this.Vt=A||null};cs.prototype.filter=function(A){this.Zr.initialize(),os.computeDistance(this.Vt,A,this.Zr),this.Jr.setMaximum(this.Zr)},cs.prototype.getMaxPointDistance=function(){return this.Jr},cs.prototype.interfaces_=function(){return[Bn]},cs.prototype.getClass=function(){return cs};var as=function(A){this.Jr=new us,this.Zr=new us,this.Vt=A||null};as.prototype.filter=function(A,t){if(0===t)return null;var n=A.getCoordinate(t-1),i=A.getCoordinate(t),r=new _t((n.x+i.x)/2,(n.y+i.y)/2);this.Zr.initialize(),os.computeDistance(this.Vt,r,this.Zr),this.Jr.setMaximum(this.Zr)},as.prototype.isDone=function(){return!1},as.prototype.isGeometryChanged=function(){return!1},as.prototype.getMaxPointDistance=function(){return this.Jr},as.prototype.interfaces_=function(){return[xi]},as.prototype.getClass=function(){return as};var vs=function(A){this.Xr=A||null};vs.prototype.filter=function(A){A instanceof Gi&&this.Xr.add(A)},vs.prototype.interfaces_=function(){return[zi]},vs.prototype.getClass=function(){return vs},vs.getPolygons=function(){if(1===arguments.length){var A=arguments[0];return vs.getPolygons(A,new Zn)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t instanceof Gi?n.add(t):t instanceof di&&t.apply(new vs(n)),n}};var ls=function(){if(this.$r=null,this.Ae=!1,1===arguments.length){var A=arguments[0];this.$r=A}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.$r=t,this.Ae=n}};ls.prototype.filter=function(A){if(this.Ae&&A instanceof qi){var t=A.getFactory().createLineString(A.getCoordinateSequence());return this.$r.add(t),null}A instanceof Si&&this.$r.add(A)},ls.prototype.setForceToLineString=function(A){this.Ae=A},ls.prototype.interfaces_=function(){return[Nn]},ls.prototype.getClass=function(){return ls},ls.getGeometry=function(){if(1===arguments.length){var A=arguments[0];return A.getFactory().buildGeometry(ls.getLines(A))}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t.getFactory().buildGeometry(ls.getLines(t,n))}},ls.getLines=function(){if(1===arguments.length){var A=arguments[0];return ls.getLines(A,!1)}if(2===arguments.length){if(tn(arguments[0],Vn)&&tn(arguments[1],Vn)){for(var t=arguments[0],n=arguments[1],i=t.iterator();i.hasNext();){var r=i.next();ls.getLines(r,n)}return n}if(arguments[0]instanceof jn&&"boolean"==typeof arguments[1]){var e=arguments[0],s=arguments[1],u=new Zn;return e.apply(new ls(u,s)),u}if(arguments[0]instanceof jn&&tn(arguments[1],Vn)){var o=arguments[0],h=arguments[1];return o instanceof Si?h.add(o):o.apply(new ls(h)),h}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&tn(arguments[0],Vn)&&tn(arguments[1],Vn)){for(var f=arguments[0],c=arguments[1],a=arguments[2],v=f.iterator();v.hasNext();){var l=v.next();ls.getLines(l,c,a)}return c}if("boolean"==typeof arguments[2]&&arguments[0]instanceof jn&&tn(arguments[1],Vn)){var w=arguments[0],P=arguments[1],g=arguments[2];return w.apply(new ls(P,g)),P}}};var ws=function(){if(this.te=Rn.OGC_SFS_BOUNDARY_RULE,this.ne=null,this.ie=null,0===arguments.length);else if(1===arguments.length){var A=arguments[0];if(null===A)throw new Gt("Rule must be non-null");this.te=A}};ws.prototype.locateInternal=function(){var A=this;if(arguments[0]instanceof _t&&arguments[1]instanceof Gi){var t=arguments[0],n=arguments[1];if(n.isEmpty())return $t.EXTERIOR;var i=n.getExteriorRing(),r=this.locateInPolygonRing(t,i);if(r===$t.EXTERIOR)return $t.EXTERIOR;if(r===$t.BOUNDARY)return $t.BOUNDARY;for(var e=0;e<n.getNumInteriorRing();e++){var s=n.getInteriorRingN(e),u=A.locateInPolygonRing(t,s);if(u===$t.INTERIOR)return $t.EXTERIOR;if(u===$t.BOUNDARY)return $t.BOUNDARY}return $t.INTERIOR}if(arguments[0]instanceof _t&&arguments[1]instanceof Si){var o=arguments[0],h=arguments[1];if(!h.getEnvelopeInternal().intersects(o))return $t.EXTERIOR;var f=h.getCoordinates();return h.isClosed()||!o.equals(f[0])&&!o.equals(f[f.length-1])?En.isOnLine(o,f)?$t.INTERIOR:$t.EXTERIOR:$t.BOUNDARY}if(arguments[0]instanceof _t&&arguments[1]instanceof Ri){var c=arguments[0],a=arguments[1],v=a.getCoordinate();return v.equals2D(c)?$t.INTERIOR:$t.EXTERIOR}},ws.prototype.locateInPolygonRing=function(A,t){return t.getEnvelopeInternal().intersects(A)?En.locatePointInRing(A,t.getCoordinates()):$t.EXTERIOR},ws.prototype.intersects=function(A,t){return this.locate(A,t)!==$t.EXTERIOR},ws.prototype.updateLocationInfo=function(A){A===$t.INTERIOR&&(this.ne=!0),A===$t.BOUNDARY&&this.ie++},ws.prototype.computeLocation=function(A,t){if(t instanceof Ri&&this.updateLocationInfo(this.locateInternal(A,t)),t instanceof Si)this.updateLocationInfo(this.locateInternal(A,t));else if(t instanceof Gi)this.updateLocationInfo(this.locateInternal(A,t));else if(t instanceof yi)for(var n=t,i=0;i<n.getNumGeometries();i++){var r=n.getGeometryN(i);this.updateLocationInfo(this.locateInternal(A,r))}else if(t instanceof Wi)for(var e=t,s=0;s<e.getNumGeometries();s++){var u=e.getGeometryN(s);this.updateLocationInfo(this.locateInternal(A,u))}else if(t instanceof di)for(var o=new Oe(t);o.hasNext();){var h=o.next();h!==t&&this.computeLocation(A,h)}},ws.prototype.locate=function(A,t){return t.isEmpty()?$t.EXTERIOR:t instanceof Si||t instanceof Gi?this.locateInternal(A,t):(this.ne=!1,this.ie=0,this.computeLocation(A,t),this.te.isInBoundary(this.ie)?$t.BOUNDARY:this.ie>0||this.ne?$t.INTERIOR:$t.EXTERIOR)},ws.prototype.interfaces_=function(){return[]},ws.prototype.getClass=function(){return ws};var Ps=function A(){if(this.re=null,this.ee=null,this.Fr=null,2===arguments.length){var t=arguments[0],n=arguments[1];A.call(this,t,A.INSIDE_AREA,n)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];this.re=i,this.ee=r,this.Fr=e}},gs={INSIDE_AREA:{configurable:!0}};Ps.prototype.isInsideArea=function(){return this.ee===Ps.INSIDE_AREA},Ps.prototype.getCoordinate=function(){return this.Fr},Ps.prototype.getGeometryComponent=function(){return this.re},Ps.prototype.getSegmentIndex=function(){return this.ee},Ps.prototype.interfaces_=function(){return[]},Ps.prototype.getClass=function(){return Ps},gs.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Ps,gs);var Cs=function(A){this.wn=A||null};Cs.prototype.filter=function(A){A instanceof Ri&&this.wn.add(A)},Cs.prototype.interfaces_=function(){return[zi]},Cs.prototype.getClass=function(){return Cs},Cs.getPoints=function(){if(1===arguments.length){var A=arguments[0];return A instanceof Ri?qr.singletonList(A):Cs.getPoints(A,new Zn)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t instanceof Ri?n.add(t):t instanceof di&&t.apply(new Cs(n)),n}};var Ds=function(){this.se=null;var A=arguments[0];this.se=A};Ds.prototype.filter=function(A){(A instanceof Ri||A instanceof Si||A instanceof Gi)&&this.se.add(new Ps(A,0,A.getCoordinate()))},Ds.prototype.interfaces_=function(){return[zi]},Ds.prototype.getClass=function(){return Ds},Ds.getLocations=function(A){var t=new Zn;return A.apply(new Ds(t)),t};var Is=function(){if(this.Vt=null,this.ue=0,this.oe=new ws,this.he=null,this.fe=Yt.MAX_VALUE,2===arguments.length){var A=arguments[0],t=arguments[1];this.Vt=[A,t],this.ue=0}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.Vt=new Array(2).fill(null),this.Vt[0]=n,this.Vt[1]=i,this.ue=r}};Is.prototype.computeContainmentDistance=function(){var A=this;if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this.fe<=this.ue)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=1-n,e=vs.getPolygons(this.Vt[n]);if(e.size()>0){var s=Ds.getLocations(this.Vt[r]);if(this.computeContainmentDistance(s,e,i),this.fe<=this.ue)return this.he[r]=i[0],this.he[n]=i[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&tn(arguments[0],_n)&&tn(arguments[1],_n)){for(var u=arguments[0],o=arguments[1],h=arguments[2],f=0;f<u.size();f++)for(var c=u.get(f),a=0;a<o.size();a++)if(A.computeContainmentDistance(c,o.get(a),h),A.fe<=A.ue)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Ps&&arguments[1]instanceof Gi){var v=arguments[0],l=arguments[1],w=arguments[2],P=v.getCoordinate();if($t.EXTERIOR!==this.oe.locate(P,l))return this.fe=0,w[0]=v,w[1]=new Ps(l,P),null}},Is.prototype.computeMinDistanceLinesPoints=function(A,t,n){for(var i=0;i<A.size();i++)for(var r=A.get(i),e=0;e<t.size();e++){var s=t.get(e);if(this.computeMinDistance(r,s,n),this.fe<=this.ue)return null}},Is.prototype.computeFacetDistance=function(){var A=new Array(2).fill(null),t=ls.getLines(this.Vt[0]),n=ls.getLines(this.Vt[1]),i=Cs.getPoints(this.Vt[0]),r=Cs.getPoints(this.Vt[1]);return this.computeMinDistanceLines(t,n,A),this.updateMinDistance(A,!1),this.fe<=this.ue?null:(A[0]=null,A[1]=null,this.computeMinDistanceLinesPoints(t,r,A),this.updateMinDistance(A,!1),this.fe<=this.ue?null:(A[0]=null,A[1]=null,this.computeMinDistanceLinesPoints(n,i,A),this.updateMinDistance(A,!0),this.fe<=this.ue?null:(A[0]=null,A[1]=null,this.computeMinDistancePoints(i,r,A),void this.updateMinDistance(A,!1))))},Is.prototype.nearestLocations=function(){return this.computeMinDistance(),this.he},Is.prototype.updateMinDistance=function(A,t){if(null===A[0])return null;t?(this.he[0]=A[1],this.he[1]=A[0]):(this.he[0]=A[0],this.he[1]=A[1])},Is.prototype.nearestPoints=function(){return this.computeMinDistance(),[this.he[0].getCoordinate(),this.he[1].getCoordinate()]},Is.prototype.computeMinDistance=function(){var A=this;if(0===arguments.length){if(null!==this.he)return null;if(this.he=new Array(2).fill(null),this.computeContainmentDistance(),this.fe<=this.ue)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Si&&arguments[1]instanceof Ri){var t=arguments[0],n=arguments[1],i=arguments[2];if(t.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this.fe)return null;for(var r=t.getCoordinates(),e=n.getCoordinate(),s=0;s<r.length-1;s++){var u=En.distancePointLine(e,r[s],r[s+1]);if(u<A.fe){A.fe=u;var o=new ee(r[s],r[s+1]),h=o.closestPoint(e);i[0]=new Ps(t,s,h),i[1]=new Ps(n,0,e)}if(A.fe<=A.ue)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Si&&arguments[1]instanceof Si){var f=arguments[0],c=arguments[1],a=arguments[2];if(f.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this.fe)return null;for(var v=f.getCoordinates(),l=c.getCoordinates(),w=0;w<v.length-1;w++)for(var P=0;P<l.length-1;P++){var g=En.distanceLineLine(v[w],v[w+1],l[P],l[P+1]);if(g<A.fe){A.fe=g;var C=new ee(v[w],v[w+1]),D=new ee(l[P],l[P+1]),I=C.closestPoints(D);a[0]=new Ps(f,w,I[0]),a[1]=new Ps(c,P,I[1])}if(A.fe<=A.ue)return null}}},Is.prototype.computeMinDistancePoints=function(A,t,n){for(var i=0;i<A.size();i++)for(var r=A.get(i),e=0;e<t.size();e++){var s=t.get(e),u=r.getCoordinate().distance(s.getCoordinate());if(u<this.fe&&(this.fe=u,n[0]=new Ps(r,0,r.getCoordinate()),n[1]=new Ps(s,0,s.getCoordinate())),this.fe<=this.ue)return null}},Is.prototype.distance=function(){if(null===this.Vt[0]||null===this.Vt[1])throw new Gt("null geometries are not supported");return this.Vt[0].isEmpty()||this.Vt[1].isEmpty()?0:(this.computeMinDistance(),this.fe)},Is.prototype.computeMinDistanceLines=function(A,t,n){for(var i=0;i<A.size();i++)for(var r=A.get(i),e=0;e<t.size();e++){var s=t.get(e);if(this.computeMinDistance(r,s,n),this.fe<=this.ue)return null}},Is.prototype.interfaces_=function(){return[]},Is.prototype.getClass=function(){return Is},Is.distance=function(A,t){return new Is(A,t).distance()},Is.isWithinDistance=function(A,t,n){return new Is(A,t,n).distance()<=n},Is.nearestPoints=function(A,t){return new Is(A,t).nearestPoints()};var Ms=function(){this.Fr=[new _t,new _t],this._n=Yt.NaN,this._r=!0};Ms.prototype.getCoordinates=function(){return this.Fr},Ms.prototype.getCoordinate=function(A){return this.Fr[A]},Ms.prototype.setMinimum=function(){if(1===arguments.length){var A=arguments[0];this.setMinimum(A.Fr[0],A.Fr[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this._r)return this.initialize(t,n),null;var i=t.distance(n);i<this._n&&this.initialize(t,n,i)}},Ms.prototype.initialize=function(){if(0===arguments.length)this._r=!0;else if(2===arguments.length){var A=arguments[0],t=arguments[1];this.Fr[0].setCoordinate(A),this.Fr[1].setCoordinate(t),this._n=A.distance(t),this._r=!1}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.Fr[0].setCoordinate(n),this.Fr[1].setCoordinate(i),this._n=r,this._r=!1}},Ms.prototype.toString=function(){return xn.toLineString(this.Fr[0],this.Fr[1])},Ms.prototype.getDistance=function(){return this._n},Ms.prototype.setMaximum=function(){if(1===arguments.length){var A=arguments[0];this.setMaximum(A.Fr[0],A.Fr[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this._r)return this.initialize(t,n),null;var i=t.distance(n);i>this._n&&this.initialize(t,n,i)}},Ms.prototype.interfaces_=function(){return[]},Ms.prototype.getClass=function(){return Ms};var bs=function(){};bs.prototype.interfaces_=function(){return[]},bs.prototype.getClass=function(){return bs},bs.computeDistance=function(){if(arguments[2]instanceof Ms&&arguments[0]instanceof Si&&arguments[1]instanceof _t)for(var A=arguments[0],t=arguments[1],n=arguments[2],i=new ee,r=A.getCoordinates(),e=0;e<r.length-1;e++){i.setCoordinates(r[e],r[e+1]);var s=i.closestPoint(t);n.setMinimum(s,t)}else if(arguments[2]instanceof Ms&&arguments[0]instanceof Gi&&arguments[1]instanceof _t){var u=arguments[0],o=arguments[1],h=arguments[2];bs.computeDistance(u.getExteriorRing(),o,h);for(var f=0;f<u.getNumInteriorRing();f++)bs.computeDistance(u.getInteriorRingN(f),o,h)}else if(arguments[2]instanceof Ms&&arguments[0]instanceof jn&&arguments[1]instanceof _t){var c=arguments[0],a=arguments[1],v=arguments[2];if(c instanceof Si)bs.computeDistance(c,a,v);else if(c instanceof Gi)bs.computeDistance(c,a,v);else if(c instanceof di)for(var l=c,w=0;w<l.getNumGeometries();w++){var P=l.getGeometryN(w);bs.computeDistance(P,a,v)}else v.setMinimum(c.getCoordinate(),a)}else if(arguments[2]instanceof Ms&&arguments[0]instanceof ee&&arguments[1]instanceof _t){var g=arguments[0],C=arguments[1],D=arguments[2],I=g.closestPoint(C);D.setMinimum(I,C)}};var zs=function(){this.ce=null,this.ae=null,this.ve=new Ms,this.we=0;var A=arguments[0],t=arguments[1];this.ce=A,this.ae=t},xs={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};zs.prototype.getCoordinates=function(){return this.ve.getCoordinates()},zs.prototype.setDensifyFraction=function(A){if(A>1||A<=0)throw new Gt("Fraction is not in range (0.0 - 1.0]");this.we=A},zs.prototype.compute=function(A,t){this.computeOrientedDistance(A,t,this.ve),this.computeOrientedDistance(t,A,this.ve)},zs.prototype.distance=function(){return this.compute(this.ce,this.ae),this.ve.getDistance()},zs.prototype.computeOrientedDistance=function(A,t,n){var i=new ds(t);if(A.apply(i),n.setMaximum(i.getMaxPointDistance()),this.we>0){var r=new ys(t,this.we);A.apply(r),n.setMaximum(r.getMaxPointDistance())}},zs.prototype.orientedDistance=function(){return this.computeOrientedDistance(this.ce,this.ae,this.ve),this.ve.getDistance()},zs.prototype.interfaces_=function(){return[]},zs.prototype.getClass=function(){return zs},zs.distance=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new zs(A,t);return n.distance()}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=new zs(i,r);return s.setDensifyFraction(e),s.distance()}},xs.MaxPointDistanceFilter.get=function(){return ds},xs.MaxDensifiedByFractionDistanceFilter.get=function(){return ys},Object.defineProperties(zs,xs);var ds=function(){this.Jr=new Ms,this.Zr=new Ms,this.Pe=new bs,this.Vt=null;var A=arguments[0];this.Vt=A};ds.prototype.filter=function(A){this.Zr.initialize(),bs.computeDistance(this.Vt,A,this.Zr),this.Jr.setMaximum(this.Zr)},ds.prototype.getMaxPointDistance=function(){return this.Jr},ds.prototype.interfaces_=function(){return[Bn]},ds.prototype.getClass=function(){return ds};var ys=function(){this.Jr=new Ms,this.Zr=new Ms,this.Vt=null,this.Ce=0;var A=arguments[0],t=arguments[1];this.Vt=A,this.Ce=Math.trunc(Math.round(1/t))};ys.prototype.filter=function(A,t){if(0===t)return null;for(var n=A.getCoordinate(t-1),i=A.getCoordinate(t),r=(i.x-n.x)/this.Ce,e=(i.y-n.y)/this.Ce,s=0;s<this.Ce;s++){var h=new _t(n.x+s*r,n.y+s*e);this.Zr.initialize(),bs.computeDistance(this.Vt,h,this.Zr),this.Jr.setMaximum(this.Zr)}},ys.prototype.isDone=function(){return!1},ys.prototype.isGeometryChanged=function(){return!1},ys.prototype.getMaxPointDistance=function(){return this.Jr},ys.prototype.interfaces_=function(){return[xi]},ys.prototype.getClass=function(){return ys};var ms=function(A,t,n){this.De=null,this.Ie=null,this.Me=null,this.be=null,this.ze=!0,this.xe=null,this.de=null,this.ye=null,this.me=A||null,this.pe=t||null,this.Ot=n||null},ps={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};ms.prototype.checkMaximumDistance=function(A,t,n){var i=new zs(t,A);if(i.setDensifyFraction(.25),this.be=i.orientedDistance(),this.be>n){this.ze=!1;var r=i.getCoordinates();this.de=r[1],this.ye=A.getFactory().createLineString(r),this.xe="Distance between buffer curve and input is too large ("+this.be+" at "+xn.toLineString(r[0],r[1])+")"}},ms.prototype.isValid=function(){var A=Math.abs(this.pe),t=ms.MAX_DISTANCE_DIFF_FRAC*A;return this.De=A-t,this.Ie=A+t,!(!this.me.isEmpty()&&!this.Ot.isEmpty())||(this.pe>0?this.checkPositiveValid():this.checkNegativeValid(),ms.VERBOSE&&Pn.out.println("Min Dist= "+this.Me+"  err= "+(1-this.Me/this.pe)+"  Max Dist= "+this.be+"  err= "+(this.be/this.pe-1)),this.ze)},ms.prototype.checkNegativeValid=function(){if(!(this.me instanceof Gi||this.me instanceof Wi||this.me instanceof di))return null;var A=this.getPolygonLines(this.me);if(this.checkMinimumDistance(A,this.Ot,this.De),!this.ze)return null;this.checkMaximumDistance(A,this.Ot,this.Ie)},ms.prototype.getErrorIndicator=function(){return this.ye},ms.prototype.checkMinimumDistance=function(A,t,n){var i=new Is(A,t,n);if(this.Me=i.distance(),this.Me<n){this.ze=!1;var r=i.nearestPoints();this.de=i.nearestPoints()[1],this.ye=A.getFactory().createLineString(r),this.xe="Distance between buffer curve and input is too small ("+this.Me+" at "+xn.toLineString(r[0],r[1])+" )"}},ms.prototype.checkPositiveValid=function(){var A=this.Ot.getBoundary();if(this.checkMinimumDistance(this.me,A,this.De),!this.ze)return null;this.checkMaximumDistance(this.me,A,this.Ie)},ms.prototype.getErrorLocation=function(){return this.de},ms.prototype.getPolygonLines=function(A){for(var t=new Zn,n=new ls(t),i=vs.getPolygons(A).iterator();i.hasNext();)i.next().apply(n);return A.getFactory().buildGeometry(t)},ms.prototype.getErrorMessage=function(){return this.xe},ms.prototype.interfaces_=function(){return[]},ms.prototype.getClass=function(){return ms},ps.VERBOSE.get=function(){return!1},ps.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(ms,ps);var Ls=function(A,t,n){this.ze=!0,this.Le=null,this.de=null,this.ye=null,this.me=A||null,this._n=t||null,this.Ot=n||null},Ts={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Ls.prototype.isValid=function(){return this.checkPolygonal(),this.ze?(this.checkExpectedEmpty(),this.ze?(this.checkEnvelope(),this.ze?(this.checkArea(),this.ze?(this.checkDistance(),this.ze):this.ze):this.ze):this.ze):this.ze},Ls.prototype.checkEnvelope=function(){if(this._n<0)return null;var A=this._n*Ls.MAX_ENV_DIFF_FRAC;0===A&&(A=.001);var t=new Cn(this.me.getEnvelopeInternal());t.expandBy(this._n);var n=new Cn(this.Ot.getEnvelopeInternal());n.expandBy(A),n.contains(t)||(this.ze=!1,this.Le="Buffer envelope is incorrect",this.ye=this.me.getFactory().toGeometry(n)),this.report("Envelope")},Ls.prototype.checkDistance=function(){var A=new ms(this.me,this._n,this.Ot);A.isValid()||(this.ze=!1,this.Le=A.getErrorMessage(),this.de=A.getErrorLocation(),this.ye=A.getErrorIndicator()),this.report("Distance")},Ls.prototype.checkArea=function(){var A=this.me.getArea(),t=this.Ot.getArea();this._n>0&&A>t&&(this.ze=!1,this.Le="Area of positive buffer is smaller than input",this.ye=this.Ot),this._n<0&&A<t&&(this.ze=!1,this.Le="Area of negative buffer is larger than input",this.ye=this.Ot),this.report("Area")},Ls.prototype.checkPolygonal=function(){this.Ot instanceof Gi||this.Ot instanceof Wi||(this.ze=!1),this.Le="Result is not polygonal",this.ye=this.Ot,this.report("Polygonal")},Ls.prototype.getErrorIndicator=function(){return this.ye},Ls.prototype.getErrorLocation=function(){return this.de},Ls.prototype.checkExpectedEmpty=function(){return this.me.getDimension()>=2||this._n>0?null:(this.Ot.isEmpty()||(this.ze=!1,this.Le="Result is non-empty",this.ye=this.Ot),void this.report("ExpectedEmpty"))},Ls.prototype.report=function(A){if(!Ls.VERBOSE)return null;Pn.out.println("Check "+A+": "+(this.ze?"passed":"FAILED"))},Ls.prototype.getErrorMessage=function(){return this.Le},Ls.prototype.interfaces_=function(){return[]},Ls.prototype.getClass=function(){return Ls},Ls.isValidMsg=function(A,t,n){var i=new Ls(A,t,n);return i.isValid()?null:i.getErrorMessage()},Ls.isValid=function(A,t,n){return!!new Ls(A,t,n).isValid()},Ts.VERBOSE.get=function(){return!1},Ts.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Ls,Ts);var Os=function(){this.wn=null,this.si=null;var A=arguments[0],t=arguments[1];this.wn=A,this.si=t};Os.prototype.getCoordinates=function(){return this.wn},Os.prototype.size=function(){return this.wn.length},Os.prototype.getCoordinate=function(A){return this.wn[A]},Os.prototype.isClosed=function(){return this.wn[0].equals(this.wn[this.wn.length-1])},Os.prototype.getSegmentOctant=function(A){return A===this.wn.length-1?-1:te.octant(this.getCoordinate(A),this.getCoordinate(A+1))},Os.prototype.setData=function(A){this.si=A},Os.prototype.getData=function(){return this.si},Os.prototype.toString=function(){return xn.toLineString(new Zi(this.wn))},Os.prototype.interfaces_=function(){return[ne]},Os.prototype.getClass=function(){return Os};var Fs=function(){this.Te=!1,this.Oe=!1,this.Qi=null,this.Fe=null,this.Ee=null,this.Ue=new Zn,this.Ne=0,this.je=!0;var A=arguments[0];this.Qi=A,this.Fe=null};Fs.prototype.getInteriorIntersection=function(){return this.Fe},Fs.prototype.setCheckEndSegmentsOnly=function(A){this.Oe=A},Fs.prototype.getIntersectionSegments=function(){return this.Ee},Fs.prototype.count=function(){return this.Ne},Fs.prototype.getIntersections=function(){return this.Ue},Fs.prototype.setFindAllIntersections=function(A){this.Te=A},Fs.prototype.setKeepIntersections=function(A){this.je=A},Fs.prototype.processIntersections=function(A,t,n,i){if(!this.Te&&this.hasIntersection())return null;if(A===n&&t===i)return null;if(this.Oe&&!this.isEndSegment(A,t)&&!this.isEndSegment(n,i))return null;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this.Qi.computeIntersection(r,e,s,u),this.Qi.hasIntersection()&&this.Qi.isInteriorIntersection()&&(this.Ee=new Array(4).fill(null),this.Ee[0]=r,this.Ee[1]=e,this.Ee[2]=s,this.Ee[3]=u,this.Fe=this.Qi.getIntersection(0),this.je&&this.Ue.add(this.Fe),this.Ne++)},Fs.prototype.isEndSegment=function(A,t){return 0===t||t>=A.size()-2},Fs.prototype.hasIntersection=function(){return null!==this.Fe},Fs.prototype.isDone=function(){return!this.Te&&null!==this.Fe},Fs.prototype.interfaces_=function(){return[Se]},Fs.prototype.getClass=function(){return Fs},Fs.createAllIntersectionsFinder=function(A){var t=new Fs(A);return t.setFindAllIntersections(!0),t},Fs.createAnyIntersectionFinder=function(A){return new Fs(A)},Fs.createIntersectionCounter=function(A){var t=new Fs(A);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var Es=function(){this.Qi=new Tn,this.Or=null,this.Te=!1,this.vi=null,this.ze=!0;var A=arguments[0];this.Or=A};Es.prototype.execute=function(){if(null!==this.vi)return null;this.checkInteriorIntersections()},Es.prototype.getIntersections=function(){return this.vi.getIntersections()},Es.prototype.isValid=function(){return this.execute(),this.ze},Es.prototype.setFindAllIntersections=function(A){this.Te=A},Es.prototype.checkInteriorIntersections=function(){this.ze=!0,this.vi=new Fs(this.Qi),this.vi.setFindAllIntersections(this.Te);var A=new ae;if(A.setSegmentIntersector(this.vi),A.computeNodes(this.Or),this.vi.hasIntersection())return this.ze=!1,null},Es.prototype.checkValid=function(){if(this.execute(),!this.ze)throw new Dr(this.getErrorMessage(),this.vi.getInteriorIntersection())},Es.prototype.getErrorMessage=function(){if(this.ze)return"no intersections found";var A=this.vi.getIntersectionSegments();return"found non-noded intersection between "+xn.toLineString(A[0],A[1])+" and "+xn.toLineString(A[2],A[3])},Es.prototype.interfaces_=function(){return[]},Es.prototype.getClass=function(){return Es},Es.computeIntersections=function(A){var t=new Es(A);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var Us=function A(){this.Qe=null;var t=arguments[0];this.Qe=new Es(A.toSegmentStrings(t))};Us.prototype.checkValid=function(){this.Qe.checkValid()},Us.prototype.interfaces_=function(){return[]},Us.prototype.getClass=function(){return Us},Us.toSegmentStrings=function(A){for(var t=new Zn,n=A.iterator();n.hasNext();){var i=n.next();t.add(new Os(i.getCoordinates(),i))}return t},Us.checkValid=function(A){new Us(A).checkValid()};var Ns=function(A){this.Se=A};Ns.prototype.map=function(A){for(var t=new Zn,n=0;n<A.getNumGeometries();n++){var i=this.Se.map(A.getGeometryN(n));i.isEmpty()||t.add(i)}return A.getFactory().createGeometryCollection(sr.toGeometryArray(t))},Ns.prototype.interfaces_=function(){return[]},Ns.prototype.getClass=function(){return Ns},Ns.map=function(A,t){return new Ns(t).map(A)};var js=function(){this.Be=null,this.Dn=null,this.oe=null,this.Re=new Zn,this.ke=new Zn;var A=arguments[0],t=arguments[1],n=arguments[2];this.Be=A,this.Dn=t,this.oe=n};js.prototype.collectLines=function(A){for(var t=this.Be.getGraph().getEdgeEnds().iterator();t.hasNext();){var n=t.next();this.collectLineEdge(n,A,this.Re),this.collectBoundaryTouchEdge(n,A,this.Re)}},js.prototype.labelIsolatedLine=function(A,t){var n=this.oe.locate(A.getCoordinate(),this.Be.getArgGeometry(t));A.getLabel().setLocation(t,n)},js.prototype.build=function(A){return this.findCoveredLineEdges(),this.collectLines(A),this.buildLines(A),this.ke},js.prototype.collectLineEdge=function(A,t,n){var i=A.getLabel(),r=A.getEdge();A.isLineEdge()&&(A.isVisited()||!Pu.isResultOfOp(i,t)||r.isCovered()||(n.add(r),A.setVisitedEdge(!0)))},js.prototype.findCoveredLineEdges=function(){for(var A=this.Be.getGraph().getNodes().iterator();A.hasNext();)A.next().getEdges().findCoveredLineEdges();for(var t=this.Be.getGraph().getEdgeEnds().iterator();t.hasNext();){var n=t.next(),i=n.getEdge();if(n.isLineEdge()&&!i.isCoveredSet()){var r=this.Be.isCoveredByA(n.getCoordinate());i.setCovered(r)}}},js.prototype.labelIsolatedLines=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next(),i=n.getLabel();n.isIsolated()&&(i.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},js.prototype.buildLines=function(A){for(var t=this.Re.iterator();t.hasNext();){var n=t.next(),i=this.Dn.createLineString(n.getCoordinates());this.ke.add(i),n.setInResult(!0)}},js.prototype.collectBoundaryTouchEdge=function(A,t,n){var i=A.getLabel();return A.isLineEdge()||A.isVisited()||A.isInteriorAreaEdge()||A.getEdge().isInResult()?null:(mn.isTrue(!(A.isInResult()||A.getSym().isInResult())||!A.getEdge().isInResult()),void(Pu.isResultOfOp(i,t)&&t===Pu.INTERSECTION&&(n.add(A.getEdge()),A.setVisitedEdge(!0))))},js.prototype.interfaces_=function(){return[]},js.prototype.getClass=function(){return js};var Qs=function(){this.Be=null,this.Dn=null,this.Ge=new Zn;var A=arguments[0],t=arguments[1];this.Be=A,this.Dn=t};Qs.prototype.filterCoveredNodeToPoint=function(A){var t=A.getCoordinate();if(!this.Be.isCoveredByLA(t)){var n=this.Dn.createPoint(t);this.Ge.add(n)}},Qs.prototype.extractNonCoveredResultNodes=function(A){for(var t=this.Be.getGraph().getNodes().iterator();t.hasNext();){var n=t.next();if(!(n.isInResult()||n.isIncidentEdgeInResult()||0!==n.getEdges().getDegree()&&A!==Pu.INTERSECTION)){var i=n.getLabel();Pu.isResultOfOp(i,A)&&this.filterCoveredNodeToPoint(n)}}},Qs.prototype.build=function(A){return this.extractNonCoveredResultNodes(A),this.Ge},Qs.prototype.interfaces_=function(){return[]},Qs.prototype.getClass=function(){return Qs};var Ss=function(){this.Xi=null,this.Yt=null,this.Ye=!0,this.qe=!0,this.We=!1,this.Ve=!1};Ss.prototype.transformPoint=function(A,t){return this.Yt.createPoint(this.transformCoordinates(A.getCoordinateSequence(),A))},Ss.prototype.transformPolygon=function(A,t){var n=!0,i=this.transformLinearRing(A.getExteriorRing(),A);null!==i&&i instanceof qi&&!i.isEmpty()||(n=!1);for(var r=new Zn,e=0;e<A.getNumInteriorRing();e++){var s=this.transformLinearRing(A.getInteriorRingN(e),A);null===s||s.isEmpty()||(s instanceof qi||(n=!1),r.add(s))}if(n)return this.Yt.createPolygon(i,r.toArray([]));var u=new Zn;return null!==i&&u.add(i),u.addAll(r),this.Yt.buildGeometry(u)},Ss.prototype.createCoordinateSequence=function(A){return this.Yt.getCoordinateSequenceFactory().create(A)},Ss.prototype.getInputGeometry=function(){return this.Xi},Ss.prototype.transformMultiLineString=function(A,t){for(var n=new Zn,i=0;i<A.getNumGeometries();i++){var r=this.transformLineString(A.getGeometryN(i),A);null!==r&&(r.isEmpty()||n.add(r))}return this.Yt.buildGeometry(n)},Ss.prototype.transformCoordinates=function(A,t){return this.copy(A)},Ss.prototype.transformLineString=function(A,t){return this.Yt.createLineString(this.transformCoordinates(A.getCoordinateSequence(),A))},Ss.prototype.transformMultiPoint=function(A,t){for(var n=new Zn,i=0;i<A.getNumGeometries();i++){var r=this.transformPoint(A.getGeometryN(i),A);null!==r&&(r.isEmpty()||n.add(r))}return this.Yt.buildGeometry(n)},Ss.prototype.transformMultiPolygon=function(A,t){for(var n=new Zn,i=0;i<A.getNumGeometries();i++){var r=this.transformPolygon(A.getGeometryN(i),A);null!==r&&(r.isEmpty()||n.add(r))}return this.Yt.buildGeometry(n)},Ss.prototype.copy=function(A){return A.copy()},Ss.prototype.transformGeometryCollection=function(A,t){for(var n=new Zn,i=0;i<A.getNumGeometries();i++){var r=this.transform(A.getGeometryN(i));null!==r&&(this.Ye&&r.isEmpty()||n.add(r))}return this.qe?this.Yt.createGeometryCollection(sr.toGeometryArray(n)):this.Yt.buildGeometry(n)},Ss.prototype.transform=function(A){if(this.Xi=A,this.Yt=A.getFactory(),A instanceof Ri)return this.transformPoint(A,null);if(A instanceof Yi)return this.transformMultiPoint(A,null);if(A instanceof qi)return this.transformLinearRing(A,null);if(A instanceof Si)return this.transformLineString(A,null);if(A instanceof yi)return this.transformMultiLineString(A,null);if(A instanceof Gi)return this.transformPolygon(A,null);if(A instanceof Wi)return this.transformMultiPolygon(A,null);if(A instanceof di)return this.transformGeometryCollection(A,null);throw new Gt("Unknown Geometry subtype: "+A.getClass().getName())},Ss.prototype.transformLinearRing=function(A,t){var n=this.transformCoordinates(A.getCoordinateSequence(),A);if(null===n)return this.Yt.createLinearRing(null);var i=n.size();return i>0&&i<4&&!this.Ve?this.Yt.createLineString(n):this.Yt.createLinearRing(n)},Ss.prototype.interfaces_=function(){return[]},Ss.prototype.getClass=function(){return Ss};var Bs=function A(){if(this.Ke=0,this.He=null,this.Hi=new ee,this._e=!1,this.Je=!1,arguments[0]instanceof Si&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1];A.call(this,t.getCoordinates(),n)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1];this.He=i,this.Je=A.isClosed(i),this.Ke=r}};Bs.prototype.snapVertices=function(A,t){for(var n=this.Je?A.size()-1:A.size(),i=0;i<n;i++){var r=A.get(i),e=this.findSnapForVertex(r,t);null!==e&&(A.set(i,new _t(e)),0===i&&this.Je&&A.set(A.size()-1,new _t(e)))}},Bs.prototype.findSnapForVertex=function(A,t){for(var n=0;n<t.length;n++){if(A.equals2D(t[n]))return null;if(A.distance(t[n])<this.Ke)return t[n]}return null},Bs.prototype.snapTo=function(A){var t=new $n(this.He);return this.snapVertices(t,A),this.snapSegments(t,A),t.toCoordinateArray()},Bs.prototype.snapSegments=function(A,t){if(0===t.length)return null;var n=t.length;t[0].equals2D(t[t.length-1])&&(n=t.length-1);for(var i=0;i<n;i++){var r=t[i],e=this.findSegmentIndexToSnap(r,A);e>=0&&A.add(e+1,new _t(r),!1)}},Bs.prototype.findSegmentIndexToSnap=function(A,t){for(var n=Yt.MAX_VALUE,i=-1,r=0;r<t.size()-1;r++){if(this.Hi.p0=t.get(r),this.Hi.p1=t.get(r+1),this.Hi.p0.equals2D(A)||this.Hi.p1.equals2D(A)){if(this._e)continue;return-1}var e=this.Hi.distance(A);e<this.Ke&&e<n&&(n=e,i=r)}return i},Bs.prototype.setAllowSnappingToSourceVertices=function(A){this._e=A},Bs.prototype.interfaces_=function(){return[]},Bs.prototype.getClass=function(){return Bs},Bs.isClosed=function(A){return!(A.length<=1)&&A[0].equals2D(A[A.length-1])};var Rs=function(A){this.Ze=A||null},ks={SNAP_PRECISION_FACTOR:{configurable:!0}};Rs.prototype.snapTo=function(A,t){var n=this.extractTargetCoordinates(A);return new Gs(t,n).transform(this.Ze)},Rs.prototype.snapToSelf=function(A,t){var n=this.extractTargetCoordinates(this.Ze),i=new Gs(A,n,!0).transform(this.Ze),r=i;return t&&tn(r,ki)&&(r=i.buffer(0)),r},Rs.prototype.computeSnapTolerance=function(A){return this.computeMinimumSegmentLength(A)/10},Rs.prototype.extractTargetCoordinates=function(A){for(var t=new Ci,n=A.getCoordinates(),i=0;i<n.length;i++)t.add(n[i]);return t.toArray(new Array(0).fill(null))},Rs.prototype.computeMinimumSegmentLength=function(A){for(var t=Yt.MAX_VALUE,n=0;n<A.length-1;n++){var i=A[n].distance(A[n+1]);i<t&&(t=i)}return t},Rs.prototype.interfaces_=function(){return[]},Rs.prototype.getClass=function(){return Rs},Rs.snap=function(A,t,n){var i=new Array(2).fill(null),r=new Rs(A);i[0]=r.snapTo(t,n);var e=new Rs(t);return i[1]=e.snapTo(i[0],n),i},Rs.computeOverlaySnapTolerance=function(){if(1===arguments.length){var A=arguments[0],t=Rs.computeSizeBasedSnapTolerance(A),n=A.getPrecisionModel();if(n.getType()===nr.FIXED){var i=1/n.getScale()*2/1.415;i>t&&(t=i)}return t}if(2===arguments.length){var r=arguments[0],e=arguments[1];return Math.min(Rs.computeOverlaySnapTolerance(r),Rs.computeOverlaySnapTolerance(e))}},Rs.computeSizeBasedSnapTolerance=function(A){var t=A.getEnvelopeInternal();return Math.min(t.getHeight(),t.getWidth())*Rs.SNAP_PRECISION_FACTOR},Rs.snapToSelf=function(A,t,n){return new Rs(A).snapToSelf(t,n)},ks.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Rs,ks);var Gs=function(A){function t(t,n,i){A.call(this),this.Ke=t||null,this.Xe=n||null,this.$e=void 0!==i&&i}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.snapLine=function(A,t){var n=new Bs(A,this.Ke);return n.setAllowSnappingToSourceVertices(this.$e),n.snapTo(t)},t.prototype.transformCoordinates=function(A,t){var n=A.toCoordinateArray(),i=this.snapLine(n,this.Xe);return this.Yt.getCoordinateSequenceFactory().create(i)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ss),Ys=function(){this.As=!0,this.ts=53,this.ns=0,this.rs=null};Ys.prototype.getCommon=function(){return Yt.longBitsToDouble(this.ns)},Ys.prototype.add=function(A){var t=Yt.doubleToLongBits(A);return this.As?(this.ns=t,this.rs=Ys.signExpBits(this.ns),this.As=!1,null):Ys.signExpBits(t)!==this.rs?(this.ns=0,null):(this.ts=Ys.numCommonMostSigMantissaBits(this.ns,t),void(this.ns=Ys.zeroLowerBits(this.ns,64-(12+this.ts))))},Ys.prototype.toString=function(){if(1===arguments.length){var A=arguments[0],t=Yt.longBitsToDouble(A),n=Yt.toBinaryString(A),i="0000000000000000000000000000000000000000000000000000000000000000"+n,r=i.substring(i.length-64),e=r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+t+" ]";return e}},Ys.prototype.interfaces_=function(){return[]},Ys.prototype.getClass=function(){return Ys},Ys.getBit=function(A,t){return 0!=(A&1<<t)?1:0},Ys.signExpBits=function(A){return A>>52},Ys.zeroLowerBits=function(A,t){return A&~((1<<t)-1)},Ys.numCommonMostSigMantissaBits=function(A,t){for(var n=0,i=52;i>=0;i--){if(Ys.getBit(A,i)!==Ys.getBit(t,i))return n;n++}return 52};var qs=function(){this.es=null,this.ss=new Vs},Ws={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};qs.prototype.addCommonBits=function(A){var t=new Ks(this.es);A.apply(t),A.geometryChanged()},qs.prototype.removeCommonBits=function(A){if(0===this.es.x&&0===this.es.y)return A;var t=new _t(this.es);t.x=-t.x,t.y=-t.y;var n=new Ks(t);return A.apply(n),A.geometryChanged(),A},qs.prototype.getCommonCoordinate=function(){return this.es},qs.prototype.add=function(A){A.apply(this.ss),this.es=this.ss.getCommonCoordinate()},qs.prototype.interfaces_=function(){return[]},qs.prototype.getClass=function(){return qs},Ws.CommonCoordinateFilter.get=function(){return Vs},Ws.Translater.get=function(){return Ks},Object.defineProperties(qs,Ws);var Vs=function(){this.us=new Ys,this.os=new Ys};Vs.prototype.filter=function(A){this.us.add(A.x),this.os.add(A.y)},Vs.prototype.getCommonCoordinate=function(){return new _t(this.us.getCommon(),this.os.getCommon())},Vs.prototype.interfaces_=function(){return[Bn]},Vs.prototype.getClass=function(){return Vs};var Ks=function(){this.trans=null;var A=arguments[0];this.trans=A};Ks.prototype.filter=function(A,t){var n=A.getOrdinate(t,0)+this.trans.x,i=A.getOrdinate(t,1)+this.trans.y;A.setOrdinate(t,0,n),A.setOrdinate(t,1,i)},Ks.prototype.isDone=function(){return!1},Ks.prototype.isGeometryChanged=function(){return!0},Ks.prototype.interfaces_=function(){return[xi]},Ks.prototype.getClass=function(){return Ks};var Hs=function(A,t){this.Vt=new Array(2).fill(null),this.Ke=null,this.hs=null,this.Vt[0]=A,this.Vt[1]=t,this.computeSnapTolerance()};Hs.prototype.selfSnap=function(A){return new Rs(A).snapTo(A,this.Ke)},Hs.prototype.removeCommonBits=function(A){this.hs=new qs,this.hs.add(A[0]),this.hs.add(A[1]);var t=new Array(2).fill(null);return t[0]=this.hs.removeCommonBits(A[0].copy()),t[1]=this.hs.removeCommonBits(A[1].copy()),t},Hs.prototype.prepareResult=function(A){return this.hs.addCommonBits(A),A},Hs.prototype.getResultGeometry=function(A){var t=this.snap(this.Vt),n=Pu.overlayOp(t[0],t[1],A);return this.prepareResult(n)},Hs.prototype.checkValid=function(A){A.isValid()||Pn.out.println("Snapped geometry is invalid")},Hs.prototype.computeSnapTolerance=function(){this.Ke=Rs.computeOverlaySnapTolerance(this.Vt[0],this.Vt[1])},Hs.prototype.snap=function(A){var t=this.removeCommonBits(A);return Rs.snap(t[0],t[1],this.Ke)},Hs.prototype.interfaces_=function(){return[]},Hs.prototype.getClass=function(){return Hs},Hs.overlayOp=function(A,t,n){return new Hs(A,t).getResultGeometry(n)},Hs.union=function(A,t){return Hs.overlayOp(A,t,Pu.UNION)},Hs.intersection=function(A,t){return Hs.overlayOp(A,t,Pu.INTERSECTION)},Hs.symDifference=function(A,t){return Hs.overlayOp(A,t,Pu.SYMDIFFERENCE)},Hs.difference=function(A,t){return Hs.overlayOp(A,t,Pu.DIFFERENCE)};var _s=function(A,t){this.Vt=new Array(2).fill(null),this.Vt[0]=A,this.Vt[1]=t};_s.prototype.getResultGeometry=function(A){var t=null,n=!1,i=null;try{t=Pu.overlayOp(this.Vt[0],this.Vt[1],A),n=!0}catch(A){if(!(A instanceof dn))throw A;i=A}if(!n)try{t=Hs.overlayOp(this.Vt[0],this.Vt[1],A)}catch(A){throw A instanceof dn?i:A}return t},_s.prototype.interfaces_=function(){return[]},_s.prototype.getClass=function(){return _s},_s.overlayOp=function(A,t,n){return new _s(A,t).getResultGeometry(n)},_s.union=function(A,t){return _s.overlayOp(A,t,Pu.UNION)},_s.intersection=function(A,t){return _s.overlayOp(A,t,Pu.INTERSECTION)},_s.symDifference=function(A,t){return _s.overlayOp(A,t,Pu.SYMDIFFERENCE)},_s.difference=function(A,t){return _s.overlayOp(A,t,Pu.DIFFERENCE)};var Js=function(){this.mce=null,this.chainIndex=null;var A=arguments[0],t=arguments[1];this.mce=A,this.chainIndex=t};Js.prototype.computeIntersections=function(A,t){this.mce.computeIntersectsForChain(this.chainIndex,A.mce,A.chainIndex,t)},Js.prototype.interfaces_=function(){return[]},Js.prototype.getClass=function(){return Js};var Zs=function A(){if(this.Pn=null,this.fs=null,this.cs=null,this.as=null,this.vs=null,this.ls=null,2===arguments.length){var t=arguments[0],n=arguments[1];this.cs=A.DELETE,this.fs=t,this.as=n}else if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];this.cs=A.INSERT,this.Pn=i,this.fs=r,this.ls=e}},Xs={INSERT:{configurable:!0},DELETE:{configurable:!0}};Zs.prototype.isDelete=function(){return this.cs===Zs.DELETE},Zs.prototype.setDeleteEventIndex=function(A){this.vs=A},Zs.prototype.getObject=function(){return this.ls},Zs.prototype.compareTo=function(A){return this.fs<A.fs?-1:this.fs>A.fs?1:this.cs<A.cs?-1:this.cs>A.cs?1:0},Zs.prototype.getInsertEvent=function(){return this.as},Zs.prototype.isInsert=function(){return this.cs===Zs.INSERT},Zs.prototype.isSameLabel=function(A){return null!==this.Pn&&this.Pn===A.Pn},Zs.prototype.getDeleteEventIndex=function(){return this.vs},Zs.prototype.interfaces_=function(){return[Wt]},Zs.prototype.getClass=function(){return Zs},Xs.INSERT.get=function(){return 1},Xs.DELETE.get=function(){return 2},Object.defineProperties(Zs,Xs);var $s=function(){};$s.prototype.interfaces_=function(){return[]},$s.prototype.getClass=function(){return $s};var Au=function(){this.lr=!1,this.wr=!1,this.Pr=!1,this.Cr=null,this.Qi=null,this.ws=null,this.Ps=null,this.Dr=null,this.gs=0,this.numTests=0,this.Cs=null,this.Ds=!1,this.Is=!1;var A=arguments[0],t=arguments[1],n=arguments[2];this.Qi=A,this.ws=t,this.Ps=n};Au.prototype.isTrivialIntersection=function(A,t,n,i){if(A===n&&1===this.Qi.getIntersectionNum()){if(Au.isAdjacentSegments(t,i))return!0;if(A.isClosed()){var r=A.getNumPoints()-1;if(0===t&&i===r||0===i&&t===r)return!0}}return!1},Au.prototype.getProperIntersectionPoint=function(){return this.Cr},Au.prototype.setIsDoneIfProperInt=function(A){this.Is=A},Au.prototype.hasProperInteriorIntersection=function(){return this.Pr},Au.prototype.isBoundaryPointInternal=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next().getCoordinate();if(A.isIntersection(i))return!0}return!1},Au.prototype.hasProperIntersection=function(){return this.wr},Au.prototype.hasIntersection=function(){return this.lr},Au.prototype.isDone=function(){return this.Ds},Au.prototype.isBoundaryPoint=function(A,t){return!(null===t||!this.isBoundaryPointInternal(A,t[0])&&!this.isBoundaryPointInternal(A,t[1]))},Au.prototype.setBoundaryNodes=function(A,t){this.Cs=new Array(2).fill(null),this.Cs[0]=A,this.Cs[1]=t},Au.prototype.addIntersections=function(A,t,n,i){if(A===n&&t===i)return null;this.numTests++;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this.Qi.computeIntersection(r,e,s,u),this.Qi.hasIntersection()&&(this.Ps&&(A.setIsolated(!1),n.setIsolated(!1)),this.gs++,this.isTrivialIntersection(A,t,n,i)||(this.lr=!0,!this.ws&&this.Qi.isProper()||(A.addIntersections(this.Qi,t,0),n.addIntersections(this.Qi,i,1)),this.Qi.isProper()&&(this.Cr=this.Qi.getIntersection(0).copy(),this.wr=!0,this.Is&&(this.Ds=!0),this.isBoundaryPoint(this.Qi,this.Cs)||(this.Pr=!0))))},Au.prototype.interfaces_=function(){return[]},Au.prototype.getClass=function(){return Au},Au.isAdjacentSegments=function(A,t){return 1===Math.abs(A-t)};var tu=function(A){function t(){A.call(this),this.events=new Zn,this.nOverlaps=null}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.prepareEvents=function(){qr.sort(this.events);for(var A=0;A<this.events.size();A++){var t=this.events.get(A);t.isDelete()&&t.getInsertEvent().setDeleteEventIndex(A)}},t.prototype.computeIntersections=function(){var A=this;if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var n=0;n<this.events.size();n++){var i=A.events.get(n);if(i.isInsert()&&A.processOverlaps(n,i.getDeleteEventIndex(),i,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof Au&&tn(arguments[0],_n)&&tn(arguments[1],_n)){var r=arguments[0],e=arguments[1],s=arguments[2];this.addEdges(r,r),this.addEdges(e,e),this.computeIntersections(s)}else if("boolean"==typeof arguments[2]&&tn(arguments[0],_n)&&arguments[1]instanceof Au){var u=arguments[0],o=arguments[1],h=arguments[2];h?this.addEdges(u,null):this.addEdges(u),this.computeIntersections(o)}},t.prototype.addEdge=function(A,t){for(var n=A.getMonotoneChainEdge(),i=n.getStartIndexes(),r=0;r<i.length-1;r++){var e=new Js(n,r),s=new Zs(t,n.getMinX(r),e);this.events.add(s),this.events.add(new Zs(n.getMaxX(r),s))}},t.prototype.processOverlaps=function(A,t,n,i){for(var r=n.getObject(),e=A;e<t;e++){var s=this.events.get(e);if(s.isInsert()){var u=s.getObject();n.isSameLabel(s)||(r.computeIntersections(u,i),this.nOverlaps++)}}},t.prototype.addEdges=function(){var A=this;if(1===arguments.length)for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();A.addEdge(i,i)}else if(2===arguments.length)for(var r=arguments[0],e=arguments[1],s=r.iterator();s.hasNext();){var u=s.next();A.addEdge(u,e)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}($s),nu=function(){this.Ms=Yt.POSITIVE_INFINITY,this.ir=Yt.NEGATIVE_INFINITY},iu={NodeComparator:{configurable:!0}};nu.prototype.getMin=function(){return this.Ms},nu.prototype.intersects=function(A,t){return!(this.Ms>t||this.ir<A)},nu.prototype.getMax=function(){return this.ir},nu.prototype.toString=function(){return xn.toLineString(new _t(this.Ms,0),new _t(this.ir,0))},nu.prototype.interfaces_=function(){return[]},nu.prototype.getClass=function(){return nu},iu.NodeComparator.get=function(){return ru},Object.defineProperties(nu,iu);var ru=function(){};ru.prototype.compare=function(A,t){var r=(A.Ms+A.ir)/2,e=(t.Ms+t.ir)/2;return r<e?-1:r>e?1:0},ru.prototype.interfaces_=function(){return[Kt]},ru.prototype.getClass=function(){return ru};var eu=function(A){function t(){A.call(this),this.Gn=null;var t=arguments[0],n=arguments[1],i=arguments[2];this.Ms=t,this.ir=n,this.Gn=i}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.query=function(A,t,n){if(!this.intersects(A,t))return null;n.visitItem(this.Gn)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(nu),su=function(A){function t(){A.call(this),this.bs=null,this.zs=null;var t=arguments[0],n=arguments[1];this.bs=t,this.zs=n,this.buildExtent(this.bs,this.zs)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.buildExtent=function(A,t){this.Ms=Math.min(A.Ms,t.Ms),this.ir=Math.max(A.ir,t.ir)},t.prototype.query=function(A,t,n){if(!this.intersects(A,t))return null;null!==this.bs&&this.bs.query(A,t,n),null!==this.zs&&this.zs.query(A,t,n)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(nu),uu=function(){this.xs=new Zn,this.Zn=null,this.Vn=0};uu.prototype.buildTree=function(){qr.sort(this.xs,new nu.NodeComparator);for(var A=this.xs,t=null,n=new Zn;;){if(this.buildLevel(A,n),1===n.size())return n.get(0);t=A,A=n,n=t}},uu.prototype.insert=function(A,t,n){if(null!==this.Zn)throw new Error("Index cannot be added to once it has been queried");this.xs.add(new eu(A,t,n))},uu.prototype.query=function(A,t,n){this.init(),this.Zn.query(A,t,n)},uu.prototype.buildRoot=function(){if(null!==this.Zn)return null;this.Zn=this.buildTree()},uu.prototype.printNode=function(A){Pn.out.println(xn.toLineString(new _t(A.Ms,this.Vn),new _t(A.ir,this.Vn)))},uu.prototype.init=function(){if(null!==this.Zn)return null;this.buildRoot()},uu.prototype.buildLevel=function(A,t){this.Vn++,t.clear();for(var n=0;n<A.size();n+=2){var i=A.get(n);if(null===(n+1<A.size()?A.get(n):null))t.add(i);else{var r=new su(A.get(n),A.get(n+1));t.add(r)}}},uu.prototype.interfaces_=function(){return[]},uu.prototype.getClass=function(){return uu};var ou=function(){this.qn=new Zn};ou.prototype.visitItem=function(A){this.qn.add(A)},ou.prototype.getItems=function(){return this.qn},ou.prototype.interfaces_=function(){return[Rr]},ou.prototype.getClass=function(){return ou};var hu=function(){this.wi=null;var A=arguments[0];if(!tn(A,ki))throw new Gt("Argument must be Polygonal");this.wi=new au(A)},fu={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};hu.prototype.locate=function(A){var t=new Fn(A),n=new cu(t);return this.wi.query(A.y,A.y,n),t.getLocation()},hu.prototype.interfaces_=function(){return[Te]},hu.prototype.getClass=function(){return hu},fu.SegmentVisitor.get=function(){return cu},fu.IntervalIndexedGeometry.get=function(){return au},Object.defineProperties(hu,fu);var cu=function(){this.ds=null;var A=arguments[0];this.ds=A};cu.prototype.visitItem=function(A){var t=A;this.ds.countSegment(t.getCoordinate(0),t.getCoordinate(1))},cu.prototype.interfaces_=function(){return[Rr]},cu.prototype.getClass=function(){return cu};var au=function(){this.wi=new uu;var A=arguments[0];this.init(A)};au.prototype.init=function(A){for(var t=ls.getLines(A).iterator();t.hasNext();){var n=t.next().getCoordinates();this.addLine(n)}},au.prototype.addLine=function(A){for(var t=1;t<A.length;t++){var n=new ee(A[t-1],A[t]),i=Math.min(n.p0.y,n.p1.y),r=Math.max(n.p0.y,n.p1.y);this.wi.insert(i,r,n)}},au.prototype.query=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new ou;return this.wi.query(A,t,n),n.getItems()}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];this.wi.query(i,r,e)}},au.prototype.interfaces_=function(){return[]},au.prototype.getClass=function(){return au};var vu=function(A){function t(){if(A.call(this),this.ys=null,this.ms=new tr,this.ps=null,this.Ls=!0,this.Ts=null,this.Os=null,this.Fs=!1,this.Es=null,this.Us=null,this.oe=new ws,2===arguments.length){var t=arguments[0],n=arguments[1],i=Rn.OGC_SFS_BOUNDARY_RULE;this.Ts=t,this.ys=n,this.ps=i,null!==n&&this.add(n)}else if(3===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2];this.Ts=r,this.ys=e,this.ps=s,null!==e&&this.add(e)}}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.insertBoundaryPoint=function(A,n){var i=this.un.addNode(n).getLabel(),r=1;i.getLocation(A,lr.ON)===$t.BOUNDARY&&r++;var e=t.determineBoundary(this.ps,r);i.setLocation(A,e)},t.prototype.computeSelfNodes=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];return this.computeSelfNodes(A,t,!1)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],e=new Au(n,!0,!1);e.setIsDoneIfProperInt(r);var s=this.createEdgeSetIntersector(),u=this.ys instanceof qi||this.ys instanceof Gi||this.ys instanceof Wi,o=i||!u;return s.computeIntersections(this.ln,e,o),this.addSelfIntersectionNodes(this.Ts),e}},t.prototype.computeSplitEdges=function(A){for(var t=this.ln.iterator();t.hasNext();)t.next().eiList.addSplitEdges(A)},t.prototype.computeEdgeIntersections=function(A,t,n){var i=new Au(t,n,!0);return i.setBoundaryNodes(this.getBoundaryNodes(),A.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this.ln,A.ln,i),i},t.prototype.getGeometry=function(){return this.ys},t.prototype.getBoundaryNodeRule=function(){return this.ps},t.prototype.hasTooFewPoints=function(){return this.Fs},t.prototype.addPoint=function(){if(arguments[0]instanceof Ri){var A=arguments[0],t=A.getCoordinate();this.insertPoint(this.Ts,t,$t.INTERIOR)}else if(arguments[0]instanceof _t){var n=arguments[0];this.insertPoint(this.Ts,n,$t.INTERIOR)}},t.prototype.addPolygon=function(A){this.addPolygonRing(A.getExteriorRing(),$t.EXTERIOR,$t.INTERIOR);for(var t=0;t<A.getNumInteriorRing();t++){var n=A.getInteriorRingN(t);this.addPolygonRing(n,$t.INTERIOR,$t.EXTERIOR)}},t.prototype.addEdge=function(A){this.insertEdge(A);var t=A.getCoordinates();this.insertPoint(this.Ts,t[0],$t.BOUNDARY),this.insertPoint(this.Ts,t[t.length-1],$t.BOUNDARY)},t.prototype.addLineString=function(A){var t=Ai.removeRepeatedPoints(A.getCoordinates());if(t.length<2)return this.Fs=!0,this.Es=t[0],null;var n=new Ve(t,new zr(this.Ts,$t.INTERIOR));this.ms.put(A,n),this.insertEdge(n),mn.isTrue(t.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this.Ts,t[0]),this.insertBoundaryPoint(this.Ts,t[t.length-1])},t.prototype.getInvalidPoint=function(){return this.Es},t.prototype.getBoundaryPoints=function(){for(var A=this.getBoundaryNodes(),t=new Array(A.size()).fill(null),n=0,i=A.iterator();i.hasNext();){var r=i.next();t[n++]=r.getCoordinate().copy()}return t},t.prototype.getBoundaryNodes=function(){return null===this.Os&&(this.Os=this.un.getBoundaryNodes(this.Ts)),this.Os},t.prototype.addSelfIntersectionNode=function(A,t,n){if(this.isBoundaryNode(A,t))return null;n===$t.BOUNDARY&&this.Ls?this.insertBoundaryPoint(A,t):this.insertPoint(A,t,n)},t.prototype.addPolygonRing=function(A,t,n){if(A.isEmpty())return null;var i=Ai.removeRepeatedPoints(A.getCoordinates());if(i.length<4)return this.Fs=!0,this.Es=i[0],null;var r=t,e=n;En.isCCW(i)&&(r=n,e=t);var s=new Ve(i,new zr(this.Ts,$t.BOUNDARY,r,e));this.ms.put(A,s),this.insertEdge(s),this.insertPoint(this.Ts,i[0],$t.BOUNDARY)},t.prototype.insertPoint=function(A,t,n){var i=this.un.addNode(t),r=i.getLabel();null===r?i.Pn=new zr(A,n):r.setLocation(A,n)},t.prototype.createEdgeSetIntersector=function(){return new tu},t.prototype.addSelfIntersectionNodes=function(A){for(var t=this.ln.iterator();t.hasNext();)for(var n=t.next(),i=n.getLabel().getLocation(A),r=n.eiList.iterator();r.hasNext();){var e=r.next();this.addSelfIntersectionNode(A,e.coord,i)}},t.prototype.add=function(){if(1!==arguments.length)return A.prototype.add.apply(this,arguments);var t=arguments[0];if(t.isEmpty())return null;if(t instanceof Wi&&(this.Ls=!1),t instanceof Gi)this.addPolygon(t);else if(t instanceof Si)this.addLineString(t);else if(t instanceof Ri)this.addPoint(t);else if(t instanceof Yi)this.addCollection(t);else if(t instanceof yi)this.addCollection(t);else if(t instanceof Wi)this.addCollection(t);else{if(!(t instanceof di))throw new Error(t.getClass().getName());this.addCollection(t)}},t.prototype.addCollection=function(A){for(var t=0;t<A.getNumGeometries();t++){var n=A.getGeometryN(t);this.add(n)}},t.prototype.locate=function(A){return tn(this.ys,ki)&&this.ys.getNumGeometries()>50?(null===this.Us&&(this.Us=new hu(this.ys)),this.Us.locate(A)):this.oe.locate(A,this.ys)},t.prototype.findEdge=function(){if(1===arguments.length){var t=arguments[0];return this.ms.get(t)}return A.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(A,t){return A.isInBoundary(t)?$t.BOUNDARY:$t.INTERIOR},t}(Nr),lu=function(){if(this.Qi=new Tn,this.Ns=null,this.js=null,1===arguments.length){var A=arguments[0];this.setComputationPrecision(A.getPrecisionModel()),this.js=new Array(1).fill(null),this.js[0]=new vu(0,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1],i=Rn.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this.js=new Array(2).fill(null),this.js[0]=new vu(0,t,i),this.js[1]=new vu(1,n,i)}else if(3===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2];r.getPrecisionModel().compareTo(e.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(e.getPrecisionModel()),this.js=new Array(2).fill(null),this.js[0]=new vu(0,r,s),this.js[1]=new vu(1,e,s)}};lu.prototype.getArgGeometry=function(A){return this.js[A].getGeometry()},lu.prototype.setComputationPrecision=function(A){this.Ns=A,this.Qi.setPrecisionModel(this.Ns)},lu.prototype.interfaces_=function(){return[]},lu.prototype.getClass=function(){return lu};var wu=function(){};wu.prototype.interfaces_=function(){return[]},wu.prototype.getClass=function(){return wu},wu.map=function(){if(arguments[0]instanceof jn&&tn(arguments[1],wu.MapOp)){for(var A=arguments[0],t=arguments[1],n=new Zn,i=0;i<A.getNumGeometries();i++){var r=t.map(A.getGeometryN(i));null!==r&&n.add(r)}return A.getFactory().buildGeometry(n)}if(tn(arguments[0],Vn)&&tn(arguments[1],wu.MapOp)){for(var e=arguments[0],s=arguments[1],u=new Zn,o=e.iterator();o.hasNext();){var h=o.next(),f=s.map(h);null!==f&&u.add(f)}return u}},wu.MapOp=function(){};var Pu=function(A){function t(){var t=arguments[0],n=arguments[1];A.call(this,t,n),this.oe=new ws,this.Kt=null,this.Qs=null,this.dr=null,this.sr=new Qe,this.Ss=new Zn,this.ke=new Zn,this.Ge=new Zn,this.dr=new Nr(new Ne),this.Kt=t.getFactory()}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.insertUniqueEdge=function(A){var t=this.sr.findEqualEdge(A);if(null!==t){var n=t.getLabel(),i=A.getLabel();t.isPointwiseEqual(A)||(i=new zr(A.getLabel())).flip();var r=t.getDepth();r.isNull()&&r.add(n),r.add(i),n.merge(i)}else this.sr.add(A)},t.prototype.getGraph=function(){return this.dr},t.prototype.cancelDuplicateResultEdges=function(){for(var A=this.dr.getEdgeEnds().iterator();A.hasNext();){var t=A.next(),n=t.getSym();t.isInResult()&&n.isInResult()&&(t.setInResult(!1),n.setInResult(!1))}},t.prototype.isCoveredByLA=function(A){return!!this.isCovered(A,this.ke)||!!this.isCovered(A,this.Ss)},t.prototype.computeGeometry=function(A,n,i,r){var e=new Zn;return e.addAll(A),e.addAll(n),e.addAll(i),e.isEmpty()?t.createEmptyResult(r,this.js[0].getGeometry(),this.js[1].getGeometry(),this.Kt):this.Kt.buildGeometry(e)},t.prototype.mergeSymLabels=function(){for(var A=this.dr.getNodes().iterator();A.hasNext();)A.next().getEdges().mergeSymLabels()},t.prototype.isCovered=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next();if(this.oe.locate(A,i)!==$t.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var A=new Zn,t=this.sr.iterator();t.hasNext();){var n=t.next();n.isCollapsed()&&(t.remove(),A.add(n.getCollapsedEdge()))}this.sr.addAll(A)},t.prototype.updateNodeLabelling=function(){for(var A=this.dr.getNodes().iterator();A.hasNext();){var t=A.next(),n=t.getEdges().getLabel();t.getLabel().merge(n)}},t.prototype.getResultGeometry=function(A){return this.computeOverlay(A),this.Qs},t.prototype.insertUniqueEdges=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next();this.insertUniqueEdge(n)}},t.prototype.computeOverlay=function(A){this.copyPoints(0),this.copyPoints(1),this.js[0].computeSelfNodes(this.Qi,!1),this.js[1].computeSelfNodes(this.Qi,!1),this.js[0].computeEdgeIntersections(this.js[1],this.Qi,!0);var t=new Zn;this.js[0].computeSplitEdges(t),this.js[1].computeSplitEdges(t),this.insertUniqueEdges(t),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Us.checkValid(this.sr.getEdges()),this.dr.addEdges(this.sr.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(A),this.cancelDuplicateResultEdges();var n=new jr(this.Kt);n.add(this.dr),this.Ss=n.getPolygons();var i=new js(this,this.Kt,this.oe);this.ke=i.build(A);var r=new Qs(this,this.Kt,this.oe);this.Ge=r.build(A),this.Qs=this.computeGeometry(this.Ge,this.ke,this.Ss,A)},t.prototype.labelIncompleteNode=function(A,t){var n=this.oe.locate(A.getCoordinate(),this.js[t].getGeometry());A.getLabel().setLocation(t,n)},t.prototype.copyPoints=function(A){for(var t=this.js[A].getNodeIterator();t.hasNext();){var n=t.next();this.dr.addNode(n.getCoordinate()).setLabel(A,n.getLabel().getLocation(A))}},t.prototype.findResultAreaEdges=function(A){for(var n=this.dr.getEdgeEnds().iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.isArea()&&!i.isInteriorAreaEdge()&&t.isResultOfOp(r.getLocation(0,lr.RIGHT),r.getLocation(1,lr.RIGHT),A)&&i.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var A=this.sr.iterator();A.hasNext();){var t=A.next(),n=t.getLabel(),i=t.getDepth();if(!i.isNull()){i.normalize();for(var r=0;r<2;r++)n.isNull(r)||!n.isArea()||i.isNull(r)||(0===i.getDelta(r)?n.toLine(r):(mn.isTrue(!i.isNull(r,lr.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(r,lr.LEFT,i.getLocation(r,lr.LEFT)),mn.isTrue(!i.isNull(r,lr.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(r,lr.RIGHT,i.getLocation(r,lr.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var A=this.dr.getNodes().iterator();A.hasNext();)A.next().getEdges().computeLabelling(this.js);this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var A=this.dr.getNodes().iterator();A.hasNext();){var t=A.next(),n=t.getLabel();t.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(t,0):this.labelIncompleteNode(t,1)),t.getEdges().updateLabelling(n)}},t.prototype.isCoveredByA=function(A){return!!this.isCovered(A,this.Ss)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(lu);Pu.overlayOp=function(A,t,n){return new Pu(A,t).getResultGeometry(n)},Pu.intersection=function(A,t){if(A.isEmpty()||t.isEmpty())return Pu.createEmptyResult(Pu.INTERSECTION,A,t,A.getFactory());if(A.isGeometryCollection()){var n=t;return Ns.map(A,{interfaces_:function(){return[wu.MapOp]},map:function(A){return A.intersection(n)}})}return A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),_s.overlayOp(A,t,Pu.INTERSECTION)},Pu.symDifference=function(A,t){if(A.isEmpty()||t.isEmpty()){if(A.isEmpty()&&t.isEmpty())return Pu.createEmptyResult(Pu.SYMDIFFERENCE,A,t,A.getFactory());if(A.isEmpty())return t.copy();if(t.isEmpty())return A.copy()}return A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),_s.overlayOp(A,t,Pu.SYMDIFFERENCE)},Pu.resultDimension=function(A,t,n){var i=t.getDimension(),r=n.getDimension(),e=-1;switch(A){case Pu.INTERSECTION:e=Math.min(i,r);break;case Pu.UNION:e=Math.max(i,r);break;case Pu.DIFFERENCE:e=i;break;case Pu.SYMDIFFERENCE:e=Math.max(i,r)}return e},Pu.createEmptyResult=function(A,t,n,i){var r=null;switch(Pu.resultDimension(A,t,n)){case-1:r=i.createGeometryCollection(new Array(0).fill(null));break;case 0:r=i.createPoint();break;case 1:r=i.createLineString();break;case 2:r=i.createPolygon()}return r},Pu.difference=function(A,t){return A.isEmpty()?Pu.createEmptyResult(Pu.DIFFERENCE,A,t,A.getFactory()):t.isEmpty()?A.copy():(A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),_s.overlayOp(A,t,Pu.DIFFERENCE))},Pu.isResultOfOp=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=A.getLocation(0),i=A.getLocation(1);return Pu.isResultOfOp(n,i,t)}if(3===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2];switch(r===$t.BOUNDARY&&(r=$t.INTERIOR),e===$t.BOUNDARY&&(e=$t.INTERIOR),s){case Pu.INTERSECTION:return r===$t.INTERIOR&&e===$t.INTERIOR;case Pu.UNION:return r===$t.INTERIOR||e===$t.INTERIOR;case Pu.DIFFERENCE:return r===$t.INTERIOR&&e!==$t.INTERIOR;case Pu.SYMDIFFERENCE:return r===$t.INTERIOR&&e!==$t.INTERIOR||r!==$t.INTERIOR&&e===$t.INTERIOR}return!1}},Pu.INTERSECTION=1,Pu.UNION=2,Pu.DIFFERENCE=3,Pu.SYMDIFFERENCE=4;var gu=function(){this.Bs=null,this.Rs=null,this.ks=null,this.oe=new ws,this.Hi=new ee;var A=arguments[0],t=arguments[1];this.Bs=A,this.Rs=t,this.ks=this.extractLinework(A)};gu.prototype.isWithinToleranceOfBoundary=function(A){for(var t=0;t<this.ks.getNumGeometries();t++)for(var n=this.ks.getGeometryN(t).getCoordinateSequence(),i=0;i<n.size()-1;i++)if(n.getCoordinate(i,this.Hi.p0),n.getCoordinate(i+1,this.Hi.p1),this.Hi.distance(A)<=this.Rs)return!0;return!1},gu.prototype.getLocation=function(A){return this.isWithinToleranceOfBoundary(A)?$t.BOUNDARY:this.oe.locate(A,this.Bs)},gu.prototype.extractLinework=function(A){var t=new Cu;A.apply(t);var n=t.getLinework(),i=sr.toLineStringArray(n);return A.getFactory().createMultiLineString(i)},gu.prototype.interfaces_=function(){return[]},gu.prototype.getClass=function(){return gu};var Cu=function(){this.ks=null,this.ks=new Zn};Cu.prototype.getLinework=function(){return this.ks},Cu.prototype.filter=function(A){if(A instanceof Gi){var t=A;this.ks.add(t.getExteriorRing());for(var n=0;n<t.getNumInteriorRing();n++)this.ks.add(t.getInteriorRingN(n))}},Cu.prototype.interfaces_=function(){return[zi]},Cu.prototype.getClass=function(){return Cu};var Du=function(){this.Bs=null,this.Gs=!0,this.Ys=!0;var A=arguments[0];this.Bs=A};Du.prototype.extractPoints=function(A,t,n){for(var i=A.getCoordinates(),r=0;r<i.length-1;r++)this.computeOffsetPoints(i[r],i[r+1],t,n)},Du.prototype.setSidesToGenerate=function(A,t){this.Gs=A,this.Ys=t},Du.prototype.getPoints=function(A){for(var t=new Zn,n=ls.getLines(this.Bs).iterator();n.hasNext();){var i=n.next();this.extractPoints(i,A,t)}return t},Du.prototype.computeOffsetPoints=function(A,t,n,i){var r=t.x-A.x,e=t.y-A.y,s=Math.sqrt(r*r+e*e),u=n*r/s,o=n*e/s,h=(t.x+A.x)/2,f=(t.y+A.y)/2;if(this.Gs){var c=new _t(h-o,f+u);i.add(c)}if(this.Ys){var a=new _t(h+o,f-u);i.add(a)}},Du.prototype.interfaces_=function(){return[]},Du.prototype.getClass=function(){return Du};var Iu=function A(){this.Vt=null,this.qs=null,this.Ws=new Array(3).fill(null),this.Vs=null,this.Rs=A.TOLERANCE,this.Ks=new Zn;var t=arguments[0],n=arguments[1],i=arguments[2];this.Rs=A.computeBoundaryDistanceTolerance(t,n),this.Vt=[t,n,i],this.qs=[new gu(this.Vt[0],this.Rs),new gu(this.Vt[1],this.Rs),new gu(this.Vt[2],this.Rs)]},Mu={TOLERANCE:{configurable:!0}};Iu.prototype.reportResult=function(A,t,n){Pn.out.println("Overlay result invalid - A:"+$t.toLocationSymbol(t[0])+" B:"+$t.toLocationSymbol(t[1])+" expected:"+(n?"i":"e")+" actual:"+$t.toLocationSymbol(t[2]))},Iu.prototype.isValid=function(A){return this.addTestPts(this.Vt[0]),this.addTestPts(this.Vt[1]),this.checkValid(A)},Iu.prototype.checkValid=function(){var A=this;if(1===arguments.length){for(var t=arguments[0],n=0;n<this.Ks.size();n++){var i=A.Ks.get(n);if(!A.checkValid(t,i))return A.Vs=i,!1}return!0}if(2===arguments.length){var r=arguments[0],e=arguments[1];return this.Ws[0]=this.qs[0].getLocation(e),this.Ws[1]=this.qs[1].getLocation(e),this.Ws[2]=this.qs[2].getLocation(e),!!Iu.hasLocation(this.Ws,$t.BOUNDARY)||this.isValidResult(r,this.Ws)}},Iu.prototype.addTestPts=function(A){var t=new Du(A);this.Ks.addAll(t.getPoints(5*this.Rs))},Iu.prototype.isValidResult=function(A,t){var n=Pu.isResultOfOp(t[0],t[1],A),i=!(n^t[2]===$t.INTERIOR);return i||this.reportResult(A,t,n),i},Iu.prototype.getInvalidLocation=function(){return this.Vs},Iu.prototype.interfaces_=function(){return[]},Iu.prototype.getClass=function(){return Iu},Iu.hasLocation=function(A,t){for(var n=0;n<3;n++)if(A[n]===t)return!0;return!1},Iu.computeBoundaryDistanceTolerance=function(A,t){return Math.min(Rs.computeSizeBasedSnapTolerance(A),Rs.computeSizeBasedSnapTolerance(t))},Iu.isValid=function(A,t,n,i){return new Iu(A,t,i).isValid(n)},Mu.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Iu,Mu);var bu=function A(t){this.Hs=null,this._s=!1,this.Js=null,this.Hs=A.extractFactory(t),this.Js=t};bu.prototype.extractElements=function(A,t){if(null===A)return null;for(var n=0;n<A.getNumGeometries();n++){var i=A.getGeometryN(n);this._s&&i.isEmpty()||t.add(i)}},bu.prototype.combine=function(){for(var A=new Zn,t=this.Js.iterator();t.hasNext();){var n=t.next();this.extractElements(n,A)}return 0===A.size()?null!==this.Hs?this.Hs.createGeometryCollection(null):null:this.Hs.buildGeometry(A)},bu.prototype.interfaces_=function(){return[]},bu.prototype.getClass=function(){return bu},bu.combine=function(){if(1===arguments.length){var A=arguments[0],t=new bu(A);return t.combine()}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=new bu(bu.createList(n,i));return r.combine()}if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2],o=new bu(bu.createList(e,s,u));return o.combine()}},bu.extractFactory=function(A){return A.isEmpty()?null:A.iterator().next().getFactory()},bu.createList=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new Zn;return n.add(A),n.add(t),n}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=new Zn;return s.add(i),s.add(r),s.add(e),s}};var zu=function(){this.Zs=null,this.Hs=null;var A=arguments[0];this.Zs=A,null===this.Zs&&(this.Zs=new Zn)},xu={STRTREE_NODE_CAPACITY:{configurable:!0}};zu.prototype.reduceToGeometries=function(A){for(var t=new Zn,n=A.iterator();n.hasNext();){var i=n.next(),r=null;tn(i,_n)?r=this.unionTree(i):i instanceof jn&&(r=i),t.add(r)}return t},zu.prototype.extractByEnvelope=function(A,t,n){for(var i=new Zn,r=0;r<t.getNumGeometries();r++){var e=t.getGeometryN(r);e.getEnvelopeInternal().intersects(A)?i.add(e):n.add(e)}return this.Hs.buildGeometry(i)},zu.prototype.unionOptimized=function(A,t){var n=A.getEnvelopeInternal(),i=t.getEnvelopeInternal();if(!n.intersects(i))return bu.combine(A,t);if(A.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(A,t);var r=n.intersection(i);return this.unionUsingEnvelopeIntersection(A,t,r)},zu.prototype.union=function(){if(null===this.Zs)throw new Error("union() method cannot be called twice");if(this.Zs.isEmpty())return null;this.Hs=this.Zs.iterator().next().getFactory();for(var A=new Jr(zu.STRTREE_NODE_CAPACITY),t=this.Zs.iterator();t.hasNext();){var n=t.next();A.insert(n.getEnvelopeInternal(),n)}this.Zs=null;var i=A.itemsTree();return this.unionTree(i)},zu.prototype.binaryUnion=function(){if(1===arguments.length){var A=arguments[0];return this.binaryUnion(A,0,A.size())}if(3===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2];if(i-n<=1){var r=zu.getGeometry(t,n);return this.unionSafe(r,null)}if(i-n==2)return this.unionSafe(zu.getGeometry(t,n),zu.getGeometry(t,n+1));var e=Math.trunc((i+n)/2),s=this.binaryUnion(t,n,e),u=this.binaryUnion(t,e,i);return this.unionSafe(s,u)}},zu.prototype.repeatedUnion=function(A){for(var t=null,n=A.iterator();n.hasNext();){var i=n.next();t=null===t?i.copy():t.union(i)}return t},zu.prototype.unionSafe=function(A,t){return null===A&&null===t?null:null===A?t.copy():null===t?A.copy():this.unionOptimized(A,t)},zu.prototype.unionActual=function(A,t){return zu.restrictToPolygons(A.union(t))},zu.prototype.unionTree=function(A){var t=this.reduceToGeometries(A);return this.binaryUnion(t)},zu.prototype.unionUsingEnvelopeIntersection=function(A,t,n){var i=new Zn,r=this.extractByEnvelope(n,A,i),e=this.extractByEnvelope(n,t,i),s=this.unionActual(r,e);return i.add(s),bu.combine(i)},zu.prototype.bufferUnion=function(){if(1===arguments.length){var A=arguments[0],t=A.get(0).getFactory(),n=t.buildGeometry(A),i=n.buffer(0);return i}if(2===arguments.length){var r=arguments[0],e=arguments[1],s=r.getFactory(),u=s.createGeometryCollection([r,e]),o=u.buffer(0);return o}},zu.prototype.interfaces_=function(){return[]},zu.prototype.getClass=function(){return zu},zu.restrictToPolygons=function(A){if(tn(A,ki))return A;var t=vs.getPolygons(A);return 1===t.size()?t.get(0):A.getFactory().createMultiPolygon(sr.toPolygonArray(t))},zu.getGeometry=function(A,t){return t>=A.size()?null:A.get(t)},zu.union=function(A){return new zu(A).union()},xu.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(zu,xu);var du=function(){};function yu(){return new mu}function mu(){this.reset()}du.prototype.interfaces_=function(){return[]},du.prototype.getClass=function(){return du},du.union=function(A,t){if(A.isEmpty()||t.isEmpty()){if(A.isEmpty()&&t.isEmpty())return Pu.createEmptyResult(Pu.UNION,A,t,A.getFactory());if(A.isEmpty())return t.copy();if(t.isEmpty())return A.copy()}return A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),_s.overlayOp(A,t,Pu.UNION)},mu.prototype={constructor:mu,reset:function(){this.s=this.t=0},add:function(A){Lu(pu,A,this.t),Lu(this,pu.s,this.s),this.s?this.t+=pu.t:this.s=pu.t},valueOf:function(){return this.s}};var pu=new mu;function Lu(A,t,n){var i=A.s=t+n,r=i-t;A.t=t-(i-r)+(n-r)}var Tu=1e-6,Ou=Math.PI,Fu=Ou/2,Eu=Ou/4,Uu=2*Ou,Nu=180/Ou,ju=Ou/180,Qu=Math.abs,Su=Math.atan,Bu=Math.atan2,Ru=Math.cos,ku=Math.sin,Gu=Math.sqrt;function Yu(A){return A>1?0:A<-1?Ou:Math.acos(A)}function qu(A){return A>1?Fu:A<-1?-Fu:Math.asin(A)}function Wu(){}function Vu(A,t){A&&Ju.hasOwnProperty(A.type)&&Ju[A.type](A,t)}var Ku,Hu,_u={Feature:function(A,t){Vu(A.geometry,t)},FeatureCollection:function(A,t){for(var n=A.features,i=-1,r=n.length;++i<r;)Vu(n[i].geometry,t)}},Ju={Sphere:function(A,t){t.sphere()},Point:function(A,t){t.point((A=A.coordinates)[0],A[1],A[2])},MultiPoint:function(A,t){for(var n=A.coordinates,i=-1,r=n.length;++i<r;)t.point((A=n[i])[0],A[1],A[2])},LineString:function(A,t){Zu(A.coordinates,t,0)},MultiLineString:function(A,t){for(var n=A.coordinates,i=-1,r=n.length;++i<r;)Zu(n[i],t,0)},Polygon:function(A,t){Xu(A.coordinates,t)},MultiPolygon:function(A,t){for(var n=A.coordinates,i=-1,r=n.length;++i<r;)Xu(n[i],t)},GeometryCollection:function(A,t){for(var n=A.geometries,i=-1,r=n.length;++i<r;)Vu(n[i],t)}};function Zu(A,t,n){var i,r=-1,e=A.length-n;for(t.lineStart();++r<e;)t.point((i=A[r])[0],i[1],i[2]);t.lineEnd()}function Xu(A,t){var n=-1,i=A.length;for(t.polygonStart();++n<i;)Zu(A[n],t,1);t.polygonEnd()}function $u(A){return[Bu(A[1],A[0]),qu(A[2])]}function Ao(A){var t=A[0],n=A[1],i=Ru(n);return[i*Ru(t),i*ku(t),ku(n)]}function to(A,t){return A[0]*t[0]+A[1]*t[1]+A[2]*t[2]}function no(A,t){return[A[1]*t[2]-A[2]*t[1],A[2]*t[0]-A[0]*t[2],A[0]*t[1]-A[1]*t[0]]}function io(A,t){A[0]+=t[0],A[1]+=t[1],A[2]+=t[2]}function ro(A,t){return[A[0]*t,A[1]*t,A[2]*t]}function eo(A){var t=Gu(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]);A[0]/=t,A[1]/=t,A[2]/=t}function so(A,t){function n(n,i){return n=A(n,i),t(n[0],n[1])}return A.invert&&t.invert&&(n.invert=function(n,i){return(n=t.invert(n,i))&&A.invert(n[0],n[1])}),n}function uo(A,t){return[A>Ou?A-Uu:A<-Ou?A+Uu:A,t]}function oo(A){return function(t,n){return[(t+=A)>Ou?t-Uu:t<-Ou?t+Uu:t,n]}}function ho(A){var t=oo(A);return t.invert=oo(-A),t}function fo(A,t){var n=Ru(A),i=ku(A),r=Ru(t),e=ku(t);function s(A,t){var s=Ru(t),u=Ru(A)*s,o=ku(A)*s,h=ku(t),f=h*n+u*i;return[Bu(o*r-f*e,u*n-h*i),qu(f*r+o*e)]}return s.invert=function(A,t){var s=Ru(t),u=Ru(A)*s,o=ku(A)*s,h=ku(t),f=h*r-o*e;return[Bu(o*r+h*e,u*n+f*i),qu(f*n-u*i)]},s}function co(A,t){(t=Ao(t))[0]-=A,eo(t);var n=Yu(-t[1]);return((-t[2]<0?-n:n)+Uu-Tu)%Uu}function ao(){var A,t=[];return{point:function(t,n){A.push([t,n])},lineStart:function(){t.push(A=[])},lineEnd:Wu,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],A=null,n}}}function vo(A,t){return Qu(A[0]-t[0])<Tu&&Qu(A[1]-t[1])<Tu}function lo(A,t,n,i){this.x=A,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function wo(A,t,n,i,r){var e,s,u=[],o=[];if(A.forEach((function(A){if(!((t=A.length-1)<=0)){var t,n,i=A[0],s=A[t];if(vo(i,s)){for(r.lineStart(),e=0;e<t;++e)r.point((i=A[e])[0],i[1]);r.lineEnd()}else u.push(n=new lo(i,A,null,!0)),o.push(n.o=new lo(i,null,n,!1)),u.push(n=new lo(s,A,null,!1)),o.push(n.o=new lo(s,null,n,!0))}})),u.length){for(o.sort(t),Po(u),Po(o),e=0,s=o.length;e<s;++e)o[e].e=n=!n;for(var h,f,c=u[0];;){for(var a=c,v=!0;a.v;)if((a=a.n)===c)return;h=a.z,r.lineStart();do{if(a.v=a.o.v=!0,a.e){if(v)for(e=0,s=h.length;e<s;++e)r.point((f=h[e])[0],f[1]);else i(a.x,a.n.x,1,r);a=a.n}else{if(v)for(e=(h=a.p.z).length-1;e>=0;--e)r.point((f=h[e])[0],f[1]);else i(a.x,a.p.x,-1,r);a=a.p}h=(a=a.o).z,v=!v}while(!a.v);r.lineEnd()}}}function Po(A){if(t=A.length){for(var t,n,i=0,r=A[0];++i<t;)r.n=n=A[i],n.p=r,r=n;r.n=n=A[0],n.p=r}}function go(A,t){return A<t?-1:A>t?1:A>=t?0:NaN}function Co(A){for(var t,n,i,r=A.length,e=-1,s=0;++e<r;)s+=A[e].length;for(n=new Array(s);--r>=0;)for(t=(i=A[r]).length;--t>=0;)n[--s]=i[t];return n}function Do(A,t,n,i){function r(r,e){return A<=r&&r<=n&&t<=e&&e<=i}function e(r,e,u,h){var f=0,c=0;if(null==r||(f=s(r,u))!==(c=s(e,u))||o(r,e)<0^u>0)do{h.point(0===f||3===f?A:n,f>1?i:t)}while((f=(f+u+4)%4)!==c);else h.point(e[0],e[1])}function s(i,r){return Qu(i[0]-A)<Tu?r>0?0:3:Qu(i[0]-n)<Tu?r>0?2:1:Qu(i[1]-t)<Tu?r>0?1:0:r>0?3:2}function u(A,t){return o(A.x,t.x)}function o(A,t){var n=s(A,1),i=s(t,1);return n!==i?n-i:0===n?t[1]-A[1]:1===n?A[0]-t[0]:2===n?A[1]-t[1]:t[0]-A[0]}return function(s){var o,h,f,c,a,v,l,w,P,g,C,D=s,I=ao(),M={point:b,lineStart:function(){M.point=z,h&&h.push(f=[]),g=!0,P=!1,l=w=NaN},lineEnd:function(){o&&(z(c,a),v&&P&&I.rejoin(),o.push(I.result())),M.point=b,P&&D.lineEnd()},polygonStart:function(){D=I,o=[],h=[],C=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,r=h.length;n<r;++n)for(var e,s,u=h[n],o=1,f=u.length,c=u[0],a=c[0],v=c[1];o<f;++o)e=a,s=v,a=(c=u[o])[0],v=c[1],s<=i?v>i&&(a-e)*(i-s)>(v-s)*(A-e)&&++t:v<=i&&(a-e)*(i-s)<(v-s)*(A-e)&&--t;return t}(),n=C&&t,r=(o=Co(o)).length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),e(null,null,1,s),s.lineEnd()),r&&wo(o,u,t,e,s),s.polygonEnd()),D=s,o=h=f=null}};function b(A,t){r(A,t)&&D.point(A,t)}function z(e,s){var u=r(e,s);if(h&&f.push([e,s]),g)c=e,a=s,v=u,g=!1,u&&(D.lineStart(),D.point(e,s));else if(u&&P)D.point(e,s);else{var o=[l=Math.max(-1e9,Math.min(1e9,l)),w=Math.max(-1e9,Math.min(1e9,w))],I=[e=Math.max(-1e9,Math.min(1e9,e)),s=Math.max(-1e9,Math.min(1e9,s))];!function(A,t,n,i,r,e){var s,u=A[0],o=A[1],h=0,f=1,c=t[0]-u,a=t[1]-o;if(s=n-u,c||!(s>0)){if(s/=c,c<0){if(s<h)return;s<f&&(f=s)}else if(c>0){if(s>f)return;s>h&&(h=s)}if(s=r-u,c||!(s<0)){if(s/=c,c<0){if(s>f)return;s>h&&(h=s)}else if(c>0){if(s<h)return;s<f&&(f=s)}if(s=i-o,a||!(s>0)){if(s/=a,a<0){if(s<h)return;s<f&&(f=s)}else if(a>0){if(s>f)return;s>h&&(h=s)}if(s=e-o,a||!(s<0)){if(s/=a,a<0){if(s>f)return;s>h&&(h=s)}else if(a>0){if(s<h)return;s<f&&(f=s)}return h>0&&(A[0]=u+h*c,A[1]=o+h*a),f<1&&(t[0]=u+f*c,t[1]=o+f*a),!0}}}}}(o,I,A,t,n,i)?u&&(D.lineStart(),D.point(e,s),C=!1):(P||(D.lineStart(),D.point(o[0],o[1])),D.point(I[0],I[1]),u||D.lineEnd(),C=!1)}l=e,w=s,P=u}return M}}yu(),yu(),yu(),uo.invert=uo,1===(Ku=go).length&&(Hu=Ku,Ku=function(A,t){return go(Hu(A),t)});var Io=yu();function Mo(A){return A}yu(),yu(),yu();var bo=1/0,zo=bo,xo=-bo,yo=xo,mo={point:function(A,t){A<bo&&(bo=A),A>xo&&(xo=A),t<zo&&(zo=t),t>yo&&(yo=t)},lineStart:Wu,lineEnd:Wu,polygonStart:Wu,polygonEnd:Wu,result:function(){var A=[[bo,zo],[xo,yo]];return xo=yo=-(zo=bo=1/0),A}};function po(A,t,n,i){return function(r,e){var s,u,o,h=t(e),f=r.invert(i[0],i[1]),c=ao(),a=t(c),v=!1,l={point:w,lineStart:g,lineEnd:C,polygonStart:function(){l.point=D,l.lineStart=I,l.lineEnd=M,u=[],s=[]},polygonEnd:function(){l.point=w,l.lineStart=g,l.lineEnd=C,u=Co(u);var A=function(A,t){var n=t[0],i=t[1],r=[ku(n),-Ru(n),0],e=0,s=0;Io.reset();for(var u=0,o=A.length;u<o;++u)if(f=(h=A[u]).length)for(var h,f,c=h[f-1],a=c[0],v=c[1]/2+Eu,l=ku(v),w=Ru(v),P=0;P<f;++P,a=C,l=I,w=M,c=g){var g=h[P],C=g[0],D=g[1]/2+Eu,I=ku(D),M=Ru(D),b=C-a,z=b>=0?1:-1,x=z*b,d=x>Ou,y=l*I;if(Io.add(Bu(y*z*ku(x),w*M+y*Ru(x))),e+=d?b+z*Uu:b,d^a>=n^C>=n){var m=no(Ao(c),Ao(g));eo(m);var p=no(r,m);eo(p);var L=(d^b>=0?-1:1)*qu(p[2]);(i>L||i===L&&(m[0]||m[1]))&&(s+=d^b>=0?1:-1)}}return(e<-Tu||e<Tu&&Io<-Tu)^1&s}(s,f);u.length?(v||(e.polygonStart(),v=!0),wo(u,To,A,n,e)):A&&(v||(e.polygonStart(),v=!0),e.lineStart(),n(null,null,1,e),e.lineEnd()),v&&(e.polygonEnd(),v=!1),u=s=null},sphere:function(){e.polygonStart(),e.lineStart(),n(null,null,1,e),e.lineEnd(),e.polygonEnd()}};function w(t,n){var i=r(t,n);A(t=i[0],n=i[1])&&e.point(t,n)}function P(A,t){var n=r(A,t);h.point(n[0],n[1])}function g(){l.point=P,h.lineStart()}function C(){l.point=w,h.lineEnd()}function D(A,t){o.push([A,t]);var n=r(A,t);a.point(n[0],n[1])}function I(){a.lineStart(),o=[]}function M(){D(o[0][0],o[0][1]),a.lineEnd();var A,t,n,i,r=a.clean(),h=c.result(),f=h.length;if(o.pop(),s.push(o),o=null,f)if(1&r){if((t=(n=h[0]).length-1)>0){for(v||(e.polygonStart(),v=!0),e.lineStart(),A=0;A<t;++A)e.point((i=n[A])[0],i[1]);e.lineEnd()}}else f>1&&2&r&&h.push(h.pop().concat(h.shift())),u.push(h.filter(Lo))}return l}}function Lo(A){return A.length>1}function To(A,t){return((A=A.x)[0]<0?A[1]-Fu-Tu:Fu-A[1])-((t=t.x)[0]<0?t[1]-Fu-Tu:Fu-t[1])}yu();var Oo=po((function(){return!0}),(function(A){var t,n=NaN,i=NaN,r=NaN;return{lineStart:function(){A.lineStart(),t=1},point:function(e,s){var u=e>0?Ou:-Ou,o=Qu(e-n);Qu(o-Ou)<Tu?(A.point(n,i=(i+s)/2>0?Fu:-Fu),A.point(r,i),A.lineEnd(),A.lineStart(),A.point(u,i),A.point(e,i),t=0):r!==u&&o>=Ou&&(Qu(n-r)<Tu&&(n-=r*Tu),Qu(e-u)<Tu&&(e-=u*Tu),i=function(A,t,n,i){var r,e,s=ku(A-n);return Qu(s)>Tu?Su((ku(t)*(e=Ru(i))*ku(n)-ku(i)*(r=Ru(t))*ku(A))/(r*e*s)):(t+i)/2}(n,i,e,s),A.point(r,i),A.lineEnd(),A.lineStart(),A.point(u,i),t=0),A.point(n=e,i=s),r=u},lineEnd:function(){A.lineEnd(),n=i=NaN},clean:function(){return 2-t}}}),(function(A,t,n,i){var r;if(null==A)i.point(-Ou,r=n*Fu),i.point(0,r),i.point(Ou,r),i.point(Ou,0),i.point(Ou,-r),i.point(0,-r),i.point(-Ou,-r),i.point(-Ou,0),i.point(-Ou,r);else if(Qu(A[0]-t[0])>Tu){var e=A[0]<t[0]?Ou:-Ou;i.point(-e,r=n*e/2),i.point(0,r),i.point(e,r)}else i.point(t[0],t[1])}),[-Ou,-Fu]);function Fo(A,t){var n=Ru(A),i=n>0,r=Qu(n)>Tu;function e(A,t){return Ru(A)*Ru(t)>n}function s(A,t,i){var r=[1,0,0],e=no(Ao(A),Ao(t)),s=to(e,e),u=e[0],o=s-u*u;if(!o)return!i&&A;var h=n*s/o,f=-n*u/o,c=no(r,e),a=ro(r,h);io(a,ro(e,f));var v=c,l=to(a,v),w=to(v,v),P=l*l-w*(to(a,a)-1);if(!(P<0)){var g=Gu(P),C=ro(v,(-l-g)/w);if(io(C,a),C=$u(C),!i)return C;var D,I=A[0],M=t[0],b=A[1],z=t[1];M<I&&(D=I,I=M,M=D);var x=M-I,d=Qu(x-Ou)<Tu;if(!d&&z<b&&(D=b,b=z,z=D),d||x<Tu?d?b+z>0^C[1]<(Qu(C[0]-I)<Tu?b:z):b<=C[1]&&C[1]<=z:x>Ou^(I<=C[0]&&C[0]<=M)){var y=ro(v,(-l+g)/w);return io(y,a),[C,$u(y)]}}}function u(t,n){var r=i?A:Ou-A,e=0;return t<-r?e|=1:t>r&&(e|=2),n<-r?e|=4:n>r&&(e|=8),e}return po(e,(function(A){var t,n,o,h,f;return{lineStart:function(){h=o=!1,f=1},point:function(c,a){var v,l=[c,a],w=e(c,a),P=i?w?0:u(c,a):w?u(c+(c<0?Ou:-Ou),a):0;if(!t&&(h=o=w)&&A.lineStart(),w!==o&&(!(v=s(t,l))||vo(t,v)||vo(l,v))&&(l[0]+=Tu,l[1]+=Tu,w=e(l[0],l[1])),w!==o)f=0,w?(A.lineStart(),v=s(l,t),A.point(v[0],v[1])):(v=s(t,l),A.point(v[0],v[1]),A.lineEnd()),t=v;else if(r&&t&&i^w){var g;P&n||!(g=s(l,t,!0))||(f=0,i?(A.lineStart(),A.point(g[0][0],g[0][1]),A.point(g[1][0],g[1][1]),A.lineEnd()):(A.point(g[1][0],g[1][1]),A.lineEnd(),A.lineStart(),A.point(g[0][0],g[0][1])))}!w||t&&vo(t,l)||A.point(l[0],l[1]),t=l,o=w,n=P},lineEnd:function(){o&&A.lineEnd(),t=null},clean:function(){return f|(h&&o)<<1}}}),(function(n,i,r,e){!function(A,t,n,i,r,e){if(n){var s=Ru(t),u=ku(t),o=i*n;null==r?(r=t+i*Uu,e=t-o/2):(r=co(s,r),e=co(s,e),(i>0?r<e:r>e)&&(r+=i*Uu));for(var h,f=r;i>0?f>e:f<e;f-=o)h=$u([s,-u*Ru(f),-u*ku(f)]),A.point(h[0],h[1])}}(e,A,t,r,n,i)}),i?[0,-A]:[-Ou,A-Ou])}function Eo(A){return function(t){var n=new Uo;for(var i in A)n[i]=A[i];return n.stream=t,n}}function Uo(){}function No(A,t,n){var i=t[1][0]-t[0][0],r=t[1][1]-t[0][1],e=A.clipExtent&&A.clipExtent();A.scale(150).translate([0,0]),null!=e&&A.clipExtent(null),function(A,t){A&&_u.hasOwnProperty(A.type)?_u[A.type](A,t):Vu(A,t)}(n,A.stream(mo));var s=mo.result(),u=Math.min(i/(s[1][0]-s[0][0]),r/(s[1][1]-s[0][1])),o=+t[0][0]+(i-u*(s[1][0]+s[0][0]))/2,h=+t[0][1]+(r-u*(s[1][1]+s[0][1]))/2;return null!=e&&A.clipExtent(e),A.scale(150*u).translate([o,h])}Uo.prototype={constructor:Uo,point:function(A,t){this.stream.point(A,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var jo=Ru(30*ju);function Qo(A,t){return+t?function(A,t){function n(i,r,e,s,u,o,h,f,c,a,v,l,w,P){var g=h-i,C=f-r,D=g*g+C*C;if(D>4*t&&w--){var I=s+a,M=u+v,b=o+l,z=Gu(I*I+M*M+b*b),x=qu(b/=z),d=Qu(Qu(b)-1)<Tu||Qu(e-c)<Tu?(e+c)/2:Bu(M,I),y=A(d,x),m=y[0],p=y[1],L=m-i,T=p-r,O=C*L-g*T;(O*O/D>t||Qu((g*L+C*T)/D-.5)>.3||s*a+u*v+o*l<jo)&&(n(i,r,e,s,u,o,m,p,d,I/=z,M/=z,b,w,P),P.point(m,p),n(m,p,d,I,M,b,h,f,c,a,v,l,w,P))}}return function(t){var i,r,e,s,u,o,h,f,c,a,v,l,w={point:P,lineStart:g,lineEnd:D,polygonStart:function(){t.polygonStart(),w.lineStart=I},polygonEnd:function(){t.polygonEnd(),w.lineStart=g}};function P(n,i){n=A(n,i),t.point(n[0],n[1])}function g(){f=NaN,w.point=C,t.lineStart()}function C(i,r){var e=Ao([i,r]),s=A(i,r);n(f,c,h,a,v,l,f=s[0],c=s[1],h=i,a=e[0],v=e[1],l=e[2],16,t),t.point(f,c)}function D(){w.point=P,t.lineEnd()}function I(){g(),w.point=M,w.lineEnd=b}function M(A,t){C(i=A,t),r=f,e=c,s=a,u=v,o=l,w.point=C}function b(){n(f,c,h,a,v,l,r,e,i,s,u,o,16,t),w.lineEnd=D,D()}return w}}(A,t):function(A){return Eo({point:function(t,n){t=A(t,n),this.stream.point(t[0],t[1])}})}(A)}var So=Eo({point:function(A,t){this.stream.point(A*ju,t*ju)}});var Ro=function(t,n){var i=Ru(t),r=Ru(n),e=function(A){return(A=Yu(A))&&A/ku(A)}(i*r);return[e*r*ku(t),e*ku(n)]};function ko(){return function(A){return function(A){var t,n,i,r,e,s,u,o,h,f,c=150,a=480,v=250,l=0,w=0,P=0,g=0,C=0,D=null,I=Oo,M=null,b=Mo,z=.5,x=Qo(m,z);function d(A){return[(A=e(A[0]*ju,A[1]*ju))[0]*c+n,i-A[1]*c]}function y(A){return(A=e.invert((A[0]-n)/c,(i-A[1])/c))&&[A[0]*Nu,A[1]*Nu]}function m(A,r){return[(A=t(A,r))[0]*c+n,i-A[1]*c]}function p(){e=so(r=function(A,t,n){return(A%=Uu)?t||n?so(ho(A),fo(t,n)):ho(A):t||n?fo(t,n):uo}(P,g,C),t);var A=t(l,w);return n=a-A[0]*c,i=v+A[1]*c,L()}function L(){return h=f=null,d}return d.stream=function(A){return h&&f===A?h:h=So(I(r,x(b(f=A))))},d.clipAngle=function(A){return arguments.length?(I=+A?Fo(D=A*ju,6*ju):(D=null,Oo),L()):D*Nu},d.clipExtent=function(A){return arguments.length?(b=null==A?(M=s=u=o=null,Mo):Do(M=+A[0][0],s=+A[0][1],u=+A[1][0],o=+A[1][1]),L()):null==M?null:[[M,s],[u,o]]},d.scale=function(A){return arguments.length?(c=+A,p()):c},d.translate=function(A){return arguments.length?(a=+A[0],v=+A[1],p()):[a,v]},d.center=function(A){return arguments.length?(l=A[0]%360*ju,w=A[1]%360*ju,p()):[l*Nu,w*Nu]},d.rotate=function(A){return arguments.length?(P=A[0]%360*ju,g=A[1]%360*ju,C=A.length>2?A[2]%360*ju:0,p()):[P*Nu,g*Nu,C*Nu]},d.precision=function(A){return arguments.length?(x=Qo(m,z=A*A),L()):Gu(z)},d.fitExtent=function(A,t){return No(d,A,t)},d.fitSize=function(A,t){return function(A,t,n){return No(A,[[0,0],t],n)}(d,A,t)},function(){return t=A.apply(this,arguments),d.invert=t.invert&&y,p()}}((function(){return A}))()}(Ro).scale(79.4188).clipAngle(179.999)}function Go(A,t,n,i){var r=A.properties||{},e="Feature"===A.type?A.geometry:A;if("GeometryCollection"===e.type){var s=[];return Bt(A,(function(A){var r=Go(A,t,n,i);r&&s.push(r)})),mt(s)}var u=function(A){var t=function(A,t){void 0===t&&(t={});var n=Rt(A);return dt([(n[0]+n[2])/2,(n[1]+n[3])/2],t.properties,t)}(A).geometry.coordinates,n=[-t[0],-t[1]];return ko().rotate(n).scale(6371008.8)}(e),o={type:e.type,coordinates:Yo(e.coordinates,u)},h=(new ar).read(o),f=pt(Lt(t,n),"meters"),c=es.bufferOp(h,f,i);if(!function A(t){return Array.isArray(t[0])?A(t[0]):isNaN(t[0])}((c=(new vr).write(c)).coordinates))return xt({type:c.type,coordinates:qo(c.coordinates,u)},r)}function Yo(A,t){return"object"!=typeof A[0]?t(A):A.map((function(A){return Yo(A,t)}))}function qo(A,t){return"object"!=typeof A[0]?t.invert(A):A.map((function(A){return qo(A,t)}))}Ro.invert=function(t,n){var i=Gu(t*t+n*n),r=i,e=ku(r),s=Ru(r);return[Bu(t*e,i*s),qu(i&&n*e/i)]};const Wo=[.8451,.2588,.4863];const Ko=[.8,.1,.1];"undefined"!=typeof console&&console.log("@maptalks/analysis v0.74.0"),"undefined"!=typeof window&&(window.maptalksgl=window.maptalksgl||{},window.maptalksgl.transcoders=window.maptalksgl.transcoders||transcoders),exports.AEMarker=class extends J$2{constructor(t,e){super(t,e);const s=t$2.Util.extend({},mt$1,this.options.symbol);this.setSymbol(s);const i=t$2.Util.extend({},pt$1,this.options.symbol.uniforms);this.setUniforms(i)}},exports.B3DMLoader=Sr$1,exports.CMPTLoader=Ur$1,exports.CrossCutAnalysis=class extends Y{constructor(A){super(A),this.type="crosscutAnalysis"}SA(){const A=this.layer.getMap();this.N={};const{extentMap:t,extentInWorld:n}=this.Xs(this.options.cutLine);this.N.extent=n,this.N.extentMap=t,this.N.projMatrix=A.projMatrix,this.N.viewMatrix=A.viewMatrix}getAltitudes(A){const t=yt(this.options.cutLine);let n=0;for(let A=0;A<this.options.cutLine.length-1;A++)n+=jt(this.options.cutLine[A],this.options.cutLine[A+1]);const r=n/A,e=[];for(let n=0;n<A;n++){const A=Qt(t,r*(n+1)),s=new t__namespace.Coordinate(A.geometry.coordinates),u=this.$s(s);u&&e.push({point:[s.x,s.y,u.z],distance:r*n})}return e}$s(A){const t=this.layer.getMap(),n=this.layer.identify(A)[0],r=n&&n.point;if(r){const A=t.pointAtResToAltitude(r[2],t.getGLRes()),n=t.pointAtResToCoordinate(new t__namespace.Point(r[0],r[1]),t.getGLRes());return new t__namespace.Coordinate(n.x,n.y,A)}return A}Xs(A){const t=function(A,t,n){var i=(n=n||{}).units||"kilometers",r=n.steps||8;if(!A)throw new Error("geojson is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be an number");if(r<=0)throw new Error("steps must be greater than 0");var e=[];switch(A.type){case"GeometryCollection":return Bt(A,(function(A){var n=Go(A,t,i,r);n&&e.push(n)})),mt(e);case"FeatureCollection":return St(A,(function(A){var n=Go(A,t,i,r);n&&St(n,(function(A){A&&e.push(A)}))})),mt(e)}return Go(A,t,i,r)}(yt(A),.001);return this.j(t.geometry.coordinates[0])}T(t){const n=this.u={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.SA(t);const i=new k$7(t.regl);this.O=this.O||new bt(i,n),this.layer.addAnalysis(this)}update(A,t){if("cutLine"===A){const{extentMap:A,extentInWorld:n}=this.Xs(t);this.N.extent=n,this.N.extentMap=A}else this.N[A]=t;super.update(A,t)}renderAnalysis(A){const t={};return this.F.render(this.U,this.B),t.cutLineColor=this.options.cutLineColor||Wo,t.crosscutMap=this.O.render(A,this.N),t}getDefines(){return{HAS_CROSSCUT:1}}},exports.CutAnalysis=class extends Y{constructor(A){super(A),this.type="cut"}update(A,t){if("eyePos"===A||"lookPoint"===A){const n=this.layer.getMap();this.N[A]=l(n,...t)}else this.N[A]=t;super.update(A,t)}reset(){if(this.O){this.O.FA(this.N.position,this.N.rotation,this.N.scale)}}SA(){const A=this.layer.getMap();this.N={},this.N.position=l(A,...this.options.position),this.N.rotation=this.options.rotation||[0,0,0],this.N.scale=this.options.scale||[1,1,1],this.N.projViewMatrix=A.projViewMatrix}T(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1},i=new k$7(t.regl);i.canvas=t.canvas,i.parentRenderer=t,this.SA(),this.O=new VA(i,n)||this.O;const r=this.layer.getMap();this.O.OA(r,this.N.position,this.N.rotation,this.N.scale),this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(A){const t={};this.N.map=this.layer.getMap();const{meshesMap:n,invisibleMap:i}=this.O.render(A,this.N);return t.meshesMap=n,t.invisibleMap=i,t}getDefines(){return{HAS_CUT:1}}},exports.EffectLayer=it$1,exports.EffectLine=class extends J$2{constructor(t,e){super(t,e);const s=t$2.Util.extend({},at$1,this.options.symbol);this.setSymbol(s);const i=t$2.Util.extend({},ht$1,this.options.symbol.uniforms);this.setUniforms(i),this.setShader("effectline"),this.oe="effectmarker"}getEffectType(){return"sequence"}setTexture(t){return this.setUniform("texture",t),this}setHeight(t){return this.setUniform("modelHeight",t),this}setStartOpacity(t){return this.setUniform("startOpacity",t),this}setEndOpacity(t){return this.setUniform("endOpacity",t),this}},exports.EffectLineLayer=ut$1,exports.EffectMarker=J$2,exports.EffectRing=class extends G$2{constructor(t,e){super(t,e);const s=t$2.Util.extend({},lt$1,this.options.symbol.uniforms);this.setUniforms(s),this.setShader("effectring"),this.oe="effectring"}},exports.EffectRingLayer=dt$1,exports.ExcavateAnalysis=class extends Y{constructor(A){super(A),this.type="excavate"}et(A){const t=this.regl,n=t.texture({width:2,height:2});if(A){const n=new Image;n.src=A,n.onload=function(){this.N.groundTexture=t.texture(n),this.layer.getRenderer().setToRedraw()}.bind(this)}return n}st(A,t,n,i={}){if(!this.gA)return null;if(this.q){this.gA.render(this.ut,{projViewMatrix:n.projViewMatrix},!0),this.q=!1}const{meshId:r,pickingId:e,point:s}=this.gA.pick(A,t,i.tolerance||3,{projViewMatrix:n.projViewMatrix},{viewMatrix:n.viewMatrix,projMatrix:n.projMatrix,returnPoint:!0});return{meshId:r,pickingId:e,point:s}}ot(A,t,n){const i=this.layer.getMap(),r=i.getDevicePixelRatio(),e=this.st(A*=r,t*=r,n),s=e&&e.point;return s?i.pointAtResToAltitude(s[2],i.getGLRes()):0}update(A,t){if("boundary"===A){const{extentMap:A,extentInWorld:n,extentPolygon:i}=this.j(t);this.N.extent=n,this.N.extentPolygon=i,this.N.extentMap=A,this.q=!0}else if("textureUrl"===A)this.N.groundTexture=this.et(t),this.N.hasTexture=c(t)?1:0;else if("height"===A){const A=this.layer.getMap();this.N.height=A.altitudeToPoint(t||0,A.getGLRes())}else this.N[A]=t;super.update(A,t)}getVolume(){this.q=!0;let A=0;const t=this.layer.getMap(),{extentInContainerMax:n,extentInContainerMin:r,matrix:e}=this.ht(),s=this.ft();for(let u=r.x;u<n.x;u++)for(let o=n.y;o<r.y;o++){const r=[u+1,o],h=[u,o+1],f=t.containerPointToCoordinate(new t__namespace.Point([u,o])),c=t.containerPointToCoordinate(new t__namespace.Point(r)),a=t.containerPointToCoordinate(new t__namespace.Point(h));s.containsPoint(f)&&(A+=new t__namespace.Polygon([[f.x,f.y],[c.x,c.y],[c.x,a.y],[a.x,a.y]]).getArea()*(this.ot(u,o,e)-this.options.height||0))}return this.ct(),A}ht(){const A=this.layer.getMap(),n=this.ft().getExtent();this.ct();const r=A.getCenter(),e=A.getZoom(),s=A.getPitch(),u=A.getBearing(),o=A.getFitZoom(n)-1,h=n.getCenter();A.setZoom(o),A.setCenter(h),A.setPitch(0),A.setBearing(0);const f=copy$5([],A.projViewMatrix),c=copy$5([],A.viewMatrix),a=copy$5([],A.projMatrix),v=A.coordinateToContainerPoint(new t__namespace.Coordinate(n.xmin,n.ymin)),l=A.coordinateToContainerPoint(new t__namespace.Coordinate(n.xmax,n.ymax));return A.setZoom(e),A.setCenter(r),A.setPitch(s),A.setBearing(u),{extentInContainerMax:l,extentInContainerMin:v,matrix:{projViewMatrix:f,projMatrix:a,viewMatrix:c}}}ft(){const A=this.layer.getMap(),t=this.options.boundary,n=A.getLayer("analysis-extent-layer")||new t__namespace.VectorLayer("analysis-extent-layer").addTo(A);return new t__namespace.Polygon(t,{symbol:{polygonOpacity:.2}}).addTo(n)}ct(){const A=this.layer.getMap().getLayer("analysis-extent-layer");A&&A.remove()}SA(){const A=this.layer.getMap(),{extentMap:t,extentInWorld:n,extentPolygon:i}=this.j(this.options.boundary);this.N={},this.N.height=A.altitudeToPoint(this.options.height||0,A.getGLRes()),this.N.extent=n,this.N.extentPolygon=i,this.N.extentMap=t,this.N.groundTexture=this.et(this.options.textureUrl),this.N.hasTexture=c(this.options.textureUrl)?1:0,this.N.projViewMatrix=A.projViewMatrix}T(t){const n=this.u={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.SA();const i=new k$7(t.regl);this.O=this.O||new It(i,n),this.layer.addAnalysis(this),this.vt(t),t.setToRedraw()}renderAnalysis(A){const t={};this.F.render(this.U,this.B),this.wt(A);const n=this.O.render(A,this.N);return this.ut=A,t.excavateMap=n,t}wt(A){A.forEach((A=>{const t=A.getMaterial(),n=A.getDefines();t.get("u_image")?n.HAS_TERRAIN=1:t.get("baseColorTexture")&&(n.HAS_MODELTEXTURE=1),A.setDefines(n)}))}vt(n){this.pickingFBO=n.regl.framebuffer(n.canvas.width,n.canvas.height),this.renderer=new k$7(n.regl),this.gA=new nr$4(this.renderer,{vert:xA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(A,n){return multiply$5([],n.projViewMatrix,n.modelMatrix)}}]},this.pickingFBO)}getDefines(){return{HAS_EXCAVATE:1}}remove(){super.remove(),this.pickingFBO&&(this.pickingFBO.destroy(),delete this.pickingFBO),this.gA&&(this.gA.dispose(),delete this.gA)}},exports.FillPainter=Ke$2,exports.FillPlugin=Br$1,exports.FilterUtil=sr$3,exports.FloodAnalysis=at,exports.GLContext=i$3,exports.GLTFLayer=Z$2,exports.GLTFMarker=G$2,exports.GLTFPhongPlugin=io$1,exports.GLTFStandardPlugin=no$1,exports.Geo3DTilesLayer=br$1,exports.Geo3DTilesUtil=B$5,exports.Geo3DTransform=ot$2,exports.GeoJSONVectorTileLayer=Tt$2,exports.GlowMarker=rt$1,exports.GlowMarkerLayer=ot$1,exports.GroundPainter=y$5,exports.GroupGLLayer=_t$4,exports.HeatmapPlugin=ro$1,exports.HeatmapProcess=Ft$4,exports.HeightLimitAnalysis=class extends at{constructor(A){super(A),this.type="heightLimitAnalysis"}SA(A){super.SA(A);const t=this.layer.getMap();this.N.waterHeight=a(t,this.options.limitHeight),this.N.type=2}update(A,t){if(super.update(A,t),"limitHeight"===A){const A=this.layer.getMap();this.N.waterHeight=A.altitudeToPoint(t||0,A.getGLRes())}}renderAnalysis(A){const t=super.renderAnalysis(A);return t.flood_waterColor=this.options.limitColor||Ko,t}},exports.IconPainter=kn$1,exports.IconPlugin=Yr$1,exports.InSightAnalysis=class extends Y{constructor(A){super(A),this.type="insight"}update(A,t){if("eyePos"===A||"lookPoint"===A){const n=this.layer.getMap();this.N[A]=l(n,...t)}else this.N[A]=t;super.update(A,t)}SA(){const A=this.layer.getMap();this.N={},this.N.eyePos=l(A,...this.options.eyePos),this.N.lookPoint=l(A,...this.options.lookPoint),this.N.visibleColor=this.options.visibleColor,this.N.invisibleColor=this.options.invisibleColor,this.N.projViewMatrix=A.projViewMatrix}T(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.SA();const i=new k$7(t.regl);this.O=this.O||new gt(i,n),this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(A){const t={},n=this.O.render(A,this.N);return t.insightMap=n,t.insight_visibleColor=this.N.visibleColor||[0,1,0,1],t.insight_invisibleColor=this.N.invisibleColor||[1,0,0,1],t}getDefines(){return{HAS_INSIGHT:1}}},exports.LineGradientPlugin=Xr$1,exports.LinePainter=ti$1,exports.LinePlugin=$r$1,exports.LineStringLayer=te$2,exports.LitPlugin=to$1,exports.MSDJSONLoader=class{constructor(t){this.i=t||{}}load(){const t=this.i.data;let r=this.i.basePath;if("string"==typeof(e=t)||null!==e.constructor&&e.constructor===String){const e=this.i.fetchFunction||fetch,i=this.i.fetchOptions;if(!r){const e=t.lastIndexOf("/");r=e<0?"./":t.substring(0,e)}return e(t,i).then((t=>t.json())).then((t=>(this.s(t,r),this)))}return this.s(t,r||"./"),Promise.resolve(this);var e}getMSDJSON(){return e(this.h)}getMapJSON(){return e(this.t)}getView(){if(!this.t)return null;const{center:t,zoom:r,pitch:e,bearing:i}=this.t;return{center:t,zoom:r,pitch:e,bearing:i}}getLights(){return this.t&&this.t.options.lights}getSceneConfig(){return this.t&&this.t.layers[0].options.sceneConfig}s(r,i){if("./"!==i&&"."!==i){"/"!==i[i.length-1]&&(i+="/"),this.h=r;let t=JSON.stringify(r);t=t.replace(/".\/res/g,'"'+i+"res"),r=JSON.parse(t)}else this.h=e(r);this.t=r||{},this.u=function(r){return r.layers?r.layers.map((r=>r?new t(r):null)):[]}(r.layers[0])}getLayer(t){const r=this.u;if(!r)return null;for(let e=0;e<r.length;e++){const i=r[e];if(i&&t===i.getId())return i}return null}getLayers(){return this.u||[]}},exports.MapboxVectorTileLayer=_t$2,exports.MultiGLTFMarker=et$1,exports.NativeLinePainter=pr$2,exports.NativeLinePlugin=Zr$1,exports.NativePointPainter=dr$2,exports.PackUtil=Zo,exports.PhongPainter=wr$2,exports.PhongPlugin=Kr$1,exports.PointLayer=Qt$2,exports.PolygonLayer=ie$2,exports.SYMBOLS_NEED_REBUILD_IN_VECTOR=ea,exports.SYMBOLS_NEED_REBUILD_IN_VT=Qo$1,exports.SkylineAnalysis=class extends Y{constructor(A){super(A),this.type="skyline"}SA(){const A=this.layer.getMap();this.N={},this.N.lineColor=this.options.lineColor,this.N.lineWidth=this.options.lineWidth,this.N.projViewMatrix=A.projViewMatrix}T(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.SA(),this.renderer=new k$7(t.regl),this.O=new st(this.renderer,n)||this.O,this.layer.addAnalysis(this),this.ZA=this.XA(t.regl)}renderAnalysis(A){this.ZA=this.ZA||this.XA(this.renderer.regl);const t=this.layer.getMap();this.$A(t);const n={};let i=A.concat([this.ZA]);return this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.l}),this.l=this.O.render(i,this.N),n.skylineMap=this.l,n}exportSkylineMap(A){A||(A={});const t=this.l.width,n=this.l.height,i=this.O.getRenderMeshes(),r=this.exportAnalysisMap(i),e=new Uint8ClampedArray(r.length);for(let A=0;A<t;A++)for(let i=0;i<n;i++)e[4*(i*t+A)]=r[4*((n-i)*t+A)],e[4*(i*t+A)+1]=r[4*((n-i)*t+A)+1],e[4*(i*t+A)+2]=r[4*((n-i)*t+A)+2],e[4*(i*t+A)+3]=r[4*((n-i)*t+A)+3];if(!ut)return null;ut.width=t,ut.height=n;const s=new ImageData(e,t,n);ut.getContext("2d").putImageData(s,0,0);const u=ut.toDataURL();if(!A.save)return u;{const t=document.createElement("a");t.download=A.filename||"export",t.href=u,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}update(A,t){this.N[A]=t,super.update(A,t)}XA(t){const n=new Xe$4;return n.generateBuffers(t),n.data.aTexCoord=new Float32Array(8),new de$4(n)}$A(A){const t=y$5.getGroundTransform(this.ZA.localTransform,A);this.ZA.setLocalTransform(t)}remove(){super.remove(),this.ZA&&(this.ZA.geometry.dispose(),this.ZA.dispose(),delete this.ZA)}getDefines(){return{HAS_SKYLINE:1}}},exports.TextPainter=ar$2,exports.TextPlugin=Jr$1,exports.TransformControl=R$2,exports.TubePlugin=eo$1,exports.Vector3DLayer=It$2,exports.VectorTileLayer=vt$2,exports.VectorTileLayerRenderer=lt$3,exports.VideoLayer=J$1,exports.VideoSurface=K$1,exports.ViewshedAnalysis=class extends Y{constructor(A){super(A),this.type="viewshed"}update(A,t){if("eyePos"===A||"lookPoint"===A){const n=this.layer.getMap();this.N[A]=l(n,...t)}else this.N[A]=t;super.update(A,t)}SA(){const A=this.layer.getMap();this.N={},this.N.eyePos=l(A,...this.options.eyePos),this.N.lookPoint=l(A,...this.options.lookPoint),this.N.verticalAngle=this.options.verticalAngle,this.N.horizontalAngle=this.options.horizontalAngle,this.N.visibleColor=this.options.visibleColor,this.N.invisibleColor=this.options.invisibleColor,this.N.projViewMatrix=A.projViewMatrix}T(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.SA();const i=new k$7(t.regl);this.O=new rt(i,n)||this.O,this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(A){const t={},n=this.O.render(A,this.N);return t.viewshedMap=n,t.viewshed_visibleColor=this.N.visibleColor||[0,1,0,1],t.viewshed_invisibleColor=this.N.invisibleColor||[1,0,0,1],t}getDefines(){return{HAS_VIEWSHED:1}}},exports.WaterPlugin=oo$1,exports.WireframePainter=kr$1,exports.WireframePlugin=Qr$1,exports.createREGL=u$5,exports.glMatrix=common,exports.mat2=mat2,exports.mat2d=mat2d,exports.mat3=mat3,exports.mat4=mat4,exports.quat=quat,exports.quat2=quat2,exports.reshader=h$3,exports.transcoders=transcoders,exports.vec2=vec2,exports.vec3=vec3,exports.vec4=vec4,Object.defineProperty(exports,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("@maptalks/gl-layers v0.12.1")}));
//# sourceMappingURL=maptalks-gl-layers.js.map
